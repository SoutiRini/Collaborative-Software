[{"count": 0, "tags": [], "bug_id": 35784, "attachment_id": null, "id": 77404, "time": "2005-07-18T23:07:14Z", "creator": "bero@arklinux.org", "creation_time": "2005-07-18T23:07:14Z", "is_private": false, "text": "There seems to be an FD leak somewhere in the class availability checking \ncode. \n \nTrying to build Axis 1.2.1 (http://ws.apache.org/axis/) with gcj/ecj as the \nonly installed JDK results in: \n \nBUILD FAILED \n/usr/src/ark/BUILD/axis-1_2_1/xmls/targets.xml:189: IO error scanning \ndirectory /usr/src/ark/BUILD/axis-1_2_1/lib \n \nThe related part of targets.xml is \n \n    <condition property=\"jimi.present\" > \n      <available classname=\"com.sun.jimi.core.Jimi\" \nclasspathref=\"classpath\" /> \n    </condition> \n \nMoving it up or removing some similar checks (there are loads of them in the \ntargets.xml file) moves the error to a check for a different class. \n \nstrace seems to indicate ant is trying to use too many files at the same time \n- the relevant part of strace output is: \n \nopen(\"/usr/share/java/commons-collections-testframework-3.1.jar\", O_RDONLY|\nO_LAR \nGEFILE) = 1023 \nfcntl64(1023, F_SETFD, FD_CLOEXEC)      = 0 \nfstat64(1023, {st_mode=S_IFREG|0644, st_size=102200, ...}) = 0 \n_llseek(1023, 102178, [102178], SEEK_SET) = 0 \nread(1023, \"PK\\5\\6\", 4)                 = 4 \nfstat64(1023, {st_mode=S_IFREG|0644, st_size=102200, ...}) = 0 \n_llseek(1023, 102188, [102188], SEEK_SET) = 0 \nread(1023, \"8\\0\", 2)                    = 2 \nfstat64(1023, {st_mode=S_IFREG|0644, st_size=102200, ...}) = 0 \n_llseek(1023, 102194, [102194], SEEK_SET) = 0 \nread(1023, \"\\225x\\1\\0\", 4)              = 4 \n_llseek(1023, 96405, [96405], SEEK_SET) = 0 \nread(1023, \"PK\\1\\2\\24\\3\\n\\0\\0\\0\\0\\0wY\\3412\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 46) = \n46 \n[.... many more read()s ....] \nread(1023, \"org/apache/commons/collections/s\"..., 62) = 62 \naccess(\"/usr/share/java/commons-collections.jar\", F_OK) = 0 \nstat64(\"/usr/share/java/commons-collections.jar\", {st_mode=S_IFREG|0644, \nst_size=544605, ...}) = 0 \nopen(\"/usr/share/java/commons-collections.jar\", O_RDONLY|O_LARGEFILE) = -1 \nEMFILE (Too many open files)"}, {"count": 1, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "text": "I'm going to mark this as a dup of the (fixed) bug 38260, in which Available\nwasnt cleaning up classloaders properly. \n\nBernhard, can you check that this problem goes away in SVN_HEAD. or wait for the\nant1.7 public beta and check then?\n\n*** This bug has been marked as a duplicate of 38260 ***", "id": 90877, "time": "2006-07-04T21:16:01Z", "bug_id": 35784, "creation_time": "2006-07-04T21:16:01Z", "is_private": false}]
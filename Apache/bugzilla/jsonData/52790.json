[{"count": 0, "text": "I am trying to connect a Subversion on Apache to an LDAP server. Unfortunately, the LDAP server does not like many requests for the same user, and returns \n\n[Tue Feb 28 18:21:46 2012] [info] [client 10.0.0.1] [18717] auth_ldap authenticate: user philipp authentication failed; URI /cgi-bin/anon.pl [LDAP: ldap_simple_bind_s() failed][Administrative limit exceeded]\n\nwhen it thinks that it have been too many requests.\nThe problem on the other side is that Subversion does an HTTP request for every single file, and I have a repository with approximately 1 million files in it, so every operation can result in a lot of HTTP requests with the same user.\n\nThe amount of different users that are authenticating to my application is rather low, I have about 3 power-users, and up to 100 users that are using it sporadically (once per month or less often)\nI have configured the cache like this:\n\nLDAPSharedCacheSize 3000000\nLDAPCacheEntries 1024\nLDAPCacheTTL 600000\nLDAPOpCacheEntries 1024\nLDAPOpCacheTTL 600000\nLDAPSharedCacheFile /var/cache/apache2/ldap.cache\n\nThe shared cache file is created properly, and the cache seems the be working, but it does not seem to really cache the authentication requests.\n\nWhen I do approximately 30 requests, I am getting those statistics:\n\nLDAP Cache Information\n\nCache Name\tEntries\tAvg. Chain Len.\tHits\tIns/Rem\tPurges\tAvg Purge Time\nLDAP URL Cache\t1 (0% full)\t1.0\t30/31\t97%\t1/0\t(none) \t0ms\nldaps://ldap.intranet/ou=people,dc=eu?uid (Searches)\t1 (0% full)\t1.0\t30/62\t48%\t25/24\t(none) \t0ms\nldaps://ldap.intranet/ou=people,dc=eu?uid (Compares)\t0 (0% full)\t0.0\t0/0\t100%\t0/0\t(none) \t0ms\nldaps://ldap.intranet/ou=people,dc=eu?uid (DNCompares)\t0 (0% full)\t0.0\t0/0\t100%\t0/0\t(none) \t0ms\n\n\nThe LDAP URL Cache seems to fully cache all the requests, but the Searches only cache 50%, so for every Hit, it still does one LDAP query.\n\nIs it possible to also cache the authentication requests? I do not see why repeated requests for exactly the same URL with exactly the same username and password need additional LDAP requests, I think they should be cached instead.\n\nMy Subversion config:\n\nAuthzSVNAccessFile /etc/apache2/dav_svn.authz\nAuthLDAPURL ldaps://ldap.intranet/ou=people,dc=eu?uid\nAuthLDAPBindDN \"uid=technuser,ou=people,dc=eu\"\nRequire valid-user\nOrder deny,allow\nDeny from All\nAuthName \"Please enter your UserID and password\"\nAuthType Basic\nAuthBasicProvider ldap\nAuthzLDAPAuthoritative off\nSatisfy any\n\n\nI guess that the problem might be that Apache does not want to store cleartext-passwords in the cache, since that can be a security issue. I would suggest to either encrypt the cache, or to only write hashed username+password into the cache.", "bug_id": 52790, "is_private": false, "id": 154338, "time": "2012-02-28T18:23:20Z", "creator": "pg@futureware.at", "creation_time": "2012-02-28T18:23:20Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "sf@sfritsch.de", "text": "In 2.4.1, there is mod_authn_socache, which allows to solve this problem. But I guess mod_ldap's caching should be improved, too.", "count": 1, "id": 154820, "time": "2012-03-12T09:57:37Z", "bug_id": 52790, "creation_time": "2012-03-12T09:57:37Z", "is_private": false}, {"count": 2, "tags": [], "creator": "kardereg@gmail.com", "attachment_id": null, "is_private": false, "id": 163261, "time": "2012-11-07T13:57:27Z", "bug_id": 52790, "creation_time": "2012-11-07T13:57:27Z", "text": "Hi.\n\nCurrently I'm using:\nUbuntu 12.04.1 LTS\nwith apache2: Candidate: 2.2.22-1ubuntu1\nand\nUbuntu 12.04.4 LTS\nwith apache2: Candidate: 2.2.14-5ubuntu8.9\n\nAs you can see unfortunately in the default Ubuntu repositories (for 10.04 and 12.04) there is only apache 2.2, and not 2.4 apache yet.\nI don't want to install apache 2.4 from binary sources, because I'm afraid that I will face another dependency issues after that. As how I see people are facing problems regarding to apache 2.4 (and it's modules) + Ubuntu 12.04 (or earlier) compatibility:\nhttp://askubuntu.com/questions/167205/apache-2-4-install-on-12-04-ends-up-with-non-standard-configuarion\nhttp://ubuntuforums.org/showthread.php?t=2011603\n\nMy question is that there is any workaround to solve this issue in apache 2.2? Do you have any plans to improve mod_ldap???\nWe are getting dozens of [LDAP: ldap_simple_bind_s() failed][Administrative limit exceeded] errors on a daily basis (we have a few hundred users and a few hundred commits daily) - receiving this error means that the commit also fails in this case.\n\nEarlier we used Ubuntu 9.10 with 2.2.12-1ubuntu2.1, and this error was not present there. So we also tried to change the mod_authnz_ldap.so and mod_ldap.so in 12.04 with the ones from 9.10, but this didn't help, we still receive this error on 12.04 (with the 9.10 modules also)."}, {"count": 3, "tags": [], "creator": "kardereg@gmail.com", "text": "(In reply to comment #2)\n> \n> Currently I'm using:\n> Ubuntu 12.04.1 LTS\n> with apache2: Candidate: 2.2.22-1ubuntu1\n> and\n> Ubuntu 12.04.4 LTS\n> with apache2: Candidate: 2.2.14-5ubuntu8.9\n> \n\nSorry, I meant Ubuntu 10.04.4 LTS, and not Ubuntu 12.04.4\nSo I'm currently using:\nUbuntu 12.04.1 LTS\nwith apache2: Candidate: 2.2.22-1ubuntu1\nand\nUbuntu 10.04.4 LTS\nwith apache2: Candidate: 2.2.14-5ubuntu8.9", "id": 163263, "attachment_id": null, "bug_id": 52790, "creation_time": "2012-11-07T14:05:23Z", "time": "2012-11-07T14:05:23Z", "is_private": false}]
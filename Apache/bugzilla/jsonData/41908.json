[{"count": 0, "tags": [], "bug_id": 41908, "attachment_id": null, "text": "I performed a PROPPATCH followed by a PROPFIND, and mod_dav has corrupted a\nproperty attribute namespace, as you can see from the log below. Specifically,\nthe attribute rdf:about=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil\" has\nbeen changed to dc:about=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil\".\n\nThis means that mod_dav is completely broken with regard to correct WebDAV\nproperty storage, and has essentially shot down my project until I can complete\nwriting my own WebDAV server.\n\nLogged communication is below.\n\nGarret\n\nPROPFIND /marmoxdemo/balcony_sunglasses.jpg HTTP/1.1\ndepth: 0\ncontent-length: (removed)\nhost: dav.globalmentor.com\nauthorization: BASIC (removed)\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<D:propfind xmlns:D=\"DAV:\">\n\t<D:allprop />\n</D:propfind>\n\n\nHTTP/1.1 207 Multi-Status\nDate: Tue, 20 Mar 2007 02:40:34 GMT\nServer: Apache/2.2.3 (Unix) mod_ssl/2.2.3 OpenSSL/0.9.8a DAV/2 SVN/1.5.0-dev\nPHP/5.1.2 mod_jk/1.2.15\nContent-Length: 1083\nContent-Type: text/xml; charset=\"utf-8\"\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<D:multistatus xmlns:D=\"DAV:\" xmlns:ns0=\"DAV:\">\n<D:response xmlns:ns0=\"DAV:\" xmlns:ns1=\"http://purl.org/dc/elements/1.1/\"\nxmlns:lp1=\"DAV:\" xmlns:lp3=\"http://subversion.tigris.org/xmlns/dav/\"\nxmlns:lp2=\"http://apache.org/dav/props/\">\n<D:href>/marmoxdemo/balcony_sunglasses.jpg</D:href>\n<D:propstat>\n<D:prop>\n<ns1:title>Balcony Sunglasses</ns1:title>\n<lp1:resourcetype/>\n<lp1:creationdate>2007-03-17T20:39:47Z</lp1:creationdate>\n<lp1:getcontentlength>48077</lp1:getcontentlength>\n<lp1:getlastmodified>Sat, 17 Mar 2007 20:39:47 GMT</lp1:getlastmodified>\n<lp1:getetag>\"191019e-bbcd-5b5a6ac0\"</lp1:getetag>\n<lp2:executable>F</lp2:executable>\n<D:supportedlock>\n<D:lockentry>\n<D:lockscope><D:exclusive/></D:lockscope>\n<D:locktype><D:write/></D:locktype>\n</D:lockentry>\n<D:lockentry>\n<D:lockscope><D:shared/></D:lockscope>\n<D:locktype><D:write/></D:locktype>\n</D:lockentry>\n</D:supportedlock>\n<D:lockdiscovery/>\n<D:getcontenttype>image/jpeg</D:getcontenttype>\n</D:prop>\n<D:status>HTTP/1.1 200 OK</D:status>\n</D:propstat>\n</D:response>\n</D:multistatus>\n\n\nPROPPATCH /marmoxdemo/balcony_sunglasses.jpg HTTP/1.1\ncontent-length: (removed)\nhost: dav.globalmentor.com\nauthorization: BASIC (removed)\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<D:propertyupdate xmlns:D=\"DAV:\"\nxmlns:marmot=\"http://globalmentor.com/namespaces/marmot#\"\nxmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">\n\t<D:set>\n\t\t<D:prop>\n\t\t\t<marmot:access>\n\t\t\t\t<marmot:access>\n\t\t\t\t\t<marmot:CustomAccess>\n\t\t\t\t\t\t<marmot:rules>\n\t\t\t\t\t\t\t<rdf:List>\n\t\t\t\t\t\t\t\t<rdf:first>\n\t\t\t\t\t\t\t\t\t<marmot:AccessRule>\n\t\t\t\t\t\t\t\t\t\t<marmot:principal rdf:resource=\"mailto:*@*\" />\n\t\t\t\t\t\t\t\t\t\t<marmot:allow>\n\t\t\t\t\t\t\t\t\t\t\t<marmot:ReadPermission />\n\t\t\t\t\t\t\t\t\t\t</marmot:allow>\n\t\t\t\t\t\t\t\t\t\t<marmot:allow>\n\t\t\t\t\t\t\t\t\t\t\t<marmot:WritePermission />\n\t\t\t\t\t\t\t\t\t\t</marmot:allow>\n\t\t\t\t\t\t\t\t\t</marmot:AccessRule>\n\t\t\t\t\t\t\t\t</rdf:first>\n\t\t\t\t\t\t\t\t<rdf:rest>\n\t\t\t\t\t\t\t\t\t<rdf:List rdf:about=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil\" />\n\t\t\t\t\t\t\t\t</rdf:rest>\n\t\t\t\t\t\t\t</rdf:List>\n\t\t\t\t\t\t</marmot:rules>\n\t\t\t\t\t</marmot:CustomAccess>\n\t\t\t\t</marmot:access>\n\t\t\t</marmot:access>\n\t\t</D:prop>\n\t</D:set>\n</D:propertyupdate>\n\n\nHTTP/1.1 207 Multi-Status\nDate: Tue, 20 Mar 2007 02:40:49 GMT\nServer: Apache/2.2.3 (Unix) mod_ssl/2.2.3 OpenSSL/0.9.8a DAV/2 SVN/1.5.0-dev\nPHP/5.1.2 mod_jk/1.2.15\nContent-Length: 392\nContent-Type: text/xml; charset=\"utf-8\"\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<D:multistatus xmlns:D=\"DAV:\"\nxmlns:ns2=\"http://globalmentor.com/namespaces/marmot#\"\nxmlns:ns1=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\" xmlns:ns0=\"DAV:\">\n<D:response>\n<D:href>/marmoxdemo/balcony_sunglasses.jpg</D:href>\n<D:propstat>\n<D:prop>\n<ns2:access/>\n</D:prop>\n<D:status>HTTP/1.1 200 OK</D:status>\n</D:propstat>\n</D:response>\n</D:multistatus>\n\n\nPROPFIND /marmoxdemo/balcony_sunglasses.jpg HTTP/1.1\ndepth: 0\ncontent-length: (removed)\nhost: dav.globalmentor.com\nauthorization: BASIC (removed)\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<D:propfind xmlns:D=\"DAV:\">\n\t<D:allprop />\n</D:propfind>\n\n\nHTTP/1.1 207 Multi-Status\nDate: Tue, 20 Mar 2007 02:40:49 GMT\nServer: Apache/2.2.3 (Unix) mod_ssl/2.2.3 OpenSSL/0.9.8a DAV/2 SVN/1.5.0-dev\nPHP/5.1.2 mod_jk/1.2.15\nContent-Length: 1805\nContent-Type: text/xml; charset=\"utf-8\"\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<D:multistatus xmlns:D=\"DAV:\" xmlns:ns0=\"DAV:\">\n<D:response xmlns:ns0=\"DAV:\" xmlns:ns1=\"http://purl.org/dc/elements/1.1/\"\nxmlns:ns2=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\nxmlns:ns3=\"http://globalmentor.com/namespaces/marmot#\" xmlns:lp1=\"DAV:\"\nxmlns:lp3=\"http://subversion.tigris.org/xmlns/dav/\"\nxmlns:lp2=\"http://apache.org/dav/props/\">\n<D:href>/marmoxdemo/balcony_sunglasses.jpg</D:href>\n<D:propstat>\n<D:prop>\n<ns1:title>Balcony Sunglasses</ns1:title>\n<ns3:access>\n\t\t\t\t<ns3:access>\n\t\t\t\t\t<ns3:CustomAccess>\n\t\t\t\t\t\t<ns3:rules>\n\t\t\t\t\t\t\t<ns2:List>\n\t\t\t\t\t\t\t\t<ns2:first>\n\t\t\t\t\t\t\t\t\t<ns3:AccessRule>\n\t\t\t\t\t\t\t\t\t\t<ns3:principal ns1:resource=\"mailto:*@*\"/>\n\t\t\t\t\t\t\t\t\t\t<ns3:allow>\n\t\t\t\t\t\t\t\t\t\t\t<ns3:ReadPermission/>\n\t\t\t\t\t\t\t\t\t\t</ns3:allow>\n\t\t\t\t\t\t\t\t\t\t<ns3:allow>\n\t\t\t\t\t\t\t\t\t\t\t<ns3:WritePermission/>\n\t\t\t\t\t\t\t\t\t\t</ns3:allow>\n\t\t\t\t\t\t\t\t\t</ns3:AccessRule>\n\t\t\t\t\t\t\t\t</ns2:first>\n\t\t\t\t\t\t\t\t<ns2:rest>\n\t\t\t\t\t\t\t\t\t<ns2:List ns1:about=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil\"/>\n\t\t\t\t\t\t\t\t</ns2:rest>\n\t\t\t\t\t\t\t</ns2:List>\n\t\t\t\t\t\t</ns3:rules>\n\t\t\t\t\t</ns3:CustomAccess>\n\t\t\t\t</ns3:access>\n\t\t\t</ns3:access>\n<lp1:resourcetype/>\n<lp1:creationdate>2007-03-17T20:39:47Z</lp1:creationdate>\n<lp1:getcontentlength>48077</lp1:getcontentlength>\n<lp1:getlastmodified>Sat, 17 Mar 2007 20:39:47 GMT</lp1:getlastmodified>\n<lp1:getetag>\"191019e-bbcd-5b5a6ac0\"</lp1:getetag>\n<lp2:executable>F</lp2:executable>\n<D:supportedlock>\n<D:lockentry>\n<D:lockscope><D:exclusive/></D:lockscope>\n<D:locktype><D:write/></D:locktype>\n</D:lockentry>\n<D:lockentry>\n<D:lockscope><D:shared/></D:lockscope>\n<D:locktype><D:write/></D:locktype>\n</D:lockentry>\n</D:supportedlock>\n<D:lockdiscovery/>\n<D:getcontenttype>image/jpeg</D:getcontenttype>\n</D:prop>\n<D:status>HTTP/1.1 200 OK</D:status>\n</D:propstat>\n</D:response>\n</D:multistatus>", "id": 100690, "time": "2007-03-20T11:59:09Z", "creator": "garret@globalmentor.com", "creation_time": "2007-03-20T11:59:09Z", "is_private": false}, {"count": 1, "tags": [], "creator": "garret@globalmentor.com", "attachment_id": null, "text": "Hmmm... so does no one care to look into a blocker bug that breaks proper\noperation of the most popular WebDAV server in the world?", "id": 100961, "time": "2007-03-26T06:53:07Z", "bug_id": 41908, "creation_time": "2007-03-26T06:53:07Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 41908, "is_private": false, "text": "Thanks for the repro case.  This is a little tricky to track down, please have a\nlittle patience.", "id": 100962, "time": "2007-03-26T08:10:56Z", "creator": "jorton@redhat.com", "creation_time": "2007-03-26T08:10:56Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 41908, "text": "Created attachment 19799\nfix for apr-util attribute namespace handling\n\ncd srclib/apr-util\npatch -p0 < /path/to/this/diff\n\nFun bug, this has existed since the beginning of time!", "id": 100971, "time": "2007-03-26T13:06:11Z", "creator": "jorton@redhat.com", "creation_time": "2007-03-26T13:06:11Z", "is_private": false, "attachment_id": 19799}, {"count": 4, "tags": [], "bug_id": 41908, "is_private": false, "text": "Thank you so much for addressing this, Joe. Essentially every mod_dav server out\nthere has been broken for the past seven years or so, huh? This apparently means\nthat no one is really using complex WebDAV properties with mod_dav. How long\nshould it be before this is bundled with an Apache httpd release?", "id": 100972, "time": "2007-03-26T13:13:42Z", "creator": "garret@globalmentor.com", "creation_time": "2007-03-26T13:13:42Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 41908, "is_private": false, "text": "Yes, the bug exists in the mod_dav 1.0.x releases too.  The bug is in the\nAPR-util library, so it will be pulled into a future httpd release once there is\na new APR-util release which includes the fix.  This is committed now to the\ntrunk, and also to the APR-util 1.2.x branch:\n\nhttp://svn.apache.org/viewvc?view=rev&rev=522630\nhttp://svn.apache.org/viewvc?view=rev&rev=522631\n\nFor the record: the repro case for this is actually slightly more complicated\nthan given; it's the fact that there is a stored namespace prefix for the\nresource (in this case http://purl.org/dc/elements/1.1/) which isn't actually\nused in the response.  And the ordering in which the namespace prefixes are\nstored matters too.\n\nAgain: thanks for the report.", "id": 100977, "time": "2007-03-26T14:38:20Z", "creator": "jorton@redhat.com", "creation_time": "2007-03-26T14:38:20Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 41908, "is_private": false, "text": "Woo hoo---it works! I've just verified that the provided patch fixes Apache\nhttpd mod_dav 2.2.4.\n\nNow, can you just turn on that auto-update push-patch feature that automatically\nupdates the current installed base of Apache-based WebDAV servers around the\nworld so that my client can work with them? :(\n\nBut thanks again for fixing this, Joe! (Hey, just another decade of propagation\nand I won't have to code special cases for IE6 anymore, either! ;) )", "id": 101237, "time": "2007-03-30T10:10:07Z", "creator": "garret@globalmentor.com", "creation_time": "2007-03-30T10:10:07Z", "attachment_id": null}]
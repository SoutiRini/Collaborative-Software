[{"count": 0, "tags": [], "bug_id": 8533, "attachment_id": null, "is_private": false, "id": 14777, "time": "2002-04-25T21:02:15Z", "creator": "slowhandz@netscape.net", "creation_time": "2002-04-25T21:02:15Z", "text": "Hello,\n\nI believe there is problem (bug?) with .htaccess\nin the new Apache for Windows:\n\nApache 2.0.35 [3.1M] - 09-Apr-2002 - MSI Installer Package\nhttp://www.apache.org/dist/httpd/binaries/win32/apache_2.0.35-win32-x86-\nno_ssl.msi\n\nI installed into C:\\Apache2\n(I still have Apache 1.3.22 in C:\\Apache).\n\nI have a .htaccess file in DocumentRoot:  C:\\Apache2\\htdocs\\.htaccess\n\nthat looks as follows:\n\n  Options -Indexes\n  ErrorDocument 401 /error/401.php\n  ErrorDocument 403 /error/403.php\n  ErrorDocument 404 /error/404.php\n  ErrorDocument 500 /error/500.php\n\n-----------------------------------------------------------------------\n\nMy httpd.conf (just the stuff pertaining to htaccess and errors):\n\nDocumentRoot \"C:/Apache2/htdocs\"\n\n<Directory \"C:/Apache2/htdocs\">\nOptions Indexes FollowSymLinks Multiviews Includes ExecCGI\nAllowOverride AuthConfig FileInfo Options Limit\nOrder allow,deny\nAllow from all\n</Directory>\n\nAccessFileName .htaccess\n\n<Files ~ \"^\\.ht\">\n    Order allow,deny\n    Deny from all\n    Satisfy All\n</Files>\n\nand since I declare my ErrorDocument files within the\n.htaccess in DocumentRoot, I commented out ALL references\nto the following in httpd.conf:\n\n#<IfModule mod_negotiation.c>\n#<IfModule mod_include.c>\n#    Alias /error/ \"C:/Apache2/error/\"\n\n#    <Directory \"C:/Apache2/error\">\n#        AllowOverride None\n#        Options IncludesNoExec\n#        AddOutputFilter Includes html\n#        AddHandler type-map var\n#        Order allow,deny\n#        Allow from all\n#        LanguagePriority en es de fr\n#        ForceLanguagePriority Prefer Fallback\n#    </Directory>\n\n#    ErrorDocument 400 /error/HTTP_BAD_REQUEST.html.var\n#    ErrorDocument 401 /error/HTTP_UNAUTHORIZED.html.var\n#    ErrorDocument 403 /error/HTTP_FORBIDDEN.html.var\n#    ErrorDocument 404 /error/HTTP_NOT_FOUND.html.var\n#    ErrorDocument 405 /error/HTTP_METHOD_NOT_ALLOWED.html.var\n#    ErrorDocument 408 /error/HTTP_REQUEST_TIME_OUT.html.var\n#    ErrorDocument 410 /error/HTTP_GONE.html.var\n#    ErrorDocument 411 /error/HTTP_LENGTH_REQUIRED.html.var\n#    ErrorDocument 412 /error/HTTP_PRECONDITION_FAILED.html.var\n#    ErrorDocument 413 /error/HTTP_REQUEST_ENTITY_TOO_LARGE.html.var\n#    ErrorDocument 414 /error/HTTP_REQUEST_URI_TOO_LARGE.html.var\n#    ErrorDocument 415 /error/HTTP_SERVICE_UNAVAILABLE.html.var\n#    ErrorDocument 500 /error/HTTP_INTERNAL_SERVER_ERROR.html.var\n#    ErrorDocument 501 /error/HTTP_NOT_IMPLEMENTED.html.var\n#    ErrorDocument 502 /error/HTTP_BAD_GATEWAY.html.var\n#    ErrorDocument 503 /error/HTTP_SERVICE_UNAVAILABLE.html.var\n#    ErrorDocument 506 /error/HTTP_VARIANT_ALSO_VARIES.html.var\n\n#</IfModule>\n#</IfModule>\n\n----------------------------------------------------------------------\n\nOK, here is the problem:\n\nI have OTHER .htaccess files in other directories\nused for User Authentication:\n\ni.e.  C:\\Apache2\\htdocs\\protected\\.htaccess\n\nAuthUserFile \"C:/Apache2/mydata/.htpasswd\"\nAuthName \"Administration Area\"\nAuthType Basic\nrequire valid-user\n\nWhen I try to access this directory:\nhttp://localhost/protected/\n\nI SHOULD be getting a login prompt\n(WHICH IS WHAT HAPPENS IN APACHE 1.3.22).\n\nIn Apache 2.0.35, I get routed to:\nhttp://localhost/error/401.php\n\nWHICH IS 401 - AUTHORIZATION REQUIRED!!.\n\nI HAVEN'T BEEN PROMPTED FOR A PASSWORD YET!?\nThis should only happen *AFTER* I enter a\nWRONG USERNAME or PASSWORD !!!\n\nIn effect, the .htaccess file I have in DocumentRoot\nis overiding all other .htaccess files??\n\nWhen I REMOVE the .htaccess file out of DocumentRoot,\nI then get the login prompts for all\n.htaccess protected directories!! \n\nLet me repeat... this works fine in Apache 1.3.22,\nwith the .htaccess file in root containing the\nErrorDocument directives...\n\nThe only difference between the 2 installs is the\nAuthUserFile paths in the .htaccess directives:\n(which is of course required)\n\nAuthUserFile \"C:/Apache2/mydata/.htpasswd\"\nvs.\nAuthUserFile \"C:/Apache/mydata/.htpasswd\"\n\n\nIs there some NEW way of declaring the ErrorDocument\ndirectives WITHIN a .htaccess file in Apache 2.0.35?\n\nThis problem is certainly reproducible...\nwhether it's a bug or not... ?\n\nSteve"}, {"count": 1, "tags": [], "text": "I'm almost sure that this is a PHP problem.  Please try changing the \nErrorDocument 401\nto point to a regular html file.  I'd guess the authentication will then work\nfine.\n\nThe problem is that it is the responsibility of the 401 ErrorDocument to deliver\nthe 401 status code to the client.  Only in this way does the client know to\nprompt for a password.\n\nYou don't mention how you have configured PHP, but either you have done it\nincorrectly, or you have uncovered a bug in PHP.  Either way, this is not the\ncorrect place to address this problem.\n\nThanks for using Apache.", "is_private": false, "bug_id": 8533, "id": 14787, "time": "2002-04-25T21:38:43Z", "creator": "slive@apache.org", "creation_time": "2002-04-25T21:38:43Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Hi,\n\nI use Tomcat 4.0.3, NT/win2k, JDK 1.3.1_01, Oracle 8.1.6. I declared JDBCRealm \n(see config file below). If the database is down when Tomcat starts I get a \nLifecycleException (see stack trace below). After that, Tomcat accepts incoming \nHTTP connections but never sends any response - a kind of \"zombie\" state.\nFYI: I have two applications - one standard web app using servlet declarative \nsecurity with form-based login and WebDav servlet using servlet security with \nBasic authentication.\n\nBest Regards,\nSlawek Zachcial\n\n*** exception stack trace ***\n\nUsing CATALINA_BASE:   d:\\opt\\servers\\jakarta-tomcat-4.0.3\nUsing CATALINA_HOME:   d:\\opt\\servers\\jakarta-tomcat-4.0.3\nUsing CATALINA_TMPDIR: d:\\opt\\servers\\jakarta-tomcat-4.0.3\\temp\nUsing JAVA_HOME:       d:\\opt\\java\\j2se\\1.3.1_01\nStarting service Tomcat-Standalone\nApache Tomcat/4.0.3\nCatalina.start: LifecycleException:  Exception opening database connection:  \njava.sql.SQLException:\nException d'E/S: The Network Adapter could not establish the connection\nLifecycleException:  Exception opening database connection:  \njava.sql.SQLException: Exception d'E/S:\n The Network Adapter could not establish the connection\n        at org.apache.catalina.realm.JDBCRealm.start(JDBCRealm.java:615)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1108)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:343)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:388)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:506)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:781)\n        at org.apache.catalina.startup.Catalina.execute(Catalina.java:681)\n        at org.apache.catalina.startup.Catalina.process(Catalina.java:179)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)\n----- Root Cause -----\njava.sql.SQLException: Exception d'E/S: The Network Adapter could not establish \nthe connection\n        at oracle.jdbc.dbaccess.DBError.throwSqlException(DBError.java:114)\n        at oracle.jdbc.dbaccess.DBError.throwSqlException(DBError.java:156)\n        at oracle.jdbc.dbaccess.DBError.throwSqlException(DBError.java:269)\n        at oracle.jdbc.driver.OracleConnection.<init>(OracleConnection.java:210)\n        at oracle.jdbc.driver.OracleDriver.getConnectionInstance\n(OracleDriver.java:251)\n        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:224)\n        at org.apache.catalina.realm.JDBCRealm.open(JDBCRealm.java:548)\n        at org.apache.catalina.realm.JDBCRealm.start(JDBCRealm.java:613)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1108)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:343)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:388)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:506)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:781)\n        at org.apache.catalina.startup.Catalina.execute(Catalina.java:681)\n        at org.apache.catalina.startup.Catalina.process(Catalina.java:179)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)\n\n*** server.xml ***\n\n<Server port=\"8005\" shutdown=\"SHUTDOWN\" debug=\"0\">\n\n  <Service name=\"Tomcat-Standalone\">\n\n\n    <Connector className=\"org.apache.catalina.connector.http.HttpConnector\"\n               port=\"8080\" minProcessors=\"5\" maxProcessors=\"75\"\n               enableLookups=\"true\" redirectPort=\"8443\"\n               acceptCount=\"10\" debug=\"5\" connectionTimeout=\"60000\"/>\n\n    <Engine name=\"Standalone\" defaultHost=\"localhost\" debug=\"0\">\n\n      <Logger className=\"org.apache.catalina.logger.FileLogger\"\n              prefix=\"catalina_log.\" suffix=\".txt\"\n              timestamp=\"true\"/>\n\n\n      <Realm className=\"org.apache.catalina.realm.MemoryRealm\" />\n\n      <Realm  className=\"org.apache.catalina.realm.JDBCRealm\" debug=\"99\"\n              driverName=\"oracle.jdbc.driver.OracleDriver\"\n              connectionName=\"clmmdev\"\n              connectionPassword=\"clmmdev\"\n              connectionURL=\"jdbc:oracle:thin:@localhost:1521:oradev\"\n              userTable=\"clmm_user\" \n              userNameCol=\"user_name\" \n              userCredCol=\"password\"\n              userRoleTable=\"clmm_user_role\" \n              roleNameCol=\"role_name\" />\n\n      <Host name=\"localhost\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"true\">\n\n        <Valve className=\"org.apache.catalina.valves.AccessLogValve\"\n                 directory=\"logs\"  prefix=\"localhost_access_log.\" suffix=\".txt\"\n                 pattern=\"common\"/>\n\n        <Logger className=\"org.apache.catalina.logger.FileLogger\"\n                 directory=\"logs\"  prefix=\"localhost_log.\" suffix=\".txt\"\n\t        timestamp=\"true\"/>\n\n\n        <Context path=\"/manager\" docBase=\"manager\" \n         debug=\"0\" privileged=\"true\"/>\n\n        <Context path=\"/tomcat\" \n                 docBase=\"d:/opt/servers/jakarta-tomcat-4.0.1/webapps/tomcat-\ndocs\" \n                 reloadable=\"false\" />\n\n        <Context path=\"/security\"\n                 docBase=\"d:/home/slawek/dev/servlet-security\"\n                 reloadable=\"true\" />\n\n\n        <Context path=\"\" \n                 docBase=\"d:/home/hp/projects/clm-metrics/build/clm-\nmetrics/website\"\n                 reloadable=\"true\"\n                 useNaming=\"false\">\n        </Context>\n        \n        <Context path=\"/clmm-web-dir\"\n                 docBase=\"d:/home/hp/projects/clm-metrics/build/clm-metrics\"\n                 reloadable=\"true\" />\n\n      </Host>\n\n    </Engine>\n\n  </Service>\n\n</Server>", "is_private": false, "bug_id": 8091, "id": 13593, "time": "2002-04-15T08:14:37Z", "creator": "slawomir_zachcial@hp.com", "creation_time": "2002-04-15T08:14:37Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 8091, "is_private": false, "id": 13595, "attachment_id": null, "creator": "remm@apache.org", "creation_time": "2002-04-15T08:19:08Z", "time": "2002-04-15T08:19:08Z", "text": "If the realm or a major component of Tomcat does not start successfully, Tomcat \nshouldn't be doing anything (other than reporting the error). In this partcular \ncase, accepting to run anyway would lead to security problems."}, {"count": 2, "attachment_id": null, "bug_id": 8091, "text": "So in this case I think that Tomcat should print error message and exit, but \nnot accept connections anyway and never send any (even error) response.", "id": 13598, "time": "2002-04-15T08:37:25Z", "creator": "slawomir_zachcial@hp.com", "creation_time": "2002-04-15T08:37:25Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 8091, "text": "I actually forgot to reopen the bug :-(\n\nThe proposed solution is to do nothing. However, if the realm doesn't start \ncorrectly the Tomcat server is unusable - it accepts incoming connections and \nnever sends any response. Give it a try and you'll see how annoying it is!.\n\nI think that, if JDBCRealm is so critical component (what about the deployed \napplications that don't use any security ???), Tomcat should print the error \nmessage and EXIT. \n\nHowever, it seems to me that it should be possible to start Tomcat without \nJDBCRealm running properly (if db connection cannot be established) - when a \nsecurity check is necessary then retry the connection - it may be back :-).\n\nCheers,\nSlawek Zachcial", "id": 13655, "time": "2002-04-15T16:24:40Z", "creator": "slawomir_zachcial@hp.com", "creation_time": "2002-04-15T16:24:40Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 8091, "is_private": false, "id": 13656, "time": "2002-04-15T16:32:43Z", "creator": "remm@apache.org", "creation_time": "2002-04-15T16:32:43Z", "tags": [], "text": "If you really want to have it fixed, I'll be waiting for your patch :-) (I \nsuppose I should have left the bug open, sorry; I just meant: *I* won't fix it, \nas I don't condider it an issue)\nThis is a cosmetic issue, so I'm reclassifying as minor."}, {"count": 5, "tags": [], "text": "For the interest of security - I am marking as WONTFIX since the unavailability\nof the Realm could expose a security issue and the safe thing is to not start. ", "is_private": false, "bug_id": 8091, "id": 43288, "time": "2003-08-25T23:51:14Z", "creator": "funkman@joedog.org", "creation_time": "2003-08-25T23:51:14Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Reopened since my reasoning didn't make sense and the patch seems easy enough", "is_private": false, "bug_id": 8091, "id": 43291, "time": "2003-08-26T00:08:50Z", "creator": "funkman@joedog.org", "creation_time": "2003-08-26T00:08:50Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 8091, "text": "Fixed for tomcat5 - please confirm with HEAD of tomcat 5 (or when 5.0.10 is\navailable). Upon confirmation - will backport to tomcat 4.1 Will not port to\ntomcat 4.0.\n", "count": 7, "id": 43300, "time": "2003-08-26T01:16:35Z", "creator": "funkman@joedog.org", "creation_time": "2003-08-26T01:16:35Z", "is_private": false}]
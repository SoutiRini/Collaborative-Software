[{"count": 0, "tags": [], "bug_id": 21290, "attachment_id": null, "id": 39889, "time": "2003-07-02T20:05:58Z", "creator": "ksnider@flarn.com", "creation_time": "2003-07-02T20:05:58Z", "is_private": false, "text": "on a server running httpd for nearly two weeks, We noticed the following error\nappear, first sporadically, then consistently, until the point arrived that all\nhttps clients failed to connect with a \"MAC translation failure\" message.\n\nRestarting the server corrected the issue.\n\nWe are running httpd 2.0.40 (with backported security patches), openssl 0.9.6b\n(also, with backported security patches), and have httpd configured for worker\nMPM, 1 worker, 200 threads, and dbm for the ssl session cache.\n\nError logs follow:\n\n[Fri Jun 27 18:00:09 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 141.154.205.3)\n[Fri Jun 27 18:00:09 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 19:48:16 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 64.33.177.242)\n[Fri Jun 27 19:48:16 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 19:48:53 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 160.111.120.2)\n[Fri Jun 27 19:48:53 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 19:53:44 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 64.65.216.172)\n[Fri Jun 27 19:53:44 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:31:26 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 63.72.202.66)\n[Fri Jun 27 20:31:26 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:35 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 207.61.129.99)\n[Fri Jun 27 20:39:35 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:37 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 64.122.37.177)\n[Fri Jun 27 20:39:37 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:41 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 129.44.61.133)\n[Fri Jun 27 20:39:41 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:42 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 129.44.61.133)\n[Fri Jun 27 20:39:42 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:43 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 207.188.170.74)\n[Fri Jun 27 20:39:43 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:46 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 64.122.37.177)\n[Fri Jun 27 20:39:46 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:48 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 24.184.184.70)\n[Fri Jun 27 20:39:48 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:55 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 136.166.2.82)\n[Fri Jun 27 20:39:55 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:39:59 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 66.12.123.116)\n[Fri Jun 27 20:39:59 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:40:01 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 165.247.190.52)\n[Fri Jun 27 20:40:01 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:40:02 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 165.247.190.52)\n[Fri Jun 27 20:40:02 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:40:02 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 64.167.149.43)\n[Fri Jun 27 20:40:02 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:40:05 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 136.166.2.82)\n[Fri Jun 27 20:40:05 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:40:06 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 65.214.41.68)\n[Fri Jun 27 20:40:06 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)\n[Fri Jun 27 20:40:12 2003] [error] SSL handshake failed (server\nvxn.datawire.net:443, client 207.21.34.180)\n[Fri Jun 27 20:40:12 2003] [error] SSL Library Error: 336131157\nerror:1408F455:lib(20):func(143):reason(1109)"}, {"count": 1, "tags": [], "bug_id": 21290, "attachment_id": null, "text": "Further information:\n\nOn investigation, it does appear that this problem is *not* sudden - restarting\napache leads to the problem re-occuring after a period of hours, then becomes\nprogressively worse.\n\nIt's as if each worker thread is somehow ending up in an \"inconsistent\" state,\nand from that point on, failing on connects. As we have 200 threads running on\nthese high-volume servers, it takes some time for enough threads to be adversely\naffected to actually trip our monitoring system.\n\nAlso, since these errors *do* occur sporadically, but I can't seem to catch the\nerror itself until it reaches \"critical mass\", there's also a possiblity that\napache is somehow masking the problem until it exceeds its' ability to do so,\nperhaps?", "id": 40172, "time": "2003-07-08T14:32:03Z", "creator": "ksnider@flarn.com", "creation_time": "2003-07-08T14:32:03Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 21290, "text": "Yet more information.\n\nIt turns out the \"RSA Blinding\" patch for openssl is the culprit. It isn't\nthreadsafe, and while this works for apache w/prefork, worker, being\nmultithreaded, will display this issue under load.\n\nAs a point of note, Red Hat 7-9 incorporate this patch. This means the worker\nmpm (or any other threaded mpm) WILL FAIL UNDER LOAD at this point. This is true\nof anyone else using the RSA Blinding patch from Bugtraq.\n\nI'm closing this bug as INVALID since the bug isn't with apache. However, I\nthink this is something that should be noted somewhere, since this has the\npotential to affect virtually anoyone using SSL, apache 2, and the worker MPM.", "id": 40290, "time": "2003-07-09T19:21:49Z", "creator": "ksnider@flarn.com", "creation_time": "2003-07-09T19:21:49Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 21290, "text": "Thanks for bringing that to our attention anyway... no doubt others will report the \nsame problem.  FWIW, the thread-safety problem with RSA blinding was fixed by Bodo \nMoeller in OpenSSL 0.9.6j and 0.9.7b, released in April. \n \nThanks, \nCliff ", "id": 40291, "time": "2003-07-09T20:07:52Z", "creator": "jwoolley@apache.org", "creation_time": "2003-07-09T20:07:52Z", "is_private": false, "attachment_id": null}]
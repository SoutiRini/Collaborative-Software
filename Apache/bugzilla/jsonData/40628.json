[{"count": 0, "tags": [], "bug_id": 40628, "text": "Every ISAPI returns status 500 \"internal server error\" and it returns the \ndesired content. No real error has occurred.\n\nI could trace it back to: (Source taken from httpd-2.2.3 win32 version)\n\nmod_apache.c line 713: function apr_ssize_t send_response_header\n\nCid->r->status = ap_scan_script_header_err_strs(cid->r, NULL,\n                                   &termch, &termarg, stat, head, NULL);\ncid->ecb->dwHttpStatusCode = cid->r->status;\n\nTermarg = 2\nStat = \"Status: 200 OK\"\nHead\t= \"Content-Type: text/html\\r\\nContent-Length: 22\\r\\n\\r\\n\"\n\nRetun value is 0. Should be 200.\n\n\n\nutil_script.c line 714: function ap_scan_script_header_err_strs\n\nres = ap_scan_script_header_err_core(r, buffer, getsfunc_STRING, \n                                                           (void *) &strs);\n\nReturn value is 0. Should be 200.\n\n\n\nAfter successfull execution of function ap_scan_script_header_err_core\nutil_script.c line 599: function ap_scan_script_header_err_core\n\nreturn OK;\n\n\nOK is defined in httpd.h\nhttpd.h line 445:\n\n#define OK 0\t\t\t/**< Module has handled this stage. */\n\nHTTP_OK is defined in httpd.h\nhttpd.h line 462:\n\n#define HTTP_OK                            200\n\n\nSolution:\nThe return OK; in util_script.c line 599 should be replaced with return HTTP_OK;\nThe other possible return in ap_scan_script_header_err_core is \nHTTP_INTERNAL_SERVER_ERROR which is the value 500. (that shows HTTP_ results \nare required in the function.)\n\nBecause the return value is 0 mod_apache reads the client content. Later return \nvalue 0 is recognized as invalid and it reports an internal server error.", "id": 94214, "time": "2006-09-28T10:09:58Z", "creator": "rick@onlinegroep.nl", "creation_time": "2006-09-28T10:09:58Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rick@onlinegroep.nl", "attachment_id": 18929, "text": "Created attachment 18929\nCorrected return value of funtion line 599 ap_scan_script_header_err_core\n\nCorrected return value of funtion line 599 ap_scan_script_header_err_core\nOriginal value was OK new value is HTTP_OK\nThis solves the ISAPI bug.", "id": 94216, "time": "2006-09-28T10:20:16Z", "bug_id": 40628, "creation_time": "2006-09-28T10:20:16Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 40628, "text": "That's not a patch.  It's plain source code, and not in a form suitable for \nreview.\n\nIn any case, you can't just go breaking util_script, which is required by \n*everything* in the CGI family, not just mod_isapi.  There *may* be a bug in \nmod_isapi, but you should check the latest fixes to that, particularly\nhttp://svn.apache.org/viewvc/httpd/httpd/trunk/modules/arch/win32/mod_isapi.c?r1=414238&r2=416272\n", "id": 94219, "time": "2006-09-28T10:47:00Z", "creator": "nick@webthing.com", "creation_time": "2006-09-28T10:47:00Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "rick@onlinegroep.nl", "attachment_id": null, "text": "http://svn.apache.org/viewvc/httpd/httpd/trunk/modules/arch/win32/mod_isapi.c?\nr1=414238&r2=416272\nIs indeed the solution.\nThank you.", "id": 94225, "time": "2006-09-28T12:06:57Z", "bug_id": 40628, "creation_time": "2006-09-28T12:06:57Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 40628, "attachment_id": null, "id": 94244, "time": "2006-09-28T17:48:21Z", "creator": "wrowe@apache.org", "creation_time": "2006-09-28T17:48:21Z", "is_private": false, "text": "Also don't go changing AssignedTo *EVER*.  You broke the linkage for all the\nfeedback to come to the bugs list."}, {"count": 5, "tags": [], "bug_id": 40628, "text": "\n\n*** This bug has been marked as a duplicate of 40067 ***", "id": 94246, "time": "2006-09-28T18:24:44Z", "creator": "wrowe@apache.org", "creation_time": "2006-09-28T18:24:44Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "kabe@sra-tohoku.co.jp", "text": "When allowing Options in <Directory>, and setting Options in the .htaccess, server complains that Options isn't allowed.  This bug seems to be around since the AllowOverrideOpt patch BugID#29310: http://issues.apache.org/bugzilla/show_bug.cgi?id=29310  Patch follows which fixes the problem, but AllowOverride concerns security; through audit around handling of opts->override, opts->override_opts requested.  ==== Example:   httpd.conf: <Directory /usr/local/www> \tAllowOverride All </Directory>  /usr/local/www/.htaccess: Options +ExecCGI  error_log output: [Sun Jun 12 03:38:23 2005] [alert] [client ::1] /usr/local/www/.htaccess: Option ExecCGI not allowed here   ==== PATCH: diff -aru httpd-2.1.3-beta.orig/server/request.c httpd-2.1.3-beta/server/request.c --- httpd-2.1.3-beta.orig/server/request.c\tFri Feb 11 21:00:41 2005 +++ httpd-2.1.3-beta/server/request.c\tSun Jun 12 06:10:35 2005 @@ -443,10 +443,26 @@          opts->remove = this_dir->opts_remove;      }   +#if 0      if (!(this_dir->override & OR_UNSET)) {          opts->override = this_dir->override;      }      if (!(this_dir->override_opts & OR_UNSET)) { +/* this is wrong; + * 1) ->override_opts will take OPT_* masks, not OR_* + * 2) Resetting current ->override_opts (effective AllowOverride Options=....) + *    should occur when AllowOveride (both w or w/o Options) was specified  + *    for this dir. + *    Not saying Options in AllowOverride shouldn't mean to  + *    preserve and propagate the Options= setting. + * Because of this, \"<Directory>AllowOverride All\" still says + * Options in .htaccess not allowed. + */ +        opts->override_opts = this_dir->override_opts; +    } +#endif +    if (!(this_dir->override & OR_UNSET)) { +        opts->override = this_dir->override;          opts->override_opts = this_dir->override_opts;      }  }", "id": 76309, "time": "2005-06-11T23:51:35Z", "bug_id": 35329, "creation_time": "2005-06-11T23:51:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "kabe@sra-tohoku.co.jp", "attachment_id": null, "id": 76311, "time": "2005-06-12T00:16:55Z", "bug_id": 35329, "creation_time": "2005-06-12T00:16:55Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 35330 ***"}]
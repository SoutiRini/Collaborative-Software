[{"count": 0, "text": "The JUnit task used with fork=\"true\", forkMode=\"perBatch\" and a timeout (which expires) incorrectly shows the last test was started in the summary log. This leads to a Wild Goose chase trying to identify why the tests timed out!\n\n* Steps to reproduce\n\nCreate a source folder with 4 tests classes in the package 'tests':\n\n  ATest, BTest, CTest, DTest\n\nJUnit will run the tests in the given order. Test classes A, C and D contain a single *empty* test method. Test class B contains a single test method that sleeps *forever*. Configure the JUnit task as follows:\n\n  <junit fork=\"true\" forkMode=\"perBatch\" timeout=\"5000\" printsummary=\"yes\">\n    <batchtest>\n      <fileset dir=\"build\">\n        <include name=\"**/*Test.class\" />\n      </fileset>\n    </batchtest>\n  </junit>\n\nThe JUnit task will log:\n\n1.  [junit] Running tests.ATest\n2.  [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.125 sec\n3.  [junit] Running tests.BTest\n4.  [junit] Running tests.DTest\n5.  [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0 sec\n6.  [junit] Tests FAILED (timeout)\n\nLine 3 shows test B is run. The test will sleep forever after this point. A spurious \"Running tests.DTest\" is printed on line (4) before the 'timeout' line is printed.\n\nThe offending code is in JUnitTask. #executeAsForked() in invoked with the *last* test in the batch from execute(List). This test is passed to logTimeout() when the timeout occurs and finally into logVmExit() where it is just logged. Its not clear why this is done when we are operating in batchTest mode?", "bug_id": 45227, "attachment_id": null, "id": 117785, "time": "2008-06-18T02:36:06Z", "creator": "ben.rowlands@morganstanley.com", "creation_time": "2008-06-18T02:36:06Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 45227, "attachment_id": null, "id": 119607, "time": "2008-08-08T06:50:58Z", "creator": "bodewig@apache.org", "creation_time": "2008-08-08T06:50:58Z", "is_private": false, "text": "confirmed, see disabled testcase in svn revision 683965"}, {"count": 2, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "OK, this issue is tricky since Ant doesn't know how much information has already been logged by some formatters (and it doesn't know which test caused the timeout either).\n\nI've modified the log output, you'd now get\n\n[junit] Running tests.ATest\n[junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.125 sec\n[junit] Running tests.BTest\n[junit] Running tests.Batch-With-Multiple-Tests\n[junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0 sec\n[junit] Tests FAILED (timeout)\n\nRight now I don't see anything better we could do (short of changing the formatter infrastructure).\n\nsvn revision 684745", "id": 119682, "time": "2008-08-11T06:51:47Z", "bug_id": 45227, "creation_time": "2008-08-11T06:51:47Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 45227, "text": "The fix, below, only tales the first part of the package name. For instance if my package is org.apache.junit.tests.MyTest, the output displayed will be \n\n[junit] Running org.Batch-With-Multiple-Tests\n[junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0 sec\n[junit] Tests FAILED (timeout)\n\nAnd thus still leads to a wild-goose chase. Much better solution is to find tha last \".\" in the test name so the real package can be displayed.\n\n\nprivate static JUnitTest createDummyTestForBatchTest(JUnitTest test) {\n    JUnitTest t = (JUnitTest) test.clone();\n    int index = test.getName().indexOf(\".\");\n    // make sure test looks as if it was in the same \"package\" as\n    // the last test of the batch\n    String pack = index > 0 ? test.getName().substring(0, index + 1) : \"\";\n    t.setName(pack + NAME_OF_DUMMY_TEST);\n    return t;\n}", "id": 140517, "time": "2010-10-06T13:51:11Z", "creator": "ikronkvist@yahoo.com", "creation_time": "2010-10-06T13:51:11Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "the logic of determining the package name was obviously broken in 1.8.0 and 1.8.1.\n\nfixed with svn revision 1027142", "id": 141000, "time": "2010-10-25T10:35:41Z", "bug_id": 45227, "creation_time": "2010-10-25T10:35:41Z", "is_private": false}]
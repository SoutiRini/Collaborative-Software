[{"count": 0, "tags": [], "bug_id": 49599, "text": "Created attachment 25765\nTest class to show this issue\n\nWhen I setAuthor() for Comment with some Chinese characters, these Chinese characters will transformed to ? when open the file in Microsoft Excel.\n\nPlease see the attachment.\n\nMy environment: \n- JDK 6 Update 21 \n- POI 3.7 Beta 1 \n- Windows XP Professional (Simplified Chinese) SP3 \n- Microsoft Office Excel 2003 (11.8324.8324) SP3 \n\nfor more details, please visit this thread:\nhttp://old.nabble.com/charset-encoding-of-Comment.setAuthor%28%29-ts29115649.html", "id": 138451, "time": "2010-07-16T04:19:00Z", "creator": "lovetide@qq.com", "creation_time": "2010-07-16T04:19:00Z", "is_private": false, "attachment_id": 25765}, {"count": 1, "tags": [], "bug_id": 49599, "attachment_id": null, "id": 138458, "time": "2010-07-16T07:54:44Z", "creator": "andrejohn.mas@gmail.com", "creation_time": "2010-07-16T07:54:44Z", "is_private": false, "text": "Just to sum up the thread:\n\nThe serialize() method in org.apache.poi.hssf.record.NoteRecord is not calling the StringUtil.putUnicodeLE() method, because the field_5_hasMultibyte instance variable is false, even when the author field contains double-byte characters. In fact other than when a file is read field_5_hasMultibyte is never set to true.\n\nTwo possible solutions:\n - add logic to work out if we have non-latin characters, since the issue is not just affecting double-byte characters\n - set the field_5_hasMultibyte variable to be true and always write out unicode characters, unless there is a usage scenario this could break.\n\nI tested on MacOS X 10.6.4 and used Excel 2008 to see the result. Changing the variable to true resulted in Chinese text to appear correctly for the author.\n\nBTW We should probably be extending the unit tests for ensuring non-latin characters are getting stored properly."}, {"count": 2, "tags": [], "bug_id": 49599, "attachment_id": 25768, "id": 138460, "time": "2010-07-16T09:22:09Z", "creator": "andrejohn.mas@gmail.com", "creation_time": "2010-07-16T09:22:09Z", "is_private": false, "text": "Created attachment 25768\nPatch test for unicode on setAuthor()\n\nAdded patch that tests for unicode on setAuthor()"}, {"count": 3, "tags": [], "bug_id": 49599, "text": "Created attachment 25769\nPatch for defaulting to multi-byte\n\nPatch for defaulting to multi-byte", "id": 138461, "time": "2010-07-16T09:22:54Z", "creator": "andrejohn.mas@gmail.com", "creation_time": "2010-07-16T09:22:54Z", "is_private": false, "attachment_id": 25769}, {"attachment_id": null, "tags": [], "bug_id": 49599, "text": "Thanks for investigating this\n\nThe usual way in most records is to update the multibyte flag when updating the string\n\nI'll make this change, and write a unit test for it shortly", "count": 4, "id": 138465, "time": "2010-07-16T09:44:03Z", "creator": "apache@gagravarr.org", "creation_time": "2010-07-16T09:44:03Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 49599, "attachment_id": null, "id": 138467, "creation_time": "2010-07-16T09:58:45Z", "time": "2010-07-16T09:58:45Z", "creator": "apache@gagravarr.org", "text": "Fixed in r964800, along with a unit test. Thanks for your investigations and patch!", "is_private": false}]
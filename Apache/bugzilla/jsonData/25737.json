[{"count": 0, "tags": [], "bug_id": 25737, "attachment_id": null, "text": "Form based Realm authentication will fail 50% of the time in a clustered \nTomcat.  It fails with the HTTP 400 status code \"Invalid direct reference \nto...\" error (it's not, I assure you).  My first inclination was that \nsomething that required serialization wasn't implementing Serializable.  This \nproved to be true (I believe SavedRequest.java needs to be serializable), but \nwasn't the only problem.  I'm attempting to debug and fix this (downloaded the \nsource).  If you guys have beat me to it, I'd love an email at leat telling me \nwhere I can pick up the fixed code.", "id": 49647, "time": "2003-12-23T22:44:53Z", "creator": "KMcTiernan@concordefs.com", "creation_time": "2003-12-23T22:44:53Z", "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "text": "You should post on tomcat-user first.\nThere's likely no bug: clustering still requires sticky sessions, as per the\nServlet specification. You don't seem to be aware of that requirement (which\nwill make FORM work).", "id": 49657, "time": "2003-12-24T05:59:41Z", "bug_id": 25737, "creation_time": "2003-12-24T05:59:41Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "KMcTiernan@concordefs.com", "text": "I am aware of the servlet spec. requirements.  That's not the issue.  The user \nlogs out/in/out/in.  Session is invalidated and set to null on each log out.  \nThis is when the problem occurs.  There should be no session associated with the \nuser at that point, but I think the Tomcat server is unaware of this.  Also, \nthe failure can occur on the first access (again, no session). I'm using mod_jk \nas a load balancer, which by default is supposed to be sticky sessions (but, \nagain, shouldn't be the issue, since the user is logged out).  My \nworkers.properties is below, and follows  the spec. exactly for load-balanced \nworkers.  Also, my logout.jsp, which is pretty standard.  Am I missing something \nhere?  I think this is a bug.  Oh, and there's no info anywhere on clustered \nTomcat with form based authentication.  I think we might be one of the first to \ntry to use it?\n\nlogout.jsp:\n\n<%\n    if (request.getRemoteUser() != null)\n    {\n        session.invalidate();\n\t  session = null;\n        response.sendRedirect(request.getContextPath()+\"/index.jsp\");\n        return;\n    }\n%> \n\nworkers.properties:\n\nworker.list=worker1\n\n# Now define the load balanced workers\n# Define as many as you need depending on server load\n# Duplicate the blocks below and add the \"wN\" to the \n# balanced_workers list\nworker.w1.type=ajp13 \nworker.w1.host=localhost \nworker.w1.port=8009 \nworker.w1.lbfactor=50 \n\nworker.w2.type=ajp13 \nworker.w2.host=localhost \nworker.w2.port=8009 \nworker.w2.lbfactor=50 \n\nworker.w3.type=ajp13 \nworker.w3.host=localhost \nworker.w3.port=8009 \nworker.w3.lbfactor=50 \n\nworker.w4.type=ajp13 \nworker.w4.host=localhost \nworker.w4.port=9009 \nworker.w4.lbfactor=50 \n\n", "id": 49673, "time": "2003-12-24T16:36:47Z", "bug_id": 25737, "creation_time": "2003-12-24T16:36:47Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "remm@apache.org", "text": "Please, please post on tomcat-user. BZ is not a support forum. Likely, sticky\nsessions don't work in your setup (likely no matching jvmRoute attributes on the\nEngines).", "id": 49691, "time": "2003-12-25T09:03:18Z", "bug_id": 25737, "creation_time": "2003-12-25T09:03:18Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 25737, "attachment_id": null, "id": 58410, "time": "2004-05-30T16:41:42Z", "creator": "fhanik@apache.org", "creation_time": "2004-05-30T16:41:42Z", "is_private": false, "text": "The clustering code is not saving the notes for redirect references.\n"}]
[{"count": 0, "tags": [], "creator": "nicholas@nicholaswilliams.net", "attachment_id": null, "id": 166004, "time": "2013-03-19T17:31:44Z", "bug_id": 54726, "creation_time": "2013-03-19T17:31:44Z", "is_private": false, "text": "In the latest tomcat-embed-core snapshot artifact [1] is missing META-INF/services resources for the WebSocket implementation. The following files are in the tomcat-websocket.jar in the standard Tomcat build:\n\nMETA-INF/services/javax.servlet.ServletContainerInitializer\nMETA-INF/services/javax.websocket.ContainerProvider\nMETA-INF/services/javax.websocket.server.ServerContainerProvider\nMETA-INF/services/javax.websocket.server.ServerEndpointConfig.Configurator\n\nBut they do not appear in the embed artifact. As such, when the embedded Tomcat starts, it does not initialize the WebSocket container.\n\n[1] https://repository.apache.org/content/repositories/snapshots/org/apache/tomcat/embed/tomcat-embed-core/8.0-SNAPSHOT/"}, {"count": 1, "tags": [], "creator": "nicholas@nicholaswilliams.net", "text": "Also missing is META-INF/web-fragment.xml. I will have a patch for this shortly.", "id": 166010, "time": "2013-03-19T20:31:37Z", "bug_id": 54726, "creation_time": "2013-03-19T20:31:37Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 166011, "time": "2013-03-19T20:35:05Z", "bug_id": 54726, "creation_time": "2013-03-19T20:35:05Z", "is_private": false, "text": "Thanks for the report. Fixed in trunk."}, {"count": 3, "tags": [], "bug_id": 54726, "attachment_id": 30080, "text": "Created attachment 30080\nProposed different patch\n\nHmmm. And here I was attached a patch as you checked in a fix.\n\nIf you don't mind, take a look at my patch anyway. Your change 1) doesn't address the sources JARs, which is also important, and 2) doesn't allow for other meta-inf directories. Mine addresses both. :-)", "id": 166012, "time": "2013-03-19T20:44:29Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-03-19T20:44:29Z", "is_private": false}, {"count": 4, "tags": [], "creator": "markt@apache.org", "text": "I'm not clear what the purpose of adding those files to the source JAR would be.\n\nAs for additional JARs, I'm happy not worrying about that until we need to and the answer to that problem is probably creating additional directories for the embedded JARs under ${tomcat.manifests} at the same time ${tomcat.manifests} is created.", "id": 166014, "time": "2013-03-19T21:19:20Z", "bug_id": 54726, "creation_time": "2013-03-19T21:19:20Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 54726, "text": "\"the answer to that problem is probably creating additional directories for the embedded JARs under ${tomcat.manifests} at the same time ${tomcat.manifests} is created.\"\n\nYep. That's what I did, except I created them under the .embed and .embed.source directories and then deleted them after the <jarIt> call.\n\n\"I'm not clear what the purpose of adding those files to the source JAR would be.\"\n\nThe source JARs should contain all code necessary to build a running Tomcat, right? Obviously there's the matter of \"it's easier to download from SVN, where there's an existing Ant build script you can use,\" but still, theoretically, one should be able to unzip the source files, fire up an IDE, and start working/building. Without the META-INF resources, any JAR they built would be incomplete.\n\nJust my $0.02. If you disagree that that's needed, I understand.", "id": 166015, "time": "2013-03-19T21:28:40Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-03-19T21:28:40Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 54726, "attachment_id": null, "text": "(In reply to comment #5)\n> The source JARs should contain all code necessary to build a running Tomcat,\n> right?\n\nWrong. That describes the -src.tar.gz and -src.zip distributions. The src JARs are purely to aid debugging in IDEs. There is a whole bunch of stuff missing from the src JASRs that you need to build a full distribution.", "id": 166016, "time": "2013-03-19T21:32:53Z", "creator": "markt@apache.org", "creation_time": "2013-03-19T21:32:53Z", "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 54726, "text": "Then I stand corrected.\n\nMy patch still contains a solution to the \"more than one meta-inf\" problem, but if you'd rather wait and solve that problem when it appears, that's fine.\n\nBy the way, there's a typo in your commit. Your comment says \"meta-int,\" not \"meta-inf.\"", "id": 166017, "time": "2013-03-19T21:35:09Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-03-19T21:35:09Z", "tags": [], "is_private": false}]
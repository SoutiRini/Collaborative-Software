[{"count": 0, "tags": [], "text": "Apache 1.3.33 with mod_ssl\nApache 2.0.52 --with-ssl\n\nSymptom: The dbm file that is configured with the SSLSessionCache directive\nsuddenly starts to grow exponentially and finally reaches up to 900 MB.\nAt this state the parent process is still accepting new https/SSL requests and\nforks off children for each new one. But the SSL handshake never happens, and\nthe children just keep hanging there, doing nothing. Finally the MAX_CLIENT\nlimit is reached, and the server is dead for all practical purposes.\n\nWe see this at different occasions, with all Apache versions.\nCase 1: We see a load peak (~8 SSL requests per second) over a period of about 1\nhour, then the load decreases. About one hour after the peak when the load\nreaches about 5 requests/sec the file explodes and the server hangs.\nCase 2: Same as above, but time difference is about 2 hours.\nCase 3: A sudden surge of SSL requests (avg. ~0.6 requests/sec) to an otherwise\nidle server causes the same effect, the SessionCache file exploding (from ~100K\nduring the day to finally 860 MB). Below is an example file size history, with\nsnapshots being taken every minute. In this case there were two ssl request\n\"waves\", one from 22:02 to 22:06, the other one from 22:44 to ?? (server crashed\nat ~22:49) \n\n--- BEGIN HISTORY ---\n22:02:38 110592         \n22:03:38 1451008         \n22:04:38 1451008         \n22:05:38 1451008         \n22:06:38 1451008                 \n...        \n22:43:38 1451008         \n22:44:38 1451008         \n22:45:38 54164480         \n22:46:38 54164480         \n22:47:38 77381632         \n22:48:38 861713408\n\n-- END HISTORY ---\n\nregards /markus", "attachment_id": null, "id": 72517, "creator": "public@wernig.net", "time": "2005-03-16T17:55:28Z", "bug_id": 34039, "creation_time": "2005-03-16T17:55:28Z", "is_private": false}, {"count": 1, "tags": [], "creator": "public@wernig.net", "attachment_id": null, "text": "Annotation:\nThere is one difference between the setups of the two versions here:\nApache 1.3.33 does BasicAuth, while Apache 2.0.52 does Client certificate\nvalidation.\nWe've just finished testing against 1.3.33, and when turning off the BasicAuth,\nthe problem does not occur, not even under high load (500 parallel sessions).\n\n/m", "id": 72547, "time": "2005-03-17T04:24:37Z", "bug_id": 34039, "creation_time": "2005-03-17T04:24:37Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 34039, "attachment_id": null, "text": "Please give the configuration for the SSL vhost.", "id": 72706, "time": "2005-03-19T20:19:08Z", "creator": "jorton@redhat.com", "creation_time": "2005-03-19T20:19:08Z", "is_private": false}, {"count": 3, "tags": [], "creator": "public@wernig.net", "text": "Created attachment 14539\nhttpd config file (main + vhost 2.0.52)\r\nThe calls we see when the file explodes are to /some/WLSservice (see bottom of file)\n\nI've sanitized the file some and removed config details for a second vhost on\nthe same box that runs on port 443. The vhost that keeps crashing (and for\nwhich we see the described behaviour in relation to the requests) runs on port\n444.", "id": 26631, "time": "2005-03-22T18:05:41Z", "bug_id": 34039, "creation_time": "2005-03-22T18:05:41Z", "is_private": false, "attachment_id": 14539}, {"text": "This is probably the same as 25667.  Use shmcb not dbm.\n\n*** This bug has been marked as a duplicate of 25667 ***", "tags": [], "bug_id": 34039, "attachment_id": null, "count": 4, "id": 81697, "time": "2005-10-25T12:36:08Z", "creator": "jorton@redhat.com", "creation_time": "2005-10-25T12:36:08Z", "is_private": false}]
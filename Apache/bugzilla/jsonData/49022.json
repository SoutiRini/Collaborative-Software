[{"count": 0, "tags": [], "bug_id": 49022, "is_private": false, "text": "Created attachment 25210\ntest jsp file\r\nput it at:\r\nwebapps/gnizr/login.jsp\n\n==Research version==\n  Tomcat 6.0.24\n==Also test version==\n  Tomcat 5.5.23 have the same problem\n\n==Steps to reproduce==\n(100% reproduce)\n1 create a simple test jsp page and publish to tomcat,\n  webapps/gnizr/login.jsp\n2 explorer the page at,\n  http://localhost:8080/gnizr/login.jsp\n  page displays ok.\n3 restart tomcat\n4 delete the work folder of this page,\n  $ rm -rf work/Catalina/localhost/gnizr\n  NOTE 1: delete the entire folder, not only the following java/class files,\n    work/Catalina/localhost/gnizr/org/apache/jsp/login_jsp.java\n    work/Catalina/localhost/gnizr/org/apache/jsp/login_jsp.class\n  NOTE 2: DO NOT explorer the page before this step\n5 explorer the page at,\n  http://localhost:8080/gnizr/login.jsp\n  and tomcat returns JasperException to explorer like that:\n\n--\nHTTP Status 500 -\n\ntype Exception report\n\nmessage\n\ndescription The server encountered an internal error () that prevented it from fulfilling this request.\n\nexception\n\norg.apache.jasper.JasperException: org.apache.jasper.JasperException: Unable to load class for JSP\n\torg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:156)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:329)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\nroot cause\n\norg.apache.jasper.JasperException: Unable to load class for JSP\n\torg.apache.jasper.JspCompilationContext.load(JspCompilationContext.java:623)\n\torg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:144)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:329)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\nroot cause\n\njava.lang.ClassNotFoundException: org.apache.jsp.login_jsp\n\tjava.net.URLClassLoader$1.run(URLClassLoader.java:202)\n\tjava.security.AccessController.doPrivileged(Native Method)\n\tjava.net.URLClassLoader.findClass(URLClassLoader.java:190)\n\torg.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:134)\n\torg.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:66)\n\torg.apache.jasper.JspCompilationContext.load(JspCompilationContext.java:621)\n\torg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:144)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:329)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\nnote The full stack trace of the root cause is available in the Apache Tomcat/6.0.24 logs.\n--\n\n==Code Research==\nAfter debug tomcat, we found that exception throws at:\nJspCompilationContext.java line 621:\n  servletClass = jspLoader.loadClass(name);\nand before that, tomcat has successfully recompiled the jsp page at work folder,\nbut it seems tomcat cannot find it when load it to memory.\nwe checked the object \"ctxt\", the data is right,\nis it cause by JSP Container Class Loader's search path setting at startup?", "id": 135780, "time": "2010-03-30T04:00:18Z", "creator": "qu-chunguang@necsoft.com.cn", "creation_time": "2010-03-30T04:00:18Z", "attachment_id": 25210}, {"count": 1, "tags": [], "bug_id": 49022, "is_private": false, "text": "Created attachment 25212\nput it at webapps/gnizr/WEB-INF/classes/test/helloWorld.java\r\n and compile to .class", "id": 135782, "time": "2010-03-30T05:12:18Z", "creator": "qu-chunguang@necsoft.com.cn", "creation_time": "2010-03-30T05:12:18Z", "attachment_id": 25212}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Deleting the work directory whilst Tomcat is running is not supported.\n\nI took a quick look to see if I could find a way to handle the deleting of the work directory but I could not see any obvious solutions.\n\nSince deleting the work directory is unsupported, I am closing this as INVALID.\n\nThat said, if you want to research this further yourself and come up with a solution feel free to re-open this issue and attach a patch. However, be aware that the patch will need to be a simple one with no noticeable side-effects for normal usage, otherwise it is likely to be rejected.", "id": 136440, "time": "2010-04-27T08:48:28Z", "bug_id": 49022, "creation_time": "2010-04-27T08:48:28Z", "is_private": false, "attachment_id": null}]
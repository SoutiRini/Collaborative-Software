[{"count": 0, "attachment_id": 33622, "bug_id": 59114, "is_private": false, "id": 189083, "time": "2016-03-04T08:15:01Z", "creator": "eljobe@gmail.com", "creation_time": "2016-03-04T08:15:01Z", "tags": [], "text": "Created attachment 33622\nReproduction Ant Build Script\n\nOverview:\nWhen you are copying an empty FileSet to a target location, the target directory is created if the empty FileSet was accomplished with '<exclude name=\"*\" />' but not if it was accomplished with '<exclude name=\"**\" />'\n\nSteps to Reproduce:\n1) Download the attached build.xml into an empty directory.\n2) Run 'ant' in that directory.\n\nActual Results:\nThe results of 'find .' in that directory are:\n$> find .\n.\n./ant-out\n./ant-out/cpyExStar\n./build.xml\n./src\n./src/empty\n\nExpected Results:\nEither one of the following would be fine outputs:\n$> find .\n.\n./build.xml\n./src\n./src/empty\n\n$> find .\n.\n./ant-out\n./ant-out/cpyExStar\n./ant-out/cpyExStars\n./build.xml\n./src\n./src/empty\n\nThis bug is only concerned with the fact that the Copy task behaves differently based on whether the empty FileSet is obtained with '<exclude name=\"*\" />' or '<exclude name=\"**\" />'\n\nI will admit that I have a slight preference for the first of the two possible 'Expected Results' because if you don't have anything to copy to the destination, why create the destination directory at all. But, I don't really care as long as it is a consistent and reliable result.\n\nBuild Environment:\nOS: Mac OS X 10.11.3 (although I suspect it could be reproduced on many)\nJava Versions: 1.8.0_72, 1.7.0_79, 1.6.0_65\nant version: 1.9.6 (also reproduced from current master branch of any git repo)"}, {"count": 1, "tags": [], "creator": "antoine@apache.org", "text": "I just committed a testcase which illustrates the current behavior of Ant concerning the application of the \"**\" and the \"*\" pattern to the empty path.\nSee https://github.com/apache/ant/commit/8bb69bfdd8201ffbd531097d95f29c8a3e88a7a6\n\nThe logic to handle the root directory of a fileset is at this location :\n\nhttps://github.com/apache/ant/blob/master/src/main/org/apache/tools/ant/DirectoryScanner.java#L897\n\nMy understanding is that \"**\" matches any length of path including file separators, while \"*\" matches any length of path without the file separator. Why \"*\" currently does not match the root empty directory is surprising. \n\nPatterns are documented here :\nhttp://ant.apache.org/manual/dirtasks.html#patterns", "id": 189188, "time": "2016-03-07T03:54:25Z", "bug_id": 59114, "creation_time": "2016-03-07T03:54:25Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "antoine@apache.org", "text": "This line https://github.com/apache/ant/blob/master/src/main/org/apache/tools/ant/types/selectors/SelectorUtils.java#L243 is the line which would need to be changed to deal with the bug report.", "id": 189191, "time": "2016-03-07T04:38:33Z", "bug_id": 59114, "creation_time": "2016-03-07T04:38:33Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "eljobe@gmail.com", "attachment_id": null, "text": "(In reply to Antoine Levy-Lambert from comment #2)\n> This line\n> https://github.com/apache/ant/blob/master/src/main/org/apache/tools/ant/\n> types/selectors/SelectorUtils.java#L243 is the line which would need to be\n> changed to deal with the bug report.\n\nI find that code sort of hard to follow. Are you saying that if we didn't perform that check, then \"**\" would also match the root directory and create the target directory OR are you saying that we should include \"*\" in that check as well so that the routine would return false for the case where the only patten is \"*\"? Or something else?", "id": 189202, "time": "2016-03-07T13:08:11Z", "bug_id": 59114, "creation_time": "2016-03-07T13:08:11Z", "is_private": false}, {"count": 4, "tags": [], "creator": "antoine@apache.org", "is_private": false, "text": "I meant that to fix the bug we should probably change the condition\n\n!tokenizedPattern[i].equals(DEEP_TREE_MATCH)\n\nto become\n\n!( tokenizedPattern[i].equals(DEEP_TREE_MATCH) || tokenizedPattern[i].equals(\"*\"))\n\nAlso there should be a constant in Ant for \"*\".", "id": 190164, "time": "2016-04-11T22:30:32Z", "bug_id": 59114, "creation_time": "2016-04-11T22:30:32Z", "attachment_id": null}]
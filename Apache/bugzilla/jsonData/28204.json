[{"count": 0, "tags": [], "creator": "erik.weidel@mplus-technologies.de", "text": "In apache bench is no checking if the length of the url given in the commandline\nmatches the size of the internal request buf (variable _request). \nSo the sprintf causes a buffer overflow. In my case this overwrote the variable \ncontaining the port so I could not connect to the server.\n\nI patched this to use the apr_snprintf function and exit with an error \"request\ntoo long\".\nI also increased the buffer size for the request to 2048 because 512 was too\nsmall for my tests.\n\nIndex: ab.c\n===================================================================\nRCS file: /home/cvspublic/httpd-2.0/support/ab.c,v\nretrieving revision 1.143\ndiff -u -r1.143 ab.c\n--- ab.c        25 Mar 2004 00:05:00 -0000      1.143\n+++ ab.c        5 Apr 2004 12:31:15 -0000\n@@ -313,7 +313,7 @@\n apr_time_t start, endtime;\n\n /* global request (and its length) */\n-char _request[512];\n+char _request[2048];\n char *request = _request;\n apr_size_t reqlen;\n\n@@ -1534,6 +1534,7 @@\n     apr_int16_t rv;\n     long i;\n     apr_status_t status;\n+    int snprintf_res=0;\n #ifdef NOT_ASCII\n     apr_size_t inbytes_left, outbytes_left;\n #endif\n@@ -1568,7 +1569,7 @@\n\n     /* setup request */\n     if (posting <= 0) {\n-       sprintf(request, \"%s %s HTTP/1.0\\r\\n\"\n+        snprintf_res = apr_snprintf(request, sizeof(_request), \"%s %s HTTP/1.0\\r\\n\"\n                \"User-Agent: ApacheBench/%s\\r\\n\"\n                \"%s\" \"%s\" \"%s\"\n                \"Host: %s%s\\r\\n\"\n@@ -1581,7 +1582,7 @@\n                cookie, auth, host_field, colonhost, hdrs);\n     }\n     else {\n-       sprintf(request, \"POST %s HTTP/1.0\\r\\n\"\n+        snprintf_res = apr_snprintf(request,  sizeof(_request),\"POST %s\nHTTP/1.0\\r\\n\"\n                \"User-Agent: ApacheBench/%s\\r\\n\"\n                \"%s\" \"%s\" \"%s\"\n                \"Host: %s%s\\r\\n\"\n@@ -1596,6 +1597,9 @@\n                cookie, auth,\n                host_field, colonhost, postlen,\n                (content_type[0]) ? content_type : \"text/plain\", hdrs);\n+    }\n+    if (snprintf_res >= sizeof(_request)) {\n+        err(\"request too long\");\n     }\n\n     if (verbosity >= 2)", "id": 55302, "time": "2004-04-05T12:35:27Z", "bug_id": 28204, "creation_time": "2004-04-05T12:35:27Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 28204, "attachment_id": null, "id": 60397, "time": "2004-07-10T07:20:31Z", "creator": "chip@force-elite.com", "creation_time": "2004-07-10T07:20:31Z", "is_private": false, "text": "Patch commited to 2.1 CVS.\n\nThanks for using Apache!\n\n-Paul Querna"}]
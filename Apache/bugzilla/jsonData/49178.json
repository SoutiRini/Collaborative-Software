[{"count": 0, "tags": [], "creator": "tipirneni@yahoo.com", "attachment_id": null, "is_private": false, "id": 136359, "time": "2010-04-23T12:54:50Z", "bug_id": 49178, "creation_time": "2010-04-23T12:54:50Z", "text": "java.lang.ArrayIndexOutOfBoundsException: -1\n        oracle.jdbc.driver.T4CTTIoauthenticate.setSessionFields(T4CTTIoauthenticate.java:942)\n        oracle.jdbc.driver.T4CTTIoauthenticate.<init>(T4CTTIoauthenticate.java:221)\n        oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:358)\n        oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:508)\n        oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:203)\n        oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:33)\n        oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:510)\n        oracle.jdbc.pool.OracleDataSource.getPhysicalConnection(OracleDataSource.java:275)\n        oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:206)\n        xxx.yyy.CPC.data.DAOUtil.getConnection(Unknown Source)\n        xxx.yyy.CPC.logging.LogDAO.createLog(Unknown Source)\n        xxx.yyy.CPC.logging.DBLogger.db(Unknown Source)\n        org.apache.jsp.CPC.Default_jsp._jspService(Default_jsp.java:90)\n        org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n        javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n        org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:377)\n        org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n        org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n        javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n        sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        java.lang.reflect.Method.invoke(Method.java:597)\n        org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:269)\n        java.security.AccessController.doPrivileged(Native Method)\n        javax.security.auth.Subject.doAsPrivileged(Subject.java:517)\n        org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:301)\n        org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:162) \n\n\nWhen  I enabled  -Djava.security.debug=access,failure I see The problem was with oracle jar in file:${catalina.base}\\lib dir was getting called with \\ at the start. The problem was that there was attempt to access \\file:${catalina.base}\\lib\\ojdbc6.jar rather than file:\\${catalina.base}\\lib\\ojdbc6.jar. When I added the AllProperty policy rule for that \\file:${catalina.base}\\lib\\- . this error went away."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 136370, "time": "2010-04-23T19:44:27Z", "bug_id": 49178, "creation_time": "2010-04-23T19:44:27Z", "is_private": false, "text": "That looks rather odd. Could you please provide:\n- the full security failure from the logs that prompted you to make this change\n- the exact entry you added to the policy file\n\nThanks."}, {"count": 2, "tags": [], "bug_id": 49178, "attachment_id": 25356, "text": "Created attachment 25356\nError log file", "id": 136420, "time": "2010-04-26T13:51:54Z", "creator": "tipirneni@yahoo.com", "creation_time": "2010-04-26T13:51:54Z", "is_private": false}, {"count": 3, "tags": [], "text": "(In reply to comment #1)\n> That looks rather odd. Could you please provide:\n> - the full security failure from the logs that prompted you to make this change\n> - the exact entry you added to the policy file\n> \n> Thanks.\n\nhi Mark\n   When I run the Tomcat with -security option and if the following policy \n\ngrant codeBase \"file:\\${catalina.base}\\lib\\-\" {\n  permission java.security.AllPermission;\n};\n\n  is not entered in the log, I see the following error come up in the stdout\n\naccess: access denied (java.io.FilePermission \\C:\\javaaps\\apache-tomcat-6.0.26\\a\npache-tomcat-6.0.26\\lib\\ojdbc6.jar read)\njava.lang.Exception: Stack trace\n        at java.lang.Thread.dumpStack(Thread.java:1206)\n        at java.security.AccessControlContext.checkPermission(AccessControlConte\nxt.java:313)\n        at java.security.AccessController.checkPermission(AccessController.java:\n546)\n        at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)\n        at sun.misc.URLClassPath.check(URLClassPath.java:408)\n        at sun.misc.URLClassPath.checkURL(URLClassPath.java:388)\n        at java.net.URLClassLoader.findResource(URLClassLoader.java:366)\n        at java.lang.ClassLoader.getResource(ClassLoader.java:977)\n        at java.lang.Class.getResource(Class.java:2074)\n        at oracle.sql.ConverterArchive.readObj(ConverterArchive.java:398)\n        at oracle.sql.converter.CharacterConverterJDBC.getInstance(CharacterConv\nerterJDBC.java:143)\n        at oracle.sql.converter.CharacterConverterFactoryJDBC.make(CharacterConv\nerterFactoryJDBC.java:45)\n        at oracle.sql.CharacterSetWithConverter.getInstance(CharacterSetWithConv\nerter.java:95)\n        at oracle.sql.CharacterSetFactoryThin.make(CharacterSetFactoryThin.java:\n126)\n        at oracle.sql.CharacterSet.make(CharacterSet.java:448)\n        at oracle.jdbc.driver.DBConversion.init(DBConversion.java:150)\n        at oracle.jdbc.driver.DBConversion.<init>(DBConversion.java:111)\n        at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1007)\n        at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:292)\n        at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:\n508)\n        at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:203)\n        at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtensio\nn.java:33)\n        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:510)\n        at oracle.jdbc.pool.OracleDataSource.getPhysicalConnection(OracleDataSou\nrce.java:275)\n        at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java\n:206)\n        at edu.utmb.CPC.data.DAOUtil.getConnection(Unknown Source)\n        at edu.utmb.CPC.logging.LogDAO.createLog(Unknown Source)\n        at edu.utmb.CPC.logging.DBLogger.db(Unknown Source)\n        at org.apache.jsp.CPC.Default_jsp._jspService(Default_jsp.java:90)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper\n.java:377)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:3\n13)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:269\n)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAsPrivileged(Subject.java:517)\n        at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:3\n01)\n        at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.\njava:162)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:283)\n        at org.apache.catalina.core.ApplicationFilterChain.access$000(Applicatio\nnFilterChain.java:56)\n        at org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilt\nerChain.java:189)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:185)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:233)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:191)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica\ntorBase.java:465)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:102)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:109)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.jav\na:298)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:852)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nss(Http11Protocol.java:588)\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:48\n9)\n        at java.lang.Thread.run(Thread.java:619)\n\n\n\nApr 26, 2010 12:46:35 PM org.apache.catalina.core.StandardWrapperValve invoke\nSEVERE: Servlet.service() for servlet jsp threw exception\njava.lang.ArrayIndexOutOfBoundsException: -1\n\tat oracle.jdbc.driver.T4CTTIoauthenticate.setSessionFields(T4CTTIoauthenticate.java:942)\n\tat oracle.jdbc.driver.T4CTTIoauthenticate.<init>(T4CTTIoauthenticate.java:221)\n\tat oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:358)\n\tat oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:508)\n\tat oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:203)\n\tat oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:33)\n\tat oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:510)\n\tat oracle.jdbc.pool.OracleDataSource.getPhysicalConnection(OracleDataSource.java:275)\n\tat oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:206)\n\tat edu.utmb.CPC.data.DAOUtil.getConnection(Unknown Source)\n\tat edu.utmb.CPC.logging.LogDAO.createLog(Unknown Source)\n\tat edu.utmb.CPC.logging.DBLogger.db(Unknown Source)\n\tat org.apache.jsp.CPC.Default_jsp._jspService(Default_jsp.java:90)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:377)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:269)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAsPrivileged(Subject.java:517)\n\tat org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:301)\n\tat org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:162)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:283)\n\tat org.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:56)\n\tat org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:189)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:185)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:465)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:852)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\n\tat java.lang.Thread.run(Thread.java:619)\n\n\nHowever, once I added the policy and restarted the error went away.", "is_private": false, "bug_id": 49178, "id": 136421, "time": "2010-04-26T13:54:32Z", "creator": "tipirneni@yahoo.com", "creation_time": "2010-04-26T13:54:32Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": 25362, "is_private": false, "id": 136439, "time": "2010-04-27T08:43:08Z", "bug_id": 49178, "creation_time": "2010-04-27T08:43:08Z", "text": "Created attachment 25362\nBug49178PermissionUrlTest.java - sample code to check Java API behaviour\n\nThe preceding slash in the permission is how Java behaves. It is not specific to Tomcat.\n\nI am attaching a sample class that demonstrates Java API behaviour. When I am running it on Windows XP with Sun JRE 6u20 as\n \"java -cp . Bug49178PermissionUrlTest c:\\projects\\sample.txt\"\nit prints:\n\n// File:\nC:\\PROJECTS\\sample.txt\n// URL:\nfile:/C:/PROJECTS/sample.txt\n// URL.getPath():\n/C:/PROJECTS/sample.txt\n// URLConnection.getPermission():\n(java.io.FilePermission \\C:\\PROJECTS\\sample.txt read)\n// File(url.getPath()).getCanonicalPath()\nC:\\PROJECTS\\sample.txt\n// FilePermission.equals()\ntrue\n\nThe Permission is printed with preceding slash, but that does not matter, because the FilePermissions are compared by canonical paths, and the canonical path is constructed correctly regardless of that slash.\n\nSuresh,  are you running with separate CATALINA_HOME and CATALINA_BASE? The classes mentioned in the \"access denied\" stacktrace -- where their jars are located?"}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 137278, "time": "2010-06-02T11:30:32Z", "bug_id": 49178, "creation_time": "2010-06-02T11:30:32Z", "is_private": false, "text": "It looks like this is a catalina home/base issue.\n\nI have added an additional permission (commented out) to the policy file that folks can use in this situation.\n\nThe change has been applied to trunk for 7.0.0 onwards and proposed for 6.0.x\n\nIt would be good to get some confirmation that home/base was indeed the issue. If no confirmation is forthcoming, I will assume that was the root cause."}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 137627, "time": "2010-06-14T13:04:47Z", "bug_id": 49178, "creation_time": "2010-06-14T13:04:47Z", "text": "The additional permission has been added (as a comment) to catalina.policy and will be included in 6.0.27 onwards.\n\nIf you still see this issue, feel free to re-open this bug report but you will need to include the exact, complete (and simplest) set of steps to reproduce this on a clean install of the latest stable 6.0.x release."}]
[{"count": 0, "tags": [], "creator": "croller@generali.fr", "text": "Hi,\n\nwith an Apache 2.2.3 acting as a reverse proxy (with mod_disk_cache enabled and\nworker), http/1.1 requests and responses are all sent in the same session, but\nApache closes http/1.1 sesion to the web server after 1 request+response despite\nthe keep-alive header. IMHO, this is not in the \"spirit\" of the RFC even if this\nbehaviour is RFC compliant.\n\nIn the following capture, client is 172.30.2.21.\nIncoming Apache's interface is 172.30.13.98 (client side).\nOutgoing Apache's interface is 172.30.13.80 (server side).\nWeb server is 172.30.5.43.\n\nThanks in advance", "id": 92295, "time": "2006-08-17T10:17:09Z", "bug_id": 40275, "creation_time": "2006-08-17T10:17:09Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "croller@generali.fr", "attachment_id": 18727, "id": 92296, "time": "2006-08-17T10:22:02Z", "bug_id": 40275, "creation_time": "2006-08-17T10:22:02Z", "is_private": false, "text": "Created attachment 18727\ntcpdump"}, {"count": 2, "tags": [], "bug_id": 40275, "is_private": false, "id": 94175, "attachment_id": null, "creator": "rpluem@apache.org", "creation_time": "2006-09-27T18:54:51Z", "time": "2006-09-27T18:54:51Z", "text": "Please supply your reverse proxy configuration."}, {"count": 3, "tags": [], "creator": "croller@generali.fr", "text": "Created attachment 18933\nhttpd.conf\n\nThis is an extract from my virtual-hosts.conf file with one virtual host only.\n\n<VirtualHost 172.30.13.95:80>\n  ServerName www.reseauline.gpa.fr\n  RewriteEngine On\n  ProxyRequests Off\n  RewriteRule ^(.*)$ $1 [E=GSYS:http://www.reseauline.gpa.fr]\n  <IfModule mod_disk_cache.c>\n    CacheRoot \"/var/cache/apache/prod/www.reseauline\"\n  </IfModule>\n  CustomLog /var/log/apache/logs/prod/www.reseauline.access.log combined\n  ErrorLog /var/log/apache/logs/prod/www.reseauline.error.log\n  RewriteLogLevel 1\n  RewriteLog /var/log/apache/logs/prod/www.reseauline.rewrite.log\n  include conf/ErrorDoc-GPA-Reseauline.conf\n  include conf/liste-uri/www.reseauline-rewrite.conf\n</VirtualHost>", "id": 94237, "time": "2006-09-28T15:13:25Z", "bug_id": 40275, "creation_time": "2006-09-28T15:13:25Z", "is_private": false, "attachment_id": 18933}, {"text": "Thanks for the configuration, but it does not contain any reverse proxy\nconfiguration. Can you please sent the part that contains the reverse proxy\nconfiguration?", "tags": [], "bug_id": 40275, "attachment_id": null, "count": 4, "id": 94238, "time": "2006-09-28T15:58:06Z", "creator": "rpluem@apache.org", "creation_time": "2006-09-28T15:58:06Z", "is_private": false}, {"count": 5, "tags": [], "creator": "croller@generali.fr", "attachment_id": 18936, "id": 94266, "time": "2006-09-29T14:46:14Z", "bug_id": 40275, "creation_time": "2006-09-29T14:46:14Z", "is_private": false, "text": "Created attachment 18936\nrewrite rules used for the virtual host configuration provided\n\nThis file configuration (httpd.conf and extract from virtual-host.conf) is on\nan Apache server receiving request from internet and LAN and dispatching\nrequest among others Websphere and IIS servers. Despite the \"ProxyRequests\nOff\", this is a reverse proxy configuration. Here comes the rewrite rules used\nfor the virtual host configuration provided."}, {"count": 6, "tags": [], "creator": "rpluem@apache.org", "text": "I think I have an idea why this happens. As you do your reverse proxing only via\nmod_rewrite the default reverse proxy worker gets used which does not allow\npersistent connections. Could you please try the following workaround:\n\nAdd the following to your virtual host configuration (e.g. the one you sent for\nwww.reseauline.gpa.fr):\n\n<Proxy balancer://www.reseauline.gpa.fr>\nBalancerMember http://www.reseauline.gpa.fr\n</Proxy>\n\nand change the following line in this virtual host:\n\nRewriteRule ^(.*)$ $1 [E=GSYS:http://www.reseauline.gpa.fr]\n\nto\n\nRewriteRule .* - [E=GSYS:balancer://www.reseauline.gpa.fr]\n\nand let me know if this works in general and if the connections are now\npersistent for this virtual host.", "id": 94580, "time": "2006-10-06T05:45:10Z", "bug_id": 40275, "creation_time": "2006-10-06T05:45:10Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 40275, "attachment_id": null, "id": 95530, "creation_time": "2006-11-07T04:04:01Z", "time": "2006-11-07T04:04:01Z", "creator": "croller@generali.fr", "text": "Sorry for the delay, but I needed to test all my virtual hosts.\n\nAnd it's working fine except for a configuration with RewriteCond on remote\naddress (%{REMOTE_ADDR}): 1 RewriteRule for ip addresses from LAN and 1 from ip\naddresses from internet (2 different domain names):\n\nRewriteRule ^(.*)$ $1 [E=GSYS:http://www.reseauline-intra.gpa.fr]\nRewriteCond %{REMOTE_ADDR}      !^some ip addresses$\nRewriteRule ^(.*)$ $1 [E=GSYS:http://www.reseauline-extra.gpa.fr]\n\nThanks again.", "is_private": false}, {"count": 8, "tags": [], "bug_id": 40275, "is_private": false, "id": 95587, "attachment_id": null, "creator": "rpluem@apache.org", "creation_time": "2006-11-08T13:16:02Z", "time": "2006-11-08T13:16:02Z", "text": "There had been a hint on dev@httpd.apache.org recently that you can use\n<Proxy http://www.reseauline.gpa.fr>\n</Proxy>\n\nto force the creation of a particular worker (http://www.reseauline.gpa.fr in\nthis case). I have not checked it myself so far, but you may want to give it a try."}, {"count": 9, "tags": [], "creator": "croller@generali.fr", "attachment_id": null, "id": 96602, "time": "2006-12-07T05:25:02Z", "bug_id": 40275, "creation_time": "2006-12-07T05:25:02Z", "is_private": false, "text": "I had a configuration problem, but it has been solved by clearly defining\ndifferent proxy sections and and the corresponding RewriteRule lines (as you\ndescribed in the 6th comment).\n\nThanks for your help !"}, {"count": 10, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 96622, "time": "2006-12-07T11:33:32Z", "bug_id": 40275, "creation_time": "2006-12-07T11:33:32Z", "is_private": false, "text": "(In reply to comment #8)\n> There had been a hint on dev@httpd.apache.org recently that you can use\n> <Proxy http://www.reseauline.gpa.fr>\n> </Proxy>\n> \n\nCurrently this only works on trunk. This has been enabled by r427920\n(http://svn.apache.org/viewvc?view=rev&revision=427920)"}]
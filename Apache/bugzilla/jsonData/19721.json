[{"count": 0, "tags": [], "text": "The method DefaultServlet.serveResource(...) first gets the outputStream and\nthan sets the contentType.\nFilters (like compressionFilter from the examples) often check the contentType\nin getOutputStream() to check if they have to wrap the outputstream, but the\ncontentType gets set after getOutputStream is called, so the filter get 'null'\nas contentType.\nThe filters can be made more complex by waiting for the first byte to get\nwritten and then ask for the ContentType, but maybe it's easier to let\nDefaultServlet first set the contentType and than get the outputstream.\nAny thoughts on this?\n\nBecause of this bug, the compressionFilter only filters custom servlets/jsp and\nnot static content.", "attachment_id": null, "id": 36813, "creation_time": "2003-05-07T10:42:27Z", "time": "2003-05-07T10:42:27Z", "creator": "ronald-lists@klop.ws", "bug_id": 19721, "is_private": false}, {"count": 1, "tags": [], "bug_id": 19721, "attachment_id": null, "text": "Well, first, it is not a bug. The idea is that your filter should work in all\ncases. Basing your decisions about when the output stream is requested is bad\n(you should base that on when the response is committed), and is not guaranteed\nto work.\n\nThe code in default servlet is simpler this way, so the RFE will not be\nimplemented (or you'll have to provide a patch that the developers like).", "id": 36817, "time": "2003-05-07T13:00:55Z", "creator": "remm@apache.org", "creation_time": "2003-05-07T13:00:55Z", "is_private": false}, {"count": 2, "tags": [], "creator": "ronald-lists@klop.ws", "attachment_id": null, "id": 36841, "time": "2003-05-07T15:57:33Z", "bug_id": 19721, "creation_time": "2003-05-07T15:57:33Z", "is_private": false, "text": "In that case the compressionFilter has a 'bug' that it doesn't work with static\ncontents/DefaultServer.\nBut that probably needs another bug report.\n"}, {"count": 3, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 36844, "time": "2003-05-07T16:05:31Z", "bug_id": 19721, "creation_time": "2003-05-07T16:05:31Z", "is_private": false, "text": "Personally, I consider the compressionFilter to be an example, not something to\nbe used in production."}, {"count": 4, "tags": [], "bug_id": 19721, "attachment_id": null, "text": "Yes, I'm experiencing that also.\n<off topic>\nThe browser doesn't always like the output of the filter and asks me if I \nwan't to save the page in stead of showing it.\n</off topic>\nBut since the compression of Tomcat doesn't work for all mimeTypes (bug \n#18073) I'm looking for other ways of doing this.", "id": 36847, "time": "2003-05-07T16:30:16Z", "creator": "ronald-lists@klop.ws", "creation_time": "2003-05-07T16:30:16Z", "is_private": false}]
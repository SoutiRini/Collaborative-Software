[{"count": 0, "tags": [], "text": "This report is a combination of bug# 5826 (closed) and bug# 19762 (opened).\nTomcat version: 4.1.27\nJDK: 1.3.1_06-b01\n\nI have this structure:\nFile1.jsp\nsubFolder1/File2.jsp\n\nI use jspc to precompile these jsp files. Jasper creates 2 java files like this:\nFile1_jsp.java\nsubFolder1/File2_jsp.java\n\nIn a subsequent step, I touch File2.jsp and re-run jspc. The task correctly \nidentifies that File2.jsp has been modified and recompiles it into \nFile2_jsp.java.\nBecause of bug# 19762, jspc task does not scan correctly the generated java \nfiles and reports that they not exist and therefore they will be generated \nagain. There is a simple resolution for this bug and that is to append \nthe .java to the resulted string of the method \norg.apache.tools.ant.taskdefs.optional.jsp.Jasper41Mangler::mapJspToJavaName\n(File jspFile). After applying this fix, jspc correctly detects which java \ngenerated files are out-of-date.\nThe task then hands over to jasper the files needed to be compiled. Now, \nbecause of bug# 5826, jasper fails to detect which java generated files are out \nof date and does not compile them. Only by switching the jdk to 1.4.x this \nproblem is fixed. \nMoreover, if a jsp file resides in a subfolder, (File2.jsp in my example) the \njspc logic that scans for generated java files failes to find it (i.e. \nsubFolder1/File2_jsp.java) because it looks only in the parent folder. The \nconsequence is that all the jsp's located in subfolders are translated into \njava files each time the jspc task runs. Again, switching to JDK 1.4.x will \nsolve this issue as well.\nThe only problem jdk 1.4 does not solve is that jspc passes all the jsp's for \ncompilation if bug# 19762 is not fixed (although jasper is smart enough to scan \nfor itself for already up to date java files).\n\nSolution: a fix for bug#5826 and aplying a patch that correctly scans jsp \nsubfolders also for jdk's other than 1.4 (I put this fix in attachment)", "is_private": false, "bug_id": 24505, "id": 47004, "time": "2003-11-07T17:10:56Z", "creator": "florinduroiu@yahoo.com", "creation_time": "2003-11-07T17:10:56Z", "attachment_id": null}, {"count": 1, "attachment_id": 8979, "creator": "florinduroiu@yahoo.com", "is_private": false, "id": 47005, "time": "2003-11-07T17:15:05Z", "bug_id": 24505, "creation_time": "2003-11-07T17:15:05Z", "tags": [], "text": "Created attachment 8979\nmodified scanDir method JspC.java"}, {"count": 2, "tags": [], "bug_id": 24505, "is_private": false, "text": "1. check with Ant1.6 things may or may not have improved. I dont recall any\nchanges between the two versions, especially because the jasper41 mangler was\nthe biggest change in recent times.\n\n2. I didnt know aboutthe jasper bug. We can deal with that by deleting the\ntarget files.\n\n3. i'll try and look at this patch shortly.", "id": 47021, "time": "2003-11-07T20:38:54Z", "creator": "stevel@apache.org", "creation_time": "2003-11-07T20:38:54Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 24505, "attachment_id": null, "is_private": false, "id": 47023, "time": "2003-11-07T21:57:44Z", "creator": "florinduroiu@yahoo.com", "creation_time": "2003-11-07T21:57:44Z", "text": "The correct way would be to recompile only the modified files. We have hundreads \nof jsp's in the project and jspc takes a long time to execute if all generated \nfiles are deleted in advance, generating idle times for us, the developers. JDK \nversion is also an important issue as we don't use the 1.4.x series and there's \nno immediate plan to upgrade. \nI have integrated on my side the fixes explained here and it works as expected \nwith jdk 1.3.1.\nI will test with ant 1.6 but only after the weekend and post the result here. \nStill, Bug# 5826 will still be around (a good reason to reopen it).\n"}, {"count": 4, "tags": [], "bug_id": 24505, "text": "sorry, I should have been more clear.\n\nevery file the dependency checker thinks needs recompiling should be deleted;\nthe up to date ones dont.", "id": 47028, "time": "2003-11-08T00:24:34Z", "creator": "stevel@apache.org", "creation_time": "2003-11-08T00:24:34Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 24505, "text": "I just tested with Ant version 1.6beta2 and JDK 1.3.1_06-b01 and I get the same \nfaulty behaviour.", "id": 47095, "time": "2003-11-10T08:37:48Z", "creator": "florinduroiu@yahoo.com", "creation_time": "2003-11-10T08:37:48Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "creator": "stevel@apache.org", "text": "Jspc is unmaintable and now deprecated. Please upgrade to the version that \nships with tomcat 5 or later. Marking as WONTFIX.", "count": 6, "id": 90662, "time": "2006-06-27T18:22:24Z", "bug_id": 24505, "creation_time": "2006-06-27T18:22:24Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "(As I posted to comp.infosystems.www.servers.ms-windows &  microsoft.public.isaserver \nwithout any luck)\n\n\nI've been running Apache 1.3.2x on my ISA firewall, to \"hide\" \nseveral\ninternal IIS webservers for about a year, very successfully. I\naccomplished this by \nplacing Apache on my firewall, and setting an\nincoming protocol filter on port 80 in ISA \nManagement, and then\nused mod_proxy to forward different virtual host requests to \nvarious\ninternal IIS boxes.\n\nHowever, since Apache2's release I have been wanting to \nupgrade site\n(20-30k requests/day) to the new release. However all test runs of\nApache 2 (on a \ndifferent port) have shown it's performance to be\nmiserable (despite all the official \nbenchmarks around the internet).\n\nI have been trying to find out why, and have discovered that \nApache2\nis not closing it's sockets when a request is finished for some\nreason. This problem \ndid not happen on Apache1.\n\nI verified this problem by telnetting to port 9001 and performing \nan\nHTTP get. If I do this to the internal Apache IP address, I get\ndisconnected at the end of the \nrequest, however if I do this from\n\"outside\", the connection is not disconnected at the end of \nthe\nrequest.\nIt opens the sockets, and doesn't respond to the request,\nand stays in \n\"Reading\" mode, and once there are no threads left\nApache2 stops responding. [It can stop \nresponding before all threads\nare used by not opening the sockets.]\n\nI have saved an example \nmod_status page during the load \ntest:\nhttp://www.freeasphost.co.uk/support/freeasphost.co.uk9001.html\nSockets \nmarked Reading stay open after the loadtesting is finished.\n\nHas anybody experienced this \nproblem, or know of any reason why this\nshould happen. I have tried forcing Apache to bind to a \ncertain IP\naddress, instead of \"0.0.0.0\". (ie not bound to a particular IP address)\nI have \nread that Apache 2 is now using a similar socket model to IIS.\n\nCould it be that it is socket \npooling, and therefore gaining the same\naffliction as IIS has with ISA, described \nhere:\nhttp://www.isaserver.org/shinder/tutorials/socket_pooling.htm\n\nApache \n2.0.36, downloaded MSI binaries\n\nMy firewall is set up in exactly the same way as I use for \nApache1 on\nport 80.\n\nMany thanks, and I would be greatly obliged if anyone could solve \nthis\nproblem\n\nCraig Macdonald\ncraig{at}freeasphost.co.uk\nfreeASPhost.co.uk \nAdministrator\n\n---------------------------------------------\nLoad test results:\n(These are all hitting the same backend IIS box, just \nusing\ndifferent versions of Apache and mod_proxy)\n\nRunning test 1 (apache \n1.3.22/mod_perl-1.22)\n12 fetches, 38 max parallel, 178896 bytes, in 10.0078 seconds\n14908 \nmean bytes/connection\n1.19907 fetches/sec, 17875.7 bytes/sec\nmsecs/connect: 485.759 \nmean, 810.484 max, 99.456 min\nmsecs/first-response: 739.271 mean, 1580.97 max, 237.383 \nmin\nHTTP response codes:\n  code 200 -- 12\n\nRunning test 2 (apache 2.0.36)\n1 fetches, 49 max \nparallel, 14908 bytes, in 10.0048 seconds\n14908 mean bytes/connection\n0.0999519 \nfetches/sec, 1490.08 bytes/sec\nmsecs/connect: 126.339 mean, 126.339 max, 126.339 \nmin\nmsecs/first-response: 189.68 mean, 189.68 max, 189.68 min\nHTTP response codes:\n  code \n200 -- 1", "is_private": false, "id": 16860, "creation_time": "2002-05-29T07:46:30Z", "time": "2002-05-29T07:46:30Z", "creator": "craig@freeasphost.co.uk", "bug_id": 9485, "attachment_id": null}, {"count": 1, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "text": "\n  Some of this logic has been improved in 2.0.37... including some of the win32\n  mpm code and the mod_proxy code.  Please test again and provide feedback.  \n  If you can be more specific [error messages at LogLevel debug] about what\n  precisely is wrong in this specific configuration, we may be able to reopen\n  and address this report.\n\n  2.0.37 should be out by next week.", "id": 16908, "time": "2002-05-29T23:27:26Z", "bug_id": 9485, "creation_time": "2002-05-29T23:27:26Z", "is_private": false}, {"count": 2, "text": "Right I'll post again once I've tested with 2.0.37\n\nThanks\n\nCraig", "bug_id": 9485, "is_private": false, "id": 16966, "time": "2002-05-30T21:38:06Z", "creator": "craig@freeasphost.co.uk", "creation_time": "2002-05-30T21:38:06Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "text": "No further response. Assuming all fine and closing this bug.", "id": 32097, "time": "2003-02-27T16:02:49Z", "bug_id": 9485, "creation_time": "2003-02-27T16:02:49Z", "is_private": false}]
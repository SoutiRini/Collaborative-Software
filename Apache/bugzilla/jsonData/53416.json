[{"count": 0, "text": "Deploy two different web applications onto Tomcat.\n\nEach web application has a resource that:\n\n* uses the Use Tomcat JDBC Connection Pool\n* has an identical name to the other one\n\n<Resource name=\"jdbc/collision\" factory=\"org.apache.tomcat.jdbc.pool.DataSourceFactory\" ... />\n\nWhen starting the server you get a non fatal error in the logs InstanceAlreadyExistsException.  Both applications appear to still work OK\n\nERROR org.apache.tomcat.jdbc.pool.DataSource - Unable to register JDBC pool with JMX\njavax.management.InstanceAlreadyExistsException: tomcat.jdbc:name=\"jdbc/soscvuk\",context=/,type=ConnectionPool,host=localhost,class=org.apache.tomcat.jdbc.pool.\nDataSource\n\tat com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:453) ~[na:1.6.0_32]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1484) [na:1.6.0_32]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:963) [na:1.6.0_32]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917) [na:1.6.0_32]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312) [na:1.6.0_32]\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482) [na:1.6.0_32]\n\tat org.apache.tomcat.jdbc.pool.DataSource.registerJmx(DataSource.java:135) [tomcat-jdbc.jar:na]\n\tat org.apache.tomcat.jdbc.pool.DataSource.preRegister(DataSource.java:102) [tomcat-jdbc.jar:na]\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.preRegister(BaseModelMBean.java:1132) [tomcat-coyote.jar:7.0.27]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.preRegisterInvoke(DefaultMBeanServerInterceptor.java:1010) [na:1.6.0_32]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:938) [na:1.6.0_32]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917) [na:1.6.0_32]\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312) [na:1.6.0_32]\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482) [na:1.6.0_32]\n\tat org.apache.tomcat.util.modeler.Registry.registerComponent(Registry.java:742) [tomcat-coyote.jar:7.0.27]\n\tat org.apache.catalina.core.NamingContextListener.addResource(NamingContextListener.java:1062) [catalina.jar:7.0.27]\n\tat org.apache.catalina.core.NamingContextListener.createNamingContext(NamingContextListener.java:671) [catalina.jar:7.0.27]\n\tat org.apache.catalina.core.NamingContextListener.lifecycleEvent(NamingContextListener.java:270) [catalina.jar:7.0.27]\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119) [catalina.jar:7.0.27]\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90) [catalina.jar:7.0.27]\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5161) [catalina.jar:7.0.27]\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150) [catalina.jar:7.0.27]\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:895) [catalina.jar:7.0.27]\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:871) [catalina.jar:7.0.27]\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:615) [catalina.jar:7.0.27]\n\tat org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:649) [catalina.jar:7.0.27]\n\tat org.apache.catalina.startup.HostConfig$DeployDescriptor.run(HostConfig.java:1585) [catalina.jar:7.0.27]\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) [na:1.6.0_32]\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) [na:1.6.0_32]\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138) [na:1.6.0_32]\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) [na:1.6.0_32]\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) [na:1.6.0_32]\n\tat java.lang.Thread.run(Thread.java:662) [na:1.6.0_32]", "creator": "anthonygerrard+apache.org@gmail.com", "is_private": false, "id": 160007, "time": "2012-06-14T13:37:06Z", "bug_id": 53416, "creation_time": "2012-06-14T13:37:06Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 53416, "attachment_id": 29000, "id": 160275, "time": "2012-06-26T20:32:59Z", "creator": "fhanik@apache.org", "creation_time": "2012-06-26T20:32:59Z", "is_private": false, "text": "Created attachment 29000\nJMX Registration of two pools\n\nThe name of the JMX bean that gets registered is unique to the web application, so your example must have something else wrong\n\nI've attached an image of what JMX registration looks like when two web applications define an identical data source\n\nIf we examine your object name:\n\ntomcat.jdbc:name=\"jdbc/soscvuk\",context=/,type=ConnectionPool,host=localhost,class=org.apache.tomcat.jdbc.pool\n\nyou can see that it contains the 'context' and the 'host' as part of the name. Two web applications can not have the same context.\n\nThere must be something misconfigured in your application."}, {"count": 2, "tags": [], "bug_id": 53416, "attachment_id": null, "id": 160276, "time": "2012-06-26T20:33:44Z", "creator": "fhanik@apache.org", "creation_time": "2012-06-26T20:33:44Z", "is_private": false, "text": "Tested, unable to reproduce.\nPlease reopen with enough information to reproduce the issue, and I will take another look at it."}, {"count": 3, "tags": [], "bug_id": 53416, "text": "We have two services with one web application in each.  One is for our secure site and one for our non secure.  We use Apache as the ssl endpoint and reverse proxy using ajp connectors.  Both web applications have the root context in their service.  This configuration works and we had no problems with the default connection pooling.  I got the error when switching to the tomcat connection pool.\n\nOur server.xml looks something like\n\n<Server>\n  <Service name=\"Catalina\">\n    <Engine name=\"Catalina\" defaultHost=\"${host.mainsite.name}\">\n      <Host name=\"${host.mainsite.name}\" \n            appBase=\"webapps/${host.mainsite.name}\" unpackWARs=\"true\" \n            autoDeploy=\"false\">\n      </Host>\n    </Engine>\n  </Service>\n\n  <Service name=\"Catalina-Secure\">\n    <Engine name=\"Catalina-Secure\" defaultHost=\"${host.mainsite.name}\">\n      <Host name=\"${host.mainsite.name}\" \n          appBase=\"webapps/${host.mainsite.name}-ssl\" unpackWARs=\"true\" \n          autoDeploy=\"false\">\n      </Host>\n    </Engine>\n  </Service>\n</Server>\n\nI've subsequently worked around this using <ResourceLink /> which I think is more appropriate for our set-up anyway.  However I still think this is a bug.", "id": 160278, "attachment_id": null, "creator": "anthonygerrard+apache.org@gmail.com", "creation_time": "2012-06-26T21:05:11Z", "time": "2012-06-26T21:05:11Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 53416, "text": "Use of multiple versions of a web application may also trigger the issue (I haven't tested it).", "id": 160279, "time": "2012-06-26T21:12:29Z", "creator": "markt@apache.org", "creation_time": "2012-06-26T21:12:29Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 53416, "attachment_id": null, "text": "Roger, I will fix this.", "id": 160298, "time": "2012-06-27T17:20:56Z", "creator": "fhanik@apache.org", "creation_time": "2012-06-27T17:20:56Z", "is_private": false}, {"count": 6, "tags": [], "text": "(In reply to comment #4)\n> Use of multiple versions of a web application may also trigger the issue (I\n> haven't tested it).\n\nThat wont be issue, as the ObjectName will have something like context=/test##001 instead of context=/test\n\nthe problem we encountered here is that the JNDI names in tomcat 6 would have path=/test whereas 7 has context=/test", "is_private": false, "id": 160299, "creator": "fhanik@apache.org", "time": "2012-06-27T17:32:59Z", "bug_id": 53416, "creation_time": "2012-06-27T17:32:59Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 53416, "is_private": false, "id": 160301, "attachment_id": null, "creator": "fhanik@apache.org", "creation_time": "2012-06-27T17:38:30Z", "time": "2012-06-27T17:38:30Z", "text": "Fixed in r1354641 (trunk)\nFixed in r1354642 (7.0.x)"}]
[{"count": 0, "attachment_id": null, "bug_id": 29626, "text": "When a webdav client sends a request like the following\n\n    GET /slide/files/Letter2004.rtf HTTP/1.1\\r\\n\n    Accept-Language: en-nz, en-us;q=0.5\\r\\n\n    If: (<opaquelocktoken:5d6d1a6368cde25d9d5c8bf2530182dd>)\\r\\n\n    If-None-Match: 87ec191bbb33904a37f1b41d048c2218\\r\\n\n    Translate: f\\r\\n\n    User-Agent: Microsoft Data Access Internet Publishing Provider DAV 1.1\\r\\n\n    Host: gamma\\r\\n\n    Connection: Keep-Alive\\r\\n\n    Cookie: JSESSIONID=4A13D5993D2BDC906C9276A3EF1CE447\\r\\n\n\n(This came from MS Word 2000. NOTE: HTTP/1.1 doesn't define an If header)\n\nThe server should reply with status 304 if the ETag of the document matches\nthe ETag supplied in the If-None-Match header, otherwise the request should be\nprocessed as if no If-None-Match header had been supplied.\n\nThe code from AbstractWebDavMethod.java will return status 304 if none \nof the If-None-Match tags match the document, which is the opposite of\nwhat should happen\n\ncommaTokenizer = new StringTokenizer(headerValue, \",\");\nboolean conditionSatisfied = true;\n\nwhile (conditionSatisfied && commaTokenizer.hasMoreTokens()) {\n   String currentToken = commaTokenizer.nextToken();\n   if (currentToken.trim().equals(eTag))\n   conditionSatisfied = false;\n}\n\nif (conditionSatisfied) {\n\n// For GET and HEAD, we should respond with\n// 304 Not Modified.\n// For every other method, 412 Precondition Failed is sent\n// back.\n\n\nThe last test should probably read \n   \n     if (!conditionSatisfied) {\n\nI have also discovered that the eTag for a document has \" chars wrapped\naround it (This is done in getETag method), However the client doesn't\nprovide these quotes and an ETag match will never succeed. Is this a \nbug in the client or the server?", "id": 59375, "time": "2004-06-17T02:31:18Z", "creator": "richard.hardy@solnetsolutions.co.nz", "creation_time": "2004-06-17T02:31:18Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "luetzkendorf@apache.org", "is_private": false, "text": "Yes, you are right.\n\nThe first (the missing negation) is a real slide bug.\nThe second is a Bug at the client because RFC2616 whans the etags\nin '\"', but we shold have a workaraound for that.\n\nI'll try to resolve this next days. \n\nThanks, Stefan", "id": 59413, "time": "2004-06-17T13:14:14Z", "bug_id": 29626, "creation_time": "2004-06-17T13:14:14Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 29626, "text": "Fixed on CVS HEAD, Stefan", "id": 59433, "time": "2004-06-17T17:35:57Z", "creator": "luetzkendorf@apache.org", "creation_time": "2004-06-17T17:35:57Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 29626, "attachment_id": null, "text": "If slide expects that the ETag be enclosed in \", should outgoing responses\nalso add the \" char.\n\nie. Ethereal shows the following packet trace from slide in response to a GET\n\nHypertext Transfer Protocol\n    HTTP/1.1 200 OK\\r\\n\n    Date: Thu, 17 Jun 2004 20:53:26 GMT\\r\\n\n    Server: Apache/1.3.27 (Unix)  (Red-Hat/Linux) mod_jk/1.2.4 mod_ssl/2.8.12\nOpenSSL/0.9.6b DAV/1.0.3\\r\\n\n    Set-Cookie: JSESSIONID=5703CE50B15D57ECC96EB56B68EAF785; Path=/slide\\r\\n\n    ETag: f474dea9674df91e55101e77aab915f3\\r\\n\n    Content-Language: en\\r\\n\n    Last-Modified: Thu, 17 Jun 2004 03:23:26 GMT\\r\\n\n    Content-Length: 241\\r\\n\n    Connection: close\\r\\n\n    Content-Type: text/plain\\r\\n\n    \\r\\n\n    Data (241 bytes)\n\nThe ETag has no \" chars, and the client is just sending back in the\nIf-None-Match header what it has been sent previously.\n\nRichard.", "id": 59438, "time": "2004-06-17T21:06:15Z", "creator": "richard.hardy@solnetsolutions.co.nz", "creation_time": "2004-06-17T21:06:15Z", "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 29626, "text": "Yes, I've changed this too.", "id": 59650, "time": "2004-06-21T08:52:10Z", "creator": "luetzkendorf@apache.org", "creation_time": "2004-06-21T08:52:10Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 48934, "attachment_id": null, "id": 135425, "time": "2010-03-18T11:09:23Z", "creator": "fujino.keiichi@oss.ntt.co.jp", "creation_time": "2010-03-18T11:09:23Z", "is_private": false, "text": "I found cluster's regression in Tomcat6.0.26. \n\nThe reproduction is as follows.\n=====\nThe cluster is composed of tomcat1 and tomcat2. \n(Transport className is org.apache.catalina.tribes.transport.nio.PooledParallelSender.\n Perhaps, I think PooledMultiSender to be the same. )\nTomcat2 is stopped during session replication. \nAs a result, Session replication failed and ChannelException is thrown. \nTomcat2 restart. \nSession replication again.\nAs a result, following exception is thrown.\norg.apache.catalina.tribes.ChannelException: Sender not connected.; No faulty members identified.\n=====\n\nThe cause is \nhttp://svn.apache.org/viewvc?view=revision&revision=908741\nWhen replication fails, sender is disconnected by this fix.\n\nThe disconnect method is as follows in PooledParallelSender. \n===\npublic synchronized void disconnect() {\n    this.connected = false;\n    super.disconnect();\n    \n}\n===\nthis.connected is set to false, and super.disconnect() is called. \nIn super.disconnect(), the queue is closed. \n\nI think.\nif connected is set to false once, it never becomes true again. \nand\nif queue is closed once, it never opened again.\nIt is only ReplicationTransmitter#start to be able to set connected to true.\nIt is also the same to open the queue.\n\nAs a result,\nwhen replication fails once, replication can be never done again.\n\nI do not know the reason why r908741 is applied. \nHowever, if ChannelException is thrown once, it becomes impossible to use all Sender.\nThis is not good thing.\n\nCan revert r908741 ?\nIf it is not possible, what is the reason for the r908741?\n\nBest regards."}, {"attachment_id": 25146, "tags": [], "creator": "fhanik@apache.org", "is_private": false, "count": 1, "id": 135430, "time": "2010-03-18T13:56:35Z", "bug_id": 48934, "creation_time": "2010-03-18T13:56:35Z", "text": "Created attachment 25146\nBug fix\n\nDear Fujino, as always you are right. The intended fix was to close sockets that were potentially left in a CLOSE_WAIT state when something went wrong. But instead of closing the actual sender that holds the TCP sockets, I accidentally closed the entire sender system"}, {"attachment_id": null, "tags": [], "bug_id": 48934, "text": "This has been fixed in 6.0.x and will be included in 6.0.27 onwards.", "count": 2, "id": 136007, "time": "2010-04-11T10:11:49Z", "creator": "markt@apache.org", "creation_time": "2010-04-11T10:11:49Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 23571, "text": "Each time the xindice webapp context is restarted or reloaded a new \njava.util.TimerThread is created that lives until the jvm is stopped. This \neventually eats up all of the availiable memory and causes xindice to become \nunresponsive and throw OutOfMemory Errors.\n\nI tracked down the creation of this thread to the \norg.apache.xindice.core.indexer.IndexManager class. Every time this class is \nloaded a static variable gets assigned a new java.util.Timer object which \ncreates a thread.\n\n    private static final Timer indexTimer = new Timer( true );\n\nI fixed the problem on our application by adding the following method to the \nIndexManager class.\n\n    protected void finalize(){\n        indexTimer.cancel();\n    }\n\nThis is just a hack and will probably cause errors with indexing.\n\nYou can use the following to test see what is going on each time you restart a \ncontext.\nRuntime run = Runtime.getRuntime();\n\nSystem.out.println(\"Thread count is \" + Thread.activeCount());\nSystem.out.println(\"Free memory \" + run.freeMemory());\nSystem.out.println(\"Total memory \" + run.totalMemory());\n\nI've tested this on Tomcat 4 running on WinXP Pro and on a Unix box and seen \nthe same issue.", "id": 45017, "time": "2003-10-02T14:39:02Z", "creator": "franqueli_mendez@merck.com", "creation_time": "2003-10-02T14:39:02Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 23571, "text": "Suggested hack will cause indexing problem after just one collection is removed:\nTimer is static, and each collection has IndexManager. Once collection is\nremoved, its IndexManager should get garbage collected (and finalized), and\ncancelling the timer will break indexing in all other collections.\n\nProper solution should be to implement scheduling (cron) service; see also FIXME\nnote in IndexManager.", "id": 54310, "time": "2004-03-20T14:11:25Z", "creator": "vgritsenko@apache.org", "creation_time": "2004-03-20T14:11:25Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 23571, "text": "fixed", "id": 95409, "time": "2006-11-03T20:26:25Z", "creator": "vgritsenko@apache.org", "creation_time": "2006-11-03T20:26:25Z", "tags": [], "is_private": false}]
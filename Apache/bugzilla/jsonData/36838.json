[{"attachment_id": null, "tags": [], "bug_id": 36838, "text": "Hi,\n\nMy JVM (Sun 1.5.0_04) shows that the Jboss class\norg.jnp.interfaces.NamingContextFactory is loaded from ant.jar. Here's the\noutput when I start ant with plain 'ant' call (without any -lib parameter and\nANT_OPTS is set to -verbose:class) \n\n[FalezDeployRMI] FalezDeployRMI is running\n[FalezDeployRMI] 0\n[Loaded com.sun.naming.internal.ResourceManager from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12 from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded java.util.WeakHashMap from shared objects file]\n[Loaded java.util.WeakHashMap$Entry from shared objects file]\n[Loaded com.sun.naming.internal.VersionHelper12$2 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$6 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$5 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded javax.naming.NamingEnumeration from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$InputStreamEnumeration from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$InputStreamEnumeration$1 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$4 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[FalezDeployRMI] 1\n[Loaded javax.naming.spi.InitialContextFactory from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded javax.naming.spi.ObjectFactory from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded org.jnp.interfaces.NamingContextFactory from\nfile:/C:/dev/tools/ant/lib/ant.jar]\n[Loaded javax.naming.Name from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[FalezDeployRMI] 2\n[Loaded org.apache.tools.ant.util.DateUtils from file:/C:/dev/tools/ant/lib/ant.jar]\n[Loaded java.text.ChoiceFormat from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded java.text.MessageFormat from shared objects file]\n[Loaded java.text.MessageFormat$Field from shared objects file]\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n[Loaded java.lang.Shutdown from shared objects file]\n[Loaded java.lang.Shutdown$Lock from shared objects file]\n\nNote: FalezDeployRMI is a custom Ant task.\n\nHowever, the class is in fact stored in Jboss jars. Indeed, when I start and as\n'ant -ant -lib c:\\dev\\tools\\zzjboss\\client\\jbossall-client.jar', the output is\nnow correct:\n\n[FalezDeployRMI] FalezDeployRMI is running\n[FalezDeployRMI] 0\n[Loaded com.sun.naming.internal.ResourceManager from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12 from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded java.util.WeakHashMap from shared objects file]\n[Loaded java.util.WeakHashMap$Entry from shared objects file]\n[Loaded com.sun.naming.internal.VersionHelper12$2 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$6 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$5 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded javax.naming.NamingEnumeration from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$InputStreamEnumeration from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$InputStreamEnumeration$1 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded com.sun.naming.internal.VersionHelper12$4 from\nc:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[FalezDeployRMI] 1\n[Loaded javax.naming.spi.InitialContextFactory from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded javax.naming.spi.ObjectFactory from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[Loaded org.jnp.interfaces.NamingContextFactory from\nfile:/c:/dev/tools/zzjboss/client/jbossall-client.jar]\n[Loaded javax.naming.Name from c:\\dev\\java\\jdk\\jre\\lib\\rt.jar]\n[FalezDeployRMI] 2\n[Loaded org.apache.tools.ant.util.DateUtils from file:/C:/dev/tools/ant/lib/ant.jar]\n\nDon't understand why Ant classloader (maybe delegating to parent classloader)\nreports that it loads a nonexisting class from the ant.jar library. \n\nHere's the excerpt from the build.xml file:\n\t<path id=\"devhelppath\">\n\t\t<path path=\"${java.class.path}\"/>\n\t\t<fileset file=\"${falez.build.dhpath}\"/>\n\t\t<fileset dir=\"c:\\dev\\tools\\zzjboss\\client\"/>\n\t\t<fileset dir=\"c:\\dev\\tools\\zzjboss\\lib\"/>\n\t\t<fileset dir=\"c:\\dev\\tools\\zzjboss\\server\\all\\lib\"/>\n\t</path>\n\t<target name=\"testFalezDeployRMI\">\n    \t<taskdef name=\"FalezDeployRMI\"\nclassname=\"org.falez.devhelp.BuildHelper.FalezDeployRMI\" \n    \t\tclasspathref=\"devhelppath\"/>\n\t\t<FalezDeployRMI hostip=\"127.0.0.1\" hostport=\"8787\" file=\"hoba\"/>\n\t</target>\n\nAnd the task only does the following (stripped down version):\t\n\t@Override\n\tpublic void execute() throws BuildException {\n\t\ttry {\n\t\t\tlog(\"0\");\n\t\t\tInitialContext context = new InitialContext();\n\t\t\tlog(\"1\");\n\t\t\tNamingContextFactory factory = new NamingContextFactory();\n\t\t\tlog(\"2\");\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\nThanks for your time,\nBulent Erdemir", "count": 0, "id": 80542, "time": "2005-09-28T10:57:12Z", "creator": "bulente@gmail.com", "creation_time": "2005-09-28T10:57:12Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jkf@apache.org", "text": "Maybe this is an error in the jvm, it seems the classloader that loaded the\nclass was loaded from ant.jar, and that the jvm then thinks, when reporting the\nloaded class, that the class is also loaded from ant.jar. (ant.jar does not\ncontain the file you mention, so it is not possible it loads it from that jar file).\n\nPlease also add ant debug information (start ant with the -debug flag) at the\nsame time, to enable further analysis.", "id": 80662, "time": "2005-10-01T13:53:27Z", "bug_id": 36838, "creation_time": "2005-10-01T13:53:27Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "This is a consequence of antclassloader not setting\nthe codebase for created classes.\n\n*** This bug has been marked as a duplicate of 20174 ***", "is_private": false, "id": 94502, "creator": "peterreilly@apache.org", "time": "2006-10-04T14:39:25Z", "bug_id": 36838, "creation_time": "2006-10-04T14:39:25Z", "attachment_id": null}]
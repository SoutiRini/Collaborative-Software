[{"count": 0, "tags": [], "bug_id": 59558, "is_private": false, "id": 190973, "creation_time": "2016-05-15T13:19:15Z", "time": "2016-05-15T13:19:15Z", "creator": "toscano.luca@gmail.com", "text": "Hello!\n\nA couple of improvements might be done after this email thread in users@: http://www.gossamer-threads.com/lists/apache/users/458433\n\n1) AH01754 error message should give more hints about what is the problem and how to correct it. Example:\n\n[Thu May 05 18:12:29.915467 2016] [authn_dbm:error] [pid 9107:tid 140031532377856] (20019)DSO load failed: [client 127.0.0.1:54442] AH01754: could not open dbm (type DB) auth file: /home/tixu/httpd-2.4.20-bin/dbm-auth-file\n\nThe solution was to add --with-berkeley-db to httpd's configure and install something like libdb-dev(evel)* on the target system.\n\n\n2) the option --with-berkeley-db is present in APR's configure help but not in the httpd's one. Since it is probably passed down as it is to APR when using --with-included-apr, it might be good to add a note in the httpd's configure help message.\n\nLuca", "attachment_id": null}, {"count": 1, "tags": [], "creator": "toscano.luca@gmail.com", "attachment_id": null, "id": 190974, "creation_time": "2016-05-15T13:22:25Z", "time": "2016-05-15T13:22:25Z", "bug_id": 59558, "text": "Email thread on mail-archies.apache.org:\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-users/201605.mbox/%3CCABBDWwcrO1T=ytFuYyYmWDG+AEsbOqKgW-WN9SL3f30sPzfPcQ@mail.gmail.com%3E", "is_private": false}, {"count": 2, "tags": [], "bug_id": 59558, "attachment_id": null, "is_private": false, "id": 190975, "time": "2016-05-15T13:41:10Z", "creator": "toscano.luca@gmail.com", "creation_time": "2016-05-15T13:41:10Z", "text": "Found a reference in the docs about 2):\n\nhttps://httpd.apache.org/docs/current/programs/configure.html#options"}, {"count": 3, "attachment_id": null, "bug_id": 59558, "is_private": false, "id": 190977, "time": "2016-05-15T19:17:43Z", "creator": "tixu@cs.ucsd.edu", "creation_time": "2016-05-15T19:17:43Z", "tags": [], "text": "Thanks Luca!\n\nA note for the log message: the key information missing here (which puzzled me in the first place) is that the current logs do not tell which DSO file (\"lib/apr-util-1/apr_dbm_db-1.so\") it fails to load. Instead, the current msg confused me to believe the problem comes from the auth file. \n\nIf we know the error is caused by missing \"lib/apr-util-1/apr_dbm_db-1.so\", the direction would be clear. \n\nI think a log msg would be printed out when DSO loading fails (e.g., upon the failure of dlopen)"}, {"count": 4, "tags": [], "bug_id": 59558, "is_private": false, "text": "Also, from the user's perspective, it's better to improve the docs of mod-auth-dbm if possible,\nhttps://httpd.apache.org/docs/current/mod/mod_authn_dbm.html\n\nThe current docs have too little information. For example, in the AuthDBMType entry, there's even no description of the options like SDBM|GDBM|NDBM|DB. When I encountered the error, my first reaction was \"ohh, perhaps DB is not Berkeley DB?\" I couldn't make sure of this until Luca replied on the mailing list...\n\nThanks!", "id": 190978, "time": "2016-05-15T19:24:39Z", "creator": "tixu@cs.ucsd.edu", "creation_time": "2016-05-15T19:24:39Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 59558, "attachment_id": null, "id": 190979, "time": "2016-05-15T21:08:26Z", "creator": "toscano.luca@gmail.com", "creation_time": "2016-05-15T21:08:26Z", "is_private": false, "text": "As temp step I updated the  trunk documentation with some useful info:\n\nhttps://httpd.apache.org/docs/trunk/mod/mod_authn_dbm.html#authdbmtype\n\nWill backport it to 2.4 later on!"}, {"count": 6, "tags": [], "bug_id": 59558, "attachment_id": null, "is_private": false, "id": 191008, "time": "2016-05-17T06:25:50Z", "creator": "toscano.luca@gmail.com", "creation_time": "2016-05-17T06:25:50Z", "text": "2.4 documentation updated too:\n\nhttps://httpd.apache.org/docs/current/mod/mod_authn_dbm.html\n\nRemaining to do:\n\n1) Check if AH01754 error message could be improved.\n2) Maybe add a note in http's config about DBM options passed to APR?"}, {"count": 7, "tags": [], "creator": "tixu@cs.ucsd.edu", "is_private": false, "id": 191009, "creation_time": "2016-05-17T07:08:40Z", "time": "2016-05-17T07:08:40Z", "bug_id": 59558, "text": "For 1),\n\nGiven the current code log, it may not be trivial to change Log AH01754 (the DSO loading is invisible at that time). A straightforward way is to add an error log in dbm_open_type() in srclib/apr-util/dbm/apr_dbm.c or directly in apu_dso_load() in srclib/apr-util/misc/apu_dso.c when the loading fails.\n\nBut these are in the apr-util library, so I don't know whether adding logs there is appropriate. \n\nOn the other hand, if the users build the correct DSO files, they won't encounter this problem.\n\n~t", "attachment_id": null}, {"count": 8, "tags": [], "creator": "toscano.luca@gmail.com", "is_private": false, "id": 191047, "creation_time": "2016-05-18T06:40:28Z", "time": "2016-05-18T06:40:28Z", "bug_id": 59558, "text": "Didn't check the code but for 1) I suspected too that it would have been hard. So maybe adding some notes in the configure could be doable and useful, but what do you think about the documentation? Would you have resolved the problem with the new note or should I add more?\n\nLuca", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 59558, "is_private": false, "id": 191049, "creation_time": "2016-05-18T07:00:35Z", "time": "2016-05-18T07:00:35Z", "creator": "tixu@cs.ucsd.edu", "text": "Yes, I would not encounter this problem if the docs have told that I need to configure with --with-berkeley-db. \n\nJust a tiny suggestion: can we also write down the DSO's name (e.g., lib/apr-util-1/apr_dbm_db-1.so) so that the users can check it if they encounter the same issue?", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 59558, "attachment_id": null, "id": 191050, "time": "2016-05-18T07:13:37Z", "creator": "toscano.luca@gmail.com", "creation_time": "2016-05-18T07:13:37Z", "is_private": false, "text": "Might be a bit too implementation oriented, I'd prefer not to add the name to avoid hardcoding detailed information in the docs (that should be able to change in the future without rewriting the docs, even if very unlikely :P)"}, {"count": 11, "tags": [], "bug_id": 59558, "attachment_id": null, "id": 191051, "time": "2016-05-18T07:14:48Z", "creator": "tixu@cs.ucsd.edu", "creation_time": "2016-05-18T07:14:48Z", "is_private": false, "text": "make sense. Thanks, Luca!"}]
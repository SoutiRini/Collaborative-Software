[{"count": 0, "tags": [], "text": "Created attachment 25996\nPatch to ParsedURLData.java to support reading the alternate stream.\n\nIf an SVG image contains a reference to an external image that should be read from a webserver, and that webserver returns the image back with a 404 header (indicating that the desired address was not found), the contents of the response is discarded, and Batik throws an exception.\n\nThis prevents using Apache ErrorDocument directives to have default images as the back-end.\n\nAs there's no reason to assume that just because the response was an error we should discard the result (the response could still be a valid image), a better approach would be to catch the corresponding error when trying to read the stream and switch the ErrorStream instead.\n\nI've attached a patch to org.apache.util.ParsedURLData.java that supports this modification.\n\nOther SVG Renderers (e.g. Google Chrome, Firefox, etc.) seem to operate this way (i.e. they pull in the data from the image regardless of the status code of the response).", "attachment_id": 25996, "bug_id": 49889, "id": 139730, "time": "2010-09-07T06:38:16Z", "creator": "andrewsc@gmail.com", "creation_time": "2010-09-07T06:38:16Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 49889, "attachment_id": null, "id": 140433, "time": "2010-10-04T06:59:49Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-04T06:59:49Z", "is_private": false, "text": "This was first reported in the mailing list [1]. Although similar, the original description is (also) worth reading. :-)\n\n\n(from the original report [1])\n> With the current builds of Batik, in the event that an external source is\n> obtained from an HTTP request that returns a non-2XX code, an IO Exception\n> is thrown.  This means that if, for example, there was a folder of images\n> with a \"default\" image available set up via a .htaccess file, Batik would\n> not support it.\n\nThis sounds a reasonable use-case, overall the fix sounds fine and I'm not seeing any negative side-effects. Thomas? Cameron? DVHolten?\n\n\n> With a similar image configured through other SVG viewers\n> (e.g. Chrome, Firefox, etc.) the image in the 404 file is correctly embedded\n> in the resulting stream.\n\nI haven't double checked for this (images in 404 error handlers being displayed) but I do remember recent related Firefox issues [2] [3] (somehow triggered by Acid3 [4]).\n\n\n@Andrew: I'm not sure what the \"nested\" (in the bug summary) means. Could you elaborate a bit?\n\n\n[1] http://mail-archives.apache.org/mod_mbox/xmlgraphics-batik-dev/201008.mbox/browser#msg-45\n[2] https://bugzilla.mozilla.org/show_bug.cgi?id=299138\n[3] https://bugzilla.mozilla.org/show_bug.cgi?id=281150\n[4] http://acid3.acidtests.org/"}, {"count": 2, "tags": [], "bug_id": 49889, "attachment_id": null, "id": 140434, "time": "2010-10-04T07:22:47Z", "creator": "andrewsc@gmail.com", "creation_time": "2010-10-04T07:22:47Z", "is_private": false, "text": "Sorry - I should've said \"linked\" rather than \"nested\" -- as in an SVG document like:\n\n<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" width=\"364\" height=\"126\">\n    <image width=\"364\" height=\"126\" xlink:href=\"http://www.myimageserver.com/missingimage.png\"/>\n</svg>\n\nOn my imaging server, I then have (in my .htaccess file)\nErrorDocument 404 /defaultimage.png\n\nIf I open the .svg in Firefox/Chrome, it displays the contents of \"defaultimage.png\", whereas Batik throws an Exception."}, {"count": 3, "tags": [], "bug_id": 49889, "attachment_id": 26118, "id": 140441, "time": "2010-10-04T09:01:12Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-04T09:01:12Z", "is_private": false, "text": "Created attachment 26118\nversion with comments and code formatting/white space fixes\n\nImproved patch with comments and code formatting/white space fixes."}, {"count": 4, "tags": [], "text": "(In reply to comment #2)\n> Sorry - I should've said \"linked\" rather than \"nested\" -- as in an SVG document\n\nFixed summary. ;-)\n\n\n> On my imaging server, I then have (in my .htaccess file)\n> ErrorDocument 404 /defaultimage.png\n\nDo you have an online example somewhere? Or, in alternative, could you provide the .htaccess so someone (myself, maybe) can try to setup a test environment?\n\n\n> If I open the .svg in Firefox/Chrome, it displays the contents of\n> \"defaultimage.png\", whereas Batik throws an Exception.\n\nThanks for confirming the Firefox behavior. It would be good to have an idea of how do other implementations (WebKit, IE9, etc.) behave in order to check if this is consistent (intuitively, it is).", "attachment_id": null, "bug_id": 49889, "id": 140442, "time": "2010-10-04T09:10:05Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-04T09:10:05Z", "is_private": false}, {"count": 5, "tags": [], "creator": "andrewsc@gmail.com", "attachment_id": null, "id": 140444, "time": "2010-10-04T09:44:39Z", "bug_id": 49889, "creation_time": "2010-10-04T09:44:39Z", "is_private": false, "text": "I've put up a simple example at http://mystuff.webfreehosting.net/svg/\n\nIt contains a single line .htaccess file:\n\nErrorDocument 404 /svg/Missing-Image.png\n\nhttp://mystuff.webfreehosting.net/svg/test.svg has an example whereby it tries to retrieve the file \"cannotfind.png\" (which doesn't exist - and falls back to the file 'Missing-Image.png') \n\nHope this helps -- let me know if you need any additional info.\n\nI tried several browsers - Firefox, Chrome & Opera rendered the image with the 404 content inside the image.  Konqueror seemed to have trouble displaying the image, but it didn't like the version with a valid URL either, so it seems to be more fussy than others.  I don't have a Windows environment to try IE9."}, {"count": 6, "tags": [], "creator": "helder.magalhaes@gmail.com", "attachment_id": 26119, "text": "Created attachment 26119\nNegative test case (should always display the default missing/broken image)\n\nI've quickly created a test case, based in the one in comment 5, just to make sure that if an image is actually missing and there's no HTTP error handle setup as desired here, the default missing/broken image is displayed.", "id": 140446, "time": "2010-10-04T10:48:41Z", "bug_id": 49889, "creation_time": "2010-10-04T10:48:41Z", "is_private": false}, {"count": 7, "tags": [], "creator": "helder.magalhaes@gmail.com", "text": "(In reply to comment #0)\n> If an SVG image contains a reference to an external image that should be read\n> from a webserver, and that webserver returns the image back with a 404 header\n> (indicating that the desired address was not found), the contents of the\n> response is discarded, and Batik throws an exception.\n\nThis is true, although it's not clear from this description that the exception is later caught and a default broken/missing image is displayed instead. This is for completeness, I believe the current behavior is much more interesting and consistent with other implementations.\n\n\n(In reply to comment #5)\n> I've put up a simple example at http://mystuff.webfreehosting.net/svg/\n> \n> It contains a single line .htaccess file:\n> \n> ErrorDocument 404 /svg/Missing-Image.png\n> \n> http://mystuff.webfreehosting.net/svg/test.svg has an example whereby it tries\n> to retrieve the file \"cannotfind.png\" (which doesn't exist - and falls back to\n> the file 'Missing-Image.png') \n> \n> Hope this helps -- let me know if you need any additional info.\n\nCool, thanks, I've set this as bug's URL. :-)\n\n\n> I tried several browsers - Firefox, Chrome & Opera rendered the image with the\n> 404 content inside the image.  Konqueror seemed to have trouble displaying the\n> image, but it didn't like the version with a valid URL either, so it seems to\n> be more fussy than others.  I don't have a Windows environment to try IE9.\n\nI've tried with IE9 platform preview 4 [1] (AFAIK, there's already a more recent beta version available but I haven't tried it yet) and the behavior is consistent with other implementations (i.e., \"missing image\" is displayed).\n\nI've also tried with IE8+ASV3 (Adobe SVG Plug-in) and it doesn't follow all other implementations. I guess this is an old known issue in ASV and, due to the fact that it's EOL'ed and is fading away, this is only informative.\n\n\nI've tested Batik without and with this patch applied and (after applying the patch) the behavior seems fine (loading both the bug's URL and the test case added in comment 6). :-)\n\n\nIf there's nothing against, I'll commit this within the next few days. :-)\n\n\n[1] http://blogs.msdn.com/b/ie/archive/2010/08/04/html5-modernized-fourth-ie9-platform-preview-available-for-developers.aspx", "id": 140447, "time": "2010-10-04T10:55:26Z", "bug_id": 49889, "creation_time": "2010-10-04T10:55:26Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 49889, "text": "Created attachment 26120\nversion 2: comment fixed\n\nImprove comment while fixing small mess in previous patch.", "id": 140455, "time": "2010-10-04T14:22:56Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-04T14:22:56Z", "is_private": false, "attachment_id": 26120}, {"count": 9, "tags": [], "bug_id": 49889, "text": "(In reply to comment #7)\n> If there's nothing against, I'll commit this within the next few days. :-)\n\nCommitted in revision 1004896. Thanks, Andrew! ;-)", "id": 140502, "time": "2010-10-06T01:44:37Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-06T01:44:37Z", "is_private": false, "attachment_id": null}]
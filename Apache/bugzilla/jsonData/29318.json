[{"count": 0, "attachment_id": null, "creator": "allizgubehcapa@davidgreenaway.com", "text": "The following Perl CGI script causes the Apache worker process to consume huge\namounts of memory (up to 650M for a page about 100k in size.) if the\n'SetOutputFilter DEFLATE' is used.\n\n--- script start ---\n#!/usr/bin/perl\n\nprint \"Content-Type: text/plain\\n\\n\";\n\n$| = 1; # flush output\n\nfor (my $i = 0; $i < 100000; $i++) {\n        print \"moo\\n\";\n}\n--- script end ---\n\nBy commenting out the line 'flush output' and trying again, the page is served\nwithout any problems. Removing 'SetOutputFilter DEFLATE' also allows the page to\nbe served without any trouble.\n\nChanging the values of 'DeflateMemLevel', 'DeflateCompressionLevel' and\n'DeflateBufferSize' do not affect the behaviour. However, if 'DeflateWindowSize'\nis <= 7, the problem goes away. At the value 8, the problem appears randomly\n(approximately one in two requests.) As the value increases, the probability of\nthe process 'blowing up' increases. At a value of 15, the apache worker process\nalways appears to blow up.\n\nThe script is being run with 'cgi-script', and not mod_perl. The same symptoms\nare experienced if the perl script is replaced with an identical compiled C program:\n\n--- script start ---\n#include <stdio.h>\n\nint main(void)\n{\n        int i;\n        printf(\"Content-Type: text/plain\\n\\n\");\n        for (i = 0; i < 100000; i++) {\n                printf(\"moo\\n\");\n                fflush(stdout); /* flush output */\n        }\n\n        return 0;\n}\n--- end start ---", "id": 58445, "time": "2004-06-01T10:06:29Z", "bug_id": 29318, "creation_time": "2004-06-01T10:06:29Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 29318, "attachment_id": null, "is_private": false, "id": 58454, "time": "2004-06-01T13:21:43Z", "creator": "jorton@redhat.com", "creation_time": "2004-06-01T13:21:43Z", "text": "Thanks for the report.  Fixed on HEAD:\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/modules/filters/mod_deflate.c?r1=1.48&r2=1.49\n\nand backport which does the same for 2.0:\n\nhttp://cvs.apache.org/~jorton/ap_deflate.diff\n\nThis should prevent the massive memory consumption with large responses\nregardless of DeflateWindowSize setting."}, {"count": 2, "tags": [], "bug_id": 29318, "attachment_id": null, "id": 58538, "time": "2004-06-02T11:25:04Z", "creator": "allizgubehcapa@davidgreenaway.com", "creation_time": "2004-06-02T11:25:04Z", "is_private": false, "text": "Confirmed fixed.\n\nThanks Joe! :)"}]
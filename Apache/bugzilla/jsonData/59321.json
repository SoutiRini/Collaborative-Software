[{"count": 0, "tags": [], "creator": "dir@obo.org", "is_private": false, "text": "1.9.6 builds just fine on (uname -a output):\n     SunOS rcbuild-solaris10 5.10 Generic_150401-23 i86pc i386 i86pc Solaris\n\n1.9.7 gets an error during the build:\n   [snip]\n   BUILD SUCCESSFUL\n   Total time: 8 seconds\n   ... Cleaning Up Build Directories\n   ... Done Bootstrapping Ant Distribution\n   bootstrap/bin/ant: syntax error at line 339: `end of file' unexpected\n\n'what /bin/sh' shows:\n   SunOS 5.10 Generic 142252-02 Sep 2010\n\nI used the same command line to start the build on this SunOS machine for both 1.9.6 and 1.9.7:\n   sh build.sh -Ddist.dir=/export/home/drosen/ant dist", "id": 190247, "time": "2016-04-14T15:27:47Z", "bug_id": 59321, "creation_time": "2016-04-14T15:27:47Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "thomas.stecher@bgr.de", "text": "This also happens on Linux (tested on SLES12.1)", "id": 190691, "time": "2016-05-02T13:44:23Z", "bug_id": 59321, "creation_time": "2016-05-02T13:44:23Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 59321, "text": "(In reply to Thomas Stecher from comment #1)\n> This also happens on Linux (tested on SLES12.1)\n\nThat's not completly right. I tried to run the distribution on Solaris and SLES 12.1 and it's broken.\n\n> ./apache-ant-1.9.7/bin/ant\n./apache-ant-1.9.7/bin/ant: syntax error at line 339: `end of file' unexpected", "count": 2, "id": 190692, "time": "2016-05-02T14:00:54Z", "creator": "thomas.stecher@bgr.de", "creation_time": "2016-05-02T14:00:54Z", "is_private": false}, {"count": 3, "tags": [], "creator": "pfalcone@itrsgroup.com", "is_private": false, "text": "An easy workaround is to specify Bash as the default shell:\n\n# diff -ur /usr/ant-1.9.7/bin/ant /tmp/ant\n--- /usr/ant-1.9.7/bin/ant      Tue May 17 14:15:43 2016\n+++ /tmp/ant    Tue May 17 14:18:23 2016\n@@ -1,4 +1,4 @@\n-#! /bin/sh\n+#! /bin/bash\n\n # Licensed to the Apache Software Foundation (ASF) under one or more\n # contributor license agreements.  See the NOTICE file distributed with\n\n\nIt seems that \"Bash\"-isms has creeped inside the ant wrapper script.", "id": 191025, "time": "2016-05-17T14:19:21Z", "bug_id": 59321, "creation_time": "2016-05-17T14:19:21Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 59321, "attachment_id": null, "is_private": false, "id": 191179, "time": "2016-05-23T08:14:12Z", "creator": "thomas.stecher@bgr.de", "creation_time": "2016-05-23T08:14:12Z", "text": "That change works fine. Thanks a lot!\n\nBut remember that not all Unix-style OS like Solaris have a bash by default. \n\nWhat do we have to do to get this fix getting delivered with the next release?"}, {"count": 5, "tags": [], "text": "Resolved, recommnd moving back to 1.9.6\n\n1.9.7 has an unmatched double quote in the ant script.\n\n ant_exec_args=\"$ant_exec_args \\\"$(printf '%s' \"$arg\" | sed -e 's@\"\\|\\\\@\\\\\\0@g' )\\\"\"\n\nNot sure how I got this in my distribution, but I moved to 1.9.6 with no problem.  In 1.9.6 the line reads.\n\nant_exec_args=\"$ant_exec_args \\\"$arg\\\"\"", "is_private": false, "id": 191458, "creator": "daniel.lebovitz@hilton.com", "time": "2016-06-07T20:29:02Z", "bug_id": 59321, "creation_time": "2016-06-07T20:29:02Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 59321, "attachment_id": null, "text": "There have been two changes to the wrapper script between 1.9.6 and 1.9.7 and I'd like to figure out, whether only one of them needs to be reverted or adapted or both of them,\n\nOne is commit 568c3ee https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blobdiff;f=src/script/ant;h=6baf1212b6455eb330094799fff8a45af2778f6d;hp=4c1f7509bb3581b9f6e7e2d4b2842c544a5c473e;hb=568c3eeb96badf1e47380fd3e641cfc9a9ee935e;hpb=14e71c1a93be081c764e2fa54f957b907af6861d for Bug 58898 and is the one you call out, the other change is commit 14e71c1 https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blobdiff;f=src/script/ant;h=4c1f7509bb3581b9f6e7e2d4b2842c544a5c473e;hp=b5ed5be6a8fe3a08d26dea53ea0fb3f5fab45e3f;hb=14e71c1a93be081c764e2fa54f957b907af6861d;hpb=790987e702966047b786f1fcbbbe554528f09d77 for Bug 58874\n\nIt would be great if you could try the wrapper scripts with either patch applied and tell us which combination breaks the build for you.", "id": 192292, "time": "2016-07-11T16:16:39Z", "creator": "bodewig@apache.org", "creation_time": "2016-07-11T16:16:39Z", "is_private": false}, {"count": 7, "tags": [], "creator": "bodewig@apache.org", "text": "This may be a duplicate of Bug 59898 (which has been opened later than this one, but contained a proposed fix). Could you please give the current wrapper script <https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob_plain;f=src/script/ant;h=043f3fc20f8e26d76761d0efcd9d485078a81cca;hb=ad8630572286b10e845e74988b45028af3094266> a try and report whether the problem still exists?\n\nMany thanks!", "id": 192629, "time": "2016-07-25T14:35:21Z", "bug_id": 59321, "creation_time": "2016-07-25T14:35:21Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "I've tried the wrapper script from:\n\nhttps://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob_plain;f=src/script/ant;h=043f3fc20f8e26d76761d0efcd9d485078a81cca;hb=ad8630572286b10e845e74988b45028af3094266\n\n\n...and the problem still occurred:\n\n$ ./ant\n./ant: syntax error at line 339: `end of file' unexpected\n\n.. tested on:\n\nSolaris 10 10/09 s10x_u8wos_08a X86\nSolaris 10 6/06 s10x_u2wos_09a X86\n\nUsing bash instead of sh on Solaris works however.\n\nSo the diff 'vs' the ant wrapper script in 1.9.7 is:\n\n@@ -1,4 +1,4 @@\n-#! /bin/sh\n+#! /bin/bash\n \n # Licensed to the Apache Software Foundation (ASF) under one or more\n # contributor license agreements.  See the NOTICE file distributed with\n@@ -36,7 +36,7 @@\n       show_help=true\n     fi\n     # wrap all arguments as \"\" strings, escape any internal back-slash or double-quote characters\n-    ant_exec_args=\"$ant_exec_args \\\"$(printf '%s' \"$arg\" | sed -e 's@\"\\|\\\\@\\\\\\0@g' )\\\"\"\n+    ant_exec_args=\"$ant_exec_args \\\"$(printf '%s\\n' \"$arg\" | sed -e 's@\"\\|\\\\@\\\\\\0@g' )\\\"\"\n   fi\n done\n\n$ ant -version\nApache Ant(TM) version 1.9.7 compiled on April 9 2016", "is_private": false, "id": 193542, "creator": "jpenman.smithson@gmail.com", "time": "2016-09-07T11:54:08Z", "bug_id": 59321, "creation_time": "2016-09-07T11:54:08Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 59321, "attachment_id": null, "is_private": false, "id": 193543, "time": "2016-09-07T12:02:11Z", "creator": "bodewig@apache.org", "creation_time": "2016-09-07T12:02:11Z", "text": "Thanks Jamie\n\nwe really don't want to require bash for running Ant, so unless we figure out how to make the script work for \"plain sh\" I'm more willing to revert to the wrapper script of 1.9.6 as it worked for way more people."}, {"count": 10, "tags": [], "creator": "jpenman.smithson@gmail.com", "text": "Created attachment 34221\nEscape arguments for Solaris sh\n\nI've managed to get it working using Solaris sh with a few tweaks to the way that the arguments are escaped, I've attached a patch.\n\nWith the limited testing I have done, it appears to work:\n\n$ ant -log\"f\"ile f\"o\"o\\a.log\nBuildfile: [..]\n$ ls -al fooa.log\n-rw-r--r--   1 devutils other       2445 Sep  7 13:33 fooa.log", "id": 193547, "time": "2016-09-07T12:39:37Z", "bug_id": 59321, "creation_time": "2016-09-07T12:39:37Z", "is_private": false, "attachment_id": 34221}, {"count": 11, "tags": [], "bug_id": 59321, "attachment_id": null, "is_private": false, "id": 193549, "time": "2016-09-07T13:00:17Z", "creator": "jpenman.smithson@gmail.com", "creation_time": "2016-09-07T13:00:17Z", "text": "(In reply to Jamie Penman-Smithson from comment #10)\n> Created attachment 34221 [details]\n> Escape arguments for Solaris sh\n> \n> I've managed to get it working using Solaris sh with a few tweaks to the way\n> that the arguments are escaped, I've attached a patch.\n> \n> With the limited testing I have done, it appears to work:\n> \n> $ ant -log\"f\"ile f\"o\"o\\a.log\n> Buildfile: [..]\n> $ ls -al fooa.log\n> -rw-r--r--   1 devutils other       2445 Sep  7 13:33 fooa.log\n\nI've also tested this on a Linux box (RHEL 6) and it also works there:\n\n$ ant -log\"fi\"le f\\oo\"bar\".log\nBuildfile: build.xml\n$ ls -al foobar.log \n-rw-rw-r--. 1 ecat ecat 1.7K Sep  7 13:58 foobar.log"}, {"count": 12, "tags": [], "text": "Jamie, the current code base contains a change proposed in bug 59898 which only add a \\n inside the printf. Could you please check whether the script of https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob;f=src/script/ant;h=043f3fc20f8e26d76761d0efcd9d485078a81cca;hb=HEAD works for you?", "is_private": false, "bug_id": 59321, "id": 194059, "time": "2016-09-28T18:58:49Z", "creator": "bodewig@apache.org", "creation_time": "2016-09-28T18:58:49Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "bodewig@apache.org", "text": "(In reply to Stefan Bodewig from comment #12)\n> Jamie, the current code base contains a change proposed in bug 59898 which\n> only add a \\n inside the printf. Could you please check whether the script\n> of\n> https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob;f=src/script/ant;\n> h=043f3fc20f8e26d76761d0efcd9d485078a81cca;hb=HEAD works for you?\n\nmore recently updated to also handle backticks and $ signs in https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob;f=src/script/ant;hb=HEAD", "id": 194064, "time": "2016-09-28T19:14:16Z", "bug_id": 59321, "creation_time": "2016-09-28T19:14:16Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "creator": "jpenman.smithson@gmail.com", "text": "On a Solaris system, runninghe version at https://git-wip-us.apache.org/repos/asf?p=ant.git;a=blob;f=src/script/ant;hb=HEAD still results in:\n\n$ ./ant -help\n./ant: syntax error at line 339: `end of file' unexpected\n$\n\nThe patched version I attached works without issue.", "id": 194199, "time": "2016-10-07T13:06:28Z", "bug_id": 59321, "creation_time": "2016-10-07T13:06:28Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "text": "Unfortunately your patched version doesn't work on Linux :-(\n\nI've asked Jeffrey Adamson over at https://github.com/apache/ant/pull/24 and he came up with a variabt that at least seems to work across the shell he and I have tested it (no Solaris, though).\n\nCould you please try the new HEAD version in the master again?\n\nThanks", "id": 194228, "time": "2016-10-08T13:46:48Z", "bug_id": 59321, "creation_time": "2016-10-08T13:46:48Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 59321, "is_private": false, "count": 16, "id": 194760, "time": "2016-11-01T17:45:02Z", "creator": "jpenman.smithson@gmail.com", "creation_time": "2016-11-01T17:45:02Z", "text": "I'm afraid that still doesn't work on Solaris:\n\nfnet-oss-uat1% ./ant\n./ant: syntax error at line 66: `)' unexpected\nfnet-oss-uat1% \n\n...which appears to be a problem with:\n\n      'awk')\n        esc_arg=\"$(printf '%s' \"$esc_arg\" | \"$awk_exec\" '{ gsub(/\\\\/, \"\\\\\\\\\"); print }' )\"\n        esc_arg=\"$(printf '%s' \"$esc_arg\" | \"$awk_exec\" '{ gsub(/\\$/, \"\\\\$\");  print }' )\"\n        esc_arg=\"$(printf '%s' \"$esc_arg\" | \"$awk_exec\" '{ gsub(/\\\"/, \"\\\\\\\"\"); print }' )\"\n        esc_arg=\"$(printf '%s' \"$esc_arg\" | \"$awk_exec\" '{ gsub(/`/,  \"\\\\`\");  print }' )\"                                                                                         \n\n(more specifically the last line where it is escaping back-ticks)"}, {"count": 17, "tags": [], "text": "supposed to be fixed with 1.9.8 and 1.10.0\n\n*** This bug has been marked as a duplicate of bug 59898 ***", "is_private": false, "bug_id": 59321, "id": 195763, "time": "2016-12-31T11:10:16Z", "creator": "bodewig@apache.org", "creation_time": "2016-12-31T11:10:16Z", "attachment_id": null}]
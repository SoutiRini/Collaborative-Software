[{"count": 0, "tags": [], "bug_id": 6709, "attachment_id": null, "text": "1.Put an image on a protected area like examples/jsp/security/protected/tomcat.gif\n\n2. get this image: http://localhost:8080/examples/jsp/security/protected/tomcat.gif\n\n3. Form opens -> authenticate\n\n4. the image is displayed. on IE rightclick the image and select Properties. On\nNS View image and the select page info\n\nThe image has not the Last Modified parameter. On 4.0 this works fine!!! This is\na cache penalty because all images are retrieved every time from a protected area.", "id": 11206, "time": "2002-02-27T10:44:48Z", "creator": "vicentesalvador@netscape.net", "creation_time": "2002-02-27T10:44:48Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 6709, "text": "There are some pictures / binary document inside the protected area which could\nbe confidential (and there's no way to know which are and which aren't). If we\ndon't set the cache control, those documents could be cached by intermediate\nproxies.\nI'll add a flag on the authenticator to allow disabling the cache-control (will\ndefault to no-cache, of course).", "id": 11227, "attachment_id": null, "creator": "remm@apache.org", "creation_time": "2002-02-27T17:09:40Z", "time": "2002-02-27T17:09:40Z", "is_private": false}, {"count": 2, "tags": [], "creator": "remm@apache.org", "text": "*** Bug 6732 has been marked as a duplicate of this bug. ***", "id": 11240, "time": "2002-02-27T18:09:30Z", "bug_id": 6709, "creation_time": "2002-02-27T18:09:30Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 6709, "text": "I believe that there is a very simple way to enable caching of your image files \nwithout disabling security on the pages that link to those images. This same \nissue came up when we were implmenting the Tomcat admin webapp in the HEAD \nbranch. Basically, we left image files out of the security constraint using the \nfollowing entries in the webapp's web.xml:\n\n  <security-constraint>\n    <display-name>Tomcat Server Configuration Security Constraint</display-name>\n    <web-resource-collection>\n      <web-resource-name>Protected Area</web-resource-name>\n      <!-- Define the context-relative URL(s) to be protected -->\n      <url-pattern>*.jsp</url-pattern>\n      <url-pattern>*.do</url-pattern>\n      <url-pattern>*.html</url-pattern>\n    </web-resource-collection>\n    .\n    .\n    .\n  </security-contstraint>\n\nIn the above, all of the webapps jsp and html pages as well as all Struts actions \nare protected by the security constraint (and therefore have no-cache set). \nWhereas, all of the webapps image files are not protected by the security \nconstraint (and therefore are cached).\n\nHope that helps,\n\nPatrick\n", "id": 11243, "time": "2002-02-27T18:21:51Z", "creator": "patrick.luby@planamesa.com", "creation_time": "2002-02-27T18:21:51Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 6709, "attachment_id": null, "is_private": false, "id": 11261, "time": "2002-02-27T21:11:10Z", "creator": "jemiller@uchicago.edu", "creation_time": "2002-02-27T21:11:10Z", "text": "The solution to this bug should in my opinion allow a developer to override \nthe caching settings that are specified by default by the server for resources \nthat are protected by a <security-constraint>. You should be able to do this \nusing one of Tomcat's settings files.\n\nAllowing local caching of content that is served over SSL is a valid thing to \ndo.\n\nWhy is it that Tomcat's behavior is different than Apache HTTP Server with \nSSL? Apache HTTP Server with SSL does not add any cache control headers for \ncontent served over SSL.\n\nI don't have an issue with the fact that by default caching is turned off. I \nthink that it is a good thing, if it helps improve security. However, not \nhaving a way to change the setting is a design flaw/bug.\n\nI also would still like to know why the \"expires\" header is being set. As far \nas I know you shouldn't have to set this header in order to turn off caching. \n"}, {"count": 5, "tags": [], "text": "I can comment on the \"expires\" header. This is for IE browsers. Some versions of \nIE like to cache content (which gets cached on the local file system) regardless \nof the values set for the \"pragma\" and \"cache-control\" headers. The use of the \n\"expires\" header is a common hack to work around this.\n\nAs for disabling the no-caching behavior for SSL, I see no problem with that as \nlong as the org.apache.catalina.net.SSLServerSocketFactory's clientAuth attribute \nin server.xml is set to \"false\" (the common case).\n\nThe forcing of the no-caching behavior for SSL was an inadvertant effect of my \nimplementation of the no-caching behavior. My intent was to only force this \nbehavior when you are authenticating the ID of the user access a URI. My feeling \nis that if you allow anyone to access a URI but you are using SSL to protect the \nstream from eavesdropping by others, then caching should be OK.\n", "is_private": false, "id": 11262, "creation_time": "2002-02-27T21:22:33Z", "time": "2002-02-27T21:22:33Z", "creator": "patrick.luby@planamesa.com", "bug_id": 6709, "attachment_id": null}, {"count": 6, "tags": [], "text": "It is a problem for the container to assume that all constrained urls should \nnot be cached by the browser since users sometimes want this behavior in IE. \nThe configurable cache-control option planned by Remy should resolve the issue \nby allowing users to disable the cache-control header. I was able to get around \nthe problem for now by overwriting the header values in the beginning of my \nservlet service method since the container has already set the headers before \nthe service method is called. Add the following lines to the beginning of your \nservlet service method to reenable the browser caching.\nresponse.setHeader(\"Pragma\", \"\");\nresponse.setHeader(\"Cache-Control\", \"\");", "is_private": false, "id": 11455, "creation_time": "2002-03-04T23:28:12Z", "time": "2002-03-04T23:28:12Z", "creator": "jonathan_pierce@seagram.com", "bug_id": 6709, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 6709, "text": "Regarding Jonathan Pierce's comments. That's what I tried as well. Only, I \nthink you also have to set the expires header as well. That worked for \nNetscape 6 and Internet Explorer 6, but, not for Netscape 4. i.e. with \nNetscape 4, if there is an expires header, even if it's blank, it expires the \npage.\n\nCurrently, I'm no longer having the problem though (I'm using the 2002-02-28 \nnightly build). I think Remy put some conditional code in \nAuthenticatorBase.java so that it only sets those headers if you're not using \nSSL. i.e. if isSecure() is false. In my case, I am using SSL. So, I'm OK now. \nThanks Remy.\n", "id": 11457, "time": "2002-03-04T23:54:49Z", "creator": "jemiller@uchicago.edu", "creation_time": "2002-03-04T23:54:49Z", "is_private": false, "attachment_id": null}, {"count": 8, "attachment_id": null, "creator": "jonathan_pierce@seagram.com", "is_private": false, "id": 11459, "time": "2002-03-05T00:08:31Z", "bug_id": 6709, "creation_time": "2002-03-05T00:08:31Z", "tags": [], "text": "I'm using 4.0.4-b1 with SSL and IE browser and I still have the problem unless \nI add the modification to my servlet that I suggested above. In my case \n(isSecure is true since I am using the iisapi connector through an SSL \nconnection. I still need the promised configuration option for cache-control to \nbe added.\n\nJonathan"}, {"count": 9, "attachment_id": null, "bug_id": 6709, "is_private": false, "id": 11465, "time": "2002-03-05T10:20:30Z", "creator": "vicentesalvador@netscape.net", "creation_time": "2002-03-05T10:20:30Z", "tags": [], "text": "I also need it!!!! I think that a cache configuration parameters on the server\nshould be the better approach"}, {"attachment_id": null, "tags": [], "bug_id": 6709, "is_private": false, "count": 10, "id": 12910, "time": "2002-04-06T11:52:44Z", "creator": "antti.lehto@helsinki.fi", "creation_time": "2002-04-06T11:52:44Z", "text": "*** Bug 7715 has been marked as a duplicate of this bug. ***"}, {"count": 11, "tags": [], "bug_id": 6709, "is_private": false, "id": 14762, "attachment_id": null, "creator": "jfienberg@simmedia.com", "creation_time": "2002-04-25T17:21:15Z", "time": "2002-04-25T17:21:15Z", "text": "This default no-cache on secured resources has significant effects on the .ram \nfiles used by RealPlayer. These files must be cached when the browser passes \ncontrol to RealPlayer, which then uses the cached file. I assume this kind of \nhand-off is similar with other (all?) external programs called by the browser. \nNetscape and Opera ignore the no-cache headers for the .ram files, but IE does \nnot and RealPlayer cannot find the .ram file via IE.\n\nTo work around this, I had to create a servlet filter mapped to *.ram that sets \nthe Cache-Control to private via response.setHeader(\"Cache-Control\",\"private\"). \nThis one setting proved sufficient for the .ram file info to \"pass\" to \nRealPlayer via the cached file.\n\nPreventing caching and protecting web resources in the container should work \ntogether, but I question the assumption that the no-cache headers should be a \nmandatory part of the container's security responsibility. In other words, this \nassumes the container's job necessarily includes trying to manage how clients \n(and proxies) treat its resources once outside the container.\n\nI would like to see this no-cache feature be optional. It is an important thing \nto be able to set, but there needs to be more control over its exact settings, \nand to what resources the settings should be applied. \n\nIt could be great if this were fully configurable in Tomcat and the no-cache \nresource mappings could be described in the server.xml (or web.xml if it were \nadded to the web app spec). Otherwise, servlet filters are a good way to \nimplement this.\n\nThanks\nJ F"}, {"count": 12, "attachment_id": null, "bug_id": 6709, "text": "*** Bug 8773 has been marked as a duplicate of this bug. ***", "id": 15617, "time": "2002-05-07T10:01:38Z", "creator": "vicentesalvador@netscape.net", "creation_time": "2002-05-07T10:01:38Z", "tags": [], "is_private": false}, {"count": 13, "attachment_id": null, "bug_id": 6709, "text": "There is a flag named disableProxyCaching in AuthenticatorBase.java which when \nset to false prevents the default behavior of adding no-cache response headers \nto all constrained resources which are not protected by SSL.\n\nThe question is: How can I set this flag?\n\nPS: It seems to me that the default behavior should apply ONLY to resources \nthat are subject to a security-constraint that specifies an auth-constraint. \nYou could then explicitly specify public resources (i.e., list them in a \nsecurity-constraint that has no auth-constraint) without preventing browsers \nand web proxies from caching them. This practice of using a security-constraint \nfor every resource provides a clearer picture of your security model and allows \nyou to use a catchall no-access constraint for the /* URL pattern.\n\n", "id": 33842, "time": "2003-03-26T18:33:33Z", "creator": "ttps@pacbell.net", "creation_time": "2003-03-26T18:33:33Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "bug_id": 6709, "is_private": false, "text": "Please help. Does anyone know how to set the flag named disableProxyCaching in \nthe Authenticator object? \n", "id": 33953, "time": "2003-03-27T17:13:50Z", "creator": "ttps@pacbell.net", "creation_time": "2003-03-27T17:13:50Z", "attachment_id": null}, {"count": 15, "tags": [], "text": "Assuming that you are using Form authentication,\n\n<Context ...>\n  <Valve className=\"org.apache.catalina.authenticator.FormAuthenticator\"\n         disableProxyCaching=\"true\" ... />\n  ...\n</Context>\n\nFor other types of authentication, replace FormAuthenticator with the correct \nclass.\n\nNote that this option doesn't play well with the admin webapp.", "is_private": false, "id": 33968, "creator": "william.barker@wilshire.com", "time": "2003-03-27T18:28:09Z", "bug_id": 6709, "creation_time": "2003-03-27T18:28:09Z", "attachment_id": null}, {"count": 16, "attachment_id": null, "bug_id": 6709, "is_private": false, "id": 35763, "time": "2003-04-22T10:37:15Z", "creator": "remm@apache.org", "creation_time": "2003-04-22T10:37:15Z", "tags": [], "text": "An option has indeed be added, so I am marking this as fixed. The default\nbehavior  is to be safe (and the optimal one is to not include the images in the\nprotected area, as doing so will introduce some small overhead)."}, {"count": 17, "attachment_id": null, "bug_id": 6709, "is_private": false, "id": 45105, "time": "2003-10-05T18:20:57Z", "creator": "medthomas@ntlworld.com", "creation_time": "2003-10-05T18:20:57Z", "tags": [], "text": "*** Bug 7715 has been marked as a duplicate of this bug. ***"}]
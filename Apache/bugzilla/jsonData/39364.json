[{"count": 0, "tags": [], "bug_id": 39364, "attachment_id": null, "id": 88315, "time": "2006-04-20T11:18:42Z", "creator": "jjliu@huawei.com", "creation_time": "2006-04-20T11:18:42Z", "is_private": false, "text": "If I define the security-cionstraint like this:\n<security-constraint>\n\t\t<web-resource-collection>\n\t\t\t<web-resource-name>LoginProxy</web-resource-name>\n\t\t\t<url-pattern>/jaas/login</url-pattern>\n\t\t</web-resource-collection>\n\t\t<auth-constraint>\n\t\t\t<role-name>*</role-name>\n\t\t</auth-constraint>\n\t</security-constraint>\n\nWhen start the tomcat, this context will not add any role into Context object. \n(Please check ContextConfig.validateSecurityRoles() method.) So the \nStandardContext's securityRoles[] is an empty array.\n\nIn RealmBase.hasResourcePermission() method, it will get this roles to compare \nwith the ones in web.xml file.\n\nif (constraint.getAllRoles()) {\n                // * means all roles defined in web.xml\n                roles = request.getContext().findSecurityRoles();\n            } else {\n                roles = constraint.findAuthRoles();\n            }\n\nhere if constraint.getAllRoles() return true, it does not return directly, but \nget the securityRoles[] from the context (empty array). so it will not allown \nto access this path resource."}, {"count": 1, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 90081, "time": "2006-06-12T00:32:31Z", "bug_id": 39364, "creation_time": "2006-06-12T00:32:31Z", "tags": [], "text": "This behaviour as as required by the spec.\n* == all roles defined in web.xml\n* != all roles defined in realm\n* != all authenticated users"}, {"count": 2, "tags": [], "bug_id": 39364, "text": "Hi Mark,\n\nI had the very same configuration as Torr nicely working before.\n\nWould it be possible to provide an example the illustrates how I can let all\n(client-cert) login attempts through (and only decide afterwards in my\napplication logic whether I want them to succeed or not) and still be compliant\nto the specs?\n\nThanks  Ralf\n\nsee also bug 37852, bug 37044, and Bug 34643", "id": 92041, "time": "2006-08-08T15:20:29Z", "creator": "hauser@acm.org", "creation_time": "2006-08-08T15:20:29Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 39364, "attachment_id": null, "id": 92067, "time": "2006-08-08T22:57:39Z", "creator": "markt@apache.org", "creation_time": "2006-08-08T22:57:39Z", "is_private": false, "text": "I can give you some pointers but my time to write some actual code is\nnon-existant. This is a question for the users list. In fact it came up again\nyesterday. (http://marc.theaimsgroup.com/?l=tomcat-user&m=115503660912530&w=2)"}, {"count": 4, "tags": [], "creator": "hauser@acm.org", "is_private": false, "text": "this can easily be solved by adding the following custom realm to your server.xml:\n\n\npublic class ClientCertInAppRealm extends JAASRealm {\n\n\tpublic boolean hasResourcePermission(Request request, Response response,\nSecurityConstraint[] constraints,\n\t\t\tContext context) throws IOException {\n\t\treturn true;\n\t}\n}", "id": 95614, "time": "2006-11-09T02:10:43Z", "bug_id": 39364, "creation_time": "2006-11-09T02:10:43Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "carnold@houston.rr.com", "is_private": false, "text": "DOMExceptions that occur before a node's ownerDocument is\nset will generate a NullPointer exception instead.  This is\ndue to the call getCurrentDocument().formatMessage() in\nAbstractNode.createDOMException [getCurrentDocument() is null]\n\n    public DOMException createDOMException(short    type,\n                                           String   key,\n                                           Object[] args) {\n        try {\n            return new DOMException\n                (type, getCurrentDocument().formatMessage(key, args));\n        } catch (MissingResourceException e) {\n            return new DOMException(type, key);\n        }\n    }\n\nThis can be triggered by a call to document.createDocumentEntity(\"bad^name\") \nwhich eventually calls the AbstractEntityReference constructor\n\n    protected AbstractEntityReference(String name, AbstractDocument owner)\n\tthrows DOMException {\n\tif (!DOMUtilities.isValidName(name)) {\n\t    throw createDOMException(DOMException.INVALID_CHARACTER_ERR,\n\t\t\t\t     \"xml.name\",\n\t\t\t\t     new Object[] { name });\n\t}\n\townerDocument = owner;\n\tnodeName = name;\n    }\n\nHere you see createDOMException being invoked before ownerDocument is\nset.   I think the best solution is to modify the createDOMException\nso that it will catch generate an description-less DOMException\nif there is any exception (not just ResourceMissingDescription) \nin the creation of a DOMException with description.  \n\nRCS file: /home/cvspublic/xml-\nbatik/sources/org/apache/batik/dom/AbstractNode.java,v\nretrieving revision 1.6\ndiff -r1.6 AbstractNode.java\n369c369\n<         } catch (MissingResourceException e) {\n---\n>         } catch (Exception e) {\n\n\n\nIn addition, the assignment of ownerDocument could be moved before\nthe invalidName check in AbstractEntityReference constructor.\n\ncvs diff AbstractEntityReference.java (in directory D:\\apache-xml\\xml-\nbatik\\sources\\org\\apache\\batik\\dom\\)\nIndex: AbstractEntityReference.java\n===================================================================\nRCS file: /home/cvspublic/xml-\nbatik/sources/org/apache/batik/dom/AbstractEntityReference.java,v\nretrieving revision 1.1.1.1\ndiff -r1.1.1.1 AbstractEntityReference.java\n41c41\n<      *   INVALID_CHARACTER_ERR: Raised if the specified name contains an \n---\n>      *   INVALID_CHARACTER_ERR: Raised if the specified name contains an\n45a46\n> \townerDocument = owner;\n51d51\n< \townerDocument = owner;", "id": 2489, "time": "2001-05-16T17:09:01Z", "bug_id": 1786, "creation_time": "2001-05-16T17:09:01Z", "attachment_id": null}]
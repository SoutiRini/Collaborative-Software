[{"count": 0, "tags": [], "creator": "mariano@fuegolabs.com", "text": "I put down the problem to a simple procedure to reproduce:\nI have sample.xml and antlib.xml, I just define the antlib in sample.xml and\nwhen I try to run it with the XmlLogger I get this:\n\nmariano@fenix:/w/MAIN/local/modules/boot.launcher> ant -f sample.xml -logger\norg.apache.tools.ant.XmlLogger\nBuildfile: sample.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"log.xsl\"?>\n\n<build time=\"0 seconds\" error=\"/w/MAIN/local/modules/boot.launcher/sample.xml:5:\nsrcdir attribute must be set!\">\n        <task name=\"java.lang.NullPointerException\n        at\norg.apache.tools.ant.util.DOMElementWriter.encode(DOMElementWriter.java:174)\n        at\norg.apache.tools.ant.util.DOMElementWriter.write(DOMElementWriter.java:95)\n        at\norg.apache.tools.ant.util.DOMElementWriter.write(DOMElementWriter.java:113)\n        at org.apache.tools.ant.XmlLogger.buildFinished(XmlLogger.java:189)\n        at org.apache.tools.ant.Project.fireBuildFinished(Project.java:1796)\n        at org.apache.tools.ant.Main.runBuild(Main.java:693)\n        at org.apache.tools.ant.Main.startAnt(Main.java:188)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\n\n\nthis happens because the antlib taskname is null, I debugged it and found that\nthe taskname attribute of the antlib is never defined. and when the logger\nreceives the taskStarted for the antlib, it stores a null for the value, and\nthat breaks the XmlLogger.\n\nI really need this to be able to use CruiseControl with our ant project, since\nit uses it extensively as I understand.", "id": 65475, "time": "2004-10-21T23:59:54Z", "bug_id": 31840, "creation_time": "2004-10-21T23:59:54Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 31840, "attachment_id": 13173, "text": "Created attachment 13173\ninvoking build", "id": 65476, "time": "2004-10-22T00:00:40Z", "creator": "mariano@fuegolabs.com", "creation_time": "2004-10-22T00:00:40Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 31840, "attachment_id": 13174, "text": "Created attachment 13174\nsimple antlib", "id": 65477, "time": "2004-10-22T00:01:05Z", "creator": "mariano@fuegolabs.com", "creation_time": "2004-10-22T00:01:05Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 31840, "attachment_id": null, "text": "This is stange. I cannot reproduce the problem\nwith the build.xml and antlib.xml files given.\n\nI tested with ant1.6.0, ant1.6.1 and ant1.6.2.\n\nThe output given was:\nant -f build.xml -logger org.apache.tools.ant.XmlLogger\nBuildfile: build.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"log.xsl\"?>\n\n<build error=\"/home/preilly/learning/a/antlib/error/build.xml:5: srcdir\nattribute must be set!\" time=\"0 seconds\">\n        <task location=\"/home/preilly/learning/a/antlib/error/antlib.xml:2: \"\nname=\"\" time=\"0 seconds\"></task>\n        <task location=\"/home/preilly/learning/a/antlib/error/build.xml:3: \"\nname=\"typedef\" time=\"0 seconds\"></task>\n        <target name=\"build\" time=\"0 seconds\">\n                <task\nlocation=\"/home/preilly/learning/a/antlib/error/build.xml:5: \" name=\"javac2\"\ntime=\"0 seconds\"></task>\n        </target>\n        <stacktrace><![CDATA[/home/preilly/learning/a/antlib/error/build.xml:5:\nsrcdir attribute must be set!\n        at org.apache.tools.ant.taskdefs.Javac.checkParameters(Javac.java:893)\n        at org.apache.tools.ant.taskdefs.Javac.execute(Javac.java:738)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n        at org.apache.tools.ant.Main.runBuild(Main.java:673)\n        at org.apache.tools.ant.Main.startAnt(Main.java:188)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\n]]></stacktrace>\n</build>\n", "id": 65516, "time": "2004-10-22T16:58:19Z", "creator": "peterreilly@apache.org", "creation_time": "2004-10-22T16:58:19Z", "is_private": false}, {"count": 4, "tags": [], "creator": "mariano@fuegolabs.com", "attachment_id": null, "id": 65523, "time": "2004-10-22T17:37:59Z", "bug_id": 31840, "creation_time": "2004-10-22T17:37:59Z", "is_private": false, "text": "well, it did happen to me, the problem is that the build file is wrong, fix it\nant it should break.\nI am using jdk 1.4.2_05, if that helps.\n"}, {"count": 5, "tags": [], "creator": "mariano@fuegolabs.com", "attachment_id": null, "id": 65524, "time": "2004-10-22T17:40:46Z", "bug_id": 31840, "creation_time": "2004-10-22T17:40:46Z", "is_private": false, "text": "this is the output with a patch to make Antlib.java return \"antlib\" as taskname\n\nmariano@fenix:/w/MAIN/local/lib/eclipse> ant -f sample.xml -logger\norg.apache.tools.ant.XmlLogger\nBuildfile: sample.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"log.xsl\"?>\n\n<build time=\"0 seconds\" error=\"/w/MAIN/local/lib/eclipse/sample.xml:5: srcdir\nattribute must be set!\">\n        <task name=\"antlib\" location=\"/w/MAIN/local/lib/eclipse/antlib.xml:2: \"\ntime=\"0 seconds\"></task>\n        <task name=\"typedef\" location=\"/w/MAIN/local/lib/eclipse/sample.xml:3: \"\ntime=\"0 seconds\"></task>\n        <target name=\"build\" time=\"0 seconds\">\n                <task name=\"javac2\"\nlocation=\"/w/MAIN/local/lib/eclipse/sample.xml:5: \" time=\"0 seconds\"></task>\n        </target>\n        <stacktrace><![CDATA[/w/MAIN/local/lib/eclipse/sample.xml:5: srcdir\nattribute must be set!\n        at org.apache.tools.ant.taskdefs.Javac.checkParameters(Javac.java:893)\n        at org.apache.tools.ant.taskdefs.Javac.execute(Javac.java:738)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n        at org.apache.tools.ant.Main.runBuild(Main.java:673)\n        at org.apache.tools.ant.Main.startAnt(Main.java:188)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\n]]></stacktrace>\n</build>\n"}, {"count": 6, "tags": [], "bug_id": 31840, "attachment_id": null, "text": "maybe a difference in XML parsers, probably your parser returns \"\" when no\nattribute is defined, and mine returns null?\nyour task name in the \"antlib\" element in the output is \"\", since mine is null,\nit breaks.", "id": 65525, "time": "2004-10-22T17:42:19Z", "creator": "mariano@fuegolabs.com", "creation_time": "2004-10-22T17:42:19Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 31840, "attachment_id": null, "id": 65526, "time": "2004-10-22T17:45:11Z", "creator": "mariano@fuegolabs.com", "creation_time": "2004-10-22T17:45:11Z", "is_private": false, "text": "java -version:\n---------------------------\njava version \"1.4.2_05\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_05-b04)\nJava HotSpot(TM) Client VM (build 1.4.2_05-b04, mixed mode)\n\non Linux SuSE 9.1 i686"}, {"count": 8, "tags": [], "bug_id": 31840, "attachment_id": null, "text": "Can you post the patch for Antlib.java.\nI now see the \"\" in the  name for the antlib task. There\ncould be a difference in the XML or something. I had\nthough that the problem was the \"java2\" name.\n", "id": 65699, "time": "2004-10-26T08:42:37Z", "creator": "peterreilly@apache.org", "creation_time": "2004-10-26T08:42:37Z", "is_private": false}, {"count": 9, "tags": [], "creator": "mariano@fuegolabs.com", "text": "I guess adding getTaskName() { return \"antlib\"; } to Antlib.java is fine, but\nshould the logger handle properly this case, maybe some custom task is not\nreturning the proper value, and the logger will fail.\n\nAre you ok to include also the handling of null in the logger?\n\nWill post the patch, against which branch you want the patch to be created?", "id": 65709, "time": "2004-10-26T11:47:06Z", "bug_id": 31840, "creation_time": "2004-10-26T11:47:06Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 31840, "attachment_id": null, "text": "Create the patch against CVS HEAD of ant.\nYes, the xml logger should be fixed to handle null pointer for\nthe task name.", "id": 65712, "time": "2004-10-26T12:04:26Z", "creator": "peterreilly@apache.org", "creation_time": "2004-10-26T12:04:26Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 31840, "attachment_id": null, "text": "ok, I checked the code, and the value of the name attribute is\nbeing set to null for antlib. There must be a difference\nin the xml processors, as I do not see a null pointer exception,\nbut setting the value to null cannot be correct.\nSo, I have changed XmlLogger to check if the name is null and\nset it to \"\" if it is.\nAlso, the name of the antlib task is being set to \"antlib\".\nChanges are committed and will be in the next release of ant.\n\nThanks for the report, the nice test case and the follow up\ncomments.\n\n", "id": 65821, "time": "2004-10-27T12:56:11Z", "creator": "peterreilly@apache.org", "creation_time": "2004-10-27T12:56:11Z", "is_private": false}]
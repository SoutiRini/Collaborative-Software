[{"count": 0, "tags": [], "creator": "Christopher.D.Knight@nasa.gov", "attachment_id": null, "text": "the apr_xml_to_text (really the write_text) function should re-escape entities to make valid XML CDATA blocks...For example:\n\n--output of example code--\nRESULT:\n(40) <tag>test with an & in the middle</tag>\n\n--example code--\n#include <apr_pools.h>\n#include <apr_xml.h>\n\nint main(int argc, char **argv) {\n    apr_xml_parser *parser = NULL; apr_pool_t *pool = NULL; apr_xml_doc *pdoc = NULL; int namespace_mapping[100];\n    char *testxml = \"<?xml version=\\\"1.0\\\"?>\\n<tag>test with an &amp; in the middle</tag>\\n\";\n\n    apr_pool_initialize(); apr_pool_create(&pool, NULL);\n\n    parser = apr_xml_parser_create(pool); apr_xml_parser_feed(parser, testxml, strlen(testxml)); apr_xml_parser_done(parser, &pdoc);\n    const char *buf = NULL; apr_size_t buflen = 0;\n    apr_xml_to_text(pool, pdoc->root, APR_XML_X2T_FULL, pdoc->namespaces, namespace_mapping, (const char **)&buf, &buflen);\n    printf(\"RESULT:\\n(%ld) %s\\n\", buflen, buf);\n\n    apr_pool_destroy(pool); apr_pool_terminate();\n}", "id": 158047, "time": "2012-04-13T22:31:59Z", "bug_id": 53082, "creation_time": "2012-04-13T22:31:59Z", "is_private": false}]
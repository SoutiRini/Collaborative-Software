[{"count": 0, "attachment_id": null, "bug_id": 41620, "is_private": false, "id": 99404, "time": "2007-02-15T02:43:40Z", "creator": "shivahr@gmail.com", "creation_time": "2007-02-15T02:43:40Z", "tags": [], "text": "This bug is a result of the testing that got done for a JIRA in Apache Geronimo\n(Tomcat version) http://issues.apache.org/jira/browse/GERONIMO-2577\n\nI am trying to setup a Tomcat cluster consisting of 3 Windows XP machines\nrunning on Intel 32-bit platform. All 3 machines are on the same subnet.\n\nClustering is enabled at the application level or context level with the\nfollowing configuration files:\ncontext_node1.xml\ncontext_node2.xml\ncontext_node3.xml\n(edit line 25 of context_node*.xml, copy it into \"conf\" folder of Apache Tomcat\n5.5.20 installation and rename it as \"context.xml\")\n\n\"server.xml\" is kept unchanged.\n\nAlso deploy the sample application attached below:\nservlets-examples-cluster_node1.war\nservlets-examples-cluster_node2.war\nservlets-examples-cluster_node3.war\n(copy \"servlets-examples-cluster_node*.war\" into \"webapps\" folder of Apache\nTomcat installation and rename it as \"servlets-examples-cluster.war\")\n\nApache HTTP Server is used as the loadbalancer with the following configuration:\n# AJP Connector for Tomcat\nLoadModule jk_module modules\\mod_jk.so\nJkMount /servlets-examples-cluster loadbalancer\nJkMount /servlets-examples-cluster/* loadbalancer\nJkWorkersFile \"C:/Program Files/Apache Software\nFoundation/Apache2.2/conf/workers.properties\"\nJkLogFile \"C:/Program Files/Apache Software Foundation/Apache2.2/logs/mod_jk.log\"\n\n# workers.properties\nworker.list=loadbalancer,status\nworker.node1.port=8009\nworker.node1.host=AA.BB.CC.D1\nworker.node1.type=ajp13\nworker.node1.lbfactor=1\n\nworker.node2.port=8009\nworker.node2.host=AA.BB.CC.D2\nworker.node2.type=ajp13\nworker.node2.lbfactor=1\n\nworker.node3.port=8009\nworker.node3.host=AA.BB.CC.D3\nworker.node3.type=ajp13\nworker.node3.lbfactor=1\n\nworker.loadbalancer.type=lb\nworker.loadbalancer.balance_workers=node1,node2,node3\nworker.loadbalancer.sticky_session=1\nworker.status.type=status\n\nStart Apache HTTP server followed by the Tomcat servers on all 3 nodes.\n\nTry running the following:\nhttp://Yourhost/servlets-examples-cluster - HttpSession is not used here, hence\nno sticky session\nhttp://Yourhost/servlets-examples-cluster/servlet/SessionExample - HttpSession\nis used here, hence sticky session should be in effect\n\n<Yourhost> is the hostname where HTTP server is running.\n\nRunning http://Yourhost/servlets-examples-cluster works as expected with\napplication getting served by different servers in the cluster in Round Robin\nfashion.\n\nHowever running http://Yourhost/servlets-examples-cluster/servlet/SessionExample\ndoesn't work as expected. I observe that session-ids are getting changed upon\nhitting page-refreshes or upon adding attributes. I tried this\nApplication/Context level clustering in Tomcat multiple times, but same results\nevery time, with even sticky sessions not being in effect.\n\nNote: \nHost level clustering on 3 or more nodes works correctly. I tested this by\nmoving the clustering info from \"context.xml\" to \"server.xml\". This time upon\nrunning http://Yourhost/servlets-examples-cluster/servlet/SessionExample, I\nobserve that session ID is getting preserved across page refreshes and upon\nadding new attributes. So I could proceed with testing the failover behaviour as\nbelow:\n\n1) Client \"http://Yourhost/servlets-examples-cluster/servlet/SessionExample\"\nbeing served by Server-2.\n2) Kill Server-2 and refresh the client. Client now being served by Server-3\nwith session id & state preserved.\n3) Kill Server-3 and refresh the client. Client is now being served by Server-1\nwith session id & state preserved.\nAlso tried these:\n4) Restart Server-2 and kill Server-1. Client is now being served by Server-2\nwith session id & state preserved.\n5) Restart Server-3 and kill Server-2. Client is now being served by Server-3\nwith session id & state preserved.\n\nSo failover happening successfully across the 3-node cluster when Host Level\nClustering is used. But Context level clustering doesn't work.\n\n- Shiva"}, {"count": 1, "tags": [], "creator": "shivahr@gmail.com", "attachment_id": 19594, "text": "Created attachment 19594\ncontext_node1.xml", "id": 99405, "time": "2007-02-15T02:45:11Z", "bug_id": 41620, "creation_time": "2007-02-15T02:45:11Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 41620, "text": "Created attachment 19595\ncontext_node2.xml", "id": 99406, "time": "2007-02-15T02:45:34Z", "creator": "shivahr@gmail.com", "creation_time": "2007-02-15T02:45:34Z", "is_private": false, "attachment_id": 19595}, {"count": 3, "tags": [], "bug_id": 41620, "is_private": false, "text": "Created attachment 19596\ncontext_node3.xml", "id": 99407, "time": "2007-02-15T02:46:06Z", "creator": "shivahr@gmail.com", "creation_time": "2007-02-15T02:46:06Z", "attachment_id": 19596}, {"count": 4, "tags": [], "text": "Created attachment 19597\nservlets-examples-cluster_node1.war", "attachment_id": 19597, "bug_id": 41620, "id": 99408, "time": "2007-02-15T02:46:33Z", "creator": "shivahr@gmail.com", "creation_time": "2007-02-15T02:46:33Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 41620, "attachment_id": 19598, "text": "Created attachment 19598\nservlets-examples-cluster_node2.war", "id": 99409, "time": "2007-02-15T02:46:59Z", "creator": "shivahr@gmail.com", "creation_time": "2007-02-15T02:46:59Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 41620, "attachment_id": 19599, "is_private": false, "id": 99410, "time": "2007-02-15T02:47:26Z", "creator": "shivahr@gmail.com", "creation_time": "2007-02-15T02:47:26Z", "text": "Created attachment 19599\nservlets-examples-cluster_node3.war"}, {"count": 7, "tags": [], "bug_id": 41620, "text": "It is not possible to configure clustering in context.xml. It must be done at\nthe Host level (with the jvmRoute defined at the Engine level) within server.xml ", "id": 99458, "time": "2007-02-15T18:54:07Z", "creator": "markt@apache.org", "creation_time": "2007-02-15T18:54:07Z", "is_private": false, "attachment_id": null}]
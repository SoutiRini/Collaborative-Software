[{"count": 0, "attachment_id": 35096, "creator": "veeru.mallavarapu@yahoo.com", "text": "Created attachment 35096\nError While stopping service from windows service due to the system.exit(1)\n\nHi All,\n\nI am running tomcat as windows service and disabled the shutdown port in server.xml. \n\nSo when I am stopping the service, tomcat service is killed and the process also killed . However since tomcat is exited with System.exit(1) in catalina.java --> stopServer(String[] arguments) when shutdown port is disabled. I am seeing an alert message in windows services window stating \" Service could not able to stop and Error 1 : function error \". I have attached the screen shot  here.\n\nTo fix this error , I have replaced system.exit(1) with system.exit(0) and now I am not seeing that alert.\n\nCan you please tell me , is there any  specific reason we are invoke system.exit(1) rather system.exit(1). As we are forcibly killing JVM , I think we can call system.exit(0) so that it will be successful operation for the windows service. Otherwise it is treating it as exception and leading to issue.", "id": 199563, "time": "2017-07-05T06:07:26Z", "bug_id": 61250, "creation_time": "2017-07-05T06:07:26Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "veeru.mallavarapu@yahoo.com", "text": "Hi All,\n\nI am running tomcat as windows service and disabled the shutdown port in server.xml. \n\nSo when I am stopping the service, tomcat service is killed and the process also killed . However since tomcat is exited with System.exit(1) in catalina.java --> stopServer(String[] arguments) when shutdown port is disabled. I am seeing an alert message in windows services window stating \" Service could not able to stop and Error 1 : function error \". I have attached the screen shot  here.\n\nTo fix this error , I have replaced system.exit(1) with system.exit(0) and now I am not seeing that alert.\n\nCan you please tell me , is there any  specific reason we are invoking system.exit(1) rather system.exit(0). As we are forcibly killing JVM , I think we can call system.exit(0) so that it will be successful operation for the windows service. Otherwise it is treating it as exception and leading to issue.", "id": 199564, "time": "2017-07-05T06:09:45Z", "bug_id": 61250, "creation_time": "2017-07-05T06:09:45Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 61250, "attachment_id": null, "text": "The exit code of -1 is correct in that case. The user is trying to use the shutdown command when the port is disabled.\n\nWe need to look at how we integrate with Commons Daemon and how Daemon handles this to see if there is a way to avoid the error message.", "id": 199567, "time": "2017-07-05T08:18:16Z", "creator": "markt@apache.org", "creation_time": "2017-07-05T08:18:16Z", "is_private": false}, {"count": 3, "tags": [], "text": "Thanks you very much. Waiting for your input. At present I build the catalina.jar with system.exit(0) as 0 represent success.\n\n0 -- success\n1 -- exception\n-1 -- Error", "attachment_id": null, "bug_id": 61250, "id": 199570, "time": "2017-07-05T08:26:27Z", "creator": "veeru.mallavarapu@yahoo.com", "creation_time": "2017-07-05T08:26:27Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 61250, "attachment_id": null, "text": "If you use the default startMode of jvm, you won't see this problem.\n\nThe problem is that with startModes java and exe, Tomcat runs in a separate process. Therefore daemon needs the shutdown port in order to be able to shut Tomcat down. catalina.bat has essentially the same restriction.\n\nWhen you run in jvm mode, Tomcat runs in the same process and when deamon calls stop() Tomcat can detect it is running in process and shutdown.", "id": 199572, "time": "2017-07-05T11:16:23Z", "creator": "markt@apache.org", "creation_time": "2017-07-05T11:16:23Z", "is_private": false}, {"count": 5, "tags": [], "text": "\n\nThanks for quick response.\n\nI am using WinRun4J.jar to start my tomcat as a windows service.  I am not sure where to set this jvm mode.\n\nAnd I am disabling shutdown port by setting port=\"-1\" in server.xml.\n\nSince the port < 0, catalina.java --> stopServer() invoking system.exit(1)\n\nSo you are suggesting don't disable tomcat port and run tomcat in jvm mode ? Any pointers how to set this configuration is really helpful.", "attachment_id": null, "bug_id": 61250, "id": 199573, "time": "2017-07-05T12:05:54Z", "creator": "veeru.mallavarapu@yahoo.com", "creation_time": "2017-07-05T12:05:54Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 61250, "attachment_id": null, "text": "I've never used WinRun4J. I'd suggest the simplest solution is to configure a shutdown port with a strong shutdown password and ensure that server.xml is appropriately protected.\n\nIf you need further help/advice, please use the users mailing list.", "id": 199574, "time": "2017-07-05T12:10:44Z", "creator": "markt@apache.org", "creation_time": "2017-07-05T12:10:44Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 61250, "attachment_id": null, "text": "Yes I have tried it.  But that time I was seeing another issue that Error 1503.\n\nI would suggest , It would be better to invoke system.exit(0) as we are doing intentionally in case of port is disabled.\n\nThanks again for your prompt response.", "id": 199575, "time": "2017-07-05T12:51:29Z", "creator": "veeru.mallavarapu@yahoo.com", "creation_time": "2017-07-05T12:51:29Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "NPE in XMLJUnitResultFormatter.formatOutput under Java 1.4.2_08 with following \nstack. It didn't happen with Java 5.\n\n\ntest:\n    [junit] Exception in thread \"main\" java.lang.NullPointerException\n    [junit]     at \norg.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter.formatOutpu\nt(XMLJUnitResultFormatter.java:253)\n    [junit]     at \norg.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter.setSystemOu\ntput(XMLJUnitResultFormatter.java:92)\n    [junit]     at \norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.sendOutAndErr\n(JUnitTestRunner.java:435)\n    [junit]     at \norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run\n(JUnitTestRunner.java:319)\n    [junit]     at \norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch\n(JUnitTestRunner.java:672)\n    [junit]     at \norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main\n(JUnitTestRunner.java:567)", "attachment_id": null, "id": 80189, "creation_time": "2005-09-20T16:09:10Z", "time": "2005-09-20T16:09:10Z", "creator": "andrei.oleinik@talgentra.com", "bug_id": 36733, "is_private": false}, {"count": 1, "tags": [], "creator": "ats37@hotmail.com", "attachment_id": null, "id": 82576, "time": "2005-11-16T19:42:58Z", "bug_id": 36733, "creation_time": "2005-11-16T19:42:58Z", "is_private": false, "text": "I get exactly the same stack trace (for every test) from one of our projects\nwith Ant 1.6.5 running (as a forked external Ant instance) under CruiseControl.\n Another project runs (and generates the unit test HTML reports) successfully,\nand I think the difference is in the libraries they have in their build/test\nclasspaths - the one that works includes xml-apis, xercesImpl and xalan jars in\nits javac classpath, while the one that doesn't work only has xml-apis.\n\nI think I may have some idea what's behind the error in the stack trace.  If\nthere's a problem occurring in XMLJUnitResultFormatter.getDocumentBuilder(), due\nperhaps to classloader issues between the JDK's copy of xerces and another in\nAnt's lib directory and/or the junit task's classpath, that might cause a\njava.lang.ExceptionInInitializerError to be thrown when it's called from\nstartTestSuite(), which would exit prematurely leaving doc uninitialised. \nWinding back up the call stack, that means that the Error happens at the\nfireStartTestSuite() call in JUnitTestRunner (line 287), but the finally clause\nat line 304 will still try to call sendOutAndErr(String, String) at line 319,\nwhich calls XMLJUnitResultFormatter.setSystemOutput, which calls\nXMLJUnitResultFormatter.formatOutput, which throws a NPE when it tries to\nexecute doc.createElement(...) :-(\nSo the real error message (nested in the ExceptionInInitializerError) is lost\nbecause we only get to see the NPE that's thrown subsequently..."}, {"count": 2, "tags": [], "bug_id": 36733, "is_private": false, "text": "Thanks for the info RE the classpath contents differences.  In another forum I\nhad referenced this bugrep to a user who was having difficulties.  He confirmed\nthat adding the xalan jar fixed the problem for him.  Still would be nice to\nhave a better grip on this defect, but I personally lack the time to delve into\nan unfamiliar area of Ant's code at the moment.  :(", "id": 83021, "time": "2005-11-30T17:52:14Z", "creator": "mbenson@apache.org", "creation_time": "2005-11-30T17:52:14Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "maarten_coene@yahoo.com", "attachment_id": 18059, "id": 87749, "time": "2006-04-11T10:14:22Z", "bug_id": 36733, "creation_time": "2006-04-11T10:14:22Z", "is_private": false, "text": "Created attachment 18059\nPatch for JUnitTestRunner\n\nThis patch avoids the NPE and makes sure the original exception is shown to the\nuser."}, {"count": 4, "tags": [], "text": "Our build were having the same problem with Ant 1.6.5, 1.7.0.Beta1, or\n2006.09.13.162809 build and JDK 1.4.2. On JDK 5 it is working fine.\nPutting xalan.jar into ANT_HOME/lib did not help me, but I've managed to fix it\nby adding <pathelement\npath=\"${ant.home}/lib/xml-apis.jar:${ant.home}/lib/xercesImpl.jar\"/>\nas a first element in <junit>'s <classpath>.\n", "attachment_id": null, "id": 93600, "creation_time": "2006-09-14T18:21:58Z", "time": "2006-09-14T18:21:58Z", "creator": "dkroot2@gmail.com", "bug_id": 36733, "is_private": false}, {"count": 5, "tags": [], "creator": "daniel.galan@immonet.de", "attachment_id": null, "is_private": false, "id": 94725, "time": "2006-10-11T08:55:27Z", "bug_id": 36733, "creation_time": "2006-10-11T08:55:27Z", "text": "We have the same Problem, Ant 1.6.5, JUnit 3.8.2, JDK 1.4.2_12. When I exclude\nthe xalan.jar from the path, it works. Like this:\n\n<path id=\"myclasspath\">\n\t<fileset dir=\"${dir.lib}\">\n\t\t<include name=\"*.jar\"/>\n\t\t<exclude name=\"xalan.jar\"/>\n\t</fileset>\n</path>\n"}, {"count": 6, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "id": 94726, "time": "2006-10-11T08:59:29Z", "bug_id": 36733, "creation_time": "2006-10-11T08:59:29Z", "is_private": false, "text": "Please provide a small simple build file that\nshows the problem."}, {"count": 7, "tags": [], "text": "The patch of Maarten makes sense, but there is still no precise way to reproduce\nthe bug.", "attachment_id": null, "id": 95185, "creation_time": "2006-10-28T17:08:38Z", "time": "2006-10-28T17:08:38Z", "creator": "antoine@apache.org", "bug_id": 36733, "is_private": false}, {"id": 95205, "tags": [], "bug_id": 36733, "is_private": false, "count": 8, "text": "This can be reproduced very easy! Just define a non-existing XML Parser:\n\n<junit printsummary=\"yes\" ...>\n    <sysproperty key=\"javax.xml.parsers.DocumentBuilderFactory\" \n                 value=\"com.mycompany.NonExistingClass\"/>\n    ...\n</junit>\n\nregards,\nMaarten", "time": "2006-10-29T23:23:17Z", "creator": "maarten_coene@yahoo.com", "creation_time": "2006-10-29T23:23:17Z", "attachment_id": null}, {"count": 9, "tags": [], "text": "Thanks Maarten,\nthe patch has been committed.", "attachment_id": null, "bug_id": 36733, "id": 95211, "time": "2006-10-30T14:33:14Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-30T14:33:14Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 47035, "text": "Hi,\n\nI'm using Launch4j to wrap a JAR into a windows executable:\n\n<launch4j>\n    <config>\n        <jre>\n            <opt>-Xms${java.initial.memory}m</opt>\n        </jre>\n    </config>\n</launch4j>\n\nThe problem is that the \"opt\" element doesn't expand properties.\nIt seems that the developers didn't take care to expand them explicitly.\n(http://ant.apache.org/ant_task_guidelines.html)\n\nI wrapped the task into a macro like this:\n\n<macrodef name=\"create-exe\">\n    <attribute name=\"java-initial-memory\"/>\n    <sequential>\n        <launch4j>\n            <config>\n                <jre>\n                    <opt>-Xms@{java.initial.memory}m</opt>\n                </jre>\n            </config>\n        </launch4j>\n    </sequential>\n</macrodef>\n\nAnd called it like:\n\n<create-exe java-initial-memory=\"${java.initial.memory}\"/>\n\nin hope that the property will be expanded before being passed to the template.\nIt wasn't :(\n\n\n\nI know that this is the expected behavior. What I'm asking for here is an option to expand macro arguments before passing them to the template.\n\n\n\nAfter some consideration I came to the conclusion that the best solution would be to add an optional attribute \"expand\" to the \"element\" and \"attribute\" child elements of macrodef.\n\nModified example:\n\n<macrodef name=\"create-exe\">\n    <attribute name=\"java-initial-memory\" expand=\"true\"/>\n    <attribute name=\"java-maximum-memory\" expand=\"true\"/>\n    <element name=\"vm-options\" optional=\"true\" expand=\"true\"/>\n    <sequential>\n        <launch4j>\n            <config>\n                <jre>\n                    <opt>-Xms@{java.initial.memory}m</opt>\n                </jre>\n            </config>\n        </launch4j>\n    </sequential>\n</macrodef>\n\n<create-exe java-initial-memory=\"${java.initial.memory}\"\n            java-maximum-memory=\"${java.maximum.memory}\">\n\n    <vm-options>\n        <opt>${another.vm.option}</opt>\n    </vm-options>\n</create-exe>\n\n\"expand\" should be a boolean variable with a default value of \"false\". This wouldn't break any existing code.\n\nAnother use case I'm seeing is the following:\n\n<macrodef name=\"create-exe\">\n    <attribute name=\"expand-options\" default=\"true\"/>\n    <attribute name=\"java-initial-memory\" expand=\"@{expand-options}\"/>\n    <attribute name=\"java-maximum-memory\" expand=\"@{expand-options}\"/>\n    <element name=\"vm-options\" optional=\"true\" expand=\"@{expand-options}\"/>\n...\n\nThis would make the macro more flexible.\n\n\n\nIn case this isn't possible to implement, I'm sorry for my ignorance, I'm not familiar with Ant's internals at all.\n\nThank you,\nCsabi\n\nP.S.: I filed a bug against Launch4j:\n\n    https://sourceforge.net/tracker/?func=detail&aid=2764888&group_id=95944&atid=613100", "id": 126255, "time": "2009-04-15T05:20:37Z", "creator": "csaba.juhos@gmail.com", "creation_time": "2009-04-15T05:20:37Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 47035, "text": "Uh... Red herring alert:  I think the reason your attribute is not expanded is because you're not using it:\n\n<macrodef name=\"create-exe\">\n    <attribute name=\"java-initial-memory\"/>\n    <sequential>\n        <launch4j>\n            <config>\n                <jre>\n                    <opt>-Xms@{java.initial.memory}m</opt>\n                </jre>\n            </config>\n        </launch4j>\n    </sequential>\n</macrodef>\n\nThis should be:\n\n<macrodef name=\"create-exe\">\n    <attribute name=\"java-initial-memory\"/>\n    <sequential>\n        <launch4j>\n            <config>\n                <jre>\n                    <opt>-Xms@{java-initial-memory}m</opt>\n                </jre>\n            </config>\n        </launch4j>\n    </sequential>\n</macrodef>", "count": 1, "id": 126283, "time": "2009-04-16T08:04:08Z", "creator": "mbenson@apache.org", "creation_time": "2009-04-16T08:04:08Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 47035, "is_private": false, "id": 126314, "creation_time": "2009-04-16T20:56:20Z", "time": "2009-04-16T20:56:20Z", "creator": "csaba.juhos@gmail.com", "text": "Hi,\n\nIt's a typo. In my real code I have used the attribute correctly.\n\nWhat happens is that \"@{java-initial-memory}\" gets expanded to \"${java.initial.memory}\", which doesn't get expanded by the \"opt\" element, because it doesn't expand properties in its text.\n\nWhat I'm asking for is an option for the expansion of \"${java.initial.memory}\" when calling the macro, like this:\n\n<property name=\"java.initial.memory\" value=\"128\"/>\n<create-exe java-initial-memory=\"${java.initial.memory}\"/>\n...\n@{java-initial-memory} should expand to \"-Xms128m\"\n\nCheers,\nCsabi", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "coad@measurement-factory.com", "is_private": false, "text": "Looks like a possible RFC 2616 MUST violation when dealing\nwith unexpected 1xx responses. Mod_proxy forwards 199 response \nbut then terminates the connection and does not forward the \nactual (200 OK) response. Note that the \"100 Continue\" case\nworks OK, but I suspect that all other 1xx cases do not work.\n\nSee attached trace(s) for details and ways to reproduce\nthe violation mentioned above.\n\nTest case IDs in the trace link to human-oriented test case\ndescription and RFC quotes, if available.", "id": 30212, "time": "2003-01-28T23:12:56Z", "bug_id": 16518, "creation_time": "2003-01-28T23:12:56Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "coad@measurement-factory.com", "attachment_id": 4605, "is_private": false, "id": 30214, "time": "2003-01-28T23:15:46Z", "bug_id": 16518, "creation_time": "2003-01-28T23:15:46Z", "text": "Created attachment 4605\ntest case with 199 status code"}, {"count": 2, "tags": [], "bug_id": 16518, "attachment_id": 4606, "is_private": false, "id": 30215, "time": "2003-01-28T23:17:33Z", "creator": "coad@measurement-factory.com", "creation_time": "2003-01-28T23:17:33Z", "text": "Created attachment 4606\ntest case with 100 status code"}, {"count": 3, "tags": [], "bug_id": 16518, "attachment_id": null, "text": "As for \"100 Continue\" case, it does \"work\" (the\n200 OK response gets through) but still\nviolates the same RFC 2616 MUST because the \"100 Continue\"\nresponse is not forwarded. See attached trace.\n\nTo summarize, there are two, probably related bugs:\n\n- 1xx responses other than 100 are treated as normal\n  2xx responses; they are forwarded and the primary\n  response is not; both MUST be forwarded\n\n- 100 response is treated specially; it is not forwarded\n  but the primary response is; both MUST be forwarded\n", "id": 30216, "time": "2003-01-28T23:22:16Z", "creator": "coad@measurement-factory.com", "creation_time": "2003-01-28T23:22:16Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 16518, "attachment_id": null, "text": "The attached patch should forward all 1xx messages retrieved by mod_proxy to the\ninitiator.", "id": 66884, "time": "2004-11-14T19:22:29Z", "creator": "fidel@castro.br", "creation_time": "2004-11-14T19:22:29Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 16518, "attachment_id": 13454, "text": "Created attachment 13454\nForwarding 1xx messages.", "id": 66885, "time": "2004-11-14T19:23:20Z", "creator": "fidel@castro.br", "creation_time": "2004-11-14T19:23:20Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 16518, "text": "Comment on attachment 13454\nForwarding 1xx messages.\n\n--- proxy.org\\proxy_util.c\t2004-05-26 06:00:58.000000000 +0200\n+++ proxy.good\\proxy_util.c\t2004-12-19 01:10:36.604355200 +0100\n@@ -422,10 +422,21 @@\n\t\t    }\n\t\t}\n\t    }\n-\t    /* this is the psc->badopt == bad_ignore case */\n-\t    ap_log_error(APLOG_MARK, APLOG_WARNING, 0, r->server,\n-\t\t\t \"proxy: Ignoring bogus HTTP header \"\n-\t\t\t \"returned by %s (%s)\", r->uri, r->method);\n+\t\t// Because of RFC2616 section 10.1, we have to forward ALL 1xx\nresponses to http client\n+\t\t// using a protocol newer than HTTP/1.0 (see bug #16518 for\ndetails).\n+\t\tif (apr_date_checkmask(buffer, \"HTTP/#.# ###*\") && // it is a\nstatus code line\n+\t\t    ((HTTP_VERSION_MAJOR(r->proto_num) == 1 &&\nHTTP_VERSION_MINOR(r->proto_num) > 0) || // it is > HTTP/1.y, y > 0\n+\t\t    HTTP_VERSION_MAJOR(r->proto_num) > 1) && // or it is\nHTTP/x.*, x > 1\n+\t\t    atoi(&buffer[9]) >= 100 && // all status codes between 100\n+\t\t    atoi(&buffer[9]) <= 199) // and 200 have to be directed\n+\t\t{\n+\t\t\tr->status_line = apr_psprintf(r->pool, \"%s\\r\\n%s\",\nr->status_line, buffer); // add to output buffer\n+\t\t} else {\n+\t\t\t/* this is the psc->badopt == bad_ignore case */\n+\t\t\tap_log_error(APLOG_MARK, APLOG_WARNING, 0, r->server,\n+\t\t\t\t\"proxy: Ignoring bogus HTTP header \"\n+\t\t\t\t\"returned by %s (%s)\", r->uri, r->method);\n+\t\t}\n\t    continue;\n\t}", "id": 68696, "time": "2004-12-19T01:57:25Z", "creator": "schappy@mail.gr", "creation_time": "2004-12-19T01:57:25Z", "is_private": false, "attachment_id": 13454}, {"count": 7, "tags": [], "bug_id": 16518, "attachment_id": null, "text": "The updated patch solves the problem, that only clients using protocol HTTP/1.1\nor newer are able to interprate 1xx messages. Therefore, only these client get\nadditional 1xx status code; older ones MUST NOT get 1xx messages.", "id": 68697, "time": "2004-12-19T02:01:52Z", "creator": "schappy@mail.gr", "creation_time": "2004-12-19T02:01:52Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 16518, "attachment_id": null, "is_private": false, "id": 73629, "time": "2005-04-13T15:55:08Z", "creator": "jorton@redhat.com", "creation_time": "2005-04-13T15:55:08Z", "text": "*** Bug 34422 has been marked as a duplicate of this bug. ***"}, {"count": 9, "tags": [], "bug_id": 16518, "attachment_id": null, "id": 75994, "time": "2005-06-03T22:58:20Z", "creator": "coad@measurement-factory.com", "creation_time": "2005-06-03T22:58:20Z", "is_private": false, "text": "After patching httpd-2.0.54 (both original and\nthe updated patch), we are getting pretty much\nthe same violation -- the 199 control message\nis forwarded but the original 200 OK response\nis not (the proxy closes the connection after\nforwarding the 199 message).\n\nIf you post more patches, please attach them\nrather than editing in place. It is much easier\nand safer to extract them that way. Thank you.\n"}, {"count": 10, "tags": [], "bug_id": 16518, "attachment_id": null, "is_private": false, "id": 79505, "time": "2005-09-07T11:59:19Z", "creator": "jorton@redhat.com", "creation_time": "2005-09-07T11:59:19Z", "text": "*** Bug 36448 has been marked as a duplicate of this bug. ***"}, {"count": 11, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "is_private": false, "id": 107445, "time": "2007-08-29T17:08:11Z", "bug_id": 16518, "creation_time": "2007-08-29T17:08:11Z", "text": "In current trunk, there's similar-looking code around line 1139 of\nmod_proxy_http.c.  But AFAICT, what it's handling isn't a 1xx response under\nRFC2616#10.1, but just a malformed response header, by virtue of its placement\nin a response stream.\n\nAre you claiming there's a valid 1xx response that must be forwarded?  And if\nso, how specifically would I run your test?"}, {"count": 12, "tags": [], "bug_id": 16518, "attachment_id": null, "text": "(In reply to comment #11)\n> Are you claiming there's a valid 1xx response that must be forwarded?\n\nYes, the attached test cases show that a valid 100 response is not forwarded \n(one bug out of two). I do not know whether the bug got fixed since we ran \nthese tests in 2005.\n\n> And if so, how specifically would I run your test?\n\nTo reproduce, you can script the test case following the attached trace.\n\nWe will repeat full Co-Advisor tests eventually, but our free cycles are \nlimited so it may not happen soon. If Apache is interested in running Co-\nAdvisor tests, we would be happy to give access to the tool (we have offered \nthat in the past but nobody we talked to at Apache was interested).\n\nThank you.\n", "id": 107450, "time": "2007-08-29T18:39:35Z", "creator": "coad@measurement-factory.com", "creation_time": "2007-08-29T18:39:35Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 16518, "attachment_id": null, "is_private": false, "id": 108894, "time": "2007-10-02T06:28:40Z", "creator": "nick@webthing.com", "creation_time": "2007-10-02T06:28:40Z", "text": "*** Bug 19442 has been marked as a duplicate of this bug. ***"}, {"count": 14, "tags": [], "bug_id": 16518, "attachment_id": null, "text": "The behaviour has changed from what is described here, but remains broken, and\nthe summary remains accurate.  Current behaviour is that mod_proxy just eats\ninterim responses.", "id": 108897, "time": "2007-10-02T06:32:03Z", "creator": "nick@webthing.com", "creation_time": "2007-10-02T06:32:03Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 16518, "attachment_id": null, "is_private": false, "id": 109072, "time": "2007-10-07T06:51:38Z", "creator": "nick@webthing.com", "creation_time": "2007-10-07T06:51:38Z", "text": "Fixed in trunk in r582631.\n\nThis seems to me like a weak area in the testsuite: it highlights unexpected\nresponses but not the circumstances that could give rise to expected and\nessential 1xx responses."}, {"count": 16, "tags": [], "bug_id": 16518, "attachment_id": null, "is_private": false, "id": 111580, "time": "2007-12-08T06:38:05Z", "creator": "nick@webthing.com", "creation_time": "2007-12-08T06:38:05Z", "text": "Fixed in r602468."}]
[{"count": 0, "tags": [], "bug_id": 53777, "attachment_id": null, "text": "I would like to let JAASRealm to load JAAS Configuration from a .properties file bundled in a web application (either in WEB-INF/classes or in any JAR on the classpath of the context)\n\nActually (7.0.29) JAASRealm creates a LoginContext using the 2-args constructor\nloginContext = new LoginContext(appName, callbackHandler); \n\nI propose to add a new configuration parameter on JAASRealm to let it load a javax.security.auth.login.Configuration from the ContextClassLoader\n\nthis new Configuration has to be passed to the 4-args constructor\nloginContext = new LoginContext(appName, subject, callbackHandler, configuration); \n\nhttp://docs.oracle.com/javase/6/docs/api/javax/security/auth/login/LoginContext.html#LoginContext%28java.lang.String,%20javax.security.auth.Subject,%20javax.security.auth.callback.CallbackHandler,%20javax.security.auth.login.Configuration%29", "id": 161664, "time": "2012-08-24T13:50:52Z", "creator": "eolivelli@gmail.com", "creation_time": "2012-08-24T13:50:52Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 53777, "text": "method parseClassNames in JAASRealm sometimes (not always) uses as ContextClassLoader this one\n\nWebappClassLoader\n  context: /manager\n  delegate: false\n  repositories:\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@9fa0f19\n\nIn my case this causes JASSRealm not to find custom Principal classes (userClassNames and roleClassNames)", "id": 161670, "time": "2012-08-24T14:55:18Z", "creator": "eolivelli@gmail.com", "creation_time": "2012-08-24T14:55:18Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 53777, "attachment_id": 29274, "id": 161672, "time": "2012-08-24T15:05:45Z", "creator": "eolivelli@gmail.com", "creation_time": "2012-08-24T15:05:45Z", "is_private": false, "text": "Created attachment 29274\nThis is a subclass of JASSRealm that implements the feature"}, {"count": 3, "tags": [], "bug_id": 53777, "attachment_id": 29275, "id": 161675, "time": "2012-08-24T15:29:46Z", "creator": "eolivelli@gmail.com", "creation_time": "2012-08-24T15:29:46Z", "is_private": false, "text": "Created attachment 29275\nPatch on JAASRealm (tomcat 7 trunk)\n\nI tried to write a patch against JAASREalm.java (don't know if it is the correct format)\n\nPatch is for Tomcat 7 trunk\n\nthis is what is does:\n- adds \"configfile\" property (will be resolved as ClassLoader.getResource().toURI) to require the use of a custom JAAS Configuration file\n- instantiates a \"sun\" ConfigFile (using Reflection) to have a Configuration\n- uses the 4-args constructor of LoginContext (in order to use the custom configuration)\n- sets a work-around for a bug in Realm setup (parseClassNames) because sometimes that method is not called with a good contextclassloader"}, {"count": 4, "tags": [], "bug_id": 53777, "attachment_id": null, "text": "(In reply to comment #1)\n> method parseClassNames in JAASRealm sometimes (not always) uses as\n> ContextClassLoader this one\n> \n> WebappClassLoader\n>   context: /manager\n>   delegate: false\n>   repositories:\n> ----------> Parent Classloader:\n> org.apache.catalina.loader.StandardClassLoader@9fa0f19\n> \n> In my case this causes JASSRealm not to find custom Principal classes\n> (userClassNames and roleClassNames)\n\nIf your <Realm> is in conf/context.xml this behaviour is as expected,\nbecause the conf/context.xml file is shared by all web applications, including the Manager one.\n\nIf you observe it is different circumstances, please file a separate bug report and include the stacktrace from the thread that calls parseClassNames.\n(If TCCL is set incorrectly by the calling thread that would be a bug).", "id": 161696, "time": "2012-08-25T14:18:30Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-08-25T14:18:30Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 53777, "attachment_id": null, "id": 161703, "time": "2012-08-26T06:49:27Z", "creator": "eolivelli@gmail.com", "creation_time": "2012-08-26T06:49:27Z", "is_private": false, "text": "Sorry,\nI was using TomEE (Tomcat + OpenEJB).\nWith a raw Tomcat the problem does not happen, I reported this problem on OpenEJB list"}, {"count": 6, "tags": [], "bug_id": 53777, "text": "Created attachment 29280\nPatch on JAASRealm (tomcat 7 trunk)\n\nUpdating the patch, without the workaround for TomEE cl bug (that has been resolved too, in openejb trunk)", "id": 161708, "time": "2012-08-26T15:51:00Z", "creator": "eolivelli@gmail.com", "creation_time": "2012-08-26T15:51:00Z", "is_private": false, "attachment_id": 29280}, {"count": 7, "tags": [], "bug_id": 53777, "attachment_id": null, "text": "Thanks for the patch.\n\nIt has been applied (with minor changes) to trunk and 7.0.x and will be included in 7.0.42 onwards. I also added some documentation for the new option.", "id": 168191, "time": "2013-07-01T15:01:12Z", "creator": "markt@apache.org", "creation_time": "2013-07-01T15:01:12Z", "is_private": false}]
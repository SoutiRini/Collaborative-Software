[{"count": 0, "tags": [], "bug_id": 53854, "text": "The following situation does not seem to work.\n\n1.) In a Context, add an alias to a directory.\n2.) Enable directory listings on the DefaultServlet.\n3.) Try to view the directory listing of the alias directory.\n\nExample:\n\nconf/context.xml:\n\n  <Context aliases=\"/files=/my/downloads\">\n  ...\n  </Context>\n\nconf/web.xml:\n\n    ...\n    <servlet>\n        <servlet-name>default</servlet-name>\n        <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>\n        <init-param>\n            <param-name>debug</param-name>\n            <param-value>0</param-value>\n        </init-param>\n        <init-param>\n            <param-name>listings</param-name>\n            <param-value>true</param-value>\n        </init-param>\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n    ...\n\ncontents of the directory \"/my/downloads\":\n\n  -rw-r--r--@ 1 daniel  staff  8156824 Sep 10 09:15 apache-tomcat-7.0.30.zip\n\nURL works:\n\nhttp://localhost:8080/files/apache-tomcat-7.0.30.zip\n\nURL does not work:\n\nhttp://localhost:8080/files/\n\nThe URL that does not work fails with the error:\n\nSEVERE: Servlet.service() for servlet [default] in context with path [/] threw exception [Error accessing resource] with root cause\njavax.naming.NameNotFoundException: Resource /files/ not found\n\tat org.apache.naming.resources.FileDirContext.list(FileDirContext.java:303)\n\tat org.apache.naming.resources.ProxyDirContext.list(ProxyDirContext.java:512)\n\tat org.apache.catalina.servlets.DefaultServlet.renderHtml(DefaultServlet.java:1458)\n\tat org.apache.catalina.servlets.DefaultServlet.render(DefaultServlet.java:1254)\n\tat org.apache.catalina.servlets.DefaultServlet.serveResource(DefaultServlet.java:951)\n\tat org.apache.catalina.servlets.DefaultServlet.doGet(DefaultServlet.java:412)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:621)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:929)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1002)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:585)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:680)", "id": 162083, "time": "2012-09-11T20:28:09Z", "creator": "dmikusa@gopivotal.com", "creation_time": "2012-09-11T20:28:09Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 53854, "attachment_id": 29357, "id": 162085, "time": "2012-09-11T20:50:29Z", "creator": "dmikusa@gopivotal.com", "creation_time": "2012-09-11T20:50:29Z", "is_private": false, "text": "Created attachment 29357\nPatch to DefaultServlet to workaround the error.\n\nI was able to work around this error with a slight modification to the DefaultServlet code.  Not sure if this is the best solution, but it seems to work without breaking anything so I'm attaching it here."}, {"count": 2, "tags": [], "bug_id": 53854, "text": "The proposed patch fixes the symptom rather than the cause. The fix needs to be in BaseDirContext and other classes in the same package.", "id": 162234, "time": "2012-09-17T16:24:36Z", "creator": "markt@apache.org", "creation_time": "2012-09-17T16:24:36Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 53854, "text": "Created attachment 29384\nUpdated patch, works with BaseDirContext and FileDirContext", "id": 162250, "time": "2012-09-18T16:37:57Z", "creator": "dmikusa@gopivotal.com", "creation_time": "2012-09-18T16:37:57Z", "is_private": false, "attachment_id": 29384}, {"count": 4, "tags": [], "bug_id": 53854, "text": "The patch is not functionally correct for FileDirContext and still does not address the root cause.\n\nIssue include:\n- ignores WARDirContext\n- ignores 3rd party sub-classes\n- does not use correct priority for aliases", "id": 162252, "time": "2012-09-18T17:22:35Z", "creator": "markt@apache.org", "creation_time": "2012-09-18T17:22:35Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 53854, "text": "This has been fixed in trunk and 7.0.x and will be included in 7.0.31 onwards.", "id": 162475, "time": "2012-09-30T19:49:17Z", "creator": "markt@apache.org", "creation_time": "2012-09-30T19:49:17Z", "is_private": false, "attachment_id": null}]
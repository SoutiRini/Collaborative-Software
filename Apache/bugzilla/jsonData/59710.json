[{"count": 0, "tags": [], "text": "Hello, \n\nWe are using Tomcat 7.0.69 and suspect a bug with session.close() when \"Connection timed out\" happens sporadically. When the exception is thrown @onError correctly is called and I call session.close but the connection is still open in limbo which cause memory leak. \n\nOn the client we use Tyrus with reconnectHandler and set HeartBeatIntervall to 1 minute. When the timeout exception is thrown in Tomcat, Tyrus is still happy with the connection even though its closed in Tomcat. \n\nMy theory is that there is a problem with session.close() when a timeout occurs. It never really gets closed. \nI have set the connectionTimeout=-1 connectionUploadTimeout=-1 in server.xml. \n\nAnyone has a clue? \n\nBR, \nHugo \n\njava.io.IOException: Connection timed out \n        at sun.nio.ch.FileDispatcherImpl.read0(Native Method) \n        at sun.nio.ch.SocketDispatcher.read(SocketDispatcher.java:39) \n        at sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:223) \n        at sun.nio.ch.IOUtil.read(IOUtil.java:192) \n        at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:384) \n        at org.apache.tomcat.util.net.SecureNioChannel.read(SecureNioChannel.java:442) \n        at org.apache.coyote.http11.upgrade.NioServletInputStream.fillReadBuffer(NioServletInputStream.java:136) \n        at org.apache.coyote.http11.upgrade.NioServletInputStream.doRead(NioServletInputStream.java:80) \n        at org.apache.coyote.http11.upgrade.AbstractServletInputStream.read(AbstractServletInputStream.java:129) \n        at org.apache.tomcat.websocket.server.WsFrameServer.onDataAvailable(WsFrameServer.java:56) \n        at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler$WsReadListener.onDataAvailable(WsHttpUpgradeHa \nndler.java:205) \n        at org.apache.coyote.http11.upgrade.AbstractServletInputStream.onDataAvailable(AbstractServletInputStream \n.java:203) \n        at org.apache.coyote.http11.upgrade.AbstractProcessor.upgradeDispatch(AbstractProcessor.java:93) \n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:623) \n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1749) \n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1708) \n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) \n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) \n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) \n        at java.lang.Thread.run(Thread.java:745)", "attachment_id": null, "id": 191688, "creator": "hugo.larson@yahoo.com", "time": "2016-06-15T15:54:15Z", "bug_id": 59710, "creation_time": "2016-06-15T15:54:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59710, "attachment_id": null, "id": 191695, "time": "2016-06-15T19:30:32Z", "creator": "markt@apache.org", "creation_time": "2016-06-15T19:30:32Z", "is_private": false, "text": "This should be fixed in trunk and will be included in the 7.0.70 release currently in progress. If you still see this issue with 7.0.70 please provide the simplest possible test case that demonstrates the issue and we'll take another look."}, {"count": 2, "tags": [], "bug_id": 59710, "text": "Will do!\n\nBR,\nHugo", "id": 191699, "time": "2016-06-15T20:36:23Z", "creator": "hugo.larson@yahoo.com", "creation_time": "2016-06-15T20:36:23Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 59710, "attachment_id": null, "text": "I'm afraid that the problem is not fixed with 7.0.70.\nI have no clue to emulate a timeout Exception.\n\nBR,\nHugo", "id": 191907, "time": "2016-06-23T10:46:56Z", "creator": "hugo.larson@yahoo.com", "creation_time": "2016-06-23T10:46:56Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 59710, "attachment_id": null, "id": 192019, "creation_time": "2016-06-29T17:24:10Z", "time": "2016-06-29T17:24:10Z", "creator": "markt@apache.org", "text": "Stacktrace from 7.0.70 please.", "is_private": false}, {"count": 5, "tags": [], "bug_id": 59710, "text": "java.io.IOException: Connection timed out\n\tat sun.nio.ch.FileDispatcherImpl.read0(Native Method)\n\tat sun.nio.ch.SocketDispatcher.read(SocketDispatcher.java:39)\n\tat sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:223)\n\tat sun.nio.ch.IOUtil.read(IOUtil.java:192)\n\tat sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:384)\n\tat org.apache.tomcat.util.net.SecureNioChannel.read(SecureNioChannel.java:442)\n\tat org.apache.coyote.http11.upgrade.NioServletInputStream.fillReadBuffer(NioServletInputStream.java:136)\n\tat org.apache.coyote.http11.upgrade.NioServletInputStream.doRead(NioServletInputStream.java:80)\n\tat org.apache.coyote.http11.upgrade.AbstractServletInputStream.read(AbstractServletInputStream.java:129)\n\tat org.apache.tomcat.websocket.server.WsFrameServer.onDataAvailable(WsFrameServer.java:56)\n\tat org.apache.tomcat.websocket.server.WsHttpUpgradeHandler$WsReadListener.onDataAvailable(WsHttpUpgradeHandler.java:204)\n\tat org.apache.coyote.http11.upgrade.AbstractServletInputStream.onDataAvailable(AbstractServletInputStream.java:203)\n\tat org.apache.coyote.http11.upgrade.AbstractProcessor.upgradeDispatch(AbstractProcessor.java:93)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:621)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1756)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1715)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)", "id": 192036, "time": "2016-06-30T21:30:18Z", "creator": "hugo.larson@yahoo.com", "creation_time": "2016-06-30T21:30:18Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 59710, "attachment_id": null, "id": 192043, "time": "2016-07-01T11:23:25Z", "creator": "markt@apache.org", "creation_time": "2016-07-01T11:23:25Z", "is_private": false, "text": "I've tried manually triggering an exeception in the relevant code but I still see the server and client session being correctly closed and cleaned up.\n\nTo investigate this further we need more information. Ideally, we need a simple web application that demonstrates the problem. We also need details of the memory leak. What references are held by which object to which objects?"}, {"count": 7, "tags": [], "bug_id": 59710, "text": "No further response for 3+ months. Resolving as WORKSFORME.", "id": 194153, "time": "2016-10-05T14:02:06Z", "creator": "markt@apache.org", "creation_time": "2016-10-05T14:02:06Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "text": "Situation:\nwar target with the following zipfileset definition:\n    <zipfileset prefix=\"${ias.build.version}/js/\" refid=\"netWindows\" />\n\nOppossed to what is stated in case 30498 (Ant 1.6.2), This worked with Ant 1.6.5\nThe war is created with the correct prefix in the archive.\n\nWith Ant 1.7.0RC1 this regressed to breaking the build with error;\nBUILD FAILED\ncommon.xml:576: You must not specify more than one attribute when using refid\n\nSo Case 30498 is incorrect, refid + prefix worked in 1.6.5. It is a regression\nthis stopped working in 1.7.0RC1. This might be an undocumented feature but this\nremoves existing functionality and breaks current builds.", "creator": "ajbanck@informatica.com", "is_private": false, "id": 96002, "time": "2006-11-20T07:10:46Z", "bug_id": 41004, "creation_time": "2006-11-20T07:10:46Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "creator": "ajbanck@informatica.com", "is_private": false, "text": "Created attachment 19148\nDemonstrating that using a zipfileset with a ref to a fileset worked in 6.5\n\nLooked into this, case 30498 is about using a ref to a *zipfileset*.\nIn this case I use a ref to a *fileset*. \nIn 6.5 using a refid to a fileset allowed to set the prefix and this worked.\nAttached demonstration that produces test-fileset-prefix.war with correct\nprefix", "id": 96005, "time": "2006-11-20T08:08:14Z", "bug_id": 41004, "creation_time": "2006-11-20T08:08:14Z", "attachment_id": 19148}, {"count": 2, "tags": [], "bug_id": 41004, "attachment_id": 19149, "is_private": false, "id": 96006, "time": "2006-11-20T10:05:14Z", "creator": "peterreilly@apache.org", "creation_time": "2006-11-20T10:05:14Z", "text": "Created attachment 19149\nAllow prefix to be used for id'ed filesets in archive filesets\n\nCan you apply the included patch and see\nif it works for you.\nGet the ant source, compile it ./build.sh or build.bat, and\ncopy the $ANT_SRC/dist/lib/ant.jar to $ANT_HOME/lib/ant.jar"}, {"count": 3, "tags": [], "bug_id": 41004, "attachment_id": 19149, "is_private": false, "id": 96024, "time": "2006-11-21T01:58:46Z", "creator": "ajbanck@informatica.com", "creation_time": "2006-11-21T01:58:46Z", "text": "Comment on attachment 19149\nAllow prefix to be used for id'ed filesets in archive filesets\n\n>Index: src/main/org/apache/tools/ant/types/ArchiveFileSet.java\n>===================================================================\n>--- src/main/org/apache/tools/ant/types/ArchiveFileSet.java\t(revision 475170)\n>+++ src/main/org/apache/tools/ant/types/ArchiveFileSet.java\t(working copy)\n>@@ -178,7 +178,11 @@\n>      * @param prefix The prefix to prepend to entries in the archive file.\n>      */\n>     public void setPrefix(String prefix) {\n>-        checkAttributesAllowed();\n>+        if (isReference()\n>+            && (getRefid().getReferencedObject(getProject())\n>+                instanceof ArchiveFileSet)) {\n>+            checkAttributesAllowed();\n>+        }\n>         if (!prefix.equals(\"\") && !fullpath.equals(\"\")) {\n>             throw new BuildException(\"Cannot set both fullpath and prefix attributes\");\n>         }"}, {"count": 4, "tags": [], "bug_id": 41004, "attachment_id": null, "id": 96025, "time": "2006-11-21T02:01:51Z", "creator": "ajbanck@informatica.com", "creation_time": "2006-11-21T02:01:51Z", "is_private": false, "text": "Needed to add extra ')' after 'instanceof ArchiveFileSet' to make it build,\nafter this patch worked as expected."}, {"count": 5, "text": "I understand the motivation of trying to use refid and prefix in this case, but\nI think this is wrong in the sense that everywhere else, we disallow\nmodification of a refid's element, and I'm not fond of an exception here. We may\nkeep it here as a documented exception for BC, but otherwise you can refid the\npatternset inside the  *fileset, and add your prefix attribute. Or we support\nsomething like <zipfileset prefix=\"foo\"> <zipfileset refid=\"bar\" />\n</zipfileset>, or <zipfileset prefix=\"foo\" extends-id=\"bar\" />. Renaming the\nattribute might be a good compromise, no? --DD", "creator": "ddevienne@gmail.com", "is_private": false, "id": 96030, "time": "2006-11-21T06:43:02Z", "bug_id": 41004, "creation_time": "2006-11-21T06:43:02Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "creator": "stevel@apache.org", "is_private": false, "text": "You know, I was trying to do this exact thing at work last week. Define a\nfileset of files and then import it into both a tarfile and a zip file. \n\nBecause I was using 1.7.0, it failed on me, even though I had the vague idea\nthat it would work...I had to resort to duplicate declarations. If I had used\nant1.6 it would have worked, and I too would have viewed the 1.7 behaviour as a\nregression.\n\nPutting aside the notion of immutable references, the underlying problem is 'how\nto add an existing fileset to a tar or zip file under a new path'. We could do a\nclean way that doesnt break the rules, and maybe resources already permit it.\nBut since a way already did exist (possibly deliberately added in the past), we\nmay just want to retain the old one.\n\n\nNb, regarding the extends attribute \n\n<zipfileset prefix=\"foo\" extends-id=\"bar\" />\n\nThat raises expecations too high, as you start thinking you can nest\n\n<zipfileset prefix=\"foo\" extends-id=\"bar\" >\n  <include name=\"*.class\" />\n</zipfileset>\n\nA new resource may be better, one that doesnt take children.\n\n<zipfilesetref prefix=\"foo\" refid=\"bar\" />", "id": 96032, "time": "2006-11-21T07:37:40Z", "bug_id": 41004, "creation_time": "2006-11-21T07:37:40Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "In this case I think it is a good idea to allow fileset\nto be used in zipfileset/tarfileset.\nThe refid refers to the fileset, the prefix/encoding\nor other attributes is how the fileset is used in the archive.\nIf the refid refers to another zipfileset, the prefix attribute\nwill be rejected.\n\nI have the required code for this and will commit\nwhen I get to my svn connected box.\n\n\n", "is_private": false, "id": 96034, "creator": "peterreilly@apache.org", "time": "2006-11-21T08:44:14Z", "bug_id": 41004, "creation_time": "2006-11-21T08:44:14Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "*** Bug 30498 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 41004, "id": 96046, "time": "2006-11-21T13:51:59Z", "creator": "peterreilly@apache.org", "creation_time": "2006-11-21T13:51:59Z", "is_private": false}, {"count": 9, "tags": [], "text": "Ok I have made the modification to (re)allow prefix + other\narchive attributes to be used with zipfileset and tarfileset.\n\nThanks for the report and the build file showing the regression.\n", "attachment_id": null, "bug_id": 41004, "id": 96048, "time": "2006-11-21T13:54:40Z", "creator": "peterreilly@apache.org", "creation_time": "2006-11-21T13:54:40Z", "is_private": false}]
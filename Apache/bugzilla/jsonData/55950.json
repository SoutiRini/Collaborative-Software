[{"count": 0, "attachment_id": null, "creator": "ufaria@gmail.com", "text": "same as Bug 34908 and 21828\n\n\nHello. I have a problem with RewriteCond and \u201c-U\u201d url test.\n\nwhen URI doesn\u2019t exist RewriteCond sais YES, STATUS=200.\n\nit happens with apache from debian package, centos 6.5 package, and apache 2.2.25 compiled.\nworker and child confs .. etc.\n\nhere is a small test conf and my rewrite log and strace to apache child.\n\nI GET /u that doesn't exists and have to rewrite to /i.html\n\n\n-- conf \u2013\n\nFileETag INode MTime Size\nServerTokens Prod\nServerSignature Off\n\n<VirtualHost *>\n        ServerAdmin webmaster@localhost\n        ServerName localhost\n        DocumentRoot /tmp/rw\n\n        RewriteEngine On\n        RewriteLog /tmp/rewrite_log\n        RewriteLogLevel 5\n\n        RewriteCond %{REQUEST_URI} !-U\n        RewriteRule .* /i.html [L,PT,NS]\n\n</VirtualHost>\n\n--- rewrite log---\n\n192.168.88.1 - - [03/Jan/2014:15:13:49 +0100] [consola/sid#b746fab8][rid#b6b9c058/initial] (2) init rewrite engine with requested uri /u\n192.168.88.1 - - [03/Jan/2014:15:13:49 +0100] [consola/sid#b746fab8][rid#b6b9c058/initial] (3) applying pattern '.*' to uri '/u'\n192.168.88.1 - - [03/Jan/2014:15:13:49 +0100] [consola/sid#b746fab8][rid#b6b53058/subreq] (2) init rewrite engine with requested uri /u\n192.168.88.1 - - [03/Jan/2014:15:13:49 +0100] [consola/sid#b746fab8][rid#b6b53058/subreq] (1) pass through /u\n192.168.88.1 - - [03/Jan/2014:15:13:49 +0100] [consola/sid#b746fab8][rid#b6b9c058/initial] (5) RewriteCond URI (-U) check: path=/u -> status=200         <--- WTF!!\n192.168.88.1 - - [03/Jan/2014:15:13:49 +0100] [consola/sid#b746fab8][rid#b6b9c058/initial] (4) RewriteCond: input='/u' pattern='!-U' => not-matched\n192.168.88.1 - - [03/Jan/2014:15:13:49 +0100] [consola/sid#b746fab8][rid#b6b9c058/initial] (1) pass through /u\n\n-- strace apache child --\n\nProcess 18602 attached - interrupt to quit\nsemop(1540098, {{0, -1, SEM_UNDO}}, 1)  = 0\naccept4(4, {sa_family=AF_INET6, sin6_port=htons(61331), inet_pton(AF_INET6, \"::ffff:192.168.88.1\", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28], SOCK_CLOEXEC) = 14\nsemop(1540098, {{0, 1, SEM_UNDO}}, 1)   = 0\ngettimeofday({1388758610, 789841}, NULL) = 0\ngetsockname(14, {sa_family=AF_INET6, sin6_port=htons(80), inet_pton(AF_INET6, \"::ffff:192.168.88.128\", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 0\nfcntl64(14, F_GETFL)                    = 0x2 (flags O_RDWR)\nfcntl64(14, F_SETFL, O_RDWR|O_NONBLOCK) = 0\ngettimeofday({1388758610, 790127}, NULL) = 0\ngettimeofday({1388758610, 790159}, NULL) = 0\ngettimeofday({1388758610, 790178}, NULL) = 0\nread(14, \"GET /u HTTP/1.1\\r\\nHost: consola\\r\\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:26.0) Gecko/20100101 Firefox/26.0\\r\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\\r\\nAccept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3\\r\\nAccept-Encoding: gzip, deflate\\r\\nConnection: keep-alive\\r\\nCache-Control: max-age=0\\r\\n\\r\\n\", 8000) = 329\ngettimeofday({1388758610, 790441}, NULL) = 0\ngettimeofday({1388758610, 790470}, NULL) = 0\ngettimeofday({1388758610, 791164}, NULL) = 0\ngettimeofday({1388758610, 791196}, NULL) = 0\nwrite(12, \"192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] [consola/sid#b746fab8][rid#b6b55058/initial] (2) init rewrite engine with requested uri /u\\n\", 137) = 137\ngettimeofday({1388758610, 791315}, NULL) = 0\nwrite(12, \"192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] [consola/sid#b746fab8][rid#b6b55058/initial] (3) applying pattern '.*' to uri '/u'\\n\", 129) = 129\ngettimeofday({1388758610, 791402}, NULL) = 0\nwrite(12, \"192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] [consola/sid#b746fab8][rid#b6b05058/subreq] (2) init rewrite engine with requested uri /u\\n\", 136) = 136\ngettimeofday({1388758610, 791665}, NULL) = 0\nwrite(12, \"192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] [consola/sid#b746fab8][rid#b6b05058/subreq] (1) pass through /u\\n\", 110) = 110\nstat64(\"/tmp/rw/u\", 0xbfee9e80)         = -1 ENOENT (No such file or directory)\nlstat64(\"/tmp\", {st_mode=S_IFDIR|S_ISVTX|0777, st_size=4096, ...}) = 0\nlstat64(\"/tmp/rw\", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0\nlstat64(\"/tmp/rw/u\", 0xbfee9e80)        = -1 ENOENT (No such file or directory)\ngettimeofday({1388758610, 792060}, NULL) = 0\nwrite(12, \"192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] [consola/sid#b746fab8][rid#b6b55058/initial] (5) RewriteCond URI (-U) check: path=/u -> status=200\\n\", 145) = 145   <-- WTF!!!\ngettimeofday({1388758610, 792129}, NULL) = 0\nwrite(12, \"192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] [consola/sid#b746fab8][rid#b6b55058/initial] (4) RewriteCond: input='/u' pattern='!-U' => not-matched\\n\", 148) = 148\ngettimeofday({1388758610, 792197}, NULL) = 0\nwrite(12, \"192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] [consola/sid#b746fab8][rid#b6b55058/initial] (1) pass through /u\\n\", 111) = 111\nstat64(\"/tmp/rw/u\", 0xbfeea200)         = -1 ENOENT (No such file or directory)\nlstat64(\"/tmp\", {st_mode=S_IFDIR|S_ISVTX|0777, st_size=4096, ...}) = 0\nlstat64(\"/tmp/rw\", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0\nlstat64(\"/tmp/rw/u\", 0xbfeea200)        = -1 ENOENT (No such file or directory)\ngettimeofday({1388758610, 792632}, NULL) = 0\nwrite(2, \"[Fri Jan 03 15:16:50 2014] [error] [client 192.168.88.1] File does not exist: /tmp/rw/u\\n\", 88) = 88\nbrk(0xb8b50000)                         = 0xb8b50000\ngettimeofday({1388758610, 792861}, NULL) = 0\nwrite(2, \"[Fri Jan 03 15:16:50 2014] [debug] mod_deflate.c(615): [client 192.168.88.1] Zlib: Compressed 199 to 156 : URL /u\\n\", 114) = 114\nbrk(0xb8b20000)                         = 0xb8b20000\nwritev(14, [{\"HTTP/1.1 404 Not Found\\r\\nDate: Fri, 03 Jan 2014 14:16:50 GMT\\r\\nServer: Apache\\r\\nVary: Accept-Encoding\\r\\nContent-Encoding: gzip\\r\\nContent-Length: 174\\r\\nConnection: close\\r\\nContent-Type: text/html; charset=iso-8859-1\\r\\n\\r\\n\", 211}, {\"\\37\\213\\10\\0\\0\\0\\0\\0\\0\\3\", 10}, {\"M\\2161\\17\\2020\\20\\205\\367\\376\\212\\223]\\16\\rc\\323A\\201H\\202HL\\31\\0341=S\\22\\244H\\213\\306\\177/\\205\\305\\361\\335\\373\\356\\313\\343\\233\\344r\\224\\267*\\205\\223<\\27P\\325\\207\\\"?B\\260E\\314S\\231!&2Y\\233}\\30!\\246e \\30\\327\\356\\331\\t\\256\\251Qsp\\255\\353H\\304Q\\f\\245q\\220\\231\\251W\\34\\327#\\343\\270@\\374n\\324\\327\\377\\355\\304\\0373'\\306\\7!5\\301H\\257\\211\\254#\\5\\365\\265\\0\\234\\340\\323X\\350g\\364\\341Q0=8\\335Z\\2604\\276i\\f9\\16^\\275Hg\\215\\37\\303~\", 156}, {\"\\314\\364\\320r\\307\\0\\0\\0\", 8}], 4) = 385\ngettimeofday({1388758610, 793408}, NULL) = 0\nwrite(7, \"localhost:80 192.168.88.1 - - [03/Jan/2014:15:16:50 +0100] \\\"GET /u HTTP/1.1\\\" 404 385 \\\"-\\\" \\\"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:26.0) Gecko/20100101 Firefox/26.0\\\"\\n\", 164) = 164\ngettimeofday({1388758610, 793704}, NULL) = 0\ntimes({tms_utime=0, tms_stime=0, tms_cutime=0, tms_cstime=0}) = 1729904640\ngettimeofday({1388758610, 793756}, NULL) = 0\nshutdown(14, 1 /* send */)              = 0\npoll([{fd=14, events=POLLIN}], 1, 2000) = 1 ([{fd=14, revents=POLLIN|POLLHUP}])\nread(14, \"\", 512)                       = 0\nclose(14)                               = 0\nread(5, 0xbfeea4ab, 1)                  = -1 EAGAIN (Resource temporarily unavailable)\ngettimeofday({1388758610, 794810}, NULL) = 0\nsemop(1540098, {{0, -1, SEM_UNDO}}, 1^C <unfinished ...>\nProcess 18602 detached", "id": 172060, "time": "2014-01-03T14:38:41Z", "bug_id": 55950, "creation_time": "2014-01-03T14:38:41Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 55950, "attachment_id": null, "text": "-U doesn't do what you need and the doc could be updated. The handler/generator is not actually run.  Marking as a duplicate.\n\n*** This bug has been marked as a duplicate of bug 21828 ***", "id": 172061, "time": "2014-01-03T14:52:59Z", "creator": "covener@gmail.com", "creation_time": "2014-01-03T14:52:59Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 55950, "attachment_id": null, "id": 172063, "time": "2014-01-03T15:06:18Z", "creator": "ufaria@gmail.com", "creation_time": "2014-01-03T15:06:18Z", "is_private": false, "text": "and what it do?\n\nmod_rewrite uses ap_sub_req_lookup_uri to test URI and seems very clear."}, {"count": 3, "tags": [], "bug_id": 55950, "text": "(In reply to uxio faria from comment #2)\n> and what it do?\n> \n> mod_rewrite uses ap_sub_req_lookup_uri to test URI and seems very clear.\n\nIt looks up the subrequest, but does not execute it (= run the handler). It's intended to check AAA.", "id": 172064, "time": "2014-01-03T15:07:47Z", "creator": "covener@gmail.com", "creation_time": "2014-01-03T15:07:47Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "ufaria@gmail.com", "is_private": false, "id": 172065, "time": "2014-01-03T15:49:12Z", "bug_id": 55950, "creation_time": "2014-01-03T15:49:12Z", "tags": [], "text": "I need to test a file with rewrite through an apache Alias.\n\nwhith RewriteCond -F, -f and -d can't.\n\n\u00bfwhy -F doesn't work??\n\nwith -U i see with strace that apache do stat on rigth file using\nAlias but ever get status=200"}, {"count": 5, "tags": [], "bug_id": 55950, "attachment_id": null, "text": "try a mailing list, bugzilla is for reporting bugs only.", "id": 172066, "time": "2014-01-03T16:04:46Z", "creator": "covener@gmail.com", "creation_time": "2014-01-03T16:04:46Z", "is_private": false}]
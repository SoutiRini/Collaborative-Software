[{"count": 0, "tags": [], "text": "I'm using JNDIRealm with the following setup.\n\n<Realm className=\"org.apache.catalina.realm.JNDIRealm\"\n\tdebug=\"99\"\n\tconnectionName=\"cn=Directory Manager\"\n\tconnectionPassword=\"mypassword\"\n\tconnectionURL=\"ldap://myldapserver\"\n\troleBase=\"ou=roles, dc=mydomain\"\n\troleName=\"cn\"\n\troleSearch=\"(uniqueMember={0})\"\n\troleSubtree=\"false\"\n\tuserPattern=\"uid={0}, ou=People, dc=mydomain\"/>\n\nAs you can see, I have it setup so that it authenticates the user by binding \nto the directory as them rather than querying for a password attribute. I \nfound that for every authentication (i.e. everytime I access a protected page) \nit authenticates two extra times.\n\nThe following is what gets written to the log for iPlanet Directory Server 5.1 \nduring one authentication. As you can see, it does the same thing three times \ninstead of only once.\n\nI tested this with OpenLDAP as well and the behavior was the same.\n\n[07/Jun/2002:15:03:01 -0500] conn=14 op=0 BIND dn=\"cn=Directory Manager\" \nmethod=128 version=3\n[07/Jun/2002:15:03:01 -0500] conn=14 op=0 RESULT err=0 tag=97 nentries=0 \netime=0 dn=\"cn=directory manager\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=1 BIND dn=\"uid=jemiller, ou=People, \ndc=mydomain\" method=128 version=3\n[07/Jun/2002:15:03:33 -0500] conn=14 op=1 RESULT err=0 tag=97 nentries=0 \netime=0 dn=\"uid=jemiller,ou=people,dc=mydomain\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=2 SRCH base=\"\" scope=0 \nfilter=\"(objectClass=*)\" attrs=ALL\n[07/Jun/2002:15:03:33 -0500] conn=14 op=2 RESULT err=0 tag=101 nentries=1 \netime=0\n[07/Jun/2002:15:03:33 -0500] conn=14 op=3 BIND dn=\"cn=Directory Manager\" \nmethod=128 version=3\n[07/Jun/2002:15:03:33 -0500] conn=14 op=3 RESULT err=0 tag=97 nentries=0 \netime=0 dn=\"cn=directory manager\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=4 SRCH base=\"ou=roles, dc=mydomain\" \nscope=1 filter=\"(uniqueMember=uid=jemiller, ou=People, dc=mydomain)\" attrs=\"cn\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=4 RESULT err=0 tag=101 nentries=1 \netime=0\n\n[07/Jun/2002:15:03:33 -0500] conn=14 op=5 BIND dn=\"uid=jemiller, ou=People, \ndc=mydomain\" method=128 version=3\n[07/Jun/2002:15:03:33 -0500] conn=14 op=5 RESULT err=0 tag=97 nentries=0 \netime=0 dn=\"uid=jemiller,ou=people,dc=mydomain\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=6 SRCH base=\"\" scope=0 \nfilter=\"(objectClass=*)\" attrs=ALL\n[07/Jun/2002:15:03:33 -0500] conn=14 op=6 RESULT err=0 tag=101 nentries=1 \netime=0\n[07/Jun/2002:15:03:33 -0500] conn=14 op=7 BIND dn=\"cn=Directory Manager\" \nmethod=128 version=3\n[07/Jun/2002:15:03:33 -0500] conn=14 op=7 RESULT err=0 tag=97 nentries=0 \netime=0 dn=\"cn=directory manager\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=8 SRCH base=\"ou=roles, dc=mydomain\" \nscope=1 filter=\"(uniqueMember=uid=jemiller, ou=People, dc=mydomain)\" attrs=\"cn\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=8 RESULT err=0 tag=101 nentries=1 \netime=0\n\n[07/Jun/2002:15:03:33 -0500] conn=14 op=9 BIND dn=\"uid=jemiller, ou=People, \ndc=mydomain\" method=128 version=3\n[07/Jun/2002:15:03:33 -0500] conn=14 op=9 RESULT err=0 tag=97 nentries=0 \netime=0 dn=\"uid=jemiller,ou=people,dc=mydomain\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=10 SRCH base=\"\" scope=0 \nfilter=\"(objectClass=*)\" attrs=ALL\n[07/Jun/2002:15:03:33 -0500] conn=14 op=10 RESULT err=0 tag=101 nentries=1 \netime=0\n[07/Jun/2002:15:03:33 -0500] conn=14 op=11 BIND dn=\"cn=Directory Manager\" \nmethod=128 version=3\n[07/Jun/2002:15:03:33 -0500] conn=14 op=11 RESULT err=0 tag=97 nentries=0 \netime=0 dn=\"cn=directory manager\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=12 SRCH base=\"ou=roles, dc=mydomain\" \nscope=1 filter=\"(uniqueMember=uid=jemiller, ou=People, dc=mydomain)\" attrs=\"cn\"\n[07/Jun/2002:15:03:33 -0500] conn=14 op=12 RESULT err=0 tag=101 nentries=1 \netime=0", "attachment_id": null, "id": 17422, "creation_time": "2002-06-07T20:18:18Z", "time": "2002-06-07T20:18:18Z", "creator": "jemiller@uchicago.edu", "bug_id": 9703, "is_private": false}, {"count": 1, "tags": [], "bug_id": 9703, "attachment_id": null, "id": 17928, "time": "2002-06-17T17:36:38Z", "creator": "jemiller@uchicago.edu", "creation_time": "2002-06-17T17:36:38Z", "is_private": false, "text": "This was my mistake. I was testing against index.jsp which contains image \nfiles in addition to the main HTML page. It authenticates once for each \nresource, so, it authenticates for the main HTML page, plus once for each of \nthe image files.\n\nJNDIRealm sure could use caching. Authenticating this many times seems \nterribly inefficient.\n"}, {"count": 2, "tags": [], "text": "Such caching is already supposed to be done by the Authenticator classes, and \nmostly it is.\n\nHowever, if you are not using form-based login and the web application does not\nitself create a session object, caching will not take place (bug 10526). This \nexplains the problem here.", "attachment_id": null, "bug_id": 9703, "id": 19085, "time": "2002-07-06T13:19:27Z", "creator": "j.g.holman@qmul.ac.uk", "creation_time": "2002-07-06T13:19:27Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 37795, "text": "Hello,\n\nthe Selector org.apache.tools.ant.types.selectors.DifferentSelector compares to\ndirectory trees by file times (last change), file sizes (number of bytes), file\ncontents (byte compare) and of course existenz. Only file times and file\ncontents were optional so far via the attributes ignorefiletimes=\"true/false\"\nand ignorecontents=\"true/false\". I added the attribute\nignorefilesizes=\"true/false\" to make the file size criteria optional. Setting\nall attributes equal \"true\" you can now only compare by existenz, which in my\ncase was very usefull to synchronize a folder under source control with a\ntemporary folder containing build outputs.\n\nbelow the output of \n\ndiff -u DifferentSelector.java.orig DifferentSelector.java > DifferentSelector.diffs\n\nfor my patch.\n\ngreetz,\nGeorg Boecherer\n\nBEGIN DifferentSelector.diffs\n\n--- DifferentSelector.java.orig\t2005-12-05 19:48:58.000000000 +0100\n+++ DifferentSelector.java\t2005-12-05 19:48:39.000000000 +0100\n@@ -50,10 +50,17 @@\n \n     private FileUtils fileUtils = FileUtils.newFileUtils();\n \n+\tprivate boolean ignoreFileSizes = false;\n     private boolean ignoreFileTimes = true;\n     private boolean ignoreContents = false;\n \n-\n+\t/**\n+     * This flag tells the selector to ignore file sizes in the comparison\n+     * @param ignoreFileSizes if true ignore file sizes\n+     */\n+    public void setIgnoreFileSizes(boolean ignoreFileSizes) {\n+        this.ignoreFileSizes = ignoreFileSizes;\n+    }\n     /**\n      * This flag tells the selector to ignore file times in the comparison\n      * @param ignoreFileTimes if true ignore file times\n@@ -82,11 +89,13 @@\n             return true;\n         }\n \n-        if (srcfile.length() != destfile.length()) {\n-            // different size =>different files\n-            return true;\n+\t\tif (!ignoreFileSizes) {\n+\t        if (srcfile.length() != destfile.length()) {\n+\t            // different size => different files\n+\t            return true;\n+\t\t\t}\n         }\n-\n+        \n         if (!ignoreFileTimes) {\n             //same date if dest timestamp is within granularity of the srcfile\n             boolean sameDate;\n@@ -110,5 +119,4 @@\n             return false;\n         }\n     }\n-}\n-\n+}\n\\ No newline at end of file\n\nEND DifferentSelector.diffs", "id": 83250, "time": "2005-12-05T19:06:40Z", "creator": "geborg@gmail.com", "creation_time": "2005-12-05T19:06:40Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "text": "uh, in what way does the <present> selector not cover the use case of selecting\nfiles by existence only?", "id": 83255, "time": "2005-12-05T19:58:54Z", "bug_id": 37795, "creation_time": "2005-12-05T19:58:54Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 37795, "attachment_id": null, "id": 83259, "time": "2005-12-05T21:12:32Z", "creator": "geborg@gmail.com", "creation_time": "2005-12-05T21:12:32Z", "is_private": false, "text": "Matt,\n\nyou can try it but it won't pass the following test case:\n\nyou use \n<different targetdir=\"...\" ignorecontents=\"true\" ignorefiletimes=\"true\" />\nand the two files you test for difference are of different size. so <different/>\nwill report them as different, although they both exist.\n\nbut with my patch and\n<different targetdir=\"...\" ignorecontents=\"true\" ignorefiletimes=\"true\"\nignorefilesizes=\"true\"/>\nit won't...\n\ngeorg"}, {"count": 3, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "text": "Did you think that, by \"<present> selector\", I meant the <different> selector in\nits present form?  I meant the entirely different <present> selector, which\nselects files that do or do not exist elsewhere.  You should be able to use:\n<present targetdir=\"...\" present=\"srconly\">\nto select only files that do not exist in the target directory.", "id": 83260, "time": "2005-12-05T21:18:12Z", "bug_id": 37795, "creation_time": "2005-12-05T21:18:12Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 37795, "text": "Matt,\n\nthank you, you are absolutely right (I interpreted \"<present>\" as \"present\n<different>\". I looked in the sources, my Ant installation has the <present>\nselector, but why couldn't I find it when navigating the Ant documentation?\n\nSo I could have solved my problem with an other selector. I think though that\nthe <different> selector should provide the filesize as optional.\n\ngreetz,georg", "id": 83262, "time": "2005-12-05T21:29:04Z", "creator": "geborg@gmail.com", "creation_time": "2005-12-05T21:29:04Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 37795, "text": "I'm really confused. \n\nthe filesize check encodes the rule \"if two files are different sizes, then they\nare different files\". \n\nYou seem to be looking only for files that are present/absent. For that, use the\n<present> selector. ", "id": 83308, "time": "2005-12-06T11:55:01Z", "creator": "stevel@apache.org", "creation_time": "2005-12-06T11:55:01Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "geborg@gmail.com", "is_private": false, "id": 83309, "time": "2005-12-06T12:28:20Z", "bug_id": 37795, "creation_time": "2005-12-06T12:28:20Z", "tags": [], "text": "Steve,\n\nyou are right, but what about:\n\nthe file contents check encodes the rule \"if two files are different in at least\none byte, then they are different files\", so why is it optional and filesize is not?\n\nperhaps we can reduce my suggestion to this question, for my purpose I'm already\nhappy with the <present> selector.\n\ngreetz,georg"}, {"count": 7, "tags": [], "bug_id": 37795, "text": "Okay, then the answer to your question is because the capability provided by\n<different>'s ignorefiletimes and ignorecontents attributes was not available by\nany other means.  Obviously ignorefilesizes=\"true\" would imply\nignorecontents=\"true\" as contents would never match while sizes did not.  Even\nassuming both of these to be true, your comparison is now based on time alone,\nwhich case is covered by the <depend> selector in much the same way as the case\nof all three--ignore time, size, and contents--is covered by the <present> selector.\n\nThanks!", "id": 83314, "time": "2005-12-06T15:27:22Z", "creator": "mbenson@apache.org", "creation_time": "2005-12-06T15:27:22Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "text": "The main reason for allowing you to ignore the contents in a difference test is\nbecause the performance of that is awful on files that actually match. \n\nBoth the source and dest files need parsing and byte-for-byte comparision, which\nis slow. Over a network, it is extra slow. \n\nso by saying ignore file sizes you are cheating, you are saying 'ignore the file\ntimes' -which you ought to do over a network, and 'ignore the file contents'.\nyou are therefore defining different to be 'two files of different sizes are\ndifferent; if they are the same size, we assume they are the same'\n\nonce you ignore file sizes you define different as \"two files are different only\nif one exists\". Which is what the <present> selector already did at the time of\nwriting. \n\nWe dont need an extra feature that another selector does, because it only adds\ncomplexity, bugreps and test cases. \n\nAt the same time, I dont want you to feel disappointed that we have rejected\nyour work. There was nothing wrong with the code, and you submitted a patch\nexactly as we like it. It was just we had a different solution to the problem\nsomewhere else. Please dont be dissuaded from submitting more bugreps or\npatches, and hassling us to get the patches committed :)", "id": 83331, "time": "2005-12-06T22:35:40Z", "bug_id": 37795, "creation_time": "2005-12-06T22:35:40Z", "is_private": false}]
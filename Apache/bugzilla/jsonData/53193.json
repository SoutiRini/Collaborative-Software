[{"count": 0, "tags": [], "bug_id": 53193, "text": "If I use \"SSLVerifyClient optional_no_ca\" and SSLSessionCache (with any type of cache, for example \"dbm:/var/run/httpd/ssl_scache\"), \"SSLSessionCacheTimeout 300\", from time to time in the CGI environment (I refresh web-page within 1-2 minutes ) I see SSL_CLIENT_VERIFY=SUCCESS, in spite of the client sertifacate in web-browser signed not by the SSLCACertificateFile. It occurs when using Opera browser, because opara provides a selection of client sertificate to authentificate. At the same time possibly other clients works with another virtualhost using valid sertificate (virtualhost works on different port). Even all another ssl-virtualhost was removed and only I accessed the virtualhost with wrong sertificate, the situation is repeated. When I set SSLSessionCache to none, SSL_CLIENT_VERIFY=GENEROUS always. \n\n\n At the same time in log ( when SSL_CLIENT_VERIFY=SUCCESS with wrong sertificate):\n10:10:52[debug] ssl_engine_kernel.c(1732): Inter-Process Session Cache: request=GET status=FOUND id=F1FF0E51D83D2BACDFBE4EEE8A348687D402C42BC2CA450E24608375CB82FFB8 (session reuse)\n10:10:52 [info] [client 172.16.70.220] SSL client authentication failed, accepting certificate based on SSLVerifyClient optional_no_ca configuration\n10:10:52 [debug] ssl_engine_io.c(1897): OpenSSL: read 5/5 bytes from BIO#2bf45300 [mem: 2bfa9000] (BIO dump follows)\n10:10:52 [info] Initial (No.1) HTTPS request received for child 71 (server test:443)\n\n10:10:57 [debug] ssl_engine_io.c(1908): OpenSSL: I/O error, 5 bytes expected to read on BIO#2bf45300 [mem: 2bfa9000]\n04 10:10:57 [info] [client 172.16.70.220] (70007)The timeout specified has expired: SSL input filter read failed.\n04 10:10:57 [debug] ssl_engine_kernel.c(1884): OpenSSL: Write: SSL negotiation finished successfully\n04 10:10:57 [info] [client 172.16.70.220] Connection closed to child 97 with standard shutdown (server test:443)\n04 10:10:57 [debug] ssl_engine_io.c(1908): OpenSSL: I/O error, 5 bytes expected to read on BIO#2bf45300 [mem: 2bfa9000]\n10:10:57 [info] [client 172.16.70.220] (70007)The timeout specified has expired: SSL input filter read failed.\n04 10:10:57 [debug] ssl_engine_kernel.c(1884): OpenSSL: Write: SSL negotiation finished successfully\n04 10:10:57 [info] [client 172.16.70.220] Connection closed to child 71 with standard shutdown (server test:443)", "id": 158819, "time": "2012-05-04T11:56:04Z", "creator": "tomefrom@list.ru", "creation_time": "2012-05-04T11:56:04Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 53193, "attachment_id": 29622, "text": "Created attachment 29622\npatch\n\nConfirmed.\nWhen client certificate is requested in server context and GENEROUS'ly verified session is resumed, the SSL_CLIENT_VERIFY will be set to SUCCESS.\n\nThis is security bug for these who rely on SSL_CLIENT_VERIFY to test whether certificate verification was successful.", "id": 163607, "time": "2012-11-22T17:10:07Z", "creator": "arnis@ut.ee", "creation_time": "2012-11-22T17:10:07Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 53193, "text": "I've been able to reproduce it and verified the patch fixes the issue without indroducing any regression when using perl test suite. Committed in r1633085.", "count": 2, "id": 178616, "time": "2014-10-20T09:19:06Z", "creator": "jkaluza@redhat.com", "creation_time": "2014-10-20T09:19:06Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Created attachment 27617\nPatch for issue\n\nFound a handful of Word files that cause ArrayIndexOOB. (Unable to attach sample due to sensitive nature of files).\n\nPatch included, essentially the pictureBytesStartOffset used for a System.arraycopy() is sometimes set to a negative value.\n\nFix uses an existing less-than check but also makes sure it's greater than zero before using the new value rather than the default PICTF1BlockOffset.\n\nStack Trace: (POI-3.8-beta4)\n\nCaused by: java.lang.ArrayIndexOutOfBoundsException\n\tat java.lang.System.arraycopy(Native Method)\n\tat org.apache.poi.hwpf.usermodel.Picture.fillRawImageContent(Picture.java:363)\n\tat org.apache.poi.hwpf.usermodel.Picture.getRawContent(Picture.java:203)\n\tat org.apache.poi.hwpf.usermodel.Picture.fillImageContent(Picture.java:372)\n\tat org.apache.poi.hwpf.usermodel.Picture.getContent(Picture.java:191)\n\tat org.apache.poi.hwpf.usermodel.Picture.suggestPictureType(Picture.java:330)\n\tat org.apache.poi.hwpf.usermodel.Picture.suggestFileExtension(Picture.java:315)\n\tat org.apache.poi.hwpf.usermodel.Picture.suggestFullFileName(Picture.java:150)\n\tat org.apache.tika.parser.microsoft.WordExtractor$PicturesSource.<init>(WordExtractor.java:504)\n\tat org.apache.tika.parser.microsoft.WordExtractor$PicturesSource.<init>(WordExtractor.java:488)\n\tat org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:81)\n\tat org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:196)\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n\t... 45 more", "is_private": false, "id": 149867, "creator": "rpi_alum@yahoo.com", "time": "2011-09-27T23:48:05Z", "bug_id": 51902, "creation_time": "2011-09-27T23:48:05Z", "attachment_id": 27617}, {"count": 1, "tags": [], "text": "Created attachment 27619\nReplaces initial patch.. improved\n\nChanges to greater-than or equal to 0", "attachment_id": 27619, "bug_id": 51902, "id": 149871, "time": "2011-09-28T01:53:51Z", "creator": "rpi_alum@yahoo.com", "creation_time": "2011-09-28T01:53:51Z", "is_private": false}, {"count": 2, "tags": [], "creator": "vlsergey@gmail.com", "text": "Please, provide example doc. It is possible we will be able to handle image correctly. You can send it to my email privately.", "id": 149977, "time": "2011-09-30T13:24:51Z", "bug_id": 51902, "creation_time": "2011-09-30T13:24:51Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "*** Bug 51890 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 149979, "creator": "vlsergey@gmail.com", "time": "2011-09-30T13:26:26Z", "bug_id": 51902, "creation_time": "2011-09-30T13:26:26Z", "is_private": false}, {"count": 4, "tags": [], "creator": "vlsergey@gmail.com", "attachment_id": null, "id": 149987, "time": "2011-09-30T15:50:23Z", "bug_id": 51902, "creation_time": "2011-09-30T15:50:23Z", "is_private": false, "text": "Image loading is completely rewritten. Please, check r1177710 or later."}, {"count": 5, "tags": [], "bug_id": 51902, "attachment_id": null, "id": 149988, "time": "2011-09-30T16:04:05Z", "creator": "pablo.queixalos@polyspot.com", "creation_time": "2011-09-30T16:04:05Z", "is_private": false, "text": "Works like a charm.\n\n(In reply to comment #4)\n> Image loading is completely rewritten. Please, check r1177710 or later."}, {"count": 6, "tags": [], "text": "Agree, definitly works for the files I was having an issue with prior.  Thanks very much for your attention to this matter.", "is_private": false, "id": 150096, "creator": "rpi_alum@yahoo.com", "time": "2011-10-03T19:24:38Z", "bug_id": 51902, "creation_time": "2011-10-03T19:24:38Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Sergey,\n\nThanks for this re-work of the Picture handling logic for MS Word documents.  This seems to have fixed many of the random bugs that would pop-up across a large and varying data-set.  I did however uncover one bug that was introduced by these fixes, and have supplied a patch.  When you get a chance, could you please take a look at Bug 51974. (https://issues.apache.org/bugzilla/show_bug.cgi?id=51974)\n\nIt's essentially a null pointer exception that is encountered when parsing text via TIKA that was not present prior.\n\n\nThanks in advance,\n\nJeremy\n\n\n\n(In reply to comment #4)\n> Image loading is completely rewritten. Please, check r1177710 or later.", "attachment_id": null, "id": 150493, "creator": "rpi_alum@yahoo.com", "time": "2011-10-12T13:00:50Z", "bug_id": 51902, "creation_time": "2011-10-12T13:00:50Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 4326, "is_private": false, "text": "Server side include servlet accepts an isVirtualWebappRelative parameter,\ndefined in tomcat4/conf/web.xml. The parameter value '0' (false, the default!)\nshould make server side virtual paths relative to server root. This does not\nhowever seem work :-/\n\nIn particular, if in server.xml we first define two contexts:\n\n<Context path=\"/archive\" docBase=\"/home/ibs/archive\"/>\n<Context path=\"/tk\" docBase=\"/home/ibs/tk\"/>\n\nwhere the files in the /archive context contain SSI references:\n\n<!--#include virtual=\"/tk/tyyli_yleinen_ibs.ssi\" -->\n\nand the files in /tk context contain the corresponding SSI files:\n\n/home/ibs/tk/tyyli_yleinen_ibs.ssi\n\nIn web.xml, we then (try to) make virtual references relative to root:\n\n    <init-param>\n      <param-name>isVirtualWebappRelative</param-name>\n      <param-value>0</param-value>\n    </init-param>\n\nIf we now try to access files that contain SSI directives:\n\nhttp://localhost/archive/testfile.shtml\n\nThe result is a SSI error [an error occurred while processing this directive],\neven if:\n\nhttp://localhost/tk/tyyli_yleinen_ibs.ssi\n\nis available and works fine.\n\nIf we then ignore the /tk context, set 'isVirtualWebappRelative=1' and rename\nthe /home/ibs/tk directory as /home/ibs/archive/tk, and therefore make the SSI\nfiles to appear as:\n\nhttp://localhost/archive/tk/tyyli_yleinen_ibs.ssi\n\nthe SSI include mechanism produces the expected result.\n\nIt would therefore seem that the 'isVirtualWebappRelative=0' fails to resolve\nvirtual paths, or download file content. If it is the downloading that fails,\none possible reason for this could be that loading files from some other context\nis not permitted for some reason. Without any error messages anywhere, it is\nhowever hard to tell.\n\nIt is a very typical scenario that SSI virtual paths should be interpreted\nrelative to server root (that's why it is (or should be) the default behaviour,\ntoo). Such files should also to be able to reside in different contexts.", "id": 6966, "time": "2001-10-22T04:44:59Z", "creator": "rami.hanninen@davisor.com", "creation_time": "2001-10-22T04:44:59Z", "attachment_id": null}, {"count": 1, "text": "Ssi Include should work correctly in the latest nightly.\n20011023\n\n   -bip\n", "bug_id": 4326, "is_private": false, "id": 7018, "time": "2001-10-22T13:57:08Z", "creator": "bip@apache.org", "creation_time": "2001-10-22T13:57:08Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 4326, "text": "*** Bug 4307 has been marked as a duplicate of this bug. ***", "id": 7021, "time": "2001-10-22T13:59:19Z", "creator": "bip@apache.org", "creation_time": "2001-10-22T13:59:19Z", "is_private": false, "attachment_id": null}, {"text": "Absolutely the same bug re-appears in a TomCat version 4.0.3.\n\nTo fix the bug you need to extract \n\n    org/apache/catalina/util/ssi/SsiMediator.java\n\nfrom \n\n    ${catalina.home}/server/lib/servlets-ssi.jar \n                            (a.k.a. servlets-ssi.renametojar)\n\n\nThen, locate 'protected String getVirtualPath(String path)' method.\n\nNear the end of the method there is a code block :\n\n        .......\n             } else if (normalized != null){\n                // find which context is the right one to handle\n                String context = normalized.substring(0, path.indexOf('/', \n1));\n                ServletContext sc = servletContext.getContext(context);\n\n                if (sc!=null) {\n                    servletContext = sc;\n                    normalized = normalized.substring(context.length());\n                }\n\n              }\n        ........\n\nChange it to:\n\n             } else if (normalized != null){\n                // find which context is the right one to handle\n                String context = normalized.substring(0, path.indexOf('/', \n1));\n                // **** NEXT LINE PROVIDES A FIX : ****\n               ServletContext sc = origServletContext.getContext(context);\n\n                if (sc!=null) {\n                    servletContext = sc;\n                    normalized = normalized.substring(context.length());\n                }\n\n              }\n        ........\n\n\nCompile, ra-pack and restart. All's done.\n\nWhen I can expect the fix to be introduced as a part of new release?\n\nCheers,\n\nPavel", "tags": [], "creator": "pavel@mxfs.co.uk", "is_private": false, "count": 3, "id": 18060, "time": "2002-06-19T12:18:18Z", "bug_id": 4326, "creation_time": "2002-06-19T12:18:18Z", "attachment_id": null}, {"count": 4, "text": "This problem is with the old ( non-head revision ) SSI code.  If Pavel does not\nconfirm that this problem exists in the head revision, I will mark this bug as\nFIXED in 4.1.", "bug_id": 4326, "is_private": false, "id": 18674, "time": "2002-06-27T19:00:51Z", "creator": "x@cs.stanford.edu", "creation_time": "2002-06-27T19:00:51Z", "tags": [], "attachment_id": null}, {"count": 5, "tags": [], "creator": "x@cs.stanford.edu", "attachment_id": null, "text": "Simce Pavel never responded to whether this problem exists in 4.1, I'll assume\nit doesn't.", "id": 19380, "time": "2002-07-12T09:58:54Z", "bug_id": 4326, "creation_time": "2002-07-12T09:58:54Z", "is_private": false}]
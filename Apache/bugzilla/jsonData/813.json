[{"attachment_id": null, "tags": [], "creator": "jharrop@bigpond.net.au", "is_private": false, "count": 0, "id": 933, "time": "2001-03-02T05:59:21Z", "bug_id": 813, "creation_time": "2001-03-02T05:59:21Z", "text": "Without SSO support: When I use BASIC authentication with 2 webapps both with\nthe same realm-name and an HTTP 1.1 user agent (IE 5 or 5.5), after entering\nauthentication information in the first webapp in response to the\nWWW-Authenticate header, for the second webapp, Tomcat ignores the GET request\nthat has the Authorization header which is sent in response to Tomcat's 401.\n\nWith SSO support: the SSO cookie is never set; and there seems to be a\ndiscrepancy between what is logged and what tcpdump indicates is happening on\nthe wire. According to tcpdump, tomcat never sends a 401, and the client\ncertainly doesn't send a second request with an Authorization header!\n\n============= without SSO ========================\n\n\n[click on link requiring authentication in first webapp (called TestDrive)]\n\n- user gets authentication challenge\n\n- tcpdump says for request:\nG E T / T e s t D r i v e / p r o t e c t e d\n/ s h o w H o m e D i r e c t o\nr y H T T P / 1 . 1\n\n- Tomcat log says:\n61.9.164.185 - - [02/Mar/2001:23:34:57 10000] \"GET\n/TestDrive/protected/showHomeDirectory HTTP/1.1\" 401 -\n\n- tcpdump says for response:\nH T T P / 1 . 1 4 0 1 U n a u t h o r i z e\nd\nW W W - A u t h e n t i c a t e : B a s i c\nr e a l m = \" S m a r t P r e c\ne d e n t S e r v e r \"\n\n[all ok so far - enter authentication information]\n\n- tcp dump says for request:\nG E T / T e s t D r i v e / p r o t e c t e d\n/ s h o w H o m e D i r e c t o\nr y H T T P / 1 . 1\nA u t h o r i z a t i o n : B a s i c Z n J\nl Z D p u Z Y V r\n\n- Tomcat log says:\n\n61.9.164.185 - jerry [02/Mar/2001:23:44:32 10000] \"GET\n/TestDrive/protected/showHomeDirectory HTTP/1.1\" 200 688\n\n- tcpdump says for response:\nH T T P / 1 . 1\n2 0 0\n\np r a g m a : n o - c a c h e\nT r a n s f e r - E n c o d i n g : c h u n\nk e d\nS e r v e r : A p a c h e T o m c a t / 4 . 0 - d\ne v ( H T T P / 1 . 1 C o n\nn e c t o r )\nC a c h e - C o n t r o l : n o - c a c h e\n\n[okay so far - so click on another link (second webapp, called\nSmartPrecedentServer), and USER GETS BLANK SCREEN :(]\n\n- tcpdump says for request\nG E T / S m a r t P r e c e d e n t S e r v e\nr / a s k I n t e r v i e w P r\ne f e r e n c e s ? I D = % 2 F\nf i l e s % 2 F d e m o n s t r\na t i o n % 2 F S e r v i c e s\n+ A g r e e m e n t . x m l & r\ne p o s i t o r y n a m e = T e\ns t D r i v e H T T P / 1 . 1\nC o n n e c t i o n :\nK e e p - A l i v e\n\n- Tomcat logs say\n61.9.164.185 - - [02/Mar/2001:23:50:07 10000] \"GET\n/SmartPrecedentServer/askInterviewPreferences HTTP/1.1\" 401 -\n\n- tcpdump says for response\nH T T P / 1 . 1\n4 0 1 U n a u t h o r i z e\nd\nS e r v e r : A p a c h e T o m c a t / 4 . 0 - d e\nv ( H T T P / 1 . 1 C o n n\ne c t o r )\nW W W - A u t h e n t i c a t e : B a s i c\nr e a l m = \" S m a r t P r e c\ne d e n t S e r v e r \"\n\n[user doesn't do anything]\n\n- tcpdump says for request\n\nG E T / S m a r t P r e c e d e n t S e r v e\nr / a s k I n t e r v i e w P r\ne f e r e n c e s ? I D = % 2 F\nf i l e s % 2 F d e m o n s t r\na t i o n % 2 F S e r v i c e s\n+ A g r e e m e n t . x m l & r\ne p o s i t o r y n a m e = T e\ns t D r i v e H T T P / 1 . 1\nA u t h o r i z a t i o n : B a s i c\nZ n J l Z D p u Z Y V r\n\n- Tomcat logs say nothing :(\n\n- tcpdump does not show any response\n\n[User clicks refresh]\n\n- tcpdump says for request\nG E T / S m a\nr t P r e c e d e n t S e r v e\nr / a s k I n t e r v i e w P r\ne f e r e n c e s ? I D = % 2 F\nf i l e s % 2 F d e m o n s t r\na t i o n % 2 F S e r v i c e s\n+ A g r e e m e n t . x m l & r\ne p o s i t o r y n a m e = T e\ns t D r i v e H T T P / 1 . 1\n\nC o n n e\nc t i o n : K e e p - A l i v\ne\nA u t h o r i z a t i o n\n: B a s i c Z n J l Z D p u\nZ Y V r\n\n- Tomcat log says\n61.9.164.185 - jerry [02/Mar/2001:23:56:56 10000] \"GET\n/SmartPrecedentServer/askInterviewPreferences HTTP/1.1\" 200 1315\n\n- tcpdump says for response:\nH T T P / 1 . 1\n2 0 0\nP r a g m a : n\no - c a c h e\nT r a n s f e\nr - E n c o d i n g : c h u n\nk e d\nS e r v e r : A p a\nc h e T o m c a t / 4 . 0 - d\ne v ( H T T P / 1 . 1 C o n\nn e c t o r )\nC a c h e - C\no n t r o l : n o - c a c h e\nS e t - C o o k i e : J S\nE S S I O N I D = [etc]\n\n\n================ with SSO ==================================\n\nIf i go through the exercise with SingleSignOn support enabled:\n\n[eventually we get to the request:]\n\nG E T / S m a\nr t P r e c e d e n t S e r v e\nr / a s k I n t e r v i e w P r\ne f e r e n c e s ? I D = % 2 F\nf i l e s % 2 F d e m o n s t r\na t i o n % 2 F S e r v i c e s\n+ A g r e e m e n t . x m l & r\ne p o s i t o r y n a m e = T e\ns t D r i v e H T T P / 1 . 1\n[there is no authorization header]\n\nTomcat log says BOTH OF THE FOLLOWING!\n61.9.164.185 - - [02/Mar/2001:23:50:07 10000] \"GET\n/SmartPrecedentServer/askInterviewPreferences HTTP/1.1\" 401 -\n61.9.164.185 - jerry [02/Mar/2001:23:56:56 10000] \"GET\n/SmartPrecedentServer/askInterviewPreferences HTTP/1.1\" 200 1315\n\nBUT tcp dump doesn't show a response to the first request, and nor does it show\nthe second request to have been made!?\n\nneither the logs nor tcpdump show SSO cookie to be set:\n2001-03-03 00:09:07 SingleSignOn[localhost]: Checking for SSO cookie\n2001-03-03 00:09:07 SingleSignOn[localhost]: SSO cookie is not present\n2001-03-03 00:09:07 StandardHost[localhost]: Mapping request URI\n'/TestDrive/protected/showHomeDirectory'\n2001-03-03 00:09:07 StandardHost[localhost]: Trying the longest context path prefix\n2001-03-03 00:09:07 StandardHost[localhost]: Mapped to context '/TestDrive'\n2001-03-03 00:09:07 showHomeDirectory: init\n\nThe realm names in both webapps are identical."}, {"count": 1, "text": "*** Bug 814 has been marked as a duplicate of this bug. ***", "bug_id": 813, "is_private": false, "id": 937, "time": "2001-03-02T06:14:35Z", "creator": "jharrop@bigpond.net.au", "creation_time": "2001-03-02T06:14:35Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "creator": "jharrop@bigpond.net.au", "attachment_id": null, "is_private": false, "id": 939, "time": "2001-03-02T06:15:07Z", "bug_id": 813, "creation_time": "2001-03-02T06:15:07Z", "text": "*** Bug 815 has been marked as a duplicate of this bug. ***"}, {"count": 3, "tags": [], "creator": "jharrop@bigpond.net.au", "attachment_id": null, "is_private": false, "id": 959, "time": "2001-03-03T22:56:58Z", "bug_id": 813, "creation_time": "2001-03-03T22:56:58Z", "text": "Now tried with org.apache.catalina.connector.http10.HttpConnector (without SSO\nsupport enabled).\n\nSummary is that the http10 connector exhibits the same behaviour as the 1.1\nconnector:\n\n- With an HTTP 1.1 client, both connectors send a 401 response, and then ignore\nthe client's subsequent request with the WWW Authenticate header.  The 1.1\nconnector does this reproducibly when the user visits a second protected page(in\nthe case i've been trying, this is in a second webapp with the same realm name,\nbut it might not need to be). The 1.0 connector does it either for that second\npage, or for the first authentication interaction (sometimes it does, sometimes\nit doesn't: tcpdumps for this case attached).\n- With an HTTP 1.0 client (IE set to 1.0), both connectors work fine.\n\nThe tcpdump for the :\n\nrequest:\n\n G E  T    / T  e s\n\t\t\t  t D  r i  v e  / p  r o  t e  c t  e d\n\t\t\t  / s  h o  w H  o m  e D  i r  e c  t o\n\t\t\t  r y    H  T T  P /  1 .  1\n\nresponse:\n H T  T P  / 1  . 1\n\t\t\t    4  0 1    U  n a  u t  h o  r i  z e\n\t\t\t  d\nW  W W  - A  u t  h e  n t  i c\n\t\t\t  a t  e :    B  a s  i c    r  e a  l m\n\t\t\t  = \"  S m  a r  t P  r e  c e  d e  n t\n\t\t\t  S e  r v  e r  \"\nTC logs:\n61.9.137.189 - - [04/Mar/2001:17:29:26 10000] \"GET\n/TestDrive/protected/showHomeDirectory HTTP/1.1\" 401 -\n\n[user types username/password]\n\nrequest:\n G E  T    / T  e s\n\t\t\t  t D  r i  v e  / p  r o  t e  c t  e d\n\t\t\t  / s  h o  w H  o m  e D  i r  e c  t o\n\t\t\t  r y    H  T T  P /  1 .  1\n A u  t h  o r  i z\n\t\t\t  a t  i o  n :    B  a s  i c    Z  n J\n\t\t\t  l Z  D p  u Z  X J  r\n\ntcpdump of response:\n\t(no response)\n\nTC logs:\n\t(nothing logged)"}, {"count": 4, "text": "The nightly from March 6 could fix those problems.", "bug_id": 813, "is_private": false, "id": 1007, "time": "2001-03-05T21:14:13Z", "creator": "remm@apache.org", "creation_time": "2001-03-05T21:14:13Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "jharrop@bigpond.net.au", "is_private": false, "count": 5, "id": 1009, "time": "2001-03-05T23:23:27Z", "bug_id": 813, "creation_time": "2001-03-05T23:23:27Z", "text": "Correct - core authentication problem appears fixed by nightly of March 6,\nthanks.  I guess the problem i observed with SSO is still there, but since that\nis a different problem, i'm closing this particular bug."}]
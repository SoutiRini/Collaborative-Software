[{"count": 0, "tags": [], "bug_id": 34724, "attachment_id": null, "id": 74355, "time": "2005-05-03T13:39:17Z", "creator": "oros@apache.org", "creation_time": "2005-05-03T13:39:17Z", "is_private": false, "text": "I have the following setup:\n\n- Apache webserver in front of Tomcat 5.5.9\n- three 3rd-level domains www.mydomain.xa, search.mydomain.xa, my.mydomain.xa\n- Single Sign-On valve in Tomcat is activated\n- Login is handled by my.mydomain.xa and it's corresponding webapp under context /My\n\nThe problem with the SSO cookie created by Tomcat after successful login is that\nthe domain name stored with the cookie is my.mydomain.xa. Therefore the SSO\ncookie is not sent by the user agent if a request goes to www.mydomain.xa or\nsearch.mydomain.xa and single-sign on is not working for these subdomains.\n\nSo I need a way to tell tomcat to set '.mydomain.xa' as the domain of the SSO\ncookie so it will the sent by the user agent for all subdomains. Therefore I\nintroduced the system property 'tomcat.sso.cookie.domain' and added a few lines\nto AuthenticatorBase.java where the value of named system property is used - if\navailable - to set the SSO cookie's domain (see attached patch). The system\nproperty can be set in the startup script for example."}, {"text": "Created attachment 14918\nSSO cookie domain patch", "tags": [], "bug_id": 34724, "attachment_id": 14918, "count": 1, "id": 74356, "time": "2005-05-03T13:40:28Z", "creator": "oros@apache.org", "creation_time": "2005-05-03T13:40:28Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 34724, "text": "It's a good use case, but it's not the right way to do it. You should add an\noptional attribute on the SSO valve instead.", "id": 74357, "time": "2005-05-03T14:12:08Z", "creator": "remm@apache.org", "creation_time": "2005-05-03T14:12:08Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 34724, "text": "Created attachment 14971\nAuthenticatorBase.java patch", "id": 74616, "time": "2005-05-09T16:19:31Z", "creator": "oros@apache.org", "creation_time": "2005-05-09T16:19:31Z", "is_private": false, "attachment_id": 14971}, {"text": "Created attachment 14972\nSingleSignOn.java patch", "tags": [], "creator": "oros@apache.org", "attachment_id": 14972, "count": 4, "id": 74617, "time": "2005-05-09T16:19:56Z", "bug_id": 34724, "creation_time": "2005-05-09T16:19:56Z", "is_private": false}, {"count": 5, "attachment_id": 14973, "creator": "oros@apache.org", "is_private": false, "id": 74618, "time": "2005-05-09T16:20:28Z", "bug_id": 34724, "creation_time": "2005-05-09T16:20:28Z", "tags": [], "text": "Created attachment 14973\nmbeans-descriptors.xml patch"}, {"count": 6, "tags": [], "bug_id": 34724, "attachment_id": null, "id": 74619, "time": "2005-05-09T16:24:16Z", "creator": "oros@apache.org", "creation_time": "2005-05-09T16:24:16Z", "is_private": false, "text": "I aggree that an optional attribute on the SingleSingOn valve is the more\nelegant way to specify a domain name for the sso cookie. I modified the\nimplementation in the suggested way (see the three new patches attachted) so the\ncookie domain can be set on the valve like\n\n<Valve className=\"org.apache.catalina.authenticator.SingleSignOn\"\ncookieDomain=\".mydomain.xa\"/>\n"}, {"count": 7, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "text": "I've committed the patch into HEAD, it'll be in 5.5.13.  Thank you for\ncontributing it!", "id": 81212, "time": "2005-10-17T00:21:28Z", "bug_id": 34724, "creation_time": "2005-10-17T00:21:28Z", "is_private": false}]
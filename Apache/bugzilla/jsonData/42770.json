[{"count": 0, "attachment_id": null, "bug_id": 42770, "text": "I'm doing an scp, but the path I am setting up is wrong; its an unexpanded property:\n\n    <property name=\"ssh.path\"\n        value=\"${rpm.ssh.user}@${rpm.ssh.server}:${rpm.ssh.dir}\" />\n    <scp remoteToDir=\"${rpm.ssh.path}\"\n        passphrase=\"${rpm.ssh.passphrase}\"\n        keyfile=\"${rpm.ssh.keyfile}\"\n        trust=\"${rpm.ssh.trust}\"\n        verbose=\"${rpm.ssh.verbose}\" >\n      <fileset refid=\"rpm.upload.fileset\"/>\n    </scp>\n\nThis is breaking the code that cracks the string:\n\nrelease.rpm-upload:\nProperty \"ssh.server\" has not been set\n     [echo] SCP target is ${ssh.server}\n  [ssh-rpm] Connecting to 16.25.169.163:22\nProperty \"rpm.ssh.path\" has not been set\n\n======================================================================\nExiting failing project \"release\"\n======================================================================\n\nBUILD FAILED - at 28/06/07 17:02\n/home/slo/Projects/SmartFrog/Forge/core/release/build.xml:547:\njava.lang.StringIndexOutOfBoundsException: String index out of range: -1\n        at org.apache.tools.ant.taskdefs.optional.ssh.Scp.execute(Scp.java:215)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n        at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at\norg.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:357)\n        at org.apache.tools.ant.Target.performTasks(Target.java:385)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1337)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1306)\n        at\norg.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1189)\n        at org.apache.tools.ant.Main.runBuild(Main.java:758)\n        at org.apache.tools.ant.Main.startAnt(Main.java:217)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\nCaused by: java.lang.StringIndexOutOfBoundsException: String index out of range: -1\n        at java.lang.String.substring(String.java:1938)\n        at org.apache.tools.ant.taskdefs.optional.ssh.Scp.parseUri(Scp.java:321)\n        at org.apache.tools.ant.taskdefs.optional.ssh.Scp.upload(Scp.java:253)\n        at org.apache.tools.ant.taskdefs.optional.ssh.Scp.execute(Scp.java:201)\n        ... 16 more\n--- Nested Exception ---\njava.lang.StringIndexOutOfBoundsException: String index out of range: -1\n        at java.lang.String.substring(String.java:1938)\n        at org.apache.tools.ant.taskdefs.optional.ssh.Scp.parseUri(Scp.java:321)\n        at org.apache.tools.ant.taskdefs.optional.ssh.Scp.upload(Scp.java:253)\n        at org.apache.tools.ant.taskdefs.optional.ssh.Scp.execute(Scp.java:201)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n        at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at\norg.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:357)\n        at org.apache.tools.ant.Target.performTasks(Target.java:385)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1337)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1306)\n        at\norg.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1189)\n        at org.apache.tools.ant.Main.runBuild(Main.java:758)\n        at org.apache.tools.ant.Main.startAnt(Main.java:217)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)", "id": 104856, "time": "2007-06-28T09:04:40Z", "creator": "stevel@apache.org", "creation_time": "2007-06-28T09:04:40Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 42770, "text": "What is the expected behavior? In this case the '@' symbol is not found in the \nURI, therefore the java.lang.StringIndexOutOfBoundsException is produced. Do we \nwant it to produce a useful error message?", "id": 104860, "time": "2007-06-28T10:22:48Z", "creator": "riznob@hotmail.com", "creation_time": "2007-06-28T10:22:48Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "text": "exactly. we should throw A BuildException saying the path is wrong and including\nthe value for proper diagnostics. We may also want to do this check in the\nsetter method, so we can bail out before even connecting (as this makes testing\neasier)", "id": 104892, "time": "2007-06-29T02:55:08Z", "bug_id": 42770, "creation_time": "2007-06-29T02:55:08Z", "is_private": false}, {"count": 3, "attachment_id": 20754, "bug_id": 42770, "is_private": false, "id": 107625, "time": "2007-09-02T13:03:22Z", "creator": "sjjohns@cox.net", "creation_time": "2007-09-02T13:03:22Z", "tags": [], "text": "Created attachment 20754\nPatch to throw an appropriate exception when remoteToDir() gets an invalid URI. \n\n\nHere's a patch that does what Steve mentions.  \n\nI added a check in setRemoteTodir() to throw a BuildException with a\ndescriptive message when the URI does not contain an '@' symbol.\n\nFor good measure, I added some code in parseUri() at the point where the\nStringIndexOutOfBoundsException was being thrown to skip the indexOf() call if\nthe index is negative.\tAnd instead throw a BuildException explaining the\nremote URI was invalid.\n\nI also added a unit test to ScpTest.java to exercise the new code.  \n\nWhile testing the unit test, I found an apparent bug in\nScpTest.testSingleFileUploadAndDownload().  I added a line to fix that. \n\nLet me know what you think."}, {"count": 4, "attachment_id": null, "bug_id": 42770, "is_private": false, "id": 118697, "time": "2008-07-16T02:17:58Z", "creator": "bodewig@apache.org", "creation_time": "2008-07-16T02:17:58Z", "tags": [], "text": "svn revision 677206"}]
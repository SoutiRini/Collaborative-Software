[{"attachment_id": 34129, "tags": [], "bug_id": 59983, "text": "Created attachment 34129\nfailing unit test patch\n\nIt seems that the shiftRow method does not correctly handle shared formulas.\nI provide a failing unit test that higlights the problem.\nIt seems that when updating a shared formula, the code also updates the range it is applied to.\nHowever, also the cells that are in the range are updated too, thus resulting in a double shift of the formula text and then in a not valid.\n\nI think the problem is in the class XSSFRowShifter, method updateRowFormulas.\n\nBest,\n    Luca", "count": 0, "id": 193027, "time": "2016-08-11T15:26:38Z", "creator": "lucamartini@tagetik.com", "creation_time": "2016-08-11T15:26:38Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59983, "text": "Thanks for the unit test! Applied in r1761673.\nI can verify that the shared formula is being shifted twice.\n\nTestcase: testSharedFormulas took 0.004 sec\n        SKIPPED: This test currently fails with org.junit.ComparisonFailure: expected:<SUM(D[2:D5])> but was:<SUM(D[3:D6])>", "id": 193875, "time": "2016-09-21T05:23:07Z", "creator": "onealj@apache.org", "creation_time": "2016-09-21T05:23:07Z", "is_private": false, "attachment_id": null}, {"attachment_id": 34720, "tags": [], "bug_id": 59983, "text": "Created attachment 34720\npatch containing modification to src and test code\n\nBug fix and unit test", "count": 2, "id": 196759, "time": "2017-02-06T14:42:47Z", "creator": "chiaramarcheschi@tagetik.com", "creation_time": "2017-02-06T14:42:47Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 59983, "attachment_id": null, "is_private": false, "id": 196760, "time": "2017-02-06T14:54:10Z", "creator": "chiaramarcheschi@tagetik.com", "creation_time": "2017-02-06T14:54:10Z", "text": "The bug was due to a missing update of the CTCellFormula data structure related to the shared formula; in particular, the \"ref\" attribute was not updated during a row shift.\n\nThe submitted patch contains the bug fix and a unit test that uses an xlsx file which is also attached."}, {"count": 4, "tags": [], "bug_id": 59983, "is_private": false, "text": "Thanks for the patch! Applied in r1782111.\n\nWill be included in POI 3.16 beta 3.", "id": 196840, "time": "2017-02-08T07:21:18Z", "creator": "onealj@apache.org", "creation_time": "2017-02-08T07:21:18Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "joewiz@gmail.com", "attachment_id": 29287, "text": "Created attachment 29287\nTwo sample Outlook 2007 messages, one whose date POI HSMF fails to recognize, and one whose date POI HSMF successfully recognizes\n\nOverview\n--------\nPOI HSMF fails to recognize the dates in some of my Outlook 2007 (.msg) files.  \n\nSteps to Reproduce\n------------------\nI have two reproducible tests, and I've attached a zip file containing test .msg files that illustrate my results.  When I use the first file (test-message-poi-succeeds.msg), POI HSMF succeeds.  When I use the second file (test-message-poi-fails.msg), POI HSMF fails.  Here are the two tests: \n\n1) The first test is to run the .msg files through Tika 1.2 (which uses POI HSMF to parse Outlook files), using the following command:\n\n  java -jar tika-app-1.2.jar -m <filename>\n\nTika succeeds to find the date on the first message, returning these headers -- 9 of which contain dates, and the key field being \"date: 2012-06-22T18:32:54Z\":\n\nAuthor: Ashley, Carl E (PACE)\nContent-Length: 35840\nContent-Type: application/vnd.ms-outlook\nCreation-Date: 2012-06-22T18:32:54Z\nLast-Modified: 2012-06-22T18:32:54Z\nLast-Save-Date: 2012-06-22T18:32:54Z\nMessage-Bcc: \nMessage-Cc: PA History Mailbox\nMessage-From: Ashley, Carl E (PACE)\nMessage-Recipient-Address: saftergood@fas.org\nMessage-To: 'saftergood@fas.org'\ncreator: Ashley, Carl E (PACE)\ndate: 2012-06-22T18:32:54Z\ndc:creator: Ashley, Carl E (PACE)\ndc:description: HAC Annual Report\ndc:title: HAC Annual Report\ndcterms:created: 2012-06-22T18:32:54Z\ndcterms:modified: 2012-06-22T18:32:54Z\nmeta:author: Ashley, Carl E (PACE)\nmeta:creation-date: 2012-06-22T18:32:54Z\nmeta:save-date: 2012-06-22T18:32:54Z\nmodified: 2012-06-22T18:32:54Z\nresourceName: test-message-poi-succeeds.msg\nsubject: HAC Annual Report\ntitle: HAC Annual Report\n\nTika fails on the second message, returning no date fields:\n\nAuthor: PA History Mailbox\nContent-Length: 29696\nContent-Type: application/vnd.ms-outlook\nMessage-Bcc: \nMessage-Cc: \nMessage-From: PA History Mailbox\nMessage-Recipient-Address: garrettac@state.gov\nMessage-To: Garrett, Amy C (PACE)\ncreator: PA History Mailbox\ndc:creator: PA History Mailbox\ndc:description: Draft to La Tetra\ndc:title: Draft to La Tetra\nmeta:author: PA History Mailbox\nresourceName: test-message-poi-fails.msg\nsubject: Draft to La Tetra\ntitle: Draft to La Tetra\n\n\n2) The second test is to run POI HSMFDump directly on each file:\n\n  java -classpath poi-3.8-20120326.jar:poi-scratchpad-3.8-20120326.jar org.apache.poi.hsmf.dev.HSMFDump <filename>\n\nWhen I run this command on the first file, it returns ALL of the fields above (including the 'date' field) in the following area:\n\n  125 - TransportMessageHeaders - Unicode String\n\nWhen I run this command on the second file, it returns NO 'date' fields, and no such '125' field.\n\nI would appreciate anyone's assistance with this issue.\n\nMy System\n---------\nI am using poi-bin-3.8-20120326, tika-app-1.2, and Mac OS X 10.8.1 with Java 1.6.0_33.", "id": 161752, "time": "2012-08-27T21:44:52Z", "bug_id": 53784, "creation_time": "2012-08-27T21:44:52Z", "is_private": false}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "There has been some discussions about this on the mailing list. We currently support decoding variable length properties, but not fixed length ones which get stored differently. There's a little bit of code added quite recently towards supporting fixed length ones, but more work is needed on it.", "id": 161763, "time": "2012-08-28T06:25:42Z", "bug_id": 53784, "creation_time": "2012-08-28T06:25:42Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 53784, "attachment_id": null, "id": 161772, "time": "2012-08-28T12:07:14Z", "creator": "joewiz@gmail.com", "creation_time": "2012-08-28T12:07:14Z", "is_private": false, "text": "The thread Nick referred to is http://markmail.org/message/cm5fkzosjlwelz2c.  Also, for additional context, here is the earlier thread on the Tika list: http://markmail.org/message/vtweepcegqwjuxb4."}, {"count": 3, "tags": [], "bug_id": 53784, "attachment_id": 29407, "text": "Created attachment 29407\nFirst version of patch for bug 53784", "id": 162344, "time": "2012-09-22T19:36:13Z", "creator": "claudius.teodorescu@gmail.com", "creation_time": "2012-09-22T19:36:13Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 53784, "attachment_id": null, "text": "Attached is a first version of patch for this issue. The date is thus correctly extracted for the messages mentioned. I also made a unit test for those two messages.\n\nThe flags for client submit time property are not extracted, as would imply modification of another class. If they are necessary now, I can modify that class.", "id": 162345, "time": "2012-09-22T19:39:01Z", "creator": "claudius.teodorescu@gmail.com", "creation_time": "2012-09-22T19:39:01Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 53784, "attachment_id": null, "text": "The fix suggested will need some work, as it's a little too specific for the one property type. Thanks for the start though!", "id": 162749, "time": "2012-10-14T14:52:54Z", "creator": "apache@gagravarr.org", "creation_time": "2012-10-14T14:52:54Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 53784, "attachment_id": null, "id": 162762, "time": "2012-10-15T10:46:57Z", "creator": "apache@gagravarr.org", "creation_time": "2012-10-15T10:46:57Z", "is_private": false, "text": "I've committed a partial fix for this in r1398241.\n\nI've had to disable part of your test though, as we're now getting a date, but not quite the correct one\n\nReally, we need to finish the property value decoding, add some unit tests for that part, and then re-visit the disabled tests to verify what really should be happening.\n\nOnce that's done, we can likely do a bit of refactoring, and then expose more of the properties on MAPIMessage!"}]
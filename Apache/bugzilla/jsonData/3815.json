[{"count": 0, "tags": [], "bug_id": 3815, "attachment_id": null, "text": "I am seeing exceptions like this in my log files:\n\njava.lang.NullPointerException: \n\tat org.apache.jasper.servlet.JspServlet$JspServletWrapper.load\n(JspServlet.java:138)\n\tat \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.loadIfNecessary\n(JspServlet.java:178)\n\tat org.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:188)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:381)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:473)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:1264)\n\tat org.apache.catalina.core.ApplicationDispatcher.invoke\n(ApplicationDispatcher.java:672)\n\tat org.apache.catalina.core.ApplicationDispatcher.doForward\n(ApplicationDispatcher.java:430)\n\tat org.apache.catalina.core.ApplicationDispatcher.forward\n(ApplicationDispatcher.java:354)\n\tat org.apache.jasper.runtime.PageContextImpl.forward\n(PageContextImpl.java:409)\n\tat org.apache.jasper.runtime.PageContextImpl.handlePageException\n(PageContextImpl.java:446)\n\tat org.apache.jsp.EquipData$jsp._jspService(EquipData$jsp.java:838)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:107)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:1264)\n\tat org.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:201)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:381)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:473)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:1264)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:243)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:215)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2366)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:164)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat com.visionnaire.PSS.servlet.PSSValve.invoke(PSSValve.java:74)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.AccessLogValve.invoke\n(AccessLogValve.java:462)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1005)\n\tat org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1098)\n\tat java.lang.Thread.run(Thread.java:484)\n\n\nLooking at the code (JspServlet.java:138), it seems servletClass is null, and \nthis is possible because (JspServlet.java:177) the load() method is always \ninvoked theServlet is null: \"if (loadJSP(jspUri, cp, isErrorPage, req, res) || \ntheServlet == null) { load(); }\".  I wonder if this condition is incorrect, it \ndoesn't seem to make a lot of sense.", "id": 6006, "time": "2001-09-25T09:56:53Z", "creator": "osvaldo@visionnaire.com.br", "creation_time": "2001-09-25T09:56:53Z", "is_private": false}, {"count": 1, "tags": [], "creator": "osvaldo@visionnaire.com.br", "is_private": false, "text": "(Please ignore my last comment, I didn't read the source correctly.)\n\nMy JSP was producing an ArrayStoreException because it had a bug, and I was \nrunning a stress test with JMeter with 10 concurrent threads.  I have an \nerrorpage set up for this app, so every thread invoking this page causes the \nerrorpage to be produced.  This is why the stack trace shows \nhandlePageException -> forward -> etc.  Unfortunately I did lots of tests and \nfixes and now I cannot reproduce the issue, even rolling back the code.", "id": 6025, "time": "2001-09-25T13:50:12Z", "bug_id": 3815, "creation_time": "2001-09-25T13:50:12Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "mock-apache@misfit.dhs.org", "text": "During some load testing I have done, I have observed a similar exception.\nI'm not sure that this bug has anything to do with errors in user code,\notherwise we would see user code in the stack trace, no ?\n\nMore likely, this is related to bug 14077 \"JSP class corruption when compiling\npage on SMP server\", as I have encountered this problem on an SMP system.\n\nMy environment included\n\n   Tomcat 4.0.4 \n   Sun E420R with 4 CPUs\n   Solaris 2.8\n\nAfter doing some investigation of JspServlet.java, there are some very\nclear race conditions that can happen which cause all sorts of funky\nexceptions including the NPE originally filed, when Tomcat is loaded down \nheavily with multiple requests. \n\nI have created a patch that has eliminated the problem entirely for me.\n\nWhat it tries to do is prevent a single JSP from being loaded concurrently\nfrom multiple threads. Besides fixing this immediate problem, It also\nappears to alleviate the Jasper MT problems in bug 14077. \n\nI can now run Tomcat and heavily load it down with requests, touch all\nthe JSPs to force them to recompile, and no errors occur.\n", "id": 30916, "time": "2003-02-07T20:04:32Z", "bug_id": 3815, "creation_time": "2003-02-07T20:04:32Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 3815, "attachment_id": 4776, "text": "Created attachment 4776\nJspServlet concurrency patch.", "id": 30917, "time": "2003-02-07T20:11:17Z", "creator": "mock-apache@misfit.dhs.org", "creation_time": "2003-02-07T20:11:17Z", "is_private": false}, {"count": 4, "tags": [], "text": "This problem is resolved in 4.1.24.", "is_private": false, "id": 35208, "creator": "remm@apache.org", "time": "2003-04-15T15:46:53Z", "bug_id": 3815, "creation_time": "2003-04-15T15:46:53Z", "attachment_id": null}]
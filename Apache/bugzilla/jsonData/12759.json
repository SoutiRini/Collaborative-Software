[{"attachment_id": null, "tags": [], "creator": "helene.morice@alcatel.fr", "text": "Environment:\nPlatform = SUN\nOS = Solaris\nApache 1.3.12\nTomcat 3.3.1\nConnector = mod_jserv AJP12\nSSL = mod_ssl + OpenSSL\nServlet 2.2 + JSP spec 1.1\nJava Version 1.2 (Runtime & Dev)\n\nThe problem appears only with load tests.\n\nIt seems to have a confusion between the different sessions. To summarize, a \nsessionID corresponds to a login (that is to a user).\nFor example,  when a session is invalidated because the user sent a logout \nrequest, sometimes it occurs errors for an other user who is login yet and  has \nnormally a different sessionID. In fact,  these two users have the same \nreferences to the session!!\n\nHere is the POST method in the servlet:\n\n                //Retrieve the HTTP session from the request\n\t\tHttpSession session = request.getSession();\n\t\t\n\t\tif (beanName.equals(\"loginBean\") && httpMode.equals(\"secure\"))\n\t\t{\n\t\t\t//Invalidate current session\n\t\t\tif (session.getAttribute(\"watchdog\") == null)\n                           session.setAttribute(\"watchdog\", watchdog); //to \n                                                          clean some directories\n                                                          related to the session\n\t\t\tsession.invalidate();\n\t\t\t//Create new session\n\t\t\tsession = request.getSession(true);\n\t\t\t\n\t\t\t//Retrieve cookie from HTTP request\n\t\t\tCookie[] cookies = request.getCookies();\n\t\t\tcookies[0].setValue(session.getId());\n\t\t\tcookies[0].setSecure(true);\n\t\t\tcookies[0].setPath(docRoot);\n\t\t\t\n\t\t\t//Add new cookie in HTTP response with secure option and \n                          new session ID\n\t\t\tresponse.addCookie(cookies[0]);\n\n\t\t\t//First abnormality\n                        if (session.getAttribute(\"watchdog\") != null)\n                                Trace.println(\"[WMB_SERVLET]:\tWatchdog already \n                                bound to the session?? \", \"ERROR\", traceLevel);\n\t\t}\n\n\n\nSecond abnormality:\nHere is the exception displayed sometimes during load tests with moreover the \ntrace above:\n\n09/11 17:09:32:135  java.lang.IllegalStateException: getAttributeNames: Session \nalready invalidated\n\tat java.lang.Throwable.fillInStackTrace(Native Method)\n\tat java.lang.Throwable.fillInStackTrace(Compiled Code)\n\tat java.lang.Throwable.<init>(Compiled Code)\n\tat java.lang.Exception.<init>(Compiled Code)\n\tat java.lang.RuntimeException.<init>(RuntimeException.java:47)\n\tat java.lang.IllegalStateException.<init>(IllegalStateException.java:45)\n\tat org.apache.tomcat.facade.HttpSessionFacade.checkValid(Compiled Code)\n\tat org.apache.tomcat.facade.HttpSessionFacade.getAttribute(Compiled \nCode)\n\tat wmb.bean.protocole.Consult.serverProcess(Compiled Code)\n\tat wmb.servlet.WMBServlet.displayNextPage(Compiled Code)\n\tat wmb.servlet.WMBServlet.doGet(Compiled Code)\n\tat javax.servlet.http.HttpServlet.service(Compiled Code)\n\tat javax.servlet.http.HttpServlet.service(Compiled Code)\n\tat org.apache.tomcat.facade.ServletHandler.doService(Compiled Code)\n\tat org.apache.tomcat.core.Handler.invoke(Compiled Code)\n\tat org.apache.tomcat.core.Handler.service(Compiled Code)\n\tat org.apache.tomcat.facade.ServletHandler.service(Compiled Code)\n\tat org.apache.tomcat.facade.RequestDispatcherImpl.doForward(Compiled \nCode)\n\tat org.apache.tomcat.facade.RequestDispatcherImpl.forward(Compiled Code)\n\tat org.apache.jasper.runtime.PageContextImpl.forward(Compiled Code)\n\tat _default.fwd_consult_1._jspService(Compiled Code)\n\tat org.apache.jasper.runtime.HttpJspBase.service(Compiled Code)\n\tat javax.servlet.http.HttpServlet.service(Compiled Code)\n\tat org.apache.tomcat.facade.ServletHandler.doService(Compiled Code)\n\tat org.apache.tomcat.core.Handler.invoke(Compiled Code)\n\tat org.apache.tomcat.core.Handler.service(Compiled Code)\n\tat org.apache.tomcat.facade.ServletHandler.service(Compiled Code)\n\tat org.apache.tomcat.core.ContextManager.internalService(Compiled Code)\n\tat org.apache.tomcat.core.ContextManager.service(Compiled Code)\n\tat \norg.apache.tomcat.modules.server.Ajp12Interceptor.processConnection(Compiled \nCode)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(Compiled Code)\n\tat \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(Compiled Code)\n\tat java.lang.Thread.run(Compiled Code)\n\n\n\nHere is javaBean Consult.java:\n\npublic void serverProcess()\n\t{\n\t\tif(reload)\n\t\t{\n\t            EmailParameters emailParameters = \n                       (EmailParameters)session.getAttribute(\"emailParameters\");\n\t            \u2026etc\n                }\n        }", "count": 0, "id": 23010, "time": "2002-09-18T08:13:46Z", "bug_id": 12759, "creation_time": "2002-09-18T08:13:46Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 12759, "text": "\n\n*** This bug has been marked as a duplicate of 15894 ***", "id": 33273, "time": "2003-03-16T22:07:33Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-03-16T22:07:33Z", "is_private": false, "attachment_id": null}]
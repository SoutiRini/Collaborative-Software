[{"attachment_id": null, "tags": [], "creator": "jtg@nymfinity.net", "is_private": false, "count": 0, "id": 1231, "time": "2001-03-12T15:55:29Z", "bug_id": 948, "creation_time": "2001-03-12T15:55:29Z", "text": "Tomcat 3.2.1\nApache 1.3.12\nJDK 1.2.2_07\nSolaris 8\n\nWhile experimenting with the max number of threads in the thread pool (using\nAjp13), I found that after I set it to 120 I got ArrayIndexOutOfBoundsExceptions\nthrown in SimplePool.put.  I think this is because\n\n1) The SimplePool is instantiated with a max size of 100 (JspFactoryImpl.java,\nline 80)\n2) The put method in SimplePool.java doesn't check the array bounds correctly.\n\nHere's the put method:\n\n   102      /**\n   103       * Add the object to the pool, silent nothing if the pool is full\n   104       */\n   105      public  void put(Object o) {\n   106          int idx=-1;\n   107          synchronized( lock ) {\n   108              if( current < max )\n   109                  idx=++current;\n   110          }\n   111          if( idx > 0 )\n   112              pool[idx]=o;\n   113      }\n\nIt seems that at line 112, idx can be in the range 1 to 100 (assuming max is\n100) rather than 0 to 99.  A simple fix would be to change the two conditionals\nto the following:\n   108              if( current < ( max - 1 ) )\nand\n   111          if( idx >= 0 )\n\nThis bug also appeared in the 4.0 nightly build.\n\nJason"}, {"count": 1, "tags": [], "bug_id": 948, "text": "This is fixed in cvs in both the 3.2 branch (tomcat_32), and the 3.3 branch\n(jakarta-tomcat HEAD).  It should also be fixed in the 3.2.2b1 binary build.", "id": 1234, "time": "2001-03-12T21:05:51Z", "creator": "danmil@shore.net", "creation_time": "2001-03-12T21:05:51Z", "is_private": false, "attachment_id": null}]
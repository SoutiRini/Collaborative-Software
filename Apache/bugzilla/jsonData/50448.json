[{"count": 0, "tags": [], "bug_id": 50448, "attachment_id": null, "text": "Hi,\n\nwhen verifying the fix for #50360 I ran into an issue with expired sessions during processExpires:\n\nDec 10, 2010 12:59:32 AM org.apache.catalina.core.ContainerBase backgroundProcess\nWARNING: Exception processing manager de.javakaffee.web.msm.MemcachedBackupSessionManager[/] background process\njava.lang.IllegalStateException: getCreationTime: Session already invalidated\n\tat org.apache.catalina.session.StandardSession.getCreationTime(StandardSession.java:1096)\n\tat org.apache.catalina.session.ManagerBase.remove(ManagerBase.java:802)\n\tat org.apache.catalina.session.StandardSession.expire(StandardSession.java:840)\n\tat org.apache.catalina.session.StandardSession.isValid(StandardSession.java:655)\n\tat org.apache.catalina.session.ManagerBase.processExpires(ManagerBase.java:609)\n\tat org.apache.catalina.session.ManagerBase.backgroundProcess(ManagerBase.java:594)\n\tat de.javakaffee.web.msm.MemcachedBackupSessionManager.backgroundProcess(MemcachedBackupSessionManager.java:1130)\n\tat org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1214)\n\nAFAICS in MemcachedBackupSessionManager I could override remove(Session session, boolean update) with calling super.remove(session, false) for invalid sessions.\n\nAnother option would be to change StandardSession.expire(StandardSession.java:840) so that it does not invoke manager.remove(this, true) but manager.remove(this, false).\n\nOr even better: change ManagerBase.remove(ManagerBase.java:802) to invoke some session.getCreationTimeInternal() which skips validation.\n\nWhat do you think?\n\nCheers,\nMartin", "id": 142545, "time": "2010-12-09T19:23:29Z", "creator": "martin.grotzke@googlemail.com", "creation_time": "2010-12-09T19:23:29Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50448, "attachment_id": null, "id": 142563, "time": "2010-12-10T08:54:50Z", "creator": "markt@apache.org", "creation_time": "2010-12-10T08:54:50Z", "is_private": false, "text": "Thanks for the report. Fixed in 7.0.x and will be included in 7.0.6 onwards."}, {"count": 2, "tags": [], "bug_id": 50448, "attachment_id": null, "text": "Thanx for the fix, now all tests for memcached-session-manager are green! Happy now, looking forward to tomcat 7.0.6. Keep on the great work!", "id": 142590, "time": "2010-12-11T08:13:04Z", "creator": "martin.grotzke@googlemail.com", "creation_time": "2010-12-11T08:13:04Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "groodt@gmail.com", "attachment_id": null, "text": "Using the optional FTP tasks, requires the installation of optional libraries into Ant's classpath.\n\nI would suggest enhancing the FTP task, so that the optional libraries can be referenced with a classpath entry element in the same way as the JUnit task.\n\nI will be happy to make the enhancement.", "id": 120854, "time": "2008-09-22T07:35:56Z", "bug_id": 45860, "creation_time": "2008-09-22T07:35:56Z", "is_private": false}, {"count": 1, "attachment_id": 22762, "bug_id": 45860, "text": "Created attachment 22762\nFTPTask extracted out into delegate.", "id": 121736, "time": "2008-10-21T09:20:57Z", "creator": "groodt@gmail.com", "creation_time": "2008-10-21T09:20:57Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "text": "I have had a rough go at extracting out the direct dependencies on commons-net\ninto a delegate. I have run into a snag - the\nFTPTask.LanguageCode.getValidLanguageCodes() method makes direct references to\nFTPClientConfig. :(\n\nAny suggestions for get this refactored out?", "is_private": false, "bug_id": 45860, "id": 121737, "time": "2008-10-21T09:25:33Z", "creator": "groodt@gmail.com", "creation_time": "2008-10-21T09:25:33Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "is_private": false, "id": 121755, "time": "2008-10-21T20:43:19Z", "bug_id": 45860, "creation_time": "2008-10-21T20:43:19Z", "text": "I don't think there is a clean way to do it since the class doesn't have any access to <ftp>'s classpath at all.\n\nOne option may be to hard code the supported languages of commons-net 2.0 and I must admit I can't come up with an alternative."}, {"count": 4, "tags": [], "bug_id": 45860, "text": "My need was to get FTP to work without adding jars to %ANT_HOME%/lib or\n${user.home}/.ant/lib, but rather use jars relative to my project so that each developer didn't have to do anything on their machine.  I had to delve into the code, and although this may not work in the future, it does right now:\n\n\t<path id=\"wptg.classpath\">\n\t\t<fileset dir=\"${wptg.work.dir}\" includes=\"commons-net-1.4.1.jar\" />\n\t\t<fileset dir=\"${wptg.work.dir}\" includes=\"jakarta-oro-2.0.8.jar\" />\n\t\t<fileset dir=\"${ant.library.dir}\" includes=\"ant-commons-net.jar\" />\n\t</path>\n\t<classloader classpathref=\"wptg.classpath\" parentFirst=\"false\" />\n\t<taskdef name=\"wptg-ftp\" classname=\"org.apache.tools.ant.taskdefs.optional.net.FTP\" loaderref=\"ant.coreLoader\" />\n\nWith the name off of <classloader>, it creates a new AntClassLoader with the optional jars, and ant-common-net.jar.  If memory serves, specifying classpathref for the taskdef failed b/c the FTP task was loaded by the bootstrap classloader, and couldn't see the FTPClient class.  I stuck with this as my method for adding more optional jars for the project as a whole.", "id": 121763, "time": "2008-10-21T22:48:14Z", "creator": "robert.flaherty@oracle.com", "creation_time": "2008-10-21T22:48:14Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "text": "svn revision 808350 contains the code in a further modified manner (basically I've shuffled around some code to make diffs against FTP.java easier to read) with support for a nested classpath.  Since ftp had evolved a bit, I also had to merge a few changes.\n\nI can't properly use <ftp> in my current environment therefore I haven't enabled the changed task, yet.  Will do so later on a different machine (later likely measured in days).\n\nAs for the language configuration, I've simply decided to not use an enumerated attribute at all, but a plain string.", "id": 129977, "time": "2009-08-27T03:17:16Z", "bug_id": 45860, "creation_time": "2009-08-27T03:17:16Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 45860, "is_private": false, "text": "Thanks Stefan.\n\nI've checked out revision 808350, updated defaults.properties to use FTPTask and built ant.\n\nWhen I try to run with a nested classpath WITHOUT ant-commons-net.jar in the nested classpath, this is the error I get:\njava.lang.ClassNotFoundException: org.apache.tools.ant.taskdefs.optional.net.FTPTaskMirrorImpl\n        at org.apache.tools.ant.AntClassLoader.findClassInComponents(AntClassLoa\nder.java:1386)\n        at org.apache.tools.ant.AntClassLoader.findClass(AntClassLoader.java:133\n6)\n        at org.apache.tools.ant.util.SplitClassLoader.loadClass(SplitClassLoader\n.java:52)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:252)\n        at org.apache.tools.ant.taskdefs.optional.net.FTPTask.createMirror(FTPTa\nsk.java:824)\n        at org.apache.tools.ant.taskdefs.optional.net.FTPTask.setupFTPDelegate(F\nTPTask.java:804)\n        at org.apache.tools.ant.taskdefs.optional.net.FTPTask.execute(FTPTask.ja\nva:775)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.jav\na:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:390)\n        at org.apache.tools.ant.Target.performTasks(Target.java:411)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1360)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1329)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExe\ncutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1212)\n        at org.apache.tools.ant.Main.runBuild(Main.java:775)\n        at org.apache.tools.ant.Main.startAnt(Main.java:217)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:280)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:109)\n\nWhen I try to run with a nested classpath WITH ant-commons-net.jar in the nested classpath, this is the error I get:\njava.lang.IllegalAccessError:\n tried to access field org.apache.tools.ant.taskdefs.optional.net.FTPTask.ACTION\n_STRS from class org.apache.tools.ant.taskdefs.optional.net.FTPTaskMirrorImpl\n        at org.apache.tools.ant.taskdefs.optional.net.FTPTaskMirrorImpl.doFTP(FT\nPTaskMirrorImpl.java:1912)\n        at org.apache.tools.ant.taskdefs.optional.net.FTPTask.execute(FTPTask.ja\nva:776)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.jav\na:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:390)\n        at org.apache.tools.ant.Target.performTasks(Target.java:411)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1360)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1329)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExe\ncutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1212)\n        at org.apache.tools.ant.Main.runBuild(Main.java:775)\n        at org.apache.tools.ant.Main.startAnt(Main.java:217)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:280)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:109)", "id": 129978, "time": "2009-08-27T04:54:32Z", "creator": "groodt@gmail.com", "creation_time": "2009-08-27T04:54:32Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 45860, "text": "the behavior without commons-net seems correct, isn't it?\n\nFor the other case, packages loaded via different classloaders are different packages, so I'll have to change the things needed by FTPTaskMirrorImpl to public.\n\nCould you update to svn revision 808398 to see whether it works better then?\n\nMany thanks for testing.", "id": 129979, "time": "2009-08-27T05:31:31Z", "creator": "bodewig@apache.org", "creation_time": "2009-08-27T05:31:31Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 45860, "text": "Thanks Stefan.\n\nThe reason I was trying without ant-commons-net.jar was because I saw it already in ANT_HOME/lib.\n\nRevision 808398 works for me with a nested classpath of:\nant-commons-net.jar\ncommons-net-1.4.0.jar\noro-2.0.8.jar\n\nIt does not work without a nested classpath and the libs copied into ANT_HOME/lib.", "id": 129981, "time": "2009-08-27T06:51:13Z", "creator": "groodt@gmail.com", "creation_time": "2009-08-27T06:51:13Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 45860, "text": "it is supposed to work without any nested classpath if the jars are in ANT_HOME/lib, so this is a bug.\n\nMost likely mustSplit returns true even if it should not.  Will look into it.\n\nThanks again.", "id": 129984, "time": "2009-08-27T07:43:35Z", "creator": "bodewig@apache.org", "creation_time": "2009-08-27T07:43:35Z", "is_private": false, "attachment_id": null}]
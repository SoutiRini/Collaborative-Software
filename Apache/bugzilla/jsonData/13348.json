[{"count": 0, "tags": [], "text": "After the exception at the bottom of this post is thrown, an empty JAR file of \nthe correct size is created.  I have tried using the ZIP task with the same \nresult.\n\nIt only happens if I CLEAN before the build.  Clean simply deletes 2 folders \n(classes and deploy) before recreating them with PREPARE.  If I try to run the \noffending target (build.wlsejb) immediately after the build fails, it works.  \n\nI think it might have something to do with a file being held open by a \npreviously executed build task in the same run, but this is a guess.\n\nOur build file is built around compiling all core libraries, then, all \napplication libraries.  The application build DEPENDs on the core libraries \nbeing built.  If I build the core libraries separately and then the application \nlibraries, the process works faultlessly.  Adding a subsequent task after the \nejb build causes the same exception to be thrown, but on a different library.  \nFor instance, the following works:\n\n<target name=\"deploy.wlsrelease\" depends=\"prepare.release\">\n\t<antcall target=\"deploy.wlsejb\"/>\n</target>\n\nbut adding\n\t<antcall target=\"build.jspframe\"/> \nafter, generates the exception. JSPFrame is a core application library that is \nnot built by deploy.wlsejb.  As previously stated, remove CLEAN and it works \nwithout error.\n\nAn abbridged version of the build file follows:\n<target name=\"prepare.release\" depends=\"clean\">\n  <property name=\"javac.debug\" value=\"off\"/>\n  <property name=\"javac.optimize\" value=\"on\"/>\n</target>\n\n<target name=\"deploy.wlsrelease\" depends=\"prepare.release\" >\n  <antcall target=\"build.wlsejb\"/><!-- Combines Client and Bean jars -->\n  <antcall target=\"build.jspframe\"/>\n</target>\n\n<target name=\"build.wlsejb\" depends=\"build.romeoejb\"> <!-- builds Client and \nBean jars -->\n\n<jar destfile=\"${dist.dir}/build.jar\" >\n  <fileset dir=\"${build.dir}\" >\n    <include name=\"com/bankblocks/**/*\"/>\n    <include name=\"com/pfmejb/**/*\"/>\n  </fileset>\n</jar>\n</target>\n*******************************************************\nclean:\n   [delete] Deleting directory C:\\Dev\\JSPFrame\\Java\\Classes-md\n   [delete] Deleting directory C:\\Dev\\JSPFrame\\Java\\Deploy-md\n\nprepare.release:\n\nprepare:\n    [mkdir] Created dir: C:\\Dev\\JSPFrame\\Java\\Classes-md\n    [mkdir] Created dir: C:\\Dev\\JSPFrame\\Java\\Deploy-md\n[echoproperties] #Ant properties\n[echoproperties] #Mon Oct 07 09:38:55 GMT+13:00 2002\n[echoproperties] javac.debug=off\n[echoproperties] javac.optimize=on\n\ndeploy.wlsrelease:\n\nprepare:\n[echoproperties] #Ant properties\n[echoproperties] #Mon Oct 07 09:38:55 GMT+13:00 2002\n[echoproperties] javac.debug=off\n[echoproperties] javac.optimize=on\n\nbuild.monowai:\n    [javac] Compiling 153 source files to C:\\Dev\\JSPFrame\\Java\\Classes-md\n      [jar] Building jar: C:\\Dev\\JSPFrame\\Java\\Deploy-md\\monowai.jar\n\nbuild.bankblocks:\n    [javac] Compiling 84 source files to C:\\Dev\\JSPFrame\\Java\\Classes-md\n      [jar] Building jar: C:\\Dev\\JSPFrame\\Java\\Deploy-md\\bankblocks.jar\n\nbuild.romeoejb:\n    [javac] Compiling 138 source files to C:\\Dev\\JSPFrame\\Java\\Classes-md\n      [jar] Building jar: C:\\Dev\\JSPFrame\\Java\\Deploy-md\\romeo_client.jar\n      [jar] Building jar: C:\\Dev\\JSPFrame\\Java\\Deploy-md\\romeo_beans.jar\n\nbuild.wlsejb:\n      [jar] Building jar: C:\\Dev\\JSPFrame\\Java\\Deploy-md\\build.jar\n\ndeploy.wlsejb:\n     [copy] Copying 1 file to C:\\DEVAPPS\\BEA\\wlserver6.1\n\\config\\mydomain\\applications\n\nprepare:\n[echoproperties] #Ant properties\n[echoproperties] #Mon Oct 07 09:39:23 GMT+13:00 2002\n[echoproperties] javac.debug=off\n[echoproperties] javac.optimize=on\n\nbuild.monowai:\n\nbuild.jspframe:\n    [javac] Compiling 261 source files to C:\\Dev\\JSPFrame\\Java\\Classes-md\n      [jar] Building jar: C:\\Dev\\JSPFrame\\Java\\Deploy-md\\jspframe.jar\n\nBUILD FAILED\njava.lang.NullPointerException\n        at org.apache.tools.zip.ZipOutputStream.finish(ZipOutputStream.java\n(Compiled Code))\n        at java.util.zip.DeflaterOutputStream.close\n(DeflaterOutputStream.java:139)\n        at org.apache.tools.ant.taskdefs.Zip.execute(Zip.java:402)\n        at org.apache.tools.ant.Task.perform(Task.java:319)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:336)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1306)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:371)\n        at org.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:143)\n        at org.apache.tools.ant.Task.perform(Task.java:319)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:336)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1306)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1250)\n        at org.apache.tools.ant.Main.runBuild(Main.java:610)\n        at org.apache.tools.ant.Main.start(Main.java:196)\n        at org.apache.tools.ant.Main.main(Main.java:235)", "attachment_id": null, "id": 24031, "creator": "mikeh@monowai.com", "time": "2002-10-06T20:41:30Z", "bug_id": 13348, "creation_time": "2002-10-06T20:41:30Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 13348, "text": "I'm seeing this same bug using the <jar> task.\n\n      <jar jarfile=\"${basedir}/WEB-INF/lib/FDR_${portletName}.jar\"\n           basedir=\"${srcDir}\">\n         <include name=\"com/ibm/drp/content/subscription/portlet/*.class\" />\n         <include \nname=\"com/ibm/drp/content/subscription/portlet/uibean/*.class\" />\n      </jar>\n\nAs in the original description, the NullPointerException occurs when I first \nrun a build which also causes the class files to be built.  If I run the build \na second time, when the class files already exist, the <jar> task completes \ncorrectly.", "id": 25490, "time": "2002-11-01T18:48:42Z", "creator": "lawrence@us.ibm.com", "creation_time": "2002-11-01T18:48:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "You are running an IBM JDK 1.2.2 or 1.3.0, correct?\n\n\n\n*** This bug has been marked as a duplicate of 11903 ***", "attachment_id": null, "id": 26369, "creator": "bodewig@apache.org", "time": "2002-11-15T13:34:12Z", "bug_id": 13348, "creation_time": "2002-11-15T13:34:12Z", "is_private": false}]
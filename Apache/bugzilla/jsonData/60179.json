[{"count": 0, "tags": [], "creator": "agiokov@gmail.com", "text": "When trying to compile with OpenSSL, the configure script returns the following:\n\nconfigure: checking for openssl in /webdienste/webservers/apache/openssl.test-https/libs/openssl/1.1.0b\nchecking openssl/x509.h usability... yes\nchecking openssl/x509.h presence... yes\nchecking for openssl/x509.h... yes\nchecking for BN_init in -lcrypto... no\nchecking for openssl/x509.h... (cached) yes\nchecking for BN_init in -lcrypto... (cached) no\nchecking whether EVP_PKEY_CTX_new is declared... yes\nconfigure: error: Crypto was requested but no crypto library could be enabled; specify the location of a crypto library using --with-openssl, --with-nss, etc.\nconfigure failed for srclib/apr-util", "id": 194023, "time": "2016-09-27T09:27:48Z", "bug_id": 60179, "creation_time": "2016-09-27T09:27:48Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "agiokov@gmail.com", "text": "From OpenSSL 1.1.0 documentation:\n\nBN_init() was removed in OpenSSL 1.1.0; use BN_new() instead.", "id": 194024, "time": "2016-09-27T09:35:50Z", "bug_id": 60179, "creation_time": "2016-09-27T09:35:50Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "agiokov@gmail.com", "text": "Created attachment 34304\nPatch to replace BN_init with BN_new in the configure scripts\n\nSimple replacement in the configure files (configure and build/crypto.m4) of BN_init with BN_new, as suggested in OpenSSL 1.1.0 documentation", "id": 194026, "time": "2016-09-27T09:57:59Z", "bug_id": 60179, "creation_time": "2016-09-27T09:57:59Z", "is_private": false, "attachment_id": 34304}, {"count": 3, "tags": [], "creator": "agiokov@gmail.com", "text": "The patch I have added allows the compilation to proceed, but it fails at file apr_crypto_openssl.c:\n\ncrypto/apr_crypto_openssl.c:67: error: field 'cipherCtx' has incomplete type\n\nThe line 67 is the following:\n\n    EVP_CIPHER_CTX cipherCtx;\n\nFrom the OpenSSL changelog:\n...\nChanges between 1.0.2h and 1.1.0  [25 Aug 2016]\n...\n  *) Made EVP_MD_CTX, EVP_MD, EVP_CIPHER_CTX, EVP_CIPHER and HMAC_CTX\n     opaque.  For HMAC_CTX, the following constructors and destructors\n     were added:\n\n        HMAC_CTX *HMAC_CTX_new(void);\n        void HMAC_CTX_free(HMAC_CTX *ctx);\n\n     For EVP_MD and EVP_CIPHER, complete APIs to create, fill and\n     destroy such methods has been added.  See EVP_MD_meth_new(3) and\n     EVP_CIPHER_meth_new(3) for documentation.\n\n     Additional changes:\n     1) EVP_MD_CTX_cleanup(), EVP_CIPHER_CTX_cleanup() and\n        HMAC_CTX_cleanup() were removed.  HMAC_CTX_reset() and\n        EVP_MD_CTX_reset() should be called instead to reinitialise\n        an already created structure.\n     2) For consistency with the majority of our object creators and\n        destructors, EVP_MD_CTX_(create|destroy) were renamed to\n        EVP_MD_CTX_(new|free).  The old names are retained as macros\n        for deprecated builds.\n     [Richard Levitte]\n\nCould this be an OpenSSL bug?", "id": 194028, "time": "2016-09-27T10:24:27Z", "bug_id": 60179, "creation_time": "2016-09-27T10:24:27Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Created attachment 34305\nPatch to fix the code for OpenSSL 1.1.0\n\nBesides replacing BN_init with BN_new in the configure files, this patch changes the following in the file apr_crypto_openssl.c:\n\n- changes the cipherCtx to a pointer in the apr_crypto_block_t struct type;\n- changes all uses of cipherCtx in the code accordingly;\n- replaces (conditionally) EVP_CIPHER_CTX_cleanup with EVP_CIPHER_CTX_reset for OPENSSL_VERSION_NUMBER >= 0x10100000L;\n\nWith these changes, apr-utils compile with openssl 1.1.0, but I am not sure if it really works. Somebody should test and verify it.", "is_private": false, "bug_id": 60179, "id": 194031, "time": "2016-09-27T11:48:51Z", "creator": "agiokov@gmail.com", "creation_time": "2016-09-27T11:48:51Z", "attachment_id": 34305}, {"count": 5, "tags": [], "creator": "nick@webthing.com", "text": "This appears to be fixed in r1730344 back in February.  I guess you're using an old version?", "id": 194115, "time": "2016-10-02T16:50:10Z", "bug_id": 60179, "creation_time": "2016-10-02T16:50:10Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "agiokov@gmail.com", "attachment_id": null, "id": 194120, "time": "2016-10-03T07:35:17Z", "bug_id": 60179, "creation_time": "2016-10-03T07:35:17Z", "is_private": false, "text": "I am using APR 1.5.2 and APR-util 1.5.4 - the latest releases. I see the new revision in subversion, but is it considered stable, and if yes - why it is not released as APR-utils 1.5.5?"}]
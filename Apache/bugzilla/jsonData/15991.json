[{"count": 0, "tags": [], "bug_id": 15991, "attachment_id": null, "id": 29180, "time": "2003-01-11T09:18:53Z", "creator": "valerio@geody.com", "creation_time": "2003-01-11T09:18:53Z", "is_private": false, "text": "I think this is a PHP problem, but I've submitted the bug to them first, but\nthey replied \"Sorry, but your problem does not imply a bug in PHP itself.\" and\napparently think the cause might be Apache.\n\n\nPHP can't set cookies on Windows 2000 systems after testing a\nnon-existing variable.\n\nThis problem was reported in the following conditions:\n- Windows 2000 server SP-3  (IIS not installed)\n- Apache v2.0.43 (confirmed on Apache v1.3.27 as well)\n- PHP 4.3.0 (confirmed on 4.2.2 and 4.2.3 as well)\n\nThe problem happens with Windows 2000 only. On Windows 98 with the very\nsame configuration, or on Linux, everything works fine.\n\nExample:\n\n<?\n# $test=\"X\";\nsetcookie(\"debug\",\"1\",time()+60*60*24*30,\"\",\"\");\nif ($test==\"\") {# test}\nsetcookie(\"debug\",\"3\",time()+60*60*24*30,\"\",\"\");\n?>\n<HTML>\n<HEAD>\n<TITLE>w2k/PHP setcookie bug test</TITLE>\n</HEAD>\n<BODY>\nBEGIN<BR>\n<?\necho \"Cookie: [\".$_COOKIE[\"debug\"].\"] (HIT RELOAD)<BR>\";\n?>\nEND<BR>\n</BODY>\n</HTML>\n\nWhen $test is not set, the cookie \"debug\" remains set to 1, while when\n$test is set to any value (including \"\", an empty string), cookie will\nbe eventually properly set to 3."}, {"count": 1, "text": "Sorry, the example will not work anyway because I've commented the text within\nthe if statement, resulting in commenting the closing bracket as well. \n\nThis is a shorter and correct example:\n\n<?\n# $test=\"\";\nsetcookie(\"debug\",\"1\",0,\"\",\"\");\nif ($test==\"\") { echo \"\"; }\nsetcookie(\"debug\",\"3\",0,\"\",\"\");\necho \"Cookie: [\".$_COOKIE[\"debug\"].\"] (HIT RELOAD)<BR>\";\n?>", "bug_id": 15991, "is_private": false, "id": 29272, "time": "2003-01-13T16:11:08Z", "creator": "valerio@geody.com", "creation_time": "2003-01-13T16:11:08Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 15991, "attachment_id": null, "id": 29273, "time": "2003-01-13T16:11:32Z", "creator": "valerio@geody.com", "creation_time": "2003-01-13T16:11:32Z", "is_private": false, "text": "I've found out that the problem is not limited to tests. It happens\nevery time you invoke an unset variable before than setting a cookie.\n\nIn the previous example, try\n$a = $test;\ninstead of\nif ($test==\"\") { echo \"\"; }\nand the setcookie won't work as well."}, {"count": 3, "tags": [], "bug_id": 15991, "attachment_id": null, "id": 29274, "time": "2003-01-13T16:11:47Z", "creator": "valerio@geody.com", "creation_time": "2003-01-13T16:11:47Z", "is_private": false, "text": "Workaround (which doesn't mean this bug shouldn't be fixed):\n\nTo perform tests:\nif (!isset($test) || $test==\"\") { echo \"\"; }\n\nTo set a variable:\n$a=\"\"; if (isset($test)) { $a=$test; }"}, {"count": 4, "tags": [], "bug_id": 15991, "attachment_id": null, "text": "Workaround #2:\n\nAt the beginning og your script, \"declare\" any possibly unset variable that will\nbe invoked:\n\nif (!isset($test)) {$test=\"\";}", "id": 29275, "time": "2003-01-13T16:50:05Z", "creator": "valerio@geody.com", "creation_time": "2003-01-13T16:50:05Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 15991, "attachment_id": null, "is_private": false, "id": 29277, "time": "2003-01-13T16:51:27Z", "creator": "valerio@geody.com", "creation_time": "2003-01-13T16:51:27Z", "text": "Closing as INVALID because it's a PHP bug, in my opinion.\nIf someone can prove the contrary, please reopen it."}, {"count": 6, "tags": [], "bug_id": 15991, "attachment_id": null, "id": 29343, "time": "2003-01-14T09:56:56Z", "creator": "valerio@geody.com", "creation_time": "2003-01-14T09:56:56Z", "is_private": false, "text": "It turned out to be a PHP configuration problem.\n\nFor more information, refer to:\nhttp://bugs.php.net/bug.php?id=21569"}]
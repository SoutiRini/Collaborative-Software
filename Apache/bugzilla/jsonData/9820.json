[{"count": 0, "tags": [], "creator": "cv@corbach.de", "attachment_id": null, "id": 17713, "time": "2002-06-12T21:46:38Z", "bug_id": 9820, "creation_time": "2002-06-12T21:46:38Z", "is_private": false, "text": "SetEnv works without any problems if set in httpd.conf but setting in \nan .htaccess ('AllowOverride All MultiViews' set for Directory context) causes \nsegmentation faults and no content is delivered to user-agent. Same for \nUnsetEnv and PassEnv.\nIt doesn't depend on type of variable set.\nIn case of PassEnv a previously undefined variable gives\n\n[Wed Jun 12 23:37:17 2002] [warn] PassEnv variable LD_LIBRARY_PATH was undefined\n[Wed Jun 12 23:37:17 2002] [notice] child pid 28855 exit signal Segmentation \nfault (11)\n\nin my error_log. Maybe this can help to find the point where the segfault \noccurs.\nmod_setenvif directives work without difficulties and so far there's a less \nelegant workaround, e.g.\n\nSetEnvIf I_AM_NO_REAL_VARIABLE \"^$\" MY_VARIABLE=bla\n\nwhich can be used under these circumstances.\n\nApache 2.0.36 was compiled on Kernel 2.4.18 using the following options:\n\nLDFLAGS=\"-L/opt/BerkeleyDB.3.3.11/lib\"; export LDFLAGS\nLIBS=\"-ldb-3.3\"; export LIBS\nINCLUDES=\"-I/opt/BerkeleyDB.3.3.11/include\"; export INCLUDES\n\"./configure\" \\\n\"--prefix=/opt/apache2\" \\\n\"--exec-prefix=/opt/apache2\" \\\n\"--sbindir=/opt/apache2/sbin\" \\\n\"--libexecdir=/opt/apache2/lib\" \\\n\"--datadir=/opt/apache2/share\" \\\n\"--sysconfdir=/opt/apache2/etc\" \\\n\"--sharedstatedir=/opt/apache2/com\" \\\n\"--localstatedir=/opt/apache2/var\" \\\n\"--enable-auth-dbm\" \\\n\"--enable-auth-digest\" \\\n\"--enable-cache\" \\\n\"--enable-ext-filter\" \\\n\"--enable-charset-lite\" \\\n\"--enable-deflate\" \\\n\"--enable-disk-cache\" \\\n\"--enable-mem-cache\" \\\n\"--enable-mime-magic\" \\\n\"--enable-cern-meta\" \\\n\"--enable-expires\" \\\n\"--enable-headers\" \\\n\"--enable-usertrack\" \\\n\"--enable-unique-id\" \\\n\"--enable-proxy\" \\\n\"--enable-proxy-connect\" \\\n\"--enable-proxy-ftp\" \\\n\"--enable-proxy-http\" \\\n\"--enable-ssl\" \\\n\"--enable-static-support\" \\\n\"--enable-http\" \\\n\"--enable-dav\" \\\n\"--enable-info\" \\\n\"--enable-dav-fs\" \\\n\"--enable-suexec\" \\\n\"--enable-speling\" \\\n\"--disable-userdir\" \\\n\"--enable-rewrite\" \\\n\"--enable-so\" \\\n\"--with-suexec-caller=wwwrun\" \\\n\"--with-suexec-docroot=/www\" \\\n\"--with-suexec-uidmin=500\" \\\n\"--with-suexec-logfile=/opt/apache2/var/log/suexec.log\" \\\n\"--with-suexec-safepath=/usr/bin:/usr/local/bin\" \\\n\"$@\""}, {"count": 1, "tags": [], "bug_id": 9820, "attachment_id": null, "id": 17715, "time": "2002-06-12T22:03:36Z", "creator": "cv@corbach.de", "creation_time": "2002-06-12T22:03:36Z", "is_private": false, "text": "> 'AllowOverride All MultiViews' set for Directory context\n\nSorry, meant 'AllowOverride All' and 'Options All MultiViews' ;-)"}, {"count": 2, "tags": [], "bug_id": 9820, "attachment_id": null, "id": 18251, "time": "2002-06-20T20:58:21Z", "creator": "cv@corbach.de", "creation_time": "2002-06-20T20:58:21Z", "is_private": false, "text": "Problem still persists with 2.0.39."}, {"count": 3, "tags": [], "text": "Can you get a backtrace for segfault?\n\nOne way is to set CoreDumpDirectory to a directory writeable by\nthe user id associated with the web server, see if you get a coredump there\nwhen the .htaccess is processed, and then \n\n  gdb /opt/apache2/sbin/httpd /my/path/to/core\n  where\n\nAlternatively, you could attach to one of the child processes with gdb\nand wait for a segfault, then use the \"where\" command to get a backtrace.\n\nI'm able to use PassEnv and SetEnv in .htaccess running HEAD on Linux.\nHEAD is almost the same as 2.0.39.\n", "attachment_id": null, "id": 18257, "creator": "trawick@apache.org", "time": "2002-06-20T22:33:18Z", "bug_id": 9820, "creation_time": "2002-06-20T22:33:18Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 9820, "is_private": false, "text": "Thanks for your input. I wasn't able to get a coredump (ulimit -c unlimited, \ndirectory writeable for web user) and choosed to try it with httpd in single \nmode via gdb (hope this is okay, I'm not really familiar with gdb).\n\n(gdb) run -X\nStarting program: /opt/apache2/sbin/httpd -X\n[New Thread 1024 (LWP 17944)]\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 1024 (LWP 17944)]\nmerge_env_dir_configs (p=0x82a73d0, basev=0x8173240, addv=0x82ac810) at \nmod_env.c:114\n114         elts = (const apr_table_entry_t *)arr->elts;\n(gdb) where\n#0  merge_env_dir_configs (p=0x82a73d0, basev=0x8173240, addv=0x82ac810) at \nmod_env.c:114\n#1  0x080ca327 in ap_merge_per_dir_configs (p=0x82a73d0, base=0x819f6a0, \nnew_conf=0x82ac758) at config.c:277\n#2  0x080df44c in ap_directory_walk (r=0x82a7408) at request.c:1175\n#3  0x080dc193 in core_map_to_storage (r=0x82a7408) at core.c:3112\n#4  0x080dda58 in ap_run_map_to_storage (r=0x82a7408) at request.c:110\n#5  0x080de25d in ap_process_request_internal (r=0x82a7408) at request.c:176\n#6  0x080a2936 in ap_process_request (r=0x82a7408) at http_request.c:255\n#7  0x0809e628 in ap_process_http_connection (c=0x82a13e8) at http_core.c:291\n#8  0x080d3868 in ap_run_process_connection (c=0x82a13e8) at connection.c:85\n#9  0x080d3b33 in ap_process_connection (c=0x82a13e8, csd=0x82a1318) at \nconnection.c:207\n#10 0x080c8bd2 in child_main (child_num_arg=0) at prefork.c:692\n#11 0x080c8c9c in make_child (s=0x8124a80, slot=0) at prefork.c:732\n#12 0x080c8d9e in startup_children (number_to_start=5) at prefork.c:804\n#13 0x080c90ad in ap_mpm_run (_pconf=0x811fa30, plog=0x816bb60, s=0x8124a80) at \nprefork.c:1020\n#14 0x080ce78c in main (argc=2, argv=0xbffff814) at main.c:642\n#15 0x402977ee in __libc_start_main () from /lib/libc.so.6\n(gdb)", "id": 18262, "time": "2002-06-20T23:46:42Z", "creator": "cv@corbach.de", "creation_time": "2002-06-20T23:46:42Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 9820, "is_private": false, "count": 5, "id": 18383, "time": "2002-06-22T15:49:33Z", "creator": "cv@corbach.de", "creation_time": "2002-06-22T15:49:33Z", "text": "Mea culpa - this wasn't a bug. The bizarre error resulted from only changing \nthe httpd binary between 2.0.35 and 2.0.36. Installing the whole thing again \nmade it disapear..."}]
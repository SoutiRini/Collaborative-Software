[{"count": 0, "tags": [], "text": "Hi,\n\nSSL 2.0 support got removed from many Debian GNU/Linux (and many others linux distro) and SSL 2.0 is disabled by default in Internet Explorer 7, Mozilla Firefox 3, Opera and Safari.\n\nIt's use has been deprecated, because of weaknesses in the security of the protocol. For exemple, http://www.openssl.org/news/secadv_20051011.txt\n\nI propose to simply drop any support for SSLv2 in Tomcat Native lib with the attached patch.", "is_private": false, "id": 145754, "creation_time": "2011-04-13T14:12:26Z", "time": "2011-04-13T14:12:26Z", "creator": "drazzib@drazzib.com", "bug_id": 51056, "attachment_id": null}, {"text": "Created attachment 26883\nDrop SSLv2 support.", "tags": [], "bug_id": 51056, "is_private": false, "count": 1, "id": 145755, "time": "2011-04-13T14:13:28Z", "creator": "drazzib@drazzib.com", "creation_time": "2011-04-13T14:13:28Z", "attachment_id": 26883}, {"count": 2, "tags": [], "bug_id": 51056, "attachment_id": null, "id": 147994, "creation_time": "2011-07-19T10:12:41Z", "time": "2011-07-19T10:12:41Z", "creator": "jfclere@gmail.com", "text": "Could you attached a diff -u.", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51056, "attachment_id": null, "id": 147996, "time": "2011-07-19T11:09:30Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-07-19T11:09:30Z", "is_private": false, "text": "I'm not so sure, that the library should drop support, but I would be +1 to support only SSLv3 and TLSv1 by default in Tomcat if not explicitely configured for something else (e.g. with +SSLv2).\n\nThe change will be an incompatible though, but probably OK because of security concerns.\n\nRegards,\n\nRainer"}, {"count": 4, "tags": [], "bug_id": 51056, "attachment_id": null, "id": 148020, "creation_time": "2011-07-19T20:18:26Z", "time": "2011-07-19T20:18:26Z", "creator": "drazzib@drazzib.com", "text": "Hi,\n\n@jfclere: Could you explain a little bit more your issue with format of current patch attached to this Bugzilla ? AFAIK, it's in udiff format and I'm able to apply it with a \"patch -p1 < drop_sslv2_support.diff\".\n\n@Rainer Jung: SSLv2 is disabled in IE7, Opera and Firefox since 2006. So one day or another you'll have to drop support for it :)\n\nBest regards,\n-- \nDamien Raude-Morvan", "is_private": false}, {"count": 5, "tags": [], "text": "Created attachment 27300\nDrop SSLv2 support in native examples\n\nTo apply the patch one has to remove those \"a/jni\" and \"b/jni\" prefixes that do not match the svn source layout. There were changes in sslcontext.c recently, so the patch does not apply cleanly anymore.\n\nAnyway,\n1) tc-native is still used on old systems, like Tomcat 5.5, and thus I don't feel comfortable removing this feature.\n\nMaybe consider this for trunk of tc-native or postpone until native 1.2 is more near?\n\nMaybe make this code conditional using some #define, e.g. OpenSSL version?\n\n2) +1 to disable it by default in java code in Tomcat\n\n\nThe patch also updates tc-native examples. I am attaching a part of Damien Raude-Morvan's patch that modifies the examples, against 1.1.x branch of tomcat/native.\n\n\nRegarding the examples:\n* examples/org/apache/tomcat/jni/SSLServer.java:\n OK for the change\n* examples/org/apache/tomcat/jni/SSL.properties:\n -1:\n First, if I understand the old value correctly, it enables \"ALL\" ciphers, then shifts SSLv2 to the end of the list by priority. Removing SSLv2 moves it to the front of the list and that is wrong. To disable it, one can write !SSLv2\n\n Second, the old value matches whatever default is in Apache HTTPD 2.2, see\n\nhttp://httpd.apache.org/docs/2.2/mod/mod_ssl.html#sslciphersuite\n\nApache HTTPD 2.3 docs say that default depends on OpenSSL version, without providing further specifics. I do not see the value in the code - I think it comes from OpenSSL.\n\nOpenSSL docs say that the default value is DEFAULT and it is determined at compile time.\n\n http://www.openssl.org/docs/apps/ciphers.html#CIPHER_STRINGS\n\nApparently for OpenSSL 1.0.0 the correct value to be used as default will be literally \"DEFAULT\".\n\nThe above mentioned OpenSSL docs say that for 1.0.0 the default value is normally \"ALL:!aNULL:!eNULL\". This is not true for the copy of OpenSSL 1.0.0d that I have. The command to list ciphers, \"openssl ciphers -v <cipherslist>\" does not list SSLv2 ciphers for DEFAULT, but does mention one SSLv2 cipher for  \"ALL:!aNULL:!eNULL\".", "attachment_id": 27300, "bug_id": 51056, "id": 148023, "time": "2011-07-19T23:43:25Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-07-19T23:43:25Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 51056, "attachment_id": null, "id": 148052, "creation_time": "2011-07-21T09:58:31Z", "time": "2011-07-21T09:58:31Z", "creator": "jfclere@gmail.com", "text": "Fix by 1149093 (native) and 1149092 (tc_trunk).\nThe fix doesn't remove SSLv2 it just removes it from the defaults.", "is_private": false}, {"count": 7, "tags": [], "bug_id": 51056, "attachment_id": null, "id": 148596, "creation_time": "2011-08-12T18:00:50Z", "time": "2011-08-12T18:00:50Z", "creator": "drazzib@drazzib.com", "text": "I've updated my patch :\n- for 1.1.22 release\n- to use OPENSSL_NO_SSL2 define instead of dropping code", "is_private": false}, {"text": "Created attachment 27383\nDrop SSLv2 support", "tags": [], "bug_id": 51056, "is_private": false, "count": 8, "id": 148597, "time": "2011-08-12T18:01:40Z", "creator": "drazzib@drazzib.com", "creation_time": "2011-08-12T18:01:40Z", "attachment_id": 27383}]
[{"count": 0, "tags": [], "bug_id": 51955, "text": "Created attachment 27690\nSample xlsx file to demonstrate the bug\n\nI am trying to get the themes table for XLSX files using the XSSFReader event model API (3.8-beta4). Unfortunately the getStylesTable() call of the XSSFReader class always returns a StylesTable with a null theme. Please see the following code and the attached xlsx file that demonstrate this problem. \n\nOn the other hand, using the user model XSSFWorkbook API I am able to get the themes table and the RGB values correctly. So I suspect this is a bug of the getStylesTable() method.\n\n\npackage org.apache.poi.ss.examples;\n\nimport java.io.FileInputStream;\n\nimport org.apache.poi.xssf.eventusermodel.XSSFReader;\nimport org.apache.poi.xssf.model.StylesTable;\nimport org.apache.poi.xssf.model.ThemesTable;\nimport org.apache.poi.xssf.usermodel.XSSFCellStyle;\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\nimport org.apache.poi.openxml4j.opc.OPCPackage;\n\npublic class TestTheme {\n\t\n    public void processEventModel(String filename) throws Exception {\n    \tOPCPackage pkg = OPCPackage.open(filename);\n    \tXSSFReader r = new XSSFReader( pkg );\n    \tStylesTable st = r.getStylesTable();\n    \tThemesTable ttable = st.getTheme();\n    \tSystem.out.println(ttable);\n\t\n    \tXSSFCellStyle cs = st.getStyleAt(1);\n    \tSystem.out.println(cs.getFillForegroundColorColor().getARGBHex());\n    }\n\n    public void processUserModel(String filename) throws Exception {\n       \tOPCPackage pkg = OPCPackage.open(filename);\n        XSSFWorkbook wb = new XSSFWorkbook(pkg);\n        StylesTable st = wb.getStylesSource(); \n    \tThemesTable ttable = st.getTheme();\n\n    \tSystem.out.println(ttable);\n    \tXSSFCellStyle cs = st.getStyleAt(1);\n    \tSystem.out.println(cs.getFillForegroundColorColor().getARGBHex());\n    }\n    \n    public static void main(String[] args) throws Exception {\n    \tTestTheme tt = new TestTheme();\n    \tSystem.out.println(\"Getting ThemesTable using Event Model\");\n    \ttt.processEventModel(args[0]);\n    \tSystem.out.println(\"Getting ThemesTable using User Model\");\n    \ttt.processUserModel(args[0]);\n    }\n}", "id": 150147, "time": "2011-10-04T20:41:49Z", "creator": "jxz164@hotmail.com", "creation_time": "2011-10-04T20:41:49Z", "is_private": false, "attachment_id": 27690}, {"count": 1, "attachment_id": null, "creator": "apache@gagravarr.org", "text": "Themes live in a different package part to the styles, but they're linked. I suspect that the xssf reader isn't doing the setup that xssf usermodel does to wire the two together\n\nIf you have a minute, take a look at how usermodel does the themes bit, then work up a patch to have the reader do the same. That'll be much quicker than waiting for someone to have time to look at it!\n\nAlso, any chance you could turn your sample program into a (currently failing) unit test, so when fixed we can ensure it stays fixed?", "id": 150150, "time": "2011-10-04T21:03:20Z", "bug_id": 51955, "creation_time": "2011-10-04T21:03:20Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "jxz164@hotmail.com", "attachment_id": null, "is_private": false, "id": 150210, "time": "2011-10-05T20:05:06Z", "bug_id": 51955, "creation_time": "2011-10-05T20:05:06Z", "text": "Thanks, Nick. Now I know how to fix my problem. It looks like we need to add a getThemesTable method to the XSSFReader class. The method returns a ThemesTable type. Then I can call setTheme() for the styles table. \n\nThe getThemesTable() method can be copied from getStylesTable() with a slight change. I will see if I can create a patch later.\n\n    public ThemesTable getThemesTable() throws IOException, InvalidFormatException {\n        ArrayList<PackagePart> parts = pkg.getPartsByContentType( XSSFRelation.THEME.getContentType());\n        return parts.size() == 0 ? null : new ThemesTable(parts.get(0), null);\n    }"}, {"count": 3, "attachment_id": null, "creator": "apache@gagravarr.org", "text": "Ah, it really is that simple, isn't it\n\nShould be fixed in r1179440 - I've got the getStylesTable method to find the themes part and supply it if available", "id": 150216, "time": "2011-10-05T21:05:25Z", "bug_id": 51955, "creation_time": "2011-10-05T21:05:25Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 28715, "text": "In our app we need to assign cookie values using User Parameters. However, \nright now, variable expansion does not work in HTTP Cookie Manager.", "id": 56701, "time": "2004-04-30T14:51:37Z", "creator": "vibhtech@yahoo.com", "creation_time": "2004-04-30T14:51:37Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 28715, "is_private": false, "id": 56797, "time": "2004-05-04T12:36:48Z", "creator": "sebb@apache.org", "creation_time": "2004-05-04T12:36:48Z", "tags": [], "text": "Could you attach a simple test case that shows the problem, please?"}, {"count": 2, "tags": [], "bug_id": 28715, "is_private": false, "text": "Created attachment 11589\nsimple test plan", "id": 57604, "time": "2004-05-18T11:53:49Z", "creator": "rino@student.dei.uc.pt", "creation_time": "2004-05-18T11:53:49Z", "attachment_id": 11589}, {"count": 3, "attachment_id": null, "bug_id": 28715, "is_private": false, "id": 57605, "time": "2004-05-18T11:56:11Z", "creator": "rino@student.dei.uc.pt", "creation_time": "2004-05-18T11:56:11Z", "tags": [], "text": "I'm having the same problem, although I'm using the \"User Defined Variables\" \ndefined in the \"Test Plan\". In the file I attached, I set a \"domain\" variable, \nand I try to use it for the cookie domain. Won't work :("}, {"count": 4, "tags": [], "creator": "admin@seattle-chat.com", "text": "We are also seeing this bug, with user variables and built in variables like \n${_StringFromFile(file-path)}.  We need to change a value in the cookie to \nabout a hundred different combonations.  BTW keep up the good work, I really \nlike what I have seen so far, in fact better than loadrunner.", "id": 57847, "time": "2004-05-21T17:30:00Z", "bug_id": 28715, "creation_time": "2004-05-21T17:30:00Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 28715, "is_private": false, "count": 5, "id": 57898, "time": "2004-05-22T09:02:11Z", "creator": "sebb@apache.org", "creation_time": "2004-05-22T09:02:11Z", "text": "[Thanks for the sample]\n\nI've had a quick look at the code, and the Cookie Manager stores its values in \na slightly different way from (most) other test elements - the result is that \nit treats them as fixed strings, and does not try to interpret them as \nfunctions/variables."}, {"count": 6, "tags": [], "creator": "theshaman@laposte.net", "text": "I just want to say I also face with this limitation (not possible to add\npersonalized cookies to each user threads, using user variables or other means)\nof JMeter. I think it could be a very useful enhancement of JMeter.\nNevertheless congratulations and thanks for your work.", "id": 69151, "time": "2005-01-03T15:27:45Z", "bug_id": 28715, "creation_time": "2005-01-03T15:27:45Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": 16640, "bug_id": 28715, "is_private": false, "id": 80968, "time": "2005-10-10T21:46:25Z", "creator": "apache@thecoopers.ws", "creation_time": "2005-10-10T21:46:25Z", "tags": [], "text": "Created attachment 16640\nFix to allow expansion of functions and user parameters in the CookieManager\n\nThis patch allows the expansion of UserParameters and Function calls in the\nCookie Manager.  It does so by no longer overriding the setRunningVersion and\nrecoverRunningVersion methods.\nAs a result of no longer overriding these, I had to create some way to\naccurately reset cookies for each iteration.  So I introduced a variable\n\"temporaryCookies\" which gets populated with the cookie name of any cookie to\nremove - any cookie added while isRunningVersion is set to true."}, {"count": 8, "tags": [], "bug_id": 28715, "is_private": false, "text": "Oh yeah - forgot to mention.  The patch I just uploaded is against the following\nversion:\n[coop@cstephen jakarta-jmeter]$ cvs status\nsrc/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java\n===================================================================\nFile: CookieManager.java        Status: Locally Modified\n\n   Working revision:    1.40\n   Repository revision: 1.40   \n/home/cvspublic/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java,v\n   Sticky Tag:          v2_1_1 (revision: 1.40)\n   Sticky Date:         (none)\n   Sticky Options:      (none)\n", "id": 80969, "time": "2005-10-10T21:48:39Z", "creator": "apache@thecoopers.ws", "creation_time": "2005-10-10T21:48:39Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 28715, "is_private": false, "count": 9, "id": 100548, "time": "2007-03-18T10:35:25Z", "creator": "alf@i100.no", "creation_time": "2007-03-18T10:35:25Z", "text": "I have been briefly looking at this.\n\nThe following short patch seems to make it possible to use functions and user\nparameters in the CookieManager.\n\nIndex: C:/Documents and\nSettings/alf/workspace/Jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java\n===================================================================\n--- C:/Documents and\nSettings/alf/workspace/Jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java\n(revision 519613)\n+++ C:/Documents and\nSettings/alf/workspace/Jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java\n(working copy)\n@@ -290,7 +290,10 @@\n         int i=0;\n         for (PropertyIterator iter = getCookies().iterator(); iter.hasNext();) {\n             Cookie jmcookie = (Cookie) iter.next().getObjectValue();\n+            // Set to running version, to allow function evaluation for the\ncookie values\n+            jmcookie.setRunningVersion(true);\n             cookies[i++] = makeCookie(jmcookie);\n+            jmcookie.setRunningVersion(false);\n         }\n         String host = url.getHost();\n         String protocol = url.getProtocol();\n\n\nHowever, I'm not sure this is the correct way of fixing this.\nI have not looked much at the CookieManager code.\nAre there threading issues involved ? I.e. can different threads be accessing\nthe cookies at the same time ? In that case, the different threads can set and\nunset the running version.\nOr do each thread have it's own instance of the CookieManager and all other\nConfigTestElement ?\nIf each thread have their own CookieManager, I think the simple patch above is\ncorrect.\n\nDo we want to only allow variable expansion in the static cookies, and not in\nthe runtime cookies received during sampling ?\n\nPerhaps Stephen Cooper's patch from 2005-10-10 looks better, but the code seems\nto have changed a bit since his suggestion.\n\nCould we just call \"setRunningVersion(false); setRunningVersion(false);\" on each\ncookie as the first thing to do in \"testIterationStart\" ?\nOr will we get threading issues here as well ?\n\nAnd also call \"setRunningVersion(false);\" on each cookie on \"testEnded\" ?\nPerhaps that is not needed, as it seems like the GUI recreates all the cookies\n\"static cookies\" when you go to the CookieManager GUI. I'm at least unable to\nfigure out when all the dynamic cookies are deleted, but I never see them in the\nGUI.\n\nOr should we add a flag to the Cookie class, so we know which ones are static\nand which ones are dynamic, and then loop over all the static ones in\nthe following methods in CookieManager :\npublic void recoverRunningVersion() \npublic void setRunningVersion\n\nI'm sorry for all the questions, but this bug seems like an \"easy\" one to fix,\nand quite important.\n\nAny comments ?"}, {"count": 10, "tags": [], "bug_id": 28715, "text": "Code has been added to Cookie Manager in SVN r571789.\n\nJust in case it causes a problem, one can set the property:\n\nCookieManager.allow_variable_cookies=false \n\nto disable the fix.\n", "id": 107583, "time": "2007-09-01T05:42:15Z", "creator": "sebb@apache.org", "creation_time": "2007-09-01T05:42:15Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "hi \nI am not sure whether I have got correct configuration of Jmeter, but I do see user parameter is not work in cookie manager. I got this problem both Jmeter 2.4 and Jmeter 2.5.1\nreproduce step:\n1. Create http request to access a website\n2. Create a regular expression extractor to get a SessionID value as SessID variable\n3. Create a HTTP Cookie Manager to reference SessID(${SessID})\n\nresult: $SessID is treated as a string not a variable\n        (but this variable works in http sampler.) \n\nexpected: $SessID is treated as a variable", "is_private": false, "id": 150748, "creator": "horacexu1982@gmail.com", "time": "2011-10-19T09:32:52Z", "bug_id": 28715, "creation_time": "2011-10-19T09:32:52Z", "attachment_id": null}, {"count": 12, "attachment_id": null, "bug_id": 28715, "is_private": false, "id": 150755, "time": "2011-10-19T11:31:16Z", "creator": "sebb@apache.org", "creation_time": "2011-10-19T11:31:16Z", "tags": [], "text": "(In reply to comment #11)\n> hi \n> I am not sure whether I have got correct configuration of Jmeter, but I do see\n> user parameter is not work in cookie manager. I got this problem both Jmeter\n> 2.4 and Jmeter 2.5.1\n> reproduce step:\n> 1. Create http request to access a website\n> 2. Create a regular expression extractor to get a SessionID value as SessID\n> variable\n> 3. Create a HTTP Cookie Manager to reference SessID(${SessID})\n> \n> result: $SessID is treated as a string not a variable\n>         (but this variable works in http sampler.) \n> \n> expected: $SessID is treated as a variable\n\nWOrks fine for me; note that the Cookie Manager is a configuration element so only resolves variables at the start of a loop."}, {"count": 13, "tags": [], "creator": "horacexu1982@gmail.com", "text": "(In reply to comment #12)\n> (In reply to comment #11)\n> > hi \n> > I am not sure whether I have got correct configuration of Jmeter, but I do see\n> > user parameter is not work in cookie manager. I got this problem both Jmeter\n> > 2.4 and Jmeter 2.5.1\n> > reproduce step:\n> > 1. Create http request to access a website\n> > 2. Create a regular expression extractor to get a SessionID value as SessID\n> > variable\n> > 3. Create a HTTP Cookie Manager to reference SessID(${SessID})\n> > \n> > result: $SessID is treated as a string not a variable\n> >         (but this variable works in http sampler.) \n> > \n> > expected: $SessID is treated as a variable\n> \n> WOrks fine for me; note that the Cookie Manager is a configuration element so\n> only resolves variables at the start of a loop.\n\nThanks.\nI misunderstand user parameter, user parameter works well.\nWhat I want to do is reset cookie value for a http smapler, is there any method can do that in Jmeter?\n\nJimmy", "id": 150778, "attachment_id": null, "bug_id": 28715, "creation_time": "2011-10-20T02:14:08Z", "time": "2011-10-20T02:14:08Z", "is_private": false}, {"count": 14, "attachment_id": null, "bug_id": 28715, "text": "Bugzilla is not a support forum.\n\nPlease subscribe to the JMeter user list and ask there.", "id": 150783, "time": "2011-10-20T07:03:15Z", "creator": "sebb@apache.org", "creation_time": "2011-10-20T07:03:15Z", "tags": [], "is_private": false}]
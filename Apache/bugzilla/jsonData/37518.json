[{"count": 0, "tags": [], "bug_id": 37518, "attachment_id": null, "id": 82539, "time": "2005-11-16T01:35:49Z", "creator": "jack.yu@fmr.com", "creation_time": "2005-11-16T01:35:49Z", "is_private": false, "text": "In 5.5.12, the hasRole method in JAASRealm has been removed. Instead, it uses \nRealmBase's hasRole methd. \n\nIn RealmBase's hasRole method, it the principal is not GenericPrincipal, it \nwill return false.\n\nBut in Request.getUserPrincipal method, there also a change, if userPrincipal \nis GenericPrincipal, it returns userPrincipal. \n\nWhich means the framework use getUserPrincipal, and call JAASRealm(RealmBase)'s \nhasRole should always fail.\n\n\nSuggest to make the following change:\nin JAASRealm.java, add roleSet private instance variable, then in \ncreatePrincipal method, just after roles.add(principal.getName());,\nadd \"roleSet.add(principal);\"\n\nthen add hasRole method like following:\n\npublic boolean hasRole(Principal principal, String role) {\n    if (principal == null) {\n         return false;\n    }\n    Iterator it = roleSet.iterator();\n    while (it.hasNext()) {\n        Principal p = (Principal)it.next();\n        if (p.equals(principal)) {\n            return true;\n        }\n    }\n    return super.hasRole(principal, role);\n}"}, {"count": 1, "tags": [], "bug_id": 37518, "attachment_id": null, "is_private": false, "id": 82540, "time": "2005-11-16T01:38:42Z", "creator": "remm@apache.org", "creation_time": "2005-11-16T01:38:42Z", "text": "\n\n*** This bug has been marked as a duplicate of 37044 ***"}]
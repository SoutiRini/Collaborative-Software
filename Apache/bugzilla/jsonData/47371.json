[{"attachment_id": null, "tags": [], "creator": "wlc1111@126.com", "is_private": false, "count": 0, "id": 127956, "time": "2009-06-16T02:55:55Z", "bug_id": 47371, "creation_time": "2009-06-16T02:55:55Z", "text": "There is a jsp file called test.jsp:\n<%@ page contentType=\"text/html; charset=UTF-8\" %>\n<jsp:directive.page import=\"java.util.Map\"/>\n<jsp:directive.page import=\"java.util.HashMap\"/>\n<%!public class CellAttributes{\n\tprivate String cellValue;\n\n\tpublic CellAttributes(String cellValue) {\n\t\tthis.cellValue = cellValue;\n\t}\n\tpublic String getCellValue() {\n\t\treturn cellValue;\n\t}\n} %>\n<%Map<String,CellAttributes> currentRow = new HashMap<String, CellAttributes>();\n\ncurrentRow.put(\"a\",new CellAttributes(\"\"));\ncurrentRow.put(\"b\",new CellAttributes(\"1\"));\npageContext.setAttribute(\"currentRow\",currentRow);\n\n%>\n<Html>\n<BODY>\n${currentRow['a'].cellValue+currentRow['b'].cellValue}\n</BODY>\n</Html>\n\nthrows exception\uff1a\njava.lang.NumberFormatException: For input string: \"\"\n\tjava.lang.NumberFormatException.forInputString(NumberFormatException.java:48)\n\tjava.lang.Long.parseLong(Long.java:424)\n\tjava.lang.Long.<init>(Long.java:671)\n\torg.apache.el.lang.ELArithmetic$LongDelegate.coerce(ELArithmetic.java:186)\n\torg.apache.el.lang.ELArithmetic.coerce(ELArithmetic.java:357)\n\torg.apache.el.lang.ELArithmetic.add(ELArithmetic.java:235)\n\torg.apache.el.parser.AstPlus.getValue(AstPlus.java:40)\n\torg.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:186)\n\torg.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(PageContextImpl.java:935)\n\torg.apache.jsp.new_jsp._jspService(new_jsp.java:84)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:374)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:267)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\nbut I think it should be \"1\""}, {"count": 1, "tags": [], "bug_id": 47371, "attachment_id": null, "id": 128117, "time": "2009-06-19T15:50:31Z", "creator": "markt@apache.org", "creation_time": "2009-06-19T15:50:31Z", "is_private": false, "text": "Thanks for the test case, it really helps speed up the process of evaluating bugs.\n\n+ is not a String concatenation operator in EL. However, I think this will achieve the result you want:\n${currentRow['a'].cellValue}${currentRow['b'].cellValue}"}, {"count": 2, "tags": [], "bug_id": 47371, "attachment_id": null, "id": 145954, "time": "2011-04-22T10:04:48Z", "creator": "gilles.bardouillet@atosorigin.com", "creation_time": "2011-04-22T10:04:48Z", "is_private": false, "text": "Even without string concatenation, you receive the NumberFormat exception with the following expression : \n\n${4+currentRow['a'].cellValue}\n\nWith ${4+currentRow['b'].cellValue}, the result is OK.\n\nWhy the empty string test is placed after the String instance test inside the method org.apache.el.lang.ELArithmetic.coerce ?"}, {"attachment_id": null, "tags": [], "bug_id": 47371, "is_private": false, "count": 3, "id": 145959, "time": "2011-04-22T11:23:11Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-04-22T11:23:11Z", "text": "Confirming in trunk, both the original issue and the one in Comment 2.\n\nFrom expression_language-2_2-mrel-spec.pdf:\n\nThe '+' operator is defined in chapter 1.7.1. There is the following step there:\nOtherwise coerce both A and B to Long and apply operator\n\nCoercion to Long is covered by chapter 1.18.3.\nIf A is null or \"\", return 0.\n\nThrowing a NumberFormatException for the empty string is a bug."}, {"count": 4, "tags": [], "text": "Created attachment 26928\nPatch for ELArithmetic", "attachment_id": 26928, "id": 145961, "creator": "gilles.bardouillet@atosorigin.com", "time": "2011-04-22T12:30:59Z", "bug_id": 47371, "creation_time": "2011-04-22T12:30:59Z", "is_private": false}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks for the patch. It has been applied (along with a test case) to 7.0.x and will be included in 7.0.13 onwards.\n\nThe patch has also been proposed for 6.0.x.", "id": 146141, "time": "2011-05-05T13:40:56Z", "bug_id": 47371, "creation_time": "2011-05-05T13:40:56Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Drop the severity.", "id": 146209, "time": "2011-05-09T12:47:03Z", "bug_id": 47371, "creation_time": "2011-05-09T12:47:03Z", "is_private": false}, {"text": "Fixed in 6.0.x and will be included in 6.0.33 onwards.", "tags": [], "creator": "markt@apache.org", "attachment_id": null, "count": 7, "id": 146242, "time": "2011-05-10T08:55:49Z", "bug_id": 47371, "creation_time": "2011-05-10T08:55:49Z", "is_private": false}]
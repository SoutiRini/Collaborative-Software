[{"count": 0, "tags": [], "creator": "strozyk@adesso.de", "text": "Using the DailyRollingFileAppender with DatePattern='.'yyyy-ww gives monthly log rotation if the default locale of the JVM is Locale.GERMAN.\n\nExpected is weekly log rotation as documented in JavaDoc.\n\n\nI think the reason for this issue is that in method DailyRollingFileAppender.computeCheckPeriod:\n-the RollingCalendar instance is explicitly constructed with Locale.ENGLISH, which gives SUNDAY as first day of week\n-in the SimpleDateFormat instance, only timezone is set. Therefore, in germany simpleDateFormat uses a Calendar with Locale.GERMAN, which gives MONDAY as first day of week\nThen, rollingCalendar.getNextCheckMillis() returns a Sunday, which belongs to the same week as epoch from SimpleDateFormat's point of view.\n\nI suggest to fix the problem by removing -line and adding +lines as follows:\n\n  int computeCheckPeriod() {\n    RollingCalendar rollingCalendar = new RollingCalendar(gmtTimeZone, Locale.ENGLISH);\n    // set sate to 1970-01-01 00:00:00 GMT\n    Date epoch = new Date(0);\n    if(datePattern != null) {\n      for(int i = TOP_OF_MINUTE; i <= TOP_OF_MONTH; i++) {\n        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(datePattern);\n-       simpleDateFormat.setTimeZone(gmtTimeZone); // do all date formatting in GMT\n+       // do all date formatting in GMT and with ENGLISH locale settings\n+       Calendar formatCal = Calendar.getInstance(gmtTimeZone, Locale.ENGLISH);\n+       simpleDateFormat.setCalendar(formatCal);\n        String r0 = simpleDateFormat.format(epoch);\n        rollingCalendar.setType(i);\n        Date next = new Date(rollingCalendar.getNextCheckMillis(epoch));\n        String r1 =  simpleDateFormat.format(next);\n        //System.out.println(\"Type = \"+i+\", r0 = \"+r0+\", r1 = \"+r1);\n        if(r0 != null && r1 != null && !r0.equals(r1)) {\n          return i;\n        }\n      }\n    }\n    return TOP_OF_TROUBLE; // Deliberately head for trouble...\n  }", "id": 125549, "time": "2009-03-13T08:36:05Z", "bug_id": 46851, "creation_time": "2009-03-13T08:36:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "carnold@apache.org", "is_private": false, "text": "Code fragment appears to predate the patch for 40888.  Believe the suggested change and the 40888 change are incompatibility.  Please reopen (or file a new bug) if the current SVN HEAD does not resolve the issue.\n\n*** This bug has been marked as a duplicate of bug 40888 ***", "id": 131053, "time": "2009-10-10T11:24:26Z", "bug_id": 46851, "creation_time": "2009-10-10T11:24:26Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 26538, "attachment_id": null, "id": 51432, "time": "2004-01-29T22:03:44Z", "creator": "ajb@blyler.cc", "creation_time": "2004-01-29T22:03:44Z", "is_private": false, "text": "I have been chatting with someone on a linux user group about this.  It seems\nthat mod_auth_ldap doesn't like multiple references.  The email thread follows:\n\n\nI am not sure either.  I just set up mod_auth_ldap on the Windows 2000\ndomain and it works like a champ.  :-)  I guess mod_auth_ldap doesn't\nlike how Windows 2003 works with returning the three references.  :-/\n\n- Andy\n\nOn Thu, 2004-01-29 at 16:11, Andrew Libby wrote:\n> I'm unclear about why your directory server is sending\n> references back when the entry has been located and returned\n> to you.  In my dealings with SunOne (iPlanet) and OpenLDAP,\n> I've not seen such a thing.\n> \n> Andy\n> \n> \n> Andrew Blyler wrote:\n> \n> >I just set up a Windows 2000 domain and found that it only returns one\n> >reference.  I didn't test mod_auth_ldap on Windows 2000 just yet, but\n> >below is the results from my ldapsearch.\n> >\n> >[ablyler at laptop ablyler]$ ldapsearch -h domain_controler.domain.com -vx\n> >-D \"ablyler at domain.com\" -b DC=domain,DC=com sAMAccountName=ablyler -W\n> >\n> ># extended LDIF\n> >#\n> ># LDAPv3\n> ># base <DC=domain,DC=com> with scope sub\n> ># filter: sAMAccountName=ablyler\n> ># requesting: ALL\n> >#\n> > \n> ># Andrew Blyler, Users, domain.com\n> >dn: CN=Andrew Blyler,CN=Users,DC=domain,DC=com\n> ># there were a lot of attributes, but I removed them\n> >whenCreated: 20040129194305.0Z\n> > \n> ># search reference\n> >ref: ldap://domain.com/CN=Configuration,DC=domain,DC=com\n> > \n> ># search result\n> >search: 2\n> >result: 0 Success\n> > \n> ># numResponses: 3\n> ># numEntries: 1\n> ># numReferences: 1\n> >\n> >\n> >On Thu, 2004-01-29 at 14:42, Andrew Blyler wrote:\n> >  \n> >\n> >>Okay, it looks like it is returning some references for the forest dns,\n> >>domain dns, and configuration partitions.  I am guessing that\n> >>mod_auth_ldap doesn't like the fact that it is getting some references. \n> >>:-(\n> >>\n> >>Note: in this email and previous emails I refer to the domain as\n> >>domain.com and the dc/ldap server as domain_controler.\n> >>\n> >>ldapsearch -h domain_controler.domain.com -vx -D \"CN=Andrew\n> >>Blyler,OU=SI,OU=Mechanicsburg,DC=domain,DC=com\" -b DC=domain,DC=com\n> >>sAMAccountName=ablyler -W\n> >># extended LDIF\n> >>#\n> >># LDAPv3\n> >># base <DC=domain,DC=com> with scope sub\n> >># filter: sAMAccountName=ablyler\n> >># requesting: ALL\n> >>#\n> >> \n> >># Andrew Blyler, SI, Mechanicsburg, domain.com\n> >>dn: CN=Andrew Blyler,OU=SI,OU=Mechanicsburg,DC=domain,DC=com\n> >># there were a lot of attributes, but I removed them\n> >>msExchMailboxGuid:: z73C+rf14UWMpPR+SkVOjA==\n> >> \n> >># search reference\n> >>ref: ldap://DomainDnsZones.domain.com/DC=DomainDnsZones,DC=domain,DC=com\n> >> \n> >># search reference\n> >>ref: ldap://ForestDnsZones.domain.com/DC=ForestDnsZones,DC=domain,DC=com\n> >> \n> >># search reference\n> >>ref: ldap://domain.Com/CN=Configuration,DC=domain,DC=com\n> >> \n> >># search result\n> >>search: 2\n> >>result: 0 Success\n> >> \n> >># numResponses: 5\n> >># numEntries: 1\n> >># numReferences: 3\n> >>\n> >>\n> >>On Thu, 2004-01-29 at 13:33, Andrew Libby wrote:\n> >>    \n> >>\n> >>>While I can't say for sure, I'll put in a few cents as to what\n> >>>may be happening.\n> >>>\n> >>>The error message in the error.log indicates that the\n> >>>client (Apache) got a referral from Active Directory.\n> >>>Referral responses are provided to LDAP clients when\n> >>>the DSA (LDAP server) does not have the base indicated\n> >>>in the search, or if the request is a modification request\n> >>>and the client is a replica.  If the replica case applies,\n> >>>the referral will suggest the authoratative server to which\n> >>>the client should issue the modification.  My hunch is that\n> >>>this is not what is happening here.\n> >>>\n> >>>The other case is when the DSA does not provide service for the\n> >>>base dn specified in the search.  Looking at the configuration\n> >>>snippit you supplied, you're LDAP server is domain_controler.domain.com.\n> >>>Is this valid?  It seems so since you're getting a referral back\n> >>>but I thought I'd ask since it looks a lot like a configuration example\n> >>>which might be posted in documentation.  The base dn you've listed\n> >>>is DC=domain,DC=com.  Does the DSA at domain_controler.domina.com\n> >>>serve this base dn?  If not then we've got the problem.\n> >>>\n> >>>To try to verify what's going on you could try some comand line searches \n> >>>from\n> >>>another host (provided AD will respond to incomming LDAP search requests\n> >>>from another host). \n> >>>\n> >>>For example try:\n> >>>\n> >>>ldapsearch -LLLxh domain_controler.domaiin.com -b DC=domain,DC=com \n> >>>objectclass=\\*\n> >>>\n> >>>This should give you lotts of entries.  Usually usernames are stored \n> >>>keyd based\n> >>>on cn or uid attributes.  You could try searching for cn=username or \n> >>>uid=username\n> >>>in place of objectclass=\\*.  Replace 'username' with the username of a \n> >>>user you're\n> >>>attempting to authenticate with.\n> >>>\n> >>>Depending on what vendor and version of ldapsearch you use, you may need \n> >>>to drop\n> >>>the -x, or -LLL from the command line for it to work.  Depending on the \n> >>>version of\n> >>>the libraries which Apache is linked with, and depending on how the auth \n> >>>module is\n> >>>implemented, it may flat out not follow referrals.  My guess is that you \n> >>>don't\n> >>>really want to follow referrals, you want to find out why you're getting \n> >>>a referral\n> >>>and fix the issue.  The base dn is my bet. \n> >>>\n> >>>Andy\n> >>>\n> >>>Andrew Blyler wrote:\n> >>>\n> >>>      \n> >>>\n> >>>>I know I am running this on Windows, but I thought someone might have\n> >>>>some in sight on the issue.\n> >>>>\n> >>>>When tring to use Apache 2.0.48 on Windows 2003 to authenticate users\n> >>>>in a Windows 2003 Active Directory LDAP server I get the following:\n> >>>>\n> >>>>error.log\n> >>>>[Thu Jan 29 12:26:24 2004] [warn] [client 10.4.2.111] [4608] auth_ldap\n> >>>>authenticate: user ablyler authentication failed; URI /test/index.html\n> >>>>[ldap_search_ext_s() for user failed][Referral]\n> >>>>\n> >>>>The following is a section of the config:\n> >>>>\n> >>>>httpd.conf\n> >>>><Directory />\n> >>>>   Options FollowSymLinks\n> >>>>   AllowOverride None\n> >>>>\n> >>>>   # LDAP Authentication & Authorization is final; do not check other\n> >>>>databases\n> >>>>   AuthLDAPAuthoritative on\n> >>>>\n> >>>>   # Do basic password authentication in the clear\n> >>>>   AuthType Basic\n> >>>>\n> >>>>   # The name of the protected area or \"realm\"\n> >>>>   AuthName \"Test Realm\"\n> >>>>\n> >>>>   # Active Directory requires an authenticating DN to access records\n> >>>>   AuthLDAPBindDN CN=service_account,DC=domain,DC=com\n> >>>>\n> >>>>   # This is the password for the AuthLDAPBindDN user in Active\n> >>>>Directory\n> >>>>   AuthLDAPBindPassword service_account_password\n> >>>>\n> >>>>   # The LDAP query URL\n> >>>>   AuthLDAPURL\n>\n>>>>\"ldaps://domain_controler.domain.com/DC=domain,DC=com?sAMAccountName?sub?(objectClass=*)\"\n> >>>></Directory>\n> >>>>\n> >>>><Directory \"C:/Program Files/Apache Group/Apache2/htdocs/test\">\n> >>>>  AuthName \"Special User Area\"\n> >>>>  require valid-user\n> >>>></Directory>\n> >>>>\n> >>>>Does anyone have any ideas of what is going on?\n> >>>>\n> >>>>Thanks,\n> >>>>Andy Blyler"}, {"count": 1, "tags": [], "bug_id": 26538, "attachment_id": null, "id": 51447, "time": "2004-01-30T01:12:20Z", "creator": "ajb@blyler.cc", "creation_time": "2004-01-30T01:12:20Z", "is_private": false, "text": "Just a side note: mod_auth_ldap works great with ADAM (Active Direction\nApplication Mode).  :-)"}, {"count": 2, "tags": [], "text": "It looks like the Microsoft LDAP SDK does not follow referrals by default. Maybe\nadding an option to follow referrals would fix this problem.\n", "attachment_id": null, "id": 57768, "creator": "minfrin@sharp.fm", "time": "2004-05-21T01:46:11Z", "bug_id": 26538, "creation_time": "2004-05-21T01:46:11Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 26538, "is_private": false, "text": "Is this problem still present or can I close this?\n", "id": 65246, "time": "2004-10-17T18:24:44Z", "creator": "minfrin@apache.org", "creation_time": "2004-10-17T18:24:44Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "It is working great for me now.  Thanks for fixing this.", "is_private": false, "id": 65529, "creator": "ajb@blyler.cc", "time": "2004-10-22T19:04:45Z", "bug_id": 26538, "creation_time": "2004-10-22T19:04:45Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 26538, "is_private": false, "id": 73031, "attachment_id": null, "creator": "fugit13@gmail.com", "creation_time": "2005-03-30T00:10:02Z", "time": "2005-03-30T00:10:02Z", "text": "I had this problem and after looking into it further, it turned out we had a\nnon-standard instalation of AD. With all users broken up into there own OU's. I\nhad to put the OU into the AuthLDAPURL \n\nThis failed\nAuthLDAPURL ldap://foo.xx.bar.com:389/DC=xx,DC=bar,DC=com?sAMAccountName?sub\n\nThis worked:\nAuthLDAPURL\nldap://foo.xx.bar.com:389/OU=Systems,DC=xx,DC=bar,DC=com?sAMAccountName?sub\n\nHope this helps for anyone else that has this problem. \n\nThanks, \nFugit"}, {"count": 6, "tags": [], "bug_id": 26538, "is_private": false, "text": "This bug still exists.  People below have simply changed their LDAP search path\nso that they no longer see the referrals.\n\nEssentially if your AuthLDAPURL is:\nldap://<IP_ADDRESS/HOSTNAME>/dc=<DOMAIN>,dc=com,dc=au?sAMAccountName\n\nYour search will return three references:\neg:\n-----------------\n# search reference\nref:\nldap://ForestDnsZones.<DOMAIN>.com.au/DC=ForestDnsZones,DC=<DOMAIN>,DC=com,DC=au\n\n# search reference\nref:\nldap://DomainDnsZones.<DOMAIN>.com.au/DC=DomainDnsZones,DC=<DOMAIN>,DC=com,DC=au\n\n# search reference\nref: ldap://<DOMAIN>.com.au/CN=Configuration,DC=<DOMAIN>,DC=com,DC=au\n# search result\nsearch: 2\nresult: 0 Success\n\n# numResponses: 5\n# numEntries: 1\n# numReferences: 3\n-------------\n\nauth_ldap will attempt to contact these references to perform a search.\n\nFrom my research OpenLDAP will attempt an anonymous bind to these referrals, it\nwill not use the BindDN (Active Directory doesn't allow anonymous binds)\n\nSo looking up these referrals will always fail.\n\nMost of the time this can be worked around by changing the AuthLDAPURL to start\nsearching deeper down in the tree, thereby avoiding the referrals.\neg: \ncn=Users,dc=<DOMAIN>,dc=com\nOR\nou=something,dc=<DOMAIN>,dc=com\n\nUnfortunately however, when you need to search two OUs, eg:\nou=A,dc=<DOMAIN>,dc=com  AND ou=B,dc=<DOMAIN>,dc=com\n\nyou have no choice but to start search at the top of the tree.\n\nSuggested fixes:\n\n1.) Allow multiple AuthLDAPURL directives, which will be searched in turn.\n\n2.) Add a directive to disable following referrals.  By default ldap_init() (In\nthe OpenLDAP library) sets LDAP_OPT_REFERRALS (follow referrals).", "id": 86633, "time": "2006-03-09T08:42:55Z", "creator": "Jeffrey.Grace+bugzilla@gmail.com", "creation_time": "2006-03-09T08:42:55Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 26538, "is_private": false, "text": "Is this bug fixed?\nI have the same symptoms as my directory is partition according to my business \nmodel like finance, hr, etc..  This is best practices to partition your \ndirectory and wonder why this bug is still there. My auth_ldap generate the \nsame attempt to conect to the like \nldap://DomainDnsZones.<DOMAIN>.com.au/DC=DomainDnsZones,DC=<DOMAIN>,DC=com,DC=a\nu when looking at the packet over the network.\n\nYou are the only reference to this bug that I saw on the net and welcome your \ninput.  You mention to use multiple AuthLDAPURL directives to workaround but \nit is not clear.  Do I write multiple AuthLDAPURL statement in a row in the \nconfig file or I separate the search criteria over the same line?\nIf you had tested this proposed workaround, I would appreciate an example.\nIf you know if there a release of the auth_ldap module with a fix, I would \nappreciate a reference to it.\n\nThanks in advance for your time.\n\n\n\n(In reply to comment #6)\n> This bug still exists.  People below have simply changed their LDAP search \npath\n> so that they no longer see the referrals.\n> Essentially if your AuthLDAPURL is:\n> ldap://<IP_ADDRESS/HOSTNAME>/dc=<DOMAIN>,dc=com,dc=au?sAMAccountName\n> Your search will return three references:\n> eg:\n> -----------------\n> # search reference\n> ref:\n> \nldap://ForestDnsZones.<DOMAIN>.com.au/DC=ForestDnsZones,DC=<DOMAIN>,DC=com,DC=a\nu\n> # search reference\n> ref:\n> \nldap://DomainDnsZones.<DOMAIN>.com.au/DC=DomainDnsZones,DC=<DOMAIN>,DC=com,DC=a\nu\n> # search reference\n> ref: ldap://<DOMAIN>.com.au/CN=Configuration,DC=<DOMAIN>,DC=com,DC=au\n> # search result\n> search: 2\n> result: 0 Success\n> # numResponses: 5\n> # numEntries: 1\n> # numReferences: 3\n> -------------\n> auth_ldap will attempt to contact these references to perform a search.\n> From my research OpenLDAP will attempt an anonymous bind to these referrals, \nit\n> will not use the BindDN (Active Directory doesn't allow anonymous binds)\n> So looking up these referrals will always fail.\n> Most of the time this can be worked around by changing the AuthLDAPURL to \nstart\n> searching deeper down in the tree, thereby avoiding the referrals.\n> eg: \n> cn=Users,dc=<DOMAIN>,dc=com\n> OR\n> ou=something,dc=<DOMAIN>,dc=com\n> Unfortunately however, when you need to search two OUs, eg:\n> ou=A,dc=<DOMAIN>,dc=com  AND ou=B,dc=<DOMAIN>,dc=com\n> you have no choice but to start search at the top of the tree.\n> Suggested fixes:\n> 1.) Allow multiple AuthLDAPURL directives, which will be searched in turn.\n> 2.) Add a directive to disable following referrals.  By default ldap_init() \n(In\n> the OpenLDAP library) sets LDAP_OPT_REFERRALS (follow referrals).\n\n", "id": 86915, "time": "2006-03-16T14:00:18Z", "creator": "carlhalle@hotmail.com", "creation_time": "2006-03-16T14:00:18Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "webmaster042@gmail.com", "attachment_id": null, "id": 87380, "time": "2006-03-29T08:21:35Z", "bug_id": 26538, "creation_time": "2006-03-29T08:21:35Z", "is_private": false, "text": "i think there is an workaround for the problem.\n\nAuthLDAPURL ldap://<IP_ADDRESS/HOSTNAME>:3268/dc=<DOMAIN>,dc=com,dc=au?\nsAMAccountName\n\nPort 3268 is the global catalog which doesen't return references.\n\nHow to create or move a Global Catalog in Windows 2000 (the same for 2003)\nhttp://support.microsoft.com/kb/313994/en-us\n\n\n\n\n(In reply to comment #7)\n> Is this bug fixed?\n> I have the same symptoms as my directory is partition according to my \nbusiness \n> model like finance, hr, etc..  This is best practices to partition your \n> directory and wonder why this bug is still there. My auth_ldap generate the \n> same attempt to conect to the like \n> \nldap://DomainDnsZones.<DOMAIN>.com.au/DC=DomainDnsZones,DC=<DOMAIN>,DC=com,DC=a\n> u when looking at the packet over the network.\n> You are the only reference to this bug that I saw on the net and welcome your \n> input.  You mention to use multiple AuthLDAPURL directives to workaround but \n> it is not clear.  Do I write multiple AuthLDAPURL statement in a row in the \n> config file or I separate the search criteria over the same line?\n> If you had tested this proposed workaround, I would appreciate an example.\n> If you know if there a release of the auth_ldap module with a fix, I would \n> appreciate a reference to it.\n> Thanks in advance for your time.\n> (In reply to comment #6)\n> > This bug still exists.  People below have simply changed their LDAP search \n> path\n> > so that they no longer see the referrals.\n> > Essentially if your AuthLDAPURL is:\n> > ldap://<IP_ADDRESS/HOSTNAME>/dc=<DOMAIN>,dc=com,dc=au?sAMAccountName\n> > Your search will return three references:\n> > eg:\n> > -----------------\n> > # search reference\n> > ref:\n> > \n> \nldap://ForestDnsZones.<DOMAIN>.com.au/DC=ForestDnsZones,DC=<DOMAIN>,DC=com,DC=a\n> u\n> > # search reference\n> > ref:\n> > \n> \nldap://DomainDnsZones.<DOMAIN>.com.au/DC=DomainDnsZones,DC=<DOMAIN>,DC=com,DC=a\n> u\n> > # search reference\n> > ref: ldap://<DOMAIN>.com.au/CN=Configuration,DC=<DOMAIN>,DC=com,DC=au\n> > # search result\n> > search: 2\n> > result: 0 Success\n> > # numResponses: 5\n> > # numEntries: 1\n> > # numReferences: 3\n> > -------------\n> > auth_ldap will attempt to contact these references to perform a search.\n> > From my research OpenLDAP will attempt an anonymous bind to these \nreferrals, \n> it\n> > will not use the BindDN (Active Directory doesn't allow anonymous binds)\n> > So looking up these referrals will always fail.\n> > Most of the time this can be worked around by changing the AuthLDAPURL to \n> start\n> > searching deeper down in the tree, thereby avoiding the referrals.\n> > eg: \n> > cn=Users,dc=<DOMAIN>,dc=com\n> > OR\n> > ou=something,dc=<DOMAIN>,dc=com\n> > Unfortunately however, when you need to search two OUs, eg:\n> > ou=A,dc=<DOMAIN>,dc=com  AND ou=B,dc=<DOMAIN>,dc=com\n> > you have no choice but to start search at the top of the tree.\n> > Suggested fixes:\n> > 1.) Allow multiple AuthLDAPURL directives, which will be searched in turn.\n> > 2.) Add a directive to disable following referrals.  By default ldap_init() \n> (In\n> > the OpenLDAP library) sets LDAP_OPT_REFERRALS (follow referrals).\n\n"}, {"count": 9, "tags": [], "bug_id": 26538, "is_private": false, "text": "If I add the following lines to util_ldap.c right after the \"ldap_set_option(\n...LDAP_OPT_DEREF...);\" line in uldap_connection_open() I can authenticate\nagainst Active Directory 2003.\n\n  /* Turn off referrals */\n  ldap_set_option(ldc->ldap, LDAP_OPT_REFERRALS, (void *)LDAP_OPT_OFF);\n\nI have code for 2.2.0 to make this a module option - \"AuthLDAPFollowReferrals\" -\nwhich can be either \"on\" or \"off\" (defaults to on.)  Is this worth putting into\nthe source? ", "id": 87481, "time": "2006-03-31T17:22:37Z", "creator": "aaron@acsiri.com", "creation_time": "2006-03-31T17:22:37Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 26538, "attachment_id": null, "id": 95490, "time": "2006-11-06T11:13:23Z", "creator": "rvandolson@esri.com", "creation_time": "2006-11-06T11:13:23Z", "is_private": false, "text": "(In reply to comment #9)\n> I have code for 2.2.0 to make this a module option - \"AuthLDAPFollowReferrals\" -\n> which can be either \"on\" or \"off\" (defaults to on.)  Is this worth putting into\n> the source? \n\nI think this would be a great addition.  Obviously a fairly simple patch, if you\nupload it here maybe they'd be willing to merge it in?  I'd like to see RH get\nthis into their httpd RPM as well at some point.\n"}, {"count": 11, "tags": [], "text": "I have tested the\n\n/* Turn off referrals */\nldap_set_option(ldc->ldap, LDAP_OPT_REFERRALS, (void *)LDAP_OPT_OFF);\n\nidea on my local Apache, this works fine for me against Windows2003 DC\non port 389 (I know, using the GC on Port 3268 is the better solution in most \ncases.)\n\nI think an  AuthLDAPFollowReferrals can be useful to make this\nbehaviour configureable.", "attachment_id": null, "id": 96012, "creator": "apachebugzilla@grolmsnet.de", "time": "2006-11-20T12:29:14Z", "bug_id": 26538, "creation_time": "2006-11-20T12:29:14Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 26538, "attachment_id": null, "text": "If you're using OpenLDAP you can also disable referral chasing in the OpenLDAP\nconfig file (ldap.conf). Just add the line 'REFERRALS off'.\n\nWe have been using this successfully on SLES 9 with apache 2.0.54 and OpenLDAP\n2.2.27 since our AD server was upgraded to Win2k3.", "id": 96031, "time": "2006-11-21T06:56:16Z", "creator": "lgo@mobsol.be", "creation_time": "2006-11-21T06:56:16Z", "is_private": false}, {"count": 13, "tags": [], "text": "Created attachment 19154\nChanges required to make referrals optional via module configuration\n\nThe .zip file includes an altered mod_authnz_ldap.c and util_ldap.c.  I\ndownloaded the sources (httpd-2.2.3) instead of checking them out so I couldn't\neasily do a diff.\n\nThe included code adds an option - AuthLDAPFollowReferrals - that can be set to\neither on or off (defaults to on.)  I've been using the changed code for a\ncouple weeks now with no problems.\n\nLet me know if I forgot anything.", "attachment_id": 19154, "id": 96033, "creator": "aaron@acsiri.com", "time": "2006-11-21T08:10:50Z", "bug_id": 26538, "creation_time": "2006-11-21T08:10:50Z", "is_private": false}, {"count": 14, "tags": [], "text": "(In reply to comment #12)\n> config file (ldap.conf). Just add the line 'REFERRALS off'.\n\nAh, an easy to use way, too :-)\n\nMaybe the best idea is to patch the module's documentation, too?\nI suppose many people use (or want to use) Win2003 as LDAP authentication backend.\nSo I think some \"Windows2003 notes\" in mod_auth_ldap documentation \n(hints to port 3268, ldap.conf an *why* there is an AuthLDAPFollowReferrals\ndirective ) are very useful.", "is_private": false, "id": 96047, "creator": "apachebugzilla@grolmsnet.de", "time": "2006-11-21T13:52:33Z", "bug_id": 26538, "creation_time": "2006-11-21T13:52:33Z", "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 26538, "attachment_id": null, "is_private": false, "id": 102394, "time": "2007-04-25T11:39:30Z", "creator": "aaron@acsiri.com", "creation_time": "2007-04-25T11:39:30Z", "text": "Is there any chance of getting the patch into the code?  Who do we have to\nbother to get the patch included?"}, {"count": 16, "attachment_id": null, "bug_id": 26538, "is_private": false, "id": 102395, "time": "2007-04-25T12:30:46Z", "creator": "wrowe@apache.org", "creation_time": "2007-04-25T12:30:46Z", "tags": [], "text": "First - this thread contains a fount of wisdom on ldap config for win32,\nplease note we now have a user-modifiable wiki community resource:\n\n  http://wiki.apache.org/httpd/\n\nif anyone has the time and gumption to turn all of these ideas into a win32\nLDAP/AD cookbook.\n\nAbout the patch...\n\nI suggest you reattach your file as a patch (using diff or svn diff against\nhttpd-2.2) in plain text instead of a zip file.  Adding binary attachments\nto a bug means the developers with limited time end up spending that time on\nevery bug with text patches that are easily identifed, and unfortunately ignore \nthose that aren't viewable for consideration.\n\nIf I had free time I'd help you by whipping up that diff, but unfortunately\nmy time is -very- limited over the next weeks, I'll apply well thought out\npatches but can't spend cycles right now to create your diffs for you.\n\n"}, {"count": 17, "tags": [], "text": "Are patches against 2.2.x good enough or do I have to create patches against\n2.3.x as well?", "attachment_id": null, "id": 102399, "creator": "aaron@acsiri.com", "time": "2007-04-25T13:17:59Z", "bug_id": 26538, "creation_time": "2007-04-25T13:17:59Z", "is_private": false}, {"count": 18, "attachment_id": null, "creator": "rpluem@apache.org", "text": "(In reply to comment #17)\n> Are patches against 2.2.x good enough or do I have to create patches against\n> 2.3.x as well?\n\nPlease create patches against trunk (aka 2.3) as all changes need to go to trunk\nfirst. If you want to help backporting later once the patch is accepted for\ntrunk this is fine and you can add patches for 2.2.x then.", "id": 102400, "time": "2007-04-25T13:24:34Z", "bug_id": 26538, "creation_time": "2007-04-25T13:24:34Z", "tags": [], "is_private": false}, {"count": 19, "tags": [], "bug_id": 26538, "is_private": false, "text": "Patches against any recent point in 2.2 or trunk would be just fine!\n\nA patch against 2.0 would also be considered for 'backport' - because of the\nmodule changes in ldap I'm speculating the backport to 2.0 is non-trivial.\nBut I could be off base.", "id": 102401, "time": "2007-04-25T13:27:35Z", "creator": "wrowe@apache.org", "creation_time": "2007-04-25T13:27:35Z", "attachment_id": null}, {"count": 20, "tags": [], "text": "Created attachment 20053\nA code patch to add support for turning on and off referral following\n\nThis code patches 2.3.x (trunk).  It adds an AuthLDAPFollowReferrals\nconfiguration option that controls referral following.", "attachment_id": 20053, "id": 102486, "creator": "aaron@acsiri.com", "time": "2007-04-26T07:54:09Z", "bug_id": 26538, "creation_time": "2007-04-26T07:54:09Z", "is_private": false}, {"count": 21, "tags": [], "text": "I believe this is a partial fix for a bigger problem. MSAD 2003 stopped\naccepting anonymous binds. This means that with other LDAP servers you can chase\nreferrals using anonymous binds and never know the difference. MSAD 2003\nrequired that referral chasers provide credentials via the rebind callback.\n\nYou can get around this by turning off referrals (so it doesn't try to chase\nreferrals and then fail), and use the global catalog (thus no referrals). As I\nunderstand it, this is a workaround with some downsides (possible performance\nand accuracy issues).\n\nThe alternative it to chase referrals and provide a rebind callback function. I\nwill be attaching a patch providing this support shortly.", "is_private": false, "id": 105345, "creator": "rederpj@remulak.net", "time": "2007-07-12T12:52:48Z", "bug_id": 26538, "creation_time": "2007-07-12T12:52:48Z", "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 26538, "is_private": false, "text": "Another potential workaround is to access the AD service via an intermdiate \nADAM server:\n\nhttp://www.microsoft.com/downloads/details.aspx?familyid=9688f8b9-1034-4ef6-a3e5-2a2a57b5c8e4&displaylang=en\n", "id": 105349, "time": "2007-07-12T14:30:53Z", "creator": "covener@gmail.com", "creation_time": "2007-07-12T14:30:53Z", "attachment_id": null}, {"count": 23, "tags": [], "bug_id": 26538, "attachment_id": 20522, "text": "Created attachment 20522\nAPR-util updates to provide rebind callback.\n\nThis patch adds rebind support to APR so that Apache LDAP modules can now chase\nrefrerals on an MSAD 2003 server where anonymous binds are not allowed. MSAD\nuses the rebind callback to obtain bindDN and bindPW credentials for all\nsubsequent referrals. There is an Apache patch that goes with this one.", "id": 105711, "time": "2007-07-17T05:27:02Z", "creator": "rederpj@remulak.net", "creation_time": "2007-07-17T05:27:02Z", "is_private": false}, {"count": 24, "tags": [], "bug_id": 26538, "is_private": false, "text": "Created attachment 20523\nApache updates to provide rebind callback for MSAD 2003 referrals.\n\nThis patch adds rebind support to Apache so that Apache LDAP modules can now\nchase refrerals on an MSAD 2003 server where anonymous binds are not allowed.\nMSAD uses the rebind callback to obtain bindDN and bindPW credentials for all\nsubsequent referrals. There is an APR-util patch that goes with this one.", "id": 105712, "time": "2007-07-17T05:29:23Z", "creator": "rederpj@remulak.net", "creation_time": "2007-07-17T05:29:23Z", "attachment_id": 20523}, {"count": 25, "tags": [], "bug_id": 26538, "is_private": false, "id": 111374, "attachment_id": 21222, "creator": "minfrin@sharp.fm", "creation_time": "2007-12-03T09:09:22Z", "time": "2007-12-03T09:09:22Z", "text": "Created attachment 21222\nUpdated patch: fix namespace\n\nLooking at this in more detail.\n\nIt took me a while to figure out exactly what the rebind code was trying to do\n(as opposed to generally knowing what it does), and it seems to be \"an\nimplementation of a callback mechanism able to take advantage of the LDAP\nreferral callback feature\".\n\nOr in other words, use of this particular API is optional, someone using the\nAPR interface may choose to use this particular implementation, or they may\nchoose some other implementation of their own.\n\nBased on this, I think the API should all be in a namespace like\napr_ldap_rebind.\n\nLooking further, unless I am missing something, I think this could probably be\nsignificantly simplified.\n\nIn theory, the apr_ldap_set_rebind_callback() function can be called by\napr_ldap_xref_add(), hiding apr_ldap_set_rebind_callback().\n\nIn theory, there should be a way to register a pool cleanup for\napr_ldap_rebind_remove() as well."}, {"count": 26, "tags": [], "bug_id": 26538, "attachment_id": null, "text": "This has been fixed in httpd trunk. Support for the rebind callback was added so\nthat proper credentials would be returned on a non-anonymous bind while chasing\nreferrals. Two new directives control the use of this feature. LDAPReferrals\n[On|Off] determines if chasing referrals is supported. LDAPReferralHopLimit ##\nspecifies the maximum number of referral rebind hops that will be chased before\ngiving up on the search.", "id": 113087, "time": "2008-01-23T10:24:25Z", "creator": "rederpj@remulak.net", "creation_time": "2008-01-23T10:24:25Z", "is_private": false}, {"count": 27, "tags": [], "text": "Created attachment 21578\nAPR-util updates to provide rebind callback (for apache 2.0.x)\n\nThis patch is a direct backport of the above 20522 patch and code in the 2.2.x\ntrunk for use in httpd-2.0.x. This patch was created against the sources from a\nstock httpd-2.0.63 tarball.", "attachment_id": 21578, "id": 114008, "creator": "salewski@worldnet.att.net", "time": "2008-02-22T02:43:46Z", "bug_id": 26538, "creation_time": "2008-02-22T02:43:46Z", "is_private": false}, {"count": 28, "attachment_id": 21579, "bug_id": 26538, "is_private": false, "id": 114009, "time": "2008-02-22T02:47:55Z", "creator": "salewski@worldnet.att.net", "creation_time": "2008-02-22T02:47:55Z", "tags": [], "text": "Created attachment 21579\nApache updates to provide rebind callback for MSAD 2003 referrals (for apache 2.0.x)\n\nThis patch is a direct backport of the above 20523 patch and code in the 2.2.x\ntrunk for use in httpd-2.0.x. This patch was created against the sources from a\nstock httpd-2.0.63 tarball."}, {"count": 29, "tags": [], "text": "Reopening issue for consideration of the 2.0.x patches just attached.", "attachment_id": null, "id": 114010, "creator": "salewski@worldnet.att.net", "time": "2008-02-22T02:51:57Z", "bug_id": 26538, "creation_time": "2008-02-22T02:51:57Z", "is_private": false}, {"count": 30, "tags": [], "text": "The above 2.0.x patches (21578 and 21579) seem to work fine with a non-threaded\nAPR, but I see deadlock when using them with a threaded APR on an SMP host.", "attachment_id": null, "id": 101326, "creator": "salewski@worldnet.att.net", "time": "2008-02-26T03:40:37Z", "bug_id": 26538, "creation_time": "2008-02-26T03:40:37Z", "is_private": false}, {"count": 31, "tags": [], "bug_id": 26538, "attachment_id": null, "id": 101325, "time": "2008-02-26T03:43:23Z", "creator": "salewski@worldnet.att.net", "creation_time": "2008-02-26T03:43:23Z", "is_private": false, "text": "I should have mentioned in my previous comment that the APR used in my tests is\n0.9.17"}, {"count": 32, "tags": [], "bug_id": 26538, "is_private": false, "id": 152569, "attachment_id": null, "creator": "covener@gmail.com", "creation_time": "2012-01-04T15:16:58Z", "time": "2012-01-04T15:16:58Z", "text": "re-closing, no backport to Apache 2.0.x"}]
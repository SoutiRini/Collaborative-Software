[{"count": 0, "tags": [], "bug_id": 16912, "attachment_id": null, "id": 30953, "time": "2003-02-09T08:16:23Z", "creator": "tivv@gtech-ua.com", "creation_time": "2003-02-09T08:16:23Z", "is_private": false, "text": "Summary says the problem - it does not work well with cyrillic.\nThe fix is:\nParamSupport.java (common/core), line 123:\n        try\n        {\n        if (encode) {\n            parent.addParameter(\n                URLEncoder.encode(name,\npageContext.getResponse().getCharacterEncoding()), URLEncoder.encode(value,\npageContext.getResponse().getCharacterEncoding()));\n        } else\n            parent.addParameter(name, value);\n        }\n        catch (java.io.UnsupportedEncodingException e)\n        {throw new JspException(e.toString());}"}, {"count": 1, "tags": [], "bug_id": 16912, "attachment_id": null, "text": "Thanks for the bug report.\n\nFix is more elaborate than the one suggested because\nURLEncoder.encode(String, String) is new since J2SE 1.4 and\nJSTL 1.0 must also run on previous releases of J2SE.\n", "id": 32049, "time": "2003-02-26T22:54:06Z", "creator": "pierre.delisle@sun.com", "creation_time": "2003-02-26T22:54:06Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 16912, "attachment_id": null, "is_private": false, "id": 32086, "time": "2003-02-27T15:14:13Z", "creator": "Stefan.Kuehnel@frontis.com", "creation_time": "2003-02-27T15:14:13Z", "text": "From my understanding of the documentation for URLEncoder and the implementation \nnotes of the HTML spec \n(http://www.w3.org/TR/html40/appendix/notes.html#non-ascii-chars), the parameter \nname and value should be encoded using UTF-8, not using the document encoding as \nthe current fix does.  Looking at the Tomcat 4.x sources \n(http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-4.0/catalina/src/share/org/apa\nche/catalina/connector/HttpRequestBase.java), it seems it uses the document \nencoding for parameter decoding, but shouldn't there at least be an option to \nspecify the parameter encoding to use?\n"}, {"count": 3, "tags": [], "bug_id": 16912, "attachment_id": null, "is_private": false, "id": 32092, "time": "2003-02-27T15:41:57Z", "creator": "tivv@gtech-ua.com", "creation_time": "2003-02-27T15:41:57Z", "text": "This would be more correct as soon as this would be parsed correctly by tomcat.\nFor now next test:\n<c:out value=\"${param.param}\"/>\n<p><a href='test3.jsp?param=<%= java.net.URLEncoder.encode(\"&#1055;&#1088;&#1080;&#1074;&#1077;&#1090;\", \"UTF-8\")\n%>'>Click</a>\n\n(file is test3.jsp) gives test3.jsp?param=%D0%9F%D1%80%D0%B8%D0%B2%D0%B5%D1%82\nURL that is parsed correctly in Mozilla (displayed OK in status bar), but\nincorrectly in Tomcat - &#1072;&#65533;&#1073;&#65533;&#1072;&#1048;&#1072;&#1042;&#1072;&#1045;&#1073;&#65533; is displayed by c:out instead of &#1055;&#1088;&#1080;&#1074;&#1077;&#1090;.\nNote that the test3.jsp also has next statements (that allows me to use cyrillic\ncorrectly):\n<%@ page pageEncoding=\"windows-1251\" %>\n<% if (request.getCharacterEncoding() == null)\nrequest.setCharacterEncoding(response.getCharacterEncoding());\n%>"}, {"count": 4, "tags": [], "bug_id": 16912, "attachment_id": null, "is_private": false, "id": 32461, "time": "2003-03-05T15:11:36Z", "creator": "apache@dima.spb.ru", "creation_time": "2003-03-05T15:11:36Z", "text": "Tha way you fixed this bug will work on JDK 1.4 but will fallback to old \nbehavior on JDK 1.3. In fact that means bug is not fixed.\n\nIt would be better to implement your own urlEncode implementation inside JSTL \nand use it on JDK 1.3. Simplest way is to use URLEncoder.encode source from 1.4"}, {"count": 5, "tags": [], "bug_id": 16912, "attachment_id": null, "is_private": false, "id": 36383, "time": "2003-04-30T14:33:15Z", "creator": "pierre.delisle@sun.com", "creation_time": "2003-04-30T14:33:15Z", "text": "*** Bug 19477 has been marked as a duplicate of this bug. ***"}, {"count": 6, "text": "Stefan is right about the HTML spec. However, this part of the HTML\nspec was apparently produced too late to have an impact on\nreality. Browsers generally encode the query string using the\ncharacter encoding of the page containing the form. Moreover,\nthe JSP 2.0 spec also adopts this convention for internally\ngenerated query strings.\n\nIt therefore seems wise to follow suit with what everyone else is doing.\n\nI've updated the code to do the encoding as follows:\n   Util.URLEncode(name, enc)\nwhere the URLEncode method has been lifted from the Jasper2 source code\n(we now use the same code for both J2SE 1.3 and J2SE 1.4),\nand where enc is 'pageContext.getResponse().getCharacterEncoding()'.", "creator": "pierre.delisle@sun.com", "attachment_id": null, "id": 36422, "time": "2003-04-30T23:01:52Z", "bug_id": 16912, "creation_time": "2003-04-30T23:01:52Z", "tags": [], "is_private": false}]
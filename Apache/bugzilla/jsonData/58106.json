[{"count": 0, "text": "Created attachment 32882\ntest file\n\nHere's my code. test.xlsx is attached.\n\nWorkbook workbook = WorkbookFactory.create(new File(\"test.xlsx\"));\nworkbook.getSheetAt(0).getRow(12).getCell(1).setCellType(Cell.CELL_TYPE_NUMERIC);\nworkbook.write(new FileOutputStream(\"test2.xlsx\"));\n\nthe workbook contains some formular cells.\nafter I remove one of the formular cell.\n\nbelow error occurs.\nRemoved Records: Shared formular from /xl/worksheets/sheet1.xml part\nRemoved Records: Formula from /xl/calcChain.xml part (Calculation properties)\n\nI checked the sheet1.xml in the xlsx file and found the formular with shared properties.If I remove the formular of B13. the result will be abnormal.\n\n<f ref=\"B13:G13\" si=\"0\" t=\"shared\">SUM(B1:B3)</f>", "bug_id": 58106, "attachment_id": 32882, "id": 183899, "time": "2015-07-06T05:59:22Z", "creator": "guoh0115@gmail.com", "creation_time": "2015-07-06T05:59:22Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 58106, "attachment_id": null, "text": "This happens when formulas are \"shared\", e.g. by draging the cell with a formula over other cells. \n\nExcel stores this in the copied-to cells as \n\n<f si=\"0\" t=\"shared\"/>\n\nwithout storing the actual formula multiple times.\n\nThe source-cell stores the original formula:\n\n<f ref=\"B13:G13\" si=\"0\" t=\"shared\">SUM(B1:B3)</f>\n\nSo when the formula with the shared formula is removed, either the next one needs to be made the \"master\"-formula or the sharing needs to be undone for all formulas.", "id": 186792, "time": "2015-12-04T15:24:09Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-12-04T15:24:09Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 58106, "text": "Not sure how we can solve this, it would require to \"transpose\" the formula from one Cell to the next one depending on the reference in the Formula of the removed cell\n\nWe can detect this case with the following in XSSFWorkbook.onDeleteFormula(), but I am not sure how we would go about fixing this :(\n\n    protected void onDeleteFormula(XSSFCell cell){\n        if(calcChain != null) {\n            // TODO: check for shared formulas!\n            CTCellFormula f = cell.getCTCell().getF();\n            if(f.getT().equals(org.openxmlformats.schemas.spreadsheetml.x2006.main.STCellFormulaType.SHARED) &&\n                    f.getRef() != null && \n                    f.getStringValue() != null) {\n                // shared formula and needs adjustment as the formula is stored here...\n                System.out.println(\"Need to adjust for shared formula here!\");\n            }\n            \n            ...\n        }\n    }", "id": 186793, "time": "2015-12-04T15:39:24Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-12-04T15:39:24Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 58106, "text": "I wonder if the \"shift rows\" formula changing logic could be re-used for this?", "id": 186794, "time": "2015-12-04T15:45:41Z", "creator": "apache@gagravarr.org", "creation_time": "2015-12-04T15:45:41Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 58106, "attachment_id": null, "text": "Fixed in r1819623\n\nDominik is right, when a cell with a 'master' shared formula is removed,  the next cell in the range should become the master. Excel does exactly this when you remove a shared formula and save the file.", "id": 202964, "time": "2017-12-30T16:36:26Z", "creator": "yegor@dinom.ru", "creation_time": "2017-12-30T16:36:26Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 53992, "attachment_id": null, "text": "I get this exception:\n\njava.lang.RuntimeException: WINDOW2 was not found\n\tat org.apache.poi.hssf.model.InternalSheet.<init>(InternalSheet.java:326)\n\tat org.apache.poi.hssf.model.InternalSheet.createSheet(InternalSheet.java:163)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:296)\n\tat org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:88)\n\n\nI debbuged InternalSheet to see why this was happening. And found that the excel file I'm processing ends with an empty sheet which only contains one BOF and one EOF records.\nThese are the last line of the BiffViewer output:\nOffset=0x00008DA3(36259) recno=1907 sid=0x0809 size=0x0010(16)\n[BOF RECORD]\n    .version  = 0x0600\n    .type     = 0x1000 (#error unknown type#)\n    .build    = 0x15EC\n    .buildyear= 1997\n    .history  = 0x0000C0C1\n    .reqver   = 0x00000306\n[/BOF RECORD]\n\nOffset=0x00008DB7(36279) recno=1908 sid=0x000A size=0x0000(0)\n[EOF]\n[/EOF]\n\n\nSo in InternalSheet(RecordStream rs) constructor, the following code throws the exception.\n\n        if (windowTwo == null) {\n            throw new RuntimeException(\"WINDOW2 was not found\");\n        }\n\nI would like to know if this WINDOW2 record is mandatory when the sheet is empty.\nExcel and LibreOffice open the file without problems (they just don't display the empty sheet).\n\nI have fixed the error replacing the mentioned lines with the following and it seems to be working perfectly:\n        if (windowTwo == null) {\n            if (rra != null) {\n                throw new RuntimeException(\"WINDOW2 was not found\");\n            }\n            log.log(POILogger.ERROR, \"WINDOW2 record not found. Trying to add one with default values\");\n            windowTwo = createWindowTwo();\n            records.add(findFirstRecordLocBySid(EOFRecord.sid), windowTwo);\n        }\n\n\n\nPlease, let me know if this solution is right or there is any other workaround or I should contact the creators of the excel file to ask them to fix it on their software.\n\nThank you.", "id": 162691, "time": "2012-10-11T11:40:30Z", "creator": "pedro.t.garcia@gmail.com", "creation_time": "2012-10-11T11:40:30Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 53992, "text": "do you know the origin of the problematic file? Can you attach it? \n\nWhat happens if you open and re-save it in Excel or LibreOffice ? Does POI read the re-saved file ?\n\nPOI is being used in thousands installations across the world and so far no one complained on this exception. All test files that we've seen have a  WINDOW2 record . \n\nYegor", "id": 162692, "attachment_id": null, "creator": "yegor@dinom.ru", "creation_time": "2012-10-11T11:47:23Z", "time": "2012-10-11T11:47:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 53992, "text": "The file is created from the 'export' feature of an application of one of our providers.\nI'm trying to find out how the files are generated but it's not easy. Also I'm trying to get an example of one of those files without any sensible data in it so I can attach it.\n\nAs with every problem I found using POI re-saving the file fixes everything.\n\nThis file has another problem and I've reported a bug about it and you have asked me to attach the file already (I'm doing my best to get one I can attach).\nThe question I have is, since both Excel and LibreOffice open this file correctly, shouldn't POI try to do the same thing?\n\nI understand your statement about this being a very unique case. But just fyi, I receive excel files every day from more than 250 different sources (and growing) so the sample of files I have to handle gives me the great opportunity to hit the weirdest issues :)\n(This should sound as congratulatory comment, since I've only found 5 bugs with POI so far, and that means POI is working great for me).\n\nThanks.", "id": 162694, "time": "2012-10-11T13:00:47Z", "creator": "pedro.t.garcia@gmail.com", "creation_time": "2012-10-11T13:00:47Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 53992, "attachment_id": null, "text": "I generally agree with you. If Excel and LibreOffice tolerate files with missing WINDOW2 then POI should do so, but I will apply this fix only when see a sample file. \n\nYegor", "id": 162696, "time": "2012-10-11T15:36:25Z", "creator": "yegor@dinom.ru", "creation_time": "2012-10-11T15:36:25Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 53992, "attachment_id": null, "text": "changing status to NEEDINFO until a test file is provided", "id": 162958, "time": "2012-10-26T11:54:51Z", "creator": "yegor@dinom.ru", "creation_time": "2012-10-26T11:54:51Z", "is_private": false}, {"count": 5, "tags": [], "creator": "pedro.t.garcia@gmail.com", "attachment_id": null, "id": 164789, "time": "2013-01-22T11:52:47Z", "bug_id": 53992, "creation_time": "2013-01-22T11:52:47Z", "is_private": false, "text": "I have attached a test file in the bug 53984 (attachment 29880)\n\nThe problem with that file is that it throws the exception reported in that bug first and only once you get around it the exception reported here is thrown.\n\nThe fix I proposed in a comment above this has been working without issues for some time now, but if you need anything from me to fix, just let me know."}, {"count": 6, "tags": [], "bug_id": 53992, "attachment_id": null, "text": "This has been fixed as part of bug #53984 - we now warn + skip over these invalid bof / eof sets", "id": 176800, "time": "2014-07-31T13:33:22Z", "creator": "apache@gagravarr.org", "creation_time": "2014-07-31T13:33:22Z", "is_private": false}]
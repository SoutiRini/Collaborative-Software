[{"count": 0, "tags": [], "bug_id": 4379, "attachment_id": null, "text": "When a jsp page uses response.sendRedirect(), a default html page is served,\nwhich also sets the content length. This length is incorrect as the jsp page can\nwrite additional content to the out stream. In fact, it seems always incorrect\nas jasper adds one out.write(\"\\n\"). \n\nThe incorrect content length causes the greatest problems when used with\nHTTP/1.1 connections through jserv + Apache, as the extra content arrives where\nthe browser expects another HTTP/1.1 header, and sometimes it displays the extra\ncontent, followed by the real second header (the one for the redirect target),\nfollowed by the content of the redirect target. This browser behaviour is timing\ndependant.\n\nEven with the local http connector, it seems incorrect behaviour, but doesn't\nmatter as the client closes the socket after reading content-length bytes. \n\nTo reproduce:\n\n-- begin file1.jsp --\n<%\nresponse.sendRedirect(\"file2.jsp\");\n%>\n<html>\n  <body>This text will be served, but content-length doesn't include it</body>\n</html>\n-- end file1.jsp\n\nQuick, possibly bad, solution:\n\nRemove: \n  res.setContentLength(body.length());\nfrom RedirectHandler.doService() \n(Line 468 in /share/org/apache/tomcat/context/DefaultCMSetter.java)\n\nIt should possibly also be removed from NotFoundHandler", "id": 7070, "time": "2001-10-23T12:53:27Z", "creator": "tony@palamon.ie", "creation_time": "2001-10-23T12:53:27Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 4379, "text": "This is a bug in the jsp page, not Tomcat.  The correct code should read:\n<%\nresponse.sendRedirect(\"file2.jsp\");\nreturn;\n%>\n", "id": 7075, "time": "2001-10-23T15:00:39Z", "creator": "william.barker@wilshire.com", "creation_time": "2001-10-23T15:00:39Z", "is_private": false, "attachment_id": null}]
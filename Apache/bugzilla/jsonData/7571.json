[{"count": 0, "tags": [], "creator": "pauric.cregg@spectel.com", "attachment_id": null, "is_private": false, "id": 12452, "time": "2002-03-28T12:19:01Z", "bug_id": 7571, "creation_time": "2002-03-28T12:19:01Z", "text": "Configuration - Apache 1.3.24, AJP13, Tomcat 4.0.3\n\nWhen doing a post request from an applet to a servlet via Apache, the \nDataInputStream.readLong() value does not appear to be read correctly. \n\nIn order to test this I have created a testClient and testServlet the code for \nwhich is included below plus the output I received when I ran the tests.\n\nIf I test against Tomcat directly everything works fine. If the request is \nrouted via Apache first the values appear to be corrupted. Below is the output \nI receive from the test program.\n\nDoes anybody have any idea why the example code below does not work on Apache ?\n\nFrom what I understand it should work and appears to work fine when using \nTomcat directly. If anybody can help it would be much appreciated.\n\nbest regards\nPauric\n\n\nFirst Run on Tomcat\n\nStarting service Tomcat-Standalone\nApache Tomcat/4.0.3\nStarting service Tomcat-Apache\nApache Tomcat/4.0.3\nCalled Test Servlet doGet()\nCalled Test Servlet doGet()\nCalled Test Servlet doGet()\nCalled Test Servlet doGet()\nTest Servlet doPost()\nHeader ->content-type Value ->application/octet-stream\nHeader ->user-agent Value ->Java1.3.1_01\nHeader ->host Value ->192.168.1.105:8080\nHeader ->accept Value ->text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2\nHeader ->connection Value ->keep-alive\nHeader ->content-length Value ->16\nConference100\nID String 1234567890\nCommand500\n\nSecond run via Apache\n\nCalled Test Servlet doGet()\nCalled Test Servlet doGet()\nTest Servlet doPost()\nHeader ->content-type Value ->application/octet-stream\nHeader ->connection Value ->keep-alive\nHeader ->accept Value ->text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2\nHeader ->host Value ->192.168.1.105\nHeader ->content-length Value ->16\nHeader ->user-agent Value ->Java1.3.1_01\nConference100\nID String 1217855954\nCommand65780\n\n\nTESTCLIENT\n\nimport java.net.*;\nimport java.io.*;\nimport java.util.*;\n\n\npublic class TestClient extends Thread\n{\n    public static void main(String args[])\n    {\n        try\n        {\n            String url \n= \"http://<localhost>/test/servlet/com.spectel.test.server.TestServlet\";\n\n            System.out.println(\"Started Test Client\");\n\n            URL u = new URL(url);\n            URLConnection x = u.openConnection();\n            HttpURLConnection urlCon = (HttpURLConnection)x;\n\n            System.out.println(\"URL for Test Client \" + url);\n\n            String type = \"POST\";\n            urlCon.setRequestMethod(type);\n            urlCon.setDoOutput(true);\n            urlCon.setDoInput(true);\n            urlCon.setUseCaches(false);\n            urlCon.setDefaultUseCaches(false);\n            urlCon.setRequestProperty(\"Content-type\",\"application/octet-\nstream \");\n\n            System.out.println(\"Set up POST Request\" + url);\n\n            DataOutputStream out=new DataOutputStream(urlCon.getOutputStream());\n\n            out.writeInt(100);\n            out.writeLong(1234567890);\n            out.writeInt(500);\n            out.flush();\n            out.close();\n\n            System.out.println(\"Executed POST Request\" + url);\n\n            HttpURLConnection htp = (HttpURLConnection)urlCon;\n\n            System.out.println(\"Response code  is -> \" + htp.getResponseCode());\n        }\n        catch(Exception e)\n        {\n            System.out.println(\"Post Connect Failed :\" + e.toString());\n        }\n    }\n}\n\nTESTSERVLET\n\nimport java.io.*;\nimport java.util.*;\nimport java.text.*;\nimport java.net.URL;\nimport java.net.MalformedURLException;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\npublic class TestServlet extends HttpServlet\n{\n    public void init(ServletConfig config) throws ServletException\n    {\n        super.init(config);\n\n        ServletContext sc = getServletContext();\n    }\n\n    public void doPost(HttpServletRequest postReq, HttpServletResponse postRes)\n        throws IOException, ServletException\n    {\n        System.out.println(\"Test Servlet doPost()\");\n\n        Enumeration enum = postReq.getHeaderNames();\n\n        while(enum.hasMoreElements())\n        {\n            String name = (String)enum.nextElement();\n            String value = postReq.getHeader(name);\n            System.out.println(\"Header ->\" + name + \" Value ->\" + value);\n        }\n\n        DataInputStream in = null;\n\n        in = new DataInputStream(postReq.getInputStream());\n\n        int ref = in.readInt();\n        System.out.println(\"Reference\" + ref);\n\n        long uniqueID = in.readLong();\n        System.out.println(\"ID String \" + uniqueID);\n\n        int command = in.readInt();\n        System.out.println(\"Command\" + command);\n    }\n\n    public void doGet(HttpServletRequest postReq, HttpServletResponse postRes)\n        throws IOException, ServletException\n    {\n        System.out.println(\"Called Test Servlet doGet()\");\n    }\n    public void destroy()\n    {\n        System.exit(0);\n    }\n}"}, {"count": 1, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "id": 12454, "time": "2002-03-28T13:02:49Z", "bug_id": 7571, "creation_time": "2002-03-28T13:02:49Z", "is_private": false, "text": "This is clearly a Tomcat problem and not an HTTP Server problem."}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 59506, "time": "2004-06-18T18:43:08Z", "bug_id": 7571, "creation_time": "2004-06-18T18:43:08Z", "is_private": false, "text": "This component is now deprecated. If you still experience this issue, please \nupgrade to the Coyote JK2 connector.\n\nNo further work will take place against this bug report.\n\n"}]
[{"count": 0, "tags": [], "creator": "ytaylor@qcorps.com", "attachment_id": null, "id": 2534, "time": "2001-05-18T10:09:20Z", "bug_id": 1811, "creation_time": "2001-05-18T10:09:20Z", "is_private": false, "text": "I have these 2 schema files: components.xsd and input.xsd, and\nan instance file: input.xml.\nI have defined constraints in components.xsd:\nOne of them for uniqueness: Input:Name, and another one with key and keyrefs.\nLook at the files below. I have also attached the input.xml file, which\nhas the same Input name (T1) twice, and xerces parser does not trap the error.\nAlso, I can add an Input with name (XX), which is wrong because it does not\nreference any previously defined inputs. xerces does not trap that error\neither. \nPlease advise.\n\ncomponents.xsd\n---------------\n<?xml version = \"1.0\" encoding = \"UTF-8\"?>\n<xsd:schema xmlns = \"http://COMPONENTS\"\n         targetNamespace = \"http://COMPONENTS\"\n         xmlns:INPUT = \"http://INPUT\"\n         xmlns:xsd = \"http://www.w3.org/2000/10/XMLSchema\"\n         elementFormDefault = \"qualified\"\n         attributeFormDefault = \"unqualified\">\n        <xsd:import namespace = \"http://INPUT\" schemaLocation = \"input.xsd\"/>\n        <xsd:element name = \"COMPONENTS\">\n                <xsd:complexType>\n                        <xsd:sequence>\n                                <xsd:choice maxOccurs = \"unbounded\">\n                                        <xsd:element ref=\"INPUT:Input\"/>\n                                </xsd:choice>\n                                <xsd:element ref = \"IMPORT\"/>\n                        </xsd:sequence>\n                </xsd:complexType>\n                <xsd:unique>\n                    <xsd:selector xpath=\"Input\"/>\n                    <xsd:field xpath=\"Name\"/>\n                </xsd:unique>\n                <xsd:key name=\"inputKey\">\n                    <xsd:selector xpath=\"Input\"/>\n                    <xsd:field xpath=\"Name\"/>\n                </xsd:key>\n                <xsd:keyref name=\"inpRefer\" refer=\"inputKey\">\n                    <xsd:selector xpath=\"INPUT:REF\"/>\n                </xsd:keyref>\n        </xsd:element>\n        <xsd:element name = \"IMPORT\">\n                <xsd:complexType>\n                        <xsd:sequence>\n                                <xsd:choice maxOccurs = \"unbounded\">\n                                        <xsd:element ref = \"INPUT:REF\"/>\n\t\t\t\t</xsd:choice>\n                        </xsd:sequence>\n                </xsd:complexType>\n        </xsd:element>\n</xsd:schema>\n\ninput.xsd\n---------\n<?xml version = \"1.0\" encoding = \"UTF-8\"?>\n<schema xmlns = \"http://www.w3.org/2000/10/XMLSchema\"\n         targetNamespace = \"http://INPUT\"\n         xmlns:INPUT = \"http://INPUT\"\n         elementFormDefault = \"qualified\"\n         attributeFormDefault = \"unqualified\">\n\n        <simpleType name=\"Name\">\n            <restriction base=\"string\"/>\n        </simpleType>\n\n        <element name = \"InputDirectory\" type = \"string\"/>\n        <element name = \"BackupDirectory\" type = \"string\"/>\n        <element name = \"URL\" type = \"string\"/>\n        <element name = \"User\" type = \"string\"/>\n        <element name = \"Password\" type = \"string\"/>\n        <complexType name = \"Input\">\n                <sequence>\n                        <element name=\"Name\" type =\"Name\"/>\n                </sequence>\n        </complexType>\n        <complexType name = \"File\">\n                <complexContent>\n                        <extension base = \"INPUT:Input\">\n                                <sequence>\n                                        <element ref = \"INPUT:InputDirectory\"/>\n                                        <element ref = \"INPUT:BackupDirectory\"\nminOccurs = \"0\"/>\n                                </sequence>\n                        </extension>\n                </complexContent>\n\n        </complexType>\n        <element name = \"Input\" type = \"INPUT:Input\" abstract=\"true\"/>\n        <element name = \"File\" type = \"INPUT:File\" substitutionGroup =\n\"INPUT:Input\"/>\n        <element name = \"REF\" type=\"INPUT:Name\"/>\n</schema>\n\n\ninput.xml\n---------\n?xml version = \"1.0\" encoding = \"UTF-8\"?>\n<COMPONENTS xmlns = 'http://COMPONENTS'\n            xmlns:xsi = 'http://www.w3.org/2000/10/XMLSchema-instance'\n            xmlns:INPUT = 'http://INPUT'\n            xsi:schemaLocation = 'http://COMPONENTS components.xsd\n                                  http://INPUT input.xsd'>\n        <INPUT:File>\n                <INPUT:Name>T1</INPUT:Name>\n                <INPUT:InputDirectory>incoming</INPUT:InputDirectory>\n                <INPUT:BackupDirectory>backup</INPUT:BackupDirectory>\n        </INPUT:File>\n        <IMPORT>\n                <INPUT:REF>T1</INPUT:REF>\n                <INPUT:REF>T1</INPUT:REF>\n        </IMPORT>\n</COMPONENTS>"}, {"count": 1, "tags": [], "creator": "mhuffman@ca.ibm.com", "text": "There are a few different errors in components.xsd when defining the identity-\nconstraints ... I'll provide a corrected sample here and try to explain the \ntrouble spots.\n\nCorrected Identity-Constraint Definitions\n=========================================\n<xsd:unique name=\"uniqueKey\">\n   <xsd:selector xpath=\"INPUT:File\"/>\n   <xsd:field xpath=\"INPUT:Name\"/>\n</xsd:unique>\n<xsd:key name=\"inputKey\">\n   <xsd:selector xpath=\"INPUT:File\"/>\n   <xsd:field xpath=\"INPUT:Name\"/>\n</xsd:key>\n<xsd:keyref name=\"inpRefer\" refer=\"inputKey\">\n   <xsd:selector xpath=\"IMPORT/INPUT:REF\"/>\n   <xsd:field xpath=\".\"/>\n</xsd:keyref>\n\n1) <unique> requires a name, so added name=\"uniqueKey\".\n2) In original <xsd:selector xpath=\"Input\"/> and\n   <xsd:field xpath=\"Name\"/> , both \"Input\" and \"Name\" require namespace\n   qualifier \"INPUT:\" since they are declared in the imported namespace.\n   However, note that leaving \"INPUT:Input\" as the selector's xpath will NOT\n   apply the identity-constraint since \"INPUT:File\" has been used in the\n   instance document. You need \"INPUT:File\" as the selector. Alternatively,\n   you could use \"wildcard\" xpath=\".//INPUT:Name\" in selector and xpath=\".\" in\n   field.\n3) proper xpath for <keyref> is \"IMPORT/INPUT:REF\"\n4) <keyref> requires <field> so added <xsd:field xpath=\".\"/> to <keyref>\n\nFURTHER NOTE:\n=============\n1) The <unique> definition is redundant, since <key> is defined on the identical\n   (selector,field), and can be removed.\n2) The <keyref> does NOT enforce uniqueness on its (selector,field+). This is\n   why there is NO error by having 2 <INPUT:REF>T1</INPUT:REF> lines in your\n   instance document. The <keyref> ensures that its (selector,field+) values\n   DO exist in the referred key (refer=\"inputKey\") which they do in your\n   example.\n3) If you added <INPUT:REF>XX</INPUT:REF> to the instance document (using the\n   corrected schema), XercesJ 1.4.0 would report this error. XercesJ 1.3.1,\n   does NOT properly report all identity-constraint errors. If you're using\n   this feature I urge you to move up to 1.4.0.\n4) If you do move from 1.3.1 to 1.4.0 REMEMBER to change your schema namespace\n   from ...www.w3.org/2000/10/XML... to ...www.w3.org/2001/XML...\n\nMark Huffman", "id": 2754, "time": "2001-06-06T06:03:04Z", "bug_id": 1811, "creation_time": "2001-06-06T06:03:04Z", "is_private": false, "attachment_id": null}]
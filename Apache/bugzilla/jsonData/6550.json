[{"count": 0, "tags": [], "creator": "thomas@obidobi.net", "attachment_id": null, "is_private": false, "id": 10904, "time": "2002-02-19T16:46:21Z", "bug_id": 6550, "creation_time": "2002-02-19T16:46:21Z", "text": "I had a memory leak when using Tomcats manager to reload my application.\nAnalyzing the situation i found that Singeltons are never GC'd. Why? Looking\ndeeper there seems to be a problem with old WebappClassLoaders never getting\nGC'd and the reason seems to be that there are references to the\nWebappClassLoaders that never get removed.\n\nSee here for more information:\n\n<http://nyx.obidobi.net/~thomas/tomcat/index.html>\n\nI have located the problem to:\n\nstatic Hashtables (clBindings, clNameBindings ) located in class\norg.apache.naming.ContextBindings.\n\nThe classLoaders are added to these Hashtables by a call from\nlifecycleEvent in the class NamingContextListner.java\n=============\nNamingContextListner.java, 295\nif (container instanceof Context) {\n// Setting the context in read only mode\nContextAccessController.setReadOnly(getName());\ntry {\nContextBindings.bindClassLoader\n(container, container,\n((Container)\ncontainer).getLoader().getClassLoader());\n} catch (NamingException e) {\nlog(sm.getString(\"naming.bindFailed\", e));\n}\n}\n============\nI think that there should be a call to unbindClassLoader somewhere in NamingContextListner.java, method lifecycleEvent\nContextBindings.unbindClassLoader( container, container );\nThomas"}, {"count": 1, "tags": [], "bug_id": 6550, "attachment_id": null, "id": 10939, "time": "2002-02-20T01:28:54Z", "creator": "remm@apache.org", "creation_time": "2002-02-20T01:28:54Z", "is_private": false, "text": "Fixed in both branches. Nightly for 02/20 will have the patch. Thanks a lot for\nthe analysis and the patch."}]
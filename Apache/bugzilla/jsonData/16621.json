[{"count": 0, "text": "Something in the mod_win32.c 1.16 change for PR 8387 (new bugzilla database)\n<http://cvs.apache.org/viewcvs.cgi/httpd-2.0/modules/arch/win32/mod_win32.c?rev=1.16&only_with_tag=APACHE_2_0_37&content-type=text/vnd.viewcvs-markup>\ncauses a CGI (Win32 console application) to be unable to read stdout from a\nspawned process (another Win32 console application).\n\nFile handles are duplicated and the child process created as documented on MSDN\n<http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/creating_a_child_process_with_redirected_input_and_output.asp>.\nThe problem is that ReadFile in the parent immediately returns 109\n(ERROR_BROKEN_PIPE).\n\nApplying the following change to mod_win32.c (2.0.44) makes the problem go away:\n\n543,544d542\n< e_info->detached = 1;\n<\n\nAt this point, the parent can properly read the stdout generated by the child.\n\nThe problem and solution apply both when apache is run as a service or console\napplication.\n\nA side note: With and without my patch above, when apache is run as a console\napplication, a cmd.exe window appears on the screen when the CGI is executed\n(perhaps PR 8387 is not completely fixed?).\n\nOur apache runs as a service, so the cmd.exe windows don't bother us.", "creator": "rtsai@netapp.com", "is_private": false, "id": 30382, "time": "2003-01-30T23:16:43Z", "bug_id": 16621, "creation_time": "2003-01-30T23:16:43Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "text": "The stock httpd-2.0.36 for Windows doesn't have this problem.", "attachment_id": null, "id": 30383, "creator": "rtsai@netapp.com", "time": "2003-01-30T23:25:03Z", "bug_id": 16621, "creation_time": "2003-01-30T23:25:03Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 16621, "is_private": false, "count": 2, "id": 30384, "time": "2003-01-31T00:23:14Z", "creator": "wrowe@apache.org", "creation_time": "2003-01-31T00:23:14Z", "text": "\n  The bug isn't where you are pointing.  The bug was a change to apr,\n  where we were creating pipes with completion ports (to be able to\n  time them out.)  Of course, such pipes cannot be inherited.\n\n  Fix committed, will be in 2.0.45"}, {"count": 3, "tags": [], "bug_id": 16621, "attachment_id": null, "id": 30464, "time": "2003-02-01T08:20:52Z", "creator": "rtsai@netapp.com", "creation_time": "2003-02-01T08:20:52Z", "is_private": false, "text": "I've just pulled the head of httpd-2.0 from anoncvs, confirmed that it has your\napr changes (win32 proc.c, pipe.c, readwrite.c), and built for Windows, but I'm\nstill seeing the same symptoms of ERROR_BROKEN_PIPE immediately returned by\nReadFile in parent, and being unable to read stdout from child.\n\nWill it help if I write a small test program to illustrate my problem? I can't\nthink of anything else much I can do to help; I'm not a Win32 guru ..."}, {"count": 4, "tags": [], "bug_id": 16621, "attachment_id": null, "id": 36728, "time": "2003-05-06T00:28:42Z", "creator": "nd@perlig.de", "creation_time": "2003-05-06T00:28:42Z", "is_private": false, "text": "Can you please try 2.0.45 if it really persists?\n\nThanks."}, {"count": 5, "tags": [], "bug_id": 16621, "attachment_id": null, "is_private": false, "id": 38129, "time": "2003-06-01T17:41:02Z", "creator": "nd@perlig.de", "creation_time": "2003-06-01T17:41:02Z", "text": "No further response. Assuming issue resolved.\n\nPlease reopen the bug if this is not the case and you can provide additional\ninformation.\n\nThanks for using Apache.\n"}]
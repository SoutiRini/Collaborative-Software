[{"count": 0, "tags": [], "bug_id": 44992, "attachment_id": null, "text": "I am having problems with Tomcat, Glassfish and the Woodstox Parser.\n\nWhen calling servletContext.getResource with a WSDL file name which is a resource in the webapp, the following is returned \njndi:/localhost/myWebApp/WEB-INF/wsdl/StockQuoteService.wsdl\n\nI see that Tomcat has its own UrlStreamHandler, DirContextUrlStreamHandler.\n\nNow Woodstox wants to create an URL on jndi:/localhost/myWebApp/WEB-INF/wsdl/StockQuoteService.wsdl\nI guess for validation.\n\nThe java.net.Url constructor code eventually calls parseUrl and fails with a MalformedUrlException\n\nDirContextURLStreamHandler did not override that method and the invocation went up to URLStreamHandler which threw the MalformedUrlException.\n\n\nI don't quite understand why this Custom UrlStreamHandler is used instead of say a file:/// formatted URL", "id": 116579, "time": "2008-05-13T14:22:44Z", "creator": "dougd@bea.com", "creation_time": "2008-05-13T14:22:44Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 44992, "attachment_id": null, "text": "This works for me with the latest 6.0.x and 5.5.x\n\nThere may be an issue with both the parser and Tomcat calling URL.setURLStreamHandlerFactory() although in that case I'd expect you to see an error in the logs somewhere.\n\nFor the record parseUrl() has nothing to do with the exception you are seeing. The exception is thrown by the constructor of java.net.URL (not java.net.Url) when it can't find an appropriate protocol handler", "id": 116582, "time": "2008-05-13T15:15:23Z", "creator": "markt@apache.org", "creation_time": "2008-05-13T15:15:23Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 44992, "text": "Yes, I did get the unknown protocol early on.  I am in an OSGI environment so I registered the Tomcat URLStreamHandler with the URLStreamHandlerService.\n\nBut leaving OSGI aside, if in the JVM, no process beats Tomcat to registering the URLStreamHandler and Tomcat gets its URLStreamHandler in, then Woodstox would not get the unknown protocol error\n\nIn JVM1.5.11 , java.net.URL\n\n    public URL(String spec) throws MalformedURLException {\n\tthis(null, spec);\n    }\n\ncalls\n\n    public URL(URL context, String spec) throws MalformedURLException {\n\tthis(context, spec, null);\n    }\n\ncalls\n\n    public URL(URL context, String spec, URLStreamHandler handler)\n\tthrows MalformedURLException\n\nwhich calls\n\n\t    handler.parseURL(this, spec, start, limit);\n\n\t} catch(MalformedURLException e) {\n\t    throw e;\n\t} catch(Exception e) {\n\t    throw new MalformedURLException(e.getMessage());\n\t}", "id": 116605, "time": "2008-05-14T05:29:27Z", "creator": "dougd@bea.com", "creation_time": "2008-05-14T05:29:27Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 44992, "text": "For both 6.0.x and 5.5.x the following runs without error in a JSP:\n\nURL url = new URL(\"jndi:/localhost/myWebApp/WEB-INF/wsdl/StockQuoteService.wsdl\");\n\nFrom your description it looks like an issue with how OSGI interacts with the URL class to provide additional protocol handlers. I don't see anything in this report to suggest a Tomcat bug at this point.\n\nAgain, parseURL() is a red herring. That method doesn't throw the exception you are seeing.", "id": 116610, "time": "2008-05-14T07:45:20Z", "creator": "markt@apache.org", "creation_time": "2008-05-14T07:45:20Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 44992, "is_private": false, "id": 116636, "time": "2008-05-15T06:03:57Z", "creator": "dougd@bea.com", "creation_time": "2008-05-15T06:03:57Z", "tags": [], "text": "Sometimes I get lost in the weeds.  I needed to override setURL when using the OSGI UrlStreamHandlerService.  Not doing that caused the setURL in java.net.URLStreamHandler to be called which failed here\n\n\tif (this != u.handler) {\n\t    throw new SecurityException(\"handler for url different from \" +\n\t\t\t\t\t\"this handler\");\n\t}\n\nand this bubbles up as a MalformedURLException.\n\nTnx for the perspective."}, {"text": "No problem. Glad you got it working.", "tags": [], "bug_id": 44992, "is_private": false, "count": 5, "id": 116637, "time": "2008-05-15T06:07:51Z", "creator": "markt@apache.org", "creation_time": "2008-05-15T06:07:51Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 33463, "attachment_id": null, "id": 70695, "time": "2005-02-09T12:32:48Z", "creator": "kap@apama.com", "creation_time": "2005-02-09T12:32:48Z", "is_private": false, "text": "I have a Struts 1.1 application that has worked fine in Tomcat 4.1.x, 5.0.x, \nbut does not function correctly under Tomcat 5.5.7.\n\nSpecifically, my Struts application registers a PlugIn class (which just \nimplements the 2 methods of the interface, i.e. init() and destroy()).  The \ninit() method is called just fine as the app is started, but the destroy() \nmethod is not called when the app is stopped.  We are using the Manager \napplication to start and stop the web app.\n\nThis can be reproduced by simply adding a PlugIn implementation to the struts-\nexamples.war - see example plugin below.\n\nInterestingly, the destroy method of a plain servlet IS called when the app is \nstopped (this is our workaround just now).  It would appear that when the \nStruts ActionServlet.destroyModules() method is called, it performs the \nfollowing:\nEnumeration names = getServletContext().getAttributeNames();\nThis enumeration is empty, and hence it is unable to notify the plugin.\n\nHope this is detailed enough.\n\nFor reference, this is on Win XP SP2, JRE 1.5.0_01, Tomcat 5.5.7, Struts 1.1\n\n\nCheers,\n\nKev Palfreyman\nApama UK Ltd.\n\n\nExample PlugIn:\n\nFrom struts-config.xml:\n\n\t<plug-in className=\"ApamaDebugPlugIn\"></plug-in>\n\n\nimport org.apache.struts.action.PlugIn;\nimport org.apache.struts.action.ActionServlet;\nimport javax.servlet.ServletException;\nimport org.apache.struts.config.ModuleConfig;\n\npublic class ApamaDebugPlugIn implements PlugIn {\n\n\tpublic void init(ActionServlet servlet, ModuleConfig config) throws \nServletException {\n\t\tSystem.out.println(\"ApamaDebugPlugin.init()\");\n\t} \n\n\n\tpublic void destroy() {\n\t\tSystem.out.println(\"ApamaDebugPlugin.destroy()\");\n\t}\n}"}, {"count": 1, "tags": [], "bug_id": 33463, "attachment_id": null, "is_private": false, "id": 70696, "time": "2005-02-09T12:58:23Z", "creator": "remm@apache.org", "creation_time": "2005-02-09T12:58:23Z", "text": "And where in the specification is it said that attribute removals are not\nallowed to be done before (it used to be never, anyway). I am willing to make\nthe change, however, since I do not even see why notifications should be sent\nwhen artificially \"removing\" attributes from the context when stopping a webapp.\nThis seems wrong to me."}, {"count": 2, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "This is now fixed, assuming my interpretation of the specification is right and\nother developers accept my changes.", "id": 70701, "time": "2005-02-09T13:30:59Z", "bug_id": 33463, "creation_time": "2005-02-09T13:30:59Z", "is_private": false}, {"count": 3, "tags": [], "text": "And also ported back to TC4 where my same fix had created the same problem.", "is_private": false, "bug_id": 33463, "id": 70904, "time": "2005-02-13T20:56:15Z", "creator": "markt@apache.org", "creation_time": "2005-02-13T20:56:15Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 33463, "attachment_id": null, "is_private": false, "id": 71872, "time": "2005-03-05T22:03:08Z", "creator": "markt@apache.org", "creation_time": "2005-03-05T22:03:08Z", "text": "*** Bug 33832 has been marked as a duplicate of this bug. ***"}, {"count": 5, "tags": [], "text": "*** Bug 33909 has been marked as a duplicate of this bug. ***", "is_private": false, "id": 71992, "creation_time": "2005-03-08T18:36:24Z", "time": "2005-03-08T18:36:24Z", "creator": "remm@apache.org", "bug_id": 33463, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 33463, "attachment_id": null, "is_private": false, "id": 72786, "time": "2005-03-24T14:41:25Z", "creator": "remm@apache.org", "creation_time": "2005-03-24T14:41:25Z", "text": "*** Bug 34164 has been marked as a duplicate of this bug. ***"}]
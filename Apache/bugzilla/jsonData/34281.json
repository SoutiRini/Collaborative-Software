[{"count": 0, "tags": [], "bug_id": 34281, "text": "I'm getting this error when I try to execute 'build run-tests'.  If you look\nclosely at the file path, you'll notice that the schema (file:) is embedded in\nthe middle of the path name.\n\n    [junit] Testcase: test2(org.apache.tools.ant.IncludeTest):\tCaused an ERROR\n    [junit] java.io.FileNotFoundException: C:\\Documents and Settings\\kgreiner\\My\nDocuments\\Develop\\Apache\\ant\\src\\etc\\testcases\\core\\include\\frag#ment\\file:include.inc\n(The system cannot find the file specified)\n    [junit] java.io.FileNotFoundException: C:\\Documents and Settings\\kgreiner\\My\nDocuments\\Develop\\Apache\\ant\\src\\etc\\testcases\\core\\include\\frag#ment\\file:include.inc\n(The system cannot find the file specified)\n\nI've done quite a bit of testing and have traced this back to the resolveURI\nmethod in org.apache.crimson.parser.Parser2.  This class is part of the JDK\nrt.jar file so I know that I have the right version of the parser.\n\nThe error seems so unavoidable that this test must be expected to fail yet ant\nexits with\n\nBUILD FAILED\nC:\\Documents and Settings\\kgreiner\\My\nDocuments\\Develop\\Apache\\ant\\build.xml:1498: Tests failed", "id": 73227, "time": "2005-04-04T05:46:27Z", "creator": "kevin.greiner@compsol.cc", "creation_time": "2005-04-04T05:46:27Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 34281, "attachment_id": null, "text": "Why is crimson in the loop? Ant ships with a copy of Xerces for a reason, and\nthat is crimson is inadequate for Ant. \n\nwhat does -diagnostics say about XML parsers?", "id": 73237, "time": "2005-04-04T11:26:38Z", "creator": "stevel@apache.org", "creation_time": "2005-04-04T11:26:38Z", "is_private": false}, {"count": 2, "text": "-------------------------------------------\n XML Parser information\n-------------------------------------------\nXML Parser : org.apache.xerces.jaxp.SAXParserImpl\nXML Parser Location: C:\\Documents and Settings\\kgreiner\\My \nDocuments\\Develop\\Apache\\ant\\bootstrap\\lib\\xercesImpl.jar\n\nYet my debug says that JAXPUtils.getParserFactory() is returning \norg.apache.crimson.jaxp.SAXParserFactoryImpl.\n\nI'll debug further to see why javax.xml.parsers.SAXParserFactory is returning \nthe crimson parser.", "creator": "kevin.greiner@compsol.cc", "is_private": false, "id": 73244, "time": "2005-04-04T13:14:28Z", "bug_id": 34281, "creation_time": "2005-04-04T13:14:28Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "creator": "kevin.greiner@compsol.cc", "attachment_id": null, "text": "The JAXPUtils.getnamespaceXMLReader() call in ProjectHelper2.parse is returning \nthe crimson parser because the thread context classloader is, at the time of \nthe call, \"sun.misc.Launcher$AppClassLoader\".  That class loader contains the \nresource \"META-INF/services/javax.xml.parsers.SAXParserFactory\" that is defined \nwithin the rt.jar.\n", "id": 73245, "time": "2005-04-04T13:57:01Z", "bug_id": 34281, "creation_time": "2005-04-04T13:57:01Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 34281, "text": "I've traced this back to the junit code.  I turned on the jaxp debug and \nmodified JAXPUtils.getParserFactory to log a stack trace each time it was \ncalled.  There were several calls to getParserFactory that correctly returned \nthe Xerces parser. Then a new thread appeared and it loaded the crimson parser.\n\nI have junit.fork set to true so the new thread was expected.  It would appear \nthat JUnitTestRunner.main is failing to set the thread's context classloader.\n\nJAXP: found META-INF/services/javax.xml.parsers.SAXParserFactory\nJAXP: loaded from services: org.apache.crimson.jaxp.SAXParserFactoryImpl\njava.lang.Throwable: Calling getParserFactory in Thread[main,5,main]\n\tat org.apache.tools.ant.util.JAXPUtils.getParserFactory\n(JAXPUtils.java:81)\n\tat org.apache.tools.ant.helper.ProjectHelper2.parse\n(ProjectHelper2.java:193)\n\tat org.apache.tools.ant.helper.ProjectHelper2.parse\n(ProjectHelper2.java:141)\n\tat org.apache.tools.ant.ProjectHelper.configureProject\n(ProjectHelper.java:90)\n\tat org.apache.tools.ant.BuildFileTest.configureProject\n(BuildFileTest.java:231)\n\tat org.apache.tools.ant.BuildFileTest.configureProject\n(BuildFileTest.java:214)\n\tat org.apache.tools.ant.CaseTest.setUp(CaseTest.java:32)\n\tat junit.framework.TestCase.runBare(TestCase.java:125)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run\n(JUnitTestRunner.java:328)\n\tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch\n(JUnitTestRunner.java:736)\n\tat org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main\n(JUnitTestRunner.java:605)\n", "id": 73283, "time": "2005-04-05T09:59:21Z", "creator": "kevin.greiner@compsol.cc", "creation_time": "2005-04-05T09:59:21Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 34281, "is_private": false, "id": 73483, "attachment_id": 14670, "creator": "kevin.greiner@compsol.cc", "creation_time": "2005-04-10T08:18:16Z", "time": "2005-04-10T08:18:16Z", "text": "Created attachment 14670\nInclude Xerces in classpath of forked junit process\n\nThis bug is due to JUnitTask failing to include the xerces jar in Ant's runtime\nclasspath.  As a result, run-tests can only succeed when either A) fork=false,\nor B) you have xerces in your environment classpath.\n\nThe enclosed patch includes xerces in the ant runtime classpath so forked junit\nprocesses can find it without any additional help."}, {"count": 6, "tags": [], "text": "I'm not sure we should force load xerces into the forked junit process -maybe we\nshould just document better.", "is_private": false, "id": 104550, "creator": "stevel@apache.org", "time": "2007-06-20T06:14:05Z", "bug_id": 34281, "creation_time": "2007-06-20T06:14:05Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 34281, "text": "getting rid of Ant's XML parser has - at times - been the major reason for forking JUnit tests.", "id": 118730, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2008-07-16T09:01:22Z", "time": "2008-07-16T09:01:22Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "bug_id": 11417, "text": "Using Coyote behind Apache's 2.0.39 mod_proxy, I have experienced a livelock in \nTomcat.\n\nI created a stacktrace with jdb of the looping thread and it appears to be \nstuck inside Coyote (Apache is not doing anything). \n\nCoyote was built from CVS 11/7. It does not appear to be any commits that could \nhave solved the problem since then. \n\nStacktrace:\n\n [1] org.apache.coyote.http11.InternalInputBuffer.fill \n(InternalInputBuffer.java:777)\n [2] org.apache.coyote.http11.InternalInputBuffer$InputStreamInputBuffer.doRead \n(InternalInputBuffer.java:807)\n [3] org.apache.coyote.http11.filters.IdentityInputFilter.end \n(IdentityInputFilter.java:203)\n [4] org.apache.coyote.http11.InternalInputBuffer.endRequest \n(InternalInputBuffer.java:398)\n [5] org.apache.coyote.http11.Http11Processor.process (Http11Processor.java:418)\n [6] \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn (Http11Protocol.java:380)\n [7] org.apache.tomcat.util.net.TcpWorkerThread.runIt (PoolTcpEndpoint.java:508)\n [8] org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run \n(ThreadPool.java:518)\n [9] java.lang.Thread.run (Thread.java:536)", "id": 20605, "time": "2002-08-02T14:36:07Z", "creator": "amund.elstad@ergo.no", "creation_time": "2002-08-02T14:36:07Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 11417, "attachment_id": null, "text": "There's no syncing, so no possibility of a deadlock. The code will wait at that\npoint in the code when doing some keepalive, so everything looks normal.", "id": 20637, "time": "2002-08-04T11:40:41Z", "creator": "remm@apache.org", "creation_time": "2002-08-04T11:40:41Z", "is_private": false}, {"count": 2, "tags": [], "creator": "amund.elstad@ergo.no", "attachment_id": null, "id": 20652, "time": "2002-08-05T11:47:24Z", "bug_id": 11417, "creation_time": "2002-08-05T11:47:24Z", "is_private": false, "text": "I have done some further debugging:\n\nCoyote is stuck in the \"consume-extra-bytes\" loop in IdentifyInputFilter.end() \nbecause buffer.doRead() is returning -1, causing the \"remaining\" variable to \nincrement instead of decrement. It may terminate eventually when remaining \noverlows, but this still looks like a bug to me.\n\nThe read() at line 777 in InternalInputBuffer() is returning 0 (ie not blocking \nor throwing exception), probably because the connection is half-duplex \n(closed). I don't think you are guranteed an IOException in half-duplex state.\n\nI am using Java 1.4.0_01 server VM on WIN32. \n\n\n\n"}, {"attachment_id": null, "tags": [], "bug_id": 11417, "text": "The read() in InternalInputBuffer.fill is returning -1, not 0.", "count": 3, "id": 20654, "time": "2002-08-05T12:31:35Z", "creator": "amund.elstad@ergo.no", "creation_time": "2002-08-05T12:31:35Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 11417, "text": "Fixed in the CVS HEAD.", "count": 4, "id": 20769, "time": "2002-08-08T05:39:00Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-08-08T05:39:00Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Created attachment 34333\nMaven project with document corruption example\n\nAttaching a sample with a Word document that gets corrupted when we open it and save it to another file with a code like:\n\nfinal POIDocument doc = new HWPFDocument(new FileInputStream(DOCUMENT_NAME));\nfinal File copy = new File(CORRUPTED_PREFIX + \"-\" + DOCUMENT_NAME);\ndoc.write(copy);\n\nWhen trying to open source document it will open ok.\nWhen trying to open the document after load/save Microsoft Word reports that it is corrupted and cannot be recovered.", "attachment_id": 34333, "bug_id": 60217, "id": 194200, "time": "2016-10-07T14:11:55Z", "creator": "kostiantyn.miklevskyi@cosiconsulting.com", "creation_time": "2016-10-07T14:11:55Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 60217, "attachment_id": null, "id": 194207, "time": "2016-10-07T19:23:58Z", "creator": "jmarkmurphy@apache.org", "creation_time": "2016-10-07T19:23:58Z", "is_private": false, "text": "Can POI read the document after load/save?"}, {"count": 2, "tags": [], "bug_id": 60217, "attachment_id": 34340, "id": 194243, "time": "2016-10-08T22:16:16Z", "creator": "onealj@apache.org", "creation_time": "2016-10-08T22:16:16Z", "is_private": false, "text": "Created attachment 34340\noutput .doc file after running unit test\n\nUsing the DocumentWithOneTable.doc from your attachment, the unit test below creates the attached file. LibreOffice does not complain about this file. Can you check if Word reports that the attached file is corrupted?\n\nAdded to TestHPSFBugs.java:\npublic void test60217() throws Exception {\n    InputStream fis = new FileInputStream(\"/tmp/bug60217.doc\");\n    POIDocument doc = new HWPFDocument(fis);\n    fis.close();\n    doc.write(new File(\"/tmp/bug60217-out.doc\"));\n    doc.close();\n}"}, {"count": 3, "tags": [], "bug_id": 60217, "attachment_id": null, "id": 194292, "time": "2016-10-10T06:36:28Z", "creator": "kostiantyn.miklevskyi@cosiconsulting.com", "creation_time": "2016-10-10T06:36:28Z", "is_private": false, "text": ">Mark Murphy 2016-10-07 19:23:58 UTC\n>Can POI read the document after load/save?\n\nNo, it throws an exception.\nShould've provided this info in initial report as I actually tried it.\n\nHere's a code:\n\n        final POIDocument doc = new HWPFDocument(SaveToAnotherDocumentBug.class.getClassLoader().getResourceAsStream(DOCUMENT_NAME));\n        final File copy = new File(CORRUPTED_PREFIX + \"-\" + DOCUMENT_NAME);\n        doc.write(copy);\n        doc.close();\n\n        new HWPFDocument(new FileInputStream(copy));\n\nAnd it throws with this stacktrace:\n\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: -1845343745\n\tat org.apache.poi.util.LittleEndian.getUByte(LittleEndian.java:274)\n\tat org.apache.poi.hwpf.model.FormattedDiskPage.<init>(FormattedDiskPage.java:61)\n\tat org.apache.poi.hwpf.model.PAPFormattedDiskPage.<init>(PAPFormattedDiskPage.java:85)\n\tat org.apache.poi.hwpf.model.PAPBinTable.<init>(PAPBinTable.java:75)\n\tat org.apache.poi.hwpf.HWPFDocument.<init>(HWPFDocument.java:226)\n\tat org.apache.poi.hwpf.HWPFDocument.<init>(HWPFDocument.java:157)\n\tat org.apache.poi.hwpf.HWPFDocument.<init>(HWPFDocument.java:145)\n\tat com.cosi.SaveToAnotherDocumentBug.main(SaveToAnotherDocumentBug.java:20)"}, {"count": 4, "tags": [], "bug_id": 60217, "attachment_id": null, "text": ">Javen O'Neal 2016-10-08 22:16:16 UTC\n>Can you check if Word reports that the attached file is corrupted?\n\nYes. The same error message that Word reported previously.\nAttaching a screenshot.", "id": 194294, "time": "2016-10-10T06:41:24Z", "creator": "kostiantyn.miklevskyi@cosiconsulting.com", "creation_time": "2016-10-10T06:41:24Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 60217, "attachment_id": 34350, "id": 194295, "time": "2016-10-10T06:42:33Z", "creator": "kostiantyn.miklevskyi@cosiconsulting.com", "creation_time": "2016-10-10T06:42:33Z", "is_private": false, "text": "Created attachment 34350\nScreenshot of Word error message when opening a corrupted file"}, {"count": 6, "tags": [], "text": "Created attachment 34351\nLibreOffice 5.2.2.2 original file and corrupted file side-to-side\n\nDownloaded latest stable LibreOffice version 5.2.2.2 and it indeed doesn't complain about the corruption but, so I opened original document and a corrupted one to show the difference.", "attachment_id": 34351, "bug_id": 60217, "id": 194296, "time": "2016-10-10T07:05:36Z", "creator": "kostiantyn.miklevskyi@cosiconsulting.com", "creation_time": "2016-10-10T07:05:36Z", "is_private": false}]
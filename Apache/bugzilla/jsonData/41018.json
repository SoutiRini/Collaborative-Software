[{"count": 0, "tags": [], "text": "It seems that including a global defined resource using ResourceLink is broken.\nThe link gets bound in JNDI, but retrieving it results in null being returned.\n\nThis was the case in Tomcat versions 5.5.12 and higher, I believe it is still\nbroken in Tomcat 6. See attached patch for a fix.", "attachment_id": null, "bug_id": 41018, "id": 96081, "time": "2006-11-22T07:48:59Z", "creator": "n.beekman@o3spaces.com", "creation_time": "2006-11-22T07:48:59Z", "is_private": false}, {"count": 1, "tags": [], "creator": "n.beekman@o3spaces.com", "attachment_id": 19159, "text": "Created attachment 19159\nPatch which fixes described problem.", "id": 96082, "time": "2006-11-22T07:52:43Z", "bug_id": 41018, "creation_time": "2006-11-22T07:52:43Z", "is_private": false}, {"count": 2, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "-1 for the patch. It's simply that Context.OBJECT_FACTORIES usage is not\nsupported at the moment (same for all the other reference types).", "id": 96087, "time": "2006-11-22T08:45:17Z", "bug_id": 41018, "creation_time": "2006-11-22T08:45:17Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "n.beekman@o3spaces.com", "is_private": false, "id": 96090, "time": "2006-11-22T09:50:39Z", "bug_id": 41018, "creation_time": "2006-11-22T09:50:39Z", "tags": [], "text": "(In reply to comment #2)\n> -1 for the patch. It's simply that Context.OBJECT_FACTORIES usage is not\n> supported at the moment (same for all the other reference types).\n\nI think it's rather strange to program a bug in getFactoryClassName() because of\nContext.OBJECT_FACTORIES being unsupported.\n\nHow about changing it into:\n\npublic String getFactoryClassName() {\n  String factory = super.getFactoryClassName();\n  if (factory != null) {\n    return factory;\n  } else {\n    return DEFAULT_FACTORY;\n  }\n}\n\nThat would work well in case a custom factory is passed to the constructor, and\nin case no factory (or null) is specified.\n\nOn a side note: I'm curious why this issue was never encountered, the\ndocumentation contains plenty of documentation about the global resources\nfeature, is it not recommended some way, or is it simply because no one uses it?"}, {"count": 4, "tags": [], "bug_id": 41018, "is_private": false, "text": "Obviously because there's no reason to set Context.OBJECT_FACTORIES, so people\ndon't do it, and they don't run into the unimplemented code.", "id": 96102, "time": "2006-11-22T13:51:25Z", "creator": "remm@apache.org", "creation_time": "2006-11-22T13:51:25Z", "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 96130, "time": "2006-11-23T15:14:10Z", "bug_id": 41018, "creation_time": "2006-11-23T15:14:10Z", "tags": [], "text": "ResourceLink works for me. If you have a test case (simplest possible jsp /\nservlet / war + source where appropriate) that demonstrates this issue please\nre-open this report and attach your test case."}, {"count": 6, "tags": [], "creator": "n.beekman@o3spaces.com", "attachment_id": null, "is_private": false, "id": 96163, "time": "2006-11-25T06:43:02Z", "bug_id": 41018, "creation_time": "2006-11-25T06:43:02Z", "text": "(In reply to comment #5)\n> ResourceLink works for me. If you have a test case (simplest possible jsp /\n> servlet / war + source where appropriate) that demonstrates this issue please\n> re-open this report and attach your test case.\n\nI found the problem: since Tomcat 5.5 you can use the Transaction-element\ninstead of the Resource-element, however this is unsupported/broken when used\ninside GlobalNamingResources-element. Hence I got null as result of the lookup.\nShould I file a new bug for this problem? The problem goes away when using the\nold-school Resource.\n\nYou are right about the patch, it does not solve this problem, I think I changed\ntwo things at once (applying the patch and using Resource instead of Transaction)."}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "I suggest you post to the users list to confirm that what you are trying to do\nis valid and that you have indeed found a bug. If the discussion on the users\nlists suggest that a bug does exist then please open a new issue.", "id": 96164, "time": "2006-11-25T06:56:47Z", "bug_id": 41018, "creation_time": "2006-11-25T06:56:47Z", "is_private": false}]
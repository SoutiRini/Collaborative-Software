[{"count": 0, "attachment_id": null, "creator": "daniil@orbisfn.com", "is_private": false, "id": 153157, "time": "2012-01-25T20:44:57Z", "bug_id": 52529, "creation_time": "2012-01-25T20:44:57Z", "tags": [], "text": "I have a cluster of 2 Tomcats, both are 7.0.14; the config for cluster is as follows:\n\n\n        <!-- Cluster configuration -->\n        <Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\" channelSendOptions=\"8\">\n\n            <Manager className=\"org.apache.catalina.ha.session.DeltaManager\" expireSessionsOnShutdown=\"false\" notifyListenersOnReplication=\"true\"/>\n            <Channel className=\"org.apache.catalina.tribes.group.GroupChannel\">\n                <Membership className=\"org.apache.catalina.tribes.membership.McastService\"\n                    address=\"228.0.0.4\" port=\"50000\" ttl=\"1\"\n                    frequency=\"500\" dropTime=\"3000\"\n                />\n\n                <Receiver className=\"org.apache.catalina.tribes.transport.nio.NioReceiver\"\n                    address=\"192.168.110.96\" port=\"8000\" autoBind=\"100\" selectorTimeout=\"5000\" maxThreads=\"6\"\n                />\n\n                <Sender className=\"org.apache.catalina.tribes.transport.ReplicationTransmitter\">\n                    <Transport className=\"org.apache.catalina.tribes.transport.nio.PooledParallelSender\"/>\n                </Sender>\n\n                <Interceptor className=\"org.apache.catalina.tribes.group.interceptors.TcpFailureDetector\"/>\n                <Interceptor className=\"org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor\"/>\n            </Channel>\n\n            <Valve className=\"org.apache.catalina.ha.tcp.ReplicationValve\" filter=\"\"/>\n            <Valve className=\"org.apache.catalina.ha.session.JvmRouteBinderValve\"/>\n            <ClusterListener className=\"org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener\"/>\n            <ClusterListener className=\"org.apache.catalina.ha.session.ClusterSessionListener\"/>\n        </Cluster>\n\nIt has started running this week. Thus far, every single day both Tomcats go offline and stop responding at around the same time due to the following error:\n\nTomcat 1 - 2012-01-25 14:58:09,246 [Tribes-Task-Receiver-3] ERROR org.apache.catalina.ha.session.DeltaManager- Manager [domain#]: Unable to receive message through TCP channel\njava.lang.NullPointerException\nTomcat 2 - 2012-01-25 15:00:24,427 [Tribes-Task-Receiver-5] ERROR org.apache.catalina.ha.session.DeltaManager- Manager [other domain#]: Unable to receive message through TCP channel\njava.lang.NullPointerException\n\nThis is followed by the following until both are stopped and restarted one at a time:\n2012-01-25 15:05:22,528 [Membership-MemberExpired.] INFO  org.apache.catalina.tribes.group.interceptors.TcpFailureDetector- Received memberDisappeared[org.apache.catalina.tribes.membership.MemberImpl[tcp://{192, 168, 110, 69}:8000,{192, 168, 110, 69},8000, alive=77417309, securePort=-1, UDP Port=-1, id={110 7 26 17 -17 -10 79 10 -107 -51 -64 70 -73 -50 116 -102 }, payload={}, command={}, domain={}, ]] message. Will verify.\n2012-01-25 15:05:22,528 [Membership-MemberExpired.] INFO  org.apache.catalina.tribes.group.interceptors.TcpFailureDetector- Verification complete. Member still alive[org.apache.catalina.tribes.membership.MemberImpl[tcp://{192, 168, 110, 69}:8000,{192, 168, 110, 69},8000, alive=77417309, securePort=-1, UDP Port=-1, id={110 7 26 17 -17 -10 79 10 -107 -51 -64 70 -73 -50 116 -102 }, payload={}, command={}, domain={}, ]]\n2012-01-25 15:07:23,278 [Membership-MemberExpired.] INFO  org.apache.catalina.tribes.group.interceptors.TcpFailureDetector- Received memberDisappeared[org.apache.catalina.tribes.membership.MemberImpl[tcp://{192, 168, 110, 69}:8000,{192, 168, 110, 69},8000, alive=77538070, securePort=-1, UDP Port=-1, id={110 7 26 17 -17 -10 79 10 -107 -51 -64 70 -73 -50 116 -102 }, payload={}, command={}, domain={}, ]] message. Will verify.\n2012-01-25 15:07:23,279 [Membership-MemberExpired.] INFO  org.apache.catalina.tribes.group.interceptors.TcpFailureDetector- Verification complete. Member still alive[org.apache.catalina.tribes.membership.MemberImpl[tcp://{192, 168, 110, 69}:8000,{192, 168, 110, 69},8000, alive=77538070, securePort=-1, UDP Port=-1, id={110 7 26 17 -17 -10 79 10 -107 -51 -64 70 -73 -50 116 -102 }, payload={}, command={}, domain={}, ]]\n\nThis is becoming a hurdle for our platform and I'm not sure where the problem happens as there's no stack trace in the causing exception. Is it possible to modify Tomcat's cluster logic to be highly fault tolerant? It seems that taking down whole Tomcat because something had happened during session sync to be a bad and quite dangerous logic."}, {"count": 1, "tags": [], "text": "1. You should consider upgrading. The issue looks like bug 51306 that is already fixed 6 months ago, but without a stacktrace it is hard to tell. Maybe you can reconfigure your logging to get more info.\n2. As documented, Bugzilla is not a support forum.", "is_private": false, "id": 153168, "creator": "knst.kolinko@gmail.com", "time": "2012-01-25T22:47:45Z", "bug_id": 52529, "creation_time": "2012-01-25T22:47:45Z", "attachment_id": null}]
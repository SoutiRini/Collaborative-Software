[{"count": 0, "tags": [], "creator": "daniel-john@gmx.net", "text": "+++ This bug was initially created as a clone of Bug #56420 +++\n\nWhen I use SUMIFS function in xlsx file.\nIf predicate value is cell and cell value is null, org.apache.poi.ss.formula.functions.Sumifs.accumulate method throws NullPointerException.\n\nThis is stack trace:\n\njava.lang.NullPointerException\nat org.apache.poi.ss.formula.functions.Sumifs.sumMatchingCells(Sumifs.java:138)\nat org.apache.poi.ss.formula.functions.Sumifs.evaluate(Sumifs.java:79)\nat org.apache.poi.ss.formula.UserDefinedFunction.evaluate(UserDefinedFunction.java:61)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:129)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:550)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:317)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:259)\nat org.apache.poi.xssf.usermodel.BaseXSSFFormulaEvaluator.evaluateFormulaCellValue(BaseXSSFFormulaEvaluator.java:65)\nat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateFormulaCellEnum(BaseFormulaEvaluator.java:193)\nat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateAllFormulaCells(BaseFormulaEvaluator.java:268)\nat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateAll(XSSFFormulaEvaluator.java:92)\n\nAnd this is the code that throws NullPointerException:\n\nif (!mp.matches(aeRange.getRelativeValue(r, c))) {\n                        matches = false;\n                        break;\n                    }\n\nIt is the same problem as in Bug #56420.", "id": 197634, "time": "2017-03-13T20:09:38Z", "bug_id": 60858, "creation_time": "2017-03-13T20:09:38Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 60858, "attachment_id": null, "text": "Can you try with the latest 3.16 nightly?  I suspect I fixed this when I completely redid SUMIFS() and COUNTIFS() for \n\nhttps://bz.apache.org/bugzilla/show_bug.cgi?id=56822\n\nin commit r1783037.", "id": 197635, "time": "2017-03-13T20:35:02Z", "creator": "gwoolsey@apache.org", "creation_time": "2017-03-13T20:35:02Z", "is_private": false}, {"count": 2, "tags": [], "creator": "daniel-john@gmx.net", "attachment_id": null, "id": 197649, "time": "2017-03-14T10:05:43Z", "bug_id": 60858, "creation_time": "2017-03-14T10:05:43Z", "is_private": false, "text": "Problem is still there:\n\nError while evaluating formula:IF(Q2=\"LT\",SUMIFS(O2:O1,N2:N1,N2,A2:A1,A2),\" \")\njava.lang.NullPointerException\nat org.apache.poi.ss.formula.functions.Baseifs.aggregateMatchingCells(Baseifs.java:138)\nat org.apache.poi.ss.formula.functions.Baseifs.evaluate(Baseifs.java:70)\nat org.apache.poi.ss.formula.functions.Sumifs.evaluate(Sumifs.java:42)\nat org.apache.poi.ss.formula.UserDefinedFunction.evaluate(UserDefinedFunction.java:61)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:129)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:523)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:290)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:232)\nat org.apache.poi.xssf.usermodel.BaseXSSFFormulaEvaluator.evaluateFormulaCellValue(BaseXSSFFormulaEvaluator.java:65)\nat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateInCell(BaseFormulaEvaluator.java:137)\nat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateInCell(XSSFFormulaEvaluator.java:77)\nat com.decadis.jira.xport.Exporter.createXSSFWorkbook2_0(Exporter.java:169)\nat com.decadis.jira.xport.rest.QuickExportRest.getWorkbook(QuickExportRest.java:310)\nat com.decadis.jira.xport.rest.QuickExportRest.access$0(QuickExportRest.java:238)\nat com.decadis.jira.xport.rest.QuickExportRest$1.write(QuickExportRest.java:94)\n\nBut the file I have produces more than one failure....\n\nI will attach it."}, {"count": 3, "tags": [], "creator": "daniel-john@gmx.net", "attachment_id": 34823, "id": 197651, "time": "2017-03-14T10:08:03Z", "bug_id": 60858, "creation_time": "2017-03-14T10:08:03Z", "is_private": false, "text": "Created attachment 34823\nComplex sheet producing a lot of errors while evaluating\n\nComplex sheet producing a lot of errors while evaluating:\n\nError while evaluating formula:IF(Q2=\"LT\",SUMIFS(O2:O1,N2:N1,N2,A2:A1,A2),\" \")\njava.lang.NullPointerException\nat org.apache.poi.ss.formula.functions.Baseifs.aggregateMatchingCells(Baseifs.java:138)\nat org.apache.poi.ss.formula.functions.Baseifs.evaluate(Baseifs.java:70)\nat org.apache.poi.ss.formula.functions.Sumifs.evaluate(Sumifs.java:42)\nat org.apache.poi.ss.formula.UserDefinedFunction.evaluate(UserDefinedFunction.java:61)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:129)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:523)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:290)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:232)\nat org.apache.poi.xssf.usermodel.BaseXSSFFormulaEvaluator.evaluateFormulaCellValue(BaseXSSFFormulaEvaluator.java:65)\nat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateInCell(BaseFormulaEvaluator.java:137)\nat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateInCell(XSSFFormulaEvaluator.java:77)\n\n--------------------------\n\nError while evaluating formula:IF(Q2=\"LT\",SUMIFS(E2:E1,N2:N1,N2,A2:A1,A2)-X2,\" \")\njava.lang.NullPointerException\nat org.apache.poi.ss.formula.functions.Baseifs.aggregateMatchingCells(Baseifs.java:138)\nat org.apache.poi.ss.formula.functions.Baseifs.evaluate(Baseifs.java:70)\nat org.apache.poi.ss.formula.functions.Sumifs.evaluate(Sumifs.java:42)\nat org.apache.poi.ss.formula.UserDefinedFunction.evaluate(UserDefinedFunction.java:61)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:129)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:523)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:290)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:232)\nat org.apache.poi.xssf.usermodel.BaseXSSFFormulaEvaluator.evaluateFormulaCellValue(BaseXSSFFormulaEvaluator.java:65)\nat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateInCell(BaseFormulaEvaluator.java:137)\nat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateInCell(XSSFFormulaEvaluator.java:77)\n\n\n-----------------\nError while evaluating formula:IF(V2=0,IF(Q2<>\"LT\",\" \",IF(G2<=6,\" \",IF(AND(G2<=9,F2>=0.02),\" \",IF(F2>=0.03,\" \",\"zu kurze Pausen\")))),\" \")\njava.lang.NullPointerException\nat org.apache.poi.ss.formula.functions.Baseifs.aggregateMatchingCells(Baseifs.java:138)\nat org.apache.poi.ss.formula.functions.Baseifs.evaluate(Baseifs.java:70)\nat org.apache.poi.ss.formula.functions.Sumifs.evaluate(Sumifs.java:42)\nat org.apache.poi.ss.formula.UserDefinedFunction.evaluate(UserDefinedFunction.java:61)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:129)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:523)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:290)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateReference(WorkbookEvaluator.java:723)\nat org.apache.poi.ss.formula.SheetRefEvaluator.getEvalForCell(SheetRefEvaluator.java:48)\nat org.apache.poi.ss.formula.SheetRangeEvaluator.getEvalForCell(SheetRangeEvaluator.java:74)\nat org.apache.poi.ss.formula.LazyRefEval.getInnerValueEval(LazyRefEval.java:39)\nat org.apache.poi.ss.formula.eval.OperandResolver.chooseSingleElementFromRef(OperandResolver.java:179)\nat org.apache.poi.ss.formula.eval.OperandResolver.getSingleValue(OperandResolver.java:62)\nat org.apache.poi.ss.formula.eval.RelationalOperationEval.evaluate(RelationalOperationEval.java:64)\nat org.apache.poi.ss.formula.functions.Fixed2ArgFunction.evaluate(Fixed2ArgFunction.java:33)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:119)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:523)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:290)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:232)\nat org.apache.poi.xssf.usermodel.BaseXSSFFormulaEvaluator.evaluateFormulaCellValue(BaseXSSFFormulaEvaluator.java:65)\nat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateInCell(BaseFormulaEvaluator.java:137)\nat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateInCell(XSSFFormulaEvaluator.java:77)\n\n----------------------------\n\nError while evaluating formula:IF(G2<>\" \",IF(G2>10,G2-10,\" \"),\" \")\njava.lang.NullPointerException\nat org.apache.poi.ss.formula.functions.Baseifs.aggregateMatchingCells(Baseifs.java:138)\nat org.apache.poi.ss.formula.functions.Baseifs.evaluate(Baseifs.java:70)\nat org.apache.poi.ss.formula.functions.Sumifs.evaluate(Sumifs.java:42)\nat org.apache.poi.ss.formula.UserDefinedFunction.evaluate(UserDefinedFunction.java:61)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:129)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:523)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:290)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateReference(WorkbookEvaluator.java:723)\nat org.apache.poi.ss.formula.SheetRefEvaluator.getEvalForCell(SheetRefEvaluator.java:48)\nat org.apache.poi.ss.formula.SheetRangeEvaluator.getEvalForCell(SheetRangeEvaluator.java:74)\nat org.apache.poi.ss.formula.LazyRefEval.getInnerValueEval(LazyRefEval.java:39)\nat org.apache.poi.ss.formula.eval.OperandResolver.chooseSingleElementFromRef(OperandResolver.java:179)\nat org.apache.poi.ss.formula.eval.OperandResolver.getSingleValue(OperandResolver.java:62)\nat org.apache.poi.ss.formula.eval.RelationalOperationEval.evaluate(RelationalOperationEval.java:64)\nat org.apache.poi.ss.formula.functions.Fixed2ArgFunction.evaluate(Fixed2ArgFunction.java:33)\nat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:119)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:523)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:290)\nat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:232)\nat org.apache.poi.xssf.usermodel.BaseXSSFFormulaEvaluator.evaluateFormulaCellValue(BaseXSSFFormulaEvaluator.java:65)\nat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateInCell(BaseFormulaEvaluator.java:137)\nat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateInCell(XSSFFormulaEvaluator.java:77)\n\n------------------------------"}, {"count": 4, "tags": [], "bug_id": 60858, "attachment_id": null, "text": "Thank you for the test file and stack trace.  I was able to confirm the regression introduced by the refactoring to fix #56822, add your file as a unit test, and fix the bug in r1786953.", "id": 197665, "time": "2017-03-14T21:42:33Z", "creator": "gwoolsey@apache.org", "creation_time": "2017-03-14T21:42:33Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 60858, "text": "Hi Greg,\n\ngreat Job! Thank you!", "count": 5, "id": 197669, "time": "2017-03-15T08:56:47Z", "creator": "daniel-john@gmx.net", "creation_time": "2017-03-15T08:56:47Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "wbeckwith@directlink.net", "is_private": false, "text": "When using ant with the \"-projecthelp\" option, variable substitution does not \nhappen.  A description=\"blah blah blah ${basedir}\" in a target, prints blah \nblah blah ${basedir} instead of blah blah blah d:/foo.\n\nThere is abug in the Project.copyFile() method.  When ant tries to copy over a \nfile that is readonly then it failes, even if overwrite is set to true (at \nleast on Windows, where this was tested).  To fix this problem, if ant is going \nto overwrite the file, then it should delete the destination file first, since \nit's going to destroy the current contents anyway.  A patch addressing both \nthese issues is included.\n\nIndex: Main.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-ant/src/main/org/apache/tools/ant/Main.java,v\nretrieving revision 1.34\ndiff -u -r1.34 Main.java\n--- Main.java\t2001/05/10 15:22:41\t1.34\n+++ Main.java\t2001/05/14 14:54:34\n@@ -552,7 +552,7 @@\n         while (ptargets.hasMoreElements()) {\n             currentTarget = (Target)ptargets.nextElement();\n             targetName = currentTarget.getName();\n-            targetDescription = currentTarget.getDescription();\n+            targetDescription = ProjectHelper.replaceProperties(project, \ncurrentTarget.getDescription(), project.getProperties());\n             // maintain a sorted list of targets\n             if (targetDescription == null) {\n                 int pos = findTargetPosition(subNames, targetName);\nIndex: Project.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-\nant/src/main/org/apache/tools/ant/Project.java,v\nretrieving revision 1.57\ndiff -u -r1.57 Project.java\n--- Project.java\t2001/05/08 09:35:28\t1.57\n+++ Project.java\t2001/05/14 14:54:56\n@@ -761,6 +761,8 @@\n             if (!parent.exists()) {\n                 parent.mkdirs();\n             }\n+            \n+            destFile.delete();\n \n             if (filtering) {\n                 BufferedReader in = new BufferedReader(new FileReader\n(sourceFile));", "id": 2432, "time": "2001-05-14T08:17:08Z", "bug_id": 1741, "creation_time": "2001-05-14T08:17:08Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "The -projecthelp option does not \"run\" the project and there is therefore no \nguarantee that property values will be set. Whilst that may be true in the \ncurrent implementation it may not be the same in future versions. Therefore I \ndo not believe we should apply this patch.\n\nThere may be a case for more dynamic help from targets. This is achievable to \nsome extent today by the use of a \"help\" target and an <echo> target. \n\nAs for the failure to overwrite read-only files, this will not be changed. If a \nfile is readonly, I don't believe Ant should delete write over it. If you want \nto delete it you should use an explicit <delete> task prior to the copy.\n\n(BTW, in future, it would be better to raise two bug reports for these issues \nseparate so we can take distinct actions. Not necessary fro this case)", "is_private": false, "id": 2528, "creator": "conor@apache.org", "time": "2001-05-18T07:13:45Z", "bug_id": 1741, "creation_time": "2001-05-18T07:13:45Z", "attachment_id": null}]
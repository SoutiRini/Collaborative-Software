[{"count": 0, "tags": [], "bug_id": 43295, "is_private": false, "id": 107656, "attachment_id": null, "creator": "bugzilla@chrispaton.co.uk", "creation_time": "2007-09-03T05:47:44Z", "time": "2007-09-03T05:47:44Z", "text": "I've just started using Zeroconf in my log4j enabled applications and am having\nproblems running more than application that uses Zeroconf on the same machine. I\nhope this is the appropriate place to report this problem.\n\nI downloaded the latest release of Chainsaw (2006-03-02), and added the provided\njmdns.jar and log4j-zeroconf.jar to my apps' classpath. I then amended my log4j\nconfiguration to use the ZeroConfSocketHubAppender. One of my apps uses\nlog4j-1.2.8, the other uses the version that ships with JBoss 4.0.4.GA (the Jar\nis un-numbered so I'm not sure exactly).\n\nI was able to successfully start one of my apps and receive logging events in\nChainsaw. When I came to start my second app I got:\nlog4j:ERROR exception setting timeout, shutting down server socket.\njava.net.BindException: Address already in use\n\tat java.net.PlainSocketImpl.socketBind(Native Method)\n\tat java.net.PlainSocketImpl.bind(PlainSocketImpl.java:359)\n\tat java.net.ServerSocket.bind(ServerSocket.java:319)\n\tat java.net.ServerSocket.<init>(ServerSocket.java:185)\n\tat java.net.ServerSocket.<init>(ServerSocket.java:97)\n\tat\norg.apache.log4j.net.SocketHubAppender$ServerMonitor.run(SocketHubAppender.java:315)\n\tat java.lang.Thread.run(Thread.java:595)\n\nThe application popped up as expected in the Zeroconf tab in Chainsaw, but no\nlogging events came through, even when they appeared in my console logger. I\nnote that both my first and second apps had the same address:port value (port\n4560) in Chainsaw's Zeroconf tab.\n\nHaving had a glance through the latest source in SVN, it seems like\nZeroConfSocketHubAppender always uses SocketHubAppender's default port (4560).\nThus when I start my second app it's unsurprising that it is unable to open a\nsocket on that port. I guess a fix would involve ZeroConfSocketHubAppender\nretrying on a different port (e.g. +1) until it finds a free one."}, {"count": 1, "tags": [], "bug_id": 43295, "is_private": false, "id": 107671, "attachment_id": null, "creator": "psmith@apache.org", "creation_time": "2007-09-03T16:24:38Z", "time": "2007-09-03T16:24:38Z", "text": "You'll need to edit your log4j configuration file for each\nZeroconfSocketHubAppender entry and specify the 'Port' property you want to use.  \n\nSince ZeroconfSocketHubAppender is simply a child of the standard\nSocketHubAppender, all the standard parameters can be tweaked to your\nrequirement.  The Zeroconf bit simply broadcasts those configurations across the\nnetwork.\n\nI don't think this is a bug.. ?"}, {"count": 2, "tags": [], "bug_id": 43295, "is_private": false, "id": 107684, "attachment_id": null, "creator": "bugzilla@chrispaton.co.uk", "creation_time": "2007-09-04T03:06:47Z", "time": "2007-09-04T03:06:47Z", "text": "(In reply to comment #1)\n> You'll need to edit your log4j configuration file for each\n> ZeroconfSocketHubAppender entry and specify the 'Port' property you want to use.\nRight you are Paul. I didn't pick up on this because, as you point out,\nZeroconfSocketHubAppender is a subclass of SocketHubAppender, which I didn't\nread closely enough. I was going to suggest adding this helpful message to an\nFAQ or documentation, but I suppose people may stumble across this bug on Google\nanyway.\n\n> I don't think this is a bug.. ?\nIndeed, sorry for the hassle and thanks for the help."}, {"count": 3, "tags": [], "creator": "lilianne_blaze@tlen.pl", "attachment_id": null, "id": 107722, "time": "2007-09-04T12:53:17Z", "bug_id": 43295, "creation_time": "2007-09-04T12:53:17Z", "is_private": false, "text": "Then maybe add a \"randomPort\" property? It is a pain when developing X projects\nto assign unique numbers to each one."}, {"count": 4, "tags": [], "bug_id": 43295, "text": "randomness doesn't guarantee uniqueness though..  ", "id": 107726, "attachment_id": null, "creator": "psmith@apache.org", "creation_time": "2007-09-04T14:49:21Z", "time": "2007-09-04T14:49:21Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 43295, "attachment_id": null, "text": "\"randomFreePort\" then? Choose one above 1024, try it, choose another if\nBindException, etc?", "id": 107727, "time": "2007-09-04T14:54:22Z", "creator": "lilianne_blaze@tlen.pl", "creation_time": "2007-09-04T14:54:22Z", "is_private": false}, {"count": 6, "tags": [], "text": "(In reply to comment #5)\n> \"randomFreePort\" then? Choose one above 1024, try it, choose another if\n> BindException, etc?\n\nHaving used Zeroconf/Chainsaw for another couple of weeks, this idea quite\nappeals to me.\n\nI set up each of my apps to use different ports (4561, 4562, etc.) in order to\nprevent the apps from conflicting with each other. While helpful, this doesn't\nwork around the situation where I want to launch the same app twice. As such, a\nrandom port property could be very useful. I'd be prepared to work on this if\npeople think it's useful...?", "is_private": false, "bug_id": 43295, "id": 108241, "time": "2007-09-16T09:17:14Z", "creator": "bugzilla@chrispaton.co.uk", "creation_time": "2007-09-16T09:17:14Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 43295, "text": "The more I think about it, the more I too think this is a good idea, but only in\nthe ZeroConfSocketHubAppender case.  That is, I don't think we should modify the\nparent class to add that behavior, but allow the ZeroConf child appender class\nto choose a random port. I believe passing a port value of 0 to the internal\nJava Socket classes ends up choosing a random port IIRC.\n\nI was planning on having a crack at this but I may not get to it, so if anyone\nbeats me to the punch feel free to attach a patch for consideration.", "id": 108245, "attachment_id": null, "creator": "psmith@apache.org", "creation_time": "2007-09-16T14:55:14Z", "time": "2007-09-16T14:55:14Z", "is_private": false}, {"count": 8, "text": "This is not as isolated as I would have liked.  I cannot find any way to do this\nwithout exposing the ServerMonitor object embedded in SocketHubAppender as a\nprotected variable, or adding a new 'actualPortUsed' variable initialised by the\nconstruction of the ServerSocket.  \n\nSetting the 'port' property of the SocketHubAppender to 0 gives you a random\nport, but the zeroconf broadcast won't see which port is actually used (it'll\nsimply broadcast '0' ).\n\nThe ZeroConfSocketHubAppender would need to call super.activateOptions() and\nthen wait a certain period of time to ensure the background ServerMonitor thread\nto initialise properly before inspecting the 'actualPortUsed' variable.   Seems\na bit hacky.\n\nThis would also require a log4j change as well obviously.\n\nThe alternative is to rewrite the SocketHubAppender inside the ZeroConf project,\nwhich isn't that appealing either.\n\nAnyone else have any ideas?", "bug_id": 43295, "is_private": false, "id": 108251, "time": "2007-09-16T20:10:14Z", "creator": "psmith@apache.org", "creation_time": "2007-09-16T20:10:14Z", "tags": [], "attachment_id": null}, {"count": 9, "tags": [], "text": "Are there any news and/or ETA on this?", "is_private": false, "bug_id": 43295, "id": 114150, "time": "2008-02-29T16:05:00Z", "creator": "lilianne_blaze@tlen.pl", "creation_time": "2008-02-29T16:05:00Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 43295, "attachment_id": null, "id": 114396, "time": "2008-03-06T21:48:11Z", "creator": "psmith@apache.org", "creation_time": "2008-03-06T21:48:11Z", "is_private": false, "text": "(slow response I know).  A change to log4j is required for this to work, which is currently targetted for 1.2.16 release.\n\nI'm amending the zeroconf package to take advantage of that; it will require you to upgrade to log4j 1.2.16 once released though, but that should easy enough."}, {"count": 11, "tags": [], "bug_id": 43295, "attachment_id": null, "text": "Just for the record, this is in the code in trunk, so those impatient may use that.", "id": 118120, "time": "2008-06-30T12:41:32Z", "creator": "thorbjoern@gmail.com", "creation_time": "2008-06-30T12:41:32Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 43295, "is_private": false, "id": 118143, "attachment_id": null, "creator": "psmith@apache.org", "creation_time": "2008-06-30T15:20:48Z", "time": "2008-06-30T15:20:48Z", "text": "I forgot to mark this as fixed.  It has a dependency on log4j 1.2.16-SNAPSHOT, so you'll need to run that to take advantage of it."}]
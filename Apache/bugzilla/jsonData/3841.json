[{"attachment_id": null, "tags": [], "bug_id": 3841, "text": "The start() method of EmbeddedManager.java reports its state incorrectly if\nEmbedded.java:start() throws an exception.  The \"catch\" block looks OK, it sets\nthe state to \"Stopped\", but the problem is that the code after the catch then\ngets executed and sends an erroneous AttributeChangeNotification to the JMX\nMBean Server.\n\nThe fix is to put the AttributeChangeNotification into the try{} block, so that\nit won't run if an error is thrown.  Here's a patch:\n\nIndex: catalina/src/share/org/apache/catalina/startup/EmbeddedManager.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-4.0/catalina/src/share/org/apache/catalina/startup/EmbeddedManager.java,v\nretrieving revision 1.3\ndiff -u -r1.3 EmbeddedManager.java\n--- catalina/src/share/org/apache/catalina/startup/EmbeddedManager.java\t2001/07/22 20:25:13\t1.3\n+++ catalina/src/share/org/apache/catalina/startup/EmbeddedManager.java\t2001/09/26 16:19:17\n@@ -192,6 +192,13 @@\n \n             embedded.start();\n \n+\n    state = STARTED;\n+\n    notification = new AttributeChangeNotification\n+\n\t(this, sequenceNumber++, System.currentTimeMillis(),\n+\n\t \"Started \" + NAME, \"State\", \"java.lang.Integer\",\n+\n\t new Integer(STARTING), new Integer(STARTED));\n+\n    sendNotification(notification);\n+\n         } catch (Throwable t) {\n             state = STOPPED;\n             notification = new AttributeChangeNotification\n@@ -200,13 +207,6 @@\n                  new Integer(STARTING), new Integer(STOPPED));\n             sendNotification(notification);\n         }\n-\n-        state = STARTED;\n-        notification = new AttributeChangeNotification\n-            (this, sequenceNumber++, System.currentTimeMillis(),\n-             \"Started \" + NAME, \"State\", \"java.lang.Integer\",\n-             new Integer(STARTING), new Integer(STARTED));\n-        sendNotification(notification);\n \n     }", "count": 0, "id": 6057, "time": "2001-09-26T10:49:42Z", "creator": "toby@caboteria.org", "creation_time": "2001-09-26T10:49:42Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 3841, "text": "Fixed. Thanks for the patch.", "id": 6061, "time": "2001-09-26T11:57:23Z", "creator": "remm@apache.org", "creation_time": "2001-09-26T11:57:23Z", "is_private": false, "attachment_id": null}]
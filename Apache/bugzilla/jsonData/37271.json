[{"count": 0, "tags": [], "creator": "Ian.Bray@logicacmg.com", "attachment_id": null, "text": "When Tomcat is started using org.apache.catalina.startup.Embedded and \ndeployer.install() is called several (eg 5) times in quick succession the \nservlet contexts may be incompletely deployed.\n\nGiven this problem, after deployment when in use requests to a URL \n(eg. /localhost/eaifclient) are being rejected with a 302 response indicating \na redirect to the same URL but with \"/\" appended (eg./localhost/eaifclient/) \nThis appears to be random. The same request can be repeated and will \nsporadically pass or fail each time the application using embedded Tomcat is \nre-started.\n\nAnalysis shows that after deployment, in the cases where incoming HTTP \nrequests succeeded Mapper::internalMapWrapper() was able to find a wild card \nmapping in rule 2 (prefix match) for the context \"eaifclient\".  When the \nrequest fails, rule 2 does not find the wildcard mapping and sets the redirect \npath because the context.wildcardWrappers array is empty.\n\nThe web.xml for each of the servlets contain mappings similar to the following:\n  <servlet-mapping>\n    <servlet-name>eaifclient</servlet-name>\n    <url-pattern>*</url-pattern>\n  </servlet-mapping>\n\nThere appears to be a race condition within the JMX deployment of the contexts.\n\nAnalysis of this theory revealed that in the cases where incoming HTTP \nrequests failed, there are fewer the JMX triggered calls during deployment to \nthe addWrapper()  methods compared with the number of calls in successful \ncases.  addWrapper(Context context, String path, Object wrapper, boolean \njspWildCard) soes not called to set a wrapper ending with \"/*\" for the servlet \ncontext of the requests that fail.\n\nThe problems do not occur if the contexts are deployed using \nembedded.createContext() before Tomcat is started.\n\nThe java version on HPUX is 1.4.2.08-050401-17:46.  The problem also occurs \nvery occasionally on Windows XP running java 1.4.2_08.", "id": 81828, "time": "2005-10-27T16:28:48Z", "bug_id": 37271, "creation_time": "2005-10-27T16:28:48Z", "is_private": false}, {"count": 1, "tags": [], "text": "Deployment had a major rewrite for the 5.5.x branch which should have resolved\nissues like this (I don't recall any bugs like this for 5.5.x). There is\nunlikely to be any further releases on the 5.0.x branch so I am marking this as\nWONTFIX.", "attachment_id": null, "id": 95090, "creator": "markt@apache.org", "time": "2006-10-25T19:55:58Z", "bug_id": 37271, "creation_time": "2006-10-25T19:55:58Z", "is_private": false}]
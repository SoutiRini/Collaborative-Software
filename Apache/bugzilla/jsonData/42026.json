[{"count": 0, "text": "Xindice has several concurrency problems that appear when several threads\nexecute different operation on the same resource, i.e. one thread adds a\ndocument when another deletes a document with the same key, or two threads\nadding documents with the same key. Most often it results in exception, but even\nwhen it does not throw an exception, the database integrity can be broken, as\none document ended up in a filer, another document got indexed. BTreeFiler has a\ntendency to lose pages in those conditions (means that page is obtained but not\nlinked to the tree). And so on... \nPatch attached.", "bug_id": 42026, "attachment_id": null, "id": 101350, "time": "2007-04-02T19:26:18Z", "creator": "nshilenkova@gmail.com", "creation_time": "2007-04-02T19:26:18Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "nshilenkova@gmail.com", "text": "Created attachment 19895\nPatch\n\nConcurrency, BTree & other fixes. Additional tests.", "id": 101351, "time": "2007-04-02T19:30:57Z", "bug_id": 42026, "creation_time": "2007-04-02T19:30:57Z", "is_private": false, "attachment_id": 19895}, {"count": 2, "attachment_id": null, "bug_id": 42026, "is_private": false, "id": 101597, "time": "2007-04-11T15:29:24Z", "creator": "vgritsenko@apache.org", "creation_time": "2007-04-11T15:29:24Z", "tags": [], "text": "Applied parts of the patch. Unfortunately patch for Collection class could not\nbe applied due to merge conflicts. Would you mind re-submitting the patch\nagainst latest version of Collection class?\n\nAlso, in CollectionManager class, I noticed synchronized block against map's\nvalues collection:\n\n    public boolean close() throws DBException {\n        java.util.Collection values = collections.values();\n        synchronized (values) {\n\nEverywhere else synchronization is done against collections map itself. Can you\nexplain why here synchronization is done on values?\n\nThanks\nVadim"}, {"count": 3, "tags": [], "creator": "nshilenkova@gmail.com", "text": "(In reply to comment #2)\n> Applied parts of the patch. Unfortunately patch for Collection class could not\n> be applied due to merge conflicts. Would you mind re-submitting the patch\n> against latest version of Collection class?\n\nWill do.\n \n> Also, in CollectionManager class, I noticed synchronized block against map's\n> values collection:\n> \n>     public boolean close() throws DBException {\n>         java.util.Collection values = collections.values();\n>         synchronized (values) {\n> \n> Everywhere else synchronization is done against collections map itself. Can you\n> explain why here synchronization is done on values?\n\nSure I can. After some experimenting I forgot to change it back to synchronize\non collection :) Thanks for noticing the problem.\n\nNatalia\n", "id": 101694, "time": "2007-04-13T18:39:47Z", "bug_id": 42026, "creation_time": "2007-04-13T18:39:47Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": 19956, "bug_id": 42026, "is_private": false, "id": 101696, "time": "2007-04-13T18:44:32Z", "creator": "nshilenkova@gmail.com", "creation_time": "2007-04-13T18:44:32Z", "tags": [], "text": "Created attachment 19956\nUpdate\n\nCollection and CollectionManager classes updates.\nPlease let me know if you need updates for some other classes as well."}, {"count": 5, "attachment_id": null, "bug_id": 42026, "text": "applied", "id": 101908, "time": "2007-04-18T18:48:22Z", "creator": "vgritsenko@apache.org", "creation_time": "2007-04-18T18:48:22Z", "tags": [], "is_private": false}]
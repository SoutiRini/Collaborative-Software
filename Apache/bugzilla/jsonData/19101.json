[{"attachment_id": null, "tags": [], "creator": "smagoun@mac.com", "is_private": false, "count": 0, "id": 35391, "time": "2003-04-17T02:12:43Z", "bug_id": 19101, "creation_time": "2003-04-17T02:12:43Z", "text": "In trying to speed up my builds, I ran ant with the -Xprof option to see what\nwhat slow. According to the profiler, an inordinate amount of time was being\nspent in Vector.size(). The profiler also showed that\nProject.fireMessageLoggedEvent() was chewing up a lot of time, so I started\nlooking there.\n\nIt turns out a simple optimization sped up my build from 1:45 to 1:30 (about\n15%). The optimization is to pull the call to listeners.size() out of the loop.\n\nFrom this:\n\n            loggingMessage = true;                \n            for (int i = 0; i < listeners.size(); i++) {\n                BuildListener listener = (BuildListener) listeners.elementAt(i);\n\nTo this:\n\n            loggingMessage = true;                \n            int size = listeners.size();\n            for (int i = 0; i < size; i++) {\n                BuildListener listener = (BuildListener) listeners.elementAt(i);\n\n\nIt's not a huge speedup (about 15%) but it makes a difference.\n\nI'm using Ant 1.5.3-1 (compiled from source, obviously) on a 1ghz Powerbook\nrunning OS X 10.2.5 and JDK 1.4.1. My build doesn't have any custom build\nlisteners, just the default.\n\nIf this fix can't be implemented for some reason, please leave this bug open -\nIMHO this is a defect that needs to be fixed."}, {"count": 1, "tags": [], "creator": "smagoun@mac.com", "attachment_id": 5871, "id": 35392, "time": "2003-04-17T02:16:13Z", "bug_id": 19101, "creation_time": "2003-04-17T02:16:13Z", "is_private": false, "text": "Created attachment 5871\nXprof profile from Ant 1.5.3-1"}, {"attachment_id": 5872, "tags": [], "creator": "smagoun@mac.com", "is_private": false, "count": 2, "id": 35393, "time": "2003-04-17T02:17:01Z", "bug_id": 19101, "creation_time": "2003-04-17T02:17:01Z", "text": "Created attachment 5872\nXprof profile from ant 1.5.3-1 with fix described in bug report"}, {"count": 3, "tags": [], "bug_id": 19101, "attachment_id": null, "text": "Applied - thanks ", "id": 35397, "time": "2003-04-17T04:53:37Z", "creator": "conor@apache.org", "creation_time": "2003-04-17T04:53:37Z", "is_private": false}, {"count": 4, "tags": [], "creator": "ddevienne@lgc.com", "attachment_id": null, "id": 35421, "time": "2003-04-17T14:02:58Z", "bug_id": 19101, "creation_time": "2003-04-17T14:02:58Z", "is_private": false, "text": "I also tend to make such an optimization, but add the final keyword to the \ncount variable, so make it absolutely clear to an optimizer it can agressively \nunroll the loop potentially. Not sure if it makes a difference in this case. --\nDD"}, {"count": 5, "attachment_id": null, "bug_id": 19101, "is_private": false, "id": 143961, "time": "2011-02-03T14:43:42Z", "creator": "xiaoming@cs.wisc.edu", "creation_time": "2011-02-03T14:43:42Z", "tags": [], "text": "Hi dude,\n\nI find that in the latest version of ANT, another place has the same problem\n\n./apache-ant-1.8.2/src/main/org/apache/tools/ant/Main.java   line:862\n\n(In reply to comment #0)\n> In trying to speed up my builds, I ran ant with the -Xprof option to see what\n> what slow. According to the profiler, an inordinate amount of time was being\n> spent in Vector.size(). The profiler also showed that\n> Project.fireMessageLoggedEvent() was chewing up a lot of time, so I started\n> looking there.\n> \n> It turns out a simple optimization sped up my build from 1:45 to 1:30 (about\n> 15%). The optimization is to pull the call to listeners.size() out of the loop.\n> \n> From this:\n> \n>             loggingMessage = true;                \n>             for (int i = 0; i < listeners.size(); i++) {\n>                 BuildListener listener = (BuildListener) listeners.elementAt(i);\n> \n> To this:\n> \n>             loggingMessage = true;                \n>             int size = listeners.size();\n>             for (int i = 0; i < size; i++) {\n>                 BuildListener listener = (BuildListener) listeners.elementAt(i);\n> \n> \n> It's not a huge speedup (about 15%) but it makes a difference.\n> \n> I'm using Ant 1.5.3-1 (compiled from source, obviously) on a 1ghz Powerbook\n> running OS X 10.2.5 and JDK 1.4.1. My build doesn't have any custom build\n> listeners, just the default.\n> \n> If this fix can't be implemented for some reason, please leave this bug open -\n> IMHO this is a defect that needs to be fixed."}]
[{"count": 0, "tags": [], "text": "When creating an executable JAR, the resultant classpath entry in the manifest \nis unreadable by the JDK/JRE.\n\nI've seen the bug reports that have been marked as being invalid due to the \nspec, but it's still not being handled correctly.  I'm not sure if it's a case \nof missing the right line continuation, or the word breaking.\n\nhere's the task snippet\n\n<fileset id=\"tempt\" dir=\"${neweden.client-bld.dir}\" includes=\"*.jar\" />\n\n<path id='client.classpath.id'>\n\t<fileset dir=\"${neweden.client-bld.dir}\" includes=\"*.jar\" />\n</path>\n\n<pathconvert \n  pathsep=\" \" \n  refid='client.classpath.id' \n  property='client.classpath'>\n\n   <map from=\"C:\\source\\issues\\build\\client\\\" \n        to=\"\"/>\n</pathconvert>\n\n<echo> ${client.classpath} </echo>\n\n <jar\n      destfile=\"/source/issueclient2.jar\"\n      basedir=\"${neweden.client-bld.dir}\"\n      compress=\"false\" >\n\n      <manifest>\n        <attribute name=\"Class-Path\" value=\"${client.classpath}\"/>\n        <attribute name=\"Main-Class\" value=\"com.foo.MainClass\"/>\n      </manifest>\n\n\nI will attempt to attach the physical file, but just in case, I've pasted it \nhere, placing an asterisk at the end of the line for each line:\n\nManifest-Version: 1.0*\nAnt-Version: Apache Ant 1.6.0*\nCreated-By: 1.4.2_02-b03 (Sun Microsystems Inc.)*\nMain-Class: com.foo.MainClass*\nClass-Path: JCalendar4.jar MDateSelector.jar forms-1.0.2.jar j2ee.jar *\n jboss-client.jar jboss-common-client.jar jboss-j2ee.jar jbosssx-clien*\n t.jar jnp-client.jar log4j.jar*\n\n\n\noutput from java -version:\n\njava version \"1.4.2_02\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4\nJava HotSpot(TM) Client VM (build 1.4.2_02-b03, mixed mode)", "attachment_id": null, "id": 50856, "creator": "adam_l_levine@hotmail.com", "time": "2004-01-21T00:11:19Z", "bug_id": 26300, "creation_time": "2004-01-21T00:11:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 26300, "attachment_id": 10040, "id": 50857, "time": "2004-01-21T00:12:39Z", "creator": "adam_l_levine@hotmail.com", "creation_time": "2004-01-21T00:12:39Z", "is_private": false, "text": "Created attachment 10040\ngenerated manifest for executable jar"}, {"count": 2, "tags": [], "bug_id": 26300, "text": "The problem arises because there's no empty line before Class-Path.\nIf you simply add and repackage by hand it will surely work!\n\nIt should work if produced MANIFEST.MF looks like (between ============== ):\n\n==============\nManifest-Version: 1.0\nAnt-Version: Apache Ant 1.6.0\nCreated-By: 1.4.2_02-b03 (Sun Microsystems Inc.)\nMain-Class: com.foo.MainClass\n\nClass-Path: JCalendar4.jar MDateSelector.jar forms-1.0.2.jar j2ee.jar \n jboss-client.jar jboss-common-client.jar jboss-j2ee.jar jbosssx-clien\n t.jar jnp-client.jar log4j.jar\n==============", "id": 50859, "time": "2004-01-21T05:59:18Z", "creator": "fernando.gomes@bigfoot.com", "creation_time": "2004-01-21T05:59:18Z", "is_private": false, "attachment_id": null}, {"text": "I am afraid that I have to mark this as invalid.\nThe class-path entry is valid.\n\nI have just tried in my project with a similar manifest:\nManifest-Version: 1.0\nAnt-Version: Apache Ant 1.7alpha\nCreated-By: Blackdown-1.4.2-rc1 (Blackdown Java-Linux Team)\nMain-Class: com.corvil.probesim.ProbeSim\nClass-Path: /usr/local/preilly/src/probesim/lib/dom4j-full.jar /usr/lo\n cal/preilly/src/probesim/lib/log4j.jar\n\n\nAnd this works fine.\n\nPlease see: http://java.sun.com/products/jdk/1.2/docs/guide/jar/manifest.html\n\n", "tags": [], "creator": "peter.reilly@corvil.com", "is_private": false, "count": 3, "id": 50868, "time": "2004-01-21T10:46:08Z", "bug_id": 26300, "creation_time": "2004-01-21T10:46:08Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 26300, "attachment_id": null, "id": 50895, "time": "2004-01-21T17:02:39Z", "creator": "adam_l_levine@hotmail.com", "creation_time": "2004-01-21T17:02:39Z", "is_private": false, "text": "I've read the noted documentation on the manifest format.  The problem is I'm \nnot generating this manifest - ant is.  And i'm getting class not found errors \nfrom the results.\n\nIf i explode the jar, edit the manifest by hand to put it all on one line, even \ntho that's against the spec, repackage it and run it, it works fine.\n\n\nSo, would you not think this is a problem with the generated manifest, the one \nI have no control over?\n\n\nthis is happening on all machines tested on thus far (solaris, windows) and \ndiff't jdks.. 1.3, 1.4..  and v 1.5 and 1.6 of Ant.  and now 1.7Alpha\n\nWhere would you suggest I take this issue now?  to sun?\n\n\nthanks"}, {"count": 5, "tags": [], "creator": "colinml1@exis.com", "is_private": false, "text": "As far as I can tell, Ant's manifest Class-Path wrapping works absolutely fine.\nI don't generally use the manifest tag, but even using the jar task with a\nmanifest attribute to feed it a manifest results in wrapping. If I feed it the\nfollowing manifest:\n-----\nManifest-Version: 1.0\nClass-Path: \n aopalliance-0.1.jar \n asm-1.4.jar \n avalon-framework-4.1.3.jar \n axis-1.1.jar \n behaviour_xml.jar \n ccpp-1.0.jar \n ccpp-ri-1.0.jar \n cglib2-1.0.jar \n classworlds-1.0.jar \n commons-beanutils-1.6.jar \n commons-collections-2.1.jar \n commons-dbcp-1.1.jar \n commons-digester-1.5.jar \n commons-lang-1.0.1.jar \n commons-logging-1.0.3.jar \n core-services.jar \n core-util.jar \n core-dbutil.jar \n cryptix-3.2.0.jar \n data-access.jar \n device-descriptor-xml.jar \n dom4j-1.3.jar \n ehcache-0.7.jar \n glue-std-3.2.3.jar \n hibernate2-2.1.1.jar \n jad-manifest-rules-xml.jar \n jakarta-oro-2.0.8.jar \n jato-beta5.jar \n jaxen-1.0-FCS-full.jar \n jaxp-api-1.2.3.jar \n jaxrpc-api-1.0.jar \n jdom-b8.jar \n jena-1.4.0.jar \n jstl-1.0.4.jar \n junit-3.8.1.jar \n log4j-1.2.8.jar \n log4j-properties.jar \n odmg-3.0.jar \n oscore-tira-1.1.0.jar \n osuser-tira-1.1.0.jar \n osuser-tira-jdbc-1.0.0.jar \n osworkflow-tira-1.1.0.jar \n packaging.jar \n png-sixlegs-1.2.3.jar \n provisioning.jar \n qa-util.jar \n quartz-1.0.2.jar \n rdffilter-1.0.0.jar \n saaj-1.1.jar \n saxpath-1.0-fcs.jar \n spring-1.0M4.jar \n standard-1.0.4.jar \n tapestry-3.0-beta-3-post.jar \n tapestry-contrib-3.0-beta-3-post.jar \n tira-classfile-1.0.2.jar \n wsdl4j-20030609.jar \n xbean-1.0.0.jar \n----- \nAnt then puts the following in the jar file:\n-----\nManifest-Version: 1.0\nAnt-Version: Apache Ant 1.6.0\nCreated-By: 1.4.2_01-b06 (Sun Microsystems Inc.)\nClass-Path: aopalliance-0.1.jar asm-1.4.jar avalon-framework-4.1.3.jar\n  axis-1.1.jar behaviour_xml.jar ccpp-1.0.jar ccpp-ri-1.0.jar cglib2-1\n .0.jar classworlds-1.0.jar commons-beanutils-1.6.jar commons-collecti\n ons-2.1.jar commons-dbcp-1.1.jar commons-digester-1.5.jar commons-lan\n g-1.0.1.jar commons-logging-1.0.3.jar core-services.jar core-util.jar\n  core-dbutil.jar cryptix-3.2.0.jar data-access.jar device-descriptor-\n xml.jar dom4j-1.3.jar ehcache-0.7.jar glue-std-3.2.3.jar hibernate2-2\n .1.1.jar jad-manifest-rules-xml.jar jakarta-oro-2.0.8.jar jato-beta5.\n jar jaxen-1.0-FCS-full.jar jaxp-api-1.2.3.jar jaxrpc-api-1.0.jar jdom\n -b8.jar jena-1.4.0.jar jstl-1.0.4.jar junit-3.8.1.jar log4j-1.2.8.jar\n  log4j-properties.jar odmg-3.0.jar oscore-tira-1.1.0.jar osuser-tira-\n 1.1.0.jar osuser-tira-jdbc-1.0.0.jar osworkflow-tira-1.1.0.jar packag\n ing.jar png-sixlegs-1.2.3.jar provisioning.jar qa-util.jar quartz-1.0\n .2.jar rdffilter-1.0.0.jar saaj-1.1.jar saxpath-1.0-fcs.jar spring-1.\n 0M4.jar standard-1.0.4.jar tapestry-3.0-beta-3-post.jar tapestry-cont\n rib-3.0-beta-3-post.jar tira-classfile-1.0.2.jar wsdl4j-20030609.jar \n xbean-1.0.0.jar \n-----\n\nAnd I have had no issues with this in either JDK 1.3.1, JDK 1.4.0, 1.4.1, or 1.4.2.\n\nMay I suggest that something else is the problem, maybe line termination, etc?", "id": 50902, "time": "2004-01-21T18:54:47Z", "bug_id": 26300, "creation_time": "2004-01-21T18:54:47Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 26300, "attachment_id": null, "id": 50909, "time": "2004-01-21T20:49:13Z", "creator": "adam_l_levine@hotmail.com", "creation_time": "2004-01-21T20:49:13Z", "is_private": false, "text": "I'm generating the Class-Path entry automatically, by:\n - using a fileset \n - and then using pathconvert,\n ---- with a map entry to strip absolute referencing (is there a better way to \ndo this?) to make them relative, \n - and then passing that resultant string to the attribute tag\n\nIs there a better way to achieve this, without having to resort to keeping an \nup-to-date hard-coded list?   Perhaps one of these steps is what's causing the \nbreakage.\n\n"}, {"count": 7, "tags": [], "bug_id": 26300, "text": "Let me start by saying that the comment about a blank line before the Class-Path\nentry is wrong. Not the problem and in fact makes the manifest invalid. \n\nAnyway, I have used the same technique as you previously and it has worked for\nme. The relevant bits from my build are\n\n  <target name=\"warpath\">\n    <!-- Classpath for War - lib dependencies -->\n    <pathconvert dirsep=\"/\" pathsep=\" \" property=\"war.classpath\">\n      <map from=\"${lib.app.dir}\" to=\"lib\"/>\n      <path>\n        <fileset dir=\"${lib.app.dir}\">\n          <include name=\"*xwork*\"/>\n          <include name=\"*webwork*\"/>\n          <include name=\"*velocity*\"/>\n          <include name=\"*ognl*\"/>\n          <include name=\"*oscore*\"/>\n          <include name=\"*osuser*\"/>\n          <include name=\"*sitemesh*\"/>\n          <include name=\"*commons-logging*\"/>\n          <include name=\"*util-general*\"/>\n          <exclude name=\"*.tld\"/>\n        </fileset>\n      </path>\n    </pathconvert>\n  </target>\n\n  <target name=\"war\" depends=\"compile, warpath\">\n    <war webxml=\"${appconf.dir}/web.xml\" warfile=\"${war.file}\">\n      <manifest>\n        <attribute name=\"Class-Path\" value=\"${war.classpath}\"/>\n      </manifest>\n      <fileset dir=\"${build.dir}\" includes=\"${startpage}\"/>\n\nThe resulting manifest, which does work, is \n\nManifest-Version: 1.0\nAnt-Version: Apache Ant 1.6beta \nCreated-By: 1.4.2-b28 (Sun Microsystems Inc.)\nClass-Path: lib/commons-logging.jar lib/ognl-2.5.1.jar lib/oscore-2.2.\n 1.jar lib/osuser-1.0-dev-13Jun03.jar lib/sitemesh.jar lib/util-genera\n l-0.1.jar lib/velocity-dep-1.3.1.jar lib/webwork-2.0-dev.jar lib/xwor\n k-1.0-dev.jar\n\nI wrote a small program to check what the JVM's Manifest class thinks of your\nmanifest\n\nimport java.util.jar.Manifest;\nimport java.io.InputStream;\nimport java.io.FileInputStream;\n\npublic class TestMF {\n    public static void main(String[] args) throws Exception {\n        InputStream is = new FileInputStream(\"Manifest.mf\");\n\n        Manifest mf = new Manifest(is);\n        System.out.println(\"Classpath is \" +\nmf.getMainAttributes().getValue(\"Class-Path\"));\n    }\n}\n\nand this is the result\n\nClasspath is JCalendar4.jar MDateSelector.jar forms-1.0.2.jar j2ee.jar\njboss-client.jar jboss-common-client.jar jboss-j2ee.jar jbosssx-client.jar\njnp-client.jar log4j.jar\n\nwhich looks OK. So I wonder if the problem lies elsewhere. Can you tell us how\nthis jar is being launched, etc and what the actual errors are.", "id": 50933, "time": "2004-01-22T03:06:34Z", "creator": "conor@apache.org", "creation_time": "2004-01-22T03:06:34Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "adam_l_levine@hotmail.com", "attachment_id": null, "is_private": false, "id": 51004, "time": "2004-01-22T20:19:16Z", "bug_id": 26300, "creation_time": "2004-01-22T20:19:16Z", "text": "I do appreciate the help and effort you're putting in to help resolve this.\n\nI'm launching the jar by either a double-click on windows, and java -jar on \nboth platforms.\n\nthe first error I receive is: naming.NoInitialContextException: Cannot \ninstantiate class: org.jnp.interfaces.NamingContextFactory [Root exeception is \njava.lang.ClassNotFoundException: org.jnp.interfaces.NamingContextFactory]\n\nsaid class is located in jnp-client.jar.  the app launches perfectly when I \nexplode the jar, place the class-path entry on all one line (yes, against the \nspec), and then repackage.\n\n"}, {"count": 9, "tags": [], "creator": "ddevienne@lgc.com", "attachment_id": null, "is_private": false, "id": 51005, "time": "2004-01-22T20:38:29Z", "bug_id": 26300, "creation_time": "2004-01-22T20:38:29Z", "text": "You write 'place the class-path entry on all one line (yes, against the \nspec), and then repackage'... But this is not against the SPEC. The SPEC \ndictates how the manifest looks like inside the JAR. When you repackage\nas you write, the JDK's jar.exe is generating the Manifest inside the JAR\naccording to SPEC.\n\nThe fact that the input file has everything on the same line is irrelevant.\n\nJust wanted to precise this... --DD"}, {"count": 10, "tags": [], "bug_id": 26300, "text": "OK, please attach the extracted manifest directly or zipped up (to prevent\nmunging by your browser, etc). I will have a look.", "id": 51521, "time": "2004-01-31T09:48:44Z", "creator": "conor@apache.org", "creation_time": "2004-01-31T09:48:44Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "ping, is this still a problem and is there\nan example set of files?", "attachment_id": null, "id": 63203, "creator": "peterreilly@apache.org", "time": "2004-09-08T10:40:28Z", "bug_id": 26300, "creation_time": "2004-09-08T10:40:28Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 26300, "attachment_id": null, "id": 66921, "time": "2004-11-15T13:32:31Z", "creator": "conor@apache.org", "creation_time": "2004-11-15T13:32:31Z", "is_private": false, "text": "ok, this has gone cold by now :-)"}]
[{"count": 0, "tags": [], "creator": "cap@pcweenie.com", "attachment_id": null, "text": "------------------\nDescription:\n------------------\nOn certain sized objects, the communication between Apache and Tomcat via the \nJK2 connector is failing. If the object streamed to the servlet is 8187 or 8188 \nbytes (and any size a factor of 8186 bytes larger than those two sizes [e.g., \n16373 & 16374, 24559 & 24560, etc.]), the servlet gets an java.io.EOFException. \nI wrote a simple client application, RemoteRequest, and servlet, \nTestModJK2Servlet demonstrate this problem. It appears to be a bug in either \nthe connector or in Tomcat, but is probably the former. I believe 8186 is the \nsize of the AJP frame within a 8192 byte UDP packet, so there's probably a snag \nin something like buffer rotation logic or something similar.\n\n\n============================================\nConfiguration:\n============================================\nI would be happy to zip up and send the test application and servlet and \nsupporting classes I used to produce this bug. With the configuration below, it \nis consistently reproducable. \n\nRemoteRequest is an application that makes a remote request to a servlet \nrunning in a Tomcat container via an Apache web server. For this test, \nRemoteRequest builds a byte array object of size 1 to size N. The size of the\nobject the byte array occupies (which seems to be 27 bytes + the size of the \nbyte array itself) is computed. It is increased by one on each request. Both \nthe RemoteRequest application and the TestModJK2Servlet log which requests \nthey are able to successfully and/or unsuccessfully receive. The RemoteRequest\napplication, the Apache http server, and the Tomcat servers (two servers - load\nbalanced with equal weights and with session affinity), all reside on separate\nphysical servers. The versions and configurations of these follow: \n\n\n============================================\nApache 2:\n============================================\nVersion 2.0.47 Downloaded from the Jakarta project. Configured with the \nfollowing command:\nJDK version 1.4.2_01 (from binary download)\n\n./configure --prefix=/usr/local/apache2ssl --with-mpm=worker --enable-so --\nenable-ssl=shared --enable-proxy=shared --enable-proxy-ftp=shared --enable-\nproxy-http=shared --enable-proxy-connect=shared --enable-cgi --enable-\nrewrite=shared --enable-http\n\nRunning on a Sun Netra t1 (UltraSPARC-IIi 440MHz), 512 MB memory\nOS: Solaris 2.7 (with recommended patches)\n\n\n============================================\nTomcat:\n============================================\nTomcat version 4.1.29 (from binary download)\nJDK version 1.4.2_02 (from binary download)\nJ2EE SDK 1.3.1_01 (from binary download)\nTestModJK2Servlet installed at /TestModJK2Servlet\nRunning on a Dell server with dual 2.0GHz Xeon processors, 2048 MB memory. \nOS: RedHat Linux 9.0\n\n\n============================================\nTomcat Jakarta Connector: \n============================================\nCompiled the native2 version for Apache 2.0 using the source downloaded from:\nhttp://apache.oregonstate.edu/jakarta/tomcat-4/v4.1.29/src/jakarta-tomcat-\nconnectors-4.1.29-src.tar.gz\nRunning on the Apache2 system above.\n\n\n============================================\nClient Application (RemoteRequest): \n============================================\nA simple client that makes HTTP request like an applet does.\nJDK version 1.4.2_02 (from binary download)\nJ2EE SDK 1.3.1_01 (from binary download)\nRunning on a Sun SunFire 280R server with dual 900MHz UltraSparc-III \nprocessors, 2048 MB memory.\nOS: Solaris 2.8\n\n\nIncluded files:\nRemoteRequest.log: An excerpt of the application log showing where the failures \noccurred in testing.\nTomcatCatalina.out.log: An excerpt of the Tomcat log showing where the failures \noccurred in testing.\n\n\n------------------\nRemoteRequest.log:\n------------------\nEVENT: HttpMessage.sendPostMsg: sending an object 8186 bytes long.\nEVENT: Request with object of size 8186 was successful\nEVENT: HttpMessage.sendPostMsg: sending an object 8187 bytes long.\nEVENT: Request with object of size 8187 was ->unsuccessful<-\nEVENT: HttpMessage.sendPostMsg: sending an object 8188 bytes long.\nEVENT: Request with object of size 8188 was ->unsuccessful<-\nEVENT: HttpMessage.sendPostMsg: sending an object 8189 bytes long.\nEVENT: Request with object of size 8189 was successful\n  . . .\nEVENT: HttpMessage.sendPostMsg: sending an object 16372 bytes long.\nEVENT: Request with object of size 16372 was successful\nEVENT: HttpMessage.sendPostMsg: sending an object 16373 bytes long.\nEVENT: Request with object of size 16373 was ->unsuccessful<-\nEVENT: HttpMessage.sendPostMsg: sending an object 16374 bytes long.\nEVENT: Request with object of size 16374 was ->unsuccessful<-\nEVENT: HttpMessage.sendPostMsg: sending an object 16375 bytes long.\nEVENT: Request with object of size 16375 was successful\n  . . .\nEVENT: HttpMessage.sendPostMsg: sending an object 24558 bytes long.\nEVENT: Request with object of size 24558 was successful\nEVENT: HttpMessage.sendPostMsg: sending an object 24559 bytes long.\nEVENT: Request with object of size 24559 was ->unsuccessful<-\nEVENT: HttpMessage.sendPostMsg: sending an object 24560 bytes long.\nEVENT: Request with object of size 24560 was ->unsuccessful<-\nEVENT: HttpMessage.sendPostMsg: sending an object 24561 bytes long.\nEVENT: Request with object of size 24561 was successful\n\n\n----------------------\nTomcatCatalina.out.log\n----------------------\n  . . .\nEVENT: Received a byte[] object containing 8158 data bytes.\nEVENT:  ... and a total object size of: 8185 bytes.\nEVENT: Received a byte[] object containing 8159 data bytes.\nEVENT:  ... and a total object size of: 8186 bytes.\nEXCEP: Exception occurred when reading in object: null\njava.io.EOFException\n        at java.io.ObjectInputStream$BlockDataInputStream.readFully\n(ObjectInputStream.java:2581)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1584)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at com.eyestreet.servlet.TestModJK2Servlet.doPost\n(TestModJK2Servlet.java:89)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:256)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2417)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:193)\n        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:615)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:666)\n        at java.lang.Thread.run(Thread.java:534)\nEXCEP: Exception occurred when reading in object: null\njava.io.EOFException\n        at java.io.ObjectInputStream$BlockDataInputStream.readFully\n(ObjectInputStream.java:2581)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1584)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at com.eyestreet.servlet.TestModJK2Servlet.doPost\n(TestModJK2Servlet.java:89)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:256)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2417)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:193)\n        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:615)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:666)\n        at java.lang.Thread.run(Thread.java:534)\nEVENT: Received a byte[] object containing 8162 data bytes.\nEVENT:  ... and a total object size of: 8189 bytes.\nEVENT: Received a byte[] object containing 8163 data bytes.\nEVENT:  ... and a total object size of: 8190 bytes.\n  . . .\nEVENT: Received a byte[] object containing 16344 data bytes.\nEVENT:  ... and a total object size of: 16371 bytes.\nEVENT: Received a byte[] object containing 16345 data bytes.\nEVENT:  ... and a total object size of: 16372 bytes.\nEXCEP: Exception occurred when reading in object: null\njava.io.EOFException\n        at java.io.ObjectInputStream$BlockDataInputStream.readFully\n(ObjectInputStream.java:2581)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1584)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at com.eyestreet.servlet.TestModJK2Servlet.doPost\n(TestModJK2Servlet.java:89)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:256)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2417)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:193)\n        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:615)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:666)\n        at java.lang.Thread.run(Thread.java:534)\nEXCEP: Exception occurred when reading in object: null\njava.io.EOFException\n        at java.io.ObjectInputStream$BlockDataInputStream.readFully\n(ObjectInputStream.java:2581)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1584)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at com.eyestreet.servlet.TestModJK2Servlet.doPost\n(TestModJK2Servlet.java:89)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:256)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2417)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:193)\n        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:615)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:666)\n        at java.lang.Thread.run(Thread.java:534)\nEVENT: Received a byte[] object containing 16348 data bytes.\nEVENT:  ... and a total object size of: 16375 bytes.\nEVENT: Received a byte[] object containing 16349 data bytes.\nEVENT:  ... and a total object size of: 16376 bytes.\n  . . .\nEVENT: Received a byte[] object containing 24530 data bytes.\nEVENT:  ... and a total object size of: 24557 bytes.\nEVENT: Received a byte[] object containing 24531 data bytes.\nEVENT:  ... and a total object size of: 24558 bytes.\nEXCEP: Exception occurred when reading in object: null\njava.io.EOFException\n        at java.io.ObjectInputStream$BlockDataInputStream.readFully\n(ObjectInputStream.java:2581)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1584)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at com.eyestreet.servlet.TestModJK2Servlet.doPost\n(TestModJK2Servlet.java:89)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:256)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2417)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:193)\n        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:615)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:666)\n        at java.lang.Thread.run(Thread.java:534)\nEXCEP: Exception occurred when reading in object: null\njava.io.EOFException\n        at java.io.ObjectInputStream$BlockDataInputStream.readFully\n(ObjectInputStream.java:2581)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1584)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at com.eyestreet.servlet.TestModJK2Servlet.doPost\n(TestModJK2Servlet.java:89)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:256)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2417)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n        at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:193)\n        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:615)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:666)\n        at java.lang.Thread.run(Thread.java:534)\nEVENT: Received a byte[] object containing 24534 data bytes.\nEVENT:  ... and a total object size of: 24561 bytes.\nEVENT: Received a byte[] object containing 24535 data bytes.\nEVENT:  ... and a total object size of: 24562 bytes.\n\n\nAgain, I'd be more than happy to zip up the java code used for testing as well \nas all relevant configuration files. I refrain from tacking those on here.\n\nCraig Prall\ncap@pcweenie.com", "id": 47514, "time": "2003-11-17T23:11:23Z", "bug_id": 24763, "creation_time": "2003-11-17T23:11:23Z", "is_private": false}, {"count": 1, "tags": [], "creator": "andry@keysurvey.com", "attachment_id": null, "is_private": false, "id": 48673, "time": "2003-12-08T14:35:31Z", "bug_id": 24763, "creation_time": "2003-12-08T14:35:31Z", "text": "some easy steps to reproduce this kind of error\n(in short, parameter value of some certain length gets \nchanged in transit - last character of the parameter value\ngets equal to '\\u0000' instead of '\\u0030' which was originally\nsent)\n\n1) create a jsp - say bb.jsp\n<%\n  String v = request.getParameter(\"v\");\n  int LEN=8185;\n  for( int i=0; i<LEN; i++ ){\n    System.err.println(i+\"=\"+(int)v.charAt(i));\n  }\n%>\n\n2)\nrun the following (change your-host-apache-tomcat with real path) -\nthat code will make a POST request to bb.jsp\n\n  static void testJK2bug() throws Exception {\n    int LEN = 8185;\n    URL u = new URL(\"http://your-host-apache-tomcat/bb.jsp\");\n    URLConnection uc = u.openConnection();\n    uc.setRequestProperty(\"Content-Type\", \"application/x-www-form-urlencoded\");\n    StringBuffer val = new StringBuffer(\"v=\");\n    for (int j = 0; j < LEN; j++) {\n      val.append(\"0\");\n    }\n    uc.setRequestProperty(\"Content-Length\", \"\" + val.length());\n    uc.setDoOutput(true);\n    uc.getOutputStream().write(val.toString().getBytes());\n    uc.getInputStream().read();\n  }\n\n3) see in catalina.out that last character in the parameter value\nis '\\u0000' , not '\\u0030' as it should be\n\n\nThat kind of problem (filling with 0-es) is not limited to single byte.\nOut production site sometimes experiences blocks of zeroes\nsomehow becoming parameter names/values, so the problem is rather critical."}, {"count": 2, "tags": [], "creator": "truk@apache.org", "attachment_id": null, "is_private": false, "id": 53479, "time": "2004-03-05T05:16:02Z", "bug_id": 24763, "creation_time": "2004-03-05T05:16:02Z", "text": "This is fixed in CVS. Thanks for the detailed report."}]
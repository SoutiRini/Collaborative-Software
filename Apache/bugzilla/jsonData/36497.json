[{"attachment_id": null, "tags": [], "creator": "anil@cordys.com", "text": "Hi,\n\t \nI have posted many queries to Apache users mailing list but has not got any \nanswers till now. I need to desperately get this issue solved. \n\nThe issue is this:\n        We are having Apache (version 2.0.54) installed as a forward proxy on \nRHEL 3.0. \nDownloads fail more often than being successful. \n\n\nThe set up:\n------------------\nApache as the Forward proxy,  which is in turn connected to Firewall. Users \nconnect to Apache as Forward proxy.\n\nIssue:\n---------\nPartial/incomplete Downloading of file. \nDownload starts properly after some time it suddenly says download complete. \nAttempting to open the file, we get invalid/corrupt downloaded file alert.\n\nFor e.g.: \n    if we attempt to download 116MB , download stops after 10 MB (some time it \nwent till 110MB).\n\nWhen we directly connect to the web server, without Apache as a forward proxy, \nwe get successful downloads 100%.\n\nError log:\n-------------\n\nThe error log does not show anything in 2.0.54.\n\nUsing 2.0.48, we get \n\t[notice] child pid 20653 exit signal Segmentation fault (11) and \n\t[Fri Aug 12 15:02:51 2005] [notice] child pid 431 exit signal Abort (6)\n\nIf we use Apache 2.1.6 alpha:\n        (104)Connection reset by peer: proxy: error reading response\n\nWe tested all the known versions of Apache 2.0 (2.0.48, 2.0.52, 2.0.54, 2.1.6 \nalpha). Changed the OS to RHEL 4.0 but the problem persists.\n\nWithout Apache downloads are successful.\n\nWe need to get this solved as early as possible. Please do help us in this \nregard.\n\nconfiguration of the HTTPD:\nNote:\n    The changed httpd.conf entries are as follows:\n\n<IfModule worker.c>\nStartServers       15\nMaxClients        750\nMinSpareThreads    25\nMaxSpareThreads    750\nThreadsPerChild     50\nMaxRequestsPerChild  0\n#ServerLimit          10\nMaxMemFree      2000\n</IfModule>\n\n#Apache as Proxy\nProxyRequests On\n\n\n(Everything else is default conf file.)", "count": 0, "id": 79392, "time": "2005-09-05T13:23:02Z", "bug_id": 36497, "creation_time": "2005-09-05T13:23:02Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 36497, "text": "You are using the worker MPM rather than prefork?  I'd suggest you try prefork\ninstead in the first place.\n\nTo help diagnose further, please try to obtain a core dump and back trace from\n2.0.54.  Add \"CoreDumpDirectory /tmp\" to the httpd.conf, then start the server\nusing:\n\n# ulimit -n unlimited\n# apachectl start\n\nwhen the bug is triggerred, a /tmp/core.* file should appear; run:\n\n# gdb /path/to/httpd /tmp/core.<pid>\n...\n(gdb) threads all apply bt full\n\nand attach the complete output of the gdb command to this bug report.", "id": 79397, "time": "2005-09-05T14:01:48Z", "creator": "jorton@redhat.com", "creation_time": "2005-09-05T14:01:48Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "text": "that should be \"ulimit -c unlimited\" not -n.", "is_private": false, "bug_id": 36497, "id": 79398, "time": "2005-09-05T14:15:29Z", "creator": "jorton@redhat.com", "creation_time": "2005-09-05T14:15:29Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 36497, "is_private": false, "text": "Thank you for the quick suggestion. We have setup a apache proxy with prefork \nand shall get back with details in a day or two with core dump output", "id": 79457, "time": "2005-09-06T17:27:11Z", "creator": "anil@cordys.com", "creation_time": "2005-09-06T17:27:11Z", "attachment_id": null}, {"count": 4, "attachment_id": 16343, "bug_id": 36497, "is_private": false, "id": 79703, "time": "2005-09-09T07:56:06Z", "creator": "anil@cordys.com", "creation_time": "2005-09-09T07:56:06Z", "tags": [], "text": "Created attachment 16343\nCoredump for worker MPM\n\nHi,\n\nWe have also tried downloads with Apache Proxy Server which is configured and\ninstalled as Prefork. We have partial/incomplete downlods with this\nconfiguration as well. But the coredump is not generated.\n\nWe have been trying to tackle the issue with downloads through Apache Proxy\nserver which is configured as Worker MPM. The coredump is generated with this\nconfiguration and the gdb output is attached. Kindly provide comments, if any.\n\nNote : The configurations (Prefork and Worker MPM) are done in different\nmachines and the downloads have been initiated through them. Downloads broke in\nboth.\n\nThanks and Regards"}, {"count": 5, "tags": [], "bug_id": 36497, "text": "You need to enter \"thread all apply bt\" at the \"(gdb)\" prompt to get backtrace\ninformation, see\n\nhttp://httpd.apache.org/dev/debugging.html#crashes", "id": 79708, "time": "2005-09-09T09:49:48Z", "creator": "jorton@redhat.com", "creation_time": "2005-09-09T09:49:48Z", "is_private": false, "attachment_id": null}, {"attachment_id": 16344, "tags": [], "creator": "anil@cordys.com", "text": "Created attachment 16344\nGBD Output with \"thread all apply bt\"\n\nThe attachment has gdb outout with \"thread all apply bt\". Kindly provide your\ncomments. Thanks.", "count": 6, "id": 79720, "time": "2005-09-09T13:57:42Z", "bug_id": 36497, "creation_time": "2005-09-09T13:57:42Z", "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 36497, "text": "The crash is in some third-party module.\n\n#1  0x0808845a in sig_coredump (sig=2902) at mpm_common.c:1050\n#2  0xb6ecc65c in os::Linux::chained_handler ()\n   from /usr/java/j2re1.4.2_05/lib/i386/client/libjvm.so\n...\n#6  0xb6b20a82 in TermListPreparer::prepareTermList ()\n   from /usr/local/apache54/modules/mod_ffi_dynamic_filter.so", "id": 79721, "time": "2005-09-09T14:10:39Z", "creator": "jorton@redhat.com", "creation_time": "2005-09-09T14:10:39Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "text": "We also get download issue when we remove third party module and work with \nplain apache we would send the details on Monday. Kindly keep the status as \nneeded info.\n(In reply to comment #7)\n> The crash is in some third-party module.\n> #1  0x0808845a in sig_coredump (sig=2902) at mpm_common.c:1050\n> #2  0xb6ecc65c in os::Linux::chained_handler ()\n>    from /usr/java/j2re1.4.2_05/lib/i386/client/libjvm.so\n> ...\n> #6  0xb6b20a82 in TermListPreparer::prepareTermList ()\n>    from /usr/local/apache54/modules/mod_ffi_dynamic_filter.so", "is_private": false, "bug_id": 36497, "id": 79730, "time": "2005-09-09T16:13:07Z", "creator": "anil@cordys.com", "creation_time": "2005-09-09T16:13:07Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "anil@cordys.com", "attachment_id": null, "is_private": false, "id": 79731, "time": "2005-09-09T16:28:41Z", "bug_id": 36497, "creation_time": "2005-09-09T16:28:41Z", "text": "\n\nJust to add to my last comment , we are getting download problems even when we \nuse apache as plain proxy or even trans proxy , we are in the process of \nseeting a diffrent machine so that we do not use production server which has \nother modules as well.\n\nThank you for your prompt responses\n\n(In reply to comment #8)\n> We also get download issue when we remove third party module and work with \n> plain apache we would send the details on Monday. Kindly keep the status as \n> needed info.\n> (In reply to comment #7)\n> > The crash is in some third-party module.\n> > #1  0x0808845a in sig_coredump (sig=2902) at mpm_common.c:1050\n> > #2  0xb6ecc65c in os::Linux::chained_handler ()\n> >    from /usr/java/j2re1.4.2_05/lib/i386/client/libjvm.so\n> > ...\n> > #6  0xb6b20a82 in TermListPreparer::prepareTermList ()\n> >    from /usr/local/apache54/modules/mod_ffi_dynamic_filter.so\n\n"}, {"count": 10, "tags": [], "bug_id": 36497, "text": "Created attachment 16389\nGDB Output for pid 11625\n\nWe Initiated downloads through Apache Proxy Server Again. One of the downloads\nhas failed. The gdb output of the core dump is attached. \n\nKindly provide your comments.\n\nWe are still testing download issue through Apache. In case, we get different\nouput, we will send them.\n\nThanks and Regards.", "id": 79870, "time": "2005-09-13T15:36:55Z", "creator": "anil@cordys.com", "creation_time": "2005-09-13T15:36:55Z", "is_private": false, "attachment_id": 16389}, {"attachment_id": null, "tags": [], "creator": "jorton@redhat.com", "text": "Please reopen this bug if you can demonstrate a crash which is not caused by a\nthird party module.\n\n...\n#2  0xb73253c2 in abort () from /lib/tls/libc.so.6\nNo symbol table info available.\n...\n#9  0xb6b33dff in parseHTMLSource () from\n/usr/local/apache54/modules/mod_ffi_dynamic_filter.so\n", "count": 11, "id": 79873, "time": "2005-09-13T15:50:48Z", "bug_id": 36497, "creation_time": "2005-09-13T15:50:48Z", "is_private": false}]
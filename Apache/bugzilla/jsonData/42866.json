[{"count": 0, "tags": [], "bug_id": 42866, "attachment_id": null, "id": 105312, "time": "2007-07-12T01:23:35Z", "creator": "denny.strietzbaum@hybris.de", "creation_time": "2007-07-12T01:23:35Z", "is_private": false, "text": "running on tomcat 6.0.13, using myfaces 1.2 (snapshot) and facelets 1.1.13\n\nWhen using a user defined function via EL, the classloader fails.\n(Function was correct defined within a functionlib ... i skip this as it involves Facelets)\nThis problem first occurs when using the current myfaces 1.2 implementation.\nAs myfaces 1.1x bring their own el-implementation, myfaces 1.2x rely on the jsp container\n(as defined by the jsf 1.1 and 1.2 spec)\n\nLooking at org.apache.el.lang.FunctionMapperImpl$Function.getMethod(FunctionMapperImpl.java:147)\ni replaced\nClass t = Class.forName(this.owner);\nwith\nClass t = Class.forName(this.owner, true, Thread.currentThread().getContextClassLoader());\nand all works fine.\n\nBelow the stacktrace:\n\njava.lang.ClassNotFoundException: mypackage.faces.util.ELFunctions\n        at java.net.URLClassLoader$1.run(Unknown Source)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(Unknown Source)\n        at java.lang.ClassLoader.loadClass(Unknown Source)\n        at java.lang.ClassLoader.loadClass(Unknown Source)\n        at java.lang.ClassLoader.loadClassInternal(Unknown Source)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Unknown Source)\n        at org.apache.el.lang.FunctionMapperImpl$Function.getMethod(FunctionMapperImpl.java:147)\n        at org.apache.el.lang.FunctionMapperImpl.resolveFunction(FunctionMapperImpl.java:53)\n        at org.apache.el.parser.AstFunction.getValue(AstFunction.java:71)\n        at org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:186)\n        at com.sun.facelets.el.TagValueExpression.getValue(TagValueExpression.java:71)\n        at org.apache.el.parser.AstIdentifier.getValue(AstIdentifier.java:41)\n        at org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:186)\n        at com.sun.facelets.el.TagValueExpression.getValue(TagValueExpression.java:71)\n        at javax.faces.component.UIOutput.getValue(UIOutput.java:68)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at com.sun.facelets.util.DevTools.writeAttributes(DevTools.java:240)\n        at com.sun.facelets.util.DevTools.writeStart(DevTools.java:284)\n        at com.sun.facelets.util.DevTools.writeComponent(DevTools.java:189)\n        at com.sun.facelets.util.DevTools.writeComponent(DevTools.java:207)\n        at com.sun.facelets.util.DevTools.debugHtml(DevTools.java:107)\n        at com.sun.facelets.FaceletViewHandler.handleRenderException(FaceletViewHandler.java:677)\n        at com.sun.facelets.FaceletViewHandler.renderView(FaceletViewHandler.java:645)\n        at org.apache.myfaces.lifecycle.RenderResponseExecutor.execute(RenderResponseExecutor.java:41)\n        at org.apache.myfaces.lifecycle.LifecycleImpl.render(LifecycleImpl.java:132)\n        at javax.faces.webapp.FacesServlet.service(FacesServlet.java:138)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at org.tuckey.web.filters.urlrewrite.UrlRewriteFilter.doFilter(UrlRewriteFilter.java:738)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at org.apache.myfaces.webapp.filter.ExtensionsFilter.doFilter(ExtensionsFilter.java:147)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at de.hybris.platform.util.RootRequestFilter.doFilter(RootRequestFilter.java:525)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:230)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:104)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:563)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:261)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:581)\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)\n        at java.lang.Thread.run(Unknown Source)"}, {"count": 1, "attachment_id": null, "creator": "j.abraham@moconso.com", "text": "I have obviously the same problem on Tomcat 6.0.14, Sun JSF RI 1.2_05. It works\nwhen the state saving method is set to 'server', but with 'client' method it\nfails after deserialization exactly like the original comment says. The tomcat\nclassloader used for EL has no access to the webapp class, where is the function\nimplemented.", "id": 109458, "time": "2007-10-18T06:47:38Z", "bug_id": 42866, "creation_time": "2007-10-18T06:47:38Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "creator": "david.green@maketechnologies.com", "text": "I am experiencing the same problem.  The original description is accurate in that it appears to be a \nclassloader problem.  This problem only appears in the restore view phase when deserialization occurs, \nsince this is the only time when the Function.m member can be null.  The web application class loader is \nthe current thread context class loader, so the suggested change works well.", "id": 111219, "time": "2007-11-28T13:20:58Z", "bug_id": 42866, "creation_time": "2007-11-28T13:20:58Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "david.green@maketechnologies.com", "attachment_id": null, "text": "BTW, this bug makes user-defined EL functions unusable unless the web app can bundle its own el \nimplementation.  I haven't been able to get that to work on Tomcat 6.0.14.  I suggest that the priority of \nthis fix gets raised.", "id": 111220, "time": "2007-11-28T13:22:54Z", "bug_id": 42866, "creation_time": "2007-11-28T13:22:54Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 42866, "is_private": false, "text": "I've managed to workaround this issue by including the jasper-el.jar from the Tomcat distribution in the \nwar file.", "id": 111222, "time": "2007-11-28T13:31:40Z", "creator": "david.green@maketechnologies.com", "creation_time": "2007-11-28T13:31:40Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "tuomas.kiviaho@iki.fi", "attachment_id": null, "text": "Isn't this a duplicate of <http://issues.apache.org/bugzilla/show_bug.cgi?id=41797>", "id": 113127, "time": "2008-01-25T02:34:41Z", "bug_id": 42866, "creation_time": "2008-01-25T02:34:41Z", "is_private": false}, {"count": 6, "tags": [], "creator": "grantc@dna-tech.net.au", "text": "This is indeed a duplicate of the mentioned bug\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=41797\n\nLooks like a patch has been added to tomcat, but it is not part of the latest\n6.0.14 release.\n\nThe workaround of adding jasper-el.jar directly into the WAR of your application\nappears to work.  You can get this from your the tomcat lib folder.\n", "id": 113234, "attachment_id": null, "bug_id": 42866, "creation_time": "2008-01-28T13:50:39Z", "time": "2008-01-28T13:50:39Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 42866, "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 41797 ***", "id": 113235, "time": "2008-01-28T14:06:47Z", "creator": "markt@apache.org", "creation_time": "2008-01-28T14:06:47Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 7513, "attachment_id": null, "text": "mod_proxy is not \"de-chunking\" chunked responses for an HTTP/1.0 client. e.g.\n\nGET http://www.netcraft.co.uk/ HTTP/1.0\nHost: www.netcraft.co.uk\n\nHTTP/1.1 200 OK\nDate: Wed, 27 Mar 2002 14:21:32 GMT\nServer: Apache/1.3.9 (Unix) mod_perl/1.20\nContent-Type: text/html\nTransfer-Encoding: chunked\nX-Cache: MISS from my.host.name\nConnection: close\n\nfc \n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML//EN\">\n...etc...", "id": 12387, "time": "2002-03-27T14:39:34Z", "creator": "jorton@redhat.com", "creation_time": "2002-03-27T14:39:34Z", "is_private": false}, {"count": 1, "tags": [], "creator": "slive@apache.org", "text": "*** Bug 7454 has been marked as a duplicate of this bug. ***", "id": 12391, "time": "2002-03-27T15:05:55Z", "bug_id": 7513, "creation_time": "2002-03-27T15:05:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 7513, "attachment_id": null, "text": "(this was already reported on dev@httpd but the reproduction case was\nover-complicated so I thought I'd file a bug giving the simplest case, sorry for\nthe duplicate too)", "id": 12397, "time": "2002-03-27T15:23:05Z", "creator": "jorton@redhat.com", "creation_time": "2002-03-27T15:23:05Z", "is_private": false}, {"count": 3, "tags": [], "creator": "brian.bothwell@wisdomtools.com", "attachment_id": null, "text": "I noticed this as well.  For us it makes 1.3.24 unusable as it makes our webapp\nlook really bad w/ every frame having strings like \"11d0\" at the top. :(", "id": 12463, "time": "2002-03-28T16:41:14Z", "bug_id": 7513, "creation_time": "2002-03-28T16:41:14Z", "is_private": false}, {"count": 4, "tags": [], "creator": "slive@apache.org", "text": "*** Bug 7708 has been marked as a duplicate of this bug. ***", "id": 12752, "time": "2002-04-03T14:25:55Z", "bug_id": 7513, "creation_time": "2002-04-03T14:25:55Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "Make the description a  little more general.", "attachment_id": null, "bug_id": 7513, "id": 12755, "time": "2002-04-03T14:26:53Z", "creator": "slive@apache.org", "creation_time": "2002-04-03T14:26:53Z", "is_private": false}, {"count": 6, "tags": [], "text": "When an HTTP/1.1 server responded to a request with chunked data, this\ndata was passed as is to the frontend server, instead of being dechunked\nas it was transferred. Through another coincidence, the Transfer-Encoding\nheader made it to the client intact. This resulted in HTTP/1.1 clients\nhandling the data, but HTTP/1.0 clients would barf.\n\nThe fix was to dechunk chunked data as it arrived.", "attachment_id": null, "id": 12962, "creation_time": "2002-04-07T18:58:54Z", "time": "2002-04-07T18:58:54Z", "creator": "minfrin@sharp.fm", "bug_id": 7513, "is_private": false}, {"count": 7, "tags": [], "bug_id": 7513, "is_private": false, "text": "*** Bug 8396 has been marked as a duplicate of this bug. ***", "id": 14444, "time": "2002-04-23T13:28:20Z", "creator": "slive@apache.org", "creation_time": "2002-04-23T13:28:20Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "I recently upgraded from apache 1.3.20 to 1.3.26 (for the recent security \nfix), I noticed that mod_proxy appeared to still NOT be downgrading responses \nfor HTTP/1.0 clients (as was the case for 1.3.24).  I confirmed this by \nsniffing HTTP traffic.  When I went back to 1.3.20, the proxy properly \ndowngraded HTTP/1.1 requests coming from the upstream server into HTTP/1.0 \nresponses back to the client.\n\nThis bug was marked as fixed, but it appears it wasn't, or was re-introduced \nsomehow.", "attachment_id": null, "bug_id": 7513, "id": 19708, "time": "2002-07-17T19:31:49Z", "creator": "brian.bothwell@wisdomtools.com", "creation_time": "2002-07-17T19:31:49Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 7513, "is_private": false, "text": "I changed the Version to 1.3.26, and upgraded this to blocker, since it has \nbroken our site completely, and for now I will be forced to move back to a \nsecurity-patched version of 1.3.26. :(\n\n", "id": 19710, "time": "2002-07-17T19:46:31Z", "creator": "brian.bothwell@wisdomtools.com", "creation_time": "2002-07-17T19:46:31Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 7513, "attachment_id": null, "text": "Brian, I think you are confusing the issue a little here.  1.3.20 was an HTTP/1.0\nproxy, so of course it used HTTP/1.0 repsonses.  1.3.26 is a 1.1 proxy, so it\nwill properly respond as 1.1 (even to 1.0 clients).  The question is, is the\nproxy using features (like chunked encoding) in its responses to 1.0 clients\nthat are not allowed.  (I probably should never have changed the summary way\nback when this was first submitted; it was originally only about chunked encoding.)\n\nSo can you tell us exactly what the proxy is doing that is causing problems for\nyour 1.0 clients?", "id": 19724, "time": "2002-07-17T21:13:36Z", "creator": "slive@apache.org", "creation_time": "2002-07-17T21:13:36Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 7513, "is_private": false, "text": "Oops.  I meant \"a security-patched version of 1.3.20\" (not 1.3.26)\n\nActually, on futher investigation, I beleive there is something else going on. \nI am not seeing evidence of a chunked encoding problem when running a proxy\nthrough a 1.3.26 server with most pages.  However, there is one page, and error\nhandling page, that uses CGI::Carp to override the die() method and pops up our\nown custom error message in a new window (via Javascript) and logs the error\ninto a database.  This page no longer works with the 1.3.26 HTTP/1.1 proxy code,\nand returns garbled  HTML (shown in the attached document \"1.3.26_response.txt\",\nas compared with the correctly functioning page returned \"1.2.30_reponse.txt\")\n\nI am going to do some more experiementing to see if I can isolate the problem\nsome more.      ", "id": 19746, "time": "2002-07-18T04:36:24Z", "creator": "brian.bothwell@wisdomtools.com", "creation_time": "2002-07-18T04:36:24Z", "attachment_id": null}, {"count": 12, "tags": [], "text": "Created attachment 2391\ncorrupted HTML sent by 1.3.26 mod_proxy", "attachment_id": 2391, "id": 19747, "creation_time": "2002-07-18T04:37:26Z", "time": "2002-07-18T04:37:26Z", "creator": "brian.bothwell@wisdomtools.com", "bug_id": 7513, "is_private": false}, {"count": 13, "tags": [], "bug_id": 7513, "text": "Created attachment 2392\nworking HTML from 1.3.20 mod_proxy", "id": 19748, "time": "2002-07-18T04:38:01Z", "creator": "brian.bothwell@wisdomtools.com", "creation_time": "2002-07-18T04:38:01Z", "is_private": false, "attachment_id": 2392}, {"count": 14, "tags": [], "bug_id": 7513, "attachment_id": null, "text": "I've been digging much deeper into this, and alas it appears to be a \nproblem with the way the developers programmed the error handling code:  \nThey are using it to print HTML and JavaScript that ends up getting printed \nBEFORE the actual HTTP \"500\" headers, and this this is corrupting the \nheaders in a way that just happens to work OK when proxied with HTTP/1.0 \n(under 1.3.20) but not with the HTTP/1.1 proxy code (which seems to be \nstripping out some of the HTML boilerplate tags that cause the JavaScript \nfunctionality to fail on the browser-side.  (At least I think that is what \nis happpening) I need to discuss this with our developers to determine if \nthere is a better (correct) way to handle errors, or look into overriding \nApache's error handling of 500 server errors.\n\nFor those that are interested (maybe nobody :) I have attached two more \nASCII dumps of the HTTP/HTML returned to the client browser by both the \n1.3.20 proxy and 1.3.26 proxy.  \n\nI think this bug can be closed, but I'll leave it up to actual Apache \ndevelopers to determine if this really isn't a problem (which it now seems \nto me that it isn't.)\n\nSorry for the confusion... ", "id": 19782, "time": "2002-07-18T15:26:58Z", "creator": "brian.bothwell@wisdomtools.com", "creation_time": "2002-07-18T15:26:58Z", "is_private": false}, {"count": 15, "tags": [], "creator": "brian.bothwell@wisdomtools.com", "attachment_id": 2397, "is_private": false, "id": 19783, "time": "2002-07-18T15:30:57Z", "bug_id": 7513, "creation_time": "2002-07-18T15:30:57Z", "text": "Created attachment 2397\nHTTP/HTML output from 1.3.20 proxy"}, {"count": 16, "tags": [], "creator": "brian.bothwell@wisdomtools.com", "text": "Created attachment 2398\nHTTP/HTML output from 1.3.26 proxy", "id": 19784, "time": "2002-07-18T15:31:20Z", "bug_id": 7513, "creation_time": "2002-07-18T15:31:20Z", "is_private": false, "attachment_id": 2398}, {"count": 17, "tags": [], "creator": "brian.bothwell@wisdomtools.com", "text": "any word on this?  Maybe I am smoking crack on this one?? ", "id": 21156, "time": "2002-08-16T10:36:44Z", "bug_id": 7513, "creation_time": "2002-08-16T10:36:44Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 7513, "is_private": false, "text": "Strange ... is this bug now invalid or not? (question without deep digging into it)", "id": 34902, "time": "2003-04-10T18:23:32Z", "creator": "nd@perlig.de", "creation_time": "2003-04-10T18:23:32Z", "attachment_id": null}, {"count": 19, "tags": [], "text": "I *think* this is invalid.  I haven't looked into it since I downgraded to a\nsecurity-patched version of 1.3.20 on all our web servers that use mod_proxy. \nIf I have time at some point I'd like to try the latest 1.3.* release with HTTP\n1.1 mod_proxy and see if I can't figure out why our webapp is causing these\nproblems, and how we can fixed it permanently.", "attachment_id": null, "bug_id": 7513, "id": 34911, "time": "2003-04-10T22:24:27Z", "creator": "brian.bothwell@wisdomtools.com", "creation_time": "2003-04-10T22:24:27Z", "is_private": false}, {"count": 20, "tags": [], "text": "Ok, thanks for your reply. Just reopen the report if you have further information.\nI'm closing it for now.", "attachment_id": null, "id": 34915, "creation_time": "2003-04-10T22:39:53Z", "time": "2003-04-10T22:39:53Z", "creator": "nd@perlig.de", "bug_id": 7513, "is_private": false}]
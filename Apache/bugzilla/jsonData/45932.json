[{"count": 0, "tags": [], "text": "LogManager.resetConfiguration() does not drop the JMX MBeans created by HierarchyDynamicMBean.\n\nWhen executed twice, the following\n\n\tMBeanServer mbs = ...;\n\tProperties props = ...;\n\tHierarchyDynamicMBean hdm = new HierarchyDynamicMBean();\n\tmbs.registerMBean(hdm, new ObjectName(\"log4j:hiearchy=default\"));\n\n\tEnumeration<Logger> iter = (Enumeration<Logger>) LogManager.getLoggerRepository().getCurrentLoggers();\n\twhile (iter.hasMoreElements()) {\n\t\thdm.addLoggerMBean(iter\n\t\t\t  .nextElement()\n\t\t\t  .getName());\n\t}\n\n\tLogManager.resetConfiguration();\n\tPropertyConfigurator.configure(props);\n\nthrows\n\n\torg.apache.log4j.jmx.LoggerDynamicMBean <ERROR  > Could not add appenderMBean for [F].\n\tjavax.management.InstanceAlreadyExistsException: log4j:appender=F\n\t\tat com.sun.jmx.mbeanserver.RepositorySupport.addMBean(RepositorySupport.java:452)\n\t\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1410)\n\t\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:936)\n\t\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:337)\n\t\tat com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:497)\n\t\tat org.apache.log4j.jmx.LoggerDynamicMBean.registerAppenderMBean(Unknown Source)\n\t\tat org.apache.log4j.jmx.LoggerDynamicMBean.handleNotification(Unknown Source)\n\t\tat javax.management.NotificationBroadcasterSupport.handleNotification(NotificationBroadcasterSupport.java:221)\n\t\tat javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:184)\n\t\tat org.apache.log4j.jmx.HierarchyDynamicMBean.addAppenderEvent(Unknown Source)\n\t\tat org.apache.log4j.Hierarchy.fireAddAppenderEvent(Hierarchy.java:192)\n\t\tat org.apache.log4j.Category.addAppender(Category.java:162)\n\t\tat org.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:614)\n\t\tat org.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:509)\n\t\tat org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:415)\n\t\tat org.apache.log4j.PropertyConfigurator.configure(PropertyConfigurator.java:349)\n\t\t...", "is_private": false, "bug_id": 45932, "id": 121139, "time": "2008-10-01T13:43:00Z", "creator": "hmak@vaultus.com", "creation_time": "2008-10-01T13:43:00Z", "attachment_id": null}]
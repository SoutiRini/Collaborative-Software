[{"count": 0, "tags": [], "text": "I think, the code should rather check such references, being silent - in case there are such unresolved references, ignoring them.\nAnyway, no sense in such references in Excel 2003- old files and the workbook may be processed without them.\nThe benefit would be - compatibility with the old code (jxl, for example) which ignores them. Now we have backward incompatibility - after porting of the old code to POI, getting exception in files which were processed without problems with the old code.\n\n\n------8<------\njava.lang.Class - java.lang.RuntimeException: Could not resolve external workbook name '\u0002Documents and Settings\u0003user\u0003Local Settings\u0003Temporary Internet Files\u0003OLK91\u0003097209YE01.xls'. Workbook environment has not been set up.\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.createExternSheetRefEvaluator(OperationEvaluationContext.java:84)\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.getRef3DEval(OperationEvaluationContext.java:244)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.getEvalForPtg(WorkbookEvaluator.java:554)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:440)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:261)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:207)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateFormulaCellValue(HSSFFormulaEvaluator.java:317)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluate(HSSFFormulaEvaluator.java:179)\n\tat org.is.jxlpoi.JXLPOIWorkbook.getCellContentAsString(JXLPOIWorkbook.java:172)\n\n------8<------", "attachment_id": null, "id": 136691, "creator": "gavr145@gmail.com", "time": "2010-05-06T10:44:33Z", "bug_id": 49258, "creation_time": "2010-05-06T10:44:33Z", "is_private": false}, {"count": 1, "text": "If you don't have the external files, you can't calculate the formulas\n\nSo, either don't explicitly trigger the calculation of the formulas (use the cached values instead), or get the files to hand before you trigger the evaluation", "bug_id": 49258, "attachment_id": null, "id": 136692, "time": "2010-05-06T10:47:52Z", "creator": "apache@gagravarr.org", "creation_time": "2010-05-06T10:47:52Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 49258, "attachment_id": null, "text": "(In reply to comment #1)\n> If you don't have the external files, you can't calculate the formulas\n> \n> So, either don't explicitly trigger the calculation of the formulas (use the\n> cached values instead), or get the files to hand before you trigger the\n> evaluation\n\nI understand the 1st. \nBut we have no control on what users may leave (they may leave references).\nJXL code processes such 2003 spreadsheets, POI crashes, with the same approach.\nIsn't it easier - to put try/catch in POI code or to test File.exists(), treating the links as not existing?\nThe problem that the references are resolved inside POI code and our code just evaluates formulas - when it is a formula, calling formulaEvaluator.evaluate()-  when formula is found  (so has no knowledge that it is a file/reference at all. And the path to the file is resolved inside POI). \n\nAs I believe - the check File.exists or try/catch and compatibility with the old code (which is still in production) will be only beneficial.", "id": 136693, "time": "2010-05-06T11:14:54Z", "creator": "gavr145@gmail.com", "creation_time": "2010-05-06T11:14:54Z", "is_private": false}, {"count": 3, "text": "so, please consider this as a request for a very useful (at least for us) feature, which as I suspect - not a big problem to insert (I understand that this is not a bug).\n\nThanks for replying!\n\nRegards\nvasili", "bug_id": 49258, "attachment_id": null, "id": 136697, "time": "2010-05-06T11:20:22Z", "creator": "gavr145@gmail.com", "creation_time": "2010-05-06T11:20:22Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "dfisher@jmlafferty.com", "text": "If you would like to offer a patch, contributions are welcome. A patch would include a unit test that shows throwing the error and catching the error. The feature - \"Allow unresolved external references\" -  would need to be a setting. I'm not sure of the best place, but likely in the FormulaEvaluator interface. Perhaps Josh has an opinion.", "id": 136698, "time": "2010-05-06T11:31:08Z", "bug_id": 49258, "creation_time": "2010-05-06T11:31:08Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 49258, "attachment_id": 25410, "text": "Created attachment 25410\npatch screens the exceptions thrown due to errors during evaluation of forumas\n\nThis patch works for me, making POI behaving like jxl, i.e. ignoring broken links in formulas.", "id": 136708, "time": "2010-05-06T15:22:44Z", "creator": "gavr145@gmail.com", "creation_time": "2010-05-06T15:22:44Z", "is_private": false}, {"count": 6, "tags": [], "creator": "gavr145@gmail.com", "text": "Obviously, you, guys will do it cleaner. I just made a dirty fix for our case, mimicking JXL's behavior, catching all exceptions been caused by incorrect formula evaluation. So, formulas will be evaluated in any case - if  \nformulaEvaluator.setIgnoreFormulaException() was previously invoked. \n\nSo, the patch does not break backward compatibility.\n\nOh, sorry, I'm not sending unit test (our spreadsheets are too complex, and I do not know Excel good enough - to reproduce the same manually).", "id": 136709, "time": "2010-05-06T15:29:52Z", "bug_id": 49258, "creation_time": "2010-05-06T15:29:52Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "gavr145@gmail.com", "attachment_id": null, "id": 136710, "time": "2010-05-06T16:36:30Z", "bug_id": 49258, "creation_time": "2010-05-06T16:36:30Z", "is_private": false, "text": "Auch,\n\nI just got failures on my unit tests, so the patch breaks formulas initializer.\nNot such simple, as always...\n\nPlease ignore the patch."}]
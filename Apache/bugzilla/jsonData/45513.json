[{"count": 0, "tags": [], "creator": "rainer.jung@kippdata.de", "is_private": false, "text": "Created attachment 22336\nFix APR_PID_T_FMT on Solaris\n\nRevision 553652 of configure.in introduced changes in printf format detection for size_t and ssize_t to branch 1.3 and trunk. There were two unwanted side effects, that break detection of format for pid_t on Solaris (and lead to lots of Compilation warnings for httpd 2.2.9).\n\nProblem 1: In the block setting pid_t_fmt for Solaris it got changed from \n\n   pid_t_fmt='#define APR_PID_T_FMT \"ld\"'\n\nto\n\n   pid_t_fmt=\"ld\"\n\nThat type of change was wanted for size_t and ssize_t, but is unwanted for pid_t, since later on in configure.in, the define style is still used, and the way pid_t_fmt is included in apr.h.in was not adjusted.\n\nProblem 2: the whole block of special system handling concerning format characters was moved around. Before it was located under the lines were the defaults for pid_t_fmt had been set, now it is located above, so any special setting gets overwritten by the defaults.\n\nThe attached patch fixed it. Same file for 1.3 and trunk.", "id": 119174, "time": "2008-07-31T04:27:08Z", "bug_id": 45513, "creation_time": "2008-07-31T04:27:08Z", "attachment_id": 22336}, {"count": 1, "tags": [], "creator": "bojan@rexursive.com", "is_private": false, "text": "So, when you apply just this hunk:\n----------------------------\n@@ -1360,9 +1374,9 @@\n        ;;\n    *-solaris*)\n        if test \"$ac_cv_sizeof_long\" = \"8\"; then\n-         pid_t_fmt=\"d\"\n+         pid_t_fmt='#define APR_PID_T_FMT \"d\"'\n        else\n-         pid_t_fmt=\"ld\"\n+         pid_t_fmt='#define APR_PID_T_FMT \"ld\"'\n        fi\n        ;;\n    *aix4*|*aix5*)\n----------------------------\n\nIt doesn't work, right?", "id": 119335, "time": "2008-08-04T00:19:30Z", "bug_id": 45513, "creation_time": "2008-08-04T00:19:30Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Right, that hunk alone doesn't help, because later down in configure the variable pid_t_fmt gets overwritten.\n", "id": 119343, "time": "2008-08-04T04:11:54Z", "bug_id": 45513, "creation_time": "2008-08-04T04:11:54Z", "is_private": false, "attachment_id": null}, {"attachment_id": 22407, "tags": [], "bug_id": 45513, "is_private": false, "count": 3, "id": 119569, "time": "2008-08-07T14:51:10Z", "creator": "bojan@rexursive.com", "creation_time": "2008-08-07T14:51:10Z", "text": "Created attachment 22407\nThis patch moves platform specific stuff to very end, like we had it in 1.2.x"}, {"count": 4, "text": "Does the patch I just attached still do it for you? I moved that platform specific stuff to the very end.", "creator": "bojan@rexursive.com", "is_private": false, "id": 119570, "time": "2008-08-07T14:51:47Z", "bug_id": 45513, "creation_time": "2008-08-07T14:51:47Z", "tags": [], "attachment_id": null}, {"count": 5, "text": "This will work for the pid_t_fmt case, but not for the biggest part in that block.\n\nFor size_t_fmt and ssize_t_fmt there is logic below the block but before the place you want to move it, that already uses the values.\n\nI think you can savely move the block down below the immediately following lines\n\nAPR_CHECK_TYPES_COMPATIBLE(ssize_t, int, [ssize_t_fmt=\"d\"])\nAPR_CHECK_TYPES_COMPATIBLE(ssize_t, long, [ssize_t_fmt=\"ld\"])\nAPR_CHECK_TYPES_COMPATIBLE(size_t, unsigned int, [size_t_fmt=\"u\"])\nAPR_CHECK_TYPES_COMPATIBLE(size_t, unsigned long, [size_t_fmt=\"lu\"])\n\n(and that might be more correct), but not further down. This is not far enough for the pid_t_fmt case :(\n", "creator": "rainer.jung@kippdata.de", "is_private": false, "id": 119571, "time": "2008-08-07T15:19:33Z", "bug_id": 45513, "creation_time": "2008-08-07T15:19:33Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 45513, "text": "Some examples why you shouldn't move the whole block down:\n\n1) \n\nsize_t_fmt=\"#define APR_SIZE_T_FMT \\\"$size_t_fmt\\\"\"\nssize_t_fmt=\"#define APR_SSIZE_T_FMT \\\"$ssize_t_fmt\\\"\"\n\nNeed to stay as the latest size_t_fmt/ssize_t_fmt manipulating statements.\n\n2)\n\nAC_MSG_CHECKING([which format to use for apr_ssize_t])\nif test -n \"$ssize_t_fmt\"; then\n\n# So we take this branch if we already determined ssize_t_fmt\n\n    AC_MSG_RESULT(%$ssize_t_fmt)\nelif test \"$ac_cv_sizeof_ssize_t\" = \"$ac_cv_sizeof_int\"; then\n    ssize_t_fmt=\"d\"\n    AC_MSG_RESULT(%d)\nelif test \"$ac_cv_sizeof_ssize_t\" = \"$ac_cv_sizeof_long\"; then\n    ssize_t_fmt=\"ld\"\n    AC_MSG_RESULT(%ld)\nelse\n# And now we complain, because we couldn't determine the format\n    AC_ERROR([could not determine the proper format for apr_ssize_t])\nfi\n\nObviously this block (and the same for the size_t_fmt block) needs to stay below the special case settings too.", "count": 6, "id": 119572, "time": "2008-08-07T15:31:26Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-08-07T15:31:26Z", "is_private": false}, {"count": 7, "tags": [], "creator": "bojan@rexursive.com", "text": "Comment on attachment 22407\nThis patch moves platform specific stuff to very end, like we had it in 1.2.x\n\nThis patch is incorrect.", "id": 119573, "time": "2008-08-07T15:59:10Z", "bug_id": 45513, "creation_time": "2008-08-07T15:59:10Z", "is_private": false, "attachment_id": 22407}, {"count": 8, "tags": [], "creator": "bojan@rexursive.com", "text": "Thanks for the quick reply. I'll resend your original fix to the development list, so that people can have a look.", "id": 119574, "time": "2008-08-07T15:59:53Z", "bug_id": 45513, "creation_time": "2008-08-07T15:59:53Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 45513, "is_private": false, "id": 119576, "attachment_id": null, "creator": "bojan@rexursive.com", "creation_time": "2008-08-07T17:15:12Z", "time": "2008-08-07T17:15:12Z", "text": "You patch has gone into trunk - thank you! I'll be waiting for other developers to chime in before backporting to 1.3.x. Hopefully, it'll make it into 1.3.3."}, {"count": 10, "tags": [], "bug_id": 45513, "attachment_id": null, "text": "Thanks for taking care. If it doesn't make it into 1.3.3 it's definitely not a showstopper and can wait for 1.3.4.", "id": 119586, "time": "2008-08-08T01:09:21Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-08-08T01:09:21Z", "is_private": false}, {"count": 11, "tags": [], "creator": "bojan@rexursive.com", "is_private": false, "text": "Fixed in trunk and 1.3.x. Thanks for your patch!", "id": 119628, "time": "2008-08-08T14:03:05Z", "bug_id": 45513, "creation_time": "2008-08-08T14:03:05Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 45513, "is_private": false, "count": 12, "id": 119630, "time": "2008-08-08T14:32:18Z", "creator": "covener@gmail.com", "creation_time": "2008-08-08T14:32:18Z", "text": "Looks good on solaris/amd64:\ninclude/apr.h:#define APR_PID_T_FMT \"d\"\n"}]
[{"count": 0, "tags": [], "creator": "xpjsky@gmail.com", "text": "Created attachment 28925\nAnt just print the task name\n\n1. When I config build.xml as below, then run target \"test\" in eclipse, ant may cause deadlock sometimes. It didn't execute target at all, just print target name as screen capture showed. And the target number may be two or three, means some times \"test1\" and \"test3\", some times \"test1\",\"test2\",\"test3\".\n\n<target name=\"test\">\n  <parallel threadCount=\"3\">\n    <antcall target=\"test1\"/>\n    <antcall target=\"test2\"/>\n    <antcall target=\"test3\"/>\n  </parallel>\n</target>\n\n<target name=\"test1\">\n  <echo message=\"this is a test1\"></echo>\n</target>\n<target name=\"test2\">\n  <echo message=\"this is a test2\"></echo>\n</target>\n<target name=\"test3\">\n  <echo message=\"this is a test3\"></echo>\n</target>\n\n2. Does ant run parallel task use separate class loader? as configured before, target \"test1\" related class use its own ClassLoader which is different from target \"test2\" and target \"test3\"'s. So, how can I configure parallel task if I want one task to do an initializing work which is depended by all other tasks?", "id": 159939, "time": "2012-06-13T07:03:41Z", "bug_id": 53407, "creation_time": "2012-06-13T07:03:41Z", "is_private": false, "attachment_id": 28925}, {"count": 1, "tags": [], "creator": "xpjsky@gmail.com", "text": "It seams that it's a bug of eclipse console, look the thread dump below:\n\n\"Thread-2\" prio=6 tid=0x000000000697f000 nid=0x3038 waiting for monitor entry [0x0000000007a3e000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat java.io.PrintWriter.println(PrintWriter.java:695)\n\t- waiting to lock <0x00000007d858a178> (a java.io.BufferedWriter)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.sendMessage(RemoteAntBuildLogger.java:135)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.marshalTaskMessage(RemoteAntBuildLogger.java:351)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.processEvent(RemoteAntBuildLogger.java:270)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.messageLogged(RemoteAntBuildLogger.java:264)\n\tat org.apache.tools.ant.Project.fireMessageLoggedEvent(Project.java:2254)\n\tat org.apache.tools.ant.Project.fireMessageLogged(Project.java:2353)\n\tat org.apache.tools.ant.Project.log(Project.java:480)\n\tat org.apache.tools.ant.Task.log(Task.java:294)\n\tat org.apache.tools.ant.Task.handleOutput(Task.java:224)\n\tat org.apache.tools.ant.UnknownElement.handleOutput(UnknownElement.java:211)\n\tat org.apache.tools.ant.Project.demuxOutput(Project.java:1272)\n\tat org.apache.tools.ant.taskdefs.Ant.handleOutput(Ant.java:252)\n\tat org.apache.tools.ant.taskdefs.CallTarget.handleOutput(CallTarget.java:179)\n\tat org.apache.tools.ant.UnknownElement.handleOutput(UnknownElement.java:211)\n\tat org.apache.tools.ant.Project.demuxOutput(Project.java:1272)\n\tat org.apache.tools.ant.DemuxOutputStream.processBuffer(DemuxOutputStream.java:172)\n\tat org.apache.tools.ant.DemuxOutputStream.write(DemuxOutputStream.java:147)\n\tat org.apache.tools.ant.DemuxOutputStream.write(DemuxOutputStream.java:241)\n\tat java.io.PrintStream.write(PrintStream.java:430)\n\t- locked <0x00000007d86d0660> (a java.io.PrintStream)\n\tat sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:202)\n\tat sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:272)\n\tat sun.nio.cs.StreamEncoder.flushBuffer(StreamEncoder.java:85)\n\t- locked <0x00000007d86d0a00> (a java.io.OutputStreamWriter)\n\tat java.io.OutputStreamWriter.flushBuffer(OutputStreamWriter.java:168)\n\tat java.io.PrintStream.newLine(PrintStream.java:496)\n\t- locked <0x00000007d86d0660> (a java.io.PrintStream)\n\tat java.io.PrintStream.println(PrintStream.java:757)\n\t- locked <0x00000007d86d0660> (a java.io.PrintStream)\n\tat com.getpaid.internal.gpdbbuild.PopulateDatabase.recreateDatabase(PopulateDatabase.java:89)\n\tat com.getpaid.internal.gpdbbuild.PopulateDatabase.PopulateDatabaseViaXmlFiles(PopulateDatabase.java:44)\n\tat com.getpaid.internal.gpdbbuild.GpdbbuildTask.execute(GpdbbuildTask.java:67)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.Target.execute(Target.java:392)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:413)\n\tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1399)\n\tat org.apache.tools.ant.helper.SingleCheckExecutor.executeTargets(SingleCheckExecutor.java:38)\n\tat org.eclipse.ant.internal.launching.remote.EclipseSingleCheckExecutor.executeTargets(EclipseSingleCheckExecutor.java:30)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1251)\n\tat org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:442)\n\tat org.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:105)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.taskdefs.Parallel$TaskRunnable.run(Parallel.java:435)\n\tat java.lang.Thread.run(Thread.java:662)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Thread-1\" prio=6 tid=0x000000000697e000 nid=0x27d4 waiting for monitor entry [0x000000000793e000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n\tat java.io.PrintStream.println(PrintStream.java:756)\n\t- waiting to lock <0x00000007d86ce1e0> (a java.io.PrintStream)\n\tat com.getpaid.internal.gpdbbuild.ClearDatabaseSchema.clearSchema(ClearDatabaseSchema.java:257)\n\tat com.getpaid.internal.gpdbbuild.PopulateDatabase.recreateDatabase(PopulateDatabase.java:82)\n\tat com.getpaid.internal.gpdbbuild.PopulateDatabase.PopulateDatabaseViaXmlFiles(PopulateDatabase.java:44)\n\tat com.getpaid.internal.gpdbbuild.GpdbbuildTask.execute(GpdbbuildTask.java:67)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.Target.execute(Target.java:392)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:413)\n\tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1399)\n\tat org.apache.tools.ant.helper.SingleCheckExecutor.executeTargets(SingleCheckExecutor.java:38)\n\tat org.eclipse.ant.internal.launching.remote.EclipseSingleCheckExecutor.executeTargets(EclipseSingleCheckExecutor.java:30)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1251)\n\tat org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:442)\n\tat org.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:105)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:68)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.taskdefs.Parallel$TaskRunnable.run(Parallel.java:435)\n\tat java.lang.Thread.run(Thread.java:662)\n\n   Locked ownable synchronizers:\n\t- None\n\n\"Thread-0\" prio=6 tid=0x0000000006aa4800 nid=0x1ecc runnable [0x000000000783d000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.net.SocketOutputStream.socketWrite0(Native Method)\n\tat java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n\tat java.net.SocketOutputStream.write(SocketOutputStream.java:136)\n\tat sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:202)\n\tat sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:272)\n\tat sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:276)\n\tat sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:122)\n\t- locked <0x00000007d858a1a8> (a java.io.OutputStreamWriter)\n\tat java.io.OutputStreamWriter.flush(OutputStreamWriter.java:212)\n\tat java.io.BufferedWriter.flush(BufferedWriter.java:236)\n\t- locked <0x00000007d858a1a8> (a java.io.OutputStreamWriter)\n\tat java.io.PrintWriter.newLine(PrintWriter.java:438)\n\t- locked <0x00000007d858a178> (a java.io.BufferedWriter)\n\tat java.io.PrintWriter.println(PrintWriter.java:585)\n\tat java.io.PrintWriter.println(PrintWriter.java:696)\n\t- locked <0x00000007d858a178> (a java.io.BufferedWriter)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.sendMessage(RemoteAntBuildLogger.java:135)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.marshalTaskMessage(RemoteAntBuildLogger.java:351)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.processEvent(RemoteAntBuildLogger.java:270)\n\tat org.eclipse.ant.internal.launching.remote.logger.RemoteAntBuildLogger.messageLogged(RemoteAntBuildLogger.java:264)\n\tat org.apache.tools.ant.Project.fireMessageLoggedEvent(Project.java:2254)\n\tat org.apache.tools.ant.Project.fireMessageLogged(Project.java:2353)\n\tat org.apache.tools.ant.Project.log(Project.java:480)\n\tat org.apache.tools.ant.Task.log(Task.java:294)\n\tat org.apache.tools.ant.Task.handleErrorOutput(Task.java:261)\n\tat org.apache.tools.ant.UnknownElement.handleErrorOutput(UnknownElement.java:259)\n\tat org.apache.tools.ant.Project.demuxOutput(Project.java:1270)\n\tat org.apache.tools.ant.taskdefs.Ant.handleErrorOutput(Ant.java:307)\n\tat org.apache.tools.ant.taskdefs.CallTarget.handleErrorOutput(CallTarget.java:234)\n\tat org.apache.tools.ant.UnknownElement.handleErrorOutput(UnknownElement.java:259)\n\tat org.apache.tools.ant.Project.demuxOutput(Project.java:1270)\n\tat org.apache.tools.ant.DemuxOutputStream.processBuffer(DemuxOutputStream.java:172)\n\tat org.apache.tools.ant.DemuxOutputStream.write(DemuxOutputStream.java:147)\n\tat org.apache.tools.ant.DemuxOutputStream.write(DemuxOutputStream.java:241)\n\tat java.io.PrintStream.write(PrintStream.java:430)\n\t- locked <0x00000007d86ce1e0> (a java.io.PrintStream)\n\tat sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:202)\n\tat sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:272)\n\tat sun.nio.cs.StreamEncoder.flushBuffer(StreamEncoder.java:85)\n\t- locked <0x00000007d86ce580> (a java.io.OutputStreamWriter)\n\tat java.io.OutputStreamWriter.flushBuffer(OutputStreamWriter.java:168)\n\tat java.io.PrintStream.newLine(PrintStream.java:496)\n\t- locked <0x00000007d86ce1e0> (a java.io.PrintStream)\n\tat java.io.PrintStream.println(PrintStream.java:757)\n\t- locked <0x00000007d86ce1e0> (a java.io.PrintStream)\n\tat com.getpaid.internal.gpdbbuild.ClearDatabaseSchema.clearSchema(ClearDatabaseSchema.java:257)\n\tat com.getpaid.internal.gpdbbuild.PopulateDatabase.recreateDatabase(PopulateDatabase.java:82)\n\tat com.getpaid.internal.gpdbbuild.PopulateDatabase.PopulateDatabaseViaXmlFiles(PopulateDatabase.java:44)\n\tat com.getpaid.internal.gpdbbuild.GpdbbuildTask.execute(GpdbbuildTask.java:67)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.Target.execute(Target.java:392)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:413)\n\tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1399)\n\tat org.apache.tools.ant.helper.SingleCheckExecutor.executeTargets(SingleCheckExecutor.java:38)\n\tat org.eclipse.ant.internal.launching.remote.EclipseSingleCheckExecutor.executeTargets(EclipseSingleCheckExecutor.java:30)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1251)\n\tat org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:442)\n\tat org.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:105)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:68)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n\tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.taskdefs.Parallel$TaskRunnable.run(Parallel.java:435)\n\tat java.lang.Thread.run(Thread.java:662)\n\n   Locked ownable synchronizers:\n\t- None", "id": 160015, "time": "2012-06-15T02:20:50Z", "bug_id": 53407, "creation_time": "2012-06-15T02:20:50Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "text": "I ran\n\n$ for i in `seq 1 1000`; do ant -f test.xml test; done\n\nand didn't see any hangs.  As you write yourself, it may be a problem with Eclipse's console integration - which is not developed by the Ant team.\n\nThe tasks run in parallel don't get separate classloaders explicitly.  With antcall you are creating new Project instances all the time and they likely set up separate classloaders.", "id": 160056, "time": "2012-06-17T05:37:23Z", "bug_id": 53407, "creation_time": "2012-06-17T05:37:23Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 41176, "text": "I've discovered that some PPT files (eg data/PictureTypeZero.ppt in SVN) have a\nreally crazy first SlideListWithText\n\nIn theory, there should be 2 or 3 of these. The first with MainMasters, the\nsecond with Slides, and the optional third with Notes. However, on files like\nthese, the first one contains both MainMasters and Slides!\n\nI've updated the code to throw a CorruptPowerPointFileException on these docs\n(previously we had a class cast exception), but we need to figure out what (if\nanything) we can do for them.", "id": 96911, "time": "2006-12-14T03:48:11Z", "creator": "apache@gagravarr.org", "creation_time": "2006-12-14T03:48:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "gur@axismobile.com", "attachment_id": 19303, "is_private": false, "id": 97213, "time": "2006-12-24T06:30:37Z", "bug_id": 41176, "creation_time": "2006-12-24T06:30:37Z", "text": "Created attachment 19303\nThis file causes the exception\n\nAs requested - here is an example file that causes HSLF to throw the exception"}, {"count": 2, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "is_private": false, "id": 97818, "time": "2007-01-09T05:37:11Z", "bug_id": 41176, "creation_time": "2007-01-09T05:37:11Z", "text": "Nick,\n\nThis is quite normal. The error happens when the first SLWT has a link to Title\nMatster.\n\nHow to reproduce:\n - open PowerPoint and create a presentation\n - Menu view/slide master\n - Menu Insert/ New Title Master. After it you should have two masters: a slide\nmaster and a title master.\n - save.\n - Try to open it in HSLF and get the error.\nI attached a sample file.\n\nPowerPoint supports two types of slide masters: \n\n * Slide Master. The data is in MainMaster container\n * Title Master. The data is in Slide container. Weird? I think so.\nI don't know why pages with title layout use different master. I guess if it is\nmissing the normal MainMaster \nis used but I didn't research it yet.\n\nI think your code in SlideShow.buildSlidesAndNotes has extra checks that can be\nommitted. \nJust keep in mind, whatever you find in the fist SLWT it is about masters.\n For now we handle only references to MainMasters. Later we will add support for\nTitle, Note and other masters.\nI won't be surprised if we have references to other exotic containers in the\nfirst SLWT.\n\nSee how I changed SlideShow.buildSlidesAndNotes.\n\nRegards,\nYegor"}, {"count": 3, "tags": [], "text": "Created attachment 19380\nppt with title master", "attachment_id": 19380, "bug_id": 41176, "id": 97819, "time": "2007-01-09T05:38:15Z", "creator": "yegor@dinom.ru", "creation_time": "2007-01-09T05:38:15Z", "is_private": false}, {"count": 4, "tags": [], "creator": "yegor@dinom.ru", "text": "Created attachment 19381\nImproved SlideShow.buildSlidesAndNotes", "id": 97820, "time": "2007-01-09T05:39:34Z", "bug_id": 41176, "creation_time": "2007-01-09T05:39:34Z", "is_private": false, "attachment_id": 19381}, {"count": 5, "tags": [], "bug_id": 41176, "text": "So, if a PPT file has the first SLWT with\n  MainMaster\n  Slide\n  ....\nand the second SLWT with\n  Slide\n  Slide\n\nThen all's fine, we ignore (for now) anything other than MainMaster in the first\nSLWT, and grab the slides from the second one?\n\nIf we have a ppt with\n  MainMaster\n  Slide\n  ....\nand no second SLWT, we throw a CorruptPowerPointException?", "id": 97821, "time": "2007-01-09T05:41:30Z", "creator": "apache@gagravarr.org", "creation_time": "2007-01-09T05:41:30Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": ">>Then all's fine, we ignore (for now) anything other than MainMaster in the first\n>>SLWT, and grab the slides from the second one?\n\nYes. We always read master info from the first SLWT and slides from the second\none. Just ignore what we don't support.\n\n>>If we have a ppt with\n>>  MainMaster\n>>  Slide\n>>  ....\n>>and no second SLWT, we throw a CorruptPowerPointException?\n\nYes. There MUST be two SLWTs. If either is missing it means the ppt is corrupted\n(or MS guys put another level of complexity into it :)). \n\nYegor", "is_private": false, "id": 97823, "creator": "yegor@dinom.ru", "time": "2007-01-09T05:50:58Z", "bug_id": 41176, "creation_time": "2007-01-09T05:50:58Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "OK, based on your findings (thanks for those!), I've applied your patch, and\nthen tidied the code up a little more (and made a few variables have more\nsensible names)\n\nHopefully this scheme will be a good starting position for supporting future\nkinds of masters.\n\nI haven't got anything to throw CorruptPowerPoint in the case of not enough\nSLWTs, do you think we should have that check?", "is_private": false, "id": 97834, "creator": "apache@gagravarr.org", "time": "2007-01-09T10:53:54Z", "bug_id": 41176, "creation_time": "2007-01-09T10:53:54Z", "attachment_id": null}]
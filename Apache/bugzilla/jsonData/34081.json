[{"count": 0, "tags": [], "text": "When initializing a StandardContext, the JDBCReam doesn't use the Context's\nclass loader making the driver classes unavailable if they aren't installed\nglobally (eew).  This breaks the ability to use the manager application to\ndeploy an app that uses a JDBCRealm because the driver class is unknown to the\ndefault loader.  This also erodes abstraction between the web application and\nthe application server and would appear to be a bug rather than a feature\nrequest as in bug 33266 (http://issues.apache.org/bugzilla/show_bug.cgi?id=33266).\n\nThis issue was particularly irritating due to bug 34080\n(http://issues.apache.org/bugzilla/show_bug.cgi?id=34080) that I just entered\nin.  Because I didn't have my jdbc driver classes globally installed, I was\ngetting this for an error (trace from 5.0.28 BTW):\n\nJDBCRealm[]: Exception performing authentication\njava.sql.SQLException: oracle.jdbc.driver.OracleDriver\n        at org.apache.catalina.realm.JDBCRealm.open(JDBCRealm.java:589)\n        at org.apache.catalina.realm.JDBCRealm.authenticate(JDBCRealm.java:344)\n        at ... blah blah blah ...\n\nThis obviously didn't give me the information that I needed to understand what\nthe problem was, although I did get a hint.\n\nConsider lines 678 through 686 in the current JDBCRealm.java:\n\n        // Instantiate our database driver if necessary\n        if (driver == null) {\n            try {\n                Class clazz = Class.forName(driverName);\n                driver = (Driver) clazz.newInstance();\n            } catch (Throwable e) {\n                throw new SQLException(e.getMessage());\n            }\n        }\n\nit would appear that solving this problem would be as simple as changing line\n681 to:\n\n                Class clazz = container.getLoader() != null\n                        ? Class.forName(driverName, container.getLoader())\n                        : Class.forName(driverName);\n\nThis would be my 1st time building tomcat, so I'll have to try this this\nweekend.  Is anybody aware of issues that would occur with having a class that\nwas loaded by a different loader however?  Also, can anybody think of problems\nthat this could cause for containers other than Contexts (i.e., should we check\nif container is a Context before we do this)?\n\nThanks,\nDaniel", "is_private": false, "id": 72685, "creator": "daniel.santos@pobox.com", "time": "2005-03-19T05:53:37Z", "bug_id": 34081, "creation_time": "2005-03-19T05:53:37Z", "attachment_id": null}, {"text": "bah! my newbie-dom is revealed.  I put the URLs for the bugs and Bugzilla links\nthem for you... (mental note)...", "tags": [], "creator": "daniel.santos@pobox.com", "is_private": false, "count": 1, "id": 72686, "time": "2005-03-19T05:55:52Z", "bug_id": 34081, "creation_time": "2005-03-19T05:55:52Z", "attachment_id": null}, {"text": "As designed.", "tags": [], "creator": "remm@apache.org", "is_private": false, "count": 2, "id": 72689, "time": "2005-03-19T09:06:43Z", "bug_id": 34081, "creation_time": "2005-03-19T09:06:43Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 34081, "is_private": false, "id": 72695, "time": "2005-03-19T16:38:55Z", "creator": "daniel.santos@pobox.com", "creation_time": "2005-03-19T16:38:55Z", "tags": [], "text": "(In reply to comment #2)\n> As designed.\n\nMy question is why is it designed this way?  True, this is a container managed\nrealm, but I don't understand the rationalization."}]
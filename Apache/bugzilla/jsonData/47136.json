[{"count": 0, "text": "CONFIGURATION\n\nWindows XP (SP3)\nApache Tomcat 6.0.18\nJava 1.6.0_13-b03\n\nSPECIAL TOMCAT SETTINGS\n\nSet on the Connector: \n\n    compression=\"force\"\n\n    compressableMimeType=\"text/html,text/xml,text/plain,text/css,text/javascript,\n        text/json,application/json\"\n\n    noCompressionUserAgents=\"gozilla, traviata\"\n\nTEST CASE\n\n1). Create a file exactly 48K in size somewhere in your tomcat structure that is accessible to the outside.\n\n2). Execute the following CURL command.  (CURL required)\n\ncurl -s -o nul: -H \"Pragma: no-cache\" -H \"Cache-Control: no-cache\" -w \"  Bytes Uncompressed ... %{size_download}\\n\" <INSERT URL TO FILE HERE>\n\n3). Make a note of the uncompressed file size.\n\n4). Execute the following CURL command.\n\ncurl -s -o nul: -H \"Pragma: no-cache\" -H \"Cache-Control: no-cache\" -w \"  Bytes Uncompressed ... %{size_download}\\n\" --compressed <INSERT URL TO FILE HERE>\n\n5). Make a note of the compressed file size.\n\n6). Add exactly one byte the file from step #1.\n\n7). Wait 10 seconds or so to allow your tomcat install time to notice the changed file.\n\n8). Execute the following CURL command.  (CURL required)\n\ncurl -s -o nul: -H \"Pragma: no-cache\" -H \"Cache-Control: no-cache\" -w \"  Bytes Uncompressed ... %%{size_download}\\n\" <INSERT URL TO FILE HERE>\n\n9). Make a note of the uncompressed file size.\n\n10). Execute the following CURL command.\n\ncurl -s -o nul: -H \"Pragma: no-cache\" -H \"Cache-Control: no-cache\" -w \"  Bytes Uncompressed ... %%{size_download}\\n\" --compressed <INSERT URL TO FILE HERE>\n\n11). Make a note of the compressed file size.\n\nOBSERVATION\n\nThe uncompressed and compressed numbers from steps 3 and 5 are different, as expected.  The uncompressed and compressed numbers from steps 7 and 9 are the same.  This indicates that for any file in excess of 49152 bytes (exactly 48k), compression is not being used.\n\nDESIRED RESULTS\n\nCompression should be used regardless of file size.\n\nTEST SCRIPT\n\nI have included a sample Batch Script which will perform this test case.  The script will run on Windowx XP and requires CURL and PING installed and configured into the PATH.\n\n@ECHO off\n\nREM SETUP VARS\nSET FILENAME=test.css\nSET CURLOPTS=-s -o nul: -H \"Pragma: no-cache\" -H \"Cache-Control: no-cache\"\nSET URL=localhost/idp/%FILENAME%\n\necho.\necho Performing Test Case for 48K Maximum Size Limit on Tomcat Compression.\necho.\necho Please be patient during test as some test may take a minute or so echo to run to completion.\n\necho.\necho Testing file of 48k...\nDEL %FILENAME% /Q > nul: 2>&1\ncall :writefirst\ncall :wait 10\ncall :test\n\necho. \necho Testing file of 48k plus 1 byte.\nDEL %FILENAME% /Q > nul: 2>&1\ncall :writesecond\ncall :wait 10\ncall :test\n\ndel %FILENAME% /y > nul: 2>&1\n\necho.\necho Test Complete.\nGOTO :EOF\n\nREM Function for performing the test.\n:test\nCURL %CURLOPTS% -w \"  Bytes Uncompressed ... %%{size_download}\\n\" %URL% CURL %CURLOPTS% -w \"  Bytes Compressed ..... %%{size_download}\\n\" --compressed %URL% GOTO :EOF\n\nREM Function for waiting N seconds, requires PING in the path.  N is specified in the %1 parameter :wait PING 127.0.0.1 -n %1 -w 1000 > nul GOTO :EOF\n\n:writefirst\ncall :writesixteenk\ncall :writesixteenk\ncall :writesixteenk\ngoto :EOF\n\n:writesecond\ncall :writesixteenk\ncall :writesixteenk\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\necho //twelve bytes-twelve bytes-twelve bytes-twelve bytes.........1>>%FILENAME% goto :EOF\n\n:writesixteenk\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ncall :writeonek\ngoto :EOF\n\n:writeonek\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\ncall :writesixtyfourbytes\n:goto EOF\n\n:writesixtyfourbytes\necho //twelve bytes-twelve bytes-twelve bytes-twelve bytes.........>>%FILENAME% goto :EOF", "bug_id": 47136, "attachment_id": null, "id": 126676, "time": "2009-05-01T11:24:38Z", "creator": "arei7@yahoo.com", "creation_time": "2009-05-01T11:24:38Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 47136, "attachment_id": null, "id": 126685, "time": "2009-05-01T12:58:50Z", "creator": "arei7@yahoo.com", "creation_time": "2009-05-01T12:58:50Z", "is_private": false, "text": "Another tester found that on 5.5.27 this behaved as expected."}, {"attachment_id": null, "tags": [], "bug_id": 47136, "text": "Looks like you have something else (filter?) in your configuration that is messing this up. This works for files >48k for me on 6.0.18. At least one other person on the users list reported 6.0.18 worked for them.", "count": 2, "id": 126730, "time": "2009-05-02T17:42:19Z", "creator": "markt@apache.org", "creation_time": "2009-05-02T17:42:19Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 47136, "attachment_id": null, "text": "(In reply to comment #2)\n> Looks like you have something else (filter?) in your configuration that is\n> messing this up. This works for files >48k for me on 6.0.18. At least one other\n> person on the users list reported 6.0.18 worked for them.\n\nI did a clean install and everyone works as it should now.  I apologize for wasting everyone's time.  Yet, I cannot for the life of me figure out what setting I may have changed to cause this behavior.  Oh well, some mysteries are best left unsolved.", "id": 126762, "time": "2009-05-04T09:51:41Z", "creator": "arei7@yahoo.com", "creation_time": "2009-05-04T09:51:41Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 40252, "attachment_id": null, "id": 92212, "time": "2006-08-14T18:47:45Z", "creator": "slwkf1@yahoo.com", "creation_time": "2006-08-14T18:47:45Z", "is_private": false, "text": "We bundle commons-logging in our webapp, and when we attempt to deploy our app\nwe get the following error message:\n\nYou have more than one version of 'org.apache.commons.logging.Log' visible,\nwhich is not allowed\n\nWe wrote some code in our app that attempts to eager-load JCL classes using the\nparent classloader if possible.  We didn't see this issue with Tomcat 4.1.31. \nWe're using JCL 1.1.  We're distributing a web app that must be portable, so we\ncan't exclude JCL.  For more info on our approach, see\nhttp://rbodkin.blogs.com/ron_bodkins_blog/2006/07/stupid_log_tric.html"}, {"count": 1, "tags": [], "text": "In particular, with Tomcat 4.1.31 we are able to deploy and run our application\nsuccessfully with commons-logging included in the WEB-INF/lib directory, but in\nTomcat 4.1.32 we get the error below when parsing XML during deployment. Here is\nthe stack trace:\n\nApache Tomcat/4.1.32-LE-jdk14\nAug 14, 2006 11:54:15 AM org.apache.commons.digester.Digester endElement\nSEVERE: End event threw exception\norg.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Invalid class loader\nhierarchy.  You have more than one version of 'org.apache.commons.logging.Log'\nvisible, which is not allowed. (Caused by\norg.apache.commons.logging.LogConfigurationException: Invalid class loader\nhierarchy.  You have more than one version of 'org.apache.commons.logging.Log'\nvisible, which is not allowed.) (Caused by\norg.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Invalid class loader\nhierarchy.  You have more than one version of 'org.apache.commons.logging.Log'\nvisible, which is not allowed. (Caused by\norg.apache.commons.logging.LogConfigurationException: Invalid class loader\nhierarchy.  You have more than one version of 'org.apache.commons.logging.Log'\nvisible, which is not allowed.))\n\tat\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:543)\n\tat\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:235)\n\tat\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:209)\n\tat org.apache.commons.logging.LogFactory.getLog(LogFactory.java:351)\n\tat org.apache.commons.beanutils.ConvertUtilsBean.<init>(ConvertUtilsBean.java:130)\n\tat org.apache.commons.beanutils.BeanUtilsBean.<init>(BeanUtilsBean.java:110)\n\tat org.apache.commons.beanutils.BeanUtilsBean$1.initialValue(BeanUtilsBean.java:68)\n\tat\norg.apache.commons.beanutils.ContextClassLoaderLocal.get(ContextClassLoaderLocal.java:80)\n\tat org.apache.commons.beanutils.BeanUtilsBean.getInstance(BeanUtilsBean.java:78)\n\tat\norg.apache.commons.beanutils.ConvertUtilsBean.getInstance(ConvertUtilsBean.java:115)\n\tat org.apache.commons.beanutils.ConvertUtils.convert(ConvertUtils.java:217)\n\tat org.apache.commons.digester.CallMethodRule.end(CallMethodRule.java:560)\n\tat org.apache.commons.digester.Rule.end(Rule.java:230)\n\tat org.apache.commons.digester.Digester.endElement(Digester.java:1130)\n\tat\ncom.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:633)\n\tat\ncom.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.endNamespaceScope(XMLDTDValidator.java:2108)\n\tat\ncom.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.handleEndElement(XMLDTDValidator.java:2059)\n\tat\ncom.sun.org.apache.xerces.internal.impl.dtd.XMLDTDValidator.endElement(XMLDTDValidator.java:932)\n\tat\ncom.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1241)\n\tat\ncom.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1685)\n\tat\ncom.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:368)\n\tat\ncom.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:834)\n\tat\ncom.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:764)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:148)\n\tat\ncom.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1242)\n\tat org.apache.commons.digester.Digester.parse(Digester.java:1647)\n\tat org.apache.catalina.startup.ContextConfig.defaultConfig(ContextConfig.java:487)\n\tat org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:578)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:181)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:3643)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:776)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:759)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:537)\n\tat\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:260)\n\tat org.apache.catalina.core.StandardHost.install(StandardHost.java:730)\n\tat org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:558)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:373)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:784)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:330)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1155)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:696)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1147)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:310)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:449)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:2212)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:458)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:345)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:129)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:150)\nCaused by: org.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Invalid class loader\nhierarchy.  You have more than one version of 'org.apache.commons.logging.Log'\nvisible, which is not allowed. (Caused by\norg.apache.commons.logging.LogConfigurationException: Invalid class loader\nhierarchy.  You have more than one version of 'org.apache.commons.logging.Log'\nvisible, which is not allowed.)\n\tat\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:397)\n\tat\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:529)\n\t... 54 more\nCaused by: org.apache.commons.logging.LogConfigurationException: Invalid class\nloader hierarchy.  You have more than one version of\n'org.apache.commons.logging.Log' visible, which is not allowed.\n\tat\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:385)\n\t... 55 more\nAug 14, 2006 11:54:16 AM org.apache.coyote.http11.Http11BaseProtocol start\nINFO: Starting Coyote HTTP/1.1 on http-8080", "is_private": false, "id": 92213, "creator": "rbodkin+LISTS@gmail.com", "time": "2006-08-14T18:53:23Z", "bug_id": 40252, "creation_time": "2006-08-14T18:53:23Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "I know this should be easy for me to reproduce but I am rather short of time at\nthe moment. Would you be able to create a simple test war and attach it to this\nbug report? This would be a big help.", "attachment_id": null, "id": 92238, "creator": "markt@apache.org", "time": "2006-08-16T01:37:40Z", "bug_id": 40252, "creation_time": "2006-08-16T01:37:40Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 40252, "attachment_id": null, "is_private": false, "id": 92361, "time": "2006-08-20T00:18:19Z", "creator": "markt@apache.org", "creation_time": "2006-08-20T00:18:19Z", "text": "No need for test war. Just adding jar to web app is enough. Not sure what\nchanged caused this but it isn't looking good for a fix."}, {"count": 4, "tags": [], "bug_id": 40252, "attachment_id": null, "id": 92363, "time": "2006-08-20T23:37:15Z", "creator": "markt@apache.org", "creation_time": "2006-08-20T23:37:15Z", "is_private": false, "text": "This is caused by a change in the way commons-beanutils (required by\ncommons-digester) creates objects. It now does things per classloader in some\ncases and this causes the conflict in commons-logging when it tries to create\nits logger.\n\nI am pursuing a fix with the commons-beanutils team but for now I am going to\nrevert to commons-beanutils 1.6.1 for TC 4.1.33. Votes and time permitting, a\nrelease will follow soon."}, {"count": 5, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "This is now working (using commons-logging-1.1). Expect 4.1.34 shortly.", "id": 92483, "time": "2006-08-24T00:03:48Z", "bug_id": 40252, "creation_time": "2006-08-24T00:03:48Z", "attachment_id": null}]
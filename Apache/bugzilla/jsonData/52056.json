[{"count": 0, "tags": [], "bug_id": 52056, "text": "Created attachment 27818\ndefault value for request_rec.status\n\nIn case JkLogFormat contains \"%s\" (Request HTTP status) placeholder - it is not always shows correct codes.\nIf there are no workers available - mod_jk records 200 (HTTP_OK) in logs, while httpd records and shows 503 error:\n\n<<access.log:\n172.16.16.1 - - [19/Oct/2011:10:35:01 +0300] \"GET / HTTP/1.1\" 503 323\n\n<<mod_jk.log:\n[Wed Oct 19 10:35:01.906 2011] [2053:3086162528] [error] ajp_send_request::jk_ajp_common.c (1630): (devel) connecting to backend failed. Tomcat is probably not started or is listening on the wrong port (errno=111)                        \n[Wed Oct 19 10:35:01.906 2011] [2053:3086162528] [error] ajp_send_request::jk_ajp_common.c (1630): (devel) connecting to backend failed. Tomcat is probably not started or is listening on the wrong port (errno=111)                        \n[Wed Oct 19 10:35:01.906 2011] [2053:3086162528] [error] ajp_service::jk_ajp_common.c (2626): (devel) connecting to tomcat failed.\n\n[Wed Oct 19 10:35:01.906 2011] 0.100435 - vm201.int GET / HTTP/1.1 200\n\n[Wed Oct 19 10:35:01.906 2011] [2053:3086162528] [info] jk_handler::mod_jk.c (2678): Service error=-3 for worker=devel\n\nIt seems that request.status (the one that got recorded in logs) have default value of 200 and is updated only in jk_ajp_common.c::ajp_get_reply(). But this function never hit if jk_ajp_common.c::ajp_send_request() returns anything besides JK_TRUE. \nMaybe request.status variable should be initialized the same way as is_error variable in jk_handler() - default value HTTP_INTERNAL_SERVER_ERROR, and all subsequent  functions will alter its value to one they needed. With such modification mod_jk will put 500 error in case request failed before it have a chance to connect to backend (see attachment).", "id": 150749, "time": "2011-10-19T10:04:19Z", "creator": "avenger@dmz.org.ua", "creation_time": "2011-10-19T10:04:19Z", "is_private": false, "attachment_id": 27818}, {"count": 1, "tags": [], "bug_id": 52056, "text": "With patch applied I have more correct values in logs:\n<<access.log:\n[19/Oct/2011:12:32:45 +0300] \"GET / HTTP/1.1\" 503 323 \"-\"\n[19/Oct/2011:12:33:45 +0300] \"GET /jk-status HTTP/1.1\" 200 5459 \"-\"\n\n<<mod_jk.log:\n[19/Oct/2011:12:32:45 +0300] 0.101018 - vm201.int \"GET / HTTP/1.1\" 500\n19/Oct/2011:12:33:45 +0300] 0.002270 - vm201.int \"GET /jk-status HTTP/1.1\" 200", "id": 150750, "time": "2011-10-19T10:07:32Z", "creator": "avenger@dmz.org.ua", "creation_time": "2011-10-19T10:07:32Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "1. Versions of everything = ?\nThere are various fixes in various Tomcat versions and the behaviour may be different.\n\n2. What exactly are those files, \"access.log\" and \"mod_jk.log\"?\nOr better provide exact steps & configuration to reproduce this.", "is_private": false, "bug_id": 52056, "id": 150751, "time": "2011-10-19T10:15:39Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-10-19T10:15:39Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "avenger@dmz.org.ua", "attachment_id": 27819, "text": "Created attachment 27819\nmod_jk configuration", "id": 150753, "time": "2011-10-19T10:38:00Z", "bug_id": 52056, "creation_time": "2011-10-19T10:38:00Z", "is_private": false}, {"count": 4, "tags": [], "text": "Created attachment 27820\nmod_jk workers properties\n\nSorry, forget about versions:\nmod_jk - 1.2.32 (latest) \nhttpd - 2.2.21\n\naccess.log - default apache access log, configured with:\nCustomLog /var/log/httpd/access.log combined\n\nmod_jk.log - default mod_jk log file:\nJkLogFile /var/log/httpd/mod_jk.log\nJkRequestLogFormat     \"%T %R %V \\\"%r\\\" %s\"\n\nConfiguration is simple - any unreachable worker will work. See attachments for example configuration.", "is_private": false, "bug_id": 52056, "id": 150754, "time": "2011-10-19T10:38:33Z", "creator": "avenger@dmz.org.ua", "creation_time": "2011-10-19T10:38:33Z", "attachment_id": 27820}, {"count": 5, "tags": [], "bug_id": 52056, "text": "Fixed in r1187906. Will be part of mod_jk 1.2.33.\n\nTo fix the problem, the JK request log was refactored to use the standard request log hook. You can apply the changes in r1187906 on top of 1.2.32 to test it.\n\nregards,\n\nRainer", "id": 150843, "time": "2011-10-23T15:31:17Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-10-23T15:31:17Z", "is_private": false, "attachment_id": null}]
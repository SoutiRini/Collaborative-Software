[{"count": 0, "tags": [], "creator": "mdabbs@vibephone.com", "attachment_id": null, "text": "With two systems, I tried to enable clustering so that sessions would replicate\nin case of a failure on one of the systems.  The two systems have 3 network\ncards in them.  eth2 goes to the NAS while eth1 and eth0 are on the main network\nof other apache and tomcat servers.  eth0 is a backup for eth1 and is normally down.\n\nThe problem seems to be when I specify which interface to bind to in the\nMembership node of server.xml.  If I specify\nmcastBindAddress=\"<eth1-ip-address>\", I can tell that Tomcat is listening and\nsending on this address.  However, it seems that packets never get delivered to\nthe receive method in the McastServiceImpl class.  I've confirmed that the\nmulticast traffic reaches the machine but with debug logging on, I never get the\n'mcast receive' log message.\n\nIf I remove the mcastBindAddress attribute from the Membership node in\nserver.xml, the multicast traffic gets delivered and session replication works.\n\nOn single-homed systems, it does not seem to matter if mcastBindAddress is set\nor not - the multicast packets get delivered.", "id": 90760, "time": "2006-06-29T14:52:59Z", "bug_id": 39931, "creation_time": "2006-06-29T14:52:59Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 39931, "attachment_id": null, "text": "multicasting on a multihomed computer will require your routes to be setup\ncorrectly on the box. I suggest using a tool like ethereal to debug where the\npackets go, and report back to us, and we can address it then", "id": 90766, "time": "2006-06-29T16:54:04Z", "creator": "fhanik@apache.org", "creation_time": "2006-06-29T16:54:04Z", "is_private": false}, {"count": 2, "tags": [], "creator": "mdabbs@vibephone.com", "text": "I captured packets using tcpdump and opened the captured file using Ethereal. \nIt shows that both machines do in fact receive the traffic.  The following is a\ncapture from 192.168.179.82:\n\nNo.     Time        Source                Destination           Protocol Len   \nCum.Len  Info\n      1 0.000000    192.168.179.82        228.0.0.4             UDP      99    \n99       Source port: 45564  Destination port: 45564\n      2 0.353582    192.168.179.83        228.0.0.4             UDP      99    \n198      Source port: 45564  Destination port: 45564\n      3 0.509843    192.168.179.82        228.0.0.4             UDP      99    \n297      Source port: 45564  Destination port: 45564\n      4 0.863437    192.168.179.83        228.0.0.4             UDP      99    \n396      Source port: 45564  Destination port: 45564\n      5 1.019700    192.168.179.82        228.0.0.4             UDP      99    \n495      Source port: 45564  Destination port: 45564\n      6 1.373288    192.168.179.83        228.0.0.4             UDP      99    \n594      Source port: 45564  Destination port: 45564\n      7 1.529552    192.168.179.82        228.0.0.4             UDP      99    \n693      Source port: 45564  Destination port: 45564\n      8 1.883166    192.168.179.83        228.0.0.4             UDP      99    \n792      Source port: 45564  Destination port: 45564\n      9 2.039411    192.168.179.82        228.0.0.4             UDP      99    \n891      Source port: 45564  Destination port: 45564\n     10 2.392998    192.168.179.83        228.0.0.4             UDP      99    \n990      Source port: 45564  Destination port: 45564\n\n\nIt appears to be a very similar, if not the same, issue as what is discussed at\nthe following thread:\n\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=114020671804619&w=2\n\nThe network config:\n\neth0      Link encap:Ethernet  HWaddr 00:0A:5E:62:8A:7C\n          BROADCAST MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)\n          Interrupt:72 Base address:0x5000\n\neth1      Link encap:Ethernet  HWaddr 00:16:35:3C:7C:8C\n          inet addr:192.168.179.82  Bcast:192.168.179.127  Mask:255.255.255.192\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:19735681 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:19618826 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:3766136075 (3591.6 Mb)  TX bytes:2509851526 (2393.5 Mb)\n          Interrupt:25\n\neth2      Link encap:Ethernet  HWaddr 00:16:35:3C:7C:8B\n          inet addr:172.20.183.82  Bcast:172.20.183.127  Mask:255.255.255.128\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:1095636 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:158700 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:90195462 (86.0 Mb)  TX bytes:32106664 (30.6 Mb)\n          Interrupt:26\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:59811340 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:59811340 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:225325405 (214.8 Mb)  TX bytes:225325405 (214.8 Mb)\n", "id": 90768, "time": "2006-06-29T18:32:33Z", "bug_id": 39931, "creation_time": "2006-06-29T18:32:33Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 39931, "attachment_id": null, "text": "This are not a tomcat cluster problem! It seem that network config is wrong.\nPlease give us more information, that we can simulate the problem.\n", "id": 106733, "time": "2007-08-14T01:30:57Z", "creator": "pr@objektpark.de", "creation_time": "2007-08-14T01:30:57Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 39931, "is_private": false, "text": "Specifically what do you think is wrong about the network config? I will try to\nprovide more info in that area or any other that you think is related.\n\nFilip mentioned that the routing may be set up wrong.  Here is the output of\nroute for the .82 machine:\n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n192.168.179.64  *               255.255.255.192 U     0      0        0 eth1\n172.20.183.0    *               255.255.255.128 U     0      0        0 eth2\n169.254.0.0     *               255.255.0.0     U     0      0        0 eth2\ndefault         gs-dev-si1-int. 0.0.0.0         UG    0      0        0 eth1\n\nIf there is any other info I can provide, please let me know.", "id": 106747, "time": "2007-08-14T05:53:46Z", "creator": "mdabbs@vibephone.com", "creation_time": "2007-08-14T05:53:46Z", "attachment_id": null}]
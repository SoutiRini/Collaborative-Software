[{"count": 0, "tags": [], "bug_id": 51756, "attachment_id": null, "id": 148976, "time": "2011-09-02T10:56:26Z", "creator": "windson.rangavajhala@gmail.com", "creation_time": "2011-09-02T10:56:26Z", "is_private": false, "text": "hi\n\nWe wanted to try out the new Tomcat JDBC Pool as our connection pooling software. We followed the bare minimum steps given in the \"Plain Ol' Java\" section at http://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html. We managed to get this connect to SQL Server db properly. But, we are getting the below exception when we try connecting to Sybase db.\n\nWith JTDS driver\n****************\n\njava.sql.SQLException: I/O Error: Stream 0 attempting to read when no request has been sent\n\tat net.sourceforge.jtds.jdbc.TdsCore.executeSQL(TdsCore.java:1052)\n\tat net.sourceforge.jtds.jdbc.TdsCore.submitSQL(TdsCore.java:898)\n\tat net.sourceforge.jtds.jdbc.ConnectionJDBC2.<init>(ConnectionJDBC2.java:409)\n\tat net.sourceforge.jtds.jdbc.ConnectionJDBC3.<init>(ConnectionJDBC3.java:50)\n\tat net.sourceforge.jtds.jdbc.Driver.connect(Driver.java:182)\n\tat org.apache.tomcat.jdbc.pool.PooledConnection.connectUsingDriver(PooledConnection.java:267)\n\tat org.apache.tomcat.jdbc.pool.PooledConnection.connect(PooledConnection.java:176)\n\tat org.apache.tomcat.jdbc.pool.ConnectionPool.createConnection(ConnectionPool.java:653)\n\tat org.apache.tomcat.jdbc.pool.ConnectionPool.borrowConnection(ConnectionPool.java:595)\n\tat org.apache.tomcat.jdbc.pool.ConnectionPool.init(ConnectionPool.java:458)\n\tat org.apache.tomcat.jdbc.pool.ConnectionPool.<init>(ConnectionPool.java:130)\n\tat org.apache.tomcat.jdbc.pool.DataSourceProxy.createPool(DataSourceProxy.java:99)\n\tat org.apache.tomcat.jdbc.pool.DataSourceProxy.getConnection(DataSourceProxy.java:110)\n\tat DBPoolManager.getConnection(DBPoolManager.java:359)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:525)\n\tat java.lang.Class.newInstance0(Class.java:372)\n\tat java.lang.Class.newInstance(Class.java:325)\n\nWith JConnect driver\n********************\n\njava.sql.SQLException: JZ006: Caught IOException: com.sybase.jdbc3.jdbc.SybConnectionDeadException: JZ0C0: Connection is already closed.\n\tat com.sybase.jdbc3.jdbc.ErrorMessage.createIOEKilledConnEx(Unknown Source)\n\tat com.sybase.jdbc3.jdbc.ErrorMessage.raiseErrorCheckDead(Unknown Source)\n\tat com.sybase.jdbc3.tds.Tds.a(Unknown Source)\n\tat com.sybase.jdbc3.tds.Tds.a(Unknown Source)\n\tat com.sybase.jdbc3.tds.Tds.language(Unknown Source)\n\tat com.sybase.jdbc3.jdbc.SybStatement.sendQuery(Unknown Source)\n\tat com.sybase.jdbc3.jdbc.SybStatement.execute(Unknown Source)\n\tat com.sybase.jdbc3.jdbc.SybStatement.execute(Unknown Source)\n\tat DBPoolManager.getConnection(DBPoolManager.java:372)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:525)\n\tat java.lang.Class.newInstance0(Class.java:372)\n\tat java.lang.Class.newInstance(Class.java:325)\n\nIt will be great if you can look into this.\n\nFYI: we tried with tomcat 6.0, jtds 1.2.2, 1.2.5 and jConnect 6.05.\n\nBelow is the code used by us with some of the properties masked. Please note that there is no error in our driver URL which has been working fine with connection pool s/w like snaq.\n\nimport java.sql.Connection;\nimport java.sql.SQLException;\nimport java.sql.Statement;\n\nPooplProperties pp = PoolProperties();\npp.setUrl(driverURL);\npp.setDriverClassName(\"net.sourceforge.jtds.jdbc.Driver\");\npp.setUsername(login);\npp.setPassword(password);\npp.setJmxEnabled(true);\npp.setTestWhileIdle(false);\npp.setTestOnBorrow(true);\npp.setValidationQuery(\"SELECT 1\");\npp.setTestOnReturn(false);\npp.setValidationInterval(30000);\npp.setTimeBetweenEvictionRunsMillis(30000);\npp.setMaxActive(maxPoolConn);\npp.setInitialSize(initialConn);\npp.setMaxAge(expiryTime);\npp.setRemoveAbandonedTimeout(60);\npp.setMinEvictableIdleTimeMillis(30000);\npp.setMinIdle(10);\npp.setLogAbandoned(true);\npp.setRemoveAbandoned(true);\n\nDataSource ds = new DataSource();\nds.setPoolProperties(pp);\nds.getConnection();\nStatement stm = con.createStatement();\nstm.execute(\"Select 1\");\n\nThanks,\nPavan"}, {"count": 1, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "is_private": false, "id": 148998, "time": "2011-09-02T17:18:44Z", "bug_id": 51756, "creation_time": "2011-09-02T17:18:44Z", "text": "what's the value of 'driverURL'? most likely this one is not correct. there is nothing magic calling Driver.connect, if this call is failing. could be a version thing on the URL itself.\n\nConnect SQL 7.0\njdbc:jtds:sqlserver://ServerAddress/DBName;instance=;TDS=5.0\nConnect SQL 6.5\njdbc:jtds:sqlserver://ServerAddress/DBName;instance=;TDS=4.2 \n\nwhat I would like for you to do is in plain Java\n\nProperties p = new Properties();\np.put(\"user\",username);\np.put(\"password\", password);\nDriver driver = (Driver)Class.forName(\"net.sourceforge.jtds.jdbc.Driver\").newInstance();\ndriver.connect(driverUrl, p);\n\nIt should yield the exact same error if you don't change any of the variables."}, {"count": 2, "tags": [], "creator": "windson.rangavajhala@gmail.com", "text": "hi\n\nThanks for taking your time to look at this error. I got the issue resolved. Our db server expects appName and processId for connection, which were not getting passed correctly. I appended them to the driver URL and it worked fine. Please close this request for now. I am changing the subject accordingly. Please feel free to change as per your convenience.\n\nThanks!", "id": 149027, "time": "2011-09-05T10:25:21Z", "bug_id": 51756, "creation_time": "2011-09-05T10:25:21Z", "is_private": false, "attachment_id": null}]
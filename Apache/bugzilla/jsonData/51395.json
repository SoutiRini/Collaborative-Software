[{"count": 0, "tags": [], "creator": "ArjenCornelis.Knibbe@Getronics.com", "attachment_id": null, "id": 147274, "time": "2011-06-20T14:57:46Z", "bug_id": 51395, "creation_time": "2011-06-20T14:57:46Z", "is_private": false, "text": "Overview\nThe class org.apache.catalina.startup.ContextConfig has an array of org.apache.tomcat.util.digester.Digester objects. Each Digester has a field factory to refer to a SAXParserFactory. If that SAXParserFactory is loaded via a WebappClassLoader, that WebappClassLoader is stuck in memory.\n\nSteps to reproduce\nCreate a Web application that has xercesImpl.jar in its lib. (The Web application itself doesn't need to use any of the xerces classes.) Upload the application war file using Tomcat Manager. Verify that the application is loaded via Tomcat Manager -> List Applications\n\nRestart Tomcat. Via Tomcat Manager -> List Applications, verify that the application is running. Undeploy the application. Click on Find leaks. The message above shows the application as leaking.\n\nMake a memory dump using jmap, inspect the memory using jhat.\nThe WebappClassLoader for this application is still present. Its \"reference chains from rootset\" shows a chain like this:\nStatic reference from org.apache.catalina.startup.ContextConfig.webDigesters (from class org.apache.catalina.startup.ContextConfig) :\n--> [Lorg.apache.tomcat.util.digester.Digester;@0x78be4958 (24 bytes) (Element 0 of [Lorg.apache.tomcat.util.digester.Digester;@0x78be4958:)\n--> org.apache.tomcat.util.digester.Digester@0x78be3c50 (101 bytes) (field factory:)\n--> org.apache.xerces.jaxp.SAXParserFactoryImpl@0x78bf0b28 (20 bytes) (??:)\n--> class org.apache.xerces.jaxp.SAXParserFactoryImpl (84 bytes) (??:)\n--> org.apache.catalina.loader.WebappClassLoader@0x78be3ea0 (165 bytes)"}, {"count": 1, "tags": [], "creator": "ArjenCornelis.Knibbe@Getronics.com", "text": "Created attachment 27179\nMinimal web application with xercesImpl in lib", "id": 147275, "time": "2011-06-20T15:07:59Z", "bug_id": 51395, "creation_time": "2011-06-20T15:07:59Z", "is_private": false, "attachment_id": 27179}, {"count": 2, "tags": [], "creator": "ArjenCornelis.Knibbe@Getronics.com", "text": "Created attachment 27180\nMinimal web application with xercesImpl in lib - second part", "id": 147276, "time": "2011-06-20T15:08:46Z", "bug_id": 51395, "creation_time": "2011-06-20T15:08:46Z", "is_private": false, "attachment_id": 27180}, {"count": 3, "tags": [], "bug_id": 51395, "attachment_id": null, "text": "Thanks for the report. This has been fixed in 7.0.x and will be included in 7.0.17 onwards.", "id": 147289, "time": "2011-06-20T19:27:43Z", "creator": "markt@apache.org", "creation_time": "2011-06-20T19:27:43Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 51395, "attachment_id": null, "text": "*** Bug 51652 has been marked as a duplicate of this bug. ***", "id": 148585, "time": "2011-08-12T09:14:55Z", "creator": "markt@apache.org", "creation_time": "2011-08-12T09:14:55Z", "is_private": false}]
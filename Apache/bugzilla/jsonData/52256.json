[{"count": 0, "tags": [], "text": "Created attachment 27993\nPatch (check NULLness of name before use)\n\nLast Friday, a SAMSUNG-GT-S5230 stumbled across one of our servers and sent the following Cookie Header (truncated):\n\nCookie: =; facdd=1; facdp=240#947; facdo=portrait\n\nSince we do log one cookies on this specific server via a LogFormat with NAME=\\\"%{COOKIENAME}C\\\", this caused a segfault in apr_collapse_spaces, called from log_cookie. In log_cookie(), name is set to NULL for the nameless and valueless cookie, which causes just about everything in the following block to segfault.\n\n(Line numbers don't align with stock httpd 2.2.21 due an unrelated custom patch in log_env_var()).\n\n#0  apr_collapse_spaces (dest=0x0, src=0x0) at strings/apr_cpystrn.c:220\n220\t    while (*src) {\n(gdb) bt\n#0  apr_collapse_spaces (dest=0x0, src=0x0) at strings/apr_cpystrn.c:220\n#1  0x000000000046b4a4 in log_cookie (r=0xcac1790, a=0xaf048d0 \"COOKIENAME\") at mod_log_config.c:561\n#2  0x000000000046ab94 in process_item (r=<value optimized out>, cls=0x9ffdde8, default_format=<value optimized out>) at mod_log_config.c:976\n#3  config_log_transaction (r=<value optimized out>, cls=0x9ffdde8, default_format=<value optimized out>) at mod_log_config.c:1039\n#4  0x000000000046acb3 in multi_log_transaction (r=0x0) at mod_log_config.c:1070\n#5  0x00000000004363ea in ap_run_log_transaction (r=0xcac1790) at protocol.c:1696\n#6  0x00000000004a9e5c in ap_process_request (r=0xcac1790) at http_request.c:308\n#7  0x00000000004a69e0 in ap_process_http_connection (c=0xb45c1b0) at http_core.c:190\n#8  0x000000000044e21a in ap_run_process_connection (c=0xb45c1b0) at connection.c:43\n#9  0x00000000004e1330 in child_main (child_num_arg=<value optimized out>) at prefork.c:667\n#10 0x00000000004e1741 in make_child (s=0x86e4710, slot=38) at prefork.c:771\n#11 0x00000000004e1fb8 in ap_mpm_run (_pconf=<value optimized out>, plog=<value optimized out>, s=<value optimized out>) at prefork.c:906\n#12 0x000000000042fae6 in main (argc=3, argv=0x7fff3072ecc8) at main.c:739\n(gdb) up\n#1  0x000000000046b4a4 in log_cookie (r=0xcac1790, a=0xaf048d0 \"COOKIENAME\") at mod_log_config.c:561\n561\t            apr_collapse_spaces(name, name);", "attachment_id": 27993, "bug_id": 52256, "id": 151831, "time": "2011-11-28T15:16:11Z", "creator": "rainer-apache@7val.com", "creation_time": "2011-11-28T15:16:11Z", "is_private": false}, {"count": 1, "tags": [], "creator": "i.galic@brainsware.org", "is_private": false, "id": 151832, "attachment_id": null, "bug_id": 52256, "creation_time": "2011-11-28T15:33:09Z", "time": "2011-11-28T15:33:09Z", "text": "Doesn't that mean that if the name is now empty you don't escape the value either? - Or am I misreading this?"}, {"count": 2, "tags": [], "creator": "rainer-apache@7val.com", "is_private": false, "id": 151833, "attachment_id": null, "bug_id": 52256, "creation_time": "2011-11-28T16:31:25Z", "time": "2011-11-28T16:31:25Z", "text": "(In reply to comment #1)\n> Doesn't that mean that if the name is now empty you don't escape the value\n> either? - Or am I misreading this?\n\nI assume you are misreading the patch. If the name is empty, nothing will be returned for this cookie, the return ap_escape_logitem() is never called. Instead, the while loop simply proceeds with the next cookie. If no other cookie matches, NULL is returned at the exit of the function. Cookies with empty names are illegal according to rfc2109, so there's no need to consider the case that someone might want to log such things with %{}C."}, {"count": 3, "tags": [], "text": "trunk: r1225380\n2.4: r1225385", "is_private": false, "bug_id": 52256, "id": 152454, "time": "2011-12-28T23:18:40Z", "creator": "sf@sfritsch.de", "creation_time": "2011-12-28T23:18:40Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "attachment_id": null, "id": 153192, "time": "2012-01-26T13:54:48Z", "bug_id": 52256, "creation_time": "2012-01-26T13:54:48Z", "is_private": false, "text": "backported to 2.2: r1227292\n\nAnd Assigned as CVE-2012-0021"}, {"count": 5, "tags": [], "text": "2.2.22 is released", "attachment_id": null, "bug_id": 52256, "id": 153452, "time": "2012-02-04T20:52:15Z", "creator": "sf@sfritsch.de", "creation_time": "2012-02-04T20:52:15Z", "is_private": false}]
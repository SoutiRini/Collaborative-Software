[{"count": 0, "attachment_id": 31091, "bug_id": 55844, "text": "Created attachment 31091\nsample xls with inline custom colors created in Excel 2013\n\nThe attached color.xls is created with excel 2013. cell 0,0 has a custom foreground fill color applied with rgb values 0, 100, 255.\n\nExtracting that color with the below sample code gives 0:0:FFFF, (which is not the color in the actual workbook).\n\nNote that when this same book is saved as xlsx, using the XSSF code allows you to extract the correct RGB value.\n\nimport org.apache.poi.hssf.util.HSSFColor;\nimport org.apache.poi.ss.usermodel.*;\nimport java.io.FileInputStream;\n\npublic class TestColor {\n  public static void main(String[] args) throws Exception {\n    FileInputStream in = new FileInputStream(args[0]);\n    Workbook wb = WorkbookFactory.create(in);\n    Sheet sheet = wb.getSheetAt(0);\n    Cell cell = sheet.getRow(0).getCell(0);\n    System.out.println(((HSSFColor)cell.getCellStyle().getFillForegroundColorColor()).getHexString());\n  }\n}", "id": 171564, "time": "2013-12-04T17:02:55Z", "creator": "bknippen@abinitio.com", "creation_time": "2013-12-04T17:02:55Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 55844, "text": "In LibreOffice, the sample file uses color \"blue\" from the default color palette and I could not find a record in the xls with sid 0x0092 which would indicate a custom palette. Blue is 0:0:255, which is rendered as hex-string 0:0:FFFF currently, so from this angle POI seems to be correct. \n\nSo either the newer Excel stores the colors differently or the sample file is not actually setting the fill-color that you describe, I will try on a Windows box to verify.", "id": 171634, "time": "2013-12-08T12:47:38Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2013-12-08T12:47:38Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 55844, "attachment_id": null, "id": 171649, "time": "2013-12-08T19:34:54Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2013-12-08T19:34:54Z", "is_private": false, "text": "I verified now that on Windows in Excel 2010 the file shows a custom color of 0:100:255 as you state, further investigation indicates that this is likely a feature that POI does not fully support yet. \n\nThe BiffViewer shows the following record which seems to contain this data:\n\nOffset=0x00001BC8(7112) recno=178 sid=0x087D size=0x0041(65)\n[XFEXT] (0x87D)\n  rawData=[7D, 08, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00, 3E, 00, 00, 00, 03, 00, 0D, 00, 14, 00, 03, 00, 00, 00, 01, 00, 00, 00, 30, 30, 5C, 29, 3B, 5F, 28, 2A, 0E, 00, 05, 00, 02, 04, 00, 14, 00, 02, 00, 00, 00, 00, 64, FF, FF, 3B, 5F, 28, 40, 5F, 29, 20, 20]\n[/XFEXT]\n\n\nThe sid 087D is listed as \"not yet supported\" in UnknownRecord.java, not sure if there is enough public description of this record-type to implement support for it in POI."}, {"count": 3, "tags": [], "bug_id": 55844, "attachment_id": null, "id": 171653, "time": "2013-12-08T20:30:17Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2013-12-08T20:30:17Z", "is_private": false, "text": "Bug 46938 talks about similar issues, it seems Excel 2007 introduced this extended record. \n\nSee http://msdn.microsoft.com/en-us/library/dd925873%28v=office.12%29.aspx for details about the record, however it seems to be not fully up to date as it specifies fields as \"reserved and must be 0\" which are set in this file..."}]
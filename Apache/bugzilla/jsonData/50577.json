[{"count": 0, "tags": [], "bug_id": 50577, "attachment_id": 26481, "id": 143287, "time": "2011-01-11T23:44:45Z", "creator": "g.trentalancia@libero.it", "creation_time": "2011-01-11T23:44:45Z", "is_private": false, "text": "Created attachment 26481\nPatch to support Berkeley DB5 in apr-util version 1.3.9\n\nAt the moment it seems that apr-util cannot be compiled straight for Berkeley DB version 5.\n\nHowever, a minimal patch would allow to do that (the patch is also attached separately to this bug report):\n\n--- apr-util-1.3.9-orig/dbm/apr_dbm_berkeleydb.c        2008-11-21 09:22:35.000000000 +0100\n+++ apr-util-1.3.9/dbm/apr_dbm_berkeleydb.c     2011-01-12 05:18:57.789299539 +0100\n@@ -37,7 +37,7 @@\n  * DB_185, DB2, DB3, and DB4.\n  */\n \n-#if   defined(DB_VERSION_MAJOR) && (DB_VERSION_MAJOR == 4)\n+#if   defined(DB_VERSION_MAJOR) && (DB_VERSION_MAJOR >= 4)\n /* We will treat anything greater than 4.1 as DB4.\n  * We can treat 4.0 as DB3.\n  */\n\nAnd here is the test results after compilation (all successful apparently):\n\nteststrmatch        : SUCCESS\ntesturi             : SUCCESS\ntestuuid            : SUCCESS\ntestbuckets         : SUCCESS\ntestpass            : SUCCESS\ntestmd4             : SUCCESS\ntestmd5             : SUCCESS\ntestdbd             : SUCCESS\ntestdate            : SUCCESS\ntestmemcache        : SUCCESS\ntestxml             : SUCCESS\ntestxlate           : SUCCESS\ntestrmm             : SUCCESS\ntestdbm             : SUCCESS\ntestqueue           : SUCCESS\ntestreslist         : SUCCESS\nAll tests passed.\nLoaded sqlite3 driver OK.\nOpened sqlite3[] OK\n======== create table ========\ncreate table test successful\n\n======== insert rows ========\ninsert rows test successful\n\n======== invalid op ========\ninvalid op returned 1 (should be nonzero).  Error msg follows\n'no such table: apr_dbd_test1'\nvalid op returned 0 (should be zero; error shouldn't affect subsequent ops)\ninvalid op test successful\n\n======== select random ========\nROW 5:\twibble\tnothing\t5\t\nROW 1:\tasdfgh\tbar\t1\t\nselect random test successful\n\n======== select sequential ========\nROW 1:\tasdfgh\tbar\t1\t\nROW 2:\tbar\tfoo\t(null)\t\nROW 3:\tfoo\t(null)\t(null)\t\nROW 4:\tqwerty\tfoo\t0\t\nROW 5:\twibble\tnothing\t5\t\nROW 6:\twibble\tother\t5\t\nselect sequential test successful\n\n======== transactions ========\nTransaction 1\n6 rows updated\nValid insert returned 1.  Should be nonzero (fail) because transaction is bad\nTransaction ended (should be rollback) - viewing table\nA column of \"failed\" indicates transaction failed (no rollback)\nROW 1:\tasdfgh\tbar\t1\t\nROW 2:\tbar\tfoo\t(null)\t\nROW 3:\tfoo\t(null)\t(null)\t\nROW 4:\tqwerty\tfoo\t0\t\nROW 5:\twibble\tnothing\t5\t\nROW 6:\twibble\tother\t5\t\nTransaction 2\n6 rows updated\nValid insert returned 0.  Should be zero (OK)\nTransaction ended (should be commit) - viewing table\nROW 1:\taaa\tzzz\t3\t\nROW 2:\tasdfgh\tsuccess\t1\t\nROW 3:\tbar\tsuccess\t(null)\t\nROW 4:\tfoo\tsuccess\t(null)\t\nROW 5:\tqwerty\tsuccess\t0\t\nROW 6:\twibble\tsuccess\t5\t\nROW 7:\twibble\tsuccess\t5\t\ntransactions test successful\n\n======== prepared select ========\nSelecting rows where col3 <= 3 and bar row where it's unset.\nShould show four rows.\nROW 1:\tqwerty\tsuccess\t0\t\nROW 2:\tasdfgh\tsuccess\t1\t\nROW 3:\tbar\tsuccess\t(null)\t\nROW 4:\taaa\tzzz\t3\t\nprepared select test successful\n\n======== prepared query ========\nShowing table (should now contain row \"prepared insert 2\")\nROW 1:\taaa\tzzz\t3\t\nROW 2:\tasdfgh\tsuccess\t1\t\nROW 3:\tbar\tsuccess\t(null)\t\nROW 4:\tfoo\tsuccess\t(null)\t\nROW 5:\tprepared\tinsert\t2\t\nROW 6:\tqwerty\tsuccess\t0\t\nROW 7:\twibble\tsuccess\t5\t\nROW 8:\twibble\tsuccess\t5\t\nprepared query test successful\n\n======== drop table ========\ndrop table test successful\n\nNo other external test were conducted. Berkeley DB version used is 5.1.19 as distributed freely from Oracle."}, {"count": 1, "text": "BDB5 support is already part of 1.3.10.", "creator": "rpluem@apache.org", "is_private": false, "id": 143294, "time": "2011-01-12T03:57:33Z", "bug_id": 50577, "creation_time": "2011-01-12T03:57:33Z", "tags": [], "attachment_id": null}]
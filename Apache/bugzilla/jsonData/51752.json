[{"count": 0, "tags": [], "creator": "shmulikk@gmail.com", "attachment_id": null, "is_private": false, "id": 148948, "time": "2011-09-01T12:06:04Z", "bug_id": 51752, "creation_time": "2011-09-01T12:06:04Z", "text": "HTTP Cache is working fine for HTTP Request Sampler and for all of the embedded resources.\nWhen enabling concurrent thread pool for \"Retrieve all embedded resources\" the requests are being sent without the relevant cache headers.\n\nProbably got to do with the cache info being saved on the requesting thread which probably exits after getting all embedded resources (this is occurring also with only one thread in the concurrent thread pool).\n\nThis happens with any HttpClient or JAVAImpl."}, {"count": 1, "tags": [], "bug_id": 51752, "attachment_id": null, "id": 149069, "creation_time": "2011-09-07T12:53:25Z", "time": "2011-09-07T12:53:25Z", "creator": "shmulikk@gmail.com", "text": "Caused by current implementation of CacheManager, which using ThreadLocal to separate Cache for each thread(virtual user).\n\nThis is causing to separate the Cache to each thread in the concurrent pool, thus breaking the cache.\n\nCurrently in CacheManager.java:\nprivate transient ThreadLocal<Map<String, CacheEntry>> threadCache;\n\n\nSuggested solution:\nRemoving ThreadLocal from the code.\nChanging the key to include the url (current key) + ThreadName.", "is_private": false}, {"count": 2, "text": "Good catch. Thanks for report.\nFixed with InheritableThreadLocal (concurrent threads pool are chlidren of main http request/virtual user)\n\nURL: http://svn.apache.org/viewvc?rev=1166165&view=rev\nLog:\nBug 51752 - HTTP Cache is broken when using \"Retrieve all embedded resources\" with concurrent pool\n\nModified:\n   jakarta/jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n   jakarta/jmeter/trunk/xdocs/changes.xml", "bug_id": 51752, "attachment_id": null, "id": 149071, "time": "2011-09-07T13:27:07Z", "creator": "milamber@apache.org", "creation_time": "2011-09-07T13:27:07Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 51752, "is_private": false, "text": "Not good. Don't works with several loops (works only on same loop for same embebbed resources)\n\nNeed some additionnal works", "id": 149072, "time": "2011-09-07T13:42:28Z", "creator": "milamber@apache.org", "creation_time": "2011-09-07T13:42:28Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 51752, "attachment_id": null, "id": 149073, "creation_time": "2011-09-07T13:45:16Z", "time": "2011-09-07T13:45:16Z", "creator": "milamber@apache.org", "text": "Oups !!!\nWorks with loops, I forget to unchecked \"Clear cache each iteration?\" on HTTP Cache manager on my test plan.\n\nSorry from SPAM.", "is_private": false}]
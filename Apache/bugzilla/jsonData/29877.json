[{"count": 0, "attachment_id": null, "creator": "ray@palamida.com", "text": "The length of some TAR files are not multiples of a fixed block size, and so\nthey seem to end abrubtly in the middle of a block.  These files are definitely\nin error, but do appear to be somewhat common.  So common, in fact, that the\norg.apache.tools.tar.TarBuffer code already attempts to handle these files, but\nthis attempt results in an infinite cycle when reading the last block on certain\nfiles, such as the TAR file found within this gzip:\n\n   http://prdownloads.sourceforge.net/amphetadesk/amphetadesk-src-v0.93.tar.gz\n\nThe last block is read repeatedly forever as the input buffer is left unclean\nand the data found earlier is mistakenly parsed as new TAR entries.  The\nfollowing patch fixes this case by zeroing out unread portions of the input\nbuffer when foreshortened input files are encountered:\n\n(the same patch can also be found:\nhttp://marc.theaimsgroup.com/?l=ant-dev&m=108734434215467&w=2)\n\n\n--- ..\\ant-1.6.1\\src\\main\\org\\apache\\tools\\tar\\TarBuffer.java\t2004-03-09\n08:48:00.000000000 -0800\n+++ src\\org\\apache\\tools\\tar\\TarBuffer.java\t2004-06-15 16:24:27.992961600 -0700\n@@ -25,6 +25,7 @@\n import java.io.InputStream;\n import java.io.OutputStream;\n import java.io.IOException;\n+import java.util.Arrays;\n \n /**\n  * The TarBuffer class implements the tar archive concept\n@@ -231,6 +232,19 @@\n             // Thanks to 'Yohann.Roussel@alcatel.fr' for this fix.\n             //\n             if (numBytes == -1) {\n+\n+                // However, just leaving the unread portion of the buffer dirty\ndoes \n+                // cause problems in some cases.  This problem can be seen when \n+                // processing the TAR file found within this GZIP:\n+                //\n+                //    \nhttp://prdownloads.sourceforge.net/amphetadesk/amphetadesk-src-v0.93.tar.gz\n+                //\n+                // The solution is to fill the unused portion of the buffer\nwith zeros.\n+                // \n+                //                     - ray@palamida.com\n+\n+                Arrays.fill(blockBuffer, offset, bytesNeeded, (byte) 0);\n+\n                 break;\n             }", "id": 60086, "time": "2004-07-01T18:22:39Z", "bug_id": 29877, "creation_time": "2004-07-01T18:22:39Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 29877, "text": "Committed the patch, (with a small fix to the\nparamters to Arrays.fill())\nThanks for the report and the test file.\nThis will be in the next release of ant.", "id": 69499, "time": "2005-01-10T18:13:44Z", "creator": "peterreilly@apache.org", "creation_time": "2005-01-10T18:13:44Z", "tags": [], "is_private": false}]
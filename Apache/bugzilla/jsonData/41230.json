[{"count": 0, "tags": [], "creator": "sridhar.basam@gmail.com", "attachment_id": null, "text": "I am running httpd 2.2.3 with mod_cache in reverse proxy mode. The content being\ncached has a max-age of 0 so the cache is allowed to store it but must always\nvalidate it with the origin. If one does an unconditional HEAD on a piece of\ncontent that has been cached on the edge, you get a \"HTTP 304 Not Modified\"\ninstead of a 200.\n\nHere is the headers from the origin in response to a first time request,\n\nHTTP/1.1 200 OK\nDate: Thu, 21 Dec 2006 21:05:11 GMT\nServer: Apache\nLast-Modified: Fri, 01 Dec 2006 22:35:51 GMT\nETag: \"4809a-4f-9f42dfc0\"\nAccept-Ranges: bytes\nContent-Length: 79\nCache-Control: max-age=0, no-transform\nExpires: Thu, 21 Dec 2006 21:06:39 GMT\nsvct: D=27819 usec\nContent-Type: text/html\nConnection: close\n\nBelow is the HEAD request followed by the reply.\n\nHEAD /testing/basam/test.html HTTP/1.1\nHost: edge.stream.aol.com\n\nHTTP/1.1 304 Not Modified\nDate: Thu, 21 Dec 2006 21:06:28 GMT\nServer: Apache\nConnection: close\nETag: \"4809a-4f-9f42dfc0\"\nExpires: Thu, 21 Dec 2006 21:07:56 GMT\nCache-Control: max-age=0\n\nBelow is the debug output from apache for the HEAD request.\n\n[Thu Dec 21 21:06:32 2006] [debug] mod_disk_cache.c(477): disk_cache: Recalled\ncached URL info header http://edge.stream.aol.com:80/testing/basam/test.html?\n[Thu Dec 21 21:06:32 2006] [debug] mod_disk_cache.c(750): disk_cache: Recalled\nheaders for URL http://edge.stream.aol.com:80/testing/basam/test.html?\n[Thu Dec 21 21:06:32 2006] [debug] cache_storage.c(272): Cached response for\n/testing/basam/test.html isn't fresh.  Adding/replacing conditional request headers.\n[Thu Dec 21 21:06:32 2006] [debug] mod_cache.c(129): Adding CACHE_SAVE filter\nfor /testing/basam/test.html\n[Thu Dec 21 21:06:32 2006] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL\nfilter for /testing/basam/test.html\n[Thu Dec 21 21:06:32 2006] [debug] mod_proxy_http.c(54): proxy: HTTP:\ncanonicalising URL //origin.stream.aol.com/testing/basam/test.html\n[Thu Dec 21 21:06:32 2006] [debug] proxy_util.c(1378): [client 127.0.0.1] proxy:\nhttp: found worker http://origin.stream.aol.com/ for\nhttp://origin.stream.aol.com/testing/basam/test.html [Thu Dec 21 21:06:32 2006]\n[debug] mod_proxy.c(756): Running scheme http handler (attempt 0)\n[Thu Dec 21 21:06:32 2006] [debug] mod_proxy_http.c(1662): proxy: HTTP: serving\nURL http://origin.stream.aol.com/testing/basam/test.html\n[Thu Dec 21 21:06:32 2006] [debug] proxy_util.c(1798): proxy: HTTP: has acquired\nconnection for (origin.stream.aol.com)\n[Thu Dec 21 21:06:32 2006] [debug] proxy_util.c(1858): proxy: connecting\nhttp://origin.stream.aol.com/testing/basam/test.html to origin.stream.aol.com:80\n[Thu Dec 21 21:06:32 2006] [debug] proxy_util.c(1951): proxy: connected\n/testing/basam/test.html to origin.stream.aol.com:80\n[Thu Dec 21 21:06:32 2006] [debug] proxy_util.c(2045): proxy: HTTP: fam 2 socket\ncreated to connect to origin.stream.aol.com\n[Thu Dec 21 21:06:32 2006] [debug] proxy_util.c(2141): proxy: HTTP: connection\ncomplete to 10.1.10.15:80 (origin.stream.aol.com)\n[Thu Dec 21 21:06:32 2006] [debug] mod_proxy_http.c(1541): proxy: header only\n[Thu Dec 21 21:06:32 2006] [debug] mod_cache.c(502): cache:\n/testing/basam/test.html not cached. Reason: HTTP HEAD request\n[Thu Dec 21 21:06:32 2006] [debug] proxy_util.c(1816): proxy: HTTP: has released\nconnection for (origin.stream.aol.com)", "id": 97169, "time": "2006-12-21T13:19:13Z", "bug_id": 41230, "creation_time": "2006-12-21T13:19:13Z", "is_private": false}, {"count": 1, "tags": [], "creator": "nikke@acc.umu.se", "attachment_id": 20090, "text": "Created attachment 20090\nFix 304 on HEAD on expired object\n\nThis patch fixes this for us (httpd-2.2.4 + patch for PR41475 + our\nmod_disk_cache patches). If running the standard mod_disk_cache then expired\nobjects won't be deleted from the cache when they can't be revalidated, but\nit will at least return the correct status code to the client.\n\nFor full discussion see the thread on dev@httpd:\nhttp://mail-archives.apache.org/mod_mbox/httpd-dev/200704.mbox/%3cPine.GSO.4.64.0704131659050.7482@kleopatra.acc.umu.se%3e", "id": 102748, "time": "2007-05-02T06:57:29Z", "bug_id": 41230, "creation_time": "2007-05-02T06:57:29Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 41230, "attachment_id": null, "id": 103234, "time": "2007-05-15T09:02:07Z", "creator": "sridhar.basam@gmail.com", "creation_time": "2007-05-15T09:02:07Z", "is_private": false, "text": "\nI have verified this patch works in our environment which is mod_cache for 2.2.4\n+ patch for PR41484.\n\nthanks,\n          Sridhar"}, {"count": 3, "tags": [], "creator": "nikke@acc.umu.se", "is_private": false, "id": 108778, "creation_time": "2007-09-28T13:40:12Z", "time": "2007-09-28T13:40:12Z", "bug_id": 41230, "text": "This bug is supposedly fixed in httpd 2.2.6, and should thus be closed.", "attachment_id": null}, {"count": 4, "tags": [], "text": "Looks like it.  You could even have marked it fixed yourself!", "attachment_id": null, "id": 108780, "creator": "nick@webthing.com", "time": "2007-09-28T14:35:11Z", "bug_id": 41230, "creation_time": "2007-09-28T14:35:11Z", "is_private": false}]
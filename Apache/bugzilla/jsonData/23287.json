[{"count": 0, "tags": [], "bug_id": 23287, "text": "mod_deflate is configured to decompress an inbound HTTP SOAP request (note: The Apache SOAP TCPTunnel/Monitor was used to capture the flows between the Apache proxy server and WebLogic):\n\nPOST /some/url HTTP/1.0\nHost: localhost:1080\nContent-Type: text/xml; charset=utf-8\nContent-Length: 4727\nSOAPAction: \"http://some.soap.action\"\nAccept-Encoding: gzip,deflate\nContent-Encoding: gzip\n<SNIP: Compressed SOAP message/>\n\nThe HTTP request body (the SOAP request) is compressed in the gzip format.\n\nmod_deflate does intercept and decompress the content.\n\nApache is also configured (using mod_proxy) to forward the request on to WebLogic. The request forwarded to WebLogic is as follows:\n\nPOST /some/url HTTP/1.1\nHost: localhost:7101\nContent-Type: text/xml; charset=utf-8\nContent-Length: 4727 <== Note!\nSOAPAction: \"http://some.soap.action\"\nAccept-Encoding: gzip,deflate\nContent-Encoding: gzip <== Note!\n<SNIP: Decompressed SOAP message />\n\nmod_deflate should mdoify (or remove) the Content-Encoding header to reflect the fact that the content is NOT compressed, and should re-write the Content-Length header to reflect the actual length of the decompressed content.", "id": 44374, "time": "2003-09-20T03:36:26Z", "creator": "john@objectivelogic.com", "creation_time": "2003-09-20T03:36:26Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 23287, "text": "Iit cannot change the content-length header, because the data is streamed. Hmm,\nI guess it's not really intended to decompress as a proxy.\nCan you try what happens, if you use mod_header's `RequestHeader unset'\ndirective to remove the headers in question?\n\nI think, mod_proxy should be changed, that if the content-length header is\nremoved, it switches to chunked encoding.... duh, that is only possible with\nHTTP/1.1. Seems there's no simple solution to that problem.\n\nI'm +1 anyway to remove the gzip token from Content-encoding.\n\nAny other ideas?", "id": 44405, "time": "2003-09-21T19:31:48Z", "creator": "nd@perlig.de", "creation_time": "2003-09-21T19:31:48Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 23287, "text": "Yes, I think that mod_deflate is rarely used for decompression of the REQUEST -- it's almost always used for compression of the RESPONSE. And, the combination of mod_deflate and proxying the request to a back-end server appears to be problematic.\n\nI tried using mod_headers and the RequestHeader unset command to remove the Content-Encoding: gzip and Content-Length: xxxx headers. The problem with this is that it causes mod_deflate to be be nop-op'ed because he doesn't recognize that the incoming request is compressed without the header.\n\nI considered writing a filter to post-process mod_deflate's output and remove the headers, but that won't work either, because the output is being streamed (as you point out), and the headers will already have been written.", "id": 44423, "time": "2003-09-22T04:09:39Z", "creator": "john@objectivelogic.com", "creation_time": "2003-09-22T04:09:39Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 23287, "text": "Hmmm, ...\n\nCan you not use (the mirror of) the workaround I used to recommend for\nmod_proxy_html before updating mod_deflate to support decompression of response\ndata from a proxy?\n\nHeader unset Accept-Encoding\n\nto tell the Client you don't want gzipped data?\n\nI might actually fix this properly, but no promises.", "id": 63093, "time": "2004-09-05T15:48:35Z", "creator": "nick@webthing.com", "creation_time": "2004-09-05T15:48:35Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 23287, "is_private": false, "text": "A related problem with servlet requests forwarded to Tomcat via mod_jk: request\ncontent gets decompressed, but I get an end of stream at (the original)\nContent-Length bytes from stream start, resulting in truncated decompressed\ncontent for the servlet.\n\nI do not insist on removing \"gzip\" from Content-Encoding or removing\nContent-Length. It's completely OK with me to just ignore Content-Length in my\nservlet and rely on the servlet request end of stream. Servlets have to be able\nto handle chunked requests anyway, so using Content-Length is not good style\nregardless of compression. It's also OK with me to ignore \"gzip\" in\nContent-Encoding, as long as I know that Apache handles it for me. But it's not\nOK to get truncated content, I obviously do need full decompressed content in\nthe servlet.", "id": 73824, "time": "2005-04-19T17:44:29Z", "creator": "mike_bos@mail.com", "creation_time": "2005-04-19T17:44:29Z", "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 23287, "text": "(In reply to comment #4)\n> A related problem with servlet requests forwarded to Tomcat via mod_jk: request\n\nI'm certain, this should be fixed in mod_jk. Could you open a bug report /\nfeature  request at mod_jk's tracker?", "id": 73825, "time": "2005-04-19T18:04:05Z", "creator": "nd@perlig.de", "creation_time": "2005-04-19T18:04:05Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "mike_bos@mail.com", "attachment_id": null, "is_private": false, "id": 73829, "time": "2005-04-19T19:53:19Z", "bug_id": 23287, "creation_time": "2005-04-19T19:53:19Z", "text": "Opened http://issues.apache.org/bugzilla/show_bug.cgi?id=34526"}, {"count": 7, "tags": [], "creator": "mike_bos@mail.com", "attachment_id": null, "is_private": false, "id": 78206, "time": "2005-08-08T01:46:02Z", "bug_id": 23287, "creation_time": "2005-08-08T01:46:02Z", "text": "William Barker from mod_jk marked 34526 \"resolved, wontfix\" and insists it's a\nmod_deflate problem. Would it be possible to have a direct discussion among the\ndevelopers responsible for this functionality in mod_deflate and mod_jk? It's\nimportant to get it fixed, wherever the fixes may happen to be..."}, {"count": 8, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "is_private": false, "id": 106022, "time": "2007-07-29T01:46:36Z", "bug_id": 23287, "creation_time": "2007-07-29T01:46:36Z", "text": "Fixed in /trunk/ and proposed for backport\nhttp://svn.apache.org/viewvc?view=rev&revision=560689\n\nThis kind of thing needs round tuits.  But it's still been an inexcusably long\ntime for a real bug."}, {"count": 9, "tags": [], "bug_id": 23287, "text": "Understand. Well, better late than never, eh? I'd long-since moved on to other projects and forgotten \nabout this. ;-) Thanks for taking care of it.", "id": 106065, "time": "2007-07-30T11:47:23Z", "creator": "john@objectivelogic.com", "creation_time": "2007-07-30T11:47:23Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 23287, "text": "http://svn.apache.org/viewvc?view=rev&rev=563464", "id": 106443, "time": "2007-08-07T05:22:05Z", "creator": "nick@webthing.com", "creation_time": "2007-08-07T05:22:05Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 23287, "text": "Any chance of a backport to Apache 2.2.x?", "id": 106445, "time": "2007-08-07T05:33:11Z", "creator": "jessh@ptc.com", "creation_time": "2007-08-07T05:33:11Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "is_private": false, "id": 106464, "time": "2007-08-07T12:30:18Z", "bug_id": 23287, "creation_time": "2007-08-07T12:30:18Z", "text": "(In reply to comment #11)\n> Any chance of a backport to Apache 2.2.x?\n\nIt is already backported to Apache 2.2.x. See Comment 10."}]
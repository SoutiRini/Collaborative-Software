[{"count": 0, "tags": [], "creator": "vincent.hardy@sun.com", "is_private": false, "text": "Hi,\n\nI have a couple of problems with the SVGFontUtilities class.\n\nIt holds a static reference to the \"current\" document.\nThis means that it will hold onto the last document to have text in it. I \nran into a problem where the document was holding onto a whole lot of \nother stuff through the DefaultSVGContext due to anonymous inner class \nusing variables in the outer class.\nThis appears to be a memory leak of sorts.\n\nThe other problem is that the code would appear to not be thread safe. In \na multi-threaded environment the \"current\" document will constantly be \nchanging and the variable 'fontFamilyMap' will be changed all the time. It \ncould also have more than one thread altering the hashmap which would \ncause an exception.\nThe method is only used in one place that I could find in \nSVGTextElementBridge.java.\n\nOne solution could be to store the 'fontFamilyMap' in the document. No \nstatic references and only a thread problem if two threads are handling \nthe same document which can be solved by making the hashmap synchronized.\n\nThanks for the good work so far.\n\nThanks,\nKeiron", "id": 10877, "time": "2002-02-19T09:50:46Z", "bug_id": 6536, "creation_time": "2002-02-19T09:50:46Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "vincent.hardy@sun.com", "text": "Hi,\n\nI have a couple of problems with the SVGFontUtilities class.\n\nIt holds a static reference to the \"current\" document.\nThis means that it will hold onto the last document to have text in it. I \nran into a problem where the document was holding onto a whole lot of \nother stuff through the DefaultSVGContext due to anonymous inner class \nusing variables in the outer class.\nThis appears to be a memory leak of sorts.\n\nThe other problem is that the code would appear to not be thread safe. In \na multi-threaded environment the \"current\" document will constantly be \nchanging and the variable 'fontFamilyMap' will be changed all the time. It \ncould also have more than one thread altering the hashmap which would \ncause an exception.\nThe method is only used in one place that I could find in \nSVGTextElementBridge.java.\n\nOne solution could be to store the 'fontFamilyMap' in the document. No \nstatic references and only a thread problem if two threads are handling \nthe same document which can be solved by making the hashmap synchronized.\n\nThanks for the good work so far.\n\nThanks,\nKeiron", "id": 10878, "time": "2002-02-19T10:02:09Z", "bug_id": 6536, "creation_time": "2002-02-19T10:02:09Z", "is_private": false, "attachment_id": null}]
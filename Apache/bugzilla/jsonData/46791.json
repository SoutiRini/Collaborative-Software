[{"count": 0, "tags": [], "bug_id": 46791, "text": "Created attachment 23321\nA patch that fixes the described bug.\n\nIf you call the Node#cloneNode(boolean) method to perform a deep clone of an element in an SVG 1.2 document, and that element has got a child element in a custom namespace, a NullPointerException is thrown:\n\nException in thread \"main\" java.lang.NullPointerException\n\tat org.apache.batik.dom.svg.SVGOMElement.createLiveAnimatedString(SVGOMElement.java:390)\n\tat org.apache.batik.dom.svg.SVGStylableElement.initializeLiveAttributes(SVGStylableElement.java:118)\n\tat org.apache.batik.dom.svg.SVGStylableElement.<init>(SVGStylableElement.java:103)\n\tat org.apache.batik.dom.svg.SVGGraphicsElement.<init>(SVGGraphicsElement.java:96)\n\tat org.apache.batik.dom.svg12.BindableElement.<init>(BindableElement.java:68)\n\tat org.apache.batik.dom.svg12.BindableElement.newNode(BindableElement.java:99)\n\tat org.apache.batik.dom.AbstractNode.cloneNode(AbstractNode.java:309)\n\tat org.apache.batik.dom.AbstractParentNode.deepCopyInto(AbstractParentNode.java:377)\n\tat org.apache.batik.dom.AbstractElement.deepCopyInto(AbstractElement.java:563)\n\tat org.apache.batik.dom.svg.SVGOMElement.deepCopyInto(SVGOMElement.java:891)\n\tat org.apache.batik.dom.AbstractNode.cloneNode(AbstractNode.java:309)\n\tat org.apache.batik.dom.AbstractParentNode.deepCopyInto(AbstractParentNode.java:377)\n\tat org.apache.batik.dom.AbstractElement.deepCopyInto(AbstractElement.java:563)\n\tat org.apache.batik.dom.svg.SVGOMElement.deepCopyInto(SVGOMElement.java:891)\n\tat org.apache.batik.dom.AbstractNode.cloneNode(AbstractNode.java:309)\n\tat org.apache.batik.dom.AbstractParentNode.deepCopyInto(AbstractParentNode.java:377)\n\tat org.apache.batik.dom.AbstractElement.deepCopyInto(AbstractElement.java:563)\n\tat org.apache.batik.dom.svg.SVGOMElement.deepCopyInto(SVGOMElement.java:891)\n\tat org.apache.batik.dom.AbstractNode.cloneNode(AbstractNode.java:309)\n\tat CloneNodeTest.main(CloneNodeTest.java:25)\n\nIn SVG 1.1 documents, this does not happen.\n\nThe problem is that the cloning behaviour of BindableElement is implemented incorrectly. The newNode() method calls the wrong constructor, so that some super constructor executes code relying on the owner document of the node aready being set.\n\nAttached is a patch for this bug. The cloning behaviour is now implemented just as the one of GenericElementNS, the class used for custom namespace elements in SVG 1.1. This means that in the newNode() method, we just call the parameterless constructor. To ensure that the fields of BindableElement are set, I added implementations for the copyInto, deepCopyInto, export, and deepExport methods.", "id": 125266, "time": "2009-03-02T23:54:32Z", "creator": "daniel.westheide@gmx.de", "creation_time": "2009-03-02T23:54:32Z", "is_private": false, "attachment_id": 23321}, {"count": 1, "tags": [], "bug_id": 46791, "attachment_id": null, "text": "Hi Daniel,\n\nNice to see your contribution. ;-)\n\nWithout much knowledge on Batik's internals, I'm only reviewing the patch in terms of coding principles (at least for now).\n\n\n>  import org.apache.batik.dom.svg.SVGGraphicsElement;\n> -\n>  import org.w3c.dom.Node;\n\nThis apparently redundant line separating (java from batik from w3c) includes is expected. See, for example, \"sources/org/apache/batik/bridge/BaseScriptingEnvironment.java\".\n\n\n>      protected Node newNode() {\n> -        return new BindableElement(null, null, namespaceURI, localName);\n> +    \treturn new BindableElement();\n\nIndenting issue, please use 4 spaces for consistency.\n\n\n> -    /**\n> +\t/**\n\nIndenting issue, please use 4 spaces instead of tab character.\n\n\nBy the way, patches can be acknowledged by adding the \"PatchAvailable\" keyword to the report (which I've done). Adding the word to the report's title is also commonly seen, and I believe using both won't hurt (although I can be wrong). ;-)\n\n\nFinally, I'm not sure if the patch should include a modification to the \"CHANGES\" file or if this is to be addressed by whoever commits it (although I'd assume the latter).\n\n\nRegards,\n Helder Magalh\u00e3es", "id": 125269, "time": "2009-03-03T01:37:12Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-03T01:37:12Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 46791, "text": "Created attachment 23322\nTest case (SVG 1.2) - this raises the exception\n\nReduced test case which reproduces the issue. By removing the version property (version=\"1.2\") the document is set into SVG 1.1 mode and the exception is avoided.", "id": 125270, "time": "2009-03-03T01:58:15Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-03T01:58:15Z", "is_private": false, "attachment_id": 23322}, {"count": 3, "attachment_id": 23323, "bug_id": 46791, "is_private": false, "id": 125271, "time": "2009-03-03T02:00:07Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-03T02:00:07Z", "tags": [], "text": "Created attachment 23323\nTest case (SVG 1.1) - this does *not* raise the exception (only for comparison purposes)"}, {"count": 4, "tags": [], "text": "Hi Helder,\n\nthanks for your help and for providing the two test cases. As for your review of the patch, I was not aware of that and trusted my IDE all too much. :-) In the future, I will take care of that.\n\nShould I update this patch based on your review or is that okay for now?", "attachment_id": null, "bug_id": 46791, "id": 125273, "time": "2009-03-03T02:43:55Z", "creator": "daniel.westheide@gmx.de", "creation_time": "2009-03-03T02:43:55Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 46791, "attachment_id": null, "text": "I have a question on the patch.\n\nThe main effect of the patch is to bypass the\nbaseclass call to 'initializeAllLiveAttributes'\nthe question I have is when does that get called?\nIf it isn't ever called then Animated attributes won't work.\n\nOn that point, Cameron - should the initialization of \nthe live attributes be tied to the booting of the SVG\nand CSS DOM?", "id": 125274, "time": "2009-03-03T02:58:50Z", "creator": "deweese@apache.org", "creation_time": "2009-03-03T02:58:50Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 46791, "text": "Hi Thomas,\n\nthe initializeAllLiveAttributes method is still called by the deepCopyInto method of SVGOMElement. When the newNode() method of BindableElement used the parameterized constructor, the initializeAllLiveAttributes method would actually have been called twice, if that first call had not caused the NPE due to the owner document not being set yet.", "id": 125275, "time": "2009-03-03T03:10:46Z", "creator": "daniel.westheide@gmx.de", "creation_time": "2009-03-03T03:10:46Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 46791, "text": "(In reply to comment #5)\n> On that point, Cameron - should the initialization of \n> the live attributes be tied to the booting of the SVG\n> and CSS DOM?\n\nThat would be better, since you could then avoid constructing the various SVGLength, etc. objects which wouldn't be useful without the SVG DOM being initialised anyway.\n\nBefore animation was implemented, these objects were lazily created.  So it'd be good to go back to something like that.\n\n(In reply to comment #6)\n> the initializeAllLiveAttributes method is still called by the deepCopyInto\n> method of SVGOMElement. When the newNode() method of BindableElement used the\n> parameterized constructor, the initializeAllLiveAttributes method would\n> actually have been called twice, if that first call had not caused the NPE due\n> to the owner document not being set yet.\n\nI only took a very quick look, and I think Daniel is correct.  The pattern of overloading those four methods to ensure some extra data is copied across to the cloned node is also used in SVGOMElement.", "id": 125304, "time": "2009-03-03T16:08:21Z", "creator": "cam@apache.org", "creation_time": "2009-03-03T16:08:21Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "(In reply to comment #4)\n> Should I update this patch based on your review or is that okay for now?\n\nYes, I believe updating the patch would be good. :-)\n\n\n(In reply to comment #7)\n> So it'd be good to go back to something like that.\n\nThis sounds like a good general improvement. Nevertheless, I'd vote for fixing this specific issue and creating a different issue for dealing with the improvement, as I suspect it may become somehow lengthy, in both time and code changes... :-|  Naturally, this comes from the assumption that the trunk should be as stable as possible for daily use, I may be wrong in assuming that. ;-)\n\n\nUpdating the platform to \"All\" as this was reproduced in Windows also (and, given that it is Batik-related, it should be reproducible in all supported platforms).", "attachment_id": null, "bug_id": 46791, "id": 125309, "time": "2009-03-04T01:55:59Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-04T01:55:59Z", "is_private": false}, {"count": 9, "tags": [], "text": "Created attachment 23327\nPatch for the bug with correct code formatting.\n\nI added a new version of the patch (attachment 23321). The only difference is in the code formatting, which was not quite correct in the original version.", "attachment_id": 23327, "id": 125310, "creator": "daniel.westheide@gmx.de", "time": "2009-03-04T04:46:41Z", "bug_id": 46791, "creation_time": "2009-03-04T04:46:41Z", "is_private": false}, {"count": 10, "tags": [], "creator": "cam@apache.org", "text": "I want to look at committing this patch.  Thomas, do you think it is large enough need a CLA to be submitted?", "id": 125622, "time": "2009-03-18T23:24:19Z", "bug_id": 46791, "creation_time": "2009-03-18T23:24:19Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 46791, "text": "(In reply to comment #10)\n> I want to look at committing this patch.  Thomas, do you think it is large\n> enough need a CLA to be submitted?\n\n  It's certainly on the borderline.  If it weren't for the fact that\nthe change is almost identical to the GenericElementNS code I'd probably\nsay yes.  Given the uncertainty I think it's best if we get a CLA.\n\n  Daniel can you file a Contributors License Agreement?\n     http://www.apache.org/licenses/", "id": 125694, "time": "2009-03-23T05:07:49Z", "creator": "deweese@apache.org", "creation_time": "2009-03-23T05:07:49Z", "is_private": false, "attachment_id": null}, {"count": 12, "attachment_id": null, "bug_id": 46791, "is_private": false, "id": 125794, "time": "2009-03-25T23:36:30Z", "creator": "daniel.westheide@gmx.de", "creation_time": "2009-03-25T23:36:30Z", "tags": [], "text": "(In reply to comment #11)\n >   Daniel can you file a Contributors License Agreement?\n>      http://www.apache.org/licenses/\n\nSince I created this particular patch as part of my job, I need to clear this up with my employer. I'm afraid this might take a couple of days. Of course, if you consider this patch trivial enough that it's viable to forego a CLA, then please do it. Sorry for the delay. I was not aware that a CLA might be necessary for contributing this patch."}, {"count": 13, "tags": [], "bug_id": 46791, "text": "(In reply to comment #12)\n> Since I created this particular patch as part of my job, I need to clear this\n> up with my employer. I'm afraid this might take a couple of days.\n\nA little more than a couple of days have passed: in fact, quite more than a couple of months! :-D\n\nDaniel, please don't leave this unattended in your TODO stack forever: I already saw a couple of good patches rotting in the bug tracker due to lack of a CLA. :-|\n\nBefore reading the full Apache v2 license agreement, you may be interested in taking a quick look at a human-readable summary [1]. ;-)\n\n\n[1] http://www.codeproject.com/info/Licenses.aspx#ctl00_MC_LR_ctl08_N", "id": 131442, "time": "2009-10-27T16:50:08Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-10-27T16:50:08Z", "is_private": false, "attachment_id": null}, {"count": 14, "attachment_id": null, "creator": "daniel.westheide@gmx.de", "is_private": false, "id": 131768, "time": "2009-11-06T07:33:09Z", "bug_id": 46791, "creation_time": "2009-11-06T07:33:09Z", "tags": [], "text": "(In reply to comment #13)\n > Daniel, please don't leave this unattended in your TODO stack forever: I\n> already saw a couple of good patches rotting in the bug tracker due to lack of\n> a CLA. :-|\n\nHelder, I am very sorry that this process takes such a long time, much longer than I myself had expected. In fact, I attended to this issue back in March already, but I had problems communicating this to those in charge of deciding about it.\n\nHowever, I pushed this topic once more now and was told that I can expect feedback within a couple of weeks.\n\nI hope you understand that I cannot sign the CLA until I have clearance from my employer."}, {"count": 15, "tags": [], "text": "(In reply to comment #14)\n> Helder, I am very sorry that this process takes such a long time, much longer\n> than I myself had expected. In fact, I attended to this issue back in March\n> already, but I had problems communicating this to those in charge of deciding\n> about it.\n\nNo problem, I have similar things happening on my side. Whenever it's required management intervention, things can take a while (and/or even get a bit complicated)... :-|\n\n\n> However, I pushed this topic once more now and was told that I can expect\n> feedback within a couple of weeks.\n\nGreat, thanks. :-)\n\n\n> I hope you understand that I cannot sign the CLA until I have clearance from my\n> employer.\n\nYes, of course that's reasonable: I was just trying to avoid (given the lack of an update) that this would be hanging forever. ;-)", "is_private": false, "id": 131784, "creator": "helder.magalhaes@gmail.com", "time": "2009-11-07T02:09:46Z", "bug_id": 46791, "creation_time": "2009-11-07T02:09:46Z", "attachment_id": null}, {"count": 16, "tags": [], "creator": "helder.magalhaes@gmail.com", "attachment_id": null, "id": 139342, "time": "2010-08-22T11:50:14Z", "bug_id": 46791, "creation_time": "2010-08-22T11:50:14Z", "is_private": false, "text": "(In reply to comment #15)\n> > I hope you understand that I cannot sign the CLA until I have clearance from my\n> > employer.\n> \n> Yes, of course that's reasonable: I was just trying to avoid (given the lack of\n> an update) that this would be hanging forever. ;-)\n\n@Daniel:\nPing! Again trying to push this up in the stack, possibly taking advantage of employers returning from vacation with extra-energy to deal with these sort of things. ;-)"}, {"count": 17, "tags": [], "bug_id": 46791, "text": "Setting this issue to block the 1.8 release (bug 50045). It's a relevant bug, there's a fix already available (and almost ready for integration) and SVG 1.2 documents are probably starting to rise as SVG 1.1 is getting solidly deployed everywhere.", "id": 140507, "time": "2010-10-06T05:37:28Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-06T05:37:28Z", "is_private": false, "attachment_id": null}]
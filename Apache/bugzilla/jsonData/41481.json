[{"count": 0, "tags": [], "creator": "brodseba@iname.com", "attachment_id": null, "text": "In both JSTL 1.1 and 1.0 specifications nothing is mentioned about nested\nx:forEach loops where the inner x:forEach iterates over the parsed results of a\n*different* xml file.\n\nBut between JSTL 1.0 and JSTL 1.1, this very behavior change.\n\nFor example :\n\n------------------------------------------------------------------------------------------------------\ncollections.xml\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<collections>\n  <collection>\n    <id>horror</id>\n    <name>Horror novel</name>\n  </collection>\n  <collection>\n    <id>scifi</id>\n    <name>Sci-Fi novel</name>\n  </collection>\n</collections>\n\n------------------------------------------------------------------------------------------------------\nbooks.xml\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<books>\n  <book>\n    <collection_id>scifi</collection_id>\n    <title>Robots</title>\n  </book>\n  <book>\n    <collection_id>scifi</collection_id>\n    <title>The Moon is a Hashes Mistress</title>\n  </book>\n  <book>\n    <collection_id>scifi</collection_id>\n    <title>Spaceship Tropper</title>\n  </book>\n  <book>\n    <collection_id>horror</collection_id>\n    <title>This</title>\n  </book>\n</books>\n\n------------------------------------------------------------------------------------------------------\nbooks.jsp\n\n<%@ taglib prefix=\"c\" uri=\"/WEB-INF/c.tld\" %>\n<%@ taglib prefix=\"x\" uri=\"/WEB-INF/x.tld\" %>\n\n<c:import var=\"xml_collections\" url=\"http://localhost/collections.xml\" />\n<x:parse xml=\"${xml_collections}\" var=\"collections\" scope=\"request\"/>\n\n<c:import var=\"xml_books\" url=\"http://www.localhost/books.xml\" />\n<x:parse xml=\"${xml_books}\" var=\"books\" scope=\"request\"/>\n\n<x:forEach select=\"$collections/collections/collection\" var=\"collection\">\n  <x:out select=\"$collection/name\" />\n  <ul>\n    <x:forEach select=\"$books/books/book[collection_id=$collection/id]\" var=\"book\">\n      <li><x:out select=\"$book/title\" /></li>\n    </x:forEach>\n  </ul>\n</x:forEach>\n\n------------------------------------------------------------------------------------------------------\nOutput (WebSphere 5 using JSTL 1.0)\n\n  Horror novel\n  <ul>\n      <li>This</li>\n  </ul>\n\n  Sci-Fi novel\n  <ul>\n      <li>Robots</li>\n      <li>The Moon is a Hashes Mistress</li>\n      <li>Spaceship Tropper</li>\n  </ul>\n\n------------------------------------------------------------------------------------------------------\n\nOutput (WebSphere 6 using JSTL 1.1)\n\n  Horror novel\n  <ul>\n  </ul>\n  Sci-Fi novel\n  <ul>\n  </ul>", "id": 98620, "time": "2007-01-27T23:48:53Z", "bug_id": 41481, "creation_time": "2007-01-27T23:48:53Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "bayard@apache.org", "text": "This looks a lot like #30068, which is now resolved with a fix committed to SVN\ntrunk. Assuming you don't feel like building from trunk, I'll upload a build\ntomorrow so you can see if that fixes this too. ", "id": 98663, "time": "2007-01-28T19:29:37Z", "bug_id": 41481, "creation_time": "2007-01-28T19:29:37Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "brodseba@iname.com", "attachment_id": null, "text": "(In reply to comment #1)\n> This looks a lot like #30068, which is now resolved with a fix committed to SVN\n> trunk. Assuming you don't feel like building from trunk, I'll upload a build\n> tomorrow so you can see if that fixes this too. \n\nI never use SVN and I'm not sure I got access to it. So, I try to unzip the\nstandard.jar file.  I then use cavaj to modify the XPathUtil.class and then zip\nback the file, restart the application (not the server) and it still buggy.\n\nCan I use the latest nightly binary development distribution or can you send me\na fixed standard.jar?\n\nThank you very much!\n\n*** This bug has been marked as a duplicate of 30068 ***", "id": 98685, "time": "2007-01-29T08:29:18Z", "bug_id": 41481, "creation_time": "2007-01-29T08:29:18Z", "is_private": false}, {"count": 3, "tags": [], "creator": "brodseba@iname.com", "attachment_id": null, "text": "I try to install the latest nightly build (January 29th 2007), and it's still buggy.", "id": 98687, "time": "2007-01-29T08:33:45Z", "bug_id": 41481, "creation_time": "2007-01-29T08:33:45Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 41481, "attachment_id": null, "id": 98697, "time": "2007-01-29T11:13:57Z", "creator": "bayard@apache.org", "creation_time": "2007-01-29T11:13:57Z", "is_private": false, "text": "Assuming you got the nightly build from\nhttp://people.apache.org/builds/jakarta-taglibs/nightly/projects/, it looks like\nthat's been broken since 29-Aug-2006. "}, {"count": 5, "tags": [], "bug_id": 41481, "text": "(In reply to comment #4)\n> Assuming you got the nightly build from\n> http://people.apache.org/builds/jakarta-taglibs/nightly/projects/, it looks like\n> that's been broken since 29-Aug-2006. \n\nWhere can I find a fixed version of standard.jar?", "id": 98698, "time": "2007-01-29T11:37:21Z", "creator": "brodseba@iname.com", "creation_time": "2007-01-29T11:37:21Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 41481, "attachment_id": null, "id": 98699, "time": "2007-01-29T11:37:37Z", "creator": "bayard@apache.org", "creation_time": "2007-01-29T11:37:37Z", "is_private": false, "text": "Give the following pair of jars a shot:\n\nhttp://people.apache.org/~bayard/standard-1.1/\n\nThis looks so like 30068 and that one seems to be fixed now (it's got a unit\ntest so it must be fixed right? :) )."}, {"count": 7, "tags": [], "creator": "brodseba@iname.com", "is_private": false, "id": 98706, "creation_time": "2007-01-29T13:06:09Z", "time": "2007-01-29T13:06:09Z", "bug_id": 41481, "text": "(In reply to comment #6)\n> Give the following pair of jars a shot:\n> \n> http://people.apache.org/~bayard/standard-1.1/\n> \n> This looks so like 30068 and that one seems to be fixed now (it's got a unit\n> test so it must be fixed right? :) ).\n\nI did manage to compile the taglibs source. But I got the same behavior.\n\nI also try your snapshot and it was not working either.\n\nI try a test with a fresh install of the latest Tomcat using your snapshot file,\nand I got: javax.servlet.ServletException: org/apache/xpath/XPathException\n\nDo you want me to 'Reassign bug to owner of selected component '?", "attachment_id": null}, {"count": 8, "tags": [], "creator": "brodseba@iname.com", "attachment_id": null, "text": "In WebSphere 6, I add a <c:catch> before the <x:forEach> and I got:\n\njavax.servlet.jsp.JspTagException: Illegal argument evaluating XPath expression\n\"/collections/collection\": java.lang.IllegalArgumentException: Node must be\nnon-null for getDTMHandleFromNode\n", "id": 98707, "time": "2007-01-29T13:12:26Z", "bug_id": 41481, "creation_time": "2007-01-29T13:12:26Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 41481, "attachment_id": null, "id": 98711, "time": "2007-01-29T14:23:01Z", "creator": "bayard@apache.org", "creation_time": "2007-01-29T14:23:01Z", "is_private": false, "text": "When I run your example under Tomcat 5.5/JDK 1.5 and the latest source I get:\n\n  Horror novel\n  <ul>    \n      <li>This</li>    \n  </ul>\n  Sci-Fi novel\n  <ul>    \n      <li>Robots</li>    \n      <li>The Moon is a Hashes Mistress</li>    \n      <li>Spaceship Tropper</li>    \n  </ul>\n\nI had to change the namespace declarations to:\n\n<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n<%@ taglib prefix=\"x\" uri=\"http://java.sun.com/jsp/jstl/xml\" %>\n\nas that's how I have things setup. So looks like it's environment based.\n\nWhich JVM version are you on? Is Websphere 6 still 1.3 based? Or is that a 1.4\nbased one?\n\nThe getDTMHandlerFromNode method is in the XPathContext class from Xalan. I'm\nusing Xalan 2.7.0 for my testing. Any idea what version you or Websphere are using? "}, {"count": 10, "tags": [], "bug_id": 41481, "text": "Local\n  Tomcat: 5.5.20\n  Java: 1.5.0_08\n  Xalan: ?\n  \nServer\n  WebSphere: 6.0.2.7\n  Java: 1.4.2\n  Xalan: 2.6.9\n\nBoth return the error.\n", "id": 98716, "time": "2007-01-29T14:43:14Z", "creator": "brodseba@iname.com", "creation_time": "2007-01-29T14:43:14Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 41481, "attachment_id": null, "id": 98719, "time": "2007-01-29T16:04:52Z", "creator": "bayard@apache.org", "creation_time": "2007-01-29T16:04:52Z", "is_private": false, "text": "I put the c.tld and x.tld in WEB-INF/ and put the tag directives back to how\nthey are in your example and it still works.\n\nI think we should ignore Websphere for the moment and just consider your local\nenvironment which appears much the same as mine (Tomcat 5.5.20, JDK 1.5.0_09 &\nLinux 2.6.9 kernel). \n\nAll I have thought wise is to try to nail down the versions of Xalan in use so\nwe can try to replicate on the same versions.\n\nThe Taglibs code goes against the Xalan package, and I'm pretty sure the JVM\ndoesn't offer that package in 1.5.x (they change the package names afaik). As\nfar as I can tell, there hasn't been a 2.6.9 of Xalan, just a 2.6.0 and then a\n2.7.0. Might be that the .9 is IBM specific though.\n\nOnce we get passed that, it would seem that we have exactly the same setup and\none is working and one is not. Ugh :)"}, {"count": 12, "tags": [], "creator": "brodseba@iname.com", "is_private": false, "id": 98729, "creation_time": "2007-01-29T18:53:23Z", "time": "2007-01-29T18:53:23Z", "bug_id": 41481, "text": "First thing tomorrow I will run: java org.apache.xalan.xslt.EnvironmentCheck to\nget the version of Xalan use by both environment.\n\nOnce again thank you, you have no idea how this is helping me.", "attachment_id": null}, {"count": 13, "tags": [], "creator": "brodseba@iname.com", "attachment_id": null, "text": "Ok, I think I found my problem, at least on the local side version (Tomcat 5). \nI forget to copy the: xalan.jar, xercesImpl.jar, xml-apis.jar and xsltc.jar\nfiles into the /WEB-INF/lib directory.\n\nNow, if a do a test with the Xalan 2.7.0 AND your snapshot version of the\njstl.jar and standard.jar file, I got the right answer. :-)\n\nI will test first thing tomorrow the solution on my developer server (WebSphere 6).\n\n- I will upgrade to Xalan 2.7.0 (copying all files needed in /WEB-INF/lib this\ntime :-)\n- I will use your snapshot version of jstl.jar and standard.jar\n- and... hope for the best.\n\nI will give you feedback as soon as possible.", "id": 98736, "time": "2007-01-29T21:03:20Z", "bug_id": 41481, "creation_time": "2007-01-29T21:03:20Z", "is_private": false}, {"count": 14, "tags": [], "creator": "brodseba@iname.com", "attachment_id": null, "text": "The solution didn't work on WebSphere 6.\n\nI check for rogue copy xalan.jar file on the system, but I din't find any in the\nJAVA_HOME use by WebSphere.\n\nWebSphere use Java 1.4.2 and not 1.5.x.  Can this be the reason why it is not\nworking?\n\nI will try to install the JDK 1.4 Compatability Package (on my local Tomcat) to\nsee if this can be the problem.", "id": 98753, "time": "2007-01-30T06:44:16Z", "bug_id": 41481, "creation_time": "2007-01-30T06:44:16Z", "is_private": false}, {"count": 15, "attachment_id": null, "creator": "kschneider@gmail.com", "is_private": false, "id": 98754, "time": "2007-01-30T07:16:21Z", "bug_id": 41481, "creation_time": "2007-01-30T07:16:21Z", "tags": [], "text": "Haven't followed this closely yet, but make sure you *really* know where your\napp server is loading JAXP/Xerces/Xalan stuff from:\n\njaxp.jsp:\n---------\n\n<%@ page contentType=\"text/plain; charset=UTF-8\" %>\n<%@ page import=\"java.net.*, javax.xml.parsers.*, javax.xml.transform.*\" %>\n\n<%!\npublic URL getClassAsResource(Class clazz) {\n    String className = clazz.getName();\n    String classNameAsPath = className.replace('.', '/');\n    String classResourceName = \"/\" + classNameAsPath + \".class\";\n    return clazz.getResource(classResourceName);\n}\n%>\n\n<%\nSAXParserFactory parsers = SAXParserFactory.newInstance();\nSAXParser parser = parsers.newSAXParser();\n\nTransformerFactory transformers = TransformerFactory.newInstance();\nTransformer transformer = transformers.newTransformer();\n%>\n\nSAXParser location: <%= getClassAsResource(parser.getClass()) %>\n\nTransformer location: <%= getClassAsResource(transformer.getClass()) %>\n"}, {"count": 16, "tags": [], "bug_id": 41481, "attachment_id": null, "id": 98755, "creation_time": "2007-01-30T07:34:40Z", "time": "2007-01-30T07:34:40Z", "creator": "kschneider@gmail.com", "text": "You can also use this (or combine with previous example) to get the versions\n(and some other useful info) for Xerces & Xalan:\n\napachexml.jsp:\n--------------\n\n<%@ page contentType=\"text/plain; charset=UTF-8\" %>\n\nXerces version: <%= org.apache.xerces.impl.Version.getVersion() %>\n\nXalan version: <%= org.apache.xalan.Version.getVersion() %>\n\nXalan env check:\n<%= new org.apache.xalan.xslt.EnvironmentCheck().checkEnvironment(new\njava.io.PrintWriter(out)) %>\n", "is_private": false}, {"count": 17, "tags": [], "bug_id": 41481, "text": "(In reply to comment #16)\n> You can also use this (or combine with previous example) to get the versions\n> (and some other useful info) for Xerces & Xalan:\n> \n> apachexml.jsp:\n> --------------\n> \n> <%@ page contentType=\"text/plain; charset=UTF-8\" %>\n> \n> Xerces version: <%= org.apache.xerces.impl.Version.getVersion() %>\n> \n> Xalan version: <%= org.apache.xalan.Version.getVersion() %>\n> \n> Xalan env check:\n> <%= new org.apache.xalan.xslt.EnvironmentCheck().checkEnvironment(new\n> java.io.PrintWriter(out)) %>\n> \n\nRunning your first example, I got:\n\nSAXParser location: null\nTransformer location: null\n\n\nIn the second one, I got:\n\nXerces version: XML4J 4.3.7\n\nXalan version: XSLT4J Java 2.6.9\n\nXalan env check:\n#---- BEGIN writeEnvironmentReport(Revision: 1.31.1.3): Useful stuff found: ----\njava.version=1.4.2\nversion.xalan2x=XSLT4J Java 2.6.9\nversion.JAXP=1.1 or higher\nversion.SAX=2.0\nversion.crimson=not-present\njava.class.path=WARNING: SecurityException thrown accessing system classpath\nproperties\nversion.ant=not-present\nversion.b2bxml=1.2.1\nsun.boot.class.path=\n/usr/local/was/v6/java/jre/lib/ext/ibmorb.jar:\n/usr/local/was/v6/java/jre/lib/ext/ibmext.jar:\n/usr/local/was/v6/java/jre/lib/core.jar:\n/usr/local/was/v6/java/jre/lib/graphics.jar:\n/usr/local/was/v6/java/jre/lib/security.jar:\n/usr/local/was/v6/java/jre/lib/server.jar:\n/usr/local/was/v6/java/jre/lib/xml.jar:\n/usr/local/was/v6/java/jre/lib/charsets.jar:\n/usr/local/was/v6/java/jre/classes:\n/usr/local/was/v6/java/jre/lib/ibmcertpathprovider.jar:\n/usr/local/was/v6/java/jre/lib/ibmjaaslm.jar:\n/usr/local/was/v6/java/jre/lib/ibmjcefw.jar:\n/usr/local/was/v6/java/jre/lib/ibmjgssprovider.jar:\n/usr/local/was/v6/java/jre/lib/ibmjssefips.jar:\n/usr/local/was/v6/java/jre/lib/ibmjsseprovider.jar:\n/usr/local/was/v6/java/jre/lib/ibmorb.jar:\n/usr/local/was/v6/java/jre/lib/ibmorbapi.jar:\n/usr/local/was/v6/java/jre/lib/ibmpkcs.jar\nversion.DOM.draftlevel=2.0fd\nversion.DOM=2.0\nversion.xalan1=not-present\nversion.xalan2_2=XSLT4J Java 2.6.9\nversion.xerces2=XML4J 4.3.7\nversion.xerces1=not-present\n#----- END writeEnvironmentReport: Useful properties found: -----\n# YAHOO! Your environment seems to be OK.\ntrue\n\nIt seem, WebSphere 6 use Xalan 2.6.9 (a version not suppose to exist when I\ncheck on Xalan website). How can I fix this?  Do you know if WebSphere supported\n  the Endorsed Standards Override Mechanism?", "id": 98757, "time": "2007-01-30T08:08:16Z", "creator": "brodseba@iname.com", "creation_time": "2007-01-30T08:08:16Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "creator": "bayard@apache.org", "attachment_id": null, "text": "Xalan gets embedded in the JVM. Prior to some point it got embedded with the \nexisting apache package names - so it's possible that 2.6.9 is a Sun Xalan \nnumber and it's coming from the JVM.\n\nI'll try running the version number test against a 1.4.2 JVM in a couple of \nhours unless someone else gets it done (work intervenes til then).", "id": 98763, "time": "2007-01-30T09:31:18Z", "bug_id": 41481, "creation_time": "2007-01-30T09:31:18Z", "is_private": false}, {"count": 19, "tags": [], "creator": "bayard@apache.org", "attachment_id": null, "text": "Sun's 1.4.2_13 JDK on Linux has a Xalan 2.4.1.\nApple's 1.4 JDK has 2.4.1 too (probably copied from Sun).\n\nSo chances are, the xslt4j and xml4j are coming from the IBM JDK version. I'm \nguessing that XSLT4J and XML4J are the internal IBM names for forks of Xalan \nand Xerces - they're much involved in said libraries.", "id": 98775, "time": "2007-01-30T12:02:46Z", "bug_id": 41481, "creation_time": "2007-01-30T12:02:46Z", "is_private": false}, {"count": 20, "tags": [], "bug_id": 41481, "text": "I try to install Tomcat using the JDK 1.4 compatibility package and then try to\nuse JDK 1.4 to test is this is a problem with JDK version instead of Xalan\nincompatibility.\n\nThe JSP wouldn't compile.\n\nOne on your dig the doc from WebSphere and confirm that IBM JVM is working with\nXalan 2.6.9.  But what is troubling me is that IBM mention that this is the only\nversion of Xalan support by the IBM JVM.  We gonna open a ticket with IBM about\nthat.  I will keep you inform. ", "id": 98803, "time": "2007-01-30T15:39:21Z", "creator": "brodseba@iname.com", "creation_time": "2007-01-30T15:39:21Z", "is_private": false, "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 41481, "text": "(In reply to comment #20)\n> I try to install Tomcat using the JDK 1.4 compatibility package and then try to\n> use JDK 1.4 to test is this is a problem with JDK version instead of Xalan\n> incompatibility.\n> \n> The JSP wouldn't compile.\n> \n> One on your dig the doc from WebSphere and confirm that IBM JVM is working with\n> Xalan 2.6.9.  But what is troubling me is that IBM mention that this is the only\n> version of Xalan support by the IBM JVM.  We gonna open a ticket with IBM about\n> that.  I will keep you inform. \n\nIs there any update to this issue?  Any response from IBM?", "id": 112585, "time": "2008-01-07T08:22:18Z", "creator": "paul.wallace@prudential.com", "creation_time": "2008-01-07T08:22:18Z", "is_private": false, "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 41481, "text": "Inactive issue. Resolving as Worksforme as the issue was in the reporter's environment.", "id": 132452, "time": "2009-11-29T19:52:06Z", "creator": "bayard@apache.org", "creation_time": "2009-11-29T19:52:06Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Created attachment 31102\nZIP containing an XML Schema with optional element, an XML file that validates against this schema and an Excel file with XML Maps using 'mapping.xsd'\n\nPlease see the contents of the zip file attached to this bug...\n\nThe XML Schema file 'mapping.xsd' contains an optional element:\n <xs:element name=\"OptionalRating\" type=\"xs:decimal\" minOccurs=\"0\"/>\n\nThe XML file 'data.xml' validates successfully against 'mapping.xsd'. It does not contain the element 'OptionalRating'.\n\nImporting 'data.xml' into an Excel file with XML maps using 'mapping.xsd' with XSSFImportFromXML.importFromXML(xmlInputString) fails with a NullPointerException because the code assumes that all elements declared in the XML Schema file must also be present in the XML data file (which is not necessarily the case if elements are declared optional.\n\nThe exception occurs on the following code line in method \"XSSFImportFromXML.importFromXML(xmlInputString)\":\n Node result = (Node) xpath.evaluate(xpathString, doc, XPathConstants.NODE);\n // result can be null with optional nodes!\n String textContent = result.getTextContent(); // NPE on 'result' access\n\nA unit test to reproduce this exception could look like this:\n InputStream xlsxInput = getResourceAsStream(\"excelWithMapping.xlsx\");\n InputStream xmlInput = getResourceAsStream(\"data.xml\");\n String xml = IOUtils.toString(xmlInput);\n XSSFWorkbook wb = openWorkbook(xlsxInput);\n XSSFMap map = wb.getMapInfo().getXSSFMapByName(\"PersonInfoRoot_Map\");\n XSSFImportFromXML importer = new XSSFImportFromXML(map);\n importer.importFromXML(xml); // throws NPE\n\n\nAdditional info:\n- used POI version: 3.9\n- used Excel version: 2010", "is_private": false, "bug_id": 55864, "id": 171673, "time": "2013-12-09T22:37:34Z", "creator": "thomas.kessler@zuehlke.com", "creation_time": "2013-12-09T22:37:34Z", "attachment_id": 31102}, {"attachment_id": 31237, "tags": [], "creator": "thomas.kessler@zuehlke.com", "is_private": false, "count": 1, "id": 172558, "time": "2014-01-20T17:05:09Z", "bug_id": 55864, "creation_time": "2014-01-20T17:05:09Z", "text": "Created attachment 31237\nPatch containing a bugfix and a unit test\n\nThe patch makes it possible to import XML into an Excel file which is mapped with a schema containing optional elements (minOccurs=\"0\").\nThe patch also contains a new unit test (all other tests still work)."}, {"attachment_id": null, "tags": [], "creator": "dominik.stadler@gmx.at", "is_private": false, "count": 2, "id": 178650, "time": "2014-10-21T15:56:58Z", "bug_id": 55864, "creation_time": "2014-10-21T15:56:58Z", "text": "Thanks for the patch, this is now applied as r1633404."}]
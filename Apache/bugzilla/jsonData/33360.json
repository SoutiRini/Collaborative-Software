[{"count": 0, "tags": [], "text": "There appears to be an issue when attempting to use a JNDI datasource when \ndefining a ROOT context. \n \nSo with the simple server.xml: \n \n<Server port=\"8005\" shutdown=\"SHUTDOWN\"> \n \n  <GlobalNamingResources> \n    <Resource name=\"UserDatabase\" auth=\"Container\" \n              type=\"org.apache.catalina.UserDatabase\" \n       description=\"User database that can be updated and saved\" \n           factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" \n          pathname=\"conf/tomcat-users.xml\" /> \n  </GlobalNamingResources> \n \n  <Service name=\"Catalina\"> \n    <!-- HTTP connector --> \n    <Connector port=\"8080\" \n               maxThreads=\"150\" minSpareThreads=\"25\" maxSpareThreads=\"75\" \n               enableLookups=\"false\" redirectPort=\"8443\" acceptCount=\"100\" \n               connectionTimeout=\"20000\" disableUploadTimeout=\"true\" \n               compression=\"on\" compressionMinSize=\"2048\"  \n               noCompressionUserAgents=\"gozilla, traviata\"  \n               compressableMimeType=\"text/html,text/xml\" /> \n \n    <!-- HTTPS connector --> \n    <Connector port=\"8443\"  \n               maxThreads=\"150\" minSpareThreads=\"25\" maxSpareThreads=\"75\" \n               enableLookups=\"false\" disableUploadTimeout=\"true\" \n               acceptCount=\"100\" scheme=\"https\" secure=\"true\" \n               clientAuth=\"false\" sslProtocol=\"TLS\" /> \n \n    <!-- AJP 1.3 connector (needed?) --> \n    <Connector port=\"8009\"  \n               enableLookups=\"false\" redirectPort=\"8443\" protocol=\"AJP/1.3\" /> \n    <Engine name=\"Catalina\" defaultHost=\"localhost\"> \n      <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" \n             resourceName=\"UserDatabase\"/> \n \n      <Host name='localhost' appBase='webapps' \n            unpackWARs='false' autoDeploy='true' \n            deployOnStartup='true' \n            xmlValidation='false' xmlNamespaceAware='false'> \n        <Context path='/' docBase='ROOT.war' \n                 crossContext='true'> \n          <Resource name='jdbc/myDB' auth='Container' \n                    type='javax.sql.DataSource' \n                    driverClassName='org.postgresql.Driver' \n                    url='jdbc:postgresql://localhost:5432/myDB' \n                    username='db-user' password='db-passwd' /> \n        </Context> \n      </Host> \n    </Engine> \n  </Service> \n</Server> \n \nWhen you do: \n \nContext ctx = new InitialContext(); \nDataSource ds = (DataSource) ctx.lookup(\"java:comp/env/jdbc/myDB\"); \nConnection conn = ds.getConnection(); \n \nThe following error gets throw: \norg.apache.tomcat.dbcp.dbcp.SQLNestedException: Cannot create JDBC driver of \nclass '' for connect URL 'null' \n        at \norg.apache.tomcat.dbcp.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:780) \n        at \norg.apache.tomcat.dbcp.dbcp.BasicDataSource.getConnection(BasicDataSource.java:540) \n \n \nIf you move the resource definition to <GlobalNamingResources> and do a \nresource link you get the same error.  \n \nBut if you change any of the following, it works fine: \n- Move the resource definition (or link if defined globally) to \n$CATALINA_HOME/conf/context.xml and remove it from the context entry in \nserver.xml \n- Move the context defintion out of server.xml completely to \n$CATALINA_HOME/conf/Catalina/localhost/ROOT.xml \n- Move the context defintion out of server.xml completely to \n<webapp>/META-INF/context.xml \n- Keep the context entry and resource definition in server.xml but change the \ncontext path to something besides '/' \n \nThis indicates that web applications mounted on the root context are treated \ndifferently from other web applications. I think it should be consistent.", "is_private": false, "id": 70380, "creator": "miles@runtime-collective.com", "time": "2005-02-02T16:41:17Z", "bug_id": 33360, "creation_time": "2005-02-02T16:41:17Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 33360, "is_private": false, "count": 1, "id": 70381, "time": "2005-02-02T16:42:03Z", "creator": "miles@runtime-collective.com", "creation_time": "2005-02-02T16:42:03Z", "text": "A discussion of the topic from TSS: \n \nhttp://theserverside.com/discussions/thread.tss?thread_id=25459#137873 "}, {"count": 2, "tags": [], "creator": "miles@runtime-collective.com", "text": "The cause of the problem might be described in bug #30117 that notices that \nresource parameters are ignored under the root context. ", "id": 70383, "time": "2005-02-02T16:43:37Z", "bug_id": 33360, "creation_time": "2005-02-02T16:43:37Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 33360, "is_private": false, "count": 3, "id": 70386, "time": "2005-02-02T16:59:49Z", "creator": "remm@apache.org", "creation_time": "2005-02-02T16:59:49Z", "text": "The right path to be used in server.xml is \"\", not \"/\". What you did would just\ncreate another webapp which would never be accessed, while your webapp would be\ndeployed by the auto deployer, without your parameters. We used to have an\nexample in server.xml for this special case (<Context path=\"\" docBase=\"ROOT\"\ndebug=\"0\"/>), but it's removed as we recommend not using server.xml for\ndeclaring contexts.\n\nTry to avoid using Context elements in server.xml except for webapps which are\noutside of the Host appBase.\n\nInstead, as you mention, use $CATALINA_HOME/conf/Catalina/localhost/ROOT.xml or\nwhatever_your_war_is.war/META-INF/context.xml, but don't use either docBase or\npath (which would be ignored anyway) on your Context element.\n\nNote: The AJP connector is not needed, if you don't use it. (makes sense, I suppose)"}, {"attachment_id": null, "tags": [], "bug_id": 33360, "text": "Thanks for the heads up. ", "count": 4, "id": 70388, "time": "2005-02-02T17:10:27Z", "creator": "miles@runtime-collective.com", "creation_time": "2005-02-02T17:10:27Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 33360, "attachment_id": null, "text": "*** Bug 38307 has been marked as a duplicate of this bug. ***", "id": 84737, "time": "2006-01-18T11:00:18Z", "creator": "stumm@informatik.uni-kl.de", "creation_time": "2006-01-18T11:00:18Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 35473, "attachment_id": null, "is_private": false, "id": 76623, "time": "2005-06-22T20:33:03Z", "creator": "eric.dalquist@doit.wisc.edu", "creation_time": "2005-06-22T20:33:03Z", "text": "There was a change in the StandardManager class for Tomcat 5.5.9 that deprecated\nthe createSession method and created the createSession(sessionId) method to\nallow emptySessionPath=\"true\" to work. The SimpleTcpReplicationManager which\nsubclasses StandardManager was not updated to reflect this change. Now if you\ntry to use the SimpleTcpReplicationManager with the emptySessionPath=\"true\"\nconfiguration set the follow exception is thrown:\n\nERROR org.apache.catalina.cluster.session.SimpleTcpReplicationManager - [Unable\nto replicate session] 2005-06-22 13:13:42,657\njava.lang.ClassCastException: org.apache.catalina.session.StandardSession\n        at\norg.apache.catalina.cluster.session.SimpleTcpReplicationManager.requestCompleted(SimpleTcpReplicationManager.java:258)\n        at\norg.apache.catalina.cluster.tcp.ReplicationValve.invoke(ReplicationValve.java:206)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n        at\norg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n        at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:307)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:385)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:748)\n        at\norg.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:678)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:871)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n        at java.lang.Thread.run(Thread.java:595)\n\nDoing some debugging it looks like \"Request.doGetSession(boolean) line: 2204\"\ncalls \"public Session createSession(String sessionId);\" from the manager\ninterface. Since SimpleTcpReplicationManager does not override this method but\noverrides the \"public Session createSession();\" method the call goes directly\ninto the StandardManager which returns a StandardSession. When the\nSimpleTcpReplicationManager attempts to replicate this session later it fails\nwhen trying to cast it to ReplicatedSession."}, {"count": 1, "tags": [], "bug_id": 35473, "attachment_id": null, "id": 76628, "time": "2005-06-22T22:28:20Z", "creator": "remm@apache.org", "creation_time": "2005-06-22T22:28:20Z", "is_private": false, "text": "I think this proves nobody cares about this manager anymore: don't use it."}, {"count": 2, "tags": [], "creator": "eric.dalquist@doit.wisc.edu", "attachment_id": null, "text": "(In reply to comment #1)\n> I think this proves nobody cares about this manager anymore: don't use it.\n\nI'm not sure what else to use to get the behavior we need. I tried the\nDeltaManager but the application we're working on replicating the session does\nnot call setAttribute when it modifies the attribute data, it is modified by\nreference. I realize this is not a good way to do it but we can't change the\napplication. SimpleTcpReplicationManager replicates after every request which is\nthe behavior we need. Suggestions on a different approach would always be\nappreciated.\n\nIf the SimpleTcpReplicationManager should not be used it should be deprecated\nand documented as such.\n\nI have fixed the bug locally and will upload a patch diff to this bug.", "id": 76629, "time": "2005-06-22T22:59:07Z", "bug_id": 35473, "creation_time": "2005-06-22T22:59:07Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 35473, "attachment_id": 15521, "id": 76630, "time": "2005-06-22T23:00:37Z", "creator": "eric.dalquist@doit.wisc.edu", "creation_time": "2005-06-22T23:00:37Z", "is_private": false, "text": "Created attachment 15521\nSimpleTcpReplicationManager patch to resolve session replication problem"}, {"count": 4, "tags": [], "text": "OK,\n\nI see the problem and test your fix.\n\nThanx\nPeter", "is_private": false, "id": 76681, "creator": "pr@objektpark.de", "time": "2005-06-24T00:03:11Z", "bug_id": 35473, "creation_time": "2005-06-24T00:03:11Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 35473, "attachment_id": null, "is_private": false, "id": 77580, "time": "2005-07-22T16:53:28Z", "creator": "yoavs@computer.org", "creation_time": "2005-07-22T16:53:28Z", "text": "Peter, any progress on this?  I'd like to get this fix into 5.5.10 if applicable."}, {"count": 6, "tags": [], "bug_id": 35473, "attachment_id": null, "text": "Hups, is fixed..", "id": 77585, "time": "2005-07-22T18:55:40Z", "creator": "pr@objektpark.de", "creation_time": "2005-07-22T18:55:40Z", "is_private": false}]
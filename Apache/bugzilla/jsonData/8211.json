[{"count": 0, "attachment_id": null, "bug_id": 8211, "text": "The FAQ addresses buffered output for CGI scripts (which are not buffered), \nbut not for SSI (which *is* buffered).  In previous releases (i.e. 1.3.x) SSI \nscripts were unbuffered.  Is there a way to make 2.0.x SSI scripts unbuffered as \nwell?\n\nRegards,\n-Tom\n\n\nCGI/SSI FAQ #4: How can I get my script's output without Apache buffering it? \nWhy doesn't my server push work? \n\nof Apache 1.3, CGI scripts are essentially not buffered. Every time your script \ndoes a \"flush\" to output data, that data gets relayed on to the client. Some \nscripting languages, for example Perl, have their own buffering for output - \nthis can be disabled by setting the $| special variable to 1. Of course this \ndoes increase the overall number of packets being transmitted, which can result \nin a sense of slowness for the end user.\n\nPrior to 1.3, you needed to use \"nph-\" scripts to accomplish non-buffering.  \nToday, the only difference between nph scripts and normal scripts is that nph \nscripts require the full HTTP headers to be sent.", "id": 13866, "time": "2002-04-17T15:49:05Z", "creator": "twb0@lymenet.org", "creation_time": "2002-04-17T15:49:05Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 8211, "attachment_id": null, "text": "It may have been fixed and broken again since you wrote this PR, as this\nPR is pretty old.\n\nOver the past couple of days, problems have been fixed in the core\ncode and in mod_cgid which caused Apache to needlessly hold on to\noutput from scripts (including SSI scripts).\n\nIf you're using mod_cgi:\n\n2.0.43 will have the necessary fixes.\n\nIf you're using mod_cgid:\n\nThe release after 2.0.43 will have the necessary fixes.\n\nIf this doesn't resolve your problem, please re-open the PR\nand give some information about how to reproduce the problem.\n\nThanks!", "id": 23872, "time": "2002-10-04T00:16:44Z", "creator": "trawick@apache.org", "creation_time": "2002-10-04T00:16:44Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 8211, "attachment_id": null, "text": "Same behavior in 2.0.43 (we're using mod_cgi as shown at the bottom of this\nmessage).\n\nFor example, I created a test case on a \"play\" server Using Apache 2.0.43:\n\n   http://www.proft.org:81/buffer.shtml\n   http://www.proft.org:81/buffer.cgi\n\nThese display the date three times with a five second pause inbetween.\n\nThe CGI (buffer.cgi) version displays unbuffered and you can see each line\ndisplay in real time.  The SSI (buffer.shtml) version waits about 15 seconds for\nthe entire page to build/buffer and then displays the final results.\n\nIf you look at the same two pages using the older Apache 1.3.36, it is\nunbuffered (as expected) for both cases:\n\n   http://www.proft.org:80/buffer.shtml\n   http://www.proft.org:80/buffer.cgi\n\n\nHere is my Apache 2.0.43 config:\n\ntick# ./httpd -V\nServer version: Apache/2.0.43\nServer built:   Oct 15 2002 11:23:26\nServer's Module Magic Number: 20020903:0\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_MMAP\n -D APR_USE_PROC_PTHREAD_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/opt/apache2\"\n -D SUEXEC_BIN=\"/opt/apache2/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"logs/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\ntick# ./httpd -l\nCompiled in modules:\n  core.c\n  mod_access.c\n  mod_auth.c\n  mod_auth_anon.c\n  mod_ext_filter.c\n  mod_include.c\n  mod_log_config.c\n  mod_env.c\n  mod_mime_magic.c\n  mod_cern_meta.c\n  mod_expires.c\n  mod_headers.c\n  mod_setenvif.c\n  prefork.c\n  http_core.c\n  mod_mime.c\n  mod_status.c\n  mod_autoindex.c\n  mod_asis.c\n  mod_info.c\n  mod_cgi.c\n  mod_vhost_alias.c\n  mod_negotiation.c\n  mod_dir.c\n  mod_imap.c\n  mod_actions.c\n  mod_speling.c\n  mod_userdir.c\n  mod_alias.c\n  mod_rewrite.c\n  mod_so.c\n", "id": 24571, "time": "2002-10-15T18:11:39Z", "creator": "twb0@lymenet.org", "creation_time": "2002-10-15T18:11:39Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 8211, "attachment_id": null, "id": 26178, "time": "2002-11-13T14:49:53Z", "creator": "trawick@apache.org", "creation_time": "2002-11-13T14:49:53Z", "is_private": false, "text": "Would you be so kind as to attach the source of buffer.shtml?\nWhile verifying/debugging this on current code, I want to make \nsure that I'm using the same mechanism of invoking the script that\nyou are using.\n\nThanks!\n"}, {"count": 4, "tags": [], "bug_id": 8211, "attachment_id": null, "text": "Here is the source to both buffer.shtml and buffer.cgi:\n\n---------------------------------\nbuffer.shtml:\n\n<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n<HTML>\n<HEAD>\n   <TITLE>Buffered I/O test - SSI</TITLE>\n   <META HTTP-EQUIV=\"Content-Type\" content=\"text/html; charset=utf-8\">\n</HEAD>\n<BODY TEXT=\"#FFFFFF\" BGCOLOR=\"#000000\" LINK=\"#FF80FF\" VLINK=\"#C0C0C0\"\nALINK=\"#C0FFC0\">\n\n<H2>Buffered I/O test - SSI:</H2>\n<PRE><TT>Server name: <!--#echo var=\"SERVER_NAME\"-->\nServer software: <!--#echo var=\"SERVER_SOFTWARE\"-->\nServer administrator: <!--#echo var=\"SERVER_ADMIN\"-->\nServer date (<!--#echo var=\"TZ\"-->): <!--#echo var=\"DATE_LOCAL\"-->\nServer port: <!--#echo var=\"SERVER_PORT\"-->\nServer protocol: <!--#echo var=\"SERVER_PROTOCOL\"-->\nServer gateway interface: <!--#echo var=\"GATEWAY_INTERFACE\"-->\n\n3 lines of text with 5 second pauses inbetween:\n</TT></PRE><BR>\n\n<!--#exec cmd=\"/usr/bin/date\"--><BR>\n<!--#exec cmd=\"/usr/bin/sleep 5\"-->\n<!--#exec cmd=\"/usr/bin/date\"--><BR>\n<!--#exec cmd=\"/usr/bin/sleep 5\"-->\n<!--#exec cmd=\"/usr/bin/date\"--><BR>\n<!--#exec cmd=\"/usr/bin/sleep 5\"-->\n\n<PRE><TT>\n\nDone!\n</TT></PRE><BR>\n\n</BODY>\n</HTML>\n\n\n\n---------------------------------\nbuffer.cgi:\n\n#!/bin/sh\n\n\ncat <<!EOF!\nContent-type: text/html\n\n<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n<HTML>\n<HEAD>\n   <TITLE>Buffered I/O test - CGI</TITLE>\n   <META HTTP-EQUIV=\"Content-Type\" content=\"text/html; charset=utf-8\">\n</HEAD>\n<BODY TEXT=\"#FFFFFF\" BGCOLOR=\"#000000\" LINK=\"#FF80FF\" VLINK=\"#C0C0C0\"\nALINK=\"#C0FFC0\">\n\n<H2>Buffered I/O test - CGI:</H2>\n<PRE><TT>Server name:  $SERVER_NAME\nServer software:  $SERVER_SOFTWARE\nServer administrator:  $SERVER_ADMIN\nServer date ($TZ): $DATE_LOCAL\nServer port:  $SERVER_PORT\nServer protocol:  $SERVER_PROTOCOL\nServer gateway interface:  $GATEWAY_INTERFACE\n<BR>\n\n3 lines of text with 5 second pauses inbetween:\n!EOF!\n\n/usr/bin/date\n/usr/bin/sleep 5\n/usr/bin/date\n/usr/bin/sleep 5\n/usr/bin/date\n/usr/bin/sleep 5\n\ncat <<!EOF!\n\nDone!\n</TT></PRE><BR>\n\n</BODY>\n</HTML>\n!EOF!\n", "id": 26186, "time": "2002-11-13T15:42:52Z", "creator": "twb0@lymenet.org", "creation_time": "2002-11-13T15:42:52Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 8211, "attachment_id": null, "text": "quite interesting!\n\nI had some time to work on this again, so I put your .shtml file on Linux\n(running current code from CVS) and it worked with mod_cgi and mod_cgid, then I\ntried it \nwith 2.0.43, still on Linux, and it worked with mod_cgi but not with mod_cgid.\nThis is as I expected and had suggested to you earlier.\n\nSo then I went to Solaris and installed 2.0.43 and sure enough it didn't stream\nproperly with mod_cgi, unlike Linux.  But with current code in CVS on Solaris it\ndoes stream properly with both mod_cgi and mod_cgid.  So hopefully this is all\nsquared away.  I would like to know why the shtml didn't stream with mod_cgi on\n2.0.43 on Solaris, but I don't want to know bad enough to lose any sleep over \nit :)\n\nHopefully 2.0.44 will come out in the next couple of weeks so you can easily\nget whatever change in Apache or APR helped out Solaris.\n\nThanks for the perfect testcase, and thanks for using Apache!", "id": 26841, "time": "2002-11-23T01:49:18Z", "creator": "trawick@apache.org", "creation_time": "2002-11-23T01:49:18Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "drmacro@yahoo.com", "attachment_id": null, "text": "Index: TTFFile.java\n===================================================================\nRCS file: /home/cvspublic/xml-\nfop/src/java/org/apache/fop/fonts/truetype/TTFFile.java,v\nretrieving revision 1.4\ndiff -w -u -r1.4 TTFFile.java\n--- TTFFile.java\t27 May 2003 14:03:34 -0000\t1.4\n+++ TTFFile.java\t8 Jan 2004 19:52:11 -0000\n@@ -132,6 +132,8 @@\n \n     private TTFDirTabEntry currentDirTab;\n \n+    private boolean isCFF = false;\n+\n     /**\n      * Position inputstream to position indicated\n      * in the dirtab offset + offset\n@@ -460,8 +462,10 @@\n         initAnsiWidths();\n         readPostScript(in);\n         readOS2(in);\n+        if (!isCFF) {\n         readIndexToLocation(in);\n         readGlyf(in);\n+        }\n         readName(in);\n         readPCLT(in);\n         // Read cmap table and fill in ansiwidths\n@@ -473,7 +477,11 @@\n         createCMaps();\n         // print_max_min();\n \n+\t\tif (isCFF) {\n+\t\t\t// readGPOS(in); // GPOS is OpenType CFF analog of \nTrueType kerning table.\t\t\t\n+\t\t} else {\n         readKerning(in);\n+\t\t}\n         return true;\n     }\n \n@@ -694,6 +702,15 @@\n         return isEmbeddable;\n     }\n \n+    /**\n+     * Indicates whether or not the font is an OpenType\n+     * CFF font (rather than a TrueType font).\n+     * @return boolean True if the font is in OpenType CFF format.\n+     */\n+    public boolean isCFF() {\n+    \treturn isCFF;\n+    }\n+\n \n     /**\n      * Read Table Directory from the current position in the\n@@ -704,9 +721,26 @@\n      * @throws IOException in case of an I/O problem\n      */\n     protected void readDirTabs(FontFileReader in) throws IOException {\n-        in.skip(4);    // TTF_FIXED_SIZE\n+    \t\n+    \t// Read the version value (first 4 bytes):\n+    \tbyte[]  verBytes = new byte[4];\n+    \tverBytes[0] = in.readTTFByte();\n+\t\tverBytes[1] = in.readTTFByte();\n+\t\tverBytes[2] = in.readTTFByte();\n+\t\tverBytes[3] = in.readTTFByte();\n+\t\tString version = new String(verBytes, \"ISO-8859-1\");\n+\t\tif (verBytes[1] == 0x01) {\n+\t\t\tgetLogger().info(\"Font is TrueType TTF format\");\t\n\t\t\n+\t\t} else if (version.equals(\"OTTO\")) {\n+\t\t\tgetLogger().info(\"Font is OpenType CFF format\");\n+\t\t\tisCFF = true;\n+\t\t} else {\n+\t\t\tString msg = \"Font does not appear to be either \nTrueType or OpenType\";\n+\t\t\tthrow new IOException(msg);\n+\t\t}\n+\t\t\n         int ntabs = in.readTTFUShort();\n-        in.skip(6);    // 3xTTF_USHORT_SIZE\n+        in.skip(6);    // 3xTTF_USHORT_SIZE. searchRange, \tentrySelector, \nrangeShift\n \n         dirTabs = new java.util.HashMap();\n         TTFDirTabEntry[] pd = new TTFDirTabEntry[ntabs];\n@@ -715,6 +749,15 @@\n             pd[i] = new TTFDirTabEntry();\n             dirTabs.put(pd[i].read(in), pd[i]);\n         }\n+\t\tif (getLogger().isDebugEnabled()) {\n+\t\t\tgetLogger().debug(\"Font table entries:\");\n+\t\t\tIterator iter = dirTabs.keySet().iterator();\n+\t\t\twhile (iter.hasNext()) {\n+\t\t\t\tString tag = (String)iter.next();\n+\t\t\t\tTTFDirTabEntry tab = (TTFDirTabEntry)dirTabs.get\n(tag);\n+\t\t\t\tgetLogger().debug(tab.getTagString() + \": \noffset=\" + tab.getOffset() + \", length=\" + tab.getLength());\n+\t\t\t}\n+\t\t}\n     }\n \n     /**\n\nIndex: TTFDirTabEntry.java\n===================================================================\nRCS file: /home/cvspublic/xml-\nfop/src/java/org/apache/fop/fonts/truetype/TTFDirTabEntry.java,v\nretrieving revision 1.1\ndiff -w -u -r1.1 TTFDirTabEntry.java\n--- TTFDirTabEntry.java\t11 Mar 2003 13:05:23 -0000\t1.1\n+++ TTFDirTabEntry.java\t8 Jan 2004 19:59:08 -0000\n@@ -51,6 +51,7 @@\n package org.apache.fop.fonts.truetype;\n \n import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n \n \n /**\n@@ -76,9 +77,11 @@\n \n         offset = in.readTTFULong();\n         length = in.readTTFULong();\n+        String tagStr = new String(tag, \"ISO-8859-1\");\n+        // System.err.println(\"tag='\" + tagStr + \"'\");\n \n         //System.out.println(this.toString());\n-        return new String(tag, \"ISO-8859-1\");\n+        return tagStr;\n     }\n \n \n@@ -115,11 +118,23 @@\n     }\n \n     /**\n-     * Returns the tag.\n+     * Returns the tag bytes.\n      * @return byte[]\n      */\n     public byte[] getTag() {\n         return tag;\n     }\n+\n+\t/**\n+\t * Returns the tag bytes.\n+\t * @return byte[]\n+\t */\n+\tpublic String getTagString() {\n+\t\ttry {\n+\t\t\treturn new String(tag, \"ISO-8859-1\");\n+\t\t} catch (UnsupportedEncodingException e) {\n+\t\t\treturn this.toString(); // Should never happen.\n+\t\t}\n+\t}\n \n }\n\nIndex: TTFReader.java\n===================================================================\nRCS file: /home/cvspublic/xml-\nfop/src/java/org/apache/fop/fonts/apps/TTFReader.java,v\nretrieving revision 1.2\ndiff -w -u -r1.2 TTFReader.java\n--- TTFReader.java\t27 May 2003 14:01:25 -0000\t1.2\n+++ TTFReader.java\t8 Jan 2004 20:18:27 -0000\n@@ -396,7 +396,11 @@\n             generateDOM4SingleByteExtras(root, ttf, isCid);\n         }\n \n+\t\t// TODO: Need to get equivalent info from GPOS table for\n+\t\t// CFF fonts.\t\t\n+\t\tif (!ttf.isCFF()) {\n         generateDOM4Kerning(root, ttf, isCid);\n+\t\t}\n \n         return doc;\n     }\n@@ -496,7 +500,6 @@\n             } else {\n                 h2 = (Map)ttf.getAnsiKerning().get(kpx1);\n             }\n-\n             Iterator enum2 = h2.keySet().iterator();\n             while (enum2.hasNext()) {\n                 Integer kpx2 = (Integer)enum2.next();", "id": 50277, "time": "2004-01-08T20:20:50Z", "bug_id": 25999, "creation_time": "2004-01-08T20:20:50Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bowditch_chris@hotmail.com", "attachment_id": null, "text": "related thread in FOP dev\n\nhttp://marc.theaimsgroup.com/?l=fop-dev&m=107342953607261&w=2", "id": 50303, "time": "2004-01-09T08:39:26Z", "bug_id": 25999, "creation_time": "2004-01-09T08:39:26Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 25999, "attachment_id": null, "id": 50307, "time": "2004-01-09T09:15:14Z", "creator": "jeremias@apache.org", "creation_time": "2004-01-09T09:15:14Z", "is_private": false, "text": "I've got trouble applying your patch. Would you please add it as an \nattachment, please? Bugzilla does some line-breaking which messes up the \npatch. As an optional bonus it would be cool if you could remove the tab \ncharacters and replace them with 4 spaces each. Thanks!"}, {"count": 3, "tags": [], "text": "Fixed in SVN, although only roughly from this patch:\nhttp://svn.apache.org/viewvc?view=rev&rev=503317", "attachment_id": null, "bug_id": 25999, "id": 98937, "time": "2007-02-03T13:58:06Z", "creator": "jeremias@apache.org", "creation_time": "2007-02-03T13:58:06Z", "is_private": false}, {"count": 4, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "id": 155851, "time": "2012-04-01T06:44:49Z", "bug_id": 25999, "creation_time": "2012-04-01T06:44:49Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "xuekun.hu@gmail.com", "text": "I tried to use the new connector \"mod_proxy_ajp\" to connect with Apache2.1.x \nand TOMCAT 5.5.9. With little simultaneous connections, all work fine. However \nwhen have lots of simultaneous connections, there are lots of the belows \nerrors: \n...\n[Mon Sep 05 14:29:35 2005] [error] ajp_check_msg_header() got bad signature 40\n[Mon Sep 05 14:29:35 2005] [error] ajp_ilink_receive() received bad header\n[Mon Sep 05 14:29:35 2005] [error] proxy: got bad response (2) from (null) (*)\n[Mon Sep 05 14:29:35 2005] [error] ajp_read_header: ajp_ilink_receive failed\n[Mon Sep 05 14:29:35 2005] [error] (120007)APR does not understand this error \ncode: proxy: read response failed from (null) (*)\n[Mon Sep 05 14:29:35 2005] [error] ajp_check_msg_header() got bad signature 1a8a\n[Mon Sep 05 14:29:35 2005] [error] ajp_ilink_receive() received bad header\n[Mon Sep 05 14:29:35 2005] [error] ajp_read_header: ajp_ilink_receive failed\n[Mon Sep 05 14:29:35 2005] [error] (120007)APR does not understand this error \ncode: proxy: read response failed from (null) (*)\n[Mon Sep 05 14:29:35 2005] [error] ajp_check_msg_header() got bad signature 2020\n[Mon Sep 05 14:29:35 2005] [error] ajp_ilink_receive() received bad header\n[Mon Sep 05 14:29:35 2005] [error] ajp_read_header: ajp_ilink_receive failed\n[Mon Sep 05 14:29:35 2005] [error] (120007)APR does not understand this error \ncode: proxy: read response failed from (null) (*)\n...\n\nMy Apache configuration:\nThreadLimit     600\n<IfModule worker.c>\nStartServers         4\nMaxClients         24000\nServerLimit     50\nMinSpareThreads      1000\nMaxSpareThreads      2000\nThreadsPerChild     600\nMaxRequestsPerChild  0\nListenBackLog   3000\n</IfModule>\nMaxRequestsPerChild  0\n\nProxyPass /jspdir ajp://localhost:8009/jspdir max=100\n\nMy TOMCAT configuration:\n   <Connector port=\"8009\" maxHttpHeaderSize=\"8192\"\n              maxThreads=\"8000\" minSpareThreads=\"4000\" maxSpareThreads=\"8000\"\n              acceptCound=\"50000\" enableLookups=\"false\"\nredirectPort=\"8443\" protocol=\"AJP/1.3\"\n              tomcatAuthentication = \"false\" />\n\nThx, Xuekun", "id": 79382, "time": "2005-09-05T09:07:26Z", "bug_id": 36495, "creation_time": "2005-09-05T09:07:26Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 36495, "is_private": false, "text": "Can you try this with 2.2.0?", "id": 83296, "time": "2005-12-06T08:00:09Z", "creator": "chip@force-elite.com", "creation_time": "2005-12-06T08:00:09Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "xuekun.hu@gmail.com", "text": "(In reply to comment #1)\n> Can you try this with 2.2.0?\n\nSorry for late response. \n\nI tested Apache 2.2.0, and error again with about 6000 simultaneous \nconnections, though the error messages were slightly different. \n\n[Mon Dec 19 10:41:03 2005] [error] (110)Connection timed out: proxy: AJP: \nattempt to connect to 127.0.0.1:8009 (localhost) failed\n[Mon Dec 19 10:41:03 2005] [error] proxy: AJP: failed to make connection to \nbackend: localhost\n[Mon Dec 19 10:41:04 2005] [error] (110)Connection timed out: proxy: AJP: \nattempt to connect to 127.0.0.1:8009 (localhost) failed\n[Mon Dec 19 10:41:04 2005] [error] proxy: AJP: failed to make connection to \nbackend: localhost\n[Mon Dec 19 10:41:04 2005] [error] (110)Connection timed out: proxy: AJP: \nattempt to connect to 127.0.0.1:8009 (localhost) failed\n[Mon Dec 19 10:41:04 2005] [error] proxy: AJP: failed to make connection to \nbackend: localhost\n[Mon Dec 19 10:41:07 2005] [error] (104)Connection reset by peer: \najp_ilink_receive() can't receive header\n[Mon Dec 19 10:41:07 2005] [error] ajp_read_header: ajp_ilink_receive failed\n[Mon Dec 19 10:41:07 2005] [error] (120006)APR does not understand this error \ncode: proxy: read response failed from (null) (localhost)\n[Mon Dec 19 10:41:08 2005] [error] (104)Connection reset by peer: \najp_ilink_receive() can't receive header\n[Mon Dec 19 10:41:08 2005] [error] ajp_read_header: ajp_ilink_receive failed\n[Mon Dec 19 10:41:08 2005] [error] (120006)APR does not understand this error \ncode: proxy: read response failed from (null) (localhost)\n....\n....\n[Mon Dec 19 10:42:55 2005] [error] (104)Connection reset by peer: \najp_ilink_receive() can't receive header\n[Mon Dec 19 10:42:55 2005] [error] ajp_read_header: ajp_ilink_receive failed\n[Mon Dec 19 10:42:55 2005] [error] (120006)APR does not understand this error \ncode: proxy: read response failed from (null) (localhost)\n[Mon Dec 19 10:42:57 2005] [error] (104)Connection reset by peer: \najp_ilink_receive() can't receive header\n[Mon Dec 19 10:42:57 2005] [error] ajp_read_header: ajp_ilink_receive failed\n[Mon Dec 19 10:42:57 2005] [error] (120006)APR does not understand this error \ncode: proxy: read response failed from (null) (localhost)\n\nIn TOMCAT5.5.9 log, found \n\"Dec 19, 2005 10:18:04 AM org.apache.tomcat.util.threads.ThreadPool logFull\nSEVERE: All threads (8,000) are currently busy, waiting. Increase maxThreads \n(8,000) or check the servlet status\"\n\nIf using mod_jk, works perfectly!\n\nThx, Xuekun\n\n", "count": 2, "id": 83787, "time": "2005-12-19T07:54:20Z", "bug_id": 36495, "creation_time": "2005-12-19T07:54:20Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 36495, "text": "Please execute the following command if the problem occurs again and post the\nresult of:\n\nnetstat -tn | egrep \"^tcp.*:8009\" | tr -s \" \" | cut -f6 -d \" \" | sort | uniq -c\n\nWhat is your ulimit -n setting for httpd and Tomcat?\nYou said it works with mod_jk. Please let me know which version of mod_jk and\npost your worker.properties please.", "id": 83815, "time": "2005-12-19T21:29:59Z", "creator": "rpluem@apache.org", "creation_time": "2005-12-19T21:29:59Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 36495, "attachment_id": null, "is_private": false, "id": 83823, "time": "2005-12-20T06:27:24Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2005-12-20T06:27:24Z", "text": "(In reply to comment #3)\n> Please execute the following command if the problem occurs again and post the\n> result of:\n> netstat -tn | egrep \"^tcp.*:8009\" | tr -s \" \" | cut -f6 -d \" \" | sort | uniq -\nc\n  16213 ESTABLISHED\n   1240 SYN_SENT\n\nwowo...\n\n> What is your ulimit -n setting for httpd and Tomcat?\n\n110490\n\n> You said it works with mod_jk. Please let me know which version of mod_jk and\n> post your worker.properties please.\n\nmod_jk 1.2.14\n\nworkers.tomcat_home=/root/jakarta-tomcat-5.5.9\nworkers.java_home=$JAVA_HOME\nps=/\nworker.list=ajp13\nworker.ajp13.type=ajp13\nworker.ajp13.host=localhost\nworker.ajp13.port=8009\n\nThx, Xuekun"}, {"attachment_id": null, "tags": [], "creator": "rpluem@apache.org", "text": "(In reply to comment #4)\n> (In reply to comment #3)\n> > Please execute the following command if the problem occurs again and post the\n> > result of:\n> > netstat -tn | egrep \"^tcp.*:8009\" | tr -s \" \" | cut -f6 -d \" \" | sort | uniq -\n> c\n>   16213 ESTABLISHED\n>    1240 SYN_SENT\n>\n\nHmm. Strange. I currently do not see how that much connections could be created with\n\nMaxClients         24000\nServerLimit     50\nThreadsPerChild     600\n\nand\n\nProxyPass /jspdir ajp://localhost:8009/jspdir max=100\n\nwhich sets max to 100. This should result in 50 * 100 = 5000 connections at\nmost. Just a guess right now but maybe somewhere in the proxy module the socket\ndoes not get closed properly. Needs some more investigation.\n\n> \n> workers.tomcat_home=/root/jakarta-tomcat-5.5.9\n> workers.java_home=$JAVA_HOME\n> ps=/\n> worker.list=ajp13\n> worker.ajp13.type=ajp13\n> worker.ajp13.host=localhost\n> worker.ajp13.port=8009\n\nThat looks like you only use one connection to Tomcat per process as the\ncachesize property defaults to 1. That would be 50 connections to Tomcat in\ntotal at max. So this is not comparable to the test above. Try setting\n\nworker.ajp13.cachesize=100\n\nand test again.", "count": 5, "id": 83864, "time": "2005-12-20T23:17:00Z", "bug_id": 36495, "creation_time": "2005-12-20T23:17:00Z", "is_private": false}, {"count": 6, "tags": [], "creator": "xuekun.hu@gmail.com", "text": "(In reply to comment #5)\n> most. Just a guess right now but maybe somewhere in the proxy module the \nsocket\n> does not get closed properly. Needs some more investigation.\n\n> That looks like you only use one connection to Tomcat per process as the\n> cachesize property defaults to 1. That would be 50 connections to Tomcat in\n> total at max. So this is not comparable to the test above. Try setting\n> worker.ajp13.cachesize=100\n> and test again.\n\nWhen setting worker.ajp13.cachesize=100, all my testings are passed without \nerrors. \n\nAnd I also checked the connections to localhost:8009 with your commands, the \nmax number is about 600, so the max connections is about 300.  \n\nThx, Xuekun", "id": 83874, "time": "2005-12-21T04:36:58Z", "bug_id": 36495, "creation_time": "2005-12-21T04:36:58Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 36495, "text": "The main difference that I see between mod_proxy_ajp and mod_jk is that \nis_socket_connected in mod_jk does (translated to APR):\n   if(APR_STATUS_IS_EAGAIN(socket_status))\n      return 1;\n   else\n      return 0;\n\ninstead of:\n   if(APR_STATUS_IS_EOF(socket_status))\n      return 0;\n   else\n      return 1;\n\nOn my Solaris test box, socket_status is only ever EOF or EAGAIN, so it makes \nno difference.  I don't know how generally this is true.\n\nmod_jk will also try to re-establish the connection if the first response from \nTomcat fails, but the window between is_socket_connected and ajp_send_header \nhas to be unbelievably small.", "id": 83899, "time": "2005-12-22T01:55:56Z", "creator": "william.barker@wilshire.com", "creation_time": "2005-12-22T01:55:56Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "william.barker@wilshire.com", "is_private": false, "count": 8, "id": 83907, "time": "2005-12-22T05:58:24Z", "bug_id": 36495, "creation_time": "2005-12-22T05:58:24Z", "text": "(In reply to comment #7)\n> mod_jk will also try to re-establish the connection if the first response \nfrom \n> Tomcat fails, but the window between is_socket_connected and ajp_send_header \n> has to be unbelievably small.\n\nJust for chuckles, can you re-try your mod_jk tests with including:\n  worker.ajp13.recovery_options=3\n\nin your worker.properties file?  What this will tell us is if mod_jk really is \nactually recovering during the window between is_socket_connected and \najp_send_header.\n\n\n"}, {"count": 9, "tags": [], "bug_id": 36495, "attachment_id": null, "text": "What the h*ll, I want to know ;-)", "id": 83908, "time": "2005-12-22T05:59:43Z", "creator": "william.barker@wilshire.com", "creation_time": "2005-12-22T05:59:43Z", "is_private": false}, {"count": 10, "tags": [], "text": "(In reply to comment #9)\n> What the h*ll, I want to know ;-)\n\n? Sorry, can you elaborate what do you want to know? \n\n\n", "is_private": false, "id": 83910, "creator": "xuekun.hu@gmail.com", "time": "2005-12-22T06:58:56Z", "bug_id": 36495, "creation_time": "2005-12-22T06:58:56Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "william.barker@wilshire.com", "is_private": false, "count": 11, "id": 83911, "time": "2005-12-22T07:33:37Z", "bug_id": 36495, "creation_time": "2005-12-22T07:33:37Z", "text": "(In reply to comment #10)\n> (In reply to comment #9)\n> > What the h*ll, I want to know ;-)\n> ? Sorry, can you elaborate what do you want to know? \n\nAdding myself to the CC list, so I get notified of changes."}, {"count": 12, "tags": [], "bug_id": 36495, "is_private": false, "text": "(In reply to comment #8)\n> (In reply to comment #7)\n> > mod_jk will also try to re-establish the connection if the first response \n> from \n> > Tomcat fails, but the window between is_socket_connected and \najp_send_header \n> > has to be unbelievably small.\n> Just for chuckles, can you re-try your mod_jk tests with including:\n>   worker.ajp13.recovery_options=3\n> in your worker.properties file?  What this will tell us is if mod_jk really \nis \n> actually recovering during the window between is_socket_connected and \n> ajp_send_header.\n\nI tested with worker.ajp13.recovery_options=3, and all work fine without \nerrors. \n", "id": 83915, "time": "2005-12-22T09:06:23Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2005-12-22T09:06:23Z", "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 36495, "is_private": false, "text": "> I tested with worker.ajp13.recovery_options=3, and all work fine without \n> errors. \n\nOther than patching proxy_util.c as in #7, and trying again, I don't see a way \nforward. (not that I expect this to do anything interesting :).\n\n\n", "id": 85168, "time": "2006-01-29T02:25:01Z", "creator": "william.barker@wilshire.com", "creation_time": "2006-01-29T02:25:01Z", "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 36495, "is_private": false, "text": "(In reply to comment #13)\n> > I tested with worker.ajp13.recovery_options=3, and all work fine without \n> > errors. \n> Other than patching proxy_util.c as in #7, and trying again, I don't see a \nway \n> forward. (not that I expect this to do anything interesting :).\n\nI tested the patch in #7 before, still same errors. ", "id": 85430, "time": "2006-02-05T08:09:53Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2006-02-05T08:09:53Z", "attachment_id": null}, {"count": 15, "tags": [], "creator": "bugzilla@ying.net", "text": "We're seeing the same errors for mod_proxy_ajp and wanted to know how y'all were\ntrying out mod_jk w/ apache 2.2.3 given that the latest source distribution for\nmod_jk has no support for 2.2; it only supports 1.3 and 2.0", "id": 95591, "time": "2006-11-08T16:09:30Z", "bug_id": 36495, "creation_time": "2006-11-08T16:09:30Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "creator": "mhamant@free.fr", "text": "We have the same problem RHEL5 / /usr/lib64/httpd/modules/mod_proxy_ajp.so from\nhttpd 2.2.3. Messages start to appear from 50 concurrent connections.", "id": 106045, "time": "2007-07-30T02:30:47Z", "bug_id": 36495, "creation_time": "2007-07-30T02:30:47Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 36495, "attachment_id": null, "is_private": false, "id": 106699, "time": "2007-08-13T07:31:49Z", "creator": "earle.nietzel@gmail.com", "creation_time": "2007-08-13T07:31:49Z", "text": "(In reply to comment #16)\n> We have the same problem RHEL5 / /usr/lib64/httpd/modules/mod_proxy_ajp.so from\n> httpd 2.2.3. Messages start to appear from 50 concurrent connections.\n\nAlso seeing the same problem on FC6 x86_64 with using tcnative (native apr) and\ntomcat 5.5.23.\n\n[Fri Aug 10 16:36:40 2007] [error] ajp_check_msg_header() got bad signature 420\n[Fri Aug 10 16:36:40 2007] [error] ajp_ilink_receive() received bad header\n[Fri Aug 10 16:36:40 2007] [error] ajp_read_header: ajp_ilink_receive failed\n[Fri Aug 10 16:36:40 2007] [error] (120007)APR does not understand this error\ncode: proxy: read response failed from 127.0.0.1:8009 (localhost)\n\nMostly works fine but every now and then with only a few users these errors pop\nup. And someone gets a 503 service temporarily unavailable.\n\nThe config in proxy_ajp.conf is:\nProxyPass / ajp://localhost:8009/\nProxyPassReverse / ajp://localhost:8009/\n\nIf any more info is needed just ask, really need this one fixed.\n\n"}, {"count": 18, "tags": [], "bug_id": 36495, "text": "We had the same problem and finally, we found that it happened when Apache\nMaxClient < Tomcat maxThread.\nNow, it works fine.\n\nIf tomcat maxThread is reach then we got 503 until we restart tomcat.\n\n\nAlso, we had a configuration error because we tried to use maxProcessor in\ntomcat's server.xml wich is not used in tomcat 6. The correct parameter is\nmaxThreads.\n\nPlateform: RHEL5, x64.\n\n", "id": 106703, "time": "2007-08-13T08:25:34Z", "creator": "mbaroukh@cardiweb.com", "creation_time": "2007-08-13T08:25:34Z", "is_private": false, "attachment_id": null}, {"count": 19, "attachment_id": null, "bug_id": 36495, "text": "(In reply to comment #17)\n> (In reply to comment #16)\n> > We have the same problem RHEL5 / /usr/lib64/httpd/modules/mod_proxy_ajp.so from\n> > httpd 2.2.3. Messages start to appear from 50 concurrent connections.\n> \n> Also seeing the same problem on FC6 x86_64 with using tcnative (native apr) and\n> tomcat 5.5.23.\n> \n> [Fri Aug 10 16:36:40 2007] [error] ajp_check_msg_header() got bad signature 420\n\nThis case is different from the other cases. It seems that your Tomcat is\nsending wrong data. Please open a new report for this and try the following:\n\n1. Does this still happen without tcnative?\n2. Try upgrading Tomcat and tcnative\n\n", "id": 106713, "time": "2007-08-13T12:26:24Z", "creator": "rpluem@apache.org", "creation_time": "2007-08-13T12:26:24Z", "tags": [], "is_private": false}, {"count": 20, "tags": [], "bug_id": 36495, "text": "(In reply to comment #18)\n> We had the same problem and finally, we found that it happened when Apache\n> MaxClient < Tomcat maxThread.\n> Now, it works fine.\n> \n> If tomcat maxThread is reach then we got 503 until we restart tomcat.\n\nI have two Apaches and two Tomcats. \n\n          -> Tomcat A\nApache 1 -|\n          -> Tomcat B\n\n          -> Tomcat A\nApache 2 -|\n          -> Tomcat B\n\nApache's MaxClients is 1024 and Tomcat's maxThreads is also 1024. What's the\nrecommend setting to avoid ajp_ilink_receive() failed and client-side HTTP 503\nerror?", "id": 107675, "time": "2007-09-04T00:10:57Z", "creator": "mail@dekies.de", "creation_time": "2007-09-04T00:10:57Z", "is_private": false, "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 36495, "attachment_id": null, "text": "(In reply to comment #20)\n\n> \n> I have two Apaches and two Tomcats. \n> \n>           -> Tomcat A\n> Apache 1 -|\n>           -> Tomcat B\n> \n>           -> Tomcat A\n> Apache 2 -|\n>           -> Tomcat B\n> \n> Apache's MaxClients is 1024 and Tomcat's maxThreads is also 1024. What's the\n> recommend setting to avoid ajp_ilink_receive() failed and client-side HTTP 503\n> error?\n\n2048, but this is is insane. Try using the APR AJP connector\n(http://tomcat.apache.org/tomcat-5.5-doc/apr.html). This allows you to limit the\nnumber of threads to the number that really need to do work.\n\n", "id": 107698, "time": "2007-09-04T06:08:15Z", "creator": "rpluem@apache.org", "creation_time": "2007-09-04T06:08:15Z", "is_private": false}, {"count": 22, "tags": [], "bug_id": 36495, "text": "Tried APR with tcnative.\n\nNow the error.log shows the following (sometimes):\n[Tue Sep 18 14:48:05 2007] [error] ajp_check_msg_header() got bad signature 420\n[Tue Sep 18 14:48:05 2007] [error] ajp_ilink_receive() received bad header\n[Tue Sep 18 14:48:05 2007] [error] ajp_read_header: ajp_ilink_receive failed\n[Tue Sep 18 14:48:05 2007] [error] (120007)APR does not understand this error\ncode: proxy: read response failed from xxx.x.xxx.xx:20009 (xxx.x.xxx.xx)\n\ntomcat log at the same time:\njava.io.IOException\n        at org.apache.coyote.ajp.AjpAprProcessor.flush(AjpAprProcessor.java:1197)\n        at\norg.apache.coyote.ajp.AjpAprProcessor$SocketOutputBuffer.doWrite(AjpAprProcessor.java:1282)\n        at org.apache.coyote.Response.doWrite(Response.java:560)\n        at\norg.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:361)", "id": 108331, "time": "2007-09-18T06:18:31Z", "creator": "mail@dekies.de", "creation_time": "2007-09-18T06:18:31Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "count": 23, "id": 108350, "time": "2007-09-18T12:50:08Z", "bug_id": 36495, "creation_time": "2007-09-18T12:50:08Z", "text": "(In reply to comment #22)\n> Tried APR with tcnative.\n> \n> Now the error.log shows the following (sometimes):\n> [Tue Sep 18 14:48:05 2007] [error] ajp_check_msg_header() got bad signature 420\n\nThis looks like PR43220 to me. Hope I find time any time soon to start working\non it again.\n"}, {"count": 24, "tags": [], "bug_id": 36495, "text": "Hi, as this bug is hapenning on my platform ( Debian Etch x86_64 ), and this bug\nis still tagged as NEEDINFO, here is a little extract of Apache debug dump\nshowing the problem. Hope it'll help:\n\n[Wed Sep 26 17:14:52 2007] [debug] mod_proxy_ajp.c(44): proxy: AJP:\ncanonicalising URL //localhost:8009/test/dummy.gif\n[Wed Sep 26 17:14:52 2007] [debug] proxy_util.c(1378): [client 84.14.90.18]\nproxy: ajp: found worker ajp://localhost:8009/ for\najp://localhost:8009/test/dummy.gif, referer:\nhttp://dev.resamania.com/test/dummy.css\n[Wed Sep 26 17:14:52 2007] [debug] mod_proxy.c(756): Running scheme ajp handler\n(attempt 0)\n[Wed Sep 26 17:14:52 2007] [debug] mod_proxy_ajp.c(497): proxy: AJP: serving URL\najp://localhost:8009/test/dummy.gif\n[Wed Sep 26 17:14:52 2007] [debug] proxy_util.c(1798): proxy: AJP: has acquired\nconnection for (localhost)\n[Wed Sep 26 17:14:52 2007] [debug] proxy_util.c(1858): proxy: connecting\najp://localhost:8009/test/dummy.gif to localhost:8009\n[Wed Sep 26 17:14:52 2007] [debug] proxy_util.c(1951): proxy: connected\n/test/dummy.gif to localhost:8009\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(218): Into ajp_marshal_into_msgb\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[0] [Host] = [dev.resamania.com]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[1] [User-Agent] = [Mozilla/5.0 (Windows; U; Windows NT 5.1; fr;\nrv:1.8.1.7) Gecko/20070914 Firefox/2.0.0.7]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[2] [Accept] = [image/png,*/*;q=0.5]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[3] [Accept-Language] = [fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[4] [Accept-Encoding] = [gzip,deflate]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[5] [Accept-Charset] = [ISO-8859-1,utf-8;q=0.7,*;q=0.7]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[6] [Keep-Alive] = [300]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[7] [Connection] = [keep-alive]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[8] [Referer] = [http://myhost//test/dummy.css]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[9] [Cookie] = [login=a; JSESSIONID=012345678901234567890123456789]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[10] [Authorization] = [....]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[11] [Pragma] = [no-cache]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[12] [Cache-Control] = [no-cache]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(284): ajp_marshal_into_msgb:\nHeader[13] [Max-Forwards] = [10]\n[Wed Sep 26 17:14:52 2007] [debug] ajp_header.c(424): ajp_marshal_into_msgb: Done\n[Wed Sep 26 17:14:52 2007] [debug] mod_proxy_ajp.c(187): proxy: APR_BUCKET_IS_EOS\n[Wed Sep 26 17:14:52 2007] [debug] mod_proxy_ajp.c(192): proxy: data to read\n(max 8186 at 4)\n[Wed Sep 26 17:14:52 2007] [debug] mod_proxy_ajp.c(207): proxy: got 0 bytes of data\n[Wed Sep 26 17:14:52 2007] [error] ajp_read_header: ajp_ilink_receive failed\n[Wed Sep 26 17:14:52 2007] [error] (120007)APR does not understand this error\ncode: proxy: read response failed from 127.0.0.1:8009 (localhost)\n\nMathieu", "id": 108637, "time": "2007-09-26T08:24:14Z", "creator": "mathieu.rozieres@gmail.com", "creation_time": "2007-09-26T08:24:14Z", "is_private": false, "attachment_id": null}, {"count": 25, "attachment_id": null, "bug_id": 36495, "is_private": false, "id": 108641, "time": "2007-09-26T09:12:48Z", "creator": "mathieu.rozieres@gmail.com", "creation_time": "2007-09-26T09:12:48Z", "tags": [], "text": "Some tests with mod_jk (1.2.28 packaged inside Debian Etch x86_64 )\n===================================================================\n\nJust a bit more of information, people around are saying it works well with\nmod_jk, but in my opinion it simply work better. I.e Mod_jk handles the\n\"connection crashing\".... and try to handle the HTTP query through a new free\nconnector, here is a little extract of my mod_jk (1.2.28) error messages :\n\n[Wed Sep 26 18:10:25 2007][16884:10592] [info] \najp_send_request::jk_ajp_common.c (1178): Socket 23 is not connected any more\n(errno=-1)\n[Wed Sep 26 18:10:25 2007][16884:10592] [info] \najp_send_request::jk_ajp_common.c (1202): Error sending request. Will try\nanother pooled connection\n[Wed Sep 26 18:10:25 2007][16884:10592] [info] \najp_send_request::jk_ajp_common.c (1224): All endpoints are disconnected or dead\n[Wed Sep 26 18:10:25 2007][16884:10592] [info]  ajp_service::jk_ajp_common.c\n(1783): Sending request to tomcat failed,  recoverable operation attempt=1\n\nHope it helps.\n\nMathieu "}, {"count": 26, "tags": [], "creator": "andy.steeley@gmail.com", "text": "I don't know if this is relevant to this bug, but I saw this error reliably:\n\n[error] ajp_check_msg_header() got bad signature 420\n[error] ajp_ilink_receive() received bad header\n[error] ajp_read_header: ajp_ilink_receive failed\n[error] (120007)APR does not understand this error\ncode: proxy: read response failed from 127.0.0.1:8009 (localhost)\n\nwhen using Apache 2.2.3 & mod_proxy_ajp to proxy a JBoss 4.2.2.GA / Tomcat 5.5.x app.\n\nI found that my JBoss app wasn't setting the content-length response header.  For some reason, this caused my proxy to fail (503) after a number of requests.  The number of requests that before failure varied, but the error above always coincided with the 503s.  Just adding the Content-Length header in my JBoss/Tomcat app fixed it for me.  It may be relevant to mention that my proxied app was serving PDFs (w/ MIME application/pdf), not text/html.", "id": 119080, "time": "2008-07-28T08:50:10Z", "bug_id": 36495, "creation_time": "2008-07-28T08:50:10Z", "is_private": false, "attachment_id": null}, {"count": 27, "tags": [], "bug_id": 36495, "text": "We have also a lot of pdf download requests (axis webservice serving byte content). I switched to http a year ago and we had no problems since then. The problem only occurs in production environment so it's difficult for me to verify your workaround.", "id": 119081, "time": "2008-07-28T10:59:26Z", "creator": "mail@dekies.de", "creation_time": "2008-07-28T10:59:26Z", "is_private": false, "attachment_id": null}]
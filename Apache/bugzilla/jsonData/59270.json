[{"count": 0, "tags": [], "bug_id": 59270, "text": "It looks like the custom class loader isn't getting used anymore in 8.0.33.\n\nWith spring-instrument-tomcat-4.2.5.RELEASE.jar in the Tomcat lib folder and \n<Context>\n\t<Loader loaderClass=\"org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader\" />\n</Context>\n\nin the context.xml of the web application.\n\nDeployed in 8.0.22, I see TomcatInstrumentableClassLoader getting invoked immediately when the app starts deploying and no calls in 8.0.33.", "id": 189934, "time": "2016-04-04T10:18:43Z", "creator": "andrei.ivanov@gmail.com", "creation_time": "2016-04-04T10:18:43Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 59270, "text": "Hi,\n\nI do not observe this issue.\n\nI'm testing with Tomcat 8.0.33 and examples application and I clearly see\n\norg.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader\nTomcatInstrumentableClassLoader\n  context: examples\n  delegate: false\n----------> Parent Classloader:\njava.net.URLClassLoader@34ce8af7\n\n\nRegards,\nVioleta\n\nPP: I found the note below in the Spring Framework javadoc\nhttp://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/instrument/classloading/tomcat/TomcatInstrumentableClassLoader.html\n\nNOTE: Requires Apache Tomcat version 6.0 or higher, as of Spring 4.0. This class is not intended to work on Tomcat 8.0+; please rely on Tomcat's own InstrumentableClassLoader facility instead, as autodetected by Spring's TomcatLoadTimeWeaver.", "id": 189940, "time": "2016-04-04T17:51:24Z", "creator": "violetagg@apache.org", "creation_time": "2016-04-04T17:51:24Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 59270, "is_private": false, "id": 189969, "creation_time": "2016-04-05T14:09:47Z", "time": "2016-04-05T14:09:47Z", "creator": "andrei.ivanov@gmail.com", "text": "Hi,\nAs I've shown in https://bz.apache.org/bugzilla/show_bug.cgi?id=58143, the recommended Spring solution didn't work for me as Tomcat was already loading the class I want to weave before Spring gets initialized.\n\nIndeed, the custom classloader gets picked up.\nHa, seems that the API has changed again:\nOn 8.0.32, the new method was called: findResourceInternal(String name, String path, boolean manifestRequired)\nThis created the issue for Spring earlier :)\n\nOn 8.0.33, it reverts back to calling the initial method: findResourceInternal(String name, String path)\n\nThis is the Spring method body (in both cases):\nprotected ResourceEntry findResourceInternal(String name, String path) {\n\t\tResourceEntry entry = super.findResourceInternal(name, path);\n\t\tif (entry != null && entry.binaryContent != null && path.endsWith(CLASS_SUFFIX)) {\n\t\t\tString className = (name.endsWith(CLASS_SUFFIX) ? name.substring(0, name.length() - CLASS_SUFFIX.length()) : name);\n\t\t\tentry.binaryContent = this.weavingTransformer.transformIfNecessary(className, entry.binaryContent);\n\t\t}\n\t\treturn entry;\n\t}\n\nThe problem now is that entry.binaryContent is null, so the weaving doesn't take place.\n\nThis might be the cause: https://github.com/apache/tomcat/commit/bd3cd71dd8a40b02e1728d98a9c241ef630573ef#diff-3f0901a8e99cbddfc81363aeb77a0109", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 59270, "is_private": false, "id": 189978, "creation_time": "2016-04-05T16:28:04Z", "time": "2016-04-05T16:28:04Z", "creator": "remm@apache.org", "text": "Well, keeping this around actually seemed to use a lot of memory (not an issue with small webapps obviously), so it's probably not going to be restored.", "attachment_id": null}, {"count": 4, "tags": [], "text": "Hmm, it seems that I was forced to rely on the TomcatInstrumentableClassLoader because of this cache (as described in 58143).\n\nNow that the cache is gone, TomcatInstrumentableClassLoader no longer works but the recommended way works now :-)\n\nSo, I think it still counts as a regression, but I guess you can mark it as a won't fix.", "is_private": false, "id": 190005, "creation_time": "2016-04-06T09:22:01Z", "time": "2016-04-06T09:22:01Z", "creator": "andrei.ivanov@gmail.com", "bug_id": 59270, "attachment_id": null}, {"count": 5, "tags": [], "creator": "violetagg@apache.org", "attachment_id": null, "text": "Hi,\n\nI'm closing this issue with WON'T FIX.\n\nSpring's TomcatLoadTimeWeaver should be used instead of TomcatInstrumentableClassLoader.\n\nRegards,\nVioleta", "id": 190124, "time": "2016-04-11T07:09:34Z", "bug_id": 59270, "creation_time": "2016-04-11T07:09:34Z", "is_private": false}]
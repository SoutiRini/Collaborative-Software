[{"count": 0, "tags": [], "bug_id": 55855, "attachment_id": null, "text": "Reproducible in Tomcat 7 on 7.0.47 and on the current 7.0.x (@ r1548765).\nI have not tested Tomcat 8.\n\nSteps to reproduce:\n1. Create the file webapps/ROOT/test.jsp in the default ROOT web application.\n[[[\n<% throw new RuntimeException(); %>\n]]]\n\n2. Configure JAVA_HOME to point to a Java 7 JRE (7u45).\n3. Start Tomcat\n4. Browse http://localhost:8080/test.jsp\nThe following stacktrace is printed on the error page and into the log files:\n[[[\norg.apache.jasper.JasperException: An exception occurred processing JSP page /test.jsp at line 1\n\n1: <% throw new RuntimeException(); %>\n\n\nStacktrace:\n\torg.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:568)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:470)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:390)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:334)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:728)\n\torg.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\n]]]\n\n\nThe \"WsFilter\" in the stacktrace is unexpected, as the default ROOT web application does not use WebSockets.", "id": 171622, "time": "2013-12-07T00:38:18Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-12-07T00:38:18Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 55855, "attachment_id": null, "id": 171625, "time": "2013-12-07T19:00:29Z", "creator": "markt@apache.org", "creation_time": "2013-12-07T19:00:29Z", "is_private": false, "text": "This is not really that different from saying that a web application that doesn't use JSPs still has a JspServlet instance or a web application that doesn't use sessions still has a session manager.\n\nAs discussed on the users list we could add a attribute to the Context to specify a regular expression for SCI implementation classes that should be ignored. I'm changing this to an enhancement request to do exactly that."}, {"count": 2, "tags": [], "bug_id": 55855, "attachment_id": null, "text": "I have patched 8.0.x and 7.0.x so the filter is only added if a web application has active WebSocket Endpoints. I think there is still merit in disabling the SCI since that will remove the need for the annotation scan.", "id": 171776, "time": "2013-12-16T21:06:08Z", "creator": "markt@apache.org", "creation_time": "2013-12-16T21:06:08Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "A new option, containerSciFilter, has been added to the Context in 8.0.x and will be included in 8.0.0 onwards.", "id": 172395, "time": "2014-01-15T12:24:53Z", "bug_id": 55855, "creation_time": "2014-01-15T12:24:53Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 55855, "text": "The option has been back-ported to 7.0.x and will be included in 7.0.51 onwards.", "id": 172397, "time": "2014-01-15T13:36:53Z", "creator": "markt@apache.org", "creation_time": "2014-01-15T13:36:53Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 55855, "attachment_id": null, "text": "Historical notes:\n\n(In reply to Mark Thomas from comment #2)\n> I have patched 8.0.x and 7.0.x so the filter is only added if a web\n> application has active WebSocket Endpoints. I think there is still merit in\n> disabling the SCI since that will remove the need for the annotation scan.\n\n1. The change described above was later reverted because of a regression: it broke programmatic configuration of endpoints.\n\nThe regression was reported in \"[VOTE] Release Apache Tomcat 8.0.0-RC9\" thread.\n\nhttp://tomcat.markmail.org/thread/2zmfqvveg3xhegwq\n\nThis is the reason why the WsFilter installation cannot be skipped in a web application that uses websockets.\n\nThe change: r1551356\nReverting the change: r1552076\n\n\n2. As part of review for this issue, performance of WsFilter was improved in r1552083. Change log message: \"Don't do the expensive 'Is this a WebSocket upgrade request check' if no endpoints have been registered\"\n\n(In reply to Mark Thomas from comment #3)\n> A new option, containerSciFilter, has been added to the Context in 8.0.x and\n> will be included in 8.0.0 onwards.\n\n\n3. Note, that \"containerSciFilter\" option can be used to explicitly disable WebSocket support for a selected web application (or globally via the default context configuration file).\n\nhttp://tomcat.apache.org/tomcat-8.0-doc/config/context.html\n\nhttp://wiki.apache.org/tomcat/HowTo/FasterStartUp", "id": 183831, "time": "2015-07-01T12:14:23Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2015-07-01T12:14:23Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "chengongmo@126.com", "attachment_id": 35644, "id": 203034, "time": "2018-01-03T09:53:19Z", "bug_id": 61960, "creation_time": "2018-01-03T09:53:19Z", "is_private": false, "text": "Created attachment 35644\nA export template in chinese\n\n2018/01/03T17:46:39 [] [http-nio-8080-exec-7] ERROR c.v.i.a.c.a.AssetCategoryQueryController - Rule M2.4 exception : this error should NEVER happen! Please raise a bug at https://bz.apache.org/bugzilla/enter_bug.cgi?product=POI and attach a file that triggers it, thanks!\norg.apache.poi.openxml4j.exceptions.OpenXML4JRuntimeException: Rule M2.4 exception : this error should NEVER happen! Please raise a bug at https://bz.apache.org/bugzilla/enter_bug.cgi?product=POI and attach a file that triggers it, thanks!\n\tat org.apache.poi.openxml4j.opc.internal.ContentTypeManager.getContentType(ContentTypeManager.java:343)\n\tat org.apache.poi.openxml4j.opc.internal.ContentTypeManager.removeContentType(ContentTypeManager.java:256)\n\tat org.apache.poi.openxml4j.opc.OPCPackage.removePart(OPCPackage.java:958)\n\tat org.apache.poi.openxml4j.opc.PackagePart.getOutputStream(PackagePart.java:522)\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.commit(XSSFWorkbook.java:1687)\n\tat org.apache.poi.POIXMLDocumentPart.onSave(POIXMLDocumentPart.java:464)\n\tat org.apache.poi.POIXMLDocument.write(POIXMLDocument.java:211)\n\tat com.valuedaas.info.asset.controller.assetquery.AssetCategoryQueryController.export(AssetCategoryQueryController.java:314)\n\tat com.valuedaas.info.asset.controller.assetquery.AssetCategoryQueryController$$FastClassBySpringCGLIB$$80e5b13d.invoke(<generated>)\n\tat org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204)\n\tat org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:738)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157)\n\tat org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:52)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:168)\n\tat org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92)\n\tat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)\n\tat org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:673)\n\tat com.valuedaas.info.asset.controller.assetquery.AssetCategoryQueryController$$EnhancerBySpringCGLIB$$4dd9610d.export(<generated>)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205)\n\tat org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:133)\n\tat org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:97)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827)\n\tat org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738)\n\tat org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:967)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:901)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)\n\tat org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:861)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:635)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:742)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat com.valuedaas.info.asset.common.filter.UserAuthFilter.doFilter(UserAuthFilter.java:90)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:108)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:81)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.session.web.http.SessionRepositoryFilter.doFilterInternal(SessionRepositoryFilter.java:167)\n\tat org.springframework.session.web.http.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:80)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:478)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:799)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1457)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:748)\n\n\n\n\ncode:\n\n\n// \u5faa\u73af\u67e5\u8be2\u7ed3\u679c\n\t\tFileInputStream fis = null;\n\t\tInputStream is = null;\n\t\tWorkbook wb = null;\n\t\tMongoCursor<Document> cursor = null;\n\t\ttry {\n\t\t\t\n\t\t\t\n\t\t\tis = new FileInputStream(new File(\"C:\\\\Users\\\\chenhua\\\\git\\\\information-backend\\\\target\\\\\u653f\u52a1\u4fe1\u606f\u8d44\u6e90\u76ee\u5f55-\u6a21\u677f.xlsx\"));\n\t\t\t\n//\t\t\tis = new FileInputStream(new File(Class.class.getClass().getResource(\"/\").getPath() + \"/\u653f\u52a1\u4fe1\u606f\u8d44\u6e90\u76ee\u5f55-\u6a21\u677f.xlsx\") );\n\t\t\twb = new XSSFWorkbook(is);\n\t\t\tSheet sheet = wb.getSheetAt(0); // \u53ea\u5904\u7406\u7b2c\u4e00\u4e2asheet\n\t\t\tint rowNum = 2;\n\t\t\t// \u666e\u901a\u5355\u5143\u683c\n\t\t\tXSSFCellStyle normallCellStyle = (XSSFCellStyle) wb.createCellStyle();\n\t\t\tnormallCellStyle.setAlignment(CellStyle.VERTICAL_CENTER);\n\t\t\t// style.setWrapText(true);\n\t\t\tnormallCellStyle.setBorderBottom(CellStyle.BORDER_THIN);\n\t\t\tnormallCellStyle.setBorderLeft(CellStyle.BORDER_THIN);\n\t\t\tnormallCellStyle.setBorderRight(CellStyle.BORDER_THIN);\n\t\t\tnormallCellStyle.setBorderTop(CellStyle.BORDER_THIN);\n\t\t\tnormallCellStyle.setDataFormat(wb.createDataFormat().getFormat(\"#,##0\"));// \u8fd9\u6837\u5199\u767e\u5206\u767e\u53d8\u6210\u8d27\u5e01\n\n\t\t\tcursor = deptInfoAssetMgmtService.mongoCollection().aggregate(pipeline).batchSize(200).iterator();\n\t\t\twhile (cursor.hasNext()) {\n\t\t\t\trowNum++;\n\t\t\t\tDocument d = cursor.next();\n\t\t\t\tRow row = sheet.getRow(rowNum);\n\t\t\t\trow.getCell(infoAssetSn).setCellValue(rowNum - 2);\n\t\t\t\tString categoryKey = d.getString(DeptInfoAsset.CATEGORY);\n\t\t\t\tString categoryName = categoryMap.get(categoryKey);\n\t\t\t\trow.getCell(infoAssetCategoryIndex).setCellValue(categoryName);\n\t\t\t\t// String subjectKey = d.getString(DeptInfoAsset.SUBJECT);\n\t\t\t\t// String subjectName = \"\";\n\t\t\t\t// if (categoryKey.equals(\"1\")) { // \u6839\u636e\u4e00\u7ea7\u5206\u7c7b\u4e0d\u540c\uff0c\u91c7\u7528\u4e0d\u540c\u7684 \u4e8c\u7ea7\u5206\u7c7b\u5b57\u5178\n\t\t\t\t// subjectName = jichuSubCategory.getOrDefault(subjectKey, \"\");\n\t\t\t\t// } else if (categoryKey.equals(\"2\")) {\n\t\t\t\t// subjectName = zhutiSubCategory.getOrDefault(subjectKey, \"\");\n\t\t\t\t// } else if (categoryKey.equals(\"3\")) {\n\t\t\t\t// subjectName = bumenSubCategory.getOrDefault(subjectKey, \"\");\n\t\t\t\t// }\n\t\t\t\t// row.getCell(infoAssetSubjectIndex).setCellValue(subjectName);\n\t\t\t\trow.getCell(infoAssetNameIndex).setCellStyle(normallCellStyle);\n\t\t\t\trow.getCell(infoAssetNameIndex).setCellValue(d.getString(DeptInfoAsset.NAME));\n\t\t\t\trow.getCell(infoAssetNoIndex).setCellStyle(normallCellStyle);\n\t\t\t\trow.getCell(infoAssetNoIndex).setCellValue(d.getString(DeptInfoAsset.NO));\n\n\t\t\t\twb.write(new FileOutputStream(new File(exportFilePath)));\n\t\t\t\twb.close();\n\t\t\t}\n\n\nerror occur at this line: wb.write(new FileOutputStream(new File(exportFilePath)));"}, {"count": 1, "tags": [], "text": "version is  3.14  , spring boot si  1.5.7.RELEASE", "attachment_id": null, "bug_id": 61960, "id": 203035, "time": "2018-01-03T09:56:42Z", "creator": "chengongmo@126.com", "creation_time": "2018-01-03T09:56:42Z", "is_private": false}, {"count": 2, "tags": [], "creator": "chengongmo@126.com", "attachment_id": null, "text": "version is  3.14  , spring boot si  1.5.7.RELEASE", "id": 203036, "time": "2018-01-03T09:57:55Z", "bug_id": 61960, "creation_time": "2018-01-03T09:57:55Z", "is_private": false}, {"count": 3, "tags": [], "creator": "Alain.Bearez@cua.li", "attachment_id": null, "text": "It seems that your code is closing your workbook inside the while loop. Being so, on second attempt to get a row from your sheet, the exception is raised since no reading is allowed from a closed document.\n\nI recommend three actions:\n  1. update your dependencies to POI 3.17;\n  2. move the two last lines of the while loop outside of the loop;\n  3. report about your progress on this ticket.", "id": 203113, "time": "2018-01-06T03:28:14Z", "bug_id": 61960, "creation_time": "2018-01-06T03:28:14Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 38376, "text": "The code that increments _jspx_push_body_count_XXX[0], which is the count of the\nnumber of outstanding calls to _jspx_page_context.pushBody() within a try block,\nis properly within the conditional that is true only if doStartTag() returns\nEVAL_BODY_INCLUDE. The corresponding code that decrements the same variable,\nhowever, is not within the corresponding conditional, although the call to\n_jspx_page_context.popBody() is. The outstanding count may therefore be wrong,\nand the code that pops these extra BodyContents in the finally block pops too\nfew. In the following Jasper-generated code snippet, note that\n_jspx_push_body_count_rwc_dbTry_0[0]++ on the third line is conditional, but\n_jspx_push_body_count_rwc_dbTry_0[0]-- on the last line is not.\n\nJasper-generated code snippet:\n\nif (_jspx_eval_rwc_formPhase_0 != javax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE) {\nout = _jspx_page_context.pushBody();\n_jspx_push_body_count_rwc_dbTry_0[0]++;\n_jspx_th_rwc_formPhase_0.setBodyContent((javax.servlet.jsp.tagext.BodyContent) out);\n_jspx_th_rwc_formPhase_0.doInitBody();\n}\ndo {\n...\n\nint evalDoAfterBody = _jspx_th_rwc_formPhase_0.doAfterBody();\nif (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)\nbreak;\n} while (true);\nif (_jspx_eval_rwc_formPhase_0 != javax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE)\nout = _jspx_page_context.popBody();\n_jspx_push_body_count_rwc_dbTry_0[0]--;  // THIS SHOULD BE IN THE IF BLOCK!", "id": 84971, "time": "2006-01-25T05:37:05Z", "creator": "apache@deigh.com", "creation_time": "2006-01-25T05:37:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 38376, "attachment_id": 17500, "id": 84974, "time": "2006-01-25T05:50:59Z", "creator": "apache@deigh.com", "creation_time": "2006-01-25T05:50:59Z", "is_private": false, "text": "Created attachment 17500\nChange to Generator.java."}, {"count": 2, "tags": [], "bug_id": 38376, "attachment_id": null, "text": "Seems like a good catch.  When I go to implement it, I see Generator.java has\nchanged since you reported this, and now the line numbers in your patch don't\nmatch.  There are two possible matching sections in the file, one of which seems\nto have a proper } closure, the other doesn't, but that second one has what\nwould become an extra closure outside the if clause.  If you get a chance,\nplease take a look at the current SVN HEAD version and submit an updated patch.\n Thanks!", "id": 87982, "time": "2006-04-13T20:15:11Z", "creator": "yoavs@computer.org", "creation_time": "2006-04-13T20:15:11Z", "is_private": false}, {"count": 3, "tags": [], "creator": "apache@deigh.com", "text": "Comment on attachment 17500\nChange to Generator.java.\n\n--- Generator.java.orig 2006-04-13 16:24:25.164043200 -0400\n+++ Generator.java\t2006-04-13 16:26:05.808763200 -0400\n@@ -2278,7 +2278,7 @@\n\t\t     out.printin(\"if (\");\n\t\t     out.print(tagEvalVar);\n\t\t     out.println(\n-\t\t\t \" !=\njavax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE)\");\n+\t\t\t \" != javax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE)\n{\");\n\t\t     out.pushIndent();\n\t\t     out.printil(\"out = _jspx_page_context.popBody();\");\n\t\t     if (n.implementsTryCatchFinally()) {\n@@ -2289,6 +2289,7 @@\n\t\t\t out.println(\"[0]--;\");\n\t\t     }\n\t\t     out.popIndent();\n+\t\t     out.printil(\"}\");\n\t\t }\n\n\t\t out.popIndent(); // EVAL_BODY", "id": 87992, "time": "2006-04-13T20:43:46Z", "bug_id": 38376, "creation_time": "2006-04-13T20:43:46Z", "is_private": false, "attachment_id": 17500}, {"count": 4, "tags": [], "bug_id": 38376, "attachment_id": 17500, "text": "Comment on attachment 17500\nChange to Generator.java.\n\n--- Generator.java.orig 2006-04-13 16:24:25.164043200 -0400\n+++ Generator.java\t2006-04-13 16:26:05.808763200 -0400\n@@ -2278,7 +2278,7 @@\n\t\t     out.printin(\"if (\");\n\t\t     out.print(tagEvalVar);\n\t\t     out.println(\n-\t\t\t \" !=\njavax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE)\");\n+\t\t\t \" != javax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE)\n{\");\n\t\t     out.pushIndent();\n\t\t     out.printil(\"out = _jspx_page_context.popBody();\");\n\t\t     if (n.implementsTryCatchFinally()) {\n@@ -2289,6 +2289,7 @@\n\t\t\t out.println(\"[0]--;\");\n\t\t     }\n\t\t     out.popIndent();\n+\t\t     out.printil(\"}\");\n\t\t }\n\n\t\t out.popIndent(); // EVAL_BODY", "id": 87994, "time": "2006-04-13T20:45:41Z", "creator": "apache@deigh.com", "creation_time": "2006-04-13T20:45:41Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 38376, "attachment_id": 18096, "id": 87996, "time": "2006-04-13T20:49:44Z", "creator": "apache@deigh.com", "creation_time": "2006-04-13T20:49:44Z", "is_private": false, "text": "Created attachment 18096\nChange to Generator.java for 5.5.x HEAD\n\nUpdated for SVN HEAD as of today."}, {"count": 6, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "id": 87998, "time": "2006-04-13T20:56:24Z", "bug_id": 38376, "creation_time": "2006-04-13T20:56:24Z", "is_private": false, "text": "OK, thank you, patch applied."}]
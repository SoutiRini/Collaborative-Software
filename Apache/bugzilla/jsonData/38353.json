[{"attachment_id": null, "tags": [], "bug_id": 38353, "is_private": false, "count": 0, "id": 84877, "time": "2006-01-23T07:42:44Z", "creator": "anupamav@aztec.soft.net", "creation_time": "2006-01-23T07:42:44Z", "text": "We are not able to store large files > 2GB when we use File Content Storage\n(TxFileContentStore Storage).\nAny file less then 2GB we are able to store into file system successfully.\n\nWhen storing >2GB, we encounter the below pasted exception:\n\norg.apache.slide.common.ServiceAccessException: Service TxFileStore at E:/Textup\nloadtest/slide/store/content  working on E:/Textuploadtest/slide/work/content ac\ncess error : Thread-19-1137482059804-60: Failed to undo change / create of '/113\n7481500664.54_1.0' (ERR_SYSTEM)org.apache.slide.common.ServiceAccessException: S\nervice TxFileStore at E:/Textuploadtest/slide/store/content  working on E:/Textu\nploadtest/slide/work/content access error : Thread-19-1137482059804-60: Failed t\no undo change / create of '/1137481500664.54_1.0' (ERR_SYSTEM)\n        at org.apache.slide.store.txfile.AbstractTxFileStoreService.throwInterna\nlError(AbstractTxFileStoreService.java:433)\n        at org.apache.slide.store.txfile.TxFileContentStore.storeRevisionContent\n(TxFileContentStore.java:127)\n        at org.apache.slide.store.txfile.TxFileContentStore.createRevisionConten\nt(TxFileContentStore.java:85)\n        at org.apache.slide.store.AbstractStore.createRevisionContent(Unknown So\nurce)\n        at org.apache.slide.store.ExtendedStore.createRevisionContent(Unknown So\nurce)\n        at org.apache.slide.store.BindingStore.createRevisionContent(BindingStor\ne.java:556)\n        at org.apache.slide.store.BindingStore.createRevisionContent(BindingStor\ne.java:561)\n        at org.apache.slide.content.ContentImpl.create(ContentImpl.java:538)\n        at com.hyperion.eie.common.cms.WebdavPutMethod.putNewResource(Unknown So\nurce)\n        at com.hyperion.eie.common.cms.WebdavPutMethod.run(Unknown Source)\n        at com.hyperion.eie.common.cms.WebdavPutMethod.executeMethod(Unknown Sou\nrce)\n        at com.sample.fileContent.Repository.uploadFile(Repository.java)\n\nWhen debugging the slide code for the same we came to know the exception are \nthrown in the below code for the condition (if (contentLength != -1 && \ncontentBytes != contentLength)), basically the contentLenght & contentBytes are \nnot matching which should be same to store the file.\n\n/*\nIn TxFileContentStore.java there are two parameters:\nlong contentBytes = FileHelper.copy(is, os);\nlong contentLength = revisionDescriptor.getContentLength();\nAnd a condition:\nif (contentLength != -1 && contentBytes != contentLength) \n{\n   rm.deleteResource(getActiveTxId(), revisionUri);\n   throwInternalError(\"Content length does not match expected\");\n}    \n*/\n\nWhen the above condition(contentLength and contentBytes) fails, the flow will \ngo to delete the resource(rm.deleteResource) which is not yet stored in \nrepository and the exception what we pasted above is thrown from \nrm.deleteResource() which is not actually the real cause to store large files. \nSo the actuall cause what we found is value of the contentLength and \ncontentBytes are not matching.\n\nPlease let us know if any one has already faced/fixed this issue in Slide2.0.\nWe are also trying to fix this, but it would help us if any one has already \nsolution for this."}, {"count": 1, "tags": [], "bug_id": 38353, "text": "When we commented the below code in In TxFileContentStore.java of method \nstoreRevisionContent():\n\nif (contentLength != -1 && contentBytes != contentLength) \n{\n   rm.deleteResource(getActiveTxId(), revisionUri);\n   throwInternalError(\"Content length does not match expected\");\n}    \n\nWe were able to store on to the file system above 6 GB.\nDoes commenting this part of the code affect the normal functioning of the \nSlide2.0.", "id": 84878, "time": "2006-01-23T07:51:36Z", "creator": "anupamav@aztec.soft.net", "creation_time": "2006-01-23T07:51:36Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 38353, "is_private": false, "text": "I envountered this problem almost one and a half year ago. One reason was that\nthe content-length was read as int (which overflows at 2147483647 byte, almost 2GB).\nBut after patching all Slide sources to use long the problem remained, so I\nguess this is a bug in Tomcat (which I was using).", "id": 84879, "time": "2006-01-23T08:00:18Z", "creator": "sven.pfeiffer@innoface.de", "creation_time": "2006-01-23T08:00:18Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 38353, "is_private": false, "count": 3, "id": 84984, "time": "2006-01-25T13:38:29Z", "creator": "anupamav@aztec.soft.net", "creation_time": "2006-01-25T13:38:29Z", "text": "The Problem we are facing is because InputStraem.available() returns a maximum \nvalue of 2147483647.And for 2.5GB it crosses this.\nDo we have any alternative for calculating the number of bytes for the \nInputStream."}, {"count": 4, "tags": [], "text": "java.lang.reflect.UndeclaredThrowableException\n        at $Proxy0.getContentLength(Unknown Source)\n        at org.apache.slide.webdav.method.PutMethod.executeRequest\n(PutMethod.java:300)\n        at org.apache.slide.webdav.method.AbstractWebdavMethod.run\n(AbstractWebdavMethod.java:405)\n        at org.apache.slide.webdav.WebdavServlet.service\n(WebdavServlet.java:155)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at rogatkin.web.WebAppServlet$SimpleFilterChain.doFilter\n(WebAppServlet.java:1045)\n        at org.apache.slide.webdav.filter.LogFilter.doFilter\n(LogFilter.java:141)\n        at rogatkin.web.WebAppServlet$SimpleFilterChain.doFilter\n(WebAppServlet.java:1042)\n        at rogatkin.web.WebAppServlet$WebAppContextFilter.doFilter\n(WebAppServlet.java:942)\n        at rogatkin.web.WebAppServlet$SimpleFilterChain.doFilter\n(WebAppServlet.java:1042)\n        at rogatkin.web.WebAppServlet.service(WebAppServlet.java:402)\n        at Acme.Serve.Serve$ServeConnection.runServlet(Serve.java:2011)\n        at Acme.Serve.Serve$ServeConnection.parseRequest(Serve.java:1989)\n        at Acme.Serve.Serve$ServeConnection.run(Serve.java:1827)\n        at java.lang.Thread.run(Thread.java:620)\nCaused by: java.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:589)\n        at rogatkin.web.WebAppServlet$WebAppContextFilter$1.invoke\n(WebAppServlet.java:990)\n        ... 15 more\nCaused by: java.lang.NumberFormatException: For input string: \"3447844432\"\n        at java.lang.NumberFormatException.forInputString\n(NumberFormatException.java:48)\n        at java.lang.Integer.parseInt(Integer.java:459)\n        at java.lang.Integer.parseInt(Integer.java:497)\n        at Acme.Serve.Serve$ServeConnection.getIntHeader(Serve.java:2499)\n        at Acme.Serve.Serve$ServeConnection.getContentLength(Serve.java:2178)\n        ... 20 more", "is_private": false, "bug_id": 38353, "id": 87657, "time": "2006-04-07T08:42:45Z", "creator": "jaddressbook@gmail.com", "creation_time": "2006-04-07T08:42:45Z", "attachment_id": null}]
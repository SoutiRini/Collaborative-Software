[{"count": 0, "tags": [], "bug_id": 42849, "attachment_id": null, "text": "In the workers definition file (specified by the JkWorkersFile property in the\nhttpd.conf) there is a list of workers mapped to a list of their respective\nhosts to forward to.  I.e. \n\nworker.list=foo, bar, baz\n\nworker.foo.port=16013\nworker.foo.host=foo_host\nworker.foo.type=ajp13\n\nworker.bar.port=16013\nworker.bar.host=bar_host\nworker.bar.type=ajp13\n\nworker.baz.port=16013\nworker.baz.host=baz_host\nworker.baz.type=ajp13\n\n\nIf one of the hosts which is specified cannot be resolved (lets say in this case\nit is baz_host), then the following statement is printed in the mod_jk.log file\n\najp_validate::jk_ajp_common.c (2001): worker baz contact is 'baz_host:23013'\najp_validate::jk_ajp_common.c (2010): can't resolve tomcat address baz_host\najp_validate::jk_ajp_common.c (2013): invalid host and port baz_host 23013\najp_destroy::jk_ajp_common.c (2215): up to 0 endpoints to close\nwc_create_worker::jk_worker.c (161): validate failed for baz\nbuild_worker_map::jk_worker.c (259): failed to create worker baz\nclose_workers::jk_worker.c (215): close_workers will destroy worker foo\najp_destroy::jk_ajp_common.c (2215): up to 1 endpoints to close\nclose_workers::jk_worker.c (215): close_workers will destroy worker bar\najp_destroy::jk_ajp_common.c (2215): up to 1 endpoints to close\n\n\nWhich means that all workers are now destroyed instead of just that single\nworker (which seems a bit overkill).", "id": 105258, "time": "2007-07-10T17:13:28Z", "creator": "jerrold.poh@orionhealth.com", "creation_time": "2007-07-10T17:13:28Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 42849, "attachment_id": null, "is_private": false, "id": 105259, "time": "2007-07-10T17:14:54Z", "creator": "jerrold.poh@orionhealth.com", "creation_time": "2007-07-10T17:14:54Z", "text": "Forgot to add, version of mod_jk is 1.2.23"}, {"count": 2, "tags": [], "bug_id": 42849, "attachment_id": null, "text": "This behaviour is intended. If a name of a target worker is not resolvable \nduring startup, we prefer not to startup at all. So the destruction of the \nworkers is just a side effect of aborting the Apache startup.\n\nIf we could resolve the names once (and finish startup), we'll nor resolve \nagain during normal operations.\n\nIn our experience logging a failed resolution for a worker during startup and \ncontinue stratup in many cases will make administrators unaware of the problem.\n", "id": 105326, "time": "2007-07-12T07:22:34Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-07-12T07:22:34Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 42849, "attachment_id": null, "text": "I think the point here is that startup isn't aborted (the log excerpt doesn't\nshow this).\nWhat happens is that after the workers are shut down, Apache startup continues,\nleaving mod_jk in an inconsistent state.\nA request for a URI that should map to a worker then enters mod_jk, goes through\nthe URI -> Worker mapping process, and then fails to find the worker identified.\n\nSo what is happening is precisely the situation that we're trying to avoid -\nstarting Apache with a broken configuration.\n\nThis is with Apache 2.0.52 on CentOS 4, so it's a pretty standard setup.\n", "id": 105430, "time": "2007-07-15T02:26:27Z", "creator": "Tim.Whittington@orionhealth.com", "creation_time": "2007-07-15T02:26:27Z", "is_private": false}, {"count": 4, "tags": [], "creator": "mturk@apache.org", "text": "Yes, we should treat that the same way as misconfiguration or\nentering invalid directives, because it actually is and refusing\nto load the mod_jk in that case.\nBTW the Httpd itself won't start if you provide an invalid IP address\nor a port already occupied for example, so disabling mod_jk or even entire\nhttpd is legitimate thing to do.\n\n", "id": 105431, "time": "2007-07-15T02:57:30Z", "bug_id": 42849, "creation_time": "2007-07-15T02:57:30Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "mturk@apache.org", "text": "After a second thought, mod_jk still needs to load.\nThe error.log entry and probably console output should be enough.\nIt should behave in the same way as for example configuring\nthe wrong path wor the Directory or WirtualHost root.\nLog that and continue. Httpd will return 404 in that resource is requested.\n\nSo I think we are fine with what we have right now.\nThe worker(entire balancer) is disabled as well as his mappings.\n", "id": 105432, "time": "2007-07-15T03:12:25Z", "bug_id": 42849, "creation_time": "2007-07-15T03:12:25Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 42849, "is_private": false, "text": "Which was the web server, where the behaviour got observed?\n\nActually we implemented both variants:\n\nApache 2.x: any validation failure will make wc_open() return JK_FALSE and\nApache will log an error and *not* start.\n\nApache 1.3: only logs an error, but does start up. Worker initialization even\nfor the good ones might not be done!\n\nIIS: Not sure.\n\nNetscape: Codes looks like we only log a line, so seems to be the same as for\nApache 1.3\n\nI would prefer to not start up. It is a problem, that can be detected during\nstartup. As such ir differs from typos in context URLs. Since we can detect the\nproblem during startup, we should tell people what's wrong and not do the startup.\n\nI think, that Apache 2.x does it OK, we don't have it in Apache 1.3 primarily\nfor historic reasons, because the init hook does not allow return values. We can\nuse out jk_error_exit() function nevertheless.\n\nI'll patch it for Apache 1.3 if noone objects. Mladen? Anyone else?", "id": 105668, "time": "2007-07-16T06:28:07Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-07-16T06:28:07Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 42849, "is_private": false, "text": "No objections.\n\nNot sure for IIS if we should or could force the entire service\nshutdown. However we can retun 404 from filter if init failed.", "id": 105682, "time": "2007-07-16T10:20:46Z", "creator": "mturk@apache.org", "creation_time": "2007-07-16T10:20:46Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 42849, "attachment_id": null, "text": "Apache 1.3: fixed in r556916 (don't startup if mod_jk has an initialization error)\n\nIIS: fixed in r556836 (return HTTP status 500 if mod_jk has an initialization error)\n\nChecked for Netscape and Apache httpd 2.x: Both already do not startup in case\nof an initialization error.\n\nChanges will be released as part of 1.2.24.\n", "id": 105715, "time": "2007-07-17T05:59:36Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-07-17T05:59:36Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 42849, "attachment_id": null, "text": "Move a couple of fixed JK issues from resolved to closed.", "id": 112388, "time": "2008-01-01T16:32:29Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-01T16:32:29Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "javier.durante@mercadolibre.com", "text": "I'm getting a low percent of requests failed due to an exception in the org/apache/tomcat/util/http/CookieSupport class.\n\nhere is the code section:\n\n   public static final boolean isV0Separator(final char c) {\n        if (c < 0x20 || c >= 0x7f) {\n            if (c != 0x09) {\n                throw new IllegalArgumentException(\n                        \"Control character in cookie value or attribute.\");\n            }\n        }\n\n        return V0_SEPARATOR_FLAGS[c];\n    }\n\nI believe that the problem is in the Cookie class: org/apache/tomcat/util/http/Cookies, in the \"processCookieHeader\" method line 340.\n\nI'm using the ALLOW_HTTP_SEPARATORS_IN_V0 flag, but the call to the isV0Separator method is before that, so it gets the Exception and then it cannot check the flag.\n\nIt is possible to ignore this cookies? They are from a external domain so I cannot modify then, and I don't want to loose request because of this validation, I would like to ignore it.\n\nMy stacktrace is:\n\njava.lang.IllegalArgumentException: Control character in cookie value or attribute.\norg.apache.tomcat.util.http.CookieSupport.isV0Separator (CookieSupport.java:153)\norg.apache.tomcat.util.http.Cookies.processCookieHeader (Cookies.java:340)\n     org.apache.tomcat.util.http.Cookies.processCookies (Cookies.java:168)\n     org.apache.tomcat.util.http.Cookies.getCookieCount (Cookies.java:106)\n\u2026catalina.connector.CoyoteAdapter.parseSessionCookiesId (CoyoteAdapter.java:932)\n\u2026ache.catalina.connector.CoyoteAdapter.postParseRequest (CoyoteAdapter.java:689)\n    org.apache.catalina.connector.CoyoteAdapter.service (CoyoteAdapter.java:403)\n\u2026g.apache.coyote.http11.AbstractHttp11Processor.process (AbstractHttp11Processor.java:1008)\n\u2026ote.AbstractProtocol$AbstractConnectionHandler.process (AbstractProtocol.java:589)\n\u2026apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run (JIoEndpoint.java:310)\n java.util.concurrent.ThreadPoolExecutor$Worker.runTask (ThreadPoolExecutor.java:886)\n     java.util.concurrent.ThreadPoolExecutor$Worker.run (ThreadPoolExecutor.java:908)\n                                   java.lang.Thread.run (Thread.java:662)\n\nThanks", "id": 167790, "time": "2013-06-12T16:05:56Z", "bug_id": 55095, "creation_time": "2013-06-12T16:05:56Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "The HTTP header is not valid and that is before Tomcat even tries to parse it as a cookie header. There is no way to bypass this check and no such option will be added because of the potential security issues associated with control characters in HTTP headers.", "attachment_id": null, "bug_id": 55095, "id": 167791, "time": "2013-06-12T16:32:27Z", "creator": "markt@apache.org", "creation_time": "2013-06-12T16:32:27Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 55095, "text": "I am fine with all of that, but it should not be causing an exception or a stack trace to be logged. It is a client error and should be handled as such, i.e. return a 400 response to the client and perhaps log something at DEBUG level.\n \nCan you please reopen this?", "count": 2, "id": 193985, "time": "2016-09-26T13:26:21Z", "creator": "ian.springer@gmail.com", "creation_time": "2016-09-26T13:26:21Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 55095, "text": "While I agree with your views regarding the exceptions and stack traces, the user community has been extremely sensitive to any changes in this area in the past. Given that this code has been like this for many years (since 7.0.0 over 6 years ago) I'm extremely reluctant to change this at this point in Tomcat 7's lifecycle.\n\nIf you really want to avoid this then you have the option of updating to Tomcat 8 and using the RFC6265 cookie processor which, as well as being better aligned to browser behavior, also logs the first error at INFO and the remainder at DEBUG and ignores invalid headers rather than throwing an exception.", "id": 194003, "time": "2016-09-26T21:32:30Z", "creator": "markt@apache.org", "creation_time": "2016-09-26T21:32:30Z", "is_private": false, "attachment_id": null}]
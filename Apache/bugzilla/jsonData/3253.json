[{"count": 0, "tags": [], "text": "I am tracing a problem that I encountered while using Tomcat related to \nURLEncoding.\nIf you pass the parameter in URL by performing java.net.URLEncoding(SOME-ZH_CN-\ncharacter set string ), Tom cat Failed to decode properly even if you pass the \ncontentType=\"text/html;charSet=gb2312\".\n\nIt seems to me the problem occured while decoding the URL parameters.\nHere is the sequence that happend:\n1. Tomcat does the following in parsing the JSP pages:\n(RequestFacade:160)-return request.getParameter(name); \n   where name = \"jsp_precompile\"\ngetParameter ( String name ) execute :\n(HTTPRequestBase:673- parseParameters();\nIn there all the URL parameter are decoded and stored/cached.\nAt this moment, RequestBase.getCharacterEncoding() always return null.\nNo encoding set, then default encoding are used. \n HTTPRequestBase:618 - encoding = \"ISO-8859-1\";\n\n2. The next step that TomCat does is to performed the following:\nsetContentType(String type); where type = \ntext/html;charset=gb2312\nThis will set the encoding to gb2312\n\n3. When JSP request the parameter by calling \n   request.getParameter(\"mygb2312string\");\nTomcat return the value from cache.\nThe result is unknown character : ???XX???\n\nMy system environment:\n 330% locale\nLANG=zh\nLC_CTYPE=zh\nLC_NUMERIC=zh\nLC_TIME=zh\nLC_COLLATE=zh\nLC_MONETARY=zh\nLC_MESSAGES=zh\nLC_ALL=\n\nSunOS 5.8 Generic sun4u sparc SUNW,Ultra-5_10\n\n\nSee my sample JSP to reproduce the problem at the end.\n\n\n\n\n-- Petrus Handoko\n\n================Sample Test code=============================\n\n<%@ page session=\"false\" contentType=\"text/html;charset=gb2312\" %>\n<%@ page import=\"java.util.*\" %>\n<%@ page import=\"java.net.*\" %>\n<%@ page import=\"java.io.*\" %>\n<%@ page import=\"java.lang.*\" %>\n<html>\n<body>\n<BR><H2>URL encoded test </H2>\n<%\n\tString simplify_1\t= \"\u00d6\u00d0\u00b9\u00fa\u00d3\u00eb\u00c5\u00b7\u00c3\u00cb\u00d6\u00d8\u00bf\u00aa\u00ca\u00c0\u00c3\u00b3\u00cc\u00b8\u00c5\u00d0 \u00bd\u00b9\u00b5\u00e3\";\n\tString simplify_2\t= \"\u00c6\u00e4\u00cb\u00fb\u00d0\u00c2\u00ce\u00c5 \u00d1\u00c5\u00bb\u00a2\u00be\u00ab\u00d1\u00a1\";\n\tout.write(\" <BR>str 1 = \" + simplify_1 );\n\tout.write(\" <BR>str 2= \" + simplify_2 );\n\n\tEnumeration params = request.getParameterNames();\n\tif (params != null) {\n\t\tif ( params.hasMoreElements() )\n\t\t\tout.print(\"<BR><h3>Parameters found: </h3>\");\n\t\tfor ( ;  params.hasMoreElements();) {\n\t\t\tString name = params.nextElement().toString();\n\t\t\tString value = request.getParameter(name);\n\t\t\tout.write(\"<BR>\" + name + \" = \" + value + \"<BR>\");\n\t\t}\n\t}\n\tout.write(\"<BR><H3>Performed URL encoded on the strings using \njava.net.URLEncoded.encode()</h3>\" );\n\tString url1 = URLEncoder.encode(simplify_1);\n\tout.write(\"simplify_1 = \" + url1);\n\tString url2 = URLEncoder.encode(simplify_2);\n\tout.write(\"<BR>simplify_2 = \" + url2);\n%>\n<BR><BR>\n<A href=\"<%= request.getRequestURI() + \"?simplify_1=\" + url1 %>\"><%=simplify_1%>\n</A>\n<BR><A href=\"<%= request.getRequestURI() + \"?simplify_2=\" + url2 %>\"><%\n=simplify_2%>\n</A>\n<BR>\n</BODY>\n</HTML>\n===================Encode========================", "attachment_id": null, "id": 4777, "creator": "phandoko@broadvision.com", "time": "2001-08-23T14:24:03Z", "bug_id": 3253, "creation_time": "2001-08-23T14:24:03Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 3253, "text": "The contentType attribute in the <%@ page %> directive controls what character\nset will be used in the *response* of a JSP page (as well as the character set\nused to interpret Java literal Strings in scriptlets inside the page).  However,\nit does *not* affect the character set used to read request parameters.\n\nThe servlet and JSP specifications state that the default character encoding for\nrequest parameters is ISO_8859_1.  You can change this by calling\n\n  request.setCharacterEncoding(\"gb2312\");\n\nbefore calling request.getParameter() for the first time.\n\nWARNING:  Prior to Tomcat 4.0 nightly build 20010825, Jasper was incorrectly\ncalling request.getParameter() prior to executing your page, so that a call to\nsetCharacterEncoding() would have no effect.  This has been fixed.\n", "id": 4809, "time": "2001-08-24T17:15:02Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-08-24T17:15:02Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 29499, "attachment_id": null, "id": 59026, "time": "2004-06-10T15:24:22Z", "creator": "jglick@apache.org", "creation_time": "2004-06-10T15:24:22Z", "is_private": false, "text": "Reproducible for me in Ant 1.6.0, 1.6.1, and the 1.7 trunk as of a few days ago.\n\nIt seems that the URI attribute on <presetdef> works as documented if you are\nonly presetting attributes. But if you try to preset nested elements while using\na URI, you get an error claiming that the newly defined type does not support\nthe nested element. Presetting a task of a different name with no explicit\nnamespace does not have this problem.\n\nStranger, if you *both* preset using a different name and using a different URI,\nthen try to run both presets, the invocation using the different name works as\nexpected, and the invocation using the different URI fails - but the error\nmessage seems to indicate that it is trying to run the other variant!"}, {"count": 1, "tags": [], "creator": "jglick@apache.org", "attachment_id": 11815, "text": "Created attachment 11815\nTest script; try running targets 'both', 'test-1', and 'test-2'", "id": 59027, "time": "2004-06-10T15:24:56Z", "bug_id": 29499, "creation_time": "2004-06-10T15:24:56Z", "is_private": false}, {"count": 2, "tags": [], "creator": "jglick@apache.org", "attachment_id": 11816, "id": 59028, "creation_time": "2004-06-10T15:26:42Z", "time": "2004-06-10T15:26:42Z", "bug_id": 29499, "text": "Created attachment 11816\nLog of running the three targets using Ant 1.6.1; note failure in test-2, as well as strange failure message in test-2 run as part of both", "is_private": false}, {"count": 3, "tags": [], "bug_id": 29499, "attachment_id": null, "id": 59031, "time": "2004-06-10T16:04:21Z", "creator": "peter.reilly@corvil.com", "creation_time": "2004-06-10T16:04:21Z", "is_private": false, "text": "The first problem is a consequence of the way\nnamespace handling is done in ant 1.6.0 and ant.6.1\n\nOne needs to do:\n\n            <jar destfile=\"test-2.jar\">\n                <fileset dir=\".\" xmlns=\"http://nowhere.net/\">\n                    <include name=\"presetdef-test.xml\"/>\n                </fileset>\n            </jar>\nSince the <fileset> element tree is stored up and applied to\nthe <http://nowhere.net/:jar> task later.\nThe plan for ant 1.6.2 is that namespaced tasks will accept\nnested elements from both the namespace of the task and the\ndefault ant namespace.\nIn this case, your <presetdef> will work.\n\nThe second problem is due to the mechanism of reporting\nthe taskname. The code has an object which may be hidden\nbehind an adaptor. The code does a reverse lookup of this\nin ComponentHelper#getElementName(), which looks like:\n\n    public String getElementName(Object element) {\n        //  PR: I do not know what to do if the object class\n        //      has multiple defines\n        //      but this is for logging only...\n        Class elementClass = element.getClass();\n        for (Iterator i = antTypeTable.values().iterator(); i.hasNext();) {\n            AntTypeDefinition def = (AntTypeDefinition) i.next();\n            if (elementClass == def.getExposedClass(project)) {\n                return \"The <\" + def.getName() + \"> type\";\n            }\n        }\n        return \"Class \" + elementClass.getName();\n    }\n\nIn this case the object given is of the class org.apache.tools.ant.Jar\nwhich is now in the anttypetable three times.\n\n"}, {"count": 4, "tags": [], "creator": "jglick@apache.org", "attachment_id": null, "text": "Indeed, setting the namespace on <fileset> (but not <include>!) seems to work.\n\nThis is contrary to both intuition and the intention of the XML namespace\nrecommendation, I think. It will be some kind of an improvement in 1.6.2 if\n\"namespaced tasks will accept nested elements from both the namespace of the\ntask and the default ant namespace\", though it might be better IMHO to break\ncompatibility and make e.g. <fileset> be meaningful in the Ant namespace only\n(or at least issue a warning about attempting to use it from the task namespace).\n\nWill leave this open as a minor bug re. the misleading error message. Thanks for\nthe quick response.", "id": 59036, "time": "2004-06-10T17:05:34Z", "bug_id": 29499, "creation_time": "2004-06-10T17:05:34Z", "is_private": false}, {"count": 5, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "text": "You are right that this is contrary to both intuition and possibly the\nintention of the XML namespace, however it is the way it is due to\nthe deferral of the processing of the embedded elements, and would\nbe difficult to modify.\n\nThe include element does have the \"http://nowhere.net/\" uri since\nthe parent element sets it as a default namespace uri.\n\nI have fixed the error text, so I will close this bug (also\nreported in bug  31389).", "id": 64155, "time": "2004-09-24T08:56:25Z", "bug_id": 29499, "creation_time": "2004-09-24T08:56:25Z", "is_private": false}]
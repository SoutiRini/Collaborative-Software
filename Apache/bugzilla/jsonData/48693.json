[{"count": 0, "tags": [], "creator": "jeremy.bethmont@gmail.com", "text": "Created attachment 24936\nSource SVG file", "id": 134298, "time": "2010-02-07T23:35:51Z", "bug_id": 48693, "creation_time": "2010-02-07T23:35:51Z", "is_private": false, "attachment_id": 24936}, {"count": 1, "attachment_id": 24937, "bug_id": 48693, "text": "Created attachment 24937\nPNG output", "id": 134299, "time": "2010-02-07T23:37:05Z", "creator": "jeremy.bethmont@gmail.com", "creation_time": "2010-02-07T23:37:05Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 48693, "is_private": false, "id": 134300, "time": "2010-02-07T23:39:36Z", "creator": "jeremy.bethmont@gmail.com", "creation_time": "2010-02-07T23:39:36Z", "tags": [], "text": "If you rasterize a SVG file with the latest SVN version of batik. The resulting PNG file cannot open in IE7.\n\njava -jar batik-rasterizer.jar -m 'image/png' test.svg"}, {"count": 3, "attachment_id": null, "creator": "helder.magalhaes@gmail.com", "text": "(In reply to comment #2)\n> If you rasterize a SVG file with the latest SVN version of batik. The resulting\n> PNG file cannot open in IE7.\n\nJust tested your attached PNG file in IE6 [1], IE7 [2] and IE8 [3] and it displays as expected, both stand-alone and when embedding in a Web page. IE6 doesn't display PNG transparency, but this is a know browser limitation. Note that IE7 also has a few PNG transparency bugs, although in this case nothing is noticed.\n\nYou may be interested in taking a look at the rasterizer options [4], namely \"-bg\", which allows you to specify a background color to be used in the export operation. Note that the PNG rasterizer specifically accepts a special key, KEY_FORCE_TRANSPARENT_WHITE [5], which allows you to perform an additional special trick which I'm not sure if it's enabled by default.\n\nI'm assuming that either your IE or Windows may not be updated or something may be interfering (embedding in a Web page along with a JavaScript framework which is messing things up, for example).\n\nPlease reopen if you can further reproduce. ;-)\n\n\n[1] Internet Explorer 6.0 on Windows XP SP 3\n[2] Internet Explorer 7.0.5730.13 on Windows XP SP 3\n[3] Internet Explorer 8.0.6001.188882 on Windows Vista SP2\n[4] http://xmlgraphics.apache.org/batik/tools/rasterizer.html#using-binary\n[5] http://xmlgraphics.apache.org/batik/javadoc/org/apache/batik/transcoder/image/ImageTranscoder.html#KEY_FORCE_TRANSPARENT_WHITE", "id": 134312, "time": "2010-02-08T04:19:12Z", "bug_id": 48693, "creation_time": "2010-02-08T04:19:12Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "helder.magalhaes@gmail.com", "is_private": false, "text": "Created attachment 24939\nHTML which embeds the PNG attachment (allows verifying transparency)\n\nOne needs to remove the \"txt\" file extension due to Bugzilla security restrictions....", "id": 134313, "time": "2010-02-08T04:21:57Z", "bug_id": 48693, "creation_time": "2010-02-08T04:21:57Z", "attachment_id": 24939}, {"count": 5, "attachment_id": 24941, "bug_id": 48693, "is_private": false, "id": 134315, "time": "2010-02-08T04:24:37Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-02-08T04:24:37Z", "tags": [], "text": "Created attachment 24941\nScreenshot IE6, 7 and 8\n\nScreenshot showing IE6, 7 and 8, allowing to see transparency (due to the PNG being embedded in an HTML page with a red background). As expected, IE6, which doesn't support PNG transparency, displays a white background."}, {"count": 6, "tags": [], "creator": "jeremy.bethmont@gmail.com", "text": "Created attachment 24943\nScreenshot showing the bug on IE7\n\nHere is a screenshot using the attached HTML file on IE6, 7 and 8.\nAs you can see the picture seems \"broken\" on IE7 (Internet Explorer 7.0.5730.13 on Windows XP SP 3)\n\nPlease note that if I use Batik 1.7 to generate test.png it displays correctly on IE7.", "id": 134317, "time": "2010-02-08T04:36:10Z", "bug_id": 48693, "creation_time": "2010-02-08T04:36:10Z", "is_private": false, "attachment_id": 24943}, {"count": 7, "tags": [], "bug_id": 48693, "text": "Created attachment 24958\nScript that shows the chunks of a PNG file (depends on pypng)", "id": 134378, "time": "2010-02-09T18:13:23Z", "creator": "jeremy.bethmont@gmail.com", "creation_time": "2010-02-09T18:13:23Z", "is_private": false, "attachment_id": 24958}, {"count": 8, "attachment_id": null, "bug_id": 48693, "is_private": false, "id": 134379, "time": "2010-02-09T18:20:07Z", "creator": "jeremy.bethmont@gmail.com", "creation_time": "2010-02-09T18:20:07Z", "tags": [], "text": "I wrote a small Python script (attached) that shows the chunks of a PNG file.\n\nHere is the output with a PNG file generated by batik SVN:\n\nchunk IHDR,\tlength 13,\tmd5 d2da018c3994bfb3e53315d832aa5c90\nchunk cHRM,\tlength 32,\tmd5 e4d16d0c3e4564d029f8877a181ff7cb\nchunk gAMA,\tlength 4,\tmd5 84f9762215ca22a918a8ce4836984145\nchunk sRGB,\tlength 1,\tmd5 93b885adfe0da089cdf634904fd59f71\nchunk bKGD,\tlength 6,\tmd5 6aae5f5580123f99090c5338ce4e65ee\nchunk pHYs,\tlength 9,\tmd5 79488bba00d8eec19f396b1d366073fd\nchunk IDAT,\tlength 2636,\tmd5 f56e05afda2506561a91e27de88dd3b7\nchunk IDAT,\tlength 0,\tmd5 d41d8cd98f00b204e9800998ecf8427e\nchunk IDAT,\tlength 0,\tmd5 d41d8cd98f00b204e9800998ecf8427e\nchunk IEND,\tlength 0,\tmd5 d41d8cd98f00b204e9800998ecf8427e\n\nAnd bellow with batik 1.7:\n\nchunk IHDR,\tlength 13,\tmd5 d2da018c3994bfb3e53315d832aa5c90\nchunk cHRM,\tlength 32,\tmd5 e4d16d0c3e4564d029f8877a181ff7cb\nchunk gAMA,\tlength 4,\tmd5 84f9762215ca22a918a8ce4836984145\nchunk sRGB,\tlength 1,\tmd5 93b885adfe0da089cdf634904fd59f71\nchunk bKGD,\tlength 6,\tmd5 6aae5f5580123f99090c5338ce4e65ee\nchunk pHYs,\tlength 9,\tmd5 79488bba00d8eec19f396b1d366073fd\nchunk IDAT,\tlength 2636,\tmd5 f56e05afda2506561a91e27de88dd3b7\nchunk IEND,\tlength 0,\tmd5 d41d8cd98f00b204e9800998ecf8427e\n\nAs you can see, the PNG file generated by batik SVN contains 2 empty IDAT chunks. Otherwise the files are identical (you can check the md5 hashs).\nAgain, the PNG generated by batik 1.7 displays well on IE7 but not the one generated by batik SVN.\n\nI believe this is a bug and PNG files shouldn't contain any empty IDAT chunks so I reopen the ticket.\n\nBest,"}, {"count": 9, "tags": [], "bug_id": 48693, "text": "(In reply to comment #7)\n> Created an attachment (id=24958) [details]\n> Script that shows the chunks of a PNG file (depends on pypng)\n\nNote that running three IE versions in the same OS can lead to weird behavior such as this one. the only recommended way of doing it [1] is through different OS installs (see my previous screenshot, where I use two virtual machine for IE6 and IE7; IE8 is locally available)... ;-)\n\nApart from the above, which may explain the issue in IE7, we should suppress those dummy IDAT chunks. The only thing that currently occurs to me is *maybe* a regression caused by recent modifications (made by Thomas in revision 796596, see bug 46863 also)... Nevertheless, this is only an hypothesis and I'll try to clarify it whenever possible. I've also found similar code [2] which can be used to check for possible improvements to the existing one. :-)\n\n\n[1] http://blogs.msdn.com/ie/archive/2006/11/30/ie6-and-ie7-running-on-a-single-machine.aspx\n[2] http://dmi.ensica.fr/doc/Java/j2sdk-1_4_2-doc/docs/j2h/com/sun/imageio/plugins/png/PNGImageWriter.java.html", "id": 134749, "time": "2010-02-21T15:57:24Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-02-21T15:57:24Z", "is_private": false, "attachment_id": null}, {"count": 10, "attachment_id": 25457, "bug_id": 48693, "text": "Created attachment 25457\nPossible resolution in svn diff format\n\n\nTested locally, not fully regression tested", "id": 136966, "time": "2010-05-19T15:31:46Z", "creator": "jonathanshawwood@gmail.com", "creation_time": "2010-05-19T15:31:46Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "creator": "deweese@apache.org", "text": "Fixed in revision 946961.\nThe IDAT stream should no longer write zero length IDAT secions.", "id": 137011, "time": "2010-05-21T06:01:31Z", "bug_id": 48693, "creation_time": "2010-05-21T06:01:31Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "apachebugzilla@mikecorlett.com", "attachment_id": null, "text": "Using ProxyPass and ReverseProxyPass within a virtual host to pass on all\ntraffic to an internal webserver ( Apache 1.3 for Oracle Application Server ).\nRoughly 1 in 10 requests, be it for pages or images, result in ;\n\nProxy Error\n\nThe proxy server received an invalid response from an upstream server.\nThe proxy server could not handle the request GET\n/pls/pls/portal/url/page/blahblahblah\n\nReason: DNS lookup failure for: test.myservernamewashere.com\n\n----\n\nDebug log looks like ;\n\n[Wed Aug 18 10:43:21 2004] [debug] mod_cache.c(157): cache: no cache - add\ncache_in filter and DECLINE\n[Wed Aug 18 10:43:21 2004] [debug] proxy_http.c(66): proxy: HTTP: canonicalising\nURL //test.myservernamewashere.com/pls/pls/portal/url/page/blahblahblah\n[Wed Aug 18 10:43:21 2004] [debug] mod_proxy.c(416): Trying to run scheme_handler\n[Wed Aug 18 10:43:21 2004] [debug] proxy_http.c(1073): proxy: HTTP: serving URL\nhttp://test.myservernamewashere.com/pls/pls/portal/url/page/blahblahblah?menu=m1open\n[Wed Aug 18 10:43:21 2004] [debug] proxy_http.c(185): proxy: HTTP connecting\nhttp://test.myservernamewashere.com/pls/pls/portal/url/page/blahblahblah?menu=m1open\nto test.myservernamewashere.com:80\n[Wed Aug 18 10:43:21 2004] [error] [client 81.144.201.222] proxy: DNS lookup\nfailure for: test.myservernamewashere.com returned by\n/pls/pls/portal/url/page/blahblahblah, referer:\nhttp://test.myservernamewashere.com/portal/page?_pageid=53,393023&_dad=portal&_schema=PORTAL\n\n------\n\nNotes ;\nMod cache ( memory ) is enabled.\nWe're not using a DNS server, just /etc/hosts, on Sparc Solaris 9\nWe're using name based virtual hosts, not ip addressed based\nThe internal server has the same virtual hostname as the external virtual hostname.\nFull apache config available on request.", "id": 62105, "time": "2004-08-18T10:07:00Z", "bug_id": 30722, "creation_time": "2004-08-18T10:07:00Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 30722, "text": "Created attachment 12465\npatch to ensure the error message is correct", "id": 62118, "time": "2004-08-18T11:52:50Z", "creator": "nick@webthing.com", "creation_time": "2004-08-18T11:52:50Z", "is_private": false, "attachment_id": 12465}, {"count": 2, "tags": [], "bug_id": 30722, "attachment_id": null, "id": 62119, "time": "2004-08-18T11:53:46Z", "creator": "nick@webthing.com", "creation_time": "2004-08-18T11:53:46Z", "is_private": false, "text": "It could be that apache is perfectly correct.\n\nBut there is an apparent bug: there are two different paths to the same error\nmessage, and in one case the name of the server looked up may be misreported.\n\nDoes the patch help?\n"}, {"count": 3, "attachment_id": null, "creator": "apachebugzilla@mikecorlett.com", "text": "hmmm having trouble with the patch ;\n\nproxy_http.c: In function `ap_proxy_http_determine_connection':\nproxy_http.c:197: error: `uri_hostname' undeclared (first use in this function)\nproxy_http.c:197: error: (Each undeclared identifier is reported only once\nproxy_http.c:197: error: for each function it appears in.)\n\n\nshould it be uri->hostname ?\n\n", "id": 62122, "time": "2004-08-18T12:30:20Z", "bug_id": 30722, "creation_time": "2004-08-18T12:30:20Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "text": "Yep, you're right.\n\nThe patch won't fix your problem; it'll just help diagnose where the problem\nreally is (which may or may not be Apache).", "id": 62131, "time": "2004-08-18T13:49:05Z", "bug_id": 30722, "creation_time": "2004-08-18T13:49:05Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 30722, "text": "Ok, the patch doesn't seem to have made any difference, still getting ;\n\nProxy Error\n\nThe proxy server received an invalid response from an upstream server.\nThe proxy server could not handle the request GET /.\n\nReason: DNS lookup failure: hostname test.myservername.com\n\n.... and in the error log for the virtual host .....\n\n[Wed Aug 25 14:15:01 2004] [error] [client 192.168.1.4] proxy: DNS lookup\nfailure: hostname test.myservername.com returned by  /\n\n\nWe even put the second webserver on the same box, resolving\ntest.myservername.com to it's second ip address, to see if that would work, but\nwe're still getting the dns error every so often.", "id": 62458, "time": "2004-08-25T13:21:04Z", "creator": "apachebugzilla@mikecorlett.com", "creation_time": "2004-08-25T13:21:04Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "chip@force-elite.com", "attachment_id": null, "text": "does hard coding the IP/hostname in /etc/hosts make a difference?  are you sure\nits not something wrong with your DNS server?", "id": 66410, "time": "2004-11-04T03:00:11Z", "bug_id": 30722, "creation_time": "2004-11-04T03:00:11Z", "is_private": false}, {"count": 7, "tags": [], "creator": "apachebugzilla@mikecorlett.com", "attachment_id": null, "text": "No we're not using BIND / DNS at all, just purely the entries in /etc/hosts.\nIt's a solaris box, so it'll be using the local name resolving methods involving\nresolv.conf etc etc, but I guess the error page on Apache generalises the word\n\"DNS\" to mean \"any form of name resolving\" :)\nWe've still got the problem. We've had to change all proxying to ip address\nbased proxying, which considering our backend boxes are all using virtual hosts,\nthis has caused us major problems !\n\nMike", "id": 66444, "time": "2004-11-04T11:05:42Z", "bug_id": 30722, "creation_time": "2004-11-04T11:05:42Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 30722, "text": "The problem is apr_sockaddr_info_get returning some kind of failure.\n\nI'm guessing it's an IPV4 vs IPV6 problem, and that\neither\n  (1) It's actually an APR bug\nor\n  (2) It's a mismatch between your Apache compile, your APR compile,\n      and your system libs.  If you compiled it yourself using\n      configure/make/make install then it's a build error.  If you\n      installed a package, then it's an incompatibility - build it\n      yourself or contact your supplier.\n\nNext diagnostic step would be to print the value of err returned from\napr_sockaddr_info_get in the error message.\n", "id": 66454, "time": "2004-11-04T14:33:09Z", "creator": "nick@webthing.com", "creation_time": "2004-11-04T14:33:09Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "apachebugzilla@mikecorlett.com", "attachment_id": null, "text": "That diagnosis sounds promising.\nWe compile the binaries on a compile box which has the full gcc installed.\nThen the apache directory is copied across to the live production boxes, which\ndoesn't have full gcc, just the gcc libraries.\nThe compile box and production boxes should be identical, but wouldn't surprise\nme if there were differences :)\nIf you can tell me the best way to get values from apr_sockaddr_info_get that\nwould be great.", "id": 66468, "time": "2004-11-04T17:33:24Z", "bug_id": 30722, "creation_time": "2004-11-04T17:33:24Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 30722, "attachment_id": null, "id": 106289, "time": "2007-08-03T08:10:19Z", "creator": "jim@apache.org", "creation_time": "2007-08-03T08:10:19Z", "is_private": false, "text": "This is quite old. Please test/confirm with more recent versions and reopen if needed."}]
[{"count": 0, "tags": [], "creator": "tdecarlo@ssi-corp.com", "text": "The admin webapp is only accessible from the 'localhost'. \nAn attempt to access the admin webapp from another host produces \nthe following error after a successful login to the admin webapp.... \n \n   HTTP Status 400 - Invalid direct reference to form login page \n   type Status report \n   message Invalid direct reference to form login page \n   description The request sent by the client was syntactically incorrect \n   (Invalid direct reference to form login page). \n   Apache Tomcat/4.1.27 \n \nIt appears that the 'redirection to original' does not work, however \nI don't quite understand why the client host would affect this. \n \nTechincal Details regarding the problem....... \n \nThere is a comment in the admin.xml file specifying that remote access \ncan be adjusted via the org.apache.catalina.valves.RemoteAddrValve \nhowever I do not believe this is the issue since it appears that after \n'adjusting' the RemoteAddrValve, one does not even get the admin \nlogin page. \n \nI set debug to 99 in admin.xml....... \n \nUsing a browser on a remote host..... \nClicking on the Tomcat Administrator link takes me to the admin \nlogin page and produces the following in the admin log....... \n \n**** Excerpt from localhost_admin_log **** \n \n2003-10-16 09:59:38 Authenticator[/admin]: Security checking request GET \n/admin \n2003-10-16 09:59:38 Authenticator[/admin]:   Checking constraint \n'SecurityConstraint[Protected Area]' against GET  --> false \n2003-10-16 09:59:38 Authenticator[/admin]:   No applicable constraint located \n2003-10-16 09:59:38 Authenticator[/admin]:  Not subject to any constraint \n2003-10-16 09:59:38 StandardContext[/admin]: Mapping contextPath='/admin' with \nrequestURI='/admin' and relativeURI='' \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying exact match \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying prefix match \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying extension match \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying default match \n2003-10-16 09:59:38 StandardContext[/admin]:  Mapped to servlet 'default' with \nservlet path '' and path info 'null' and update=true \n2003-10-16 09:59:38 Authenticator[/admin]: Security checking request GET \n/admin/ \n2003-10-16 09:59:38 Authenticator[/admin]:   Checking constraint \n'SecurityConstraint[Protected Area]' against GET / --> false \n2003-10-16 09:59:38 Authenticator[/admin]:   No applicable constraint located \n2003-10-16 09:59:38 Authenticator[/admin]:  Not subject to any constraint \n2003-10-16 09:59:38 StandardContext[/admin]: Mapping contextPath='/admin' with \nrequestURI='/admin/' and relativeURI='/' \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying exact match \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying prefix match \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying extension match \n2003-10-16 09:59:38 StandardContext[/admin]:   Trying default match \n2003-10-16 09:59:38 StandardContext[/admin]:  Mapped to servlet 'default' with \nservlet path '/' and path info 'null' and update=true \n2003-10-16 09:59:39 Authenticator[/admin]: Security checking request GET \n/admin/index.jsp \n2003-10-16 09:59:39 Authenticator[/admin]:   Checking constraint \n'SecurityConstraint[Protected Area]' against GET /index.jsp --> true \n2003-10-16 09:59:39 Authenticator[/admin]:  Subject to constraint \nSecurityConstraint[Protected Area] \n2003-10-16 09:59:39 Authenticator[/admin]:  Calling checkUserData() \n2003-10-16 09:59:39 Authenticator[/admin]:   User data constraint has no \nrestrictions \n2003-10-16 09:59:39 Authenticator[/admin]:  Calling authenticate() \n2003-10-16 09:59:39 Authenticator[/admin]: Save request in session \n'7B93E21E9FBE96CE8500B8DA438FA72D' \n2003-10-16 09:59:39 Authenticator[/admin]: Redirect to login page \n'/admin/login.jsp' \n2003-10-16 09:59:39 Authenticator[/admin]:  Failed authenticate() test \n2003-10-16 09:59:40 Authenticator[/admin]: Security checking request GET \n/admin/login.jsp \n2003-10-16 09:59:40 Authenticator[/admin]:   Checking constraint \n'SecurityConstraint[Protected Area]' against GET /login.jsp --> true \n2003-10-16 09:59:40 Authenticator[/admin]:  Subject to constraint \nSecurityConstraint[Protected Area] \n2003-10-16 09:59:40 Authenticator[/admin]:  Calling checkUserData() \n2003-10-16 09:59:40 Authenticator[/admin]:   User data constraint has no \nrestrictions \n2003-10-16 09:59:40 Authenticator[/admin]:  Calling authenticate() \n2003-10-16 09:59:40 Authenticator[/admin]: Requesting login page normally \n2003-10-16 09:59:40 Authenticator[/admin]:  Calling accessControl() \n2003-10-16 09:59:40 Authenticator[/admin]:  Allow access to login page \n/admin/login.jsp \n2003-10-16 09:59:40 Authenticator[/admin]:  Successfully passed all security \nconstraints \n2003-10-16 09:59:40 StandardContext[/admin]: Mapping contextPath='/admin' with \nrequestURI='/admin/login.jsp' and relativeURI='/login.jsp' \n2003-10-16 09:59:40 StandardContext[/admin]:   Trying exact match \n2003-10-16 09:59:40 StandardContext[/admin]:   Trying prefix match \n2003-10-16 09:59:40 StandardContext[/admin]:   Trying extension match \n2003-10-16 09:59:40 StandardContext[/admin]:  Mapped to servlet 'jsp' with \nservlet path '/login.jsp' and path info 'null' and update=true \n \n \n \n \nEntering a valid user & password in the login page, produces the 400 error \nand the following appears in the admin log..... \n \n \n \n**** Excerpt from localhost_admin_log **** \n \n2003-10-16 10:02:23 Authenticator[/admin]: Security checking request POST \n/admin/j_security_check \n2003-10-16 10:02:23 Authenticator[/admin]: Authenticating username 'td' \n2003-10-16 10:02:23 Authenticator[/admin]: Authentication of 'td' was \nsuccessful \n2003-10-16 10:02:23 Authenticator[/admin]: Redirecting to original 'null' \n2003-10-16 10:02:23 Authenticator[/admin]:  Failed authenticate() test \n \n \nHitting login through a browser running on localhost produces the \nfollowing log output.... \n \n**** Excerpt from localhost_admin_log **** \n \n2003-10-16 10:04:07 Authenticator[/admin]: Security checking request POST \n/admin/j_security_check \n2003-10-16 10:04:07 Authenticator[/admin]: Authenticating username 'td' \n2003-10-16 10:04:07 Authenticator[/admin]: Authentication of 'td' was \nsuccessful \n2003-10-16 10:04:07 Authenticator[/admin]: Redirecting to original \n'/admin/index.jsp'", "id": 45786, "time": "2003-10-16T14:12:31Z", "bug_id": 23865, "creation_time": "2003-10-16T14:12:31Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 23865, "text": "This is deliberate. It is enforced using a valve defined in admin.xml\n", "id": 59540, "time": "2004-06-18T23:46:54Z", "creator": "markt@apache.org", "creation_time": "2004-06-18T23:46:54Z", "tags": [], "is_private": false}]
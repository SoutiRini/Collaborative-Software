[{"count": 0, "attachment_id": null, "bug_id": 29978, "text": "I've created an Apt task, and a corresponding compiler adapter which runs apt \nexecutable to kick off the compile.  The task forces the compiler to this \ncompiler adapter, and also forces the forking to true.  In addition, it allows \naddition attributes and subelements for the Apt arguments.  Please let me know \nif there is interest in including this in the core Ant distribution.\n\n<target name=\"compile\">\n      <apt srcdir=\"${src.dir}\"\n           destdir=\"${classes.dir}\"\n           preprocessdir=\"${preprocess.dir}\"\n           debug=\"on\"\n           deprecation=\"off\"\n           optimize=\"on\"\n           includeAntRuntime=\"no\"\n           nocompile=\"false\">\n      </apt>\n\nThis also supports a \"factory\" attribute corresponding to the -factory \nparameter, and a \"factorypathref\" attribute and \"factorypath\" element to\ncorrespond to the -factorypath argument.", "id": 60309, "time": "2004-07-08T16:07:41Z", "creator": "mattinger@yahoo.com", "creation_time": "2004-07-08T16:07:41Z", "tags": [], "is_private": false}, {"attachment_id": 12156, "tags": [], "bug_id": 29978, "text": "Created attachment 12156\nDiffs for existing code to support Apt task", "count": 1, "id": 60803, "time": "2004-07-19T14:07:48Z", "creator": "mattinger@yahoo.com", "creation_time": "2004-07-19T14:07:48Z", "is_private": false}, {"count": 2, "tags": [], "creator": "mattinger@yahoo.com", "text": "Created attachment 12157\n.tar.gz file which contains the new java classes to support the APT compiler.", "id": 60804, "time": "2004-07-19T14:11:27Z", "bug_id": 29978, "creation_time": "2004-07-19T14:11:27Z", "is_private": false, "attachment_id": 12157}, {"count": 3, "attachment_id": 12158, "bug_id": 29978, "text": "Created attachment 12158\n.tar.gz file which contains new source code files.  Please use this one, and not the previously submitted on.", "id": 60805, "time": "2004-07-19T14:19:24Z", "creator": "mattinger@yahoo.com", "creation_time": "2004-07-19T14:19:24Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 29978, "is_private": false, "id": 60979, "time": "2004-07-22T18:30:24Z", "creator": "antoine@apache.org", "creation_time": "2004-07-22T18:30:24Z", "tags": [], "text": "Hello Matthew,\nWould your code not be better as a part of the apt distribution, which already\nincludes ant tasks ?\n\nis this URL the reference concerning apt :\nhttp://www.thiruvathukal.com/papers/act_manual\n\n\"The Apt Compiler Toolkit was designed to address the need for structured,\nefficient,\nportable, and capable tools to prototype language translators and compilers.\"\n\nCheers,\nAntoine"}, {"count": 5, "tags": [], "creator": "ddevienne@lgc.com", "is_private": false, "text": "There might be a bit of confusion here Antoine ;-)\n\nMatt is talking about apt, the JDK 1.5 tool to process the new Annotation \n(Processing Tool). Apt is to Annotations what Javadoc is to Documentation.\n\n--DD", "id": 60983, "time": "2004-07-22T18:48:35Z", "bug_id": 29978, "creation_time": "2004-07-22T18:48:35Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "antoine@apache.org", "is_private": false, "text": "Sorry for the confusion, I have learnt something again.\nAntoine", "id": 60991, "time": "2004-07-22T19:16:28Z", "bug_id": 29978, "creation_time": "2004-07-22T19:16:28Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "stevel@apache.org", "is_private": false, "id": 61633, "creation_time": "2004-08-06T10:41:42Z", "time": "2004-08-06T10:41:42Z", "bug_id": 29978, "text": "Created attachment 12351\nUpdated version of the files; sun format rules, some code fixes, extracted messages for cross-referencing in tests.", "attachment_id": 12351}, {"count": 8, "attachment_id": null, "bug_id": 29978, "text": "Your name for the -s command line argument (i.e. preprocessdir) seems a little \nsub-optimal to me.\n\nHere is a section from apt's help screen\n\n  -d <path>                  Specify where to place processor and javac generate\nd class files\n  -s <path>                  Specify where to place processor generated source f\niles\n\nNow -d uses \"destdir\" inherited from javac task.\n\nIt is pretty hard to build a semantic connection between \"preprocessdir\" and \nthe description of -s. I can't even tell intuitively if \"preprocessdir\" \ncontains inputs or outputs of the task.\n\nCan I suggest \"gensrcdir\" as in \"generated source directory\" as a better name, \nbased on the description of -s above?", "id": 63842, "time": "2004-09-20T04:41:29Z", "creator": "bruce.chapman.nz@gmail.com", "creation_time": "2004-09-20T04:41:29Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "ddevienne@lgc.com", "is_private": false, "id": 63873, "creation_time": "2004-09-20T13:44:27Z", "time": "2004-09-20T13:44:27Z", "bug_id": 29978, "text": "I like \"gensrcdir\" much better too. --DD", "attachment_id": null}, {"count": 10, "attachment_id": null, "bug_id": 29978, "text": "It's called \"preprocessdir\" because the apt task spits out the following help:\n\n  -s <path> Specify where to place processor generated source files\n\nSo, it's where you're preprocessing output ends up before getting compiled.  I \nwould be willing to have it renamed to \"generatedsrcdir\" or something like that \nthough.  It's an easy change for one of the committers to make if they decide \nto commit this code.", "id": 63874, "time": "2004-09-20T13:55:06Z", "creator": "mattinger@yahoo.com", "creation_time": "2004-09-20T13:55:06Z", "tags": [], "is_private": false}, {"count": 11, "attachment_id": null, "bug_id": 29978, "text": "Great.\n\ndo we go for terse (gensrcdir) or verbose (generatedsrcdir)?\n\nNext Questions...\n\n1. Is anyone working on the tests, and javadocs or is that a job that's up-for-\ngrabs? (I wouldn't want to do it if someone else is already active on it)\n\n2. I have an OS project incubating on java.net (rapt), which is specifically \nrelated to apt tool type things. Can I take the patch code here and make it \navailable as an external ant task (is the the right terminology? - I am new to \nant) as part of, or in addition to the rapt library? This is desired both for \nbuilding rapt itself, and as an aid to rapt users who will need to use apt to \ncompile against the rapt library. I am sure they would appreciate an ant task \nto assist them.\n\nMy intention would be to drop it out of rapt once the apt task is available in \na released version of ant. Are there any license issues I need to be careful of?\nDo I need to change the package names, or could I leave them as is? Technical, \nlegal, and general politeness considerations all welcome!\n\nBruce", "id": 63927, "time": "2004-09-20T22:05:48Z", "creator": "bruce.chapman.nz@gmail.com", "creation_time": "2004-09-20T22:05:48Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "creator": "mattinger@yahoo.com", "text": "I don't think it matters whether it's verbose or short attribute names.\nI am not currently working on any test suites for this, as my need for it\nwas purely in the interest of learning about annotations, and the need arose\nto have the ANT task.\n\nAs far as it being part of ANT itself, I think it makes sense to have it as\npart of ANT itself.  The reasoning being that it is part of the core JDK 5.0\nplatform (much like javadoc, etc..), and therefore, if ANT is going to provide\nthe JavaC, and RMI tasks (two different forms of compilation), it should also\nprovide the APT task as well.\n\nI image once it is fully released annotations will be heavily used for things\nlike RMI, EJB, JDBC 4.0, and other tasks (like generating hibernate mappings, \netc...).\n\n\n\n", "id": 63945, "time": "2004-09-21T03:59:05Z", "bug_id": 29978, "creation_time": "2004-09-21T03:59:05Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 29978, "attachment_id": null, "text": "I have checked this in to CVS_HEAD.\n\nNow can we have some test cases please :) From anyone?\n\nBruce, if you want to fork off a copy for your own project till Ant1.7 ships\n \n(a) use a different package name\n(b) use <antlib> to to declare the task and have it live in its own namespace,\nor rename it slightly. \n\nYou may be able to build a JAR that contains just the apt stuff as-is, dont\nchange it and just include it with your code. An interesting experiment, as they\nsay.\n\n", "id": 64841, "time": "2004-10-08T16:45:35Z", "creator": "stevel@apache.org", "creation_time": "2004-10-08T16:45:35Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 29978, "attachment_id": 13052, "text": "Created attachment 13052\nHTML file for inclusion in the ANT manual.  The task list will need to be updated.", "id": 65007, "time": "2004-10-12T20:24:51Z", "creator": "mattinger@yahoo.com", "creation_time": "2004-10-12T20:24:51Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 29978, "is_private": false, "id": 65948, "attachment_id": 13252, "creator": "mike@systemsplanet.com", "creation_time": "2004-10-28T22:15:12Z", "time": "2004-10-28T22:15:12Z", "text": "Created attachment 13252\nProject to create ant-apt.jar to add Apt task to Ant 1.6 - Zip format."}, {"count": 16, "tags": [], "creator": "mike@systemsplanet.com", "is_private": false, "id": 65949, "creation_time": "2004-10-28T22:17:42Z", "time": "2004-10-28T22:17:42Z", "bug_id": 29978, "text": "To add the above Apt task to ant1.6:\n0. download and unzip the above attachment from 10/28/04 22:15\n1. Install ant 1.6\n2. Run ant to create the build/ant-apt.jar\n3. Copy the ant-apt.jar to your %ANT_HOME%/lib path\n4. Run ant -f ant-apt-test.xml to test the install\n\nNote: Apt requires JVM 1.5+\n\n\nThis is a workaround until apt is released with Ant 1.7\n\n", "attachment_id": null}, {"count": 17, "tags": [], "creator": "stevel@apache.org", "text": "I am closing this, as we are pssing the unit tests: <apt> is officially\nfunctional. Thank you!", "id": 72093, "time": "2005-03-09T23:58:12Z", "bug_id": 29978, "creation_time": "2005-03-09T23:58:12Z", "is_private": false, "attachment_id": null}, {"count": 18, "attachment_id": null, "bug_id": 29978, "text": "Thanks to everyone who took the time to help out on the unit tests, additiosn \nand documentation.  It's nice to see this come to life, despite my busy \nschedule.", "id": 72104, "time": "2005-03-10T03:31:33Z", "creator": "mattinger@yahoo.com", "creation_time": "2005-03-10T03:31:33Z", "tags": [], "is_private": false}, {"count": 19, "attachment_id": null, "bug_id": 29978, "text": "I discovered some problems/bugs that are probably linked to\nchanges in the brand new JDK 1.5.0_02. I think I manged to fix one\nproblem but have another problem (see 2 below) that I hope someone can\nhelp with.\n\nThe ant task for apt does NOT work with 1.5.0_02 because:\n1) First of all, the apt method entry point appear to have changed.\nJavap on com.sun.tools.apt.Main gives:\npublic class com.sun.tools.apt.Main extends java.lang.Object{\n   public com.sun.tools.apt.Main();\n   public static void main(java.lang.String[]);\n   public static int process(java.lang.String[]);\n   public static int process(java.io.PrintWriter, java.lang.String[]);\n   public static int process(com.sun.mirror.apt.AnnotationProcessorFactory, jav\na.lang.String[]);\n   public static int process(com.sun.mirror.apt.AnnotationProcessorFactory, jav\na.io.PrintWriter, java.lang.String[]);\n   static {};\n}\n\nNote that there is no method called \"compile\" that is used in\nthe ANT task. There is a method \"process\" that appears to be the one\nto use instead. I tried to replace this in the code and than ran into\nthe next problem below.\n\n2) APT complains about missing the com/sun/mirror/apt/AnnotationProcess\norFactory class even though tools.jar IS on the classpath, even if it\ncan indeed find the main entry point class also in tools.jar AND even\nif the AnnotationProcess\norFactory class is verified to be also present (I can see it using\njavap so it has not disappeared). This strange classpath error can be\nseen below:\n\n     [apt] Compiling 1 source file\n     [apt] An exception has occurred in apt (1.5.0_02). Please file a bug at th\ne Java Developer Connection (http://java.sun.com/webapps/bugreport)  after check\ning the Bug Parade for duplicates. Include your program and the following diagno\nstic in your report.  Thank you.\n     [apt] java.lang.NoClassDefFoundError: com/sun/mirror/apt/AnnotationProcess\norFactory\n     [apt]     at java.lang.ClassLoader.defineClass1(Native Method)\n     [apt]     at java.lang.ClassLoader.defineClass(ClassLoader.java:620)\n     [apt]     at java.security.SecureClassLoader.defineClass(SecureClassLoader\n.java:124)\n     [apt]     at java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\n     [apt]     at java.net.URLClassLoader.access$100(URLClassLoader.java:56)\n     [apt]     at java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n     [apt]     at java.security.AccessController.doPrivileged(Native Method)\n     [apt]     at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n     [apt]     at java.lang.ClassLoader.loadClass(ClassLoader.java:306)\n     [apt]     at java.lang.ClassLoader.loadClass(ClassLoader.java:251)\n     [apt]     at com.sun.tools.apt.comp.Apt.main(Apt.java:287)\n     [apt]     at com.sun.tools.apt.main.JavaCompiler.compile(JavaCompiler.java\n:458)\n     [apt]     at com.sun.tools.apt.main.Main.compile(Main.java:1075)\n     [apt]     at com.sun.tools.apt.main.Main.compile(Main.java:938)\n     [apt]     at com.sun.tools.apt.Main.processing(Main.java:95)\n     [apt]     at com.sun.tools.apt.Main.process(Main.java:43)\n     [apt]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n     [apt]     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAcces\nsorImpl.java:39)\n     [apt]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMet\nhodAccessorImpl.java:25)\n     [apt]     at java.lang.reflect.Method.invoke(Method.java:585)\n     [apt]     at org.apache.tools.ant.taskdefs.compilers.AptCompilerAdapter.ex\necute(Unknown Source)\n     [apt]     at org.apache.tools.ant.taskdefs.Javac.compile(Javac.java:936)\n     [apt]     at org.apache.tools.ant.taskdefs.Javac.execute(Javac.java:758)\n     [apt]     at org.apache.tools.ant.taskdefs.Apt.execute(Unknown Source)\n     [apt]     at org.apache.tools.ant.UnknownElement.execute(UnknownElement.ja\nva:275)\n     [apt]     at org.apache.tools.ant.Task.perform(Task.java:364)\n     [apt]     at org.apache.tools.ant.Target.execute(Target.java:341)\n     [apt]     at org.apache.tools.ant.Target.performTasks(Target.java:369)\n     [apt]     at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n\n     [apt]     at org.apache.tools.ant.Project.executeTargets(Project.java:1062\n)\n     [apt]     at org.apache.tools.ant.Main.runBuild(Main.java:673)\n     [apt]     at org.apache.tools.ant.Main.startAnt(Main.java:188)\n     [apt]     at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n     [apt]     at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\n\nHope someone can fix this.\n\nP.S Note the brand new APT features in 1.5.0_02 like \"\n-XclassesAsDecls          \" that treat both class and source files as\ndeclarations to process. It would be nice if such options can somehow\nbe passed to the ANT task as well.", "id": 73554, "time": "2005-04-11T23:18:34Z", "creator": "mortench2004@yahoo.dk", "creation_time": "2005-04-11T23:18:34Z", "tags": [], "is_private": false}, {"count": 20, "attachment_id": null, "bug_id": 29978, "text": "(In reply to comment #19)\n> I discovered some problems/bugs that are probably linked to\n> changes in the brand new JDK 1.5.0_02. I think I manged to fix one\n> problem but have another problem (see 2 below) that I hope someone can\n> help with.\n\nApt has a -classpath option which it uses to find user class files AND \nAnnotation Processor Factories. each processor factory must extend that class \nthat is not being found, I suspect the error occurs when loading factories.\n\nI suspect your problems is that although tools.jar is on the classpath that apt \nis executing against, it is NOT on the classpath passed as an option in the \nsimulated command line in the process method().\n\nChange your ant task to put tools.jar on ant's classpath argument and it should \nwork.\n\n\nI got caught out by the programmatic interface change as well. Just a comment, \nJSR-269 is looking at defining a pluggable annotation processing API, both a \nmirror, and processing mechanism. So apt is really just a temporary tool, and I \nsuspect mustang (JDK6.0) will have the reference implementation for JSR-269. I \nam not sure if that reference implementation will be called apt or not. It will \nbe different is some ways. Given this probable change, maybe the official ant \ntask should wait till things have settled down somewhat, that is, till the JSR-\n269 reference implementation is at least available in the mustang betas. I am \non the 269 EG, but we haven't looked at what the RI might look like yet. I'll \nendeavour to offer guidance here as best I can given the theoretical secrecy of \nEG proceedings which in practice don't seem to be all that secret under JCP2.6.\n\nHow far off is the next ant release that might incorporate this task? I can't \nsay when 269 will have an RI in beta. I am happy to answer questions wrt \ndeploying the ant task. At the moment it might be best to rename the task to \nsomething like tiger-apt, to keep the \"apt\" namespace clear for whatever the RI \nfor JSR-269 is called, given that even if apt is still called apt in mustang, \nit will be a different beast, and might need to be a different ant task.\n\nBruce", "id": 73556, "time": "2005-04-12T01:05:56Z", "creator": "bruce.chapman.nz@gmail.com", "creation_time": "2005-04-12T01:05:56Z", "tags": [], "is_private": false}, {"count": 21, "tags": [], "bug_id": 29978, "is_private": false, "id": 73557, "attachment_id": null, "creator": "bruce.chapman.nz@gmail.com", "creation_time": "2005-04-12T01:08:58Z", "time": "2005-04-12T01:08:58Z", "text": "(In reply to comment #20\n\n> Change your ant task to put tools.jar on ant's classpath argument and it \n> should work.\n\n\nshould have said\n\nChange your apt task to put tools.jar on ant's classpath argument and it should \nwork.\n\nMy predictive typing fingers stuffed up  :)\n\nB\n\n"}, {"count": 22, "tags": [], "bug_id": 29978, "is_private": false, "id": 73558, "attachment_id": null, "creator": "bruce.chapman.nz@gmail.com", "creation_time": "2005-04-12T01:10:38Z", "time": "2005-04-12T01:10:38Z", "text": "(In reply to comment #21)\n\nBugger:    3rd time lucky?\n\nChange your ant task to put tools.jar on apt's classpath argument and it should \nwork.\n\n"}, {"count": 23, "attachment_id": null, "bug_id": 29978, "is_private": false, "id": 129322, "time": "2009-07-31T05:28:57Z", "creator": "bodewig@apache.org", "creation_time": "2009-07-31T05:28:57Z", "tags": [], "text": "I guess the reasons this has been reopened are obsolete since apt only runs in forked mode now."}]
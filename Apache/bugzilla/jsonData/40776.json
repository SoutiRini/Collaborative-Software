[{"count": 0, "tags": [], "bug_id": 40776, "attachment_id": null, "text": "Hi!\n\nI've come accross the following problem trying to compile Java 5\nclasses with generics using Ant 1.6.5. I've attached the archived project\nwith sample Java classes and a build.xml file.\n\nA clean build of the above project works just fine and compiles\nwithout a problem. If after that, I touch the Test3.java file the\nbuild fails with the following error:\n\n [javac] C:\\src\\appforge\\test\\src\\test\\Test3.java:5: incompatible types\n [javac] found   : test.Base\n [javac] required: test.Sub\n [javac] public Sub p() {return this.getV();}\n [javac] ^\n [javac] 1 error\n\nInitially, I thought that this was a problem with the Java compiler.\nAfter touching Test3.java, I tried running javac manually:\n\njavac -sourcepath src -d bin -g -source 1.5 -target 1.5 src\\test\\*.java\n\nIt turned out that with the above command-line the project compiled\nOK. The project also compiles without a problem in Eclipse 3.2.1.\n\nUpon further experimentation, if I uncomment the method in Test2.java\nfixes the problem. Touching Test3.java does not break the build.\n\nI've been able to reproduce the problem both on Windows XP with JDK 1.5.0_08 and\non RedHat EL4 with 1.5.0_07.\n\nThanks,\nChavdar", "id": 94893, "time": "2006-10-17T09:31:10Z", "creator": "cbotev@gmail.com", "creation_time": "2006-10-17T09:31:10Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 40776, "is_private": false, "text": "Created attachment 19017\nSample project for reproducing the problem", "id": 94894, "time": "2006-10-17T09:32:08Z", "creator": "cbotev@gmail.com", "creation_time": "2006-10-17T09:32:08Z", "attachment_id": 19017}, {"count": 2, "tags": [], "creator": "cbotev@gmail.com", "attachment_id": null, "is_private": false, "id": 94895, "time": "2006-10-17T09:33:46Z", "bug_id": 40776, "creation_time": "2006-10-17T09:33:46Z", "text": "There is also a thread about this issue on the user mailing list at\nhttp://marc.theaimsgroup.com/?l=ant-user&m=116110133201615&w=2"}, {"count": 3, "tags": [], "text": "Upping the severity level.", "is_private": false, "bug_id": 40776, "id": 94896, "time": "2006-10-17T09:35:21Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-17T09:35:21Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 40776, "is_private": false, "text": "Ok, could also verify that with the given sample project.\nI changed the buildfile, so a single Ant run would produce the error:\n\n<project name=\"Test\" default=\"build\">\n\n\t<presetdef name=\"compile\">\n\t\t<javac\n\t\t\t   srcdir=\"src\"\n\t\t\t   destdir=\"bin\"\n\t\t\t   target=\"1.5\"\n\t\t\t   source=\"1.5\"\n\t\t\t   debug=\"true\"\n\t\t\t   listfiles=\"true\">\n\t\t</javac>\n\t</presetdef>\n\n\n\t<target name=\"build\">\n\t\t<mkdir dir=\"bin\"/>\n\t\t<compile/>\n\t\t<delete><fileset dir=\"bin/test\" includes=\"Test3*.class\"/></delete>\n\t\t<compile/>\n\t</target>\n\n</project>", "id": 94928, "time": "2006-10-18T04:13:17Z", "creator": "jan@materne.de", "creation_time": "2006-10-18T04:13:17Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 40776, "is_private": false, "text": "Also tested with Ant 1.7.0beta2 (September 17 2006) on Java 1.6 (1.6.0-rc-b102)\non WinXP-SP2.\n\nError does occur. :-(", "id": 94931, "time": "2006-10-18T05:01:05Z", "creator": "jan@materne.de", "creation_time": "2006-10-18T05:01:05Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 40776, "text": "I have also verified that this occurs under 1.6.4. -peter", "id": 105251, "time": "2007-07-10T13:07:29Z", "creator": "Peter.Portante@hp.com", "creation_time": "2007-07-10T13:07:29Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 40776, "is_private": false, "text": "I have added an new attribute to the javac task - includeDestClasses.\nThis is by default set to true - in which case the javac task includes\nthe destination directory in the classpath parameter given to javac command\n(default behaviour), if set to false, this will not happen.\n\nthe build file: \n<project name=\"Test\" default=\"build\">\n  <presetdef name=\"compile\">\n    <javac\n      srcdir=\"src\"\n      destdir=\"bin\"\n      target=\"1.5\"\n      source=\"1.5\"\n      debug=\"true\"\n      includeDestClasses=\"false\"\n      listfiles=\"true\">\n    </javac>\n  </presetdef>\n\n\n  <target name=\"build\">\n    <mkdir dir=\"bin\"/>\n    <compile/>\n    <delete><fileset dir=\"bin/test\" includes=\"Test3*.class\"/></delete>\n    <compile/>\n  </target>\n  \n</project>\n\nnow works.\n", "id": 105805, "time": "2007-07-20T10:19:06Z", "creator": "peterreilly@apache.org", "creation_time": "2007-07-20T10:19:06Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "claude.montpetit@trilliantinc.com", "attachment_id": null, "is_private": false, "id": 119043, "time": "2008-07-27T11:33:49Z", "bug_id": 40776, "creation_time": "2008-07-27T11:33:49Z", "text": "I think there is other \"edge cases\" for that which are solved by this bug fix:\n\n 1- Interface A has a method x with \"void\" return type.\n\n 2- Class B uses an instance that implements interface A, and calls the void method x. from -1.\n\n 3- Interface A is refactored and method x to return an Object (not void anymore).\n\n 4- Class B is not modified and still compiles: it just call x still with no concern on the returned value.\n\n 5- Using javac in Ant, Class B is untouched and not recompiled.\n\nAt runtime, B fails calling the method x.\n\nForcing recompile of B fixes the runtime problem. Using 1.7.1 with the new attribute includeDestClasses=\"false\" also fixes the problem."}]
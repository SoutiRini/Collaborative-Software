[{"attachment_id": null, "tags": [], "bug_id": 54611, "text": "I'm not sure this is the right approach, but returning a non-encoded URI certainly isn't. In particular, I wonder if the optimization of using unparsed_uri is good or whether the r->uri should be escaped.\n\nAgain, diff is vs our local copy of 2.4.3.\n\n-tim\n\n\nIndex: trunk/Apache/httpd/modules/dav/main/mod_dav.c\n===================================================================\n--- trunk/Apache/httpd/modules/dav/main/mod_dav.c\t(revision 180429)\n+++ trunk/Apache/httpd/modules/dav/main/mod_dav.c\t(revision 180431)\n@@ -611,7 +611,9 @@\n    const char *body;\n\n    if (locn == NULL) {\n-        locn = r->uri;\n+        locn = r->unparsed_uri;\n+    } else {\n+        locn = ap_escape_uri(r->pool, locn);\n    }\n\n    /* did the target resource already exist? */", "count": 0, "id": 165486, "time": "2013-02-26T04:10:43Z", "creator": "tjw@omnigroup.com", "creation_time": "2013-02-26T04:10:43Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54611, "attachment_id": null, "id": 165487, "time": "2013-02-26T04:11:30Z", "creator": "tjw@omnigroup.com", "creation_time": "2013-02-26T04:11:30Z", "is_private": false, "text": "A specific case of this may be <https://issues.apache.org/bugzilla/show_bug.cgi?id=54367> but all Location-returning commands have the issue."}, {"count": 2, "tags": [], "text": "A quick test against trunk/2.5 r1470683 shows that the bug still exists there and this patch still fixes it there.", "is_private": false, "id": 166775, "creator": "wiml@omnigroup.com", "time": "2013-04-23T01:52:24Z", "bug_id": 54611, "creation_time": "2013-04-23T01:52:24Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "minfrin@sharp.fm", "is_private": false, "text": "Applied to trunk in r1476621.", "id": 166886, "time": "2013-04-27T16:56:03Z", "bug_id": 54611, "creation_time": "2013-04-27T16:56:03Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Proposed for backport to v2.4 and v2.2.", "attachment_id": null, "id": 167377, "creator": "minfrin@sharp.fm", "time": "2013-05-23T13:19:21Z", "bug_id": 54611, "creation_time": "2013-05-23T13:19:21Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 54611, "is_private": false, "count": 5, "id": 167381, "time": "2013-05-23T14:14:39Z", "creator": "minfrin@sharp.fm", "creation_time": "2013-05-23T14:14:39Z", "text": "Backported to v2.4."}, {"count": 6, "tags": [], "bug_id": 54611, "attachment_id": null, "id": 181627, "time": "2015-03-10T03:23:47Z", "creator": "wiml@omnigroup.com", "creation_time": "2015-03-10T03:23:47Z", "is_private": false, "text": "I think this is fixed; see my comment in bug 54367."}, {"count": 7, "tags": [], "bug_id": 54611, "text": "See r1485721 for the backport in 2.4.x\nIt was part of 2.4.5\n\nSee r1497121 for the backport in 2.2.x\nIt was part of 2.2.25", "id": 181629, "time": "2015-03-10T06:13:36Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2015-03-10T06:13:36Z", "is_private": false, "attachment_id": null}]
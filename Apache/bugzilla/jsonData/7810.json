[{"count": 0, "tags": [], "creator": "colmmacc@redbrick.dcu.ie", "text": "Possibly Related to Bug 7791. mod_cgid behaviour is a major\nsecurity issue and should at least be documented.\n\nusing prefork mpm + mod_cgi :\nsuexec is called with arguments \"uid gid binary ..\" and NOT \"~uid gid binary ..\"\nwhich results in a not in docroot error. Hacky shell script to add ~ to the call\nand recall a real suexec binary results in correct operation.\n\nConfirmed on FreeBSD 4.5 and Solaris 8 (sparc)\n\nusing worker mpm + mod_cgid :\n\nsuexec DOES NOT EVEN GET CALLED. userdir cgi run with the uid/gid of the \nwebserver. \n\nConfirmed on FreeBSD 4.5 and Solaris 8 (sparc)\n\nconfigure cmdlines:\n\n./configure --prefix=/local/apache-test \\\n--enable-cgi \\\n--enable-suexec --with-suexec-caller=www \\\n--with-suexec-docroot=/local/web/htdocs \\\n--with-suexec-bin=/local/apache-test/bin/suexec \\\n--with-suexec-logfile=/local/apache-test/logs/suexec_log \\\n--with-suexec-userdir=public_html \\\n--with-suexec-uidmin=100 --with-suexec-gidmin=100 --with-suexec-umask=077\n\n\n./configure --prefix=/local/apache-test \\\n--with-mpm=worker \\\n--enable-cgid \\\n--enable-suexec --with-suexec-caller=www \\\n--with-suexec-docroot=/local/web/htdocs \\\n--with-suexec-bin=/local/apache-test/bin/suexec \\\n--with-suexec-logfile=/local/apache-test/logs/suexec_log \\\n--with-suexec-userdir=public_html \\\n--with-suexec-uidmin=100 --with-suexec-gidmin=100 --with-suexec-umask=077\n\nrelevant configuration directives:\n\nUserDir public_html\n\n..\n\n<Directory /home/*/*/public_html>\n     Options Indexes ExecCGI Includes SymLinksIfOwnerMatch\n     AllowOverride AuthConfig\n</Directory>\n\n<Directory /home/*/*/*/public_html>\n     Options Indexes ExecCGI Includes SymLinksIfOwnerMatch\n     AllowOverride AuthConfig\n</Directory>\n\n(we have a lot of users, hence nested /home)", "id": 12951, "time": "2002-04-07T10:57:01Z", "bug_id": 7810, "creation_time": "2002-04-07T10:57:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 1580\nPATCH os/unix/unixd.c for mpm=prefork", "attachment_id": 1580, "bug_id": 7810, "id": 13614, "time": "2002-04-15T12:14:51Z", "creator": "colmmacc@redbrick.dcu.ie", "creation_time": "2002-04-15T12:14:51Z", "is_private": false}, {"count": 2, "tags": [], "text": "The Patch I've attachted fixes the first case, with mpm=prefork.\n\nStill no fix for mpm=worker and likely other mpm's.", "attachment_id": null, "id": 13615, "creator": "colmmacc@redbrick.dcu.ie", "time": "2002-04-15T12:16:04Z", "bug_id": 7810, "creation_time": "2002-04-15T12:16:04Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jerenkrantz@apache.org", "attachment_id": null, "id": 14694, "time": "2002-04-25T07:20:05Z", "bug_id": 7810, "creation_time": "2002-04-25T07:20:05Z", "is_private": false, "text": "Thanks for your patch!  I have committed a variant of your patch to HEAD. \nPlease try out a CVS snapshot or wait for the forthcoming Apache 2.0.36.\n\nThanks for using Apache!"}, {"count": 4, "tags": [], "creator": "brianp@apache.org", "attachment_id": null, "id": 16750, "time": "2002-05-26T22:21:48Z", "bug_id": 7810, "creation_time": "2002-05-26T22:21:48Z", "is_private": false, "text": "committed colm's patch that fixes suexec+userdir+cgid"}, {"count": 5, "tags": [], "text": "I am experiencing this problem on Solaris 8 and the latest version httpd 2.0.39.\n  Skimming through the source it seems the patches included in the bug report\nwere applied before its release. It appears to be a problem with userdir,\nbecause apache will call suexec, but it does not recognize user directories\n(suexec is called with the target uid/gid of the httpd user/group and treats the\nCGI as if it were in the document root).  \n\nI have UserDir set to web in httpd.conf and am loading the following as DSOs:\n\naccess_module\nalias_module\nauth_module\nautoindex_module\ncgi_module\ndir_module\nenv_module\ninclude_module\nlog_config_module\nmime_magic_module\nmime_module\nnegotiation_module\nsetenvif_module\nsuexec_module\nunique_id_module\nuserdir_module\nvhost_alias_module\n\nand the following compiled in:\n\n# /usr/local/apache/bin/httpd -l\nCompiled in modules:\n  core.c\n  mod_ssl.c\n  prefork.c\n  http_core.c\n  mod_so.c\n\nHopefully I didn't miss something obvious!  Thanks in advance,\n\nDennis\n\n\n\n\n\n", "attachment_id": null, "id": 18562, "creator": "dennis.kelly@gmail.com", "time": "2002-06-25T17:57:18Z", "bug_id": 7810, "creation_time": "2002-06-25T17:57:18Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 7810, "attachment_id": null, "text": "Do you have any SuexecUserGroup Directives in your config files ?\n\nTry removing them.", "id": 18565, "time": "2002-06-25T18:35:08Z", "creator": "colmmacc@redbrick.dcu.ie", "creation_time": "2002-06-25T18:35:08Z", "is_private": false}, {"count": 7, "tags": [], "text": "Crossreference point: PR 9038 contains a discusion relevant to this issue.", "attachment_id": null, "bug_id": 7810, "id": 18575, "time": "2002-06-25T22:50:03Z", "creator": "colmmacc@redbrick.dcu.ie", "creation_time": "2002-06-25T22:50:03Z", "is_private": false}, {"count": 8, "tags": [], "creator": "dennis.kelly@gmail.com", "text": "Without the SuexecUserGroup directive set, suexec is never called... nothing\nlogged to cgi.log and CGIs (including ~user ones) are executed successfully as\nthe httpd user. With the directive set, suexec is at least called, but it does\nnot honor ~user... the target uid/gid are set to that of the httpd user and\nscript execution fails because it is not in the document root.\n\nI did check Bug 9038 before submitting, which states disabling cgid in the\nLoadModule should fix it.  I did this (noted in the modules I am loading)\nwithout success.  As I re-read 9038, Alex had success by disabling cgid at\ncompile time.  Is that the ultimate fix (vs. at LoadModule time) ?\n\nThanks,\nDennis\n", "id": 18609, "time": "2002-06-26T15:05:55Z", "bug_id": 7810, "creation_time": "2002-06-26T15:05:55Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 7810, "attachment_id": null, "text": "mod_cgid + userdir + suexec has been functional as of 2.0.39, I'm\ncurrently using that combination on several platforms.\n\nTry reversing the order in which you load the userdir and suexec\nmodules. Also, did you specify --enable-suexec at configure time?\nIt's possible to have the suexec module built without that, so\nit may be an issue. ", "id": 18610, "time": "2002-06-26T15:15:35Z", "creator": "colmmacc@redbrick.dcu.ie", "creation_time": "2002-06-26T15:15:35Z", "is_private": false}, {"count": 10, "tags": [], "creator": "dennis.kelly@gmail.com", "text": "I did include that config option... pullled from config.log (minus the\nformatting for readability):\n\n./configure --with-layout=Apache \\\n--prefix=/usr/local/apache \\\n--enable-mods-shared=access actions alias asis auth auth_anon auth_dbm autoindex\ncache cern_meta cgi cgid charset_lite dav deflate dir env example expires\next_filter file_cache headers imap include info isapi log_config mime mime_magic\nnegotiation proxy rewrite setenvif speling status suexec unique_id userdir\nusertrack vhost_alias \\\n--enable-modules=ssl \\\n--enable-so \\\n--enable-ssl \\\n--enable-suexec \\\n--with-ssl=/opt \\\n--enable-static-htpasswd \\\n--disable-auth-digest \\\n--with-suexec-caller=www \\\n--with-suexec-docroot=/web \\\n--with-suexec-userdir=web \\\n--with-suexec-uidmin=10 \\\n--with-suexec-gidmin=10 \\\n--with-suexec-safepath=/usr/bin:/opt/bin\n\nAny other ideas?  Your continued to help is appreciated.\n\nDennis", "id": 18614, "time": "2002-06-26T16:28:51Z", "bug_id": 7810, "creation_time": "2002-06-26T16:28:51Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 7810, "attachment_id": null, "text": "Should have explicitly mentioned I did change the order in which suexec/userdir\nare loaded without success.", "id": 18732, "time": "2002-06-28T17:40:52Z", "creator": "dennis.kelly@gmail.com", "creation_time": "2002-06-28T17:40:52Z", "is_private": false}, {"count": 12, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "id": 24646, "time": "2002-10-16T17:15:10Z", "bug_id": 7810, "creation_time": "2002-10-16T17:15:10Z", "is_private": false, "text": "It seems like this has been fixed at some point.  If not, please feel free\nto reopen the bug report."}]
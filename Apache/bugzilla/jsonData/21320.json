[{"count": 0, "tags": [], "bug_id": 21320, "is_private": false, "id": 39949, "attachment_id": null, "creator": "eeaston@ptc.com", "creation_time": "2003-07-03T18:03:59Z", "time": "2003-07-03T18:03:59Z", "text": "The documentation for org.apache.tools.ant.util.FileNameMapper states \"Used to \nfind the name of the target file(s) corresponding to a source file.\"  Note the \nuse of the word \"file(s).\"\n\nFurther the API:\njava.lang.String[] mapFileName(java.lang.String sourceFileName) \nshows that you can map a single file name to many.\n\nHowever, the copy task ignores all but the first mapped file name.  See line \n489 of 1.5.3-1 source for org.apache.tools.ant.taskdefs.Copy:\n        for (int i = 0; i < toCopy.length; i++) {\n            File src = new File(fromDir, toCopy[i]);\n>>>         File dest = new File(toDir, mapper.mapFileName(toCopy[i])[0]);\n            map.put(src.getAbsolutePath(), dest.getAbsolutePath());\n        }\n\nCopy and potentially other tasks that know about mappers should be fixed to \nfulfill the expectations set by the FileNameMapper javadoc and API declaration."}, {"count": 1, "tags": [], "text": "I could try to fix this problem, but I would be glad to see what other \ncommitters think about that first.", "attachment_id": null, "id": 39956, "creator": "levylambert@tiscali-dsl.de", "time": "2003-07-03T20:05:54Z", "bug_id": 21320, "creation_time": "2003-07-03T20:05:54Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 21320, "is_private": false, "text": "I'm going to patch the Copy task against 1.5.3-1 for use at my site since we \nneed this capability anyhow.  Once I test it, I can submit a patch (against \nhead for 1.6).  I don't know if the problem affects other classes, but I might \nbeable to fix those too.\n\nLet me know by Sunday if you'd rather I not do it...I've not followed the dev \nlist and am unaware of attitudes of the ant team.", "id": 39958, "time": "2003-07-03T20:14:05Z", "creator": "eeaston@ptc.com", "creation_time": "2003-07-03T20:14:05Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "antoine@apache.org", "is_private": false, "id": 39961, "time": "2003-07-03T21:17:27Z", "bug_id": 21320, "creation_time": "2003-07-03T21:17:27Z", "tags": [], "text": "It is a good idea that you prepare patches against HEAD.\nSince these patches will induce a change of behavior of the tasks, it might be \ngood to add a new flag to the copy task called for instance ignoredoublemappings \nand set it to true by default.\nThis way in the \"normal\" case only the first mapping will be used, leaving the \nbehavior of the task intact. \nIf you do <copy ignoredoublemappings=\"false\"/> then <copy/> will use all \nmappings."}, {"count": 4, "tags": [], "bug_id": 21320, "is_private": false, "text": "Any change will likely need to propagate to Move.java as well (which is a subclass\nof Copy).  And to Sync (new in Ant 1.6), which uses a subclass of Copy internally.\n\nWe'd also need to make some strong notes in the javadocs as well as in WHATSNEW.", "id": 39970, "time": "2003-07-04T06:50:41Z", "creator": "bodewig@apache.org", "creation_time": "2003-07-04T06:50:41Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Does a move of a single file to multiple files even make sense?  \n\nOptions for applying this fix to :\n(a) implement a move of a single file to N mapped files as N-1 copies and 1 \nmove  ?\n(b) warn that only first mapping is used if ignoremultiplemappings=\"false\" and \nthe mapper returns >1 mapped path?\n(c) error if same conditions as (b)\n(d) error if Copy's ignoremultiplemappings is used on Move (i.e. break LSP)\n(e) nothing - silently ignore multiple mapped files\n\nWhat do others think should be done for Move?", "is_private": false, "bug_id": 21320, "id": 40124, "time": "2003-07-07T23:45:36Z", "creator": "eeaston@ptc.com", "creation_time": "2003-07-07T23:45:36Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 40153, "time": "2003-07-08T07:30:04Z", "bug_id": 21320, "creation_time": "2003-07-08T07:30:04Z", "is_private": false, "text": "better keep dev@ant in CC or nobody is going to notice when you make progress or\nask questions ;-)\n\nTo your question - if copy to multiple files makes sense, so does move, IMHO.  I'd\nlean to your option (a).\n\n"}, {"count": 7, "tags": [], "text": "One thing to be aware of is that the dependency\ncode in copy is strongly bound to\na single source file -> target file mapping.\n", "attachment_id": null, "id": 40155, "creator": "peter.reilly@corvil.com", "time": "2003-07-08T07:39:14Z", "bug_id": 21320, "creation_time": "2003-07-08T07:39:14Z", "is_private": false}, {"count": 8, "attachment_id": 7164, "creator": "eeaston@ptc.com", "is_private": false, "id": 40188, "time": "2003-07-08T15:52:10Z", "bug_id": 21320, "creation_time": "2003-07-08T15:52:10Z", "tags": [], "text": "Created attachment 7164\nPatch to Copy and Move to accomodate multiple mappings."}, {"count": 9, "tags": [], "creator": "eeaston@ptc.com", "attachment_id": null, "id": 40189, "time": "2003-07-08T15:53:59Z", "bug_id": 21320, "creation_time": "2003-07-08T15:53:59Z", "is_private": false, "text": "Submitted Patch - Please review and commit if acceptable.\n\nI changed the behavior of Move slightly to check for self-move of empty \ndirectories.  As of Move's 1.35 version, this check was not done and a self-\nmove would delete the directory.\n\nI did not touch Sync$MyCopy as it currently asserts the use of an Identity \nmapper.  Certainly rules for doing mapping in a Sync task could be devised, but \nthey'd be pretty hairy since syncing is two way and I'm not sure how you'd deal \nwith N-to-1 syncs in the reversal of a mapping.  I'll let the core team decide \nto do something about this if they feel it's necessary...I don't consider Sync \nbroken in terms of mapping."}, {"count": 10, "tags": [], "bug_id": 21320, "is_private": false, "id": 40684, "attachment_id": null, "creator": "eeaston@ptc.com", "creation_time": "2003-07-15T00:35:01Z", "time": "2003-07-15T00:35:01Z", "text": "I was just curious if I submitted my proposed patch correctly (per directions \nat http://www.apache.org/dev/contributors.html) and wanted to make sure it \ndidn't fall through the cracks.  Not urgent...just checking."}, {"count": 11, "tags": [], "bug_id": 21320, "is_private": false, "id": 40704, "attachment_id": null, "creator": "peter.reilly@corvil.com", "creation_time": "2003-07-15T08:15:22Z", "time": "2003-07-15T08:15:22Z", "text": "The patch is fine.\n\nIt would be nice to have some unit tests.\n"}, {"count": 12, "tags": [], "text": "Created attachment 7302\nAnt build script to run some unit tests", "attachment_id": 7302, "id": 40715, "creator": "eeaston@ptc.com", "time": "2003-07-15T13:44:15Z", "bug_id": 21320, "creation_time": "2003-07-15T13:44:15Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 21320, "attachment_id": null, "is_private": false, "id": 41285, "time": "2003-07-24T13:24:13Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-07-24T13:24:13Z", "text": "Commited the patch with some slight modifications (change\nname of attribute from igore to enable, and some check\nstyle changes). Thanks."}]
[{"count": 0, "tags": [], "bug_id": 50273, "text": "I use the above Tomcat on my HP-UX 11.23 system. I have compiled libtcnative 1.1.20 successfully. Tomcat is spamming my log files with this error message:\n\n5.11.2010 09:06:29 org.apache.tomcat.util.net.AprEndpoint$Acceptor run\nSCHWERWIEGEND: Socket accept failed\norg.apache.tomcat.jni.Error: Kein Pufferplatz verf\u00fcgbar\n        at org.apache.tomcat.jni.Socket.accept(Native Method)\n        at org.apache.tomcat.util.net.AprEndpoint$Acceptor.run(AprEndpoint.java:1169)\n        at java.lang.Thread.run(Thread.java:619)\n\nIn English: No buffer space available. I googled for the problem and this out:\nhttp://forums.devx.com/archive/index.php/t-99967.html\n\nThis bug occurs with the IE6 & IE8 on our setup. I wasn't able to filter this our with java logging, it simple ignored loading my filter.\nSearching the APR docs I found this: http://dev.ariel-networks.com/apr/apr-tutorial/html/apr-tutorial-13.html Section \"Detection of the remote host closed the socket\"\n\nThe error seems to be harmless, a debug or info would satisfy here but in the level severe it simply spams my disk.\n\nIs there a way to fix that according to the APR docs? I have no clue in C.", "id": 141727, "time": "2010-11-15T10:39:37Z", "creator": "1983-01-06@gmx.net", "creation_time": "2010-11-15T10:39:37Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "We need to figure out the error number to correctly filter out this particular error. I'll take a look and see if I can figure out what it is from the Tomcat native / APR source (233 is looking like a good bet). In case I can't and for future use, I have modified the 7.0.x code to include it in the exception message.", "is_private": false, "bug_id": 50273, "id": 141850, "time": "2010-11-19T14:05:10Z", "creator": "markt@apache.org", "creation_time": "2010-11-19T14:05:10Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 50273, "is_private": false, "text": "Hmm. The error code is indeed 233 but the HP-UX folks have re-used an existing error code that can also a genuine error has occurred. Therefore, we can't ignore this universally since it will represent real problems on other platforms (and possibly also on HP-UX). There is some useful info in this httpd thread http://httpd.markmail.org/thread/djrcyntamxrkulns\n\nI have a couple of ideas for this that I need to try out.", "id": 141853, "time": "2010-11-19T14:43:32Z", "creator": "markt@apache.org", "creation_time": "2010-11-19T14:43:32Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 50273, "is_private": false, "text": "Mark,\n\nif I can assist somehow, please let me now. I am running 6.0.x only. I can recompile a patched libtcnative and see if this works and a modified tomcat for test purposes with the current libtcnative.", "id": 141856, "time": "2010-11-19T16:37:58Z", "creator": "1983-01-06@gmx.net", "creation_time": "2010-11-19T16:37:58Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 50273, "is_private": false, "id": 141882, "attachment_id": 26323, "creator": "markt@apache.org", "creation_time": "2010-11-21T14:38:37Z", "time": "2010-11-21T14:38:37Z", "text": "Created attachment 26323\nProposed patch for Tomcat 7\n\nThe proposed patch adds a separate logger for the acceptor and reduces the log level from SEVERE to WARNING if the error code is 233. This should allow it to be filtered out on HP-UX but it will still be logged by default on other platforms.\nTo filter these messages out, add the following to logging.properties\norg.apache.tomcat.util.net.AprEndpoint$Acceptor.level = SEVERE"}, {"count": 5, "tags": [], "bug_id": 50273, "is_private": false, "text": "Created attachment 26324\nBinary patch for Tomcat 6\n\nThe attached binary patch for Tomcat 6 is purely for the OP to test this on their test platform. It is not an official release from the ASF. Use it at your own risk.\n\nTo test this patch, create the following directory structure under the instance's lib directory:\norg/apache/tomcat/util/net\nand place the file AprEndpoint$Acceptor.class in that directory. Restart Tomcat and you should be able to filter out the message using the logging configuration above. Please report back either way.\n\nIf it works, I'll apply the fix to Tomcat 7 and proposed it for Tomcat 6. It it doesn't work, then I'll provide a patch with further debugging info and we can go from there.", "id": 141883, "time": "2010-11-21T14:50:02Z", "creator": "markt@apache.org", "creation_time": "2010-11-21T14:50:02Z", "attachment_id": 26324}, {"count": 6, "tags": [], "text": "Mark,\nthanks for the the binary patch. Will test this tomorrow. Btw, the patch is incorrect. Bug Id stated in the patch has to be 50273 and not 50773", "is_private": false, "id": 141885, "creator": "1983-01-06@gmx.net", "time": "2010-11-21T15:18:51Z", "bug_id": 50273, "creation_time": "2010-11-21T15:18:51Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Mark,\n\nnow I get this:\n\nINFO: Pausing Coyote HTTP/1.1 on http-8443\n22.11.2010 13:30:21 org.apache.tomcat.util.net.AprEndpoint$Acceptor run\nWARNUNG: Socket accept failed\norg.apache.tomcat.jni.Error: Kein Pufferplatz verf\u00c3\u00bcgbar\n        at org.apache.tomcat.jni.Socket.accept(Native Method)\n        at org.apache.tomcat.util.net.AprEndpoint$Acceptor.run(AprEndpoint.java:1170)\n        at java.lang.Thread.run(Thread.java:619)\n22.11.2010 13:30:22 org.apache.catalina.core.StandardService stop\nINFO: Stopping service Catalina\n\nWhich seems correct. I changed the log level and will check the logs in the next couple of days. But it seems to be fixed by that.\n\nI am just curious if the root cause of this can be fixed in APR or not? Your solution is a mere workaround.", "is_private": false, "id": 141915, "creator": "1983-01-06@gmx.net", "time": "2010-11-22T07:40:03Z", "bug_id": 50273, "creation_time": "2010-11-22T07:40:03Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 50273, "attachment_id": null, "id": 141916, "time": "2010-11-22T08:26:06Z", "creator": "markt@apache.org", "creation_time": "2010-11-22T08:26:06Z", "is_private": false, "text": "Thanks for your testing. This is good news. I'll get this fix into 7.0.x and proposed for 6.0.x later today.\n\nYes the solution is a workaround but while HP-UX is returning this error code for multiple errors - some of which are fatal and some of which are not - there isn't a huge amount that can be done about it.\n\nIt is probably possible to put a work-around into Tomcat's native connector or maybe even the APR library but I avoided that for two reasons:\n- my C knowledge is only very basic\n- the fact that the error message can't just be ignored - even on HP-UX means that an error code has to be returned to Tomcat's acceptor thread anyway which would require a work-around not dissimilar from what I already wrote."}, {"count": 9, "tags": [], "bug_id": 50273, "is_private": false, "id": 141917, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2010-11-22T08:45:45Z", "time": "2010-11-22T08:45:45Z", "text": "Fixed in 7.0.x and will be included in 7.0.5 onwards\nProposed for 6.0.x"}, {"count": 10, "tags": [], "bug_id": 50273, "attachment_id": null, "text": "Great news. Thanks for the quick help.\nDo you think it is worth raising a ticket at APR with a link to this one?", "id": 141918, "time": "2010-11-22T09:00:00Z", "creator": "1983-01-06@gmx.net", "creation_time": "2010-11-22T09:00:00Z", "is_private": false}, {"count": 11, "tags": [], "text": "Fixed in 6.0.x and will be included in 6.0.30 onwards.", "attachment_id": null, "id": 142013, "creator": "markt@apache.org", "time": "2010-11-25T12:22:25Z", "bug_id": 50273, "creation_time": "2010-11-25T12:22:25Z", "is_private": false}]
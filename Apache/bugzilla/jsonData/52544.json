[{"count": 0, "tags": [], "creator": "tlaubr@kerio.com", "attachment_id": 28219, "text": "Created attachment 28219\nLog\n\nMy server.xml contains:\n\n<Listener SSLEngine=\"on\" className=\"org.apache.catalina.core.AprLifecycleListener\"/>\n\n<Connector SSLCertificateFile=\"h:\\\\sslcert\\\\active.crt\" SSLCertificateKeyFile=\"h:\\\\sslcert\\\\active.key\" URIEncoding=\"utf-8\" port=\"443\" protocol=\"HTTP/1.1\" SSLEnabled=\"true\" maxThreads=\"150\" scheme=\"https\" secure=\"true\" clientAuth=\"false\" sslProtocol=\"TLS\" />    \n\nThe connector crash with this error on startup (hs_err_pid3084.log):\n\n\n#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x00a1ac41, pid=3084, tid=3086141120\n#\n# JRE version: 6.0_26-b03\n# Java VM: Java HotSpot(TM) Server VM (20.1-b02 mixed mode linux-x86 )\n# Problematic frame:\n# C  [libtcnative-1.so+0x1ec41]  long+0xbe\n#\n# If you would like to submit a bug report, please visit:\n#   http://java.sun.com/webapps/bugreport/crash.jsp\n# The crash happened outside the Java Virtual Machine in native code.\n# See problematic frame for where to report the bug.\n#\n\n---------------  T H R E A D  ---------------\n\nCurrent thread (0x093e1000):  JavaThread \"main\" [_thread_in_native, id=3084, stack(0xbfe84000,0xbfed4000)]\n\nsiginfo:si_signo=SIGSEGV: si_errno=0, si_code=1 (SEGV_MAPERR), si_addr=0x00000000\n\nRegisters:\nEAX=0x00000000, EBX=0x00a408fc, ECX=0x0000016e, EDX=0x00000000\nESP=0xbfed1b20, EBP=0xbfed1b48, ESI=0x00000000, EDI=0x093e1000\nEIP=0x00a1ac41, EFLAGS=0x00210246, CR2=0x00000000\n\nTop of Stack: (sp=0xbfed1b20)\n0xbfed1b20:   0975ebd0 00000000 00a1d628 00000000\n0xbfed1b30:   09bf64b0 0975ebd0 00000000 00000000\n0xbfed1b40:   00000000 00a408fc bfed1ca8 00a1af54\n0xbfed1b50:   0975c168 09bf64d8 00000000 bfed1b34\n0xbfed1b60:   b4f67640 00000000 b4f676a5 09bf64d8\n0xbfed1b70:   09761f00 00000000 0975c168 00000000\n0xbfed1b80:   01010000 bfed1b34 00000000 00000000\n0xbfed1b90:   00000000 00000000 00000000 00000000 \n\nInstructions: (pc=0x00a1ac41)\n0x00a1ac21:   08 c7 44 24 04 00 00 00 00 8b 45 ec 89 04 24 e8\n0x00a1ac31:   93 11 ff ff 89 45 f0 83 7d f0 00 75 32 8b 45 f4\n0x00a1ac41:   c6 00 00 c7 44 24 0c 00 00 00 00 c7 44 24 08 00\n0x00a1ac51:   00 00 00 c7 44 24 04 01 00 00 00 8b 45 ec 89 04 \n\nRegister to memory mapping:\n\nEAX=0x00000000 is an unknown value\nEBX=0x00a408fc: <offset 0x448fc> in /opt/kerio/workspace/tomcat/lib/libtcnative-1.so at 0x009fc000\nECX=0x0000016e is an unknown value\nEDX=0x00000000 is an unknown value\nESP=0xbfed1b20 is pointing into the stack for thread: 0x093e1000\nEBP=0xbfed1b48 is pointing into the stack for thread: 0x093e1000\nESI=0x00000000 is an unknown value\nEDI=0x093e1000 is a thread\n\n\nStack: [0xbfe84000,0xbfed4000],  sp=0xbfed1b20,  free space=310k\nNative frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)\nC  [libtcnative-1.so+0x1ec41]  long+0xbe\nC  [libtcnative-1.so+0x1ef54]  Java_org_apache_tomcat_jni_SSLContext_setCertificate+0x21d\nj  org.apache.tomcat.jni.SSLContext.setCertificate(JLjava/lang/String;Ljava/lang/String;Ljava/lang/String;I)Z+0\nj  org.apache.tomcat.util.net.AprEndpoint.init()V+628\nj  org.apache.coyote.http11.Http11AprProtocol.init()V+26\nj  org.apache.catalina.connector.Connector.initialize()V+202\nj  org.apache.catalina.core.StandardService.initialize()V+264\nj  org.apache.catalina.core.StandardServer.initialize()V+170\nj  org.apache.catalina.startup.Catalina.load()V+333\n\n\nI tested it also under Windows 7/64bit and it also crashes with 64bit java. If the server is run under 32bit java, the error doesn't appear.", "id": 153216, "time": "2012-01-27T14:53:29Z", "bug_id": 52544, "creation_time": "2012-01-27T14:53:29Z", "is_private": false}, {"count": 1, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "text": "This would be hard to debug without a certificates that cause a crash.\nIf you can provide a certificate that causes the crash I can try to debug the issues. You can send it directly to my email if concerned about security.\n\nWithout seeing what the certificate actually is, I'm afraid we can't do much\nsince there were no reports of the similar issues.", "id": 154001, "time": "2012-02-21T17:34:46Z", "bug_id": 52544, "creation_time": "2012-02-21T17:34:46Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 52544, "is_private": false, "count": 2, "id": 154354, "time": "2012-02-29T10:31:06Z", "creator": "mturk@apache.org", "creation_time": "2012-02-29T10:31:06Z", "text": "You will need to covert the certificate to pem.\nI exported active-1.crt certificates you have send me and then did:\nopenssl base64 -d -A -in *.net.crt -out active-1.der\nAfter that its loaded.\n\nNote that depending on OpenSSL version you can get core with that certificate.\nContemporary OpenSSL's will throw\n\n ... (error:0D0680A8:asn1 encoding routines:ASN1_CHECK_TLEN:wrong tag)\n\tat org.apache.tomcat.jni.SSLContext.setCertificate(Native Method)\n\nAlso versions before 1.1.23 can core if you set key without certificate\neg you only have SSLCertificateKeyFile=\"..\" but not SSLCertificateFile=\"...\""}]
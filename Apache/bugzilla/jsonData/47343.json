[{"count": 0, "tags": [], "creator": "fujino.keiichi@oss.ntt.co.jp", "attachment_id": null, "id": 127780, "time": "2009-06-10T03:54:19Z", "bug_id": 47343, "creation_time": "2009-06-10T03:54:19Z", "is_private": false, "text": "When context.xml of the conf/<engine>/<host>directory is updated, docBase directory is deleted and fails re-deploying. \n\nReproduction.\n(The context name is assumed to be testWebapp. )\n1.<<Tomcat_home>>/webapps/testWebapp/META-INF/context.xml is prepared.\n2.Context.xml is not put under the conf/<engine>/<host> directory.\n  (means first deployed)\n\n3.Tomcat is started. (testWebapp.xml is created to the conf/<engine>/<host> directory. )\n\n4.testWebapp.xml of conf/<engine>/<host > is updated. \n\nResult.\n<<Tomcat_home>>/webapps/testWebapp directory is deleted. \n\n\nThe cause is in the fixed of \"http://svn.apache.org/viewvc?view=rev&revision=712464\". \nThe order of the resource added to HostConfig$DeployedApplication#redeployResources was changed by this fix. \n\norder of the redploy resources is as follows. \n[before fix]\n Case of Deploy war.\n   war -> context.xml(conf/<engine>/<host>) -> doceBase directory\n Case of Deploy directory.\n   doceBase directory -> context.xml(META-INF/context.xml)\n[after fix]\n Case of Deploy war.\n   context.xml(conf/<engine>/<host>) -> war -> doceBase directory\n Case of Deploy directory.\n   context.xml(META-INF/context.xml) -> doceBase directory\n\n\nHostConfig#checkResources is as follows. \nfor (int i = 0; i < resources.length; i++) {\n...omits \nif ((!resource.isDirectory()) && resource.lastModified() > lastModified) {\n...omits \n   // Delete other redeploy resources\n   for (int j = i + 1; j < resources.length; j++) {\n       try {\n           File current = new File(resources[j]);\n               ...omits \n               ExpandWar.delete(current);\n           }\n       } catch (IOException e) {\n           log.warn(sm.getString\n                   (\"hostConfig.canonicalizing\", app.name), e);\n       }\n}\n...omits \n\nAfter all,\nWhen testWebapp.xml of conf/<engine>/<host > is updated, \ndirectory is deleted or war and the directory are deleted. \nAs a result,\nIt fails in deploying because it tries to deploy it only with context.xml (docBase direcotry doesn't exist). \n\n\nRegards."}, {"count": 1, "tags": [], "bug_id": 47343, "attachment_id": null, "id": 127876, "time": "2009-06-11T06:49:56Z", "creator": "markt@apache.org", "creation_time": "2009-06-11T06:49:56Z", "is_private": false, "text": "This has been fixed in trunk and proposed for 6.0.21"}, {"count": 2, "tags": [], "bug_id": 47343, "attachment_id": null, "id": 128237, "time": "2009-06-24T10:40:44Z", "creator": "markt@apache.org", "creation_time": "2009-06-24T10:40:44Z", "is_private": false, "text": "This has been fixed in 6.0.x and will be included in 6.0.21 onwards."}]
[{"count": 0, "tags": [], "creator": "david_syer@hotmail.com", "text": "I like the fact that SCI scanning is off by default in a Tomcat embedded instance, but I'd lik eto be able to switch it on. It might even be possible already, but the API is non-obvious.  Maybe a method in Tomcat or associated friendly helper?\n\nWould also be nice in Tomcat 7.", "id": 168820, "time": "2013-07-26T15:37:46Z", "bug_id": 55312, "creation_time": "2013-07-26T15:37:46Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 55312, "text": "I played around with the Tomcat embedded server a bit more and found that it actually is relatively easy (if obscure) to switch on SCI:\n\n\t\tContextConfig contextConfig = new ContextConfig();\n\t\tcontext.addLifecycleListener(contextConfig);\n\nThe biggest problem is that the classpath scanner only scans certain well-known locations (/WEB-INF/lib/*.jar, /WEB-INF/classes I am guessing) so it doesn't pick up anything else by default that happens to be on the classpath but in a different location (e.g. if you launch with java -jar, or from inside an IDE). I think that's a bigger problem than the obscure API for setting it up. There are some mentions in comments about /WEB-INF/classes being bound to multiple locations to help Eclipse tooling, so there is some precedence for the required generalization, but again no obvious API for adding bindings.", "id": 168855, "attachment_id": null, "creator": "david_syer@hotmail.com", "creation_time": "2013-07-28T16:18:56Z", "time": "2013-07-28T16:18:56Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 55312, "text": "I'm working on a fix for 55287 and as part of that I have separated the SCI discovery from ContextConfig. That would allow an embedder to perform their own scan for SCIs based on just the ServletContext obtained from the Context they are initializing.", "id": 168859, "time": "2013-07-28T17:52:01Z", "creator": "jboynes@apache.org", "creation_time": "2013-07-28T17:52:01Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 55312, "attachment_id": null, "is_private": false, "id": 168869, "time": "2013-07-29T00:12:45Z", "creator": "jboynes@apache.org", "creation_time": "2013-07-29T00:12:45Z", "text": "I committed the change to decouple SCI loading in http://svn.apache.org/r1507870\n\nThis should allow you to perform SCI detection separately from full ContextConfig. Does that help for your application?"}, {"count": 4, "tags": [], "bug_id": 55312, "text": "It helps a bit. But it's actually the scan for HandlesTypes references that I need  to modify (populating the initializerClassMap in ContextConfig) - the SCIs are all discovered correctly, but their handlers are not unless they are in /WEB-INF/classes or /WEB-INF/lib/*.jar.", "id": 168886, "time": "2013-07-29T08:50:56Z", "creator": "david_syer@hotmail.com", "creation_time": "2013-07-29T08:50:56Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "(In reply to Dave Syer from comment #1)\n> I played around with the Tomcat embedded server a bit more and found that it\n> actually is relatively easy (if obscure) to switch on SCI:\n> \n> \t\tContextConfig contextConfig = new ContextConfig();\n> \t\tcontext.addLifecycleListener(contextConfig);\n\nAside:\n\nThis is as expected if you are using addContext() vs addWebapp(). I have updated the Javadocs for the Tomcat class to try an make that clearer. I'm sure there is scope for further improvement to the docs. Patches welcome.", "is_private": false, "id": 168920, "creator": "markt@apache.org", "time": "2013-07-29T17:49:12Z", "bug_id": 55312, "creation_time": "2013-07-29T17:49:12Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 55312, "is_private": false, "id": 168947, "time": "2013-07-30T10:04:30Z", "creator": "markt@apache.org", "creation_time": "2013-07-30T10:04:30Z", "tags": [], "text": "Changing back to a bug as all classes should be scanned unless excluded via JARs to skip.\n\nWe should also check that classes deployed to CATALIBA_[BASE/|HOME]lib are scanned for matches to @HandlesTypes"}, {"count": 7, "attachment_id": null, "bug_id": 55312, "text": "This has been fixed in trunk. All class path entries are now scanned for matches to @HandlesTypes.", "id": 168973, "time": "2013-07-31T13:14:01Z", "creator": "markt@apache.org", "creation_time": "2013-07-31T13:14:01Z", "tags": [], "is_private": false}]
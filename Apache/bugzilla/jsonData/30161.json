[{"count": 0, "tags": [], "bug_id": 30161, "attachment_id": null, "text": "Background: http://www.netbeans.org/issues/show_bug.cgi?id=46171\n\nIt seems that AntClassLoader.findResources is buggy in case\nAntClassLoader.parent is something other than\nClassLoader.getSystemClassLoader(). The way ClassLoader.getResources works is\nthat the (CL.)parent is first checked and then this.findResources is appended.\nHowever ACL never sets CL.parent explicitly; it only used its own independent\nACL.parent field, and CL.parent is left at the default value, CL.sCL.\n\nThis means that ACL.parent.findResources is never called and so any resources\nthat might be contained in it are never found. This can affect e.g. <taskdef>\nwith no explicit classpath. (Note that ACL.getResource (find a single resource)\nis correct, as far as I know.)\n\nSpecifically the problem arises when Ant is run from a container such as the\nNetBeans IDE, for then the class loader which loads Ant core classes is not the\napp class loader. For example, consider this script:\n\n<project default=\"fail\">\n    <property name=\"antcontrib.jar\"\nlocation=\"/tmp/ant-contrib/lib/ant-contrib-1.0b1.jar\"/>\n    <target name=\"automatic\">\n        <ac:urlencode xmlns:ac=\"antlib:net.sf.antcontrib\" name=\"encoded\"\nvalue=\"hey there\"/>\n        <echo>${encoded}</echo>\n    </target>\n    <target name=\"taskdef-implicit\">\n        <taskdef resource=\"net/sf/antcontrib/antlib.xml\"/>\n        <urlencode name=\"encoded\" value=\"hey there\"/>\n        <echo>${encoded}</echo>\n    </target>\n    <target name=\"taskdef-explicit\">\n        <taskdef resource=\"net/sf/antcontrib/antlib.xml\"\nclasspath=\"${antcontrib.jar}\"/>\n        <urlencode name=\"encoded\" value=\"hey there\"/>\n        <echo>${encoded}</echo>\n    </target>\n</project>\n\nIf antcontrib.jar is in the $CLASSPATH or passed to Ant via -lib, all three\ntargets work. In the IDE, only taskdef-explicit works even if antcontrib.jar is\nadded to the class loader used by Ant core classes (NetBeans #46171)... unless\nyou patch the IDE to set Path.systemClassPath to a path containing the JARs in\nthat class loader. The default value of Path.sCP is taken from the system\nproperty ${java.class.path}, which could be just about anything, related to Ant\nor not. (Ant's launcher hacks around that by faking java.class.path.)\n\nSince I know of a workaround for the IDE, I am only submitting this patch for\nconsideration by committers, lest other Ant integrators beat their heads against\nthe wall over this problem.\n\nNote that there is a problem with the patch (which is I believe unavoidable\nunless you set CL.parent correctly, or override CL.getResources in JDK 1.5 where\nit seems to be nonfinal): if CL.parent (whatever that is) does have any matches\nfor the resource name, and ACL.parent has matches for it that are in fact\nderived ultimately from CL.parent, ACL.getResources will produce duplicates. I\nput in a quick hack to avoid this in case CL.parent == ACL.parent, but for a\nmore general fix I suppose you would have to call CL.parent.getResources and\nremove all such matches before returning them from ACL.findResources. I have not\ntried such a refinement yet.", "id": 60720, "time": "2004-07-16T22:53:45Z", "creator": "jglick@apache.org", "creation_time": "2004-07-16T22:53:45Z", "is_private": false}, {"attachment_id": 12130, "tags": [], "bug_id": 30161, "text": "Created attachment 12130\nPossible patch; note: includes API addition in CollectionUtils", "count": 1, "id": 60721, "time": "2004-07-16T22:54:35Z", "creator": "jglick@apache.org", "creation_time": "2004-07-16T22:54:35Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 30161, "text": "See also related bug #21635.", "count": 2, "id": 60722, "time": "2004-07-16T22:55:29Z", "creator": "jglick@apache.org", "creation_time": "2004-07-16T22:55:29Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 30161, "attachment_id": null, "text": "see also related bug 28782", "id": 60767, "time": "2004-07-18T14:34:00Z", "creator": "antoine@apache.org", "creation_time": "2004-07-18T14:34:00Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 30161, "text": "Jesse, could you add a unit test for this patch ?\nOr at least tell us in words how this should be tested ?", "count": 4, "id": 60786, "time": "2004-07-19T06:49:38Z", "creator": "antoine@apache.org", "creation_time": "2004-07-19T06:49:38Z", "is_private": false}, {"count": 5, "tags": [], "creator": "jglick@apache.org", "attachment_id": 12195, "id": 61004, "time": "2004-07-22T22:13:58Z", "bug_id": 30161, "creation_time": "2004-07-22T22:13:58Z", "is_private": false, "text": "Created attachment 12195\nRevised patch; includes unit test"}, {"count": 6, "tags": [], "creator": "antoine@apache.org", "attachment_id": null, "id": 61175, "time": "2004-07-27T07:17:35Z", "bug_id": 30161, "creation_time": "2004-07-27T07:17:35Z", "is_private": false, "text": "Thanks very much for the submission, Jesse. :-)\nPatches submitted in HEAD and ANT_16_BRANCH\n"}]
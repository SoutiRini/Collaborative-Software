[{"count": 0, "attachment_id": 34947, "bug_id": 61034, "is_private": false, "id": 198503, "time": "2017-04-24T22:05:30Z", "creator": "mauricio.eastmond@gmail.com", "creation_time": "2017-04-24T22:05:30Z", "tags": [], "text": "Created attachment 34947\nuse this xlsx file to reproduce the issue.\n\nCall to XSSFReader.getSheetsData() returns duplicate sheets.\n\nThe attached xlsx file contains 6 sheets: Sheet1, Sheet2, ..., Sheet6.\n\nThe call to XSSFReader.getSheetsData() should return the 6 sheets in the iterator but it is returning 12 sheets. Each sheet is duplicated.\n\nSteps to reproduce:\n\nRun this code using the attached xlsx file:\n\nOPCPackage p = OPCPackage.open(sourceFilePath);\nXSSFReader reader = new XSSFReader(p);\nXSSFReader.SheetIterator iter = (XSSFReader.SheetIterator) reader.getSheetsData();\nwhile (iter.hasNext()) {\n  InputStream stream = iter.next();\n  String sheetName = iter.getSheetName();\n  stream.close();\n  System.out.println(sheetName);\n}\n\nThe output is:\nSheet1\nSheet1\nSheet2\nSheet2\nSheet3\nSheet3\nSheet4\nSheet4\nSheet5\nSheet5\nSheet6\nSheet6\n\nThe expected output is:\nSheet1\nSheet2\nSheet3\nSheet4\nSheet5\nSheet6"}, {"count": 1, "tags": [], "text": "Created attachment 34964\nProposed fix for XSSFReader.XMLSheetRefReader\n\nHi,\n\nWe've run into the same issue with the new version of the library. The problem seems to be caused only by those xlsx files which have a specific order of the attributes inside the <sheet> tag of workbook.xml \n\nExample (which causes the problems):\n<sheet name=\"Sheet6\" r:id=\"rId6\" sheetId=\"4\"/>\n\nWhile this one works correctly:\n<sheet name=\"Sheet6\" sheetId=\"4\" r:id=\"rId6\"/>\n\nI've traced the root cause to a possible coding error in XMLSheetRefReader, for which I'm now providing a patch. I haven't tested it very thoroughly, but it seems to fix the problem.", "is_private": false, "bug_id": 61034, "id": 198594, "time": "2017-04-29T11:25:45Z", "creator": "sebastian.1.wikalinski@nokia.com", "creation_time": "2017-04-29T11:25:45Z", "attachment_id": 34964}, {"count": 2, "attachment_id": null, "bug_id": 61034, "is_private": false, "id": 198596, "time": "2017-04-29T17:28:58Z", "creator": "onealj@apache.org", "creation_time": "2017-04-29T17:28:58Z", "tags": [], "text": "Mauricio, thanks for the Excel test file, test case!\nSebastian, thanks for the fix!\n\nApplied in r1793223. Will be included in POI 3.17-beta1.\n\nhttps://svn.apache.org/viewvc?view=revision&revision=1793223"}, {"count": 3, "tags": [], "bug_id": 61034, "attachment_id": null, "text": "Sorry, all.  1) shouldn't have introduced this and 2) should have caught this with tika-eval...argh.\n\nThank you for reporting this and supplying a patch.  Thank you, Javen!", "id": 198696, "time": "2017-05-05T14:04:55Z", "creator": "tallison@mitre.org", "creation_time": "2017-05-05T14:04:55Z", "is_private": false}]
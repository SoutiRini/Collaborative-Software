[{"count": 0, "tags": [], "text": "Error seen shutting down the Windows daemon version of Tomcat 5.5.23:\n\nWARNING: Error while removing context [/rbodkin]\njava.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:841)\n\tat java.util.HashMap$EntryIterator.next(HashMap.java:883)\n\tat java.util.HashMap$EntryIterator.next(HashMap.java:881)\n\tat java.util.HashMap.putAllForCreate(HashMap.java:481)\n\tat java.util.HashMap.clone(HashMap.java:713)\n\tat org.apache.catalina.loader.WebappClassLoader.clearReferences\n(WebappClassLoader.java:1592)\n\tat org.apache.catalina.loader.WebappClassLoader.stop\n(WebappClassLoader.java:1496)\n\tat org.apache.catalina.loader.WebappLoader.stop(WebappLoader.java:734)\n\tat org.apache.catalina.core.StandardContext.stop\n(StandardContext.java:4398)\n\tat org.apache.catalina.core.ContainerBase.removeChild\n(ContainerBase.java:893)\n\tat org.apache.catalina.startup.HostConfig.undeployApps\n(HostConfig.java:1180)\n\tat org.apache.catalina.startup.HostConfig.stop(HostConfig.java:1151)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:313)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:120)\n\tat org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1055)\n\tat org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1067)\n\tat org.apache.catalina.core.StandardEngine.stop\n(StandardEngine.java:448)\n\tat org.apache.catalina.core.StandardService.stop\n(StandardService.java:510)\n\tat org.apache.catalina.core.StandardServer.stop\n(StandardServer.java:734)\n\tat org.apache.catalina.startup.Catalina.stop(Catalina.java:602)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:577)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:295)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:433)", "attachment_id": null, "bug_id": 42950, "id": 105817, "time": "2007-07-21T14:22:04Z", "creator": "rbodkin+LISTS@gmail.com", "creation_time": "2007-07-21T14:22:04Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 42950, "attachment_id": null, "text": "Does this happen on every shutdown?  does the user running tomcat have full\npermission to the context /rbodkin?  ", "id": 105913, "time": "2007-07-24T10:36:22Z", "creator": "ryan@sourcelabs.com", "creation_time": "2007-07-24T10:36:22Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 42950, "attachment_id": null, "text": "Sorry I didn't see this question until just now.  The user in question did have\nwrite permission to the directory (it was on Windows, running as an\nadministrator) and the error is not often seen.\n", "id": 107837, "time": "2007-09-07T16:22:17Z", "creator": "rbodkin+LISTS@gmail.com", "creation_time": "2007-09-07T16:22:17Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 42950, "attachment_id": null, "text": "\nWe recently started using some axis2 services and started getting this issue on\nshutdown.  It is not always repeatable by starting up tomcat (catalina.sh start)\nthen stopping tomcat (catalina.sh stop) - depends on thread timing.  Note that\nwhen this exception is thrown, tomcat does not shutdown.\n\nThere appears to be some ThreadPoolExecutor.shutdown activity during shutdown of\naxis2 that causes class loading.  This class loading activity happens while\ntomcat is attempting to call WebappClassLoader.clearReferences.  In\nclearReferences, resourceEntries.clone is called which causes the\nConcurrentModificationException to occur because of the conflicting call to\nresourceEntries.put on line 2134.\n\nThe following patch to WebappClassLoader.java (of tomcat 5.5.23) worked for us:\n\n@@ -1589,7 +1589,12 @@\n\n         // Null out any static or final fields from loaded classes,\n         // as a workaround for apparent garbage collection bugs\n-        Iterator loadedClasses = ((HashMap)\nresourceEntries.clone()).values().iterator();\n+        HashMap resourceEntriesClone = null;\n+        synchronized(resourceEntries)\n+        {\n+            resourceEntriesClone = (HashMap) resourceEntries.clone();\n+        }\n+        Iterator loadedClasses = resourceEntriesClone.values().iterator();\n         while (loadedClasses.hasNext()) {\n             ResourceEntry entry = (ResourceEntry) loadedClasses.next();\n             if (entry.loadedClass != null) {\n\n", "id": 107985, "time": "2007-09-10T11:52:53Z", "creator": "clucas@e-miles.com", "creation_time": "2007-09-10T11:52:53Z", "is_private": false}, {"count": 4, "tags": [], "text": "Hello,\n\nWe're noticing the same problem, using Tomcat started by the cargo maven plugin,\nrun from TeamCity build server on Linux.\n\n[00:10:07]: [INFO] [cargo:stop {execution: stop}]\n[00:10:07]: [INFO] [talledLocalContainer] Tomcat 5.5.23 is stopping...\n[00:10:07]: [INFO] [talledLocalContainer] Dec 3, 2007 12:10:07 AM\norg.apache.coyote.http11.Http11BaseProtocol pause\n[00:10:07]: [INFO] [talledLocalContainer] Dec 3, 2007 12:10:07 AM\norg.apache.coyote.http11.Http11BaseProtocol pause\n[00:10:07]: [INFO] [talledLocalContainer] INFO: Pausing Coyote HTTP/1.1 on http-9090\n[00:10:07]: [INFO] [talledLocalContainer] INFO: Pausing Coyote HTTP/1.1 on http-9090\n[00:10:08]: [INFO] [talledLocalContainer] Dec 3, 2007 12:10:08 AM\norg.apache.catalina.core.StandardService stop\n[00:10:08]: [INFO] [talledLocalContainer] Dec 3, 2007 12:10:08 AM\norg.apache.catalina.core.StandardService stop\n[00:10:08]: [INFO] [talledLocalContainer] INFO: Stopping service Catalina\n[00:10:08]: [INFO] [talledLocalContainer] INFO: Stopping service Catalina\n[00:10:08]: [INFO] [talledLocalContainer]\njava.lang.reflect.InvocationTargetException\n[00:10:08]: [INFO] [talledLocalContainer]\njava.lang.reflect.InvocationTargetException\n[00:10:08]: [INFO] [talledLocalContainer] at\nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n[00:10:08]: [INFO] [talledLocalContainer] at\nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n[00:10:08]: [INFO] [talledLocalContainer] at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n[00:10:08]: [INFO] [talledLocalContainer] at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n[00:10:08]: [INFO] [talledLocalContainer] at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n[00:10:08]: [INFO] [talledLocalContainer] at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.lang.reflect.Method.invoke(Method.java:585)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.lang.reflect.Method.invoke(Method.java:585)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Bootstrap.start(Bootstrap.java:295)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Bootstrap.start(Bootstrap.java:295)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Bootstrap.main(Bootstrap.java:433)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Bootstrap.main(Bootstrap.java:433)\n[00:10:08]: [INFO] [talledLocalContainer] Caused by:\njava.util.ConcurrentModificationException\n[00:10:08]: [INFO] [talledLocalContainer] Caused by:\njava.util.ConcurrentModificationException\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap$HashIterator.nextEntry(HashMap.java:841)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap$HashIterator.nextEntry(HashMap.java:841)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap$EntryIterator.next(HashMap.java:883)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap$EntryIterator.next(HashMap.java:883)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap$EntryIterator.next(HashMap.java:881)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap$EntryIterator.next(HashMap.java:881)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap.putAllForCreate(HashMap.java:481)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap.putAllForCreate(HashMap.java:481)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap.clone(HashMap.java:713)\n[00:10:08]: [INFO] [talledLocalContainer] at\njava.util.HashMap.clone(HashMap.java:713)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.loader.WebappClassLoader.clearReferences(WebappClassLoader.java:1592)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.loader.WebappClassLoader.clearReferences(WebappClassLoader.java:1592)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:1496)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:1496)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.loader.WebappLoader.stop(WebappLoader.java:734)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.loader.WebappLoader.stop(WebappLoader.java:734)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardContext.stop(StandardContext.java:4398)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardContext.stop(StandardContext.java:4398)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1067)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1067)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1067)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1067)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardEngine.stop(StandardEngine.java:448)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardEngine.stop(StandardEngine.java:448)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardService.stop(StandardService.java:510)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardService.stop(StandardService.java:510)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardServer.stop(StandardServer.java:734)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.core.StandardServer.stop(StandardServer.java:734)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Catalina.stop(Catalina.java:602)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Catalina.stop(Catalina.java:602)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Catalina.start(Catalina.java:577)\n[00:10:08]: [INFO] [talledLocalContainer] at\norg.apache.catalina.startup.Catalina.start(Catalina.java:577)\n[00:10:08]: [INFO] [talledLocalContainer] ... 6 more\n[00:10:08]: [INFO] [talledLocalContainer] ... 6 more", "attachment_id": null, "bug_id": 42950, "id": 111337, "time": "2007-12-03T01:34:04Z", "creator": "daniel.leong@sns.bskyb.com", "creation_time": "2007-12-03T01:34:04Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 42950, "attachment_id": null, "text": "The clear references fucntionality was provided to work around libraries that didn't clean up after themselves or provide hooks to enable the developer to do so. The downside is that it can cause odd behaviour such as seen here.\n\nIn an ideal world you shouldn't need this feature and if it causes issues you can disbale it using the option:\n-Dorg.apache.catalina.loader.WebappClassLoader.ENABLE_CLEAR_REFERENCES=false\n\nDo you still see this issue with clear references disabled?", "id": 114381, "time": "2008-03-06T13:34:25Z", "creator": "markt@apache.org", "creation_time": "2008-03-06T13:34:25Z", "is_private": false}, {"count": 6, "tags": [], "text": "No response in over two months so marking as wntfix on the basis that disabling reference clearing will fix the issue.", "attachment_id": null, "bug_id": 42950, "id": 116350, "time": "2008-05-07T10:29:55Z", "creator": "markt@apache.org", "creation_time": "2008-05-07T10:29:55Z", "is_private": false}, {"count": 7, "tags": [], "creator": "milkygto@gmail.com", "attachment_id": null, "id": 125219, "time": "2009-02-27T11:12:02Z", "bug_id": 42950, "creation_time": "2009-02-27T11:12:02Z", "is_private": false, "text": "This also happen when redeploy the war. I am getting the same exception inside eclipse using eclipse WTP during republish.\n\nWARNING: Exception processing loader WebappLoader[/example] background process\njava.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)\n\tat java.util.HashMap$EntryIterator.next(HashMap.java:834)\n\tat java.util.HashMap$EntryIterator.next(HashMap.java:832)\n\tat java.util.HashMap.putAllForCreate(HashMap.java:435)\n\tat java.util.HashMap.clone(HashMap.java:669)\n\tat org.apache.catalina.loader.WebappClassLoader.clearReferences(WebappClassLoader.java:1621)\n\tat org.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:1524)\n\tat org.apache.catalina.loader.WebappLoader.stop(WebappLoader.java:707)\n\tat org.apache.catalina.core.StandardContext.stop(StandardContext.java:4557)\n\tat org.apache.catalina.core.StandardContext.reload(StandardContext.java:3093)\n\tat org.apache.catalina.loader.WebappLoader.backgroundProcess(WebappLoader.java:404)\n\tat org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1309)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1601)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1590)\n\tat java.lang.Thread.run(Thread.java:637)\n\nWhen I set -Dorg.apache.catalina.loader.WebappClassLoader.ENABLE_CLEAR_REFERENCES=false, I am getting a bunch of illegalStateException because the class is already loaded in the classloader.\n\nFeb 27, 2009 11:11:11 AM org.apache.catalina.loader.WebappClassLoader findResourceInternal\nINFO: Illegal access: this web application instance has been stopped already.  Could not load META-INF/services/javax.xml.transform.TransformerFactory.  The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact.\nFeb 27, 2009 11:11:11 AM org.apache.catalina.loader.WebappClassLoader loadClass\nINFO: Illegal access: this web application instance has been stopped already.  Could not load com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl.  The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact.\njava.lang.IllegalStateException\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1273)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1233)\n\tat javax.xml.transform.FactoryFinder.getProviderClass(FactoryFinder.java:111)\n\tat javax.xml.transform.FactoryFinder.newInstance(FactoryFinder.java:146)\n\tat javax.xml.transform.FactoryFinder.find(FactoryFinder.java:233)\n\tat javax.xml.transform.TransformerFactory.newInstance(TransformerFactory.java:102)"}, {"count": 8, "text": "This also happen when redeploy the war. I am getting the same exception inside eclipse using eclipse WTP during republish.\n\nWARNING: Exception processing loader WebappLoader[/example] background process\njava.util.ConcurrentModificationException\n\tat java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)\n\tat java.util.HashMap$EntryIterator.next(HashMap.java:834)\n\tat java.util.HashMap$EntryIterator.next(HashMap.java:832)\n\tat java.util.HashMap.putAllForCreate(HashMap.java:435)\n\tat java.util.HashMap.clone(HashMap.java:669)\n\tat org.apache.catalina.loader.WebappClassLoader.clearReferences(WebappClassLoader.java:1621)\n\tat org.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:1524)\n\tat org.apache.catalina.loader.WebappLoader.stop(WebappLoader.java:707)\n\tat org.apache.catalina.core.StandardContext.stop(StandardContext.java:4557)\n\tat org.apache.catalina.core.StandardContext.reload(StandardContext.java:3093)\n\tat org.apache.catalina.loader.WebappLoader.backgroundProcess(WebappLoader.java:404)\n\tat org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1309)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1601)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1590)\n\tat java.lang.Thread.run(Thread.java:637)\n\nWhen I set -Dorg.apache.catalina.loader.WebappClassLoader.ENABLE_CLEAR_REFERENCES=false, I am getting a bunch of illegalStateException because the class is already loaded in the classloader.\n\nFeb 27, 2009 11:11:11 AM org.apache.catalina.loader.WebappClassLoader findResourceInternal\nINFO: Illegal access: this web application instance has been stopped already.  Could not load META-INF/services/javax.xml.transform.TransformerFactory.  The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact.\nFeb 27, 2009 11:11:11 AM org.apache.catalina.loader.WebappClassLoader loadClass\nINFO: Illegal access: this web application instance has been stopped already.  Could not load com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl.  The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact.\njava.lang.IllegalStateException\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1273)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1233)\n\tat javax.xml.transform.FactoryFinder.getProviderClass(FactoryFinder.java:111)\n\tat javax.xml.transform.FactoryFinder.newInstance(FactoryFinder.java:146)\n\tat javax.xml.transform.FactoryFinder.find(FactoryFinder.java:233)\n\tat javax.xml.transform.TransformerFactory.newInstance(TransformerFactory.java:102)", "bug_id": 42950, "attachment_id": null, "id": 125220, "time": "2009-02-27T11:12:03Z", "creator": "milkygto@gmail.com", "creation_time": "2009-02-27T11:12:03Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 42950, "attachment_id": null, "text": "Do you still get this error if you do not use WTP? If so, please provide the simplest possible test WAR that demonstrates the issue.", "id": 125223, "time": "2009-02-27T13:56:52Z", "creator": "markt@apache.org", "creation_time": "2009-02-27T13:56:52Z", "is_private": false}, {"count": 10, "tags": [], "creator": "markt@apache.org", "text": "No test case, therefore assume disabling the clear references functionality fixes the issue.", "id": 126162, "time": "2009-04-09T07:13:53Z", "bug_id": 42950, "creation_time": "2009-04-09T07:13:53Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 42791, "text": "Classes containing runtime visible annotations are invalid when processed by BCEL.\n\nExample use case:\n\nThe class to be processed:\n\n@javax.persistence.Entity\npublic class Item {\n}\n\n\n\nHere the code snippets we are using to process the class:\n\nClassGen classGen = new ClassGen(javaClass);\n...\n// perform changes\n...\nJavaClass result = classGen.getJavaClass();\n\n\n\nThe result contains now two attributes \"RuntimeVisibleAnnotation\" which is invalid.\n\n\n\nFix for the problem:\n\norg.apache.bcel.generic.ClassGen:\n\nOn line 145 the list of attributes should not be filled with the annoation\nattributes, as they are appended later anyways.\n\nOriginal code:\n\nfor (int i = 0; i < attributes.length; i++) {\n  addAttribute(attributes[i]);\n}\n\nCorrect code:\nfor (int i = 0; i < attributes.length; i++) {\n  if (!(attributes[i] instanceof Annotations)) {\n    addAttribute(attributes[i]);\n  }\n}", "id": 104978, "time": "2007-07-02T02:14:07Z", "creator": "reinhard.pilz@dynatrace.com", "creation_time": "2007-07-02T02:14:07Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "douglasdenny@gmail.com", "text": "mod_jk on Solaris 8 and Solaris 10 does not send keep_alives.\n\nOur major government site has been using Mod_jk for over four years. Running on\nSolaris 8, and having keep_alives=1 set, we would not see any keep_alive\nactivity. We recently moved to Solaris 10 and have seen the same issue. We are\nrunning the pre-compiled binary from 13 July 2005 - JK-1.2.14. \n\nThis causes a problem with our firewall-rich environment, and the firewall\nconnection timeouts have to be set to one day and the tomcats restarted nightly\nto ensure that we do not drop any connections between our webserver and\napplication servers.\n\n-Doug", "id": 86538, "time": "2006-03-06T18:35:32Z", "bug_id": 38869, "creation_time": "2006-03-06T18:35:32Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "It works. I tried with Solaris 10, mod_jk 1.2.15 (!) and apache 2.0.55.\n\nThe name of the attribute for a worker in workers.properties file (set by\nJkWorkersFile) is socket_keepalive, like in\n\nworker.list=single\nworker.single.type=ajp13\nworker.single.host=mytomcat\nworker.single.port=21109\nworker.single.socket_keepalive=1\n\nIf I set it like that and connect a httpd process (apache I used 2.0.55) to\ntomcat, then I can see in Solaris pfiles:\n\n...\n  17: S_IFSOCK mode:0666 dev:294,0 ino:47164 uid:0 gid:0 size:0\n      O_RDWR\n        SOCK_STREAM\n        SO_KEEPALIVE,SO_SNDBUF(49152),SO_RCVBUF(49152)\n        sockname: AF_INET 192.168.0.220  port: 33689\n        peername: AF_INET 192.168.0.220  port: 21109\n\nI use Solaris 10. Please note \"SO_KEEPALIVE\", so the socket option is set\ncorrectly. Please very for your setup using pfiles.\n\nAlso note, that you should check in your mod_jk.log using JkLogLevel debug or\nbetter trace, that during apache startup you find:\n\n[Mon Mar 06 22:08:43 2006] [3832:0001] [trace] init::jk_ajp13_worker.c (47): enter\n[Mon Mar 06 22:08:43 2006] [3832:0001] [trace] ajp_init::jk_ajp_common.c (1879):\nenter\n[Mon Mar 06 22:08:43 2006] [3832:0001] [debug] ajp_init::jk_ajp_common.c (1895):\nsetting socket keepalive to 1\n...\n\nand during connect:\n\n[Mon Mar 06 22:11:14 2006] [3838:0001] [trace] ajp_send_request::jk_ajp_common.c\n(1166): enter\n[Mon Mar 06 22:11:14 2006] [3838:0001] [trace]\najp_connect_to_endpoint::jk_ajp_common.c (856): enter\n[Mon Mar 06 22:11:14 2006] [3838:0001] [trace] jk_open_socket::jk_connect.c\n(308): enter\n[Mon Mar 06 22:11:14 2006] [3838:0001] [debug] jk_open_socket::jk_connect.c\n(328): socket TCP_NODELAY set to On\n[Mon Mar 06 22:11:14 2006] [3838:0001] [debug] jk_open_socket::jk_connect.c\n(341): socket SO_KEEPALIVE set to On\n\nYou can check the keep alive interval by:\n\nmyapache% ndd -get /dev/tcp tcp_keepalive_interval\n7200000\n\nThis is the default for Solaris 8, 9 and 10. The unit is milliseconds, so by\ndefault keep alive packets are not send before expiration of 7200 seconds = 2\nhours. Maybe someone tuned that parameter on your old system.\n\nI manually set the interval to a very short value to check:\n\n# ndd -set /dev/tcp tcp_keepalive_interval 20000\n# ndd -get /dev/tcp tcp_keepalive_interval\n20000\n\nAfter restarting apache and conecting to tomcat I sniffed the connection and voila:\n\n  1 22:36:7.66269      myapache -> mytomcat     TCP D=21109 S=33730 Push\nAck=1181356454 Seq=256221097 Len=1 Win=49640\n  2 22:36:7.66288      mytomcat -> myapache     TCP D=33730 S=21109\nAck=256221098 Seq=1181356454 Len=0 Win=49561\n  3 22:36:27.67494     myapache -> mytomcat     TCP D=21109 S=33730 Push\nAck=1181356454 Seq=256221097 Len=1 Win=49640\n  4 22:36:27.67514     mytomcat -> myapache     TCP D=33730 S=21109\nAck=256221098 Seq=1181356454 Len=0 Win=49561\n  5 22:36:47.68717     myapache -> mytomcat     TCP D=21109 S=33730 Push\nAck=1181356454 Seq=256221097 Len=1 Win=49640\n  6 22:36:47.68737     mytomcat -> myapache     TCP D=33730 S=21109\nAck=256221098 Seq=1181356454 Len=0 Win=49561\n\nIf you need to discuss mod_jk configuration further please use tomcat-users.\nConcerning Solaris and TCP-Tuning you should use another appropriate forum.", "id": 86548, "time": "2006-03-06T21:41:21Z", "bug_id": 38869, "creation_time": "2006-03-06T21:41:21Z", "is_private": false}]
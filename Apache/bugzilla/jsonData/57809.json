[{"count": 0, "tags": [], "text": "Created attachment 32647\nsimple patch\n\nI analyzed several heap dumps to find out why for small applications Tomcat uses more memory than Jetty. Some of this seems to come from the fact that for ever web application a merged web.xml is stored in memory. A comment in ContextConfig suggests that this was once necessary for Jasper but it looks as if the relevant TODO has been fixed by now.\n\nOn a default Tomcat with the default applications this saves about 1MB.", "is_private": false, "id": 182336, "creator": "kustos@gmx.net", "time": "2015-04-13T17:07:37Z", "bug_id": 57809, "creation_time": "2015-04-13T17:07:37Z", "attachment_id": 32647}, {"count": 1, "tags": [], "text": "The constant doesn't look like it is used, but this may not be such a good idea. I'll leave the BZ open for further review.", "attachment_id": null, "bug_id": 57809, "id": 182338, "time": "2015-04-13T17:15:48Z", "creator": "remm@apache.org", "creation_time": "2015-04-13T17:15:48Z", "is_private": false}, {"count": 2, "tags": [], "text": "In Tomcat 7 the MERGED_WEB_XML (\"org.apache.tomcat.util.scan.MergedWebXml\") attribute is used to pass web application configuration to Jasper.\n\nIn Tomcat 8 it is unused, but it is used by Tomcat test cases (TestWebXml). Your \"simple patch\" will break the tests.\n\nIn theory, there can be 3rd party code that uses this feature.\n\n\nhttp://markmail.org/message/hqnuyvikofmfcbl2\n\"Offline generation of effective web.xml\" thread on 2012-09,\none of first discussions of this issue.", "attachment_id": null, "bug_id": 57809, "id": 182344, "time": "2015-04-14T00:59:11Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2015-04-14T00:59:11Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 57809, "attachment_id": null, "id": 182345, "time": "2015-04-14T05:30:07Z", "creator": "kustos@gmx.net", "creation_time": "2015-04-14T05:30:07Z", "is_private": false, "text": "Which part of TestWebXml does it break? The test compiles and 19/19 tests are green."}, {"count": 4, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 182350, "time": "2015-04-14T09:07:11Z", "bug_id": 57809, "creation_time": "2015-04-14T09:07:11Z", "text": "I think this can be useful for debugging and monitoring (management interfaces like this kind of stuff), but since this is a String it is probably not that useful for apps.\n\ntestWebXml mentions it but doesn't actually test it."}, {"count": 5, "tags": [], "text": "The flag to log the merged web.xml is still in there.", "is_private": false, "id": 182376, "creator": "kustos@gmx.net", "time": "2015-04-15T05:38:02Z", "bug_id": 57809, "creation_time": "2015-04-15T05:38:02Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Created attachment 32661\n2nd try at a patch\n\nUpdated patch:\n- keeps the constant but marks it as deprecated\n- keeps the switch to log the merged web.xml for debugging", "attachment_id": 32661, "bug_id": 57809, "id": 182487, "time": "2015-04-19T18:17:28Z", "creator": "kustos@gmx.net", "creation_time": "2015-04-19T18:17:28Z", "is_private": false}, {"count": 7, "tags": [], "text": "Thanks for the patch. I'd forgotten about this issue until after I had already fixed the code buy my approach was broadly similar.\n\nThe constant for the attribute name has been deprecated in 8.0.x and the constant and the use of it has been removed in 9.0.x.", "attachment_id": null, "bug_id": 57809, "id": 188616, "time": "2016-02-19T19:09:32Z", "creator": "markt@apache.org", "creation_time": "2016-02-19T19:09:32Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 40372, "attachment_id": null, "text": "I had a semi-working apache server on this system with httpd-2.2.2, PHP 4.1.4,\nand a slightly different configuration. I updated to 2.2.3/4.1.6 trying to get\nmod_dbd working with mysql (I've got it turned it off now as it's currently not\nfunctional), and now serving some php files causes the httpd children to\nseg-fault. I built everything with debugging on and with core dumping (as per\nthe great documentation) and running dbx on the core file gives the following...\n###############\nt@null (l@1) terminated by signal SEGV (Segmentation Fault)\n0xfffffd7ffeb9ad0a: _read+0x000a:       jae      _read+0x16     [\n0xfffffd7ffeb9ad16, .+0xc ]\nCurrent function is ap_mpm_pod_check\n   54       rc = read(fd, &c, 1);\n(dbx) print fd\nfd = 6\n(dbx) print &c\n&c = 0xfffffd7fffdff763 \"\"\n(dbx) print ap_mpm_pod_check\nap_mpm_pod_check = &ap_mpm_pod_check(ap_pod_t *pod) at 0x480990\n(dbx)\n###############\nIf you google for ap_mpm_pod_check, it seems there's a whole collection of other\npeople hitting possibly the same problem, but randomly. I can do it consistently\nwith a certain php file using xml templates (don't know if that's relevent).\n\nhttp://marc.theaimsgroup.com/?l=apache-modules&m=113940878609090&w=2\nhttp://marc.theaimsgroup.com/?l=apache-modules&m=114077364714463&w=2\nhttp://www.forbiddenweb.org/viewtopic.php?id=25875\n\nI'm not a dbx expert, or much of a programmer anymore, but I'd be willing to\nhelp whoever test patches / hunt down root cause / etc.\n\nThanks.\nJohn G.", "id": 92768, "time": "2006-08-31T00:46:19Z", "creator": "jgg@dolby.com", "creation_time": "2006-08-31T00:46:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 40372, "attachment_id": null, "id": 92791, "time": "2006-08-31T12:40:35Z", "creator": "rpluem@apache.org", "creation_time": "2006-08-31T12:40:35Z", "is_private": false, "text": "Could you please create a backtrace of all threads (aka thread apply all bt\nfull) with gdb from your core dump as described at\nhttp://httpd.apache.org/dev/debugging.html? That would be very helpful."}, {"count": 2, "tags": [], "bug_id": 40372, "attachment_id": null, "text": "Here's the backtrace as requested.\n#################\n(dbx) where\n  [1] _read(0x6, 0xfffffd7fffdff763, 0x1, 0x0, 0x1, 0xfffffd7fffdff75c), at \n0xfffffd7ffeb9ad0a\n  [2] read(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffeb8abab\n=>[3] ap_mpm_pod_check(pod = 0x4f0190), line 54 in \"pod.c\"\n  [4] child_main(child_num_arg = 3), line 1258 in \"worker.c\"\n  [5] make_child(s = 0x4cb0e0, slot = 3), line 1341 in \"worker.c\"\n  [6] perform_idle_server_maintenance(), line 1543 in \"worker.c\"\n  [7] server_main_loop(remaining_children_to_start = 0), line 1646 in \"worker.c\"\n  [8] ap_mpm_run(_pconf = 0x4c5a78, plog = 0x4f7c08, s = 0x4cb0e0), line 1748 \nin \"worker.c\"\n  [9] main(argc = 3, argv = 0xfffffd7fffdffb28), line 717 in \"main.c\"\n(dbx)\n", "id": 92806, "time": "2006-08-31T16:32:32Z", "creator": "jgg@dolby.com", "creation_time": "2006-08-31T16:32:32Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 40372, "attachment_id": null, "id": 92815, "time": "2006-08-31T19:29:20Z", "creator": "jgg@dolby.com", "creation_time": "2006-08-31T19:29:20Z", "is_private": false, "text": "I was able to use the same configuration and build everything on a \nLinux/gcc/Pentium 4 32-bit system, which seems not to exibit this problem. Next \nI'm going to try this on a Linux/gcc/Athlon64 64-bit system and see what \nhappens."}, {"count": 4, "tags": [], "text": "Same setup, but building without -xarch=amd64 (32-bit) has the same problem.\nLooks like Solaris doesn't like serving certain php/apache/mysql web pages.\nSomeone please look at this, as I think the problem exists on Linux as well,\njust not triggered as often. If you google for ap_mpm_pod_check you'll see other\npeople hitting this bug.\nThanks.\nJohn G. ", "attachment_id": null, "id": 93255, "creation_time": "2006-09-08T23:05:27Z", "time": "2006-09-08T23:05:27Z", "creator": "jgg@dolby.com", "bug_id": 40372, "is_private": false}, {"count": 5, "tags": [], "bug_id": 40372, "attachment_id": null, "id": 93256, "time": "2006-09-08T23:25:51Z", "creator": "nick@webthing.com", "creation_time": "2006-09-08T23:25:51Z", "is_private": false, "text": "(In reply to comment #4)\n> Same setup, but building without -xarch=amd64 (32-bit) has the same problem.\n> Looks like Solaris doesn't like serving certain php/apache/mysql web pages.\n\nErm, you never mentioned PHP before.\n\nIf you're using PHP with the worker MPM, all bets are off.\n"}, {"count": 6, "attachment_id": null, "creator": "nick@webthing.com", "text": "(In reply to comment #5)\n\n> Erm, you never mentioned PHP before.\n\nOh, yes you did.  My point still stands, though I don't know if it's the cause \nof your crash.  Are you in a position to try it either\n  (a) without PHP\nor\n  (b) with prefork MPM\nand report if you still get crashes, other things being equal?", "id": 93257, "time": "2006-09-08T23:48:57Z", "bug_id": 40372, "creation_time": "2006-09-08T23:48:57Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 40372, "text": "The backtrace posted isn't for the thread that crashed.  The \"thread apply\nbacktrace full\" command mentioned previously is for gdb.  If you can't find the\nright dbx incantation, post the output of pstack /path/to/corefile and pflags\n/path/to/corefile.\n", "id": 93282, "time": "2006-09-09T15:29:02Z", "creator": "trawick@apache.org", "creation_time": "2006-09-09T15:29:02Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 40372, "text": "I just rebuilt this on Solaris 10-x86_64 again, and in 64-bit mode again, this \ntime with --with-mpm=prefork. It still core dumps with the same php file where \nsimple php pages seem to work fine.\nHowever, it now dies in a different location. Here\u2019s the output from dbx, \nptrace, and pflags. It looks like this might be a libxml issue. I'll try to get \nsomeone from that project's attention.\n\n####### output from dbx #######\nt@null (l@1) program terminated by signal SEGV (Segmentation Fault)\nCurrent function is xmlXPathCacheNewString\n 2131               (cache->stringObjs->number != 0))\n(dbx) where                                                                  \n=>[1] xmlXPathCacheNewString(ctxt = 0xfffffd7fffdfdae0, val = 0x745370 \"\"), \nline 2131 in \"xpath.c\"\n  [2] xmlXPathCompLiteral(ctxt = 0x7a90d0), line 9889 in \"xpath.c\"\n  [3] xmlXPathCompPrimaryExpr(ctxt = 0x7a90d0), line 10060 in \"xpath.c\"\n  [4] xmlXPathCompFilterExpr(ctxt = 0x7a90d0), line 10084 in \"xpath.c\"\n  [5] xmlXPathCompPathExpr(ctxt = 0x7a90d0), line 10286 in \"xpath.c\"\n  [6] xmlXPathCompUnionExpr(ctxt = 0x7a90d0), line 10316 in \"xpath.c\"\n  [7] xmlXPathCompUnaryExpr(ctxt = 0x7a90d0), line 10356 in \"xpath.c\"\n  [8] xmlXPathCompMultiplicativeExpr(ctxt = 0x7a90d0), line 10381 in \"xpath.c\"\n  [9] xmlXPathCompAdditiveExpr(ctxt = 0x7a90d0), line 10422 in \"xpath.c\"\n  [10] xmlXPathCompRelationalExpr(ctxt = 0x7a90d0), line 10460 in \"xpath.c\"\n  [11] xmlXPathCompEqualityExpr(ctxt = 0x7a90d0), line 10514 in \"xpath.c\"\n  [12] xmlXPathCompAndExpr(ctxt = 0x7a90d0), line 10533 in \"xpath.c\"\n  [13] xmlXPathCompileExpr(ctxt = 0x7a90d0, sort = 1), line 10559 in \"xpath.c\"\n  [14] xmlXPathCtxtCompile(ctxt = 0xfffffd7fffdfdae0, str = \n0x7d6f6e \"$BACKGROUND != ''\"), line 14113 in \"xpath.c\"\n  [15] xsltXPathCompile(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffdd057f0 \n  [16] xsltIfComp(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffdd18561 \n  [17] xsltStylePreCompute(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffdd18c7e \n  [18] xsltPrecomputeStylesheet(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at \n0xfffffd7ffdd008eb \n  [19] xsltParseStylesheetProcess(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at \n0xfffffd7ffdd01de4 \n  [20] xsltParseStylesheetImportedDoc(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at \n0xfffffd7ffdd02060 \n  [21] xsltParseStylesheetDoc(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at \n0xfffffd7ffdd020d4 \n  [22] zif_xsl_xsltprocessor_import_stylesheet(ht = 1, return_value = 0x74a2b8, \nreturn_value_ptr = (nil), this_ptr = 0x74a1f8, return_value_used = 1), line 365 \nin \"xsltprocessor.c\"\n  [23] zend_do_fcall_common_helper_SPEC(execute_data = 0xfffffd7fffdfe678), \nline 200 in \"zend_vm_execute.h\"\n  [24] ZEND_DO_FCALL_BY_NAME_SPEC_HANDLER(execute_data = 0xfffffd7fffdfe678), \nline 322 in \"zend_vm_execute.h\"\n  [25] execute(op_array = 0x7400b8), line 92 in \"zend_vm_execute.h\"\n  [26] zend_execute_scripts(type = 8, retval = (nil), file_count = 3, ... = \n0x741f90, ...), line 1109 in \"zend.c\"\n  [27] php_execute_script(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffc9f5514 \n  [28] php_handler(r = 0x72a228), line 586 in \"sapi_apache2.c\"\n  [29] ap_run_handler(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0x459a51 \n  [30] ap_invoke_handler(r = 0x72a228), line 371 in \"config.c\"\n  [31] ap_process_request(r = 0x72a228), line 258 in \"http_request.c\"\n  [32] ap_process_http_connection(c = 0x724098), line 184 in \"http_core.c\"\n  [33] ap_run_process_connection(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0x466351 \n  [34] ap_process_connection(c = 0x724098, csd = 0x723da8), line 178 \nin \"connection.c\"\n  [35] child_main(child_num_arg = 0), line 640 in \"prefork.c\"\n  [36] make_child(s = 0x4c1b60, slot = 0), line 736 in \"prefork.c\"\n  [37] startup_children(number_to_start = 5), line 754 in \"prefork.c\"\n  [38] ap_mpm_run(_pconf = 0x4bc4f8, plog = 0x4ec678, s = 0x4c1b60), line 975 \nin \"prefork.c\"\n  [39] main(argc = 3, argv = 0xfffffd7fffdff318), line 717 in \"main.c\"\n\n####### output from pstack ########\n#>sudo pstack core.httpd.14439 \ncore 'core.httpd.14439' of 14439:       /usr/local/apache2/bin/httpd -k start\n fffffd7ffd960d9e xmlXPathCacheNewString () + 7e\n fffffd7ffd977e8a xmlXPathCompLiteral () + 56a\n fffffd7ffd978f9e xmlXPathCompPrimaryExpr () + 4ce\n fffffd7ffd9790ca xmlXPathCompFilterExpr () + 1a\n fffffd7ffd979fde xmlXPathCompPathExpr () + 72e\n fffffd7ffd97a34a xmlXPathCompUnionExpr () + 1a\n fffffd7ffd97aa54 xmlXPathCompUnaryExpr () + 2a4\n fffffd7ffd97ab7a xmlXPathCompMultiplicativeExpr () + 1a\n fffffd7ffd97b11a xmlXPathCompAdditiveExpr () + 1a\n fffffd7ffd97b58a xmlXPathCompRelationalExpr () + 1a\n fffffd7ffd97be46 xmlXPathCompEqualityExpr () + 346\n fffffd7ffd97c01a xmlXPathCompAndExpr () + 1a\n fffffd7ffd97c45d xmlXPathCompileExpr () + 1d\n fffffd7ffd9890aa xmlXPathCtxtCompile () + 8a\n fffffd7ffdd057f0 xsltXPathCompile () + 50\n fffffd7ffdd18561 xsltIfComp () + 71\n fffffd7ffdd18c7e xsltStylePreCompute () + 13e\n fffffd7ffdd008eb xsltPrecomputeStylesheet () + eb\n fffffd7ffdd01de4 xsltParseStylesheetProcess () + 54\n fffffd7ffdd02060 xsltParseStylesheetImportedDoc () + b0\n fffffd7ffdd020d4 xsltParseStylesheetDoc () + 14\n fffffd7ffc9e9be8 zif_xsl_xsltprocessor_import_stylesheet () + 1f8\n fffffd7ffcb0764c zend_do_fcall_common_helper_SPEC () + 55c\n fffffd7ffcb07e6a ZEND_DO_FCALL_BY_NAME_SPEC_HANDLER () + 2a\n fffffd7ffcb06fa4 execute () + 344\n fffffd7ffcab32e8 zend_execute_scripts () + 258\n fffffd7ffc9f5514 php_execute_script () + 4d4\n fffffd7ffcb7fec9 php_handler () + 7b9\n 0000000000459a51 ap_run_handler () + 81\n 000000000045a6c5 ap_invoke_handler () + 1b5\n 000000000047113b ap_process_request () + 7b\n 000000000046cd3c ap_process_http_connection () + cc\n 0000000000466351 ap_run_process_connection () + 81\n 000000000046694a ap_process_connection () + 7a\n 0000000000479058 child_main () + 5b8\n 00000000004792b3 make_child () + 1d3\n 0000000000479359 startup_children () + 69\n 000000000047991b ap_mpm_run () + 2ab\n 0000000000437633 main () + fd3\n 000000000043588c ???????? ()\n\n####### output from pflags #######\n#>sudo pflags core.httpd.14439 \ncore 'core.httpd.14439' of 14439:       /usr/local/apache2/bin/httpd -k start\n        data model = _LP64  flags = ORPHAN|MSACCT|MSFORK\n /1:    flags = 0\n        sigmask = 0xffffbefc,0x0000ffff  cursig = SIGSEGV\n#######", "id": 93477, "time": "2006-09-12T22:48:02Z", "creator": "jgg@dolby.com", "creation_time": "2006-09-12T22:48:02Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "text": "From that backtrace, this looks like an issue in PHP/libxslt/libxml. Try\nreporting this to PHP if you can reproduce it on the latest version of PHP.", "attachment_id": null, "id": 94432, "creation_time": "2006-10-03T07:14:08Z", "time": "2006-10-03T07:14:08Z", "creator": "jorton@redhat.com", "bug_id": 40372, "is_private": false}, {"count": 10, "attachment_id": null, "creator": "saurik@saurik.com", "text": "For the record, I just experienced this issue (in an /entirely/ different context) when I upgraded libxml2 out from underneath an existing installation of libxslt. Installing a newer libxslt solved the problem.", "id": 120948, "time": "2008-09-24T17:01:58Z", "bug_id": 40372, "creation_time": "2008-09-24T17:01:58Z", "tags": [], "is_private": false}]
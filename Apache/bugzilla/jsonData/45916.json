[{"count": 0, "tags": [], "bug_id": 45916, "text": "Created attachment 22647\nTest case.\n\nThe depend task (src/main/org/apache/tools/ant/taskdefs/optional/depend/Depend.java) tries not to delete classes for which it cannot find the source file (Depend.java:481). When deleting an inner class, it also tries to delete the top-level class (Depend.java:494 and further). But, in some cases, it deletes an inner classes without either of these checks (Depend.java:451). As the top-level class may be preserved, the following javac task may consider the classfile to be up-to-date, and may not compile the source, leading into a missing classfile for the inner class after compile.\n\nI am attaching a test case. Unpack the attachment, and execute the \"broken-depend.xml\" build script in the \"broken-depend\" directory (default target \"test-depend\"). The execution of the script fails because of a missing inner-class file.\n\nTested on ant 1.7.1:\n$ ant -version\nApache Ant version 1.7.1 compiled on June 27 2008\n\nNetBeans bug:\nhttp://www.netbeans.org/issues/show_bug.cgi?id=134606", "id": 121080, "time": "2008-09-30T04:41:36Z", "creator": "lahoda@gmail.com", "creation_time": "2008-09-30T04:41:36Z", "is_private": false, "attachment_id": 22647}, {"count": 1, "attachment_id": null, "bug_id": 45916, "text": "OK, it seems it depends on the JDK since the test seems to pass on JDK 1.4 (but to be totally sure I need to fix what looks like a JAR handle leak in <depend> first).\n\n\"the test\" is a modified version of your test that I committed as svn revision 702176.", "id": 121235, "time": "2008-10-06T08:26:18Z", "creator": "bodewig@apache.org", "creation_time": "2008-10-06T08:26:18Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 45916, "attachment_id": null, "id": 121238, "time": "2008-10-06T09:20:16Z", "creator": "bodewig@apache.org", "creation_time": "2008-10-06T09:20:16Z", "is_private": false, "text": "after fixing bug 45955 I can confirm that the problem doesn't show up on JDK 1.4.2, but this is because b.Main$1 doesn't seem to know that it depends on a.B at all.\n\nAm looking into fixing it for Java5+."}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "text": "fixed with svn revision 702901", "count": 3, "id": 121312, "time": "2008-10-08T08:05:10Z", "bug_id": 45916, "creation_time": "2008-10-08T08:05:10Z", "is_private": false}]
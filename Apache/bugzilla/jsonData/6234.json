[{"count": 0, "tags": [], "bug_id": 6234, "attachment_id": null, "is_private": false, "id": 10342, "time": "2002-02-04T23:07:07Z", "creator": "pfischer@bbn.com", "creation_time": "2002-02-04T23:07:07Z", "text": "Tomcat appears to be recycling PrintWriters.  After a particular PrintWriter's\ncheckError() method returns true, it always returns true (even after it is\nrecycled).  I submitted this as a minor bug since there is a simple workaround\n(just use getOutputStream()).  \n\nThe problem can be demonstrated using the following servlet:\n\n\n/**\n * To use this test:\n *\n * Hit the servlet with a browser.  \"Sending Data\" messages will be printed to\n * the brower window at a rate of one per second.  Hit the stop button on your\n * browser (causing checkError() to return true).  Repeat this until you get\n * a response where out.checkError() equals true before any data is sent\n * (it should only take about 5 tries).  This is the problem.\n *\n * From looking at the hashCodes, it looks like the PrintWriters are being\n * recycled and the checkError flag on these printWriters are never being\n * reset.\n *\n * Notice that this problem does not occur when using\n * response.getOutputStream().\n */\npublic class TestServlet extends HttpServlet {\n  public void doGet(HttpServletRequest request, HttpServletResponse response)\n    throws IOException {\n    response.setContentType(\"text/html\");\n    PrintWriter out = response.getWriter();\n\n    // Simple workaround.  Servlet will work correctly if following line is\n    // used instead.\n    //PrintWriter out = new PrintWriter(response.getOutputStream());\n\n    out.println(\"Entering Servlet:<BR>\");\n    out.println(\"<ul><li>out.hashCode(): \" + out.hashCode() + \"</li>\");\n    out.println(\"<li>out.checkError(): \" + out.checkError() + \"</li></ul>\");\n    while (!out.checkError())\n    {\n      try {Thread.currentThread().sleep(1000);} catch (Exception e) {}\n      out.println(\"Sending Data<BR>\");\n    }\n  }\n}"}, {"count": 1, "attachment_id": null, "bug_id": 6234, "text": "This is fixed now in the CVS HEAD, and will appear in 3.3.1-B1.", "id": 10347, "time": "2002-02-05T04:01:32Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-02-05T04:01:32Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "creator": "xshao@ebay.com", "attachment_id": 31848, "id": 176680, "time": "2014-07-25T07:40:20Z", "bug_id": 56771, "creation_time": "2014-07-25T07:40:20Z", "is_private": false, "text": "Created attachment 31848\nThe issue\n\nNameNotFoundException is thrown when the resource can't be found in this DirContext.\n\nIn the method BaseDirContext, it also goes through all the alternate or backup DirContexts to lookup the resource one by one until the resource is found.\nA NameNotFoundException is thrown in the alternate DirContext when the given resource name isn't in this DirContext.\n\n\ufeff  public final Object lookup(String name) throws NamingException {\n        // First check for aliases\n        if (!aliases.isEmpty()) {\n            AliasResult result = findAlias(name);\n            if (result.dirContext != null) {\n                return result.dirContext.lookup(result.aliasName);\n            }\n        }\n        \n        // Next do a standard lookup\n        Object obj = doLookup(name);\n\n        if (obj != null)\n            return obj;\n        \n        // Check the alternate locations\n        for (DirContext altDirContext : altDirContexts) {\n            try {\n                obj = altDirContext.lookup(\"/META-INF/resources\" + name);\n                if (obj != null)\n                    return obj;\n            } catch ( NamingException ex) {\n                // ignore\n            }\n        }\n        \n        // Really not found\n        throw new NameNotFoundException(\n                sm.getString(\"resources.notFound\", name));\n    }\n\n\nIt takes much CPU time.   It could be optimized by checking result is null or not.\n\nHere is the optimized code,\n    public final Object lookup(String name) throws NamingException {\n        // First check for aliases\n        Object obj = doLookupWithoutNFE(name);\n        if (obj != null) {\n            return obj;\n        }\n\n        // Really not found\n        throw new NameNotFoundException(\n                sm.getString(\"resources.notFound\", name));\n    }\n\n    protected Object doLookupWithoutNFE(String name) throws NamingException {\n        if (!aliases.isEmpty()) {\n            AliasResult result = findAlias(name);\n            if (result.dirContext != null) {\n                return result.dirContext.lookup(result.aliasName);\n            }\n        }\n        \n        // Next do a standard lookup\n        Object obj = doLookup(name);\n\n        if (obj != null)\n            return obj;\n        \n        // Check the alternate locations\n        String resourceName = \"/META-INF/resources\" + name;\n        for (DirContext altDirContext : altDirContexts) {\n            if (altDirContext instanceof BaseDirContext) {\n                obj = ((BaseDirContext)altDirContext).doLookupWithoutNFE(resourceName);\n            }\n            else {\n                try {\n                    obj = altDirContext.lookup(resourceName);\n                } catch ( NamingException ex) {\n                    // ignore\n                }\n            }\n            if (obj != null) {\n                return obj;\n            }\n        }\n        \n        //Return null instead\n        return null;\n    }"}, {"count": 1, "attachment_id": 31849, "creator": "xshao@ebay.com", "text": "Created attachment 31849\nPatch for BaseDirContext\n\nPatch for BaseDirContext", "id": 176681, "time": "2014-07-25T07:42:05Z", "bug_id": 56771, "creation_time": "2014-07-25T07:42:05Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "xshao@ebay.com", "text": "Created attachment 31850\nJProfiler snapshot after optimized", "id": 176682, "time": "2014-07-25T07:45:36Z", "bug_id": 56771, "creation_time": "2014-07-25T07:45:36Z", "is_private": false, "attachment_id": 31850}, {"count": 3, "tags": [], "bug_id": 56771, "attachment_id": null, "text": "Hi,\n\nThanks for the report and the patch.\nThis has been fixed in 7.0.x for 7.0.56 onwards.\n\nRegards,\nVioleta", "id": 176736, "time": "2014-07-29T04:53:09Z", "creator": "violetagg@apache.org", "creation_time": "2014-07-29T04:53:09Z", "is_private": false}]
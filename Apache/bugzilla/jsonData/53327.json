[{"count": 0, "tags": [], "bug_id": 53327, "attachment_id": 28859, "id": 159509, "time": "2012-05-30T08:50:40Z", "creator": "julien.ayme@gmail.com", "creation_time": "2012-05-30T08:50:40Z", "is_private": false, "text": "Created attachment 28859\nPatch for the test case, which shows the issue\n\nThe new DoubleFormatUtil class fails to format correctly doubles near Double.MIN_VALUE (0 <= value <= 1e-300) with precision between 300 and 340.\n\nI fixed the DoubleFormatUtil class and added a test case which shows the issue."}, {"count": 1, "tags": [], "text": "Created attachment 28860\nThe patched DoubleFormatUtil", "attachment_id": 28860, "bug_id": 53327, "id": 159510, "time": "2012-05-30T08:51:18Z", "creator": "julien.ayme@gmail.com", "creation_time": "2012-05-30T08:51:18Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 53327, "attachment_id": null, "id": 159617, "time": "2012-06-01T19:25:12Z", "creator": "gadams@apache.org", "creation_time": "2012-06-01T19:25:12Z", "is_private": false, "text": "applied at http://svn.apache.org/viewvc?rev=1345315&view=rev\n\nthanks julien, please review and close if satisfied"}, {"count": 3, "tags": [], "creator": "julien.ayme@gmail.com", "attachment_id": null, "text": "Thanks Glenn for applying the patch, everything seems fine after review.\nI'm closing the bug.", "id": 159639, "time": "2012-06-02T07:24:50Z", "bug_id": 53327, "creation_time": "2012-06-02T07:24:50Z", "is_private": false}, {"count": 4, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "text": "(In reply to comment #3)\n> Thanks Glenn for applying the patch, everything seems fine after review.\n> I'm closing the bug.\n\nI encountered a failure when running junit on XGC today as follows:\n\nTestcase: testAllDoubleRanges took 4.477 sec\n        FAILED\nvalue: 5.22534294505995E-4, decimals: 17, precision: 17 expected:<0.00052253429450[6]> but was:<0.00052253429450[599]>\njunit.framework.ComparisonFailure: value: 5.22534294505995E-4, decimals: 17, precision: 17 expected:<0.00052253429450[6]> but was:<0.00052253429450[599]>\n        at org.apache.xmlgraphics.util.DoubleFormatUtilTest.assertEquals(DoubleFormatUtilTest.java:223)\n        at org.apache.xmlgraphics.util.DoubleFormatUtilTest.testAllDoubleRanges(DoubleFormatUtilTest.java:531)\n\nHowever, on a re-attempt, it did not fail. Perhaps this is because you use random numbers in your test data.", "id": 159640, "time": "2012-06-02T20:22:18Z", "bug_id": 53327, "creation_time": "2012-06-02T20:22:18Z", "is_private": false}, {"count": 5, "tags": [], "creator": "julien.ayme@gmail.com", "attachment_id": null, "text": "I'll investigate on this particular value + precision on monday.", "id": 159641, "time": "2012-06-02T20:58:10Z", "bug_id": 53327, "creation_time": "2012-06-02T20:58:10Z", "is_private": false}, {"count": 6, "tags": [], "creator": "julien.ayme@gmail.com", "attachment_id": null, "text": "OK, I found the issue: in certain cases, the method \"tooCloseTooRound\" should return true so that the \"formatPrecise\" method is used instead of the \"formatFast\" method. So I tweaked the \"tooManyDigitsUsed\" and \"tooCloseTooRound\" methods a bit, so that they perform better.\n\nPatch will follow.", "id": 159669, "time": "2012-06-04T10:56:49Z", "bug_id": 53327, "creation_time": "2012-06-04T10:56:49Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 53327, "attachment_id": 28880, "id": 159670, "time": "2012-06-04T10:58:36Z", "creator": "julien.ayme@gmail.com", "creation_time": "2012-06-04T10:58:36Z", "is_private": false, "text": "Created attachment 28880\npatch for both class and test case (DoubleFormatUtil.java and DoubleFormatUtilTest.java)\n\nEnhanced DoubleFormatUtil.tooCloseTooRound + DoubleFormatUtil.tooManyDigitsUsed"}, {"count": 8, "tags": [], "bug_id": 53327, "attachment_id": null, "text": "The aim of these two methods (\"tooManyDigitsUsed\" and \"tooCloseTooRound\") is to force to use formatPrecise whenever we're not sure that formatFast will produce the right result, but only when formatFast fails, since formatPrecise is much slower (4 times) than formatFast.", "id": 159671, "time": "2012-06-04T11:00:20Z", "creator": "julien.ayme@gmail.com", "creation_time": "2012-06-04T11:00:20Z", "is_private": false}, {"count": 9, "tags": [], "text": "patch applied at http://svn.apache.org/viewvc?rev=1346092&view=rev\n\nthanks julien, please verify and close", "attachment_id": null, "bug_id": 53327, "id": 159677, "time": "2012-06-04T19:08:27Z", "creator": "gadams@apache.org", "creation_time": "2012-06-04T19:08:27Z", "is_private": false}, {"count": 10, "tags": [], "creator": "julien.ayme@gmail.com", "attachment_id": null, "text": "Verified, everything seems OK. Closing bug.", "id": 159698, "time": "2012-06-05T08:26:39Z", "bug_id": 53327, "creation_time": "2012-06-05T08:26:39Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 53327, "attachment_id": null, "id": 159705, "time": "2012-06-05T12:40:15Z", "creator": "julien.ayme@gmail.com", "creation_time": "2012-06-05T12:40:15Z", "is_private": false, "text": "I found the last (I hope) really rare bugs:\n- The first one is due to long <-> double conversion error in DoubleFormatUtil.format private method\n- The second is due to a rounding error in double division in DoubleFormatUtil.isRoundedToZero private method when rounding an exact value 5e-N value for certain value of N (when scale = N-1).\n\nPatch for test case and class will follow.\nHopefully I won't find any bug concerning this class anymore."}, {"count": 12, "tags": [], "bug_id": 53327, "attachment_id": 28891, "id": 159706, "time": "2012-06-05T12:41:02Z", "creator": "julien.ayme@gmail.com", "creation_time": "2012-06-05T12:41:02Z", "is_private": false, "text": "Created attachment 28891\nPatch n.2 for the test case"}, {"count": 13, "tags": [], "creator": "julien.ayme@gmail.com", "attachment_id": 28892, "text": "Created attachment 28892\nPatch n.2 for DoubleFormatUtil class", "id": 159707, "time": "2012-06-05T12:41:37Z", "bug_id": 53327, "creation_time": "2012-06-05T12:41:37Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 53327, "text": "apply patch n.2 at http://svn.apache.org/viewvc?rev=1346428&view=rev\n\nthanks julien, please review and close", "id": 159709, "time": "2012-06-05T15:49:30Z", "creator": "gadams@apache.org", "creation_time": "2012-06-05T15:49:30Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 53327, "attachment_id": null, "id": 159851, "time": "2012-06-11T08:23:31Z", "creator": "julien.ayme@gmail.com", "creation_time": "2012-06-11T08:23:31Z", "is_private": false, "text": "At last, everything seems OK !\n\nThank you again Glenn."}]
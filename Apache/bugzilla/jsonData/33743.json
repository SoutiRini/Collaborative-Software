[{"attachment_id": null, "tags": [], "creator": "ernst.matthias@gmail.com", "text": "WebAppClassLoader may fail if concurrent threads try to load a not-yet-loaded class.\n\nScenario:\ntwo threads enter loadClass(name, resolve) (line 1214) concurrently.\nnone of them finds a loaded class, so both enter findClass (827) and\nfindClassInternal (1559). \n\nNow one thread goes ahead, finds the resource and defines the class.\nConsequently, it sets entry.binaryContent to null (1633). Thread 2 now\nchecks binaryContent for null (1572) and throws a ClassNotFoundException.\n\nIn the field, this error occurs, if you start Tomcat and load a number of\ndifferent jsps concurrently that all use the same tag class.\n\nI also have a standalone testcase where I made WCL#addRepository(String,File)\npublic.\n\nAs it seems, #loadClass(String, boolean) (1211) should be synchronized, as in\nthe superclasses.\n\n\nMatthias", "count": 0, "id": 71534, "time": "2005-02-25T18:04:07Z", "bug_id": 33743, "creation_time": "2005-02-25T18:04:07Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 33743, "attachment_id": 14362, "id": 71536, "time": "2005-02-25T18:06:33Z", "creator": "ernst.matthias@gmail.com", "creation_time": "2005-02-25T18:06:33Z", "is_private": false, "text": "Created attachment 14362\nstandalone testcase\n\nTest produces output like the following:\n\nclass hox.util.Util\n\nintermingled with\n\njava.lang.ClassNotFoundException: hox.util.Util\n\tat\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1332)\n\n\tat\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1181)\n\n\tat org.apache.catalina.loader.test.WCT$1.run(WCT.java:35)"}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "text": "This will not be fixed for now.", "count": 2, "id": 71538, "time": "2005-02-25T18:11:28Z", "bug_id": 33743, "creation_time": "2005-02-25T18:11:28Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "ernst.matthias@gmail.com", "text": "Great. It leads to compiled JSP classes that do *not* recover by reloading. They\nhave a persistent \"NoClassDefFoundError\" attached.\n\nWill you apply the fix in 5.5 ?\n", "id": 71607, "time": "2005-02-28T13:27:28Z", "bug_id": 33743, "creation_time": "2005-02-28T13:27:28Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "No, I will not apply your proposed fix. As it is, I cannot reproduce any problem\nusing the provided tester (so if I cannot do it using a microtest, it is even\nless likely to occur in HTTP land). Maybe thread startup time is too slow on my\ntest machine.\n\nI see that there's a flaw in the current syncing, however, and I am willing to\napply the attached patch which should resolve the problem.", "attachment_id": null, "id": 72992, "creator": "remm@apache.org", "time": "2005-03-29T16:59:15Z", "bug_id": 33743, "creation_time": "2005-03-29T16:59:15Z", "is_private": false}, {"count": 5, "attachment_id": 14585, "creator": "remm@apache.org", "text": "Created attachment 14585\nSyncing when checking binaryContent==null", "id": 72993, "time": "2005-03-29T17:00:18Z", "bug_id": 33743, "creation_time": "2005-03-29T17:00:18Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 33743, "attachment_id": null, "id": 73290, "time": "2005-04-05T11:57:31Z", "creator": "remm@apache.org", "creation_time": "2005-04-05T11:57:31Z", "is_private": false, "text": "My patch should address the possible race on entry.binaryContent."}, {"count": 7, "tags": [], "bug_id": 33743, "text": "On which version is this fixed?\n(kind of urgent for me to know...thanks!)\n", "id": 82872, "time": "2005-11-25T21:53:22Z", "creator": "quartz12h@yahoo.com", "creation_time": "2005-11-25T21:53:22Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 33743, "attachment_id": null, "id": 83370, "time": "2005-12-07T16:23:52Z", "creator": "quartz12h@yahoo.com", "creation_time": "2005-12-07T16:23:52Z", "is_private": false, "text": "Hi, the bug was reported on 5.0.28, \nI've seen it on 5.0.27 and 5.0.30.\nA patch was made, but doesn't say which build is fixed.\n"}, {"count": 9, "tags": [], "text": "Fixed in 5.5.10 onwards.", "attachment_id": null, "id": 83378, "creator": "markt@apache.org", "time": "2005-12-07T20:12:05Z", "bug_id": 33743, "creation_time": "2005-12-07T20:12:05Z", "is_private": false}]
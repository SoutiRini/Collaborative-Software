[{"count": 0, "tags": [], "bug_id": 30068, "is_private": false, "id": 60531, "creation_time": "2004-07-13T10:11:38Z", "time": "2004-07-13T10:11:38Z", "creator": "flaviotordini@tiscali.it", "text": "hi all,\ninside a x:forEach loop, i put an x:out that evaluates an XPath expression on a\ndocument which is not same of the x:forEach.\nThe x:out seems to behave strangely. Take a look at following JSP:\n\n=======================\n\n<%@ taglib prefix=\"x\" uri=\"http://java.sun.com/jsp/jstl/xml\" %>\n<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n<c:import url=\"sample.xml\" varReader=\"r\">\n  <x:parse var=\"sample\" doc=\"${r}\"/>\n</c:import>\n<x:forEach select=\"$sample/sample/link\">\n  <c:set var=\"link\">\n    <x:out select=\"@href\"/>\n  </c:set>\n\n  <c:import url=\"${link}\" varReader=\"r2\">\n    <x:parse var=\"sample2\" doc=\"${r2}\"/>\n  </c:import>\n\n  <!-- *** this does not work *** -->\n  <x:out select=\"$sample2/sample2/text\"/>\n\n  <!-- this does work, but i think it is not correct -->\n  <x:out select=\"$sample2/text\"/>\n\n</x:forEach>\n\n======================\nsample.xml:\n======================\n\n<sample>\n  <link href=\"sample2.xml\"/>\n</sample>\n\n======================\nsample2.xml:\n======================\n\n<sample2>\n  <text>this is just a test!</text>\n</sample2>\n\n======================\n\nI'm using JSTL 1.1, Jakarta Taglib Standard 1.1.0, Tomcat 5.0.25 (same problem\non both linux and windows)\n\nflavio", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 30068, "text": "Confirmed. \n\nIf you do the same code outside the x:forEach, it the first x:out succeeds and\nthe second x:out fails, as expected. Switching away from the reader and to a\nstring doesn't get rid of the bug. \n\nDebugging... all I've found out so far is that when the x:out is in the forEach,\nthe $sample2 at the front makes its way down into the guts. If I add a hack to\nremove '$sample2' from things though, they're not magically fixed.\n\nThe other difference is that the ContextNode is CNode: [link: null] in the\nforEach case and CNode: [#document: null] in the simple case. That seems very\nlikely to be tied to the bug - without really knowing what they are, it seems\nthat a different xml document should have a different context node.", "id": 96590, "time": "2006-12-06T18:01:51Z", "creator": "bayard@apache.org", "creation_time": "2006-12-06T18:01:51Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "bayard@apache.org", "attachment_id": null, "is_private": false, "id": 96884, "time": "2006-12-13T13:44:05Z", "bug_id": 30068, "creation_time": "2006-12-13T13:44:05Z", "text": "Digging more. The ContextNode is a modified version of the Node parameter passed\nin - it represents '.'. It's document specific - so should be tied to the xml\ndocument in question and not be shared.\n\nHowever...this doesn't explain why the alternative actually does work.\n\n"}, {"count": 3, "tags": [], "creator": "bayard@apache.org", "attachment_id": 19258, "text": "Created attachment 19258\nManual Test JSP", "id": 96885, "time": "2006-12-13T13:54:36Z", "bug_id": 30068, "creation_time": "2006-12-13T13:54:36Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 30068, "text": "Created attachment 19259\nXML for Test JSP", "id": 96886, "time": "2006-12-13T13:54:52Z", "creator": "bayard@apache.org", "creation_time": "2006-12-13T13:54:52Z", "is_private": false, "attachment_id": 19259}, {"count": 5, "tags": [], "bug_id": 30068, "attachment_id": 19260, "id": 96887, "creation_time": "2006-12-13T13:56:14Z", "time": "2006-12-13T13:56:14Z", "creator": "bayard@apache.org", "text": "Created attachment 19260\nPatch to fix this issue\n\nThis looks like it fixes the problem. If the expression starts with a $...,\nthen re-evaluate rather than returning the current node.", "is_private": false}, {"count": 6, "tags": [], "creator": "bayard@apache.org", "attachment_id": 19295, "text": "Created attachment 19295\nCactus test for this issue", "id": 97141, "time": "2006-12-20T17:10:12Z", "bug_id": 30068, "creation_time": "2006-12-20T17:10:12Z", "is_private": false}, {"count": 7, "tags": [], "creator": "bayard@apache.org", "attachment_id": null, "is_private": false, "id": 97142, "time": "2006-12-20T17:12:30Z", "bug_id": 30068, "creation_time": "2006-12-20T17:12:30Z", "text": "svn ci -m \"Applying cactus test and patch for issue #30068\"\n\nSending        src/org/apache/taglibs/standard/tag/common/xml/XPathUtil.java\nAdding         test/org/apache/taglibs/standard/tag/el/xml\nAdding         test/org/apache/taglibs/standard/tag/el/xml/Test30068.java\nAdding         test/web/org/apache/taglibs/standard/tag/el/xml\nAdding         test/web/org/apache/taglibs/standard/tag/el/xml/Test30068.jsp\nAdding         test/web/org/apache/taglibs/standard/tag/el/xml/Test30068.xml\nTransmitting file data ....\nCommitted revision 489238."}, {"count": 8, "tags": [], "bug_id": 30068, "is_private": false, "text": "*** Bug 41481 has been marked as a duplicate of this bug. ***", "id": 98686, "time": "2007-01-29T08:29:19Z", "creator": "brodseba@iname.com", "creation_time": "2007-01-29T08:29:19Z", "attachment_id": null}]
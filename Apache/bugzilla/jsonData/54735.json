[{"count": 0, "tags": [], "bug_id": 54735, "text": "Found on\nOS debian lenny or Ubuntu 12.04\npcre 8.32\nphp 5.4.13\napr 1.4.6\napr-utils 1.5.1\n\nhtpasswd -c username \nnever generates a correct hashed password.\nhtpasswd -nb username pass > conf/htpasswd\nhas to be used instead.\nTested with md5 and plain password, even last one are not created correctly.\nOf course autentication fails with first method and works with second one.\n\nFeel free to contact me if you need further informations.", "id": 166053, "time": "2013-03-20T20:24:51Z", "creator": "darklight2k2@libero.it", "creation_time": "2013-03-20T20:24:51Z", "is_private": false, "attachment_id": null}, {"text": "(In reply to comment #0)\n> htpasswd -c username \n\nThat's not a valid command line. You mean\n\nhtpasswd -c conf/htpasswd username\n\n? But this works for me. Can you post the contents of the created file?\n\n\n> never generates a correct hashed password.\n> htpasswd -nb username pass > conf/htpasswd\n> has to be used instead.\n> Tested with md5 and plain password, even last one are not created correctly.\n> Of course autentication fails with first method and works with second one.\n\nPlain passwords do not work under Unix (as hinted by the help text).", "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "count": 1, "id": 166057, "time": "2013-03-20T22:20:58Z", "bug_id": 54735, "creation_time": "2013-03-20T22:20:58Z", "is_private": false}, {"text": "password used is \"test\" \n\n/usr/local/apache2/conf# ../bin/htpasswd -c testpasswdfile username\nNew password: \nRe-type new password: \nAdding password for user username\n/usr/local/apache2/conf# cat testpasswdfile           \nusername:$apr1$GvGApC2k$aW7v79G7y8ElbO/ZjoAOz1\n\n/usr/local/apache2/conf# ./bin/htpasswd -cp testpasswdfile username\nWarning: storing passwords as plain text might just not work on this platform.\nNew password: \nRe-type new password: \nAdding password for user username\n/usr/local/apache2/conf# cat testpasswdfile \nusername:P%m6\ufffd\u007f\n\n/usr/local/apache2/conf# ../bin/htpasswd -bnp username test\nWarning: storing passwords as plain text might just not work on this platform.\nusername:test\n\n\nYes sorry about the wrong commandline. What i meant about plain password was that even those plain aren't created correctly when prompted. Although it might not work as the tool says, it should anyway write a correct file.\n\nI provide you more hashes\nusername:$apr1$QnVANHT3$hMtF7Eu1pFw0KAWSROiOy.   < test used as password\nusername:$apr1$UNe/gu.y$u.0Y03o4WbpCNTQe8n5tV0   < test used as password\nusername:$apr1$1gG7fHEq$/EVL3lXjfQ/fazeoiloDw1   < notworking used as password", "tags": [], "creator": "darklight2k2@libero.it", "attachment_id": null, "count": 2, "id": 166066, "time": "2013-03-21T04:36:57Z", "bug_id": 54735, "creation_time": "2013-03-21T04:36:57Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 54735, "attachment_id": null, "is_private": false, "id": 166067, "time": "2013-03-21T04:38:47Z", "creator": "darklight2k2@libero.it", "creation_time": "2013-03-21T04:38:47Z", "text": "../bin/httpd -V\nServer version: Apache/2.4.4 (Unix)\nServer built:   Mar 20 2013 08:27:18\nServer's Module Magic Number: 20120211:11\nServer loaded:  APR 1.4.6, APR-UTIL 1.5.1\nCompiled using: APR 1.4.6, APR-UTIL 1.5.1\nArchitecture:   64-bit\nServer MPM:     event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=256\n -D HTTPD_ROOT=\"/usr/local/apache2\"\n -D SUEXEC_BIN=\"/usr/local/apache2/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\""}, {"count": 4, "tags": [], "text": "As far as I can tell this is caused by a bug in \"httpd-2.4.4/support/passwd_common.c\". I created the following patch and it works again.\n\ndiff -ur httpd-2.4.4-orig/support/passwd_common.c httpd-2.4.4/support/passwd_common.c\n--- httpd-2.4.4-orig/support/passwd_common.c    2012-12-11 17:37:25.000000000 +0700\n+++ httpd-2.4.4/support/passwd_common.c 2013-03-17 13:33:58.429462196 +0700\n@@ -146,7 +146,6 @@\n int mkhash(struct passwd_ctx *ctx)\n {\n     char *pw;\n-    char pwin[MAX_STRING_LEN];\n     char salt[16];\n     apr_status_t rv;\n     int ret = 0;\n@@ -165,7 +164,7 @@\n     else {\n         if ((ret = get_password(ctx)) != 0)\n             return ret;\n-        pw = pwin;\n+        pw = strdup(ctx->out);\n     }\n \n     switch (ctx->alg) {", "is_private": false, "id": 166260, "creator": "madmaverick9@gmx.sg", "time": "2013-03-31T07:01:20Z", "bug_id": 54735, "creation_time": "2013-03-31T07:01:20Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 54735, "attachment_id": 30123, "text": "Created attachment 30123\nPatch for \"httpd-2.4.4/support/passwd_common.c\".\n\nEven though this patch fixes the problem at hand, the \"get_password\" function in \"httpd-2.4.4/support/passwd_common.c\" really should not put the password into \"ctx->out\", but into \"ctx->passwd\".", "id": 166261, "time": "2013-03-31T07:09:47Z", "creator": "madmaverick9@gmx.sg", "creation_time": "2013-03-31T07:09:47Z", "is_private": false}, {"count": 6, "tags": [], "text": "Thanks for debugging this. Trunk commit: r1465115", "is_private": false, "id": 166430, "creator": "sf@sfritsch.de", "time": "2013-04-05T20:21:24Z", "bug_id": 54735, "creation_time": "2013-04-05T20:21:24Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "BTW, it's rather fascinating that the buggy variant worked for me. It looks like the password was on the right place on the stack on my system.", "attachment_id": null, "id": 166431, "creator": "sf@sfritsch.de", "time": "2013-04-05T20:22:39Z", "bug_id": 54735, "creation_time": "2013-04-05T20:22:39Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 54735, "text": "> BTW, it's rather fascinating that the buggy variant worked for me. It looks like the password was on the right place on the stack on my system.\n\nI wonder if that has something to do with different versions of gcc maybe. I am using \"gcc 4.7.1\" on a default Slackware 14.0 install.\n\nWould it be possible to apply this patch to the \"2.4.x\" branch? So that the fix would be included in a future httpd 2.4.5 release.\n\nThank you very much for your work.", "id": 166440, "time": "2013-04-06T06:43:38Z", "creator": "madmaverick9@gmx.sg", "creation_time": "2013-04-06T06:43:38Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 54735, "attachment_id": null, "is_private": false, "id": 166898, "time": "2013-04-27T21:28:17Z", "creator": "minfrin@sharp.fm", "creation_time": "2013-04-27T21:28:17Z", "text": "Backported to v2.4.5."}, {"count": 10, "tags": [], "bug_id": 54735, "attachment_id": null, "id": 167028, "time": "2013-05-04T05:19:29Z", "creator": "covener@gmail.com", "creation_time": "2013-05-04T05:19:29Z", "is_private": false, "text": "*** Bug 54927 has been marked as a duplicate of this bug. ***"}, {"text": "*** Bug 55086 has been marked as a duplicate of this bug. ***", "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "count": 11, "id": 167760, "time": "2013-06-09T20:20:41Z", "bug_id": 54735, "creation_time": "2013-06-09T20:20:41Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 54735, "attachment_id": null, "id": 167761, "time": "2013-06-09T20:22:19Z", "creator": "sf@sfritsch.de", "creation_time": "2013-06-09T20:22:19Z", "is_private": false, "text": "Reopening until 2.4.5 is actually released. Hopefully this makes it easier to find this PR."}, {"count": 13, "tags": [], "bug_id": 54735, "attachment_id": null, "text": "I apologize for the dup 55086. I should have really scanned for\nthe existing bug reports better.\n\nHowever I have the very real problem that I am running Apache 2.4.4\non Solaris and in production so this is a bit of a problem for me.\n\nI am able, as seen in my duplicate bug report, to create and update\nusers in the password file while using the -b \"batch\" option. That\nseems to work well. For now.\n\nWhen should we expect, and you knew I was about to ask, the release \nof 2.4.5 ? \n\nIs there a neatly isolated patch as well as a manner to build just \nthe htpasswd binary ?  I don't think it should be necessary to \ncompile all of Apache from ground zero just to get this one binary.\nAt least, I sure hope not. I have a very stable 2.4.4 now and the \nperformance on the Niagara class Oracle servers is just magnificent\nand I really don't want to enter a thirty day testing phase and \nvalidation phase just to get htpasswd working as expected. Hope I\ndon't seem to whine here but a stable httpd 2.4.4 exists now and it \nwas not trivial for me to get it into real world production for my\nusers.\n\nDennis", "id": 167762, "time": "2013-06-10T03:10:11Z", "creator": "dclarke@blastwave.org", "creation_time": "2013-06-10T03:10:11Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 54735, "text": "(In reply to Dennis Clarke from comment #13)\n\n> Is there a neatly isolated patch as well as a manner to build just \n> the htpasswd binary ?\n\nPatch\n\nhttp://people.apache.org/~rjung/patches/2.4-htpass.patch\n\nshould apply cleanly on top of a 2.4.4 source tree.\n\nIt contains revisions\n\nsvn.apache.org/r1455225\nsvn.apache.org/r1476089\nsvn.apache.org/r1467978\nsvn.apache.org/r1476674\nsvn.apache.org/r1477651\nsvn.apache.org/r1490564\n\nand fixes at least PRs 53690, 54345, 54346, 54735 and 54893.\n\nIf you use your old 2.4.4 build directory and apply the patch, a \"make\" should simply rebuild\n\n- htpasswd\n- htdbm\n- htdigest\n\nConcerning 2.4.5 there is no fixed date yet, although there were some discussions to cut the release soon. Don't plan for it in the next days though.", "id": 167763, "time": "2013-06-10T04:54:05Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2013-06-10T04:54:05Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "creator": "dclarke@blastwave.org", "attachment_id": null, "text": "I applied that patch, did a re-make and sure enough I have a few new files : \n\nnode002$ find . -newer $SRC/2.4-htpass.patch -ls \n2279859   13 drwxr-xr-x  12 dclarke  other          52 Jun 10 17:52 .\n2279897    5 drwxr-xr-x   5 dclarke  other         102 Jun 10 17:52 ./support\n1139900    1 -rw-r--r--   1 dclarke  other         272 Jun 10 17:52 ./support/passwd_common.lo\n1139897    1 -rw-r--r--   1 dclarke  other         262 Jun 10 17:52 ./support/htpasswd.lo\n1139890    9 -rw-r--r--   1 dclarke  other       16495 Jun 10 17:48 ./support/htpasswd.c\n1139888    5 -rw-r--r--   1 dclarke  other        8147 Jun 10 17:48 ./support/htdigest.c\n1139905   18 -rw-r--r--   1 dclarke  other       41200 Jun 10 17:52 ./support/htdbm.o\n1139899   14 -rw-r--r--   1 dclarke  other       28984 Jun 10 17:52 ./support/passwd_common.o\n1139906    1 -rw-r--r--   1 dclarke  other         256 Jun 10 17:52 ./support/htdbm.lo\n2283202   28 -rwxr-xr-x   1 dclarke  other       57176 Jun 10 17:52 ./support/htpasswd\n2283210   29 -rwxr-xr-x   1 dclarke  other       59912 Jun 10 17:52 ./support/htdbm\n1139889    3 -rw-r--r--   1 dclarke  other        2908 Jun 10 17:48 ./support/passwd_common.h\n2283206   15 -rwxr-xr-x   1 dclarke  other       30040 Jun 10 17:52 ./support/htdigest\n1139903    1 -rw-r--r--   1 dclarke  other         262 Jun 10 17:52 ./support/htdigest.lo\n1139896   17 -rw-r--r--   1 dclarke  other       36864 Jun 10 17:52 ./support/htpasswd.o\n1139902   13 -rw-r--r--   1 dclarke  other       28056 Jun 10 17:52 ./support/htdigest.o\n1139886    8 -rw-r--r--   1 dclarke  other       14325 Jun 10 17:48 ./support/htdbm.c\n1139887    6 -rw-r--r--   1 dclarke  other       10009 Jun 10 17:48 ./support/passwd_common.c\nnode002$ \nnode002$ \nnode002$ file ./support/htpasswd ./support/htdbm ./support/passwd_common.h ./support/htdigest \n./support/htpasswd: ELF 64-bit MSB executable SPARCV9 Version 1, UltraSPARC3 Extensions Required, dynamically linked, not stripped\n./support/htdbm: ELF 64-bit MSB executable SPARCV9 Version 1, UltraSPARC3 Extensions Required, dynamically linked, not stripped\n./support/passwd_common.h: ascii text\n./support/htdigest: ELF 64-bit MSB executable SPARCV9 Version 1, UltraSPARC3 Extensions Required, dynamically linked, not stripped\nnode002$\n\nThat header file seems to live in the build tree and never needs to be installed\nin the $DESTDIR/include so I will leave that behind. \n\nI backup the existing buggy bins : \n\nnode002$ cp -p /usr/local/bin/htdbm /usr/local/bin/htdbm_bug54735\nnode002$ cp -p /usr/local/bin/htdigest /usr/local/bin/htdigest_bug54735\nnode002$ cp -p /usr/local/bin/htpasswd /usr/local/bin/htpasswd_bug54735\n\ndrop in the new bins : \n\nnode002-sparc-SunOS5.10 # cp -p ./support/htpasswd /usr/local/bin/htpasswd\nnode002-sparc-SunOS5.10 # cp -p ./support/htdbm /usr/local/bin/htdbm\nnode002-sparc-SunOS5.10 # cp -p ./support/htdigest /usr/local/bin/htdigest\n\n\nnode002-sparc-SunOS5.10 # chown root:root /usr/local/bin/htpasswd /usr/local/bin/htdbm /usr/local/bin/htdigest\n\nnode002-sparc-SunOS5.10 # ls -lap /usr/local/bin/htpasswd /usr/local/bin/htdbm /usr/local/bin/htdigest\n-rwxr-xr-x   1 root     root       59912 Jun 10 17:52 /usr/local/bin/htdbm\n-rwxr-xr-x   1 root     root       30040 Jun 10 17:52 /usr/local/bin/htdigest\n-rwxr-xr-x   1 root     root       57176 Jun 10 17:52 /usr/local/bin/htpasswd\n\nquick and dirty test : \n\nnode002-sparc-SunOS5.10 # /usr/local/bin/htpasswd /usr/local/www/conf/.htpasswd bug54735test\nNew password: \nRe-type new password: \nAdding password for user bug54735test\nnode002-sparc-SunOS5.10 # grep bug54735test .htpasswd\nbug54735test:$apr1$mBhdHE3M$AmZp9nuLI9DC7D.H7OO.51\n\nfirst test works like a charm : \n\nnode002-sparc-SunOS5.10 # grep bug54735test /usr/local/www/var/logs/ssl_request_log\nxxx.xxx.52.207 - bug54735test [10/Jun/2013:18:10:02 +0000] \"GET /foo.php HTTP/1.1\" 200 75883 \"-\" \"Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/20130515 Firefox/17.0 Iceweasel/17.0.6\"\n\nlooks to be a good patch, however I will keep our internal bug report open until 2.4.5 releases, \nfor now I would say that there is no need for a triage or validation phase because the core \nservices have not been touched and thus this is a great little patch. Already rolled those\nbins out to a collection of servers.\n\nI give thanks and praise to those involved and am a very happy user!\n\nDennis", "id": 167769, "time": "2013-06-10T18:40:08Z", "bug_id": 54735, "creation_time": "2013-06-10T18:40:08Z", "is_private": false}, {"text": "Even specifying the password on the command line results in a flawed check. htpasswd can verify my password, but apache fails.", "tags": [], "creator": "steve@doitnext.com", "attachment_id": null, "count": 16, "id": 190970, "time": "2016-05-15T04:59:23Z", "bug_id": 54735, "creation_time": "2016-05-15T04:59:23Z", "is_private": false}]
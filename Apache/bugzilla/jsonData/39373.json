[{"count": 0, "tags": [], "text": "In the current implementaion, scp task included in Apache Ant has been using scp1\nprotocol to transfer files, but some proprietary sshd[1] has not supported it anymore.\n\nTo resolve this problem, scp task should use sftp protocol[2], which must be supported by\nalmost of all ssh2 sshd.\n\n[1] http://www.snailbook.com/faq/scp-ossh-to-ssh2.auto.html\n[2] http://www.unix.org.ua/orelly/networking_2ndEd/ssh/ch03_08.htm", "attachment_id": null, "bug_id": 39373, "id": 88343, "time": "2006-04-21T01:27:56Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-04-21T01:27:56Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 39373, "text": "Created attachment 18147\na patch to use sftp protocol in scp task.\n\nAttached patch will allow scp task to use sftp protocol instead of scp1\nprotocol.\n\nIf you add the attribute 'sftp=\"true\"', sftp protocol will be used and \nif 'sftp=\"false\"', scp1 protocol will be used.\t\nBy the default, the attribute 'sftp' is \"false\" for backword compatibity.\n\nTo try this patch, jsch-0.1.27[1] is required.\n\n[1] http://sourceforge.net/project/showfiles.php?group_id=64920", "id": 88344, "time": "2006-04-21T01:37:34Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-04-21T01:37:34Z", "is_private": false, "attachment_id": 18147}, {"count": 2, "tags": [], "bug_id": 39373, "attachment_id": null, "is_private": false, "id": 88359, "time": "2006-04-21T18:17:01Z", "creator": "BBurgess@tiaa-cref.org", "creation_time": "2006-04-21T18:17:01Z", "text": "Wouldn't it be better to define a new task called \"sftp\" rather than changing\nthe \"scp\" task to no longer use scp?"}, {"count": 3, "tags": [], "bug_id": 39373, "text": "+1 on Ben's comment", "id": 88365, "attachment_id": null, "creator": "carej@us.ibm.com", "creation_time": "2006-04-21T21:05:08Z", "time": "2006-04-21T21:05:08Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 39373, "is_private": false, "id": 88366, "attachment_id": null, "creator": "riznob@hotmail.com", "creation_time": "2006-04-21T21:28:29Z", "time": "2006-04-21T21:28:29Z", "text": "-1 on Ben's comment.\n\nPlease read the links provided by Atsuhiko, particularly\n[2] http://www.unix.org.ua/orelly/networking_2ndEd/ssh/ch03_08.htm. \n\nSFTP is the protocol used by the program scp2. It is entirely appropriate to \nadd this feature to the scp task."}, {"count": 5, "tags": [], "bug_id": 39373, "attachment_id": null, "is_private": false, "id": 88369, "time": "2006-04-22T00:35:40Z", "creator": "riznob@hotmail.com", "creation_time": "2006-04-22T00:35:40Z", "text": "After applying the patch and running a basic test against an F-Secure sshd I \nget the following error:\n\nBUILD FAILED\nH:\\build.xml:6: com.jcraft.jsch.JSchException: invalid server's version string\n\nI am using the jsch 0.1.27"}, {"count": 6, "tags": [], "bug_id": 39373, "text": "(In reply to comment #5)\n> After applying the patch and running a basic test against an F-Secure sshd I \n> get the following error:\n> BUILD FAILED\n> H:\\build.xml:6: com.jcraft.jsch.JSchException: invalid server's version \nstring\n> I am using the jsch 0.1.27\n\nDoes that sshd support ssh2 protocol?\n", "id": 88408, "time": "2006-04-24T03:29:52Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-04-24T03:29:52Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 39373, "text": "(In reply to comment #6)\n> (In reply to comment #5)\n> > After applying the patch and running a basic test against an F-Secure sshd \nI \n> > get the following error:\n> > BUILD FAILED\n> > H:\\build.xml:6: com.jcraft.jsch.JSchException: invalid server's version \n> string\n> > I am using the jsch 0.1.27\n> Does that sshd support ssh2 protocol?\n\nThe version of F-Secure sshd we are using supports only ssh2 protocol.", "id": 88410, "time": "2006-04-24T05:23:23Z", "creator": "riznob@hotmail.com", "creation_time": "2006-04-24T05:23:23Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 39373, "attachment_id": null, "is_private": false, "id": 88412, "time": "2006-04-24T05:43:55Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-04-24T05:43:55Z", "text": "(In reply to comment #7)\n> The version of F-Secure sshd we are using supports only ssh2 protocol.\n\nIt is interesting.\nMay I ask you to show me the fist line of outputs from\n\n  $ telnet address_of_sshd 22\n"}, {"count": 9, "tags": [], "bug_id": 39373, "text": "(In reply to comment #8)\n> (In reply to comment #7)\n> > The version of F-Secure sshd we are using supports only ssh2 protocol.\n> It is interesting.\n> May I ask you to show me the fist line of outputs from\n>   $ telnet address_of_sshd 22\n\nSSH-2.0-3.2.9 F-SECURE SSH 3.2.3\n", "id": 88447, "time": "2006-04-24T16:45:34Z", "creator": "riznob@hotmail.com", "creation_time": "2006-04-24T16:45:34Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 39373, "is_private": false, "id": 88452, "attachment_id": null, "creator": "riznob@hotmail.com", "creation_time": "2006-04-24T22:55:27Z", "time": "2006-04-24T22:55:27Z", "text": "(In reply to comment #9)\n> (In reply to comment #8)\n> > (In reply to comment #7)\n> > > The version of F-Secure sshd we are using supports only ssh2 protocol.\n> > It is interesting.\n> > May I ask you to show me the fist line of outputs from\n> >   $ telnet address_of_sshd 22\n> SSH-2.0-3.2.9 F-SECURE SSH 3.2.3\n\nIt appears that the ascii codes for the server version string returned by F-\nSecure is lower case. The following patch to Session.java will address the \nissue.\n\n--- Session.java.orig   2006-04-18 22:37:02.000000000 -0700\n+++ Session.java        2006-04-24 15:42:58.594132100 -0700\n@@ -224,11 +224,13 @@\n        }\n       }\n \n-      if(i==buf.buffer.length ||\n+      if((i==buf.buffer.length ||\n          (i>4 && (buf.buffer[0]!='S'||buf.buffer[1]!='S'||\n                   buf.buffer[2]!='H'||buf.buffer[3]!='-'))||\n         i<7 ||                                      // SSH-1.99 or SSH-2.0\n-        (buf.buffer[4]=='1' && buf.buffer[6]!='9')  // SSH-1.5\n+        (buf.buffer[4]=='1' && buf.buffer[6]!='9')) ^ // SSH-1.5\n+        (buf.buffer[0]!='s'||buf.buffer[1]!='s'||\n+             buf.buffer[2]!='h'||buf.buffer[3]!='-') // \"ssh-\" F-Secure returns\n lowercase\n         ){\n        throw new JSchException(\"invalid server's version string\");\n       }\n\nThe task is still not working however. Now I get the following error...\n\ncom.jcraft.jsch.JSchException: Session.connect: java.io.IOException: invalid \ndata\n\nThis exception is thrown during the Session.read(buf) method."}, {"count": 11, "tags": [], "bug_id": 39373, "attachment_id": null, "is_private": false, "id": 88453, "time": "2006-04-25T00:09:08Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-04-25T00:09:08Z", "text": "(In reply to comment #10)\n> (In reply to comment #9)\n> > SSH-2.0-3.2.9 F-SECURE SSH 3.2.3\n> \n> It appears that the ascii codes for the server version string returned by F-\n> Secure is lower case. The following patch to Session.java will address the \n> issue.\n\nIt is curious.  You had written as in comment #9\nSSH-2.0-3.2.9 F-SECURE SSH 3.2.3\n, which starts with upper case string \"SSH-\" and the RFC4253[1] says at Section 4.2 as follows,\n\n  4.2.  Protocol Version Exchange\n  \n     When the connection has been established, both sides MUST send an\n     identification string.  This identification string MUST be\n\n         SSH-protoversion-softwareversion SP comments CR LF\n\n     Since the protocol being defined in this set of documents is version\n     2.0, the 'protoversion' MUST be \"2.0\".  The 'comments' string is\n     OPTIONAL.  If the 'comments' string is included, a 'space' character\n     (denoted above as SP, ASCII 32) MUST separate the 'softwareversion'\n     and 'comments' strings. \n\nI don't have the reason why it starts with 'ssh-'.\n\n> The task is still not working however. Now I get the following error...\n> com.jcraft.jsch.JSchException: Session.connect: java.io.IOException: invalid data\n> This exception is thrown during the Session.read(buf) method.\n\nIf it really sents 'ssh-', it may not use formal ssh2 protocol, IMHO.\nAnyway, that problem is not related to this topic.\n\n[1] http://www.ietf.org/rfc/rfc4253.txt\n\n"}, {"count": 12, "tags": [], "bug_id": 39373, "text": "(In reply to comment #11)\n> (In reply to comment #10)\n> > (In reply to comment #9)\n> > > SSH-2.0-3.2.9 F-SECURE SSH 3.2.3\n> > \n> > It appears that the ascii codes for the server version string returned by F-\n> > Secure is lower case. The following patch to Session.java will address the \n> > issue.\n> It is curious.  You had written as in comment #9\n> SSH-2.0-3.2.9 F-SECURE SSH 3.2.3\n> , which starts with upper case string \"SSH-\" and the RFC4253[1] says at \nSection 4.2 as follows,\n>   4.2.  Protocol Version Exchange\n>   \n>      When the connection has been established, both sides MUST send an\n>      identification string.  This identification string MUST be\n>          SSH-protoversion-softwareversion SP comments CR LF\n>      Since the protocol being defined in this set of documents is version\n>      2.0, the 'protoversion' MUST be \"2.0\".  The 'comments' string is\n>      OPTIONAL.  If the 'comments' string is included, a 'space' character\n>      (denoted above as SP, ASCII 32) MUST separate the 'softwareversion'\n>      and 'comments' strings. \n> I don't have the reason why it starts with 'ssh-'.\n> > The task is still not working however. Now I get the following error...\n> > com.jcraft.jsch.JSchException: Session.connect: java.io.IOException: \ninvalid data\n> > This exception is thrown during the Session.read(buf) method.\n> If it really sents 'ssh-', it may not use formal ssh2 protocol, IMHO.\n> Anyway, that problem is not related to this topic.\n> [1] http://www.ietf.org/rfc/rfc4253.txt\n\nI agree that this is a seperate issue. I would like to work with you to resolve \nit, if possible. I am interested in the enhancements to the scp task and would \nlike to see them committed to the Ant project. Should we take this discussion \nto the ant-dev list?", "id": 88454, "time": "2006-04-25T00:36:59Z", "creator": "riznob@hotmail.com", "creation_time": "2006-04-25T00:36:59Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 39373, "attachment_id": 18186, "is_private": false, "id": 88507, "time": "2006-04-26T15:16:05Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-04-26T15:16:05Z", "text": "Created attachment 18186\nan implementation of sftp task\n\nThe attached patch is a quick hack to implement sftp task, which\nis based on ftp task and using jsch for sftp functionality.\nIt accepts attributes for ftp and scp tasks except for 'binary',\n'passive', 'separator' and 'umask'.  \n\nIt seems following tasks are working on my testing, however, frankly to say,\nI'm not familiar with ftp task and have never used and run it, so I may\nmis-understand its operational semantics.  Comments, suggestions and feedbacks\nare welcome.\n\nPS 1. that patch is for ant_20060426105634.tar.gz \nPS 2. jsch-0.1.27 is required.\n\n  <sftp action=\"send\"\n       server=\"${server}\"\n       userid=\"${userid}\"\n       password=\"${password}\"\n       remotedir=\"incoming\"\n       depends=\"yes\">\n     <fileset dir=\"htdocs/manual\"/>\n  </sftp>\n\n  <sftp action=\"get\"\n       server=\"${server}\"\n       userid=\"${userid}\"\n       password=\"${password}\">\n    <fileset dir=\"htdocs/manual\" >\n      <include name=\"**/*.html\"/>\n    </fileset>\n  </sftp>\n\n <sftp action=\"del\"\n       server=\"${server}\"\n       userid=\"${userid}\"\n       password=\"${password}\" >\n    <fileset>\n      <include name=\"**/*.tmp\"/>\n    </fileset>\n  </sftp>\n\n  <sftp action=\"list\"\n       server=\"${server}\"\n       userid=\"${userid}\"\n       password=\"${password}\"\n       listing=\"data/sftp.listing\" >\n    <fileset>\n      <include name=\"**\"/>\n    </fileset>\n  </sftp>\n\n  <sftp action=\"mkdir\"\n       server=\"${server}\"\n       userid=\"${userid}\"\n       password=\"${password}\"\n       remotedir=\"test\" />\n\n  <sftp action=\"chmod\"\n       server=\"${server}\"\n       userid=\"${userid}\"\n       password=\"${password}\"\n       chmod=\"0700\" >\n    <fileset>\n      <include name=\"*.log\"/>\n    </fileset>\n  </sftp>"}, {"count": 14, "tags": [], "creator": "riznob@hotmail.com", "attachment_id": null, "text": "Why the change in direction? I like the idea of adding the sftp attribute to \nthe scp task, rather than creating a new sftp task. Perhaps both are a good \nidea.", "id": 88511, "time": "2006-04-26T16:29:00Z", "bug_id": 39373, "creation_time": "2006-04-26T16:29:00Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 39373, "text": "(In reply to comment #14)\n> Why the change in direction? I like the idea of adding the sftp attribute to \n> the scp task, rather than creating a new sftp task. Perhaps both are a good \n> idea.\n\nOf course, that patch includes both.\n", "id": 88618, "time": "2006-04-28T06:40:07Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-04-28T06:40:07Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 39373, "is_private": false, "text": "After working out an issue with Jsch, I have successfully tested the \nenhancements to the scp task.\n\nI think the sftp task enhancement should be in a seperate bug report, because I \nbelieve it is a different subject. Furthermore, I feel that this enhancement to \nthe scp task is a higher priority than the need for a new sftp task.", "id": 88733, "time": "2006-05-02T23:13:58Z", "creator": "riznob@hotmail.com", "creation_time": "2006-05-02T23:13:58Z", "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 39373, "text": "(In reply to comment #5)\n> After applying the patch and running a basic test against an F-Secure sshd I \n> get the following error:\n> BUILD FAILED\n> H:\\build.xml:6: com.jcraft.jsch.JSchException: invalid server's version \nstring\n> I am using the jsch 0.1.27\n\nThanks to Robert, I found the problem in the jsch code and has fixed it, at \nlast.\nIf somebody has simillar problem,  http://www.jcraft.com/jsch/jsch-0.1.28-\nrc4.jar will resolve that problem.\n", "id": 88734, "time": "2006-05-03T00:21:35Z", "creator": "atsuhiko.yamanaka@gmail.com", "creation_time": "2006-05-03T00:21:35Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "creator": "ymnk@jcraft.com", "attachment_id": null, "id": 88896, "time": "2006-05-08T03:26:19Z", "bug_id": 39373, "creation_time": "2006-05-08T03:26:19Z", "is_private": false, "text": "(In reply to comment #16)\n> I think the sftp task enhancement should be in a seperate bug report, because I \n> believe it is a different subject. Furthermore, I feel that this enhancement to \n> the scp task is a higher priority than the need for a new sftp task.\n\nI agree with him.  There should be a separate bug report for sftp task, but\nthat patch for sftp task is based on the source code for this modified scp task.\n\nDear ant developers,  are there not any possibilties that this modification for scp task will be adopted?\nIf so, I'll delete it from the source code and submit a new bug entry for sftp task\nand post a patch, which does not include the modifications for scp.\nI don't want to keep several source code trees.\n\n\n"}, {"count": 19, "tags": [], "bug_id": 39373, "is_private": false, "text": "I've committed the part of the patch that adds sftp support to scp, the sftp\ntask will remain separate since it needs a bit more of review than I can do\nright now.\n\nYou'll note that there are a few differences between your patch and what I\ncommitted, most of them are whitespace only.\n\nWe also need an update of scp's manual page.  IIUC we should recommend to set\nthe sftp attribute to true if the ssh server supports ssh2, correct?", "id": 88937, "time": "2006-05-09T04:25:25Z", "creator": "bodewig@apache.org", "creation_time": "2006-05-09T04:25:25Z", "attachment_id": null}, {"count": 20, "tags": [], "creator": "riznob@hotmail.com", "attachment_id": 18251, "text": "Created attachment 18251\nPatch to scp.html manual page", "id": 88967, "time": "2006-05-09T17:12:22Z", "bug_id": 39373, "creation_time": "2006-05-09T17:12:22Z", "is_private": false}, {"count": 21, "attachment_id": null, "creator": "ymnk@jcraft.com", "text": "(In reply to comment #19)\n> We also need an update of scp's manual page.  IIUC we should recommend to set\n> the sftp attribute to true if the ssh server supports ssh2, correct?\n\nIMHO, if users have satisfied with original scp task, there are not any merit\nto use sftp attribute, becase scp1 protocol is more efficent than sftp protocol.\nSo, I hesitate to recommend to use it explicitly.  That attribute is only for\nsome users, whose sshd does not support scp1 anymore.  Almost users will use\nOpenSSH's sshd and it will continue to support scp1 for a while.\n\n", "id": 88978, "time": "2006-05-10T03:48:48Z", "bug_id": 39373, "creation_time": "2006-05-10T03:48:48Z", "tags": [], "is_private": false}, {"count": 22, "tags": [], "bug_id": 39373, "is_private": false, "text": "(In reply to comment #20)\n\n> Patch to scp.html manual page\n\nI've applied a slightly modified version (recommending the option if the server\ndoesn't support SSH1 based on Atsuhiko Yamanaka's comment) but svn is down right\nnow so I can't commit it.", "id": 89017, "time": "2006-05-11T04:02:00Z", "creator": "bodewig@apache.org", "creation_time": "2006-05-11T04:02:00Z", "attachment_id": null}, {"count": 23, "tags": [], "creator": "ymnk@jcraft.com", "attachment_id": null, "id": 89019, "time": "2006-05-11T06:56:48Z", "bug_id": 39373, "creation_time": "2006-05-11T06:56:48Z", "is_private": false, "text": "(In reply to comment #22)\n> I've applied a slightly modified version (recommending the option if the server\n> doesn't support SSH1 based on Atsuhiko Yamanaka's comment) but svn is down right\n> now so I can't commit it.\n\nI have meant scp1 protocol, not ssh1 protocol.  Sorry for lack of words.\nscp1 protocol is just a file transfer protocol and it has been used on ssh1 and ssh2 protocol.\n\nFor example, openssh'd sshd can disable ssh1 protocol support by configuring /etc/ssh/sshd_conifg,\nbut scp1 procol can be available if there exists '/usr/bin/scp' command.\n\n"}, {"count": 24, "tags": [], "bug_id": 39373, "text": "Stefan, have you upped the manual change?\nCan this one be closed?", "id": 89913, "time": "2006-06-07T19:19:37Z", "creator": "jkf@apache.org", "creation_time": "2006-06-07T19:19:37Z", "is_private": false, "attachment_id": null}, {"count": 25, "tags": [], "bug_id": 39373, "is_private": false, "id": 91646, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2006-07-27T04:37:59Z", "time": "2006-07-27T04:37:59Z", "text": "See bug 39532 for a new sftp task patch, closing this one."}, {"count": 26, "tags": [], "text": "Created attachment 18921\nbugfix to download files/directory, which are pointed by symbolic link.\n\nI have found a bug in downloading files and directories, which are pointed by\nsymbolic links,\nwith scp task using sftp of ant 1.7.0beta2.\nI will attache a patch to fix this problem.", "attachment_id": 18921, "bug_id": 39373, "id": 94151, "time": "2006-09-27T09:35:12Z", "creator": "ymnk@jcraft.com", "creation_time": "2006-09-27T09:35:12Z", "is_private": false}, {"count": 27, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "*** Bug 39532 has been marked as a duplicate of this bug. ***", "id": 118626, "time": "2008-07-14T06:44:45Z", "bug_id": 39373, "creation_time": "2008-07-14T06:44:45Z", "is_private": false}]
[{"id": 60592, "tags": [], "bug_id": 30097, "attachment_id": null, "count": 0, "text": "(I apologize if I'm being redundant.  I've posted this issue to the dev list\nalready, but then I thought maybe that was not the best way to submit bug fix.)\n\nAbstractCvsTask holds a Vector of Commandlines (vecCommandlines).  The execute()\nmethod iterates thru the Commandlines and calls runCommand(Commandline).\n\nrunCommand(Commandline) redirects the command output to outputStream and\nerrorStream but closes them before returning.  So if vecCommandlines holds more\nthan 1 command, then any subsquent call to runCommand(Commandline) after the 1st\ncall will cause the command output to be redirected to the closed outputStreams\nand errorStream.  (The IOExceptions caused by writing to closed streams are\nswallowed by the empty catch clause in StreamPumper).\n\nThe patch here moves the closing call of outputStream and errorStream from the\nend of runCommand(Commandline) method to the end of execute() method.  The\nrationale here is to only close the streams after all commands in\nvecCommandlines are executed.\n\nIndex: AbstractCvsTask.java\n===================================================================\nRCS file:\n/home/cvspublic/ant/src/main/org/apache/tools/ant/taskdefs/AbstractCvsTask.java,v\nretrieving revision 1.34\ndiff -u -r1.34 AbstractCvsTask.java\n--- AbstractCvsTask.java\t14 Apr 2004 15:42:06 -0000\t1.34\n+++ AbstractCvsTask.java\t14 Jul 2004 07:41:35 -0000\n@@ -365,21 +365,6 @@\n             } else {\n                 log(\"Caught exception: \" + e.getMessage(), Project.MSG_WARN);\n             }\n-        } finally {\n-            if (outputStream != null) {\n-                try {\n-                    outputStream.close();\n-                } catch (IOException e) {\n-                    //ignore\n-                }\n-            }\n-            if (errorStream != null) {\n-                try {\n-                    errorStream.close();\n-                } catch (IOException e) {\n-                    //ignore\n-                }\n-            }\n         }\n     }\n \n@@ -413,6 +398,21 @@\n                 removeCommandline(cloned);\n             }\n             setCommand(savedCommand);\n+\n+\t\t\tif (outputStream != null) {\n+\t\t\t    try {\n+\t\t\t        outputStream.close();\n+\t\t\t    } catch (IOException e) {\n+\t\t\t        //ignore\n+\t\t\t    }\n+\t\t\t}\n+\t\t\tif (errorStream != null) {\n+\t\t\t    try {\n+\t\t\t        errorStream.close();\n+\t\t\t    } catch (IOException e) {\n+\t\t\t        //ignore\n+\t\t\t    }\n+\t\t\t}\n         }\n     }", "time": "2004-07-14T07:50:46Z", "creator": "telerice@yahoo.com", "creation_time": "2004-07-14T07:50:46Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 30097, "text": "Thanks for the submission, it is checked in both the ANT_16 branch and the HEAD.\n", "id": 60748, "time": "2004-07-17T15:19:03Z", "creator": "antoine@apache.org", "creation_time": "2004-07-17T15:19:03Z", "is_private": false, "attachment_id": null}]
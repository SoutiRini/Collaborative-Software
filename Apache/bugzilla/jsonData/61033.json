[{"count": 0, "tags": [], "bug_id": 61033, "text": "Created attachment 34946\n0001-Add-Workbook.setCellFormulaValidation-to-control-whe.patch\n\nOur application must set formulas, then evaluate them.  Cell.setCellFormula does expensive formula parsing, then FormulaEvaluator.evaluate() parses it again.  With this patch if we turn off formula validation our total runtime per job almost halves, dropping from 21 minutes to 11 minutes.\n\nLet me know if anything should change.  I implemented this as part of the Workbook interface, but then realized that HSSFWorkbook and SXSSFWorkbook actually don't parse the formula or throw the ParseException anyway, they might in the future though so I guess this is still the correct place?\n\nThanks much!", "id": 198502, "time": "2017-04-24T19:32:53Z", "creator": "admin.apache@moparisthebest.com", "creation_time": "2017-04-24T19:32:53Z", "is_private": false, "attachment_id": 34946}, {"count": 1, "tags": [], "text": "Could you please add some unit tests covering the new functionality?", "is_private": false, "id": 198506, "creator": "onealj@apache.org", "time": "2017-04-25T03:19:03Z", "bug_id": 61033, "creation_time": "2017-04-25T03:19:03Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "It's basically just a setter/getter for a boolean, and then not calling validation logic if false, I'm not sure of a great way to unit test that, especially since it only applies to XSSF too?\n\nI guess maybe I could set it false and send in an invalid formula and assert I didn't get an exception?  Anything else?", "is_private": false, "id": 198527, "creator": "admin.apache@moparisthebest.com", "time": "2017-04-25T14:10:08Z", "bug_id": 61033, "creation_time": "2017-04-25T14:10:08Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "From Greg Woolsey on dev@:\nTest the positive case too, true + invalid formula allowed, test that the\ndefault is true, test that flipping it from false to true with an invalid\nformula in place, resulting in an invalid workbook, is somehow handled so\nusers don't get odd errors later. Maybe validate all formulas then?  That\nwould be expensive.  If we just allow an invalid state then, the javadoc\nneeds to clearly note that for the boolean setter and getter, and the\nformula setter and getter.\n\nIt will make it easy for users to get things all mixed up but appear valid,\nso the docs need to be vocal about it.", "is_private": false, "id": 198528, "creator": "onealj@apache.org", "time": "2017-04-25T15:52:51Z", "bug_id": 61033, "creation_time": "2017-04-25T15:52:51Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "onealj@apache.org", "text": "Combinations that need tested:\n\n1. Evaluate formulas=false should not raise an exception when setting an invalid formula.\n2. Evaluate formulas=false should not raise an exception when setting a valid formula.\n3. Evaluate formulas=true should raise an exception when setting an invalid formula.\n4. Evaluate formulas=true should not raise an exception when setting a valid formula.", "id": 198529, "time": "2017-04-25T15:55:58Z", "bug_id": 61033, "creation_time": "2017-04-25T15:55:58Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 61033, "text": "Created attachment 34953\n0001-Add-XSSFWorkbook.setCellFormulaValidation-to-control.patch\n\nAlternative patch suggested by kiwiwings\u200e on IRC to limit this addition to XSSFWorkbook since neither HSSF or SXSSF ever validate the formula or throw this exception anyway.", "id": 198547, "time": "2017-04-26T18:16:25Z", "creator": "admin.apache@moparisthebest.com", "creation_time": "2017-04-26T18:16:25Z", "is_private": false, "attachment_id": 34953}, {"count": 6, "attachment_id": 34954, "creator": "admin.apache@moparisthebest.com", "text": "Created attachment 34954\n0002-Unit-tests-for-XSSFWorkbook.setCellFormulaValidation.patch\n\nUnit tests for either of the previous patches.", "id": 198548, "time": "2017-04-26T18:17:50Z", "bug_id": 61033, "creation_time": "2017-04-26T18:17:50Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 61033, "attachment_id": null, "text": "Also I've been pushing up my branches here too if it makes it easier to look at:\n\nhttps://github.com/moparisthebest/poi/commits/formula_patch\nhttps://github.com/moparisthebest/poi/commits/formula_patchv2\n\nv2 is the patch to only XSSFWorkbook, the first patches Workbook", "id": 198549, "time": "2017-04-26T18:22:20Z", "creator": "admin.apache@moparisthebest.com", "creation_time": "2017-04-26T18:22:20Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 61033, "text": "Applied via r1809071, thanks for providing the implementation and tests.", "id": 201019, "time": "2017-09-20T19:09:57Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2017-09-20T19:09:57Z", "is_private": false, "attachment_id": null}]
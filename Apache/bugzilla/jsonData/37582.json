[{"count": 0, "tags": [], "bug_id": 37582, "attachment_id": null, "id": 82713, "time": "2005-11-21T22:08:40Z", "creator": "cfitch@metatomix.com", "creation_time": "2005-11-21T22:08:40Z", "is_private": false, "text": "Environment Details:\nLinux 2.6 kernel(Suse 9.1)\nJDK 1.4.2_06\nOracle 9.2 DB and JDBC Driver\n\nDescription:\nUpon executing a PUT document request, I receive the following exception(with\nrelevant trace):\n\njava.lang.IllegalArgumentException: object is not an instance of declaring class\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at\norg.apache.slide.store.impl.rdbms.OracleRDBMSAdapter.storeContent(OracleRDBMSAdapter.java:142)\n\n\nDigging around the problem results from an incorrect usage of java reflection to\nexecute a method.\n\nSpecifically:\n\nIn stores section, the class\norg.apache.slide.store.impl.rdbms.OracleRDBMSAdapter declares the following\ninstance variable: \n\n    protected Method blobGetOutStreamMethod;\n\n\nThe constructor for the class is as follows:\n\n    public OracleRDBMSAdapter(Service service, Logger logger) \n        throws ClassNotFoundException, NoSuchMethodException \n    {\n        super(service, logger);\n        \n        Class bCls = Class.forName(\"oracle.sql.BLOB\");\n        blobGetOutStreamMethod = bCls.getMethod(\"getBinaryOutputStream\", new\nClass[] {});\n    }\n\nLater on, the Adapter attempts to retrieve the java.io.OutputStream for the Blob\nby making this call:\n\n    os = (OutputStream) blobGetOutStreamMethod.invoke(bObj, new Object[] {});\n\n\nThough syntactically correct, this code results in the above exception.\n\nIn the constructor, the method is retrieved from a Class object and NOT an\ninstance of the Class itself.\n\nAccording to the javadoc for the Method.invoke() call, invoke() will throw:\n\nIllegalArgumentException - if the method is an instance method and the specified\nobject argument is not an instance of the class or interface declaring the\nunderlying method \n\nSince the method was retrieved from a Class object and not an instance, it's not\nan Instance method. This is discussed on the Sun Java forums.\n\nThe correct code is as follows:\n\nreplace this line(line 142) \n\n    os = (OutputStream) blobGetOutStreamMethod.invoke(bObj, new Object[] {});\n\nwith the following two lines:\n\n    Method blobGetOutputStreamMethod =\nbObj.getClass().getMethod(\"getBinaryOutputStream\",new Class[0]);\n    os = (OutputStream) blobGetOutputStreamMethod.invoke(bObj, new Object[0]);\n\nand remove the two lines in the constructor.\n\nThanks!"}]
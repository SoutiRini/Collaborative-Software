[{"count": 0, "tags": [], "bug_id": 52709, "is_private": false, "text": "From http://bugs.debian.org/500558\n\nApache can't bind to 127.0.0.1 if eth0 as only IPv6\n\nI traced back that problem to a call in libapr1, in call_resolver()\ngetaddrinfo(\"127.0.0.1\", NULL, &hints, ...) that returns -9\nbecause hints contains AI_ADDRCONFIG\n\nWithout that hint, it works.\n\nExtract from call_resolver:\n    if (family == APR_UNSPEC) {\n        /* By default, only look up addresses using address types for\n         * which a local interface is configured, i.e. no IPv6 if no\n         * IPv6 interfaces configured. */\n        hints.ai_flags = AI_ADDRCONFIG;\n    }\n\nAurelien Jarno pointed out that whatever what the documentation says, RFC3493 explicitly exclude the loopback addresses:\n\n   If the AI_ADDRCONFIG flag is specified, IPv4 addresses shall be\n   returned only if an IPv4 address is configured on the local system,\n   and IPv6 addresses shall be returned only if an IPv6 address is\n   configured on the local system.  The loopback address is not\n   considered for this case as valid as a configured address.\n\nThis results in:\n[Mon Sep 29 10:33:20 2008] [crit] (EAI 9)Address family for hostname not supported: alloc_listener: failed to set up sockaddr for 127.0.0.1\nSyntax error on line 1 of /etc/apache2/ports.conf:\nListen setup failed\n\nI think cannot use AI_ADDRCONFIG if we are to allow localhost binding.", "id": 153926, "time": "2012-02-19T15:38:33Z", "creator": "jmv_deb@nirgal.com", "creation_time": "2012-02-19T15:38:33Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 28360\nPatch for loopback support in call_resolver() IPv6/IPv4 mismatch\n\nIt is a pity not to use AI_ADDRCONFIG hint for production servers not using loopback.\nSo I used the existing retry mechanism designed for EAI_BADFLAGS.\n\nTested on version 1.4.2, but should apply to all recent ones.", "is_private": false, "id": 154002, "creator": "jmv_deb@nirgal.com", "time": "2012-02-21T18:05:33Z", "bug_id": 52709, "creation_time": "2012-02-21T18:05:33Z", "attachment_id": 28360}, {"count": 2, "tags": [], "bug_id": 52709, "is_private": false, "text": "This bug also affects httpd function ap_get_local_host() as described in http://bugs.debian.org/629899\nHttpd will then fail to get the fully qualified domain name.\n\nThis occurs when apache starts before dhclient finished its job.", "id": 154020, "time": "2012-02-22T11:15:11Z", "creator": "jmv_deb@nirgal.com", "creation_time": "2012-02-22T11:15:11Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "trunk: r1343233\n1.5: r1343236\n1.4: r1343239 (will be in 1.4.7)", "is_private": false, "bug_id": 52709, "id": 159392, "time": "2012-05-28T13:13:01Z", "creator": "sf@sfritsch.de", "creation_time": "2012-05-28T13:13:01Z", "attachment_id": null}]
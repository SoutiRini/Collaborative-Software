[{"count": 0, "tags": [], "text": "Hello there !\n\nWe have this friendly message :\n\n\"[notice] child pid 19283 exit signal Segmentation fault (11)\"\n\nwhen we try to retrieve some web pages through an Apache 2.0.43 proxy running\nmod_cache, from a serveur returning 302 ok responses.\n\nI looked a little bit in the code, and, I'm not a specialist, but the problem\nseems to be in mod_cache.c, in the cache_in_filter function, when there is a\ncall to apr_pstrcat :\n\nif (r->status != HTTP_OK && r->status != HTTP_NON_AUTHORITATIVE\n         && r->status != HTTP_MULTIPLE_CHOICES\n         && r->status != HTTP_MOVED_PERMANENTLY\n         && r->status != HTTP_NOT_MODIFIED) {\n         /* RFC2616 13.4 we are allowed to cache 200, 203, 206, 300, 301 or 410\n          * We don't cache 206, because we don't (yet) cache partial responses.\n          * We include 304 Not Modified here too as this is the origin server\n          * telling us to serve the cached copy.\n         */\n         reason = apr_pstrcat(p, \"Response status %d\", r->status);\n}\n\nCommenting this line prevent us from having this problem (on this particular\nweb-serveur) but I don't think it's really clean... ;-)\n\nCan you look at this ?\n\nThanks in advance,\n\nThomas.", "is_private": false, "bug_id": 15113, "id": 27468, "time": "2002-12-05T16:30:40Z", "creator": "tcastelle@generali.fr", "creation_time": "2002-12-05T16:30:40Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "tcastelle@generali.fr", "text": "Hello !\n\nHave you checked this problem ? Can anyone look at it, because this is quite\nannoying for us (we are in production environment !)\n\nThanks a lot in advance,\n\nThomas.\n", "id": 27648, "time": "2002-12-11T08:28:54Z", "bug_id": 15113, "creation_time": "2002-12-11T08:28:54Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 15113, "is_private": false, "count": 2, "id": 27663, "time": "2002-12-11T16:50:50Z", "creator": "rederpj@remulak.net", "creation_time": "2002-12-11T16:50:50Z", "text": "Thomas, I am currently looking at this PR. While I am working to debug this,\ncould you attach a section of your error_log around the time this happens (with\nloglevel set to debug)? Thanks."}, {"attachment_id": null, "tags": [], "bug_id": 15113, "is_private": false, "count": 3, "id": 27670, "time": "2002-12-11T17:45:30Z", "creator": "tcastelle@generali.fr", "creation_time": "2002-12-11T17:45:30Z", "text": "OK, thanks for looking !\n\nI reproduced the bug.\n\nLast CVS snapshot used, compiled with :\n\n./configure --prefix=/opt/ApacheProxy2.0 --localstatedir=/logs/ApacheProxy2.0\n--enable-cache --enable-disk-cache --enable-proxy --enable-rewrite --enable-deflate\n\nIt is configured as a proxy-cache. When the serveur behind answers a 403 or 302\nresponse, the child dies. With a telnet on a 403 page :\n\n# telnet 172.30.16.21 80\nTrying 172.30.16.21...\nConnected to 172.30.16.21.\nEscape character is '^]'.\nGET /blablabla HTTP/1.1\nHost: front.www.leda.rev.proto.generali.fr\n\nConnection closed by foreign host.\n#\n\nIn the error.log :\n\n[Wed Dec 11 18:26:57 2002] [notice] Apache configured -- resuming normal operations\n[Wed Dec 11 18:26:57 2002] [info] Server built: Dec 11 2002 18:20:58\n[Wed Dec 11 18:26:57 2002] [debug] prefork.c(1039): AcceptMutex: sysvsem\n(default: sysvsem)\n[Wed Dec 11 18:27:33 2002] [notice] child pid 1574 exit signal Segmentation\nfault (11)\n\nIn the virtual host error log :\n\n[Wed Dec 11 18:27:32 2002] [debug] mod_cache.c(118): cache: URL /blablabla is\nbeing handled by disk\n[Wed Dec 11 18:27:32 2002] [debug] mod_cache.c(202): cache: no cache - add\ncache_in filter and DECLINE\n[Wed Dec 11 18:27:32 2002] [debug] proxy_http.c(109): proxy: HTTP:\ncanonicalising URL //www.leda.rev.proto.generali.fr/blablab\nla\n[Wed Dec 11 18:27:32 2002] [debug] mod_proxy.c(440): Trying to run\nscheme_handler against proxy\n[Wed Dec 11 18:27:32 2002] [debug] proxy_http.c(1170): proxy: HTTP: serving URL\nhttp://www.leda.rev.proto.generali.fr/blablabl\na\n[Wed Dec 11 18:27:32 2002] [debug] proxy_http.c(221): proxy: HTTP connecting\nhttp://www.leda.rev.proto.generali.fr/blablabla t\no www.leda.rev.proto.generali.fr:80\n[Wed Dec 11 18:27:32 2002] [debug] proxy_util.c(1201): proxy: HTTP: fam 2 socket\ncreated to connect to proxybo1.generali.fr\n[Wed Dec 11 18:27:32 2002] [debug] proxy_http.c(370): proxy: socket is connected\n[Wed Dec 11 18:27:32 2002] [debug] proxy_http.c(404): proxy: connection complete\nto 172.30.4.4:9080 (proxybo1.generali.fr)\n[Wed Dec 11 18:27:32 2002] [debug] proxy_http.c(1012): proxy: start body send\n[Wed Dec 11 18:27:32 2002] [debug] mod_cache.c(436): cache: running CACHE_IN filter\n\nAs I said before, it seems to crash on the particular call to apr_pstrcat. If I\ncomment it, it works.\n\nin error.log :\n[Wed Dec 11 18:38:31 2002] [notice] Apache configured -- resuming normal operations\n[Wed Dec 11 18:38:31 2002] [info] Server built: Dec 11 2002 18:20:58\n[Wed Dec 11 18:38:31 2002] [debug] prefork.c(1039): AcceptMutex: sysvsem\n(default: sysvsem)\n\nin virtual host error log :\n[Wed Dec 11 18:39:03 2002] [debug] mod_cache.c(118): cache: URL /blablabla is\nbeing handled by disk\n[Wed Dec 11 18:39:03 2002] [debug] mod_cache.c(202): cache: no cache - add\ncache_in filter and DECLINE\n[Wed Dec 11 18:39:03 2002] [debug] proxy_http.c(109): proxy: HTTP:\ncanonicalising URL //www.leda.rev.proto.generali.fr/blablab\nla\n[Wed Dec 11 18:39:03 2002] [debug] mod_proxy.c(440): Trying to run\nscheme_handler against proxy\n[Wed Dec 11 18:39:03 2002] [debug] proxy_http.c(1170): proxy: HTTP: serving URL\nhttp://www.leda.rev.proto.generali.fr/blablabl\na\n[Wed Dec 11 18:39:03 2002] [debug] proxy_http.c(221): proxy: HTTP connecting\nhttp://www.leda.rev.proto.generali.fr/blablabla t\no www.leda.rev.proto.generali.fr:80\n[Wed Dec 11 18:39:03 2002] [debug] proxy_util.c(1201): proxy: HTTP: fam 2 socket\ncreated to connect to proxybo1.generali.fr\n[Wed Dec 11 18:39:03 2002] [debug] proxy_http.c(370): proxy: socket is connected\n[Wed Dec 11 18:39:03 2002] [debug] proxy_http.c(404): proxy: connection complete\nto 172.30.4.4:9080 (proxybo1.generali.fr)\n[Wed Dec 11 18:39:03 2002] [debug] proxy_http.c(1012): proxy: start body send\n[Wed Dec 11 18:39:03 2002] [debug] mod_cache.c(436): cache: running CACHE_IN filter\n[Wed Dec 11 18:39:03 2002] [info] disk_cache: Caching URL\nfront.www.leda.rev.proto.generali.fr/blablabla?\n[Wed Dec 11 18:39:03 2002] [debug] mod_cache.c(806): cache: Caching url: /blablabla\n[Wed Dec 11 18:39:03 2002] [info] disk_cache: Caching headers for URL\nfront.www.leda.rev.proto.generali.fr/blablabla?\n[Wed Dec 11 18:39:03 2002] [info] disk_cache: Cached body for URL\nfront.www.leda.rev.proto.generali.fr/blablabla?\n[Wed Dec 11 18:39:03 2002] [debug] proxy_http.c(1071): proxy: end body send\n\nThanks for your help ! And as a bonus-question... is mod_cache actively\ndevelopped in the moment ? Because the only problems we have with Apache 2 come\nfrom this module, and it doesn't seem to be really often updated (well, as far\nas i can see on the cvs snapshots...). Can someone tell me if it will we stable\nin the next release ?\n\nThanks a lot for your effort !\n\nThomas.\n"}, {"count": 4, "tags": [], "creator": "tcastelle@generali.fr", "text": "Hi there !\n\nIs there some news about this bug ? Have you reproduced the problem ?\nPlease keep me informed !\nThanks in advance, \n\nThomas.", "id": 27945, "time": "2002-12-17T08:15:35Z", "bug_id": 15113, "creation_time": "2002-12-17T08:15:35Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "rederpj@remulak.net", "attachment_id": null, "id": 27958, "time": "2002-12-17T15:42:06Z", "bug_id": 15113, "creation_time": "2002-12-17T15:42:06Z", "is_private": false, "text": "I just applied a fix to mod_cache.c that cures the core dump. This fix will be\nincluded in a future release of Apache. Thank you for reporting this problem."}]
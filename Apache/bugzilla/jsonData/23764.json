[{"count": 0, "tags": [], "bug_id": 23764, "is_private": false, "id": 45483, "attachment_id": null, "creator": "adam.hardy@cyberspaceroad.com", "creation_time": "2003-10-13T10:00:54Z", "time": "2003-10-13T10:00:54Z", "text": "If I have SSO enabled, and I log on to my webapp, and also visit a second webapp\non my localhost, I can't logout anymore.\n\nIf I go to the page which has the following JSP:\n\nremote user <%=request.getRemoteUser() %> in\nsession <%= session.getId() %>\n<%\nsession.invalidate();\n%>\n\nand refresh over and over always showed the following:\n\nremote user adam in session EB2543D909D52551EA58C77E963CDD17\nremote user adam in session EA33F35CCB3D1205A88226029C65939C\nremote user adam in session 8814C0365D3F0BDD97B1DE9B7EAECD17\nremote user adam in session 1B7F0424190985F24A294EA2344888C5\n\nThe only way to logout is to close my browser or delete the JSESSIONIDSSO cookie\nin mozilla. \n\nBut logout does work for just one app - if I only visit & login to one webapp,\nwhen I invalidate the session, I immediately get a login request.\n\nNB: The logout functions correctly when all my sessions expire. \n\nNB2: When some but not all of my sessions in one SSO time out, I can re-access\nthe timed-out webapps without seeing a login request. \n\nHope that describes it clearly,\n\nAdam"}, {"count": 1, "tags": [], "bug_id": 23764, "attachment_id": null, "text": "There is a difference in SingleSignOn.java between 4.1 and 5.0. But the diff\ndoesn't make sense to me: what follows is the diff from 4.1 to 5 for what I\n*guess* is the cause:\n-        // Deregister this single session id, invalidating associated sessions\n-        deregister(ssoId);\n+        if ( event.getData() != null \n+             && \"logout\".equals( event.getData().toString() )) {\n+            // logout of all applications\n+            deregister(ssoId);\n+        } else {\n+            // invalidate just one session\n+            deregister(ssoId, session);\n+        }\n\nDoing a grep for \"logout\" - I could not find one  - so I have no idea when the\ntrue part of the conditional gets executed. Any ideas?", "id": 45489, "time": "2003-10-13T11:08:14Z", "creator": "funkman@joedog.org", "creation_time": "2003-10-13T11:08:14Z", "is_private": false}, {"count": 2, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 45501, "time": "2003-10-13T13:29:47Z", "bug_id": 23764, "creation_time": "2003-10-13T13:29:47Z", "is_private": false, "text": "This could have been added for more control, so I would leave the feature in and\ntry to understand why. This is from a Patrick and Bob patch, so I don't think we\ncan get an explanation as to why it is the right thing to do from them."}, {"count": 3, "tags": [], "creator": "jfarcand@apache.org", "text": "Logout has been removed from the Servlet spec (I did remove the method) and\nprobably forgot (wasn't aware of such behavour) that part. I will also take to look.\n\n-- Jeanfrancois", "id": 45517, "time": "2003-10-13T13:59:23Z", "bug_id": 23764, "creation_time": "2003-10-13T13:59:23Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "In the absence of a better solution, I've reverted the change to SSO.", "is_private": false, "id": 47393, "creation_time": "2003-11-15T09:43:05Z", "time": "2003-11-15T09:43:05Z", "creator": "remm@apache.org", "bug_id": 23764, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 9900, "attachment_id": null, "id": 17879, "creation_time": "2002-06-16T12:27:43Z", "time": "2002-06-16T12:27:43Z", "creator": "jeff@socialchange.net.au", "text": "Hi,\n\nSay I have a custom task, <print>, which takes a <message> nested element:\n\n<print>\n  <message text=\"This is a message\"/>\n</print>\n\nIn my Print.java class, the Message object is added via:\n\npublic void addConfiguredMessage(Message m) { ... }\n\nThat's all fine. Now say I wrap everything in a <parallel> element:\n\n<parallel>\n   <print>\n     <message text=\"This is a message\"/>\n   </print>\n</parallel>\n\nI find that the addConfiguredMessage() method is called *twice*. If I wrap it\nagain (2 parallel's), it is called 3 times. \n\nThe same thing happens when wrapping in <sequential>, and (I imagine) any other\nTaskContainer.\n\nIt does NOT happen if the Message object is added via addMessage(), not\naddConfiguredMessage().\n\nAFAIK, the same bug is present in Ant 1.5beta2.\n\nI'd hazard a guess that the problem is that ProjectHelperImpl.TaskHandler.init()\nis called multiple times, once per TaskContainer, and init() calls the\naddConfiguredMessage() method.\n\nAttached is a demo of the problem. Unpackage, type 'ant' to compile, then 'ant\n-f run.xml' to demonstrate the bug.\n\nThanks,\n\n\n--Jeff", "is_private": false}, {"count": 1, "tags": [], "bug_id": 9900, "text": "Created attachment 2091\nDemonstration of bug 9900", "id": 17880, "time": "2002-06-16T12:34:08Z", "creator": "jeff@socialchange.net.au", "creation_time": "2002-06-16T12:34:08Z", "is_private": false, "attachment_id": 2091}, {"count": 2, "tags": [], "text": "Cant you turn on debugging and do a StackTrace to see where and when these \nmethods are called???\nRegards,\nMartin", "attachment_id": null, "bug_id": 9900, "id": 17887, "time": "2002-06-16T20:11:59Z", "creator": "mgainty@hotmail.com", "creation_time": "2002-06-16T20:11:59Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jeff@socialchange.net.au", "attachment_id": null, "is_private": false, "id": 17888, "time": "2002-06-16T22:52:58Z", "bug_id": 9900, "creation_time": "2002-06-16T22:52:58Z", "text": "Good idea. Hmm.. looks like it's because <sequential> and <parallel> call the\ntask's perform() method, which in turn calls maybeConfigure(). So for each\nnested <sequential>, it is reconfigured.\n\nThis comment by Jon Skeet, just above Task.java's maybeConfigure() method, looks\nrelevant:\n\n    // XXX: (Jon Skeet) The comment \"if it hasn't been done already\" may\n    // not be strictly true. wrapper.maybeConfigure() won't configure the same\n    // attributes/text more than once, but it may well add the children again,\n    // unless I've missed something.\n\nThat last bit, \"may well add the children again\", seems to be what I'm observing.\n\n\nHere's what the stack looks like on the second addConfigured method call for:\n<sequential>\n  <print>\n    <message text=\"This is a message\"/>\n  </print>                                                                     \n                             </sequential>\n\n/home/jeff/antbug9900/run.xml:35: java.lang.RuntimeException: Marker exception\nthrown because addConfiguredMessage() was called more than once\n        at\norg.apache.tools.ant.IntrospectionHelper.storeElement(IntrospectionHelper.java:586)\n        at org.apache.tools.ant.ProjectHelper.storeChild(ProjectHelper.java:382)\n        at\norg.apache.tools.ant.RuntimeConfigurable.maybeConfigure(RuntimeConfigurable.java:220)\n        at org.apache.tools.ant.Task.maybeConfigure(Task.java:253)\n        at org.apache.tools.ant.Task.perform(Task.java:312)\n        at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:94)\n        at org.apache.tools.ant.Task.perform(Task.java:313)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:334)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1216)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1160)\n        at org.apache.tools.ant.Main.runBuild(Main.java:605)\n        at org.apache.tools.ant.Main.start(Main.java:195)\n        at org.apache.tools.ant.Main.main(Main.java:234)\n--- Nested Exception ---\njava.lang.RuntimeException: Marker exception thrown because\naddConfiguredMessage() was called more than once\n        at Print.addConfiguredMessage(Print.java:18)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at\norg.apache.tools.ant.IntrospectionHelper$3.store(IntrospectionHelper.java:314)\n        at\norg.apache.tools.ant.IntrospectionHelper.storeElement(IntrospectionHelper.java:574)\n        at org.apache.tools.ant.ProjectHelper.storeChild(ProjectHelper.java:382)\n        at\norg.apache.tools.ant.RuntimeConfigurable.maybeConfigure(RuntimeConfigurable.java:220)\n        at org.apache.tools.ant.Task.maybeConfigure(Task.java:253)\n        at org.apache.tools.ant.Task.perform(Task.java:312)\n        at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:94)\n        at org.apache.tools.ant.Task.perform(Task.java:313)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:334)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1216)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1160)\n        at org.apache.tools.ant.Main.runBuild(Main.java:605)\n        at org.apache.tools.ant.Main.start(Main.java:195)\n        at org.apache.tools.ant.Main.main(Main.java:234)\n\n\n\n\nAnd here's the stack on the third addConfigured call for:\n\n<sequential> \n  <sequential>\n    <print>\n       <message text=\"This is a message\"/>\n    </print>\n  </sequential>\n</sequential>\n\n\n/home/jeff/antbug9900/run.xml:36: java.lang.RuntimeException: Marker exception\nthrown because addConfiguredMessage() was called more than once\n        at\norg.apache.tools.ant.IntrospectionHelper.storeElement(IntrospectionHelper.java:586)\n        at org.apache.tools.ant.ProjectHelper.storeChild(ProjectHelper.java:382)\n        at\norg.apache.tools.ant.RuntimeConfigurable.maybeConfigure(RuntimeConfigurable.java:220)\n        at org.apache.tools.ant.Task.maybeConfigure(Task.java:253)\n        at org.apache.tools.ant.Task.perform(Task.java:312)\n        at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:94)\n        at org.apache.tools.ant.Task.perform(Task.java:313)\n        at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:94)\n        at org.apache.tools.ant.Task.perform(Task.java:313)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:334)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1216)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1160)\n        at org.apache.tools.ant.Main.runBuild(Main.java:605)\n        at org.apache.tools.ant.Main.start(Main.java:195)\n        at org.apache.tools.ant.Main.main(Main.java:234)\n--- Nested Exception ---\njava.lang.RuntimeException: Marker exception thrown because\naddConfiguredMessage() was called more than once\n        at Print.addConfiguredMessage(Print.java:18)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at\norg.apache.tools.ant.IntrospectionHelper$3.store(IntrospectionHelper.java:314)\n        at\norg.apache.tools.ant.IntrospectionHelper.storeElement(IntrospectionHelper.java:574)\n        at org.apache.tools.ant.ProjectHelper.storeChild(ProjectHelper.java:382)\n        at\norg.apache.tools.ant.RuntimeConfigurable.maybeConfigure(RuntimeConfigurable.java:220)\n        at org.apache.tools.ant.Task.maybeConfigure(Task.java:253)\n        at org.apache.tools.ant.Task.perform(Task.java:312)\n        at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:94)\n        at org.apache.tools.ant.Task.perform(Task.java:313)\n        at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:94)\n        at org.apache.tools.ant.Task.perform(Task.java:313)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:334)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1216)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1160)\n        at org.apache.tools.ant.Main.runBuild(Main.java:605)\n        at org.apache.tools.ant.Main.start(Main.java:195)\n        at org.apache.tools.ant.Main.main(Main.java:234)\n\n\n--Jeff"}]
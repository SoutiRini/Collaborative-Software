[{"count": 0, "tags": [], "bug_id": 37322, "text": "Hi,\n\nmod_jk, more precisely\njakarta-tomcat-connectors-1.2.14.1-src/jk/native/apache-2.0/mod_jk.c\njakarta-tomcat-5.5.9-src/jakarta-tomcat-connectors/jk/native/apache-2.0/mod_jk.c\ncontain the following format security bug.\n\nThe good news is that it currently cannot be easily misused, because\nthe function involved is so far only used with the format string\n\"Memory Error\" -- not a single \"%\" therein.\nHowever it's just sitting there, waiting to be put to other uses.\n\njk_error_exit() calls apr_pvsprintf() to create a formatted string\n(possibly using varargs) that is itself passed to ap_log_error().\nSadly, the latter function again uses sprintf-style formatting, so\nthat if a %-sign were obtained as a result of the first round of\nformatting (e.g. as part of the output of some %s directive),\nundefined behaviour could occur in the second pass.\n\nProposed solution:\n\"inline\" the jk_error_code(), i.e. turn\n  jk_error_exit(APLOG_MARK, APLOG_EMERG, s, p, \"Memory error\");\ninto:\n // use ap_log_[p/r/c]error(...) depending on availability of\n // either p (pool), s (server_rec *) or r (conn_rec *) at the call site.\n {\n   ap_log_perror(APLOG_MARK, APLOG_EMERG, 0, p, \"Memory error\");\n   exit(1);\n }\n\nI found this bug while performing a code inspection on behalf of BSI,\nthe german Federal Office for Information Security.\n -- Bundesamt f\u00fcr Sicherheit in der Informationstechnik.\nhttp://www.bsi.de\n\nBSI endorses the use of Open Source Software. A report of our\nactivities covering installation, code and penetration tests of Tomcat\nwill be published by BSI in the internet at the end of our review\nproject.\n\nRegards,\n J\u00f6rg H\u00f6hle.\nT-Systems International, Solution Center Testing & Security\nhttp://www.t-systems.com", "id": 82015, "time": "2005-11-01T17:50:59Z", "creator": "Joerg-Cyril.Hoehle@t-systems.com", "creation_time": "2005-11-01T17:50:59Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 37322, "attachment_id": null, "id": 86949, "creation_time": "2006-03-17T08:46:36Z", "time": "2006-03-17T08:46:36Z", "creator": "mturk@apache.org", "text": "Like you said:\n\nThe good news is that it currently cannot be easily misused, because\nthe function involved is so far only used with the format string\n\"Memory Error\" -- not a single \"%\" therein.\nHowever it's just sitting there, waiting to be put to other uses.\n\nSo, we'll be paranoid if someone puts \"%\" instead \"Memory error\"", "is_private": false}, {"count": 2, "tags": [], "bug_id": 37322, "attachment_id": null, "text": "An additional safety net has been introduced, any remaining special formatting\ncharacter gets replaced now. Will be part of 1.2.27.", "id": 112376, "time": "2008-01-01T16:02:53Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-01T16:02:53Z", "is_private": false}]
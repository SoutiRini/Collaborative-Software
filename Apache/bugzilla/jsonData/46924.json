[{"count": 0, "tags": [], "bug_id": 46924, "attachment_id": 23419, "is_private": false, "id": 125831, "time": "2009-03-26T16:18:25Z", "creator": "adrianosf@gmail.com", "creation_time": "2009-03-26T16:18:25Z", "text": "Created attachment 23419\nExample project\n\nI tried a very basic example, based on Maven quickstart. web.xml is almost empty, and a jsp page:\n=================\n<html>\n<body>\n\n<%\n   String x = (String) request.getSession(true).getAttribute(\"x\");\n   if (x == null)\n       x = \"0\";\n   int y = Integer.valueOf(x) + 1;\n   request.getSession(true).setAttribute(\"x\", String.valueOf(y));\n%>\n\n<%= y %>\n\n</body>\n</html>\n=================\n\nSo I start reloading the page. The number increments. I can stop/start or reload the app. The number continue incrementing.\n\nThen I touch (with gnuwin32 touch utility) the war file. The Tomcat console displays:\n=================\n26/03/2009 11:11:28 org.apache.catalina.core.StandardContext reload\nINFO: Reloading this Context has started\n26/03/2009 11:12:02 org.apache.catalina.startup.HostConfig checkResources\nINFO: Undeploying context [/example]\n26/03/2009 11:12:02 org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive example.war\n=================\n\nYou see, it undeployed, and the counter has reseted.\n\nNow, I tried delete webapps/example. After some seconds, the war is exploded and same thing as above happens.\n\nThen I tried to delete webapps/example/*, leaving the directory empty. This way, I can manually extract the war there, and session is preserved.\n\nCharles (Chuck) Caldarale, said this is an inconsistency worth registering."}, {"count": 1, "tags": [], "creator": "kirk@mustardgrain.com", "attachment_id": null, "text": "In addition to the OP seeing this on Windows on 6.1.18, I am able to reproduce this on Linux against the trunk. \n\nOP - thanks for the example (Maven) project and the clear steps.\n\nThere are three cases discussed; this is what happens presently:\n\n    * Touching $TOMCAT_HOME/webapps/example.war - sessions deleted\n    * Deleting $TOMCAT_HOME/webapps/example - sessions deleted\n    * Deleting $TOMCAT_HOME/webapps/example/* - sessions preserved\n\nSo what is the expected behaviour with regard to the above cases?", "id": 126043, "time": "2009-04-07T09:06:21Z", "bug_id": 46924, "creation_time": "2009-04-07T09:06:21Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 46924, "attachment_id": null, "id": 126044, "time": "2009-04-07T09:12:02Z", "creator": "kirk@mustardgrain.com", "creation_time": "2009-04-07T09:12:02Z", "is_private": false, "text": "Whoops - regarding comment 1:\n\n    s/6.1.18/6.0.18/g"}, {"count": 3, "tags": [], "bug_id": 46924, "attachment_id": null, "is_private": false, "id": 126045, "time": "2009-04-07T09:52:14Z", "creator": "adrianosf@gmail.com", "creation_time": "2009-04-07T09:52:14Z", "text": "I would like to add, althrough that may be a different problem, that in some cases (probably for larger [20mb] war files), when you start replace a war with another, Tomcat starts the new deploy before the war file is entire writen. That causes errors as corrupted war file."}, {"count": 4, "tags": [], "creator": "kirk@mustardgrain.com", "attachment_id": null, "text": "Yeah, I've noticed this problem too. I wonder if there should be some kind of idle wait that waits for N milliseconds without a file change before trying to unzip.", "id": 126047, "time": "2009-04-07T10:15:20Z", "bug_id": 46924, "creation_time": "2009-04-07T10:15:20Z", "is_private": false}, {"count": 5, "tags": [], "text": "(In reply to comment #3)\n> I would like to add, althrough that may be a different problem, that in some\n> cases (probably for larger [20mb] war files), when you start replace a war with\n> another, Tomcat starts the new deploy before the war file is entire writen.\n> That causes errors as corrupted war file.\n\nIf your filing system takes longer than the war deployer monitor interval to copy 20Mb you have a very slow harddrive and should consider upgrading.\n\nIf on the other hand you are FTPing a war file straight into your webapps dir, then you should probably rethink your strategy - as that's not the most sensible approach - e.g. rename before upload, upload to safe temp dir, etc.", "is_private": false, "bug_id": 46924, "id": 126048, "time": "2009-04-07T10:58:31Z", "creator": "bugzilla@pidster.com", "creation_time": "2009-04-07T10:58:31Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Good news and bad news I am afraid. The good news is that this is 'fixed'. The bad news is that the fix is making the docs clearer that Tomcat is working as designed in this case.\n\nThere are ways to achieve an update to an application without dropping the sessions. The simplest is probably:\n - deploy as an exploded directory rather than a WAR\n - update the files\n - touch web.xml to trigger a reload\n\nThis is only one way. If you want to discuss the alternatives then please use the users list.\n\nThe reason for the current behaviour is to prevent problems when WARs are updated in incompatible ways and anything other than a full undeploy followed by (essentially) a new deployment causes conflicts.\n\nThe updated docs are in trunk and 6.0.x and will be included in 6.0.20 onwards.", "is_private": false, "bug_id": 46924, "id": 126272, "time": "2009-04-15T15:57:03Z", "creator": "markt@apache.org", "creation_time": "2009-04-15T15:57:03Z", "attachment_id": null}]
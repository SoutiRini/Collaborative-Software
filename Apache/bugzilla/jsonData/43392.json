[{"count": 0, "tags": [], "bug_id": 43392, "attachment_id": null, "text": "Issue when specifying custom User/Role security principal classes in a JAASRealm\nelement within a /META-INF/context.xml of a war. Tomcat 6 should obey the\nuseContextClassLoader configuration of the JAASRealm when parsing the user/role\nclassNames.\n\n<Realm\nclassName=\"org.apache.catalina.realm.JAASRealm\"\nappName=\"PortalRealm\"\nuserClassNames=\"com.liferay.portal.security.jaas.PortalPrincipal\"\nroleClassNames=\"com.liferay.portal.security.jaas.PortalRole\"\ndebug=\"99\"\nuseContextClassLoader=\"false\"\n/>\n\nUpon server startup, the Tomcat 6.0.14 JAASRealm attempts to load the\nuserClassNames and roleClassNames in parseClassNames with Class.forName(), and\nsince these classes reside only in the webapp context (/WEB-INF/lib/) they are\nnot found on the classpath, and causes the following output in the Tomcat\nconsole upon startup:\n         SEVERE: Class com.liferay.portal.security.jaas.PortalPrincipal not\nfound! Class not added.\n         SEVERE: Class com.liferay.portal.security.jaas.PortalRole not found!\nClass not added.\n\nTomcat 5.5.x did not report these failures, because it did not attempt to\nperform a Class.forName() lookup. Instead, it only saved the userClassNames and\nroleClassNames in a java.util.List object.", "id": 108187, "time": "2007-09-13T21:34:49Z", "creator": "computabloke@gmail.com", "creation_time": "2007-09-13T21:34:49Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43392, "text": "Sorry, I meant the issue occurs when using useContextClassLoader=\"true\" in the\noriginal report (which is the default according to\nhttp://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html#JAASRealm).\n\nAs a temporary work-around for this issue you can:\n1. Move your classes to the Tomcat shared /lib directory.\n2. Since all principals must implement java.security.Principal, and the first\nprincipal 'must' be the user principal, you can just use the base class:\n<Realm\nclassName=\"org.apache.catalina.realm.JAASRealm\"\nappName=\"PortalRealm\"\nuserClassNames=\"java.security.Principal\"\ndebug=\"99\"\nuseContextClassLoader=\"true\"\n/>", "id": 108188, "time": "2007-09-13T21:45:36Z", "creator": "computabloke@gmail.com", "creation_time": "2007-09-13T21:45:36Z", "is_private": false, "attachment_id": null}, {"text": "I think this was caused by the changes for bug 40150", "tags": [], "bug_id": 43392, "attachment_id": null, "count": 2, "id": 109042, "time": "2007-10-05T14:24:15Z", "creator": "kzettel@gmail.com", "creation_time": "2007-10-05T14:24:15Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43392, "attachment_id": null, "text": "Just noticed this bug report. I put up a patch at bug 44084, would be cool if\nyou could try it.\n\nThe logic also seemed to be backwards to me. I assume useContextClassLoader\nmeans to use Thread.currentThread().getContextClassLoader(), which is the\nwebapp's class loader, and useContextClassLoader=\"false\" means the servlet class\nloader, which is retrieved by getClass().getClassLoader() from the JAASRealm.", "id": 111825, "time": "2007-12-15T14:55:14Z", "creator": "nlevitt@gmail.com", "creation_time": "2007-12-15T14:55:14Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43392, "attachment_id": null, "text": "Thanks Noah, The patch looks perfect to me. I hope it makes it into the next\nrelease!\nSince the patch is in 44084, I'll mark this one as a duplicate.\nSee also bug 40150 that Ate re-opened so that the patch could be applied to T5.5\ntoo.\n\n*** This bug has been marked as a duplicate of 44084 ***", "id": 111969, "time": "2007-12-20T19:22:10Z", "creator": "computabloke@gmail.com", "creation_time": "2007-12-20T19:22:10Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 37348, "text": "XSLT transformation doesn't work if I run ANT from directory with NON-ASCII \nchars.\n\nThere are more problems. One problem is in wrong Xalan, see also related bug \nfro Xalan:\n\nhttp://issues.apache.org/jira/browse/XALANJ-2000\n\nIf I patch Xalan according to patch from previous bug, then I can include some \nXSLT from another XSLT, but next problem appeared: I can't use ENTITY \ndeclaration correctly.\n\nTry to create some directory with NON-ASCII chars and try to transform XML like \nthis one through ANT (using fixed Xalan):\n\n\n====================================\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!DOCTYPE workspace [\n   <!ENTITY globaldefinitions SYSTEM \"globaldef.xml\">\n   <!ENTITY globaldefinitions_bc SYSTEM \"globaldef_bc.xml\">\n   <!ENTITY installationtypes SYSTEM \"insttypes.xml\">\n]>\n<workspace>\n\n  &globaldefinitions;\n  &globaldefinitions_bc;\n  &installationtypes;\n\n  ....\n\n====================================\n\nThen you receive error something like this one:\n\n====================================\n\nC:\\systinet\\divn\u00fd_link\\etc\\bin>xslt tools.xsl tools.xml bla\nJAVA_HOME=D:\\soft\\dev\\java\nBuildfile: D:\\bin\\xslt.xml\n\nxsl:\n     [xslt] Processing C:\\systinet\\divn\u00f8_link\\etc\\bin\\tools.xml to \nC:\\systinet\\divn\u00f8_link\\etc\\bin\\bl\na\n     [xslt] Loading stylesheet C:\\systinet\\divn\u00f8_link\\etc\\bin\\tools.xsl\n     [xslt] : Fatal Error! java.net.MalformedURLException: no protocol: \nglobaldef.xml Cause: java.ne\nt.MalformedURLException: no protocol: globaldef.xml\n     [xslt] Failed to process C:\\systinet\\divn\u00f8_link\\etc\\bin\\tools.xml\n\n====================================\n\nIf I use fixed Xalan directly, then everything seems to be OK. For example I \ntried call like this one:\n\njava -verbose -Xbootclasspath/p:xalan.jar org.apache.xalan.xslt.Process -XSL \ntools.xsl -IN tools.xml -OUT pokus\n\nPrevious call edns correctly.\n\n\nIt seems, tha problem is somewhere in ANT's implementation of EntityResolver. \nPlease, fix it. Thanks. Verbose output will follow as bug attachment.", "id": 82102, "time": "2005-11-03T18:37:44Z", "creator": "literakr@systinet.com", "creation_time": "2005-11-03T18:37:44Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "literakr@systinet.com", "attachment_id": 16869, "text": "Created attachment 16869\nErrors from ANT\n\nError output from ANT which tries to transform some XML referencing\n(relatively) another XMLs from directory with NON-ASCII chars (e.g.\n\"C:\\systinet\\divn\u00fd_link\\etc\\bin\").", "id": 82103, "time": "2005-11-03T18:47:43Z", "bug_id": 37348, "creation_time": "2005-11-03T18:47:43Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 37348, "attachment_id": null, "text": "So, some additional little notice: If I use the same files (unchanged) from \ndirectory, where only ASCII (standard) chars are used, then problem also \ndisappeared.", "id": 82104, "time": "2005-11-03T18:56:36Z", "creator": "literakr@systinet.com", "creation_time": "2005-11-03T18:56:36Z", "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 37348, "is_private": false, "id": 82106, "time": "2005-11-03T19:40:55Z", "creator": "antoine@apache.org", "creation_time": "2005-11-03T19:40:55Z", "tags": [], "text": "Hello,\nI am not sure yet what the problem is, but I have been working on a similar\nissue recently, where a small fix has been done in SVN in the class AntClassLoader.\nSomeone wrote on the user list that ant does not run at all if ANT_HOME contains\nnon ascii character anyway.\n\nCheers,\n\nAntoine"}, {"count": 4, "attachment_id": 16874, "bug_id": 37348, "is_private": false, "id": 82136, "time": "2005-11-05T00:07:22Z", "creator": "antoine@apache.org", "creation_time": "2005-11-05T00:07:22Z", "tags": [], "text": "Created attachment 16874\nfile containing elements to reproduce problem (tar.gz)\n\nI found out that this problem is not a bug from Ant. \nI need to investigate further. At this stage, I think that it is a bug of the\nversion of xerces which ships in the JDK 1.5 (and may be 1.4) ?\nAFAIK javax.xml.parsers.DocumentBuilder#parse(File)\nand javax.xml.parsers.DocumentBuilder#parse(InputSource) would be unable to\nresolve file entities when the entities are located in directories containing\nnon ASCII characters.\nTo be precise, I did my tests under JDK 1.5.0_04-b05 on Windows 2000.\nThe next verifications to be done are :\n1) has this problem been reported/solved with the Apache XML project ?\n2) has this problem been reported/solved with Sun ?"}, {"count": 5, "tags": [], "bug_id": 37348, "is_private": false, "text": "The SVN version of Xerces-Java 2 has still the same bug.\nI have done a search in JIRA to find what could be related :\nhttp://issues.apache.org/jira/browse/XERCESJ-996\ngetBaseURI returns incorrect value for EntityReferences\n\nand \nhttp://issues.apache.org/jira/browse/XERCESJ-802\nFilenames with spaces in versions later than 2.0.2 (incl).\n", "id": 82139, "time": "2005-11-05T01:00:30Z", "creator": "antoine@apache.org", "creation_time": "2005-11-05T01:00:30Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "antoine@apache.org", "text": "Hello Radim,\nI think that a part of the problem might lie in the class\njavax.xml.DocumentBuilder which is part of the JDK.\nthe method DocumentBuilder#parse does this :\n\n        String uri = \"file:\" + f.getAbsolutePath();\n        if (File.separatorChar == '\\\\') {\n            uri = uri.replace('\\\\', '/');\n        }\n\nInstead, it should do this :\n\n        String uri = f.toURI().toASCIIString();\n\nAt least, this change allows to parse a document containing an entity include\nwhen like in your case both the main XML document and the entity include are\nlocated in a path containing non ASCII chars, such as c:/\u00e4nt\n\nI have filed a bug with Sun with what I have found.\n\nI am closing this report as INVALID.\nReopen this report only if you can prove that ant is faulty.", "id": 82140, "time": "2005-11-05T03:39:06Z", "bug_id": 37348, "creation_time": "2005-11-05T03:39:06Z", "is_private": false, "attachment_id": null}, {"text": "Actually, the fix is here :\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=34913\nThis message\nhttp://mail-archives.apache.org/mod_mbox/xml-commons-cvs/200506.mbox/%3c20050603182857.52401.qmail@minotaur.apache.org%3e\nshows the changes done by Michael Glavassevich.\nMaybe something like compiling the whole code which is in the file\ntools/xml-commons-external-src.zip in the xerces repository and putting the\ncorresponding jar file in the bootclasspath would be a work around to your problem.\nThe real solution is to get Sun to deliver a new JDK with all these fixes.\n", "tags": [], "bug_id": 37348, "is_private": false, "count": 7, "id": 82141, "time": "2005-11-05T04:16:00Z", "creator": "antoine@apache.org", "creation_time": "2005-11-05T04:16:00Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 37348, "is_private": false, "text": "There is a bug report of sun concerning this issue :\nhttp://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6341770\nI have tested this problem against the HEAD revision of xerces, and it does not\nwork either, so I will try to propose a patch.", "id": 82266, "time": "2005-11-09T07:29:45Z", "creator": "antoine@apache.org", "creation_time": "2005-11-09T07:29:45Z", "attachment_id": null}, {"text": "I changed my mind concerning this issue and decide to fix it in ant by changing\nFileUtils.toURI(). \nI am copying the way Xerces encodes a user dir in\norg.apache.xerces.impl.XMLEntityManager\nFileUtils.toURI() will now encode non ascii characters like\njava.io.File.toURI().toAsciiString().", "tags": [], "bug_id": 37348, "is_private": false, "count": 9, "id": 82601, "time": "2005-11-16T23:23:48Z", "creator": "antoine@apache.org", "creation_time": "2005-11-16T23:23:48Z", "attachment_id": null}, {"text": "Fixed in CVS. I have added a testcase in FileUtilsTest, but I need to set up\nanother behavioral test for the xslt task.", "tags": [], "bug_id": 37348, "is_private": false, "count": 10, "id": 82603, "time": "2005-11-16T23:47:18Z", "creator": "antoine@apache.org", "creation_time": "2005-11-16T23:47:18Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 37348, "text": "*** Bug 36513 has been marked as a duplicate of this bug. ***", "id": 91250, "time": "2006-07-13T03:39:53Z", "creator": "antoine@apache.org", "creation_time": "2006-07-13T03:39:53Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 31192, "is_private": false, "text": "I was trying to configure the JMSAppender for a client that was communicating\nwitha a jboss server.  If I configure the JMSAppender in code and add it to the\nlog4j configuration then all is fine.  However if I try and do it via a\nproperties file then I get a NPE.  The NPE is because of how log initializes\nIMHO.  In my junit setup() method I created an IntialContext for jboss.  The\ncreation of the IntialContext causes the jboss org.jnp.interfaces.NamingContext\nto be loader and it's static logger variable to attempt to initialize itsself\nwith a new Logger.  This seems to create a cycle where log4j now tries again to\ncreate the JMSAppender and and eventually calls the activateOptions on the\nJMSAppender class, which again creates a InitialContext and then tries to do a\nlookup().  The lookup leads back into the NamingContext which results in a NPE\nbecause one of its static variables has not been initialized because we have not\nfinished the original NamingContext initialization.\n\nlog4j:ERROR Error while activating options for appender named [jms].\njava.lang.NullPointerException\n\tat org.jnp.interfaces.NamingContext.checkRef(NamingContext.java:1190)\n\tat org.jnp.interfaces.NamingContext.lookup(NamingContext.java:515)\n\tat org.jnp.interfaces.NamingContext.lookup(NamingContext.java:508)\n\tat javax.naming.InitialContext.lookup(InitialContext.java:347)\n\tat org.apache.log4j.net.JMSAppender.lookup(Unknown Source)\n\tat org.apache.log4j.net.JMSAppender.activateOptions(Unknown Source)\n\tat org.apache.log4j.config.PropertySetter.activate(PropertySetter.java:247)\n\tat org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:123)\n\tat org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:87)\n\tat\norg.apache.log4j.PropertyConfigurator.parseAppender(PropertyConfigurator.java:645)\n\tat\norg.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:603)\n\tat\norg.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:500)\n\tat org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:406)\n\tat org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:432)\n\tat\norg.apache.log4j.helpers.OptionConverter.selectAndConfigure(OptionConverter.java:460)\n\tat org.apache.log4j.LogManager.<clinit>(LogManager.java:113)\n\tat org.jboss.logging.Log4jLoggerPlugin.init(Log4jLoggerPlugin.java:63)\n\tat org.jboss.logging.Logger.getDelegatePlugin(Logger.java:320)\n\tat org.jboss.logging.Logger.<init>(Logger.java:78)\n\tat org.jboss.logging.Logger.getLogger(Logger.java:291)\n\tat org.jnp.interfaces.NamingContext.<clinit>(NamingContext.java:101)\n\tat\norg.jnp.interfaces.NamingContextFactory.getInitialContext(NamingContextFactory.java:41)\n\tat javax.naming.spi.NamingManager.getInitialContext(NamingManager.java:662)\n\tat javax.naming.InitialContext.getDefaultInitCtx(InitialContext.java:243)\n\tat javax.naming.InitialContext.init(InitialContext.java:219)\n\tat javax.naming.InitialContext.<init>(InitialContext.java:195)\n\tat com.intervoice.xa.logging.core.LoggingTest.setUp(LoggingTest.java:64)\n\tat junit.framework.TestCase.runBare(TestCase.java:125)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:421)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:305)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:186)", "id": 63444, "time": "2004-09-13T07:00:37Z", "creator": "binyan357@yahoo.com", "creation_time": "2004-09-13T07:00:37Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 31192, "attachment_id": null, "is_private": false, "id": 63450, "time": "2004-09-13T08:53:58Z", "creator": "ceki@apache.org", "creation_time": "2004-09-13T08:53:58Z", "text": "\nJMSAppender has been tested with JBoss. Please provide a simple test case \nreproducing the problem. Please specify your environment JBoss version, log4j \nversion, JDK etc. In the mean time, I am closing this bug. You can reopen it later \nwhen you have a test case reproducing the problem. "}, {"count": 2, "tags": [], "bug_id": 31192, "text": "\nJMSAppender has been tested with JBoss. Please provide a simple test case \nreproducing the problem. Please specify your environment JBoss version, log4j \nversion, JDK etc. In the mean time, I am closing this bug. You can reopen it later \nwhen you have a test case reproducing the problem. ", "id": 63451, "time": "2004-09-13T08:54:18Z", "creator": "ceki@apache.org", "creation_time": "2004-09-13T08:54:18Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "binyan357@yahoo.com", "attachment_id": 12720, "text": "Created attachment 12720\nEclipse/MyEclipse project to reproduce the log4j error", "id": 63502, "time": "2004-09-13T22:57:57Z", "bug_id": 31192, "creation_time": "2004-09-13T22:57:57Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 31192, "text": "The attached project needs to have the log4j-1.2.8.jar, jbossall-client.jar and\njunit-3.8.1.jars added to the lib directory to successfully compile.  As a\nclarification there is no know problem with the jboss server, log4j and a jms\nappender.  Instead from a client, the following stacktrace is produced:\n\nlog4j:ERROR Error while activating options for appender named [jms].\njava.lang.NullPointerException\n\tat org.jnp.interfaces.NamingContext.checkRef(NamingContext.java:1190)\n\tat org.jnp.interfaces.NamingContext.lookup(NamingContext.java:515)\n\tat org.jnp.interfaces.NamingContext.lookup(NamingContext.java:508)\n\tat javax.naming.InitialContext.lookup(InitialContext.java:351)\n\tat org.apache.log4j.net.JMSAppender.lookup(Unknown Source)\n\tat org.apache.log4j.net.JMSAppender.activateOptions(Unknown Source)\n\tat org.apache.log4j.config.PropertySetter.activate(PropertySetter.java:247)\n\tat org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:123)\n\tat org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:87)\n\tat\norg.apache.log4j.PropertyConfigurator.parseAppender(PropertyConfigurator.java:645)\n\tat\norg.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:603)\n\tat\norg.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:500)\n\tat org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:406)\n\tat org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:432)\n\tat\norg.apache.log4j.helpers.OptionConverter.selectAndConfigure(OptionConverter.java:460)\n\tat org.apache.log4j.LogManager.<clinit>(LogManager.java:113)\n\tat org.jboss.logging.Log4jLoggerPlugin.init(Log4jLoggerPlugin.java:63)\n\tat org.jboss.logging.Logger.getDelegatePlugin(Logger.java:320)\n\tat org.jboss.logging.Logger.<init>(Logger.java:78)\n\tat org.jboss.logging.Logger.getLogger(Logger.java:291)\n\tat org.jnp.interfaces.NamingContext.<clinit>(NamingContext.java:101)\n\tat\norg.jnp.interfaces.NamingContextFactory.getInitialContext(NamingContextFactory.java:41)\n\tat javax.naming.spi.NamingManager.getInitialContext(NamingManager.java:667)\n\tat javax.naming.InitialContext.getDefaultInitCtx(InitialContext.java:247)\n\tat javax.naming.InitialContext.init(InitialContext.java:223)\n\tat javax.naming.InitialContext.<init>(InitialContext.java:197)\n\tat com.abc.logging.core.LoggingTest.setUp(LoggingTest.java:55)\n\tat junit.framework.TestCase.runBare(TestCase.java:125)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:421)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:305)\n\tat\norg.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:186)\n\n", "id": 63503, "time": "2004-09-13T23:01:19Z", "creator": "binyan357@yahoo.com", "creation_time": "2004-09-13T23:01:19Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 31192, "text": "The problem is that while the jvm is trying to initialize the static log4j\nlogger variable of the jboss NamingContext class, that log4j attempts to\nactivate all the appenders.  Therefore the JMSAppender tries to create an\ninitial context, which in turn uses the previously loaded, but incomplete\nNamingContext class.  The NamingContext was previously loaded therefore the jvm\ntries to call methods on the class which try and use fields that have not been\ninitialized because we have never completed the static variables initialization\nwhen the NamingContext class was first loaded.  \n\nI hope that makes sense.", "id": 63504, "time": "2004-09-13T23:14:12Z", "creator": "binyan357@yahoo.com", "creation_time": "2004-09-13T23:14:12Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 31192, "text": "Has then atleast verified as a bug (or future feature)?  I just curious as to\nwhether the real error was/is between the chair and keyboard.", "id": 63636, "time": "2004-09-15T21:36:25Z", "creator": "binyan357@yahoo.com", "creation_time": "2004-09-15T21:36:25Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "genman@noderunner.net", "attachment_id": null, "text": "\nI believe the only way to add a JMS appender in an app server like this would be\nto create -- in the JBoss world -- a deployable service. This service would\nstart post JMS initialization and instatiate the appropriate JMS appender.\n\nI don't see how this is something Log4J developers can address.\n", "id": 98595, "time": "2007-01-26T19:04:06Z", "bug_id": 31192, "creation_time": "2007-01-26T19:04:06Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "sebi+bugzilla@tux.wh17.tu-dresden.de", "attachment_id": null, "id": 20908, "time": "2002-08-12T12:49:54Z", "bug_id": 11630, "creation_time": "2002-08-12T12:49:54Z", "is_private": false, "text": "The solution (as introduced in \nsrc/main/org/apache/tools/ant/taskdefs/Rmic.java rev1.32) to really move \ngenerated *.java (if sourcebase is specified) from base dir to sourcebase \ncreates an StringIndexOutOfBoundsException.\n\nThe reason for the exception is line 574:\n            String sourceFileName = \n                generatedFiles[i].substring(0, classFileName.length() - 6)\n\nIt calculates the index based on the classFileName.  The following case \ndoesn't work with this calculation:\n\nHere we have an interface jatek.server.ChapterContainer (classname) or \njatek.server.ChapterContainer.class (classFileName) respective.\ngeneratedFiles[0] is jatek/server/_ChapterContainer_Tie.class\nThe sourceFileName (as generated in line 574) gets \njatek/server/_ChapterContaine.java\nAs you can see, the '_' in front of the file name causes the 'r' to be left. \n This is only an error, it doesn't throw the exception because the \ncalculated index is 29.  When we go an iteration further, we get \ngeneratedFiles[1]=jatek/_Chapter_Stub.class.  This string's length is only \n25.  So the calculated index 29 (from classFileName) is to long and \ntherefore causes the exception.\n\nI think you can solve the problem with the following patch.  The index is \ncalculated each iteration from generatedFiles[i] instead of from the \ninterface classname.\n\n---------------------------------------------------------------------------\n--- /tmp/Rmic.java.BAK  2002-08-12 12:41:42.000000000 +0200\n+++ src/main/org/apache/tools/ant/taskdefs/Rmic.java    2002-08-12 \n12:41:52.000000000 +0200\n@@ -572,7 +572,7 @@\n             }\n             \n             String sourceFileName = \n-                generatedFiles[i].substring(0, classFileName.length() - 6)\n+                generatedFiles[i].substring(0, generatedFiles[i].length() - \n6)\n                 + \".java\";\n \n             File oldFile = new File(baseDir, sourceFileName);\n---------------------------------------------------------------------------\n\n\nSebastian Klamar"}, {"count": 1, "attachment_id": null, "bug_id": 11630, "is_private": false, "id": 20989, "time": "2002-08-13T19:38:11Z", "creator": "sbailliez@apache.org", "creation_time": "2002-08-13T19:38:11Z", "tags": [], "text": "I applied your patch to the cvs 1.5 branch (not to cvs head yet)\nI'm not that familiar with the code and rmic behind but overall seems quite \nstrange to find an index in a string using the length of another for \ncalculation, so that was probably a typo.\n\nPlease doublecheck that the fix is ok. Thanks."}, {"count": 2, "tags": [], "bug_id": 11630, "attachment_id": null, "text": "I can confirm it as typo 8-)", "id": 22506, "time": "2002-09-09T12:15:28Z", "creator": "bodewig@apache.org", "creation_time": "2002-09-09T12:15:28Z", "is_private": false}]
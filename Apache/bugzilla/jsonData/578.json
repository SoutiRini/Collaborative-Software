[{"count": 0, "tags": [], "text": "Both using mod_jk and standalone, the SessionServlet example (for instance)\nfails to track session with cookies disabled when accessed through https://,\nwhile it works when accessed through http://\n\nExample urls:\nhttp://anytomcat:8080/examples/servlet/SessionServlet    works\nhttps://anytomcat:8443/examples/servlet/SessionServlet   fails\n\nwith https it creates a new session for each request.", "attachment_id": null, "id": 648, "creator": "sgala@hisitech.com", "time": "2001-02-12T04:01:55Z", "bug_id": 578, "creation_time": "2001-02-12T04:01:55Z", "is_private": false}, {"count": 1, "tags": [], "text": "The problem is caused because the java.net.URL constructor does not know \nanything about HTTPS protocol by default.  The JSSE 1.0.2 reference \nimplementation contains an implementation of an HTTPS URLStreamHandler.  To \nmake this handler available the handler's package must be added to the list of \npackages which are searched by the Java URL class.  The is configured via the \njava.protocol.handler.pkgs system property.  To make this package available to \nTomcat you can add \n-Djava.protocol.handler.pkgs=com.sun.net.ssl.internal.www.protocol\nto the TOMCAT_OPTS environment variable (if your using tomcat.bat or tomcat.sh) \nor edit wrapper.properties if your using the NT service.\n\nI'm going to leave the bug open because later Tomcat versions might be able to \nadd the ability to configure this system property via server.xml.  It won't \nhappen in 3.2.2, but maybe 3.3 or 4.0 could look into this.", "attachment_id": null, "id": 1382, "creator": "marc.saegesser@apropos.com", "time": "2001-03-19T14:04:37Z", "bug_id": 578, "creation_time": "2001-03-19T14:04:37Z", "is_private": false}, {"count": 2, "tags": [], "creator": "sgala@hisitech.com", "is_private": false, "id": 1426, "creation_time": "2001-03-20T05:42:44Z", "time": "2001-03-20T05:42:44Z", "bug_id": 578, "text": "Thanks for your effort. I have checked the workaround and it works, only if you\napply the following patch (as current code only accepts http/80 as default\nports, while https/443 should be also accepted. Without the patch it works on\nnon-default ports, but still not when used through mod_jk or in 443.\n\nRegards,\n    Santiago Gala\n\n\nIndex: src/share/org/apache/tomcat/facade/HttpServletResponseFacade.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat/src/share/org/apache/tomcat/facade/Attic/HttpServletResponseFacade.java,v\nretrieving revision 1.6.2.3\ndiff -u -r1.6.2.3 HttpServletResponseFacade.java\n--- src/share/org/apache/tomcat/facade/HttpServletResponseFacade.java  \n2001/03/06 17:38:13     1.6.2.3\n+++ src/share/org/apache/tomcat/facade/HttpServletResponseFacade.java  \n2001/03/20 13:29:41\n@@ -353,10 +353,14 @@\n            return (false);\n        if (!request.getServerName().equalsIgnoreCase(url.getHost()))\n            return (false);\n-        // Set the URL port to HTTP default if not available before comparing\n+        // Set the URL port to protocol default if not available before comparing\n         int urlPort = url.getPort();\n         if (urlPort == -1) {\n-            urlPort = 80;\n+            if(\"http\".equalsIgnoreCase(url.getProtocol())) {\n+                urlPort = 80;\n+            } else if (\"https\".equalsIgnoreCase(url.getProtocol())) {\n+                urlPort = 443;\n+            }\n         }\n        if (request.getServerPort() != urlPort)\n            return (false);\n\n", "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 578, "is_private": false, "id": 1458, "time": "2001-03-20T12:35:29Z", "creator": "marc.saegesser@apropos.com", "creation_time": "2001-03-20T12:35:29Z", "tags": [], "text": "*** Bug 269 has been marked as a duplicate of this bug. ***"}, {"count": 4, "tags": [], "text": "I commited the change to HttpServletResponseFacade.isEncodable() to set the \ndefault port for both secure and insecure requests.  Note that the commited \ncode is slightly different then the patch included here.  \n\nThe fix has been committed to 3.2.2, but has not 3.3.", "attachment_id": null, "id": 1872, "creator": "marc.saegesser@apropos.com", "time": "2001-04-16T09:08:14Z", "bug_id": 578, "creation_time": "2001-04-16T09:08:14Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 578, "attachment_id": null, "is_private": false, "id": 6614, "time": "2001-10-12T06:25:22Z", "creator": "Larry.Isaacs@sas.com", "creation_time": "2001-10-12T06:25:22Z", "text": "Reopen to change resolution"}, {"count": 6, "tags": [], "bug_id": 578, "attachment_id": null, "is_private": false, "id": 6615, "time": "2001-10-12T06:26:18Z", "creator": "Larry.Isaacs@sas.com", "creation_time": "2001-10-12T06:26:18Z", "text": "This fix as been applied to Tomcat 3.3"}]
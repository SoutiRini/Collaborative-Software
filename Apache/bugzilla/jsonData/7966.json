[{"count": 0, "tags": [], "bug_id": 7966, "attachment_id": null, "id": 13251, "time": "2002-04-11T15:08:18Z", "creator": "apache-bugzilla@kolbu.com", "creation_time": "2002-04-11T15:08:18Z", "is_private": false, "text": "In some cases, the Content-Length used remains the length of the file on disk, even though the \ncontent of the file is changed by SSIs before transfer to client. This happens only when the file in \nquestion is used as a DirectoryIndex, i.e. http://www.nanvaent.org:81/. If explicitly gotten, i.e. \nhttp://www.nanvaent.org:81/oktest.shtml, it transfers fine (presumably because the server does not \ninclude a Content-Length: header in that case). \n \nThe weird part is that _sometimes_ it actually works... \n \nExample: \n \nIn httpd.conf: \nDirectoryIndex oktest.shtml \nAddType text/html .shtml \nAddOutputFilter INCLUDES .shtml \n \n \n \nFile /cgi-bin/oktest.cgi \n--- cut here --- \n#!/bin/sh \necho Content-Type: text/html \necho \necho TeSt \n--- cut here --- \n \nFile /oktest.shtml   (Note, 54 bytes long) \n--- cut here --- \n<html> \n<!--#exec cgi=\"/cgi-bin/oktest.cgi\"--> \n</html> \n--- cut here --- \n \nSome tests with wget, the first one explicitly asking for the file: \n \nstrider tmp # wget -O - -S http://www.nanvaent.org:81/oktest.shtml \n--16:57:45--  http://www.nanvaent.org:81/oktest.shtml \n           => `-' \nResolving www.nanvaent.org... done. \nConnecting to www.nanvaent.org[194.70.3.222]:81... connected. \nHTTP request sent, awaiting response... \n 1 HTTP/1.1 200 OK \n 2 Date: Thu, 11 Apr 2002 14:57:45 GMT \n 3 Server: Apache/2.0.35 (Unix) PHP/4.3.0-dev mod_ssl/2.0.35 OpenSSL/0.9.6a \n 4 Accept-Ranges: bytes \n 5 Connection: close \n 6 Content-Type: text/html; charset=ISO-8859-1 \n \n    [<=>                                  ] 0             --.--K/s             <html> \nTeSt \n \n</html> \n    [ <=>                                 ] 21            20.51K/s \n \n16:57:45 (20.51 KB/s) - `-' saved [21] \n \n \nSecond test, just asking for the directory: \nstrider tmp # wget -O - -S http://www.nanvaent.org:81/ \n--16:59:42--  http://www.nanvaent.org:81/ \n           => `-' \nResolving www.nanvaent.org... done. \nConnecting to www.nanvaent.org[194.70.3.222]:81... connected. \nHTTP request sent, awaiting response... \n 1 HTTP/1.1 200 OK \n 2 Date: Thu, 11 Apr 2002 14:59:42 GMT \n 3 Server: Apache/2.0.35 (Unix) PHP/4.3.0-dev mod_ssl/2.0.35 OpenSSL/0.9.6a \n 4 Last-Modified: Thu, 11 Apr 2002 14:40:25 GMT \n 5 ETag: \"364ce-36-65f60840\" \n 6 Accept-Ranges: bytes \n 7 Content-Length: 54 \n 8 Keep-Alive: timeout=15, max=200 \n 9 Connection: Keep-Alive \n10 Content-Type: text/html; charset=ISO-8859-1 \n \n 0% [                                     ] 0             --.--K/s    ETA --:--<html> \nTeSt \n \n</html> \n38% [=============>                       ] 21            20.51K/s    ETA 00:00 \n \n16:59:57 (20.51 KB/s) - Connection closed at byte 21. Retrying. \n \netc etc \n \nNote the Content-Length header."}, {"attachment_id": null, "tags": [], "bug_id": 7966, "text": "I'm experiencing problems with proxies that is probably related to this bug. The\nproxy cache is cutting the reply short if / is requested, but I get the full\nreply if /index.shtml is used.", "count": 1, "id": 13265, "time": "2002-04-11T16:42:01Z", "creator": "david.waring@rd.bbc.co.uk", "creation_time": "2002-04-11T16:42:01Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 7966, "attachment_id": null, "text": "The same bug is under Windows 2000.", "id": 13296, "time": "2002-04-12T00:31:20Z", "creator": "energysoftware@web.de", "creation_time": "2002-04-12T00:31:20Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jerenkrantz@apache.org", "is_private": false, "text": "This is seen on a bunch of different OSes, so change it to be All platforms and\nAll OSes.\n\nAn email has been sent to dev@httpd.apache.org asking for people to look at\nthis. There were lots of changes right before 2.0.35 regarding this code, so I\nthink something may have snuck in.\n\nIf the filters were ordered right, the C-L should be correct, so this isn't\nobvious as to where the problem is and I'll let the people who worked on it\npre-2.0.35 look at this since they were the last ones in the code.", "id": 13304, "time": "2002-04-12T01:54:54Z", "bug_id": 7966, "creation_time": "2002-04-12T01:54:54Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "stoddard@apache.org", "attachment_id": null, "id": 13791, "time": "2002-04-16T19:51:41Z", "bug_id": 7966, "creation_time": "2002-04-16T19:51:41Z", "is_private": false, "text": "I cannot recreate this problem on Windows (haven't tried elsewhere).  Can \nsomeone send me an httpd.conf (as simple as possible) that I can use to \nrecreate?"}, {"count": 5, "tags": [], "bug_id": 7966, "text": " I can recreate this on 35/solaris 2.6 FWIW content-length and etags shouldn't be shown on a SSI page. mod_include ~line 3367    apr_table_unset(f->r->headers_out, \"Content-Length\");      /* Always unset the ETag/Last-Modified fields - see RFC2616 - 13.3.4.      * We don't know if we are going to be including a file or executing      * a program which may change the Last-Modified header or make the      * content completely dynamic.  Therefore, we can't support these      * headers.      * Exception: XBitHack full means we *should* set the Last-Modified field.      */     apr_table_unset(f->r->headers_out, \"ETag\");      /* Assure the platform supports Group protections */     if ((*conf->xbithack == xbithack_full)         && (r->finfo.valid & APR_FINFO_GPROT)         && (r->finfo.protection & APR_GEXECUTE)) {         ap_update_mtime(r, r->finfo.mtime);         ap_set_last_modified(r);     }     else {         apr_table_unset(f->r->headers_out, \"Last-Modified\");     }  I'm thinking AutoIndex is the culprit ", "id": 13820, "time": "2002-04-17T03:35:17Z", "creator": "ianh@apache.org", "creation_time": "2002-04-17T03:35:17Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "sorry about that Konqueror ate my line feeds.\nI just cut & pasted some some mod-include code from ~3767 showing it unsetting\nthe Etag & Content-length fields", "attachment_id": null, "id": 13821, "creator": "ianh@apache.org", "time": "2002-04-17T03:40:58Z", "bug_id": 7966, "creation_time": "2002-04-17T03:40:58Z", "is_private": false}, {"count": 7, "tags": [], "creator": "javier@guegue.com", "attachment_id": null, "id": 14035, "time": "2002-04-19T01:28:28Z", "bug_id": 7966, "creation_time": "2002-04-19T01:28:28Z", "is_private": false, "text": "I have exactly the same problem. I am using linux redhat.\nWe use \"exec cgi\" a lot and have this problem (incomplete \ncontent is returned as a result), right now we are trying \nto work-around it specifying \"index.html\" at the end\nof our requests."}, {"count": 8, "tags": [], "bug_id": 7966, "attachment_id": null, "text": "This problem has been resolved in modules/http/http_request.c revision 1.141.\n(Gnarly to reproduce!)\n\nThis should be included in the forthcoming 2.0.36 or you can try out the latest\nCVS snapshots.\n\nThanks for using Apache!", "id": 14937, "time": "2002-04-28T06:47:31Z", "creator": "jerenkrantz@apache.org", "creation_time": "2002-04-28T06:47:31Z", "is_private": false}, {"count": 9, "tags": [], "text": "*** Bug 8141 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 15170, "creator": "jerenkrantz@apache.org", "time": "2002-04-30T18:21:20Z", "bug_id": 7966, "creation_time": "2002-04-30T18:21:20Z", "is_private": false}]
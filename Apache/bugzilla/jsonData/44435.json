[{"count": 0, "tags": [], "bug_id": 44435, "text": "In a servlet request handler, I have the following code:\n\nresponse.setContentType(\"text/json\");\nresponse.setHeader(\"Cache-Control\", \"no-cache\");\nPrintWriter pw = response.getWriter();\nSystem.out.println(\"Response: \" + response.getClass().getName());\nSystem.out.println(\"Encoding: \" + response.getCharacterEncoding());\nSystem.out.println(\"PrintWriter: \" + pw.getClass().getName());\npw.write(\"\u00e9\");\npw.flush();\n\nThe stdout log shows:\nResponse:\norg.acegisecurity.context.HttpSessionContextIntegrationFilter$OnRedirectUpdateSessionResponseWrapper\nEncoding: ISO-8859-1\nPrintWriter: org.apache.catalina.connector.CoyoteWriter\n\nYet the actual response was \"?\" instead of \"\u00e9\", even though this character is\npart of the later character set (ISO-8859-1)!\n\nThe following scenarios all send back the expected result (\"\u00e9\"):\n * The content type set to \"text/json; charset=ISO-8859-1\" (weird!)\n * The content type set to \"text/json; charset=UTF-8\"\n * The exact same code run in Jetty", "id": 113806, "time": "2008-02-15T16:18:52Z", "creator": "corey@exploringsolutions.com", "creation_time": "2008-02-15T16:18:52Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44435, "is_private": false, "text": "Oops.. should have proofed a little better.  That second-last paragraph should\nread LATIN character set.  Sorry ;)", "id": 113807, "time": "2008-02-15T16:21:58Z", "creator": "corey@exploringsolutions.com", "creation_time": "2008-02-15T16:21:58Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 44435, "text": "What happens if you set the startup option:\n-Dorg.apache.catalina.STRICT_SERVLET_COMPLIANCE=true\n", "id": 113864, "time": "2008-02-18T14:59:33Z", "creator": "markt@apache.org", "creation_time": "2008-02-18T14:59:33Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 44435, "text": "(In reply to comment #2)\n> What happens if you set the startup option:\n> -Dorg.apache.catalina.STRICT_SERVLET_COMPLIANCE=true\n> \n\nHow would I set this flag in the native windows version?", "id": 113889, "time": "2008-02-19T07:20:41Z", "creator": "corey@exploringsolutions.com", "creation_time": "2008-02-19T07:20:41Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 44435, "is_private": false, "text": "If you mean the .exe distro, use the configure Tomcat shortcut and add the\noption to the \"Java Options\" setting on the \"Java\" tab.", "id": 113933, "time": "2008-02-20T14:29:40Z", "creator": "markt@apache.org", "creation_time": "2008-02-20T14:29:40Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 44435, "attachment_id": null, "is_private": false, "id": 113988, "time": "2008-02-21T15:01:09Z", "creator": "markt@apache.org", "creation_time": "2008-02-21T15:01:09Z", "text": "Ignore my comment about strict compliance. This works for me on a clean\ninstallation. Note I see the following on stdout:\nResponse: org.apache.catalina.connector.ResponseFacade\nEncoding: ISO-8859-1\nPrintWriter: org.apache.catalina.connector.CoyoteWriter\n\nLooks like\norg.acegisecurity.context.HttpSessionContextIntegrationFilter$OnRedirectUpdateSessionResponseWrapper\nis causing problems."}]
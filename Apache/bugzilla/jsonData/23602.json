[{"count": 0, "tags": [], "bug_id": 23602, "attachment_id": null, "text": "Using Ant 1.5.4 i can still create zip files that are incompatible with \nWinzip.  The difference between this and previous releases is that the problem \nnow seems to only be on *large* directories.\n\nWhen i zip a directory that has ~20k+ files in it, Winzip seems unable to read \nthe zip file created by the zip task.  If i zip the same directory using Ant \n1.5.1 Winzip works fine.  The error given by Winzip is:\n\n\"error missing {very large number} bytes in Zip file\"\n\nPlease do not mark this bug as a duplicate of 18196, i am running Ant 1.5.4 \nwhich has the fix to that bug, and it is still broken.\n\nI am running Winzip 8.1 SR1.", "id": 45066, "time": "2003-10-03T21:44:53Z", "creator": "tsorgie@yahoo.com", "creation_time": "2003-10-03T21:44:53Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 23602, "attachment_id": null, "text": "Could you post an example of such a broken archive?  I'd like to analyze it on the\nbyte-level of the archive itself.", "id": 45149, "time": "2003-10-06T13:24:48Z", "creator": "bodewig@apache.org", "creation_time": "2003-10-06T13:24:48Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 23602, "attachment_id": null, "text": "\nI'm working on trying to upload a bad zip, but the smallest example i could \ncreate was 60+mb, so i'm having no success getting the upload to work \nsuccessfully.  I'll keep trying via web browser upload, but if you've got any \nother ideas for getting this file, let me know.", "id": 45167, "time": "2003-10-06T17:45:02Z", "creator": "tsorgie@yahoo.com", "creation_time": "2003-10-06T17:45:02Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 23602, "attachment_id": null, "text": "ok, i officially throw in the towel on trying to upload my 60mb zip to this\nsite.  i just came back to a browser window i left uploading for 4 hours, and\nonce again, no progress made.  IE at least times out, Pheonix just hung.\n\nSo, if you'd still like to get this file, then i can provide you with a url from\nwhich you can download it.  \n\nHowever, before we do that, i recommend that you just try zipping up a very\nlarge directory with Ant 1.5.4 and trying opening it with Winzip (the example i\nwas going to send you was a zipped Eclipse source directory).\n\nIf you are having trouble re-creating the problem, just let me know, and i will\nprovide you with a download url via email.", "id": 45180, "time": "2003-10-06T23:18:05Z", "creator": "tsorgie@yahoo.com", "creation_time": "2003-10-06T23:18:05Z", "is_private": false}, {"count": 4, "tags": [], "creator": "bodewig@apache.org", "text": "I don't see anything special if I zip up exclipse's source dir, but then again\nI don't use Windows and don't have access to WinZIP.\n\nWhich directory of the eclipse source tree is givin you trouble - and which source\ntree should I use 8-)\n", "id": 45295, "time": "2003-10-09T14:40:23Z", "bug_id": 23602, "creation_time": "2003-10-09T14:40:23Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 23602, "attachment_id": null, "is_private": false, "id": 45330, "time": "2003-10-10T04:49:06Z", "creator": "tsorgie@yahoo.com", "creation_time": "2003-10-10T04:49:06Z", "text": "\nI used the eclipse directory as an example of the problem on my machine, just \nbecause it happens to be a directory with a large number of files in it.  The \nsource directory i am using has all their plugins in it, and amounts to about \n14,000+ individual files.  This number of files in the directory seems \nsufficient to create the problem.  \n\nI have also recently tested creating a very large zip that contained only a \nfew files.  That worked fine in Winzip which further confirms the connection \nbetween the number of files in the archive and this problem.\n\nWinzip seems to be failing while trying to read some header value in the \narchive that i suppose the the Ant Unzip task is not checking.  \n\nPerhaps there is a checksum, or total bytes value that is provided in the \narchive header which the Ant Zip task mis-writes.  \n\nPerhaps you are using an int variable for a value which can exceed the max of \nan int?\n"}, {"count": 6, "tags": [], "creator": "bodewig@apache.org", "text": "Directories always have the same size (0) and CRC checksum no matter how many files\nthey contain, an overflow is pretty unlikely.\n\nI've created an archive with 20000 empty files in a directory and uploaded it\nto <http://cvs.apache.org/~bodewig/test.zip>.\n\nAnt itself can extract it without problems as can InfoZip's unzip.  Does WinZIP\nhave any problems with it?", "id": 45370, "time": "2003-10-10T14:29:19Z", "bug_id": 23602, "creation_time": "2003-10-10T14:29:19Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 23602, "attachment_id": null, "id": 45373, "time": "2003-10-10T14:52:33Z", "creator": "ddevienne@lgc.com", "creation_time": "2003-10-10T14:52:33Z", "is_private": false, "text": "I can open and unzip your test ZIP just fine Stefan, with WinZip 1.0 SR1 \n(1285). It's quite slow to extract (but not to open), and then of course to \nremove the folder using IE (which must be using quadratic algos to become so \nslow when dealing with large number of files!!!). --DD"}, {"count": 8, "tags": [], "bug_id": 23602, "attachment_id": null, "text": "\nStefan i can also open your zip with my version of Winzip.\n\nI also did a little more testing; first i found out that i was mistaken about \nthe working version of Ant that i have, it is 1.4.1 (not 1.5.1 as i had \nindicated earlier), i apoligize for that.\n\nNext i tried to zip the sample files that you sent from your test, using my \nversion of Ant1.5.4, and it didn't work for me.  In fact, it is surprising to \nsee how different your archive is from mine built with Ant1.5.4 with the \nIBMJVM1.3.1:\n\nhttp://bleu.illegalcheese.com/test/ANT154_ziptest.zip\n\nI also built the same files using Ant1.4.1 on the same platform:\n\nhttp://bleu.illegalcheese.com/test/ANT141_ziptest.zip\n\nBetween these two files the you can mostly see the differences made by the \nchanges to the org.apache.tools.zip package between Ant1.4.1 & Ant1.5.4\n\nComparing the source of the Ant1.4.1 and Ant1.5.4 org.apache.tools.zip source \npackage shows pretty minor differences.  I changed Ant1.5.4 to revert out the \nchanges made since 1.4.1, and unfortuantely found that it still did not work.  \n\nHowever i think i may have narrowed it down.  Using my modified \n(org.apache.tools.zip package changed to work like 1.4.1) i was able to create \nanother zip:\n\nhttp://bleu.illegalcheese.com/test/ANT154ZipPackageLike141_ziptest.zip\n\nIf you compare the differences between this zip and the one made by 1.4.1, it \ncomes down to a very small amount of change in the last few bytes of the file.\n\nhope this helps.\n", "id": 45391, "time": "2003-10-10T18:29:11Z", "creator": "tsorgie@yahoo.com", "creation_time": "2003-10-10T18:29:11Z", "is_private": false}, {"count": 9, "tags": [], "text": "To try to get more info about this problem, i contacted the Winzip support \ngroup, and gave them access to the same sample files provided in my last post.\n\nTheir response seems to shine a little light on the issue:\n\nUsing a Hex editor, it appears to me these two Zip files contain the\nsame exact data set.  I do notice one difference between the two Zip\nfiles.  The reported value in the \"Size of the Central Directory\" field\nwithin the \"End of Central Directory (PK0506)\" differs between the two\nZip files. The Zip file called ANT141_ziptest.zip contains a value of\n\"6090 0F00\", where as, the Zip file created with Apache Ant contains a\nvalue of \"9FBC B1FF\".\n\nI ran a quick test where I modified the value in the \"Size of the\nCentral Directory\" field for the Apache Ant created Zip file to mirror\nthe value found in ANT141_ziptest.zip. After the modification, I was\nable to open the modified Apache Ant created Zip file with WinZip\nwithout encountering any error messages.\n\nFor some reason, the Apache Ant program is placing an incorrect value \nin the\n\"Size of the Central Directory\" field within the \"End of Central \nDirectory\n(PK0506)\".\n\nUnlike other Zip utilities, WinZip begins reading a Zip file from the\nlast record (End of Central Directory) to the first record (Local File\nheader). Where as, other Zip utilities operate in a reverse fashion\n(first to last).  This might explain why you were able to open the\nApache Ant created Zip file with some other Zip utilities, but not with\nWinZip.\n\n", "is_private": false, "bug_id": 23602, "id": 46416, "time": "2003-10-29T00:46:06Z", "creator": "tsorgie@yahoo.com", "creation_time": "2003-10-29T00:46:06Z", "attachment_id": null}, {"count": 10, "tags": [], "creator": "bodewig@apache.org", "text": "This certainly sounds as if I should be able to track down the problem 8-)\n\n", "id": 46442, "time": "2003-10-29T14:53:17Z", "bug_id": 23602, "creation_time": "2003-10-29T14:53:17Z", "is_private": false, "attachment_id": null}, {"count": 11, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 46740, "time": "2003-11-04T10:42:02Z", "bug_id": 23602, "creation_time": "2003-11-04T10:42:02Z", "tags": [], "text": "I'm jumping back and forth here.  No matter what I try, the length of the central\ndirectory is correct for me when I use Ant 1.5.4 (or 1.6beta or CVS HEAD).\n\nCould you please try to turn of your JIT to see whether there is any difference?\nWe had some bug reports that came down JIT problems within IBM's Java\nimplementation.\n\nIf it works with an disabled JIT, maybe we can get around the problem by\nreshuffling some code."}, {"count": 12, "tags": [], "bug_id": 23602, "attachment_id": null, "text": "One more note, your ANT154_ziptest.zip isn't considered valid by InfoZip's\nunzip either, so this is not WinZIP specific.\n\nYour version of Ant simply doesn't create valid ZIP archives and we should try\nto change that.  8-)", "id": 46742, "time": "2003-11-04T10:54:49Z", "creator": "bodewig@apache.org", "creation_time": "2003-11-04T10:54:49Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 23602, "attachment_id": null, "is_private": false, "id": 48150, "time": "2003-11-26T12:06:26Z", "creator": "bodewig@apache.org", "creation_time": "2003-11-26T12:06:26Z", "text": "Any success with disabling the JIT or switching to a different VM?"}, {"count": 14, "attachment_id": null, "creator": "tsorgie@yahoo.com", "is_private": false, "id": 48369, "time": "2003-12-02T03:04:59Z", "bug_id": 23602, "creation_time": "2003-12-02T03:04:59Z", "tags": [], "text": "\nSorry for disappearing on this for so long - got headlong into a big hairy \nsoftware release.\n\nSo i'm left really confused on this.  Moving to a SUN 1.4 JRE makes it work \nfine.  Which makes me really not understand why there is a difference between \nAnt 1.4.1 and Ant 1.5.4 with my original IBM 1.3 JRE.\n\nIf it were just a problem in the JRE, then i would expect that regardless of \nthe version of Ant that i run - i would get the same problem.  But that is not \nthe case, 1.4.1 works, 1.5.4 does not.\n\nDid you have any luck looking into what code is responsible for the few bytes \nthat were different between the working and non-working zips i uploaded?\n\n...very confused."}, {"count": 15, "tags": [], "bug_id": 23602, "attachment_id": null, "text": "So I am going to close this bug, as it is not Ant's fault.\n\nNo, I can't exactly tell you what triggers the problems inside the JIT (or IBM's\nVM, if it is not the JIT) - some kind of bad optimization by the JIT, I'd guess.\n\nThe \"strange\" bytes you see is a calculated size, this is really a very simple\ncalculation (a subtraction of two longs) that seems to get wrong results on\nyour VM.  There is no potential overflow AFAICS either.", "id": 48376, "time": "2003-12-02T11:39:13Z", "creator": "bodewig@apache.org", "creation_time": "2003-12-02T11:39:13Z", "is_private": false}]
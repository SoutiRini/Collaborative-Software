[{"count": 0, "tags": [], "bug_id": 27534, "attachment_id": null, "id": 53707, "time": "2004-03-09T09:12:58Z", "creator": "stefan.proels@gmx.de", "creation_time": "2004-03-09T09:12:58Z", "is_private": false, "text": "When a connection to Apache/mod_jk2 is closed before a response exceeding a\ncertain size has been read completely, the request is processed twice. The bug\nis present in JK2 only (2.0.2 distribution)-- JK1 works fine. With JK2, however,\na browser breaking a connection before the response has been read completely may\ncause a servlet to be invoked twice. This may lead to severe problems when, for\ninstance, the servlet writes something to a database twice. The problem can be\nreproduced with IE when clicking a second link before the preceeding request has\nfinished, but this requires the responses to exceed of a certain size and a\ncorrect timing of the second click. The attached test program simulated this\nsituation and allows the bug to be reproduced quite reliably. Install the JSP in\nsome web application, adjust TestClient.java to use the approbiate port and URL\nand start it. TestClient simply invokes the JSP again and again, passing an id\nwhich is incremented on every request to it. The JSP reads this id and prints it\nto System.out, i.e., catalina.out. As the id is incremented with every call no\nduplicate ids should be written by the JSP. This works fine as long as the JSPs\nresponses are read completely by the client. TestClient, however, closes every\nthird connection prematurely and this causes the JSP with JK2 to output\nduplicate ids. I.e., the JSP is invoked twice when the connection is closed\nprematurely. You can easily modify TestClient to break every n-th connection and\nwatch the JSP to be invoked twice every n-th request. You can verify that the\nTestClient did not resubmit the request using the Apache logs. In most cases the\nsecond invocation of the servlet/JSP occurs immediately after the first.\nHowever, this is not always the case. Randomly the second invocation will occur\nafter the next request has already been process successfully."}, {"count": 1, "tags": [], "text": "Created attachment 10721\nClient requesting JSP, simulating a browser breaking connections.", "is_private": false, "bug_id": 27534, "id": 53708, "time": "2004-03-09T09:14:33Z", "creator": "stefan.proels@gmx.de", "creation_time": "2004-03-09T09:14:33Z", "attachment_id": 10721}, {"count": 2, "tags": [], "creator": "stefan.proels@gmx.de", "attachment_id": 10722, "text": "Created attachment 10722\nJSP requested by TestClient", "id": 53709, "time": "2004-03-09T09:15:20Z", "bug_id": 27534, "creation_time": "2004-03-09T09:15:20Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 27534, "text": "I'd just like to add that the bug is still present in JK 2.0.4", "id": 56433, "time": "2004-04-26T19:50:05Z", "creator": "stefan.proels@gmx.de", "creation_time": "2004-04-26T19:50:05Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "mpikounis@hotmail.com", "attachment_id": null, "text": "I get the same behaviour by making calls directly to tomcat's listenning port \n(not through apache). In addition I get the servlet's output rendered twice by \nmy browser.", "id": 56460, "time": "2004-04-27T08:27:56Z", "bug_id": 27534, "creation_time": "2004-04-27T08:27:56Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 27534, "attachment_id": null, "id": 58471, "time": "2004-06-01T16:49:46Z", "creator": "yoavs@computer.org", "creation_time": "2004-06-01T16:49:46Z", "is_private": false, "text": "Thank you for reporting the issue and attaching a test client and test JSP.  If \nyou could suggest a patch (as a .diff file to the relevant JK2 source code \nfile), that'd be awesome ;)"}, {"count": 6, "tags": [], "bug_id": 27534, "attachment_id": null, "id": 59421, "time": "2004-06-17T14:47:55Z", "creator": "yoavs@computer.org", "creation_time": "2004-06-17T14:47:55Z", "is_private": false, "text": "The only way this will get fixed is if you submit a patch.  I'm also not clear \non why this is critical, so I'm downgrading its priority."}, {"count": 7, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "id": 67553, "time": "2004-11-29T19:50:12Z", "bug_id": 27534, "creation_time": "2004-11-29T19:50:12Z", "is_private": false, "text": "As of November 15, 2004, JK2 is no longer supported. All bugs related to JK2 \nwill be marked as WONTFIX. In its place, some of its features have been \nbackported to jk1. Most of those features will be seen in 1.2.7, which is \nslated for release on November 30th, 2004.\n\nAnother alternative is the ajp addition to mod_proxy which will be part of \napache 2.\n\nFor more information on the Tomat connectors docs at\nhttp://jakarta.apache.org/tomcat/connectors-doc/\n"}]
[{"count": 0, "tags": [], "bug_id": 10061, "attachment_id": null, "id": 18185, "time": "2002-06-20T14:17:40Z", "creator": "red@tripany.com", "creation_time": "2002-06-20T14:17:40Z", "is_private": false, "text": "Hi,\nI've installed Apache 2.0.39 on Debian 2.2 and 2.4, which went fine. Then \ninstalling php 4.2.1, the configure goes fine,\n\n./configure --prefix=/opt/php-4.2.1 --enable-force-cgi-redirect --enable-ftp --\nenable-magic-quotes --enable-bcmath --enable-calendar --enable-dbase --enable-\ndbx --enable-ftp --enable-gd-native-ttf --enable-mbstring --enable-track-vars --\nenable-ucd-snmp-hack --enable-sockets --enable-sysvsem --enable-sysvshm --\nenable-yp --enable-shared=PKGS --enable-debug --enable-memory-limit --with-\nzlib --with-gd --with-jpeg-dir=/usr/lib --with-tiff-dir=/usr/lib --with-png-\ndir=/usr/lib --with-mysql --with-snmp --with-apxs2=/opt/httpd-2.0.39/bin/apxs\n\nIt finds apache2 support, and suggests using apache2filter (which I think it \nshould be doing)\n\n but the make gives an error:\n\ngcc -I. -I/usr/local/src/php/php-4.2.1/sapi/apache2filter -\nI/usr/local/src/php/php-4.2.1/main -I/usr/local/src/php/php-4.2.1 -I/opt/httpd-\n2.0.39/include -I/usr/local/src/php/php-4.2.1/Zend -I/usr/local/include -\nI/usr/local/src/php/php-4.2.1/ext/mysql/libmysql -I/usr/include/ucd-snmp -\nI/usr/local/src/php/php-4.2.1/ext/xml/expat -D_REENTRANT -\nI/usr/local/src/php/php-4.2.1/TSRM -DTHREAD=1 -g -O2 -pthread -Wall -DZTS -c \nphp_functions.c  -fPIC -DPIC -o php_functions.lo\nphp_functions.c:93: parse error\nmake[3]: *** [php_functions.lo] Error 1\nmake[3]: Leaving directory `/usr/local/src/php/php-4.2.1/sapi/apache2filter'\nmake[2]: *** [all-recursive] Error 1\nmake[2]: Leaving directory `/usr/local/src/php/php-4.2.1/sapi/apache2filter'\nmake[1]: *** [all-recursive] Error 1\nmake[1]: Leaving directory `/usr/local/src/php/php-4.2.1/sapi'\nmake: *** [all-recursive] Error 1\n\nNow if I delete lines 92, 93 and 94 from sapi/apache2filter/php_functions.c \nwhich are:\n\n#if !MODULE_MAGIC_AT_LEAST(20020506,0)\n                ADD_STRING(boundary);\n#endif\n\nand then continue the make, it all seems to go fine. Make install copies \neverything to the right directory and doing a <? phpinfo() ?> shows that \neverything should be functioning neatly.\n\nNow the problem!\n\nWhen writing cookies to a client, sometimes the cookie will not be written and \nsometimes it will be - this behaviour is consistent in terms of site a will \nnever write the cookies, but site b will always write the cookie! (see code \nbelow)\n\nNever works\nsetcookie(\"netuser\", $row[\"werknemer_ID\"], time()+3600, \"/\");\nsetcookie[\"netlanguage\", $row[\"row_lang\"], time()+3600,\"/\");\nsetcookie[\"netlastlogin\", $row[\"last_login\"], time()+3600,\"/\");\n$werknemer_ID=$HTTP_COOKIE_VARS[\"netuser\"];\n\nAlways works\nsetcookie(\"user\", $userID, time()+(3600*3), \"/\")\n$userID=$HTTP_COOKIE_VARS[\"soluser\"];\n\nThe only thing we've managed to figure out is that in the first example, we \nwrite to the cookie 3 times (using similar statements) and in the second \nexample we only create the cookie once. Every time we write to the cookie \nagain, it overwrites (deletes) the old cookies  and replaces it with the last \ncookie. So what you end up with, is the netlastlogin cookie, and netuser and \nnetlanguage don't exist on the client harddrive. This used to work under \nphp4.2.0!\n\nUnder apache 2.0.36 and php 4.2.0 compiled with the same settings, I never \nexperienced this behaviour and I have no idea what's causing it! Any help is \nmuch appreciated!\n\nWell after extensive testing, I have to conclude it's probably not a php \n(alone) problem.\nI have tried:\nPHP ver.     Apache ver.    --enable-so    works?   error\n---------------------------------------------------------\n4.2.1            2.0.39             yes       no     yes\n2.1              36                 yes       yes    no\n2.0              39                 yes       no     yes\n2.0              36                 no        no     yes\n2.0              36                 yes       yes    no\n4.0.3pl1         1.3.9              ?         yes    ?\n\n(4.0.3pl1 is the standard debian package)\nThe rest of the 2.1 installations (with apache 39) don't work and give errors, \nso there's some problem with the apxs interaction between php and httpd 2.0.39. \nAs php2.1.0 works with httpd 2.0.36 I'm now assuming there was a change in the \napxs of apache in the security fix version which renders the multiple cookies \nunwriteable. I'll send this off to apache as well.\nCheers\nRobin"}, {"count": 1, "tags": [], "bug_id": 10061, "attachment_id": null, "id": 18191, "time": "2002-06-20T14:50:33Z", "creator": "jwoolley@apache.org", "creation_time": "2002-06-20T14:50:33Z", "is_private": false, "text": "These are all both known issues and issues with PHP, not Apache.  Please refer \nto the PHP bug database at bugs.php.net for explanations of each.\n\nThanks for using Apache!"}, {"count": 2, "tags": [], "bug_id": 10061, "attachment_id": null, "id": 18192, "time": "2002-06-20T15:01:04Z", "creator": "red@tripany.com", "creation_time": "2002-06-20T15:01:04Z", "is_private": false, "text": "Then why does php (4.2.0 and 4.2.1) work with the 2.0.36 apxs and not the \n2.0.39 apxs?\nI started this in the PHP bug database and found it under the known issues, but \nthis was fixed in the latest cvs release of 4.2.0 - which also doesn't work \nwith 2.0.39... SO it looks like apache, not php..."}, {"count": 3, "tags": [], "bug_id": 10061, "attachment_id": null, "text": "No, it's PHP.  Trust me.  :)  I already fixed the bug in PHP's HEAD, but it's \nnot fixed in any yet-released version of PHP.  The PHP developers are aware of \nthe problem (which is different than the one about 4.2.0 that you found in \nbugs.php.net).  Thanks again..", "id": 18193, "time": "2002-06-20T15:21:29Z", "creator": "jwoolley@apache.org", "creation_time": "2002-06-20T15:21:29Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 25899, "is_private": false, "text": "There is a bug in Jasper compiler that incorrectly assigns ISO-8859-1 encoding \nfor included file when including files using <%@ include file=\"...\"> directive \nand the included file contains <%@ page > directive.\n\nFor example:\n\npage1.jsp:\n<%@ page contentType=\"text/html; charset=ISO-8859-2\" %>\n\nTest \u0142\u0107\u017c\u0106\u0141\u0143\n<br><br>\n\n<%@ include file=\"page2.jsp\"%> \n\npage2.jsp:\n<%@ page import=\"java.util.*\" %>\n\nTest \u0142\u0107\u017c\u0106\u0141\u0143\n<br><br>\n\n\nJasper correctly recognizes encoding of file page1.jsp as ISO-8859-2. Since \npage2.jsp does not have its encoding set and it is included from page1.jsp, it \nshould also have ISO-8859-2 encoding. Jasper incorrectly treats this file as \nhaving ISO-8859-1 encoding. \nThe problem disappears when <%@ page import=\"java.util.*\" %> directive is \nremoved from page2.jsp.\n\nPatch for this bug follows:\nIndex: ParserController.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\njasper/jasper2/src/share/org/apache/jasper/compiler/ParserController.java,v\nretrieving revision 1.4.2.1\ndiff -c -r1.4.2.1 ParserController.java\n*** ParserController.java\t18 Jul 2002 18:04:24 -0000\t1.4.2.1\n--- ParserController.java\t5 Jan 2004 12:52:09 -0000\n***************\n*** 260,270 ****\n  \t\t\t    int loc = contentType.indexOf(\"charset=\");\n  \t\t\t    if (loc != -1) {\n  \t\t\t\tnewEncoding = contentType.substring(loc+8);\n- \t\t\t\treturn;\n  \t\t\t    }\n  \t\t\t}\n- \t\t\tif (newEncoding == null)\n- \t\t\t    newEncoding = \"ISO-8859-1\";\n  \t\t    } else {\n  \t\t\treturn;\n  \t\t    }\n--- 260,270 ----\n  \t\t\t    int loc = contentType.indexOf(\"charset=\");\n  \t\t\t    if (loc != -1) {\n  \t\t\t\tnewEncoding = contentType.substring(loc+8);\n  \t\t\t    }\n+ \t\t\t    if (newEncoding == null)\n+ \t\t\t        newEncoding = \"ISO-8859-1\";\n+ \t\t\t    return;\n  \t\t\t}\n  \t\t    } else {\n  \t\t\treturn;\n  \t\t    }", "id": 50060, "time": "2004-01-05T12:55:47Z", "creator": "tomcat@kivus.no-ip.org", "creation_time": "2004-01-05T12:55:47Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 25899, "is_private": false, "id": 67158, "time": "2004-11-18T17:56:50Z", "creator": "sk@msc.gr", "creation_time": "2004-11-18T17:56:50Z", "tags": [], "text": "Could we have some update on this bug? \nI can confirm this for tomcat 4.1.31 as well\n\nAs a workaround, just put the import page directive into a new file and include\nthis file from the original location.\n\nI'll add \"pageEncoding\" to the summary to make this more visible."}, {"count": 2, "attachment_id": null, "bug_id": 25899, "text": "This has been fixed in CVS for 4.1.x.\n\nPlease note that the suggested patch is bad as it does not take account of JSP \n1.2 errata (rev a) of 21 March 2002 which clarifies a number of issues \nregarding page encoding. An alternative patch has been applied.", "id": 67522, "time": "2004-11-28T23:01:14Z", "creator": "markt@apache.org", "creation_time": "2004-11-28T23:01:14Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 25899, "is_private": false, "id": 67525, "creation_time": "2004-11-28T23:16:59Z", "time": "2004-11-28T23:16:59Z", "creator": "markt@apache.org", "text": "*** Bug 29386 has been marked as a duplicate of this bug. ***", "attachment_id": null}]
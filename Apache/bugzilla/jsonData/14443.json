[{"count": 0, "tags": [], "bug_id": 14443, "attachment_id": null, "text": "I am running Apache 1.3.27 with PHP 4.2.3 as a DSO.  OS is FreeBSD 4.6-RELEASE.\n\nkerafyrm:[~] /usr/local/sbin/httpd -l\nCompiled-in modules:\n  http_core.c\n  mod_so.c\nsuexec: disabled; invalid wrapper /usr/local/sbin/suexec\n\nI am running some PHP scripts, which do nothing exceptionnal, serve dynamic \ncontent out of a database, using persistant MySQL and PgSQL connections.  I am \nnot sure whether this is relevant to the problem.\n\nVery randomly, and quite rarely, the following thing happens.\n\n- From the user's point of view:  User clicks on a link, a blank screen comes \nup in IE, very quickly after the click (obviously quicker than it would take to \nmake the HTTP request, fetch any data, etc).  User reloads the page, and most \nof the time the page is served correctly after that.\n\n- From my point of view:  I have pulled most of my hair out looking for the \nsource of the problem.  \n\n  o httpd processes do not crash when it happens (i.e. PID numbers are the same \nas before the click).\n\n  o I have disabled the PHP accelerator from IonCube I have been using to cache \nPHP bytecode, thinking that it might cause the error.  The error still happened \nafterwards.\n\n  o I have disabled the Keepalive option for this virtual host, and this took \naway the problem.  It used to happen about once per hour of development work, \nnow it never happens.  I don't really care about KeepAlive, but find it strange \nfor this incident to happen.\n\n  o I have caught the error in a tcpdump ! :-)  Here is the output:\n\nHere we see the data being transferred from the server to the client.  A page \nis fetched properly.\n\n14:19:27.584271 server.http > client.1111: . 50446:51906(1460) ack 3672 win \n58400 (DF) (ttl 64, id 13211, len 1500)\n14:19:27.584322 server.http > client.1111: . 51906:53366(1460) ack 3672 win \n58400 (DF) (ttl 64, id 13212, len 1500)\n14:19:27.584353 server.http > client.1111: P 53366:53443(77) ack 3672 win 58400 \n(DF) (ttl 64, id 13213, len 117)\n14:19:27.588440 client.1111 > server.http: . [tcp sum ok] 3672:3672(0) ack \n51906 win 17520 (DF) (ttl 128, id 4715, len 40)\n14:19:27.588541 client.1111 > server.http: . [tcp sum ok] 3672:3672(0) ack \n53443 win 17520 (DF) (ttl 128, id 4716, len 40)\n14:19:27.589136 server.http > client.1111: P [tcp sum ok] 53443:53444(1) ack \n3672 win 58400 (DF) (ttl 64, id 13216, len 41)\n14:19:27.767144 client.1111 > server.http: . [tcp sum ok] 3672:3672(0) ack \n53444 win 17519 (DF) (ttl 128, id 4717, len 40)\n\nEnd of transfer, httpd keeps the socket alive.\n\n\nA few seconds later, httpd decides it's time to close this socket.\n\n14:19:37.490342 server.http > client.1112: F [tcp sum ok] 4963:4963(0) ack 419 \nwin 58400 (DF) (ttl 64, id 13268, len 40)\n14:19:37.490658 client.1112 > server.http: . [tcp sum ok] 419:419(0) ack 4964 \nwin 17520 (DF) (ttl 128, id 4718, len 40)\n14:19:37.588810 client.1112 > server.http: R [tcp sum ok] 1951078694:1951078694\n(0) win 0 (DF) (ttl 128, id 4719, len 40)\n14:19:44.559592 server.http > client.1111: F [tcp sum ok] 53444:53444(0) ack \n3672 win 58400 (DF) (ttl 64, id 13474, len 40)\n14:19:44.559906 client.1111 > server.http: . [tcp sum ok] 3672:3672(0) ack \n53445 win 17519 (DF) (ttl 128, id 4720, len 40)\n\n\nA few more seconds later, the client requests a page from the server again, but \nonly to be greeted\nwith a RST ;-(\n\n\n14:20:03.556040 client.1111 > server.http: P 3672:4075(403) ack 53445 win 17519 \n(DF) (ttl 128, id 4722, len 443)\n14:20:03.556210 server.http > client.1111: R [tcp sum ok] 2298357875:2298357875\n(0) win 0 (ttl 64, id 13832, len 40)\n\n\nEnd of tcpdump snippet.\n\nThe client is a Win 2k workstation running IE6.\n\nIs this a bug in Win2k TCP stack?  In IE?  In Apache?\n\nThe client and the server are both on separate networks, with a tunnel between \nthem.  The client is also ip-masqueraded by a Linux 2.4 box.", "id": 26062, "time": "2002-11-11T13:17:27Z", "creator": "akg@recv.org", "creation_time": "2002-11-11T13:17:27Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 14443, "is_private": false, "text": "I believe this is an issue I am also facing.  I am running Linux (RedHat) and \nusing Perl compared to the orginal report of problems with PHP.  When a page \nwould be requested, most of the time it loads fine.  However, once you refresh \nthe page (testing using IE6 browser) it would fail to download.\n\nSome of the page will download and render in the browser, but it would then \nstop, and IE will request the page.  I fixed the problem by disabling KeepAlive \nfor IE6 only.\n\nBrowserMatch \"MSIE 6\\.0;\" nokeepalive\n\nI managed to grab an strace of the httpd child dealing with my request.\n\n22383 read(7, 0xbffef860, 8192)         = -1 EAGAIN (Resource temporarily \nunavailable)\n22383 select(8, [7], NULL, NULL, NULL <unfinished ...>\n10231 write(1, \" width=\\\"209\\\" align=\\\"center\\\" bgco\"..., 4096) = 4096\n22383 <... select resumed> )            = 1 (in [7])\n22383 read(7, \" width=\\\"209\\\" align=\\\"center\\\" bgco\"..., 8192) = 4096\n22383 writev(3, [{\"1000\\r\\n\", 6}, {\" width=\\\"209\\\" align=\\\"center\\\" bgco\"..., \n4096}, {\"\\r\\n\", 2}], 3) = 4104\n22383 read(7, 0xbffef860, 8192)         = -1 EAGAIN (Resource temporarily \nunavailable)\n22383 select(8, [7], NULL, NULL, NULL <unfinished ...>\n10231 write(1, \" Offers</a></strong></font></td>\"..., 4096) = 4096\n22383 <... select resumed> )            = 1 (in [7])\n22383 read(7, \" Offers</a></strong></font></td>\"..., 8192) = 4096\n22383 writev(3, [{\"1000\\r\\n\", 6}, {\" Offers</a></strong></font></td>\"..., \n4096}, {\"\\r\\n\", 2}], 3 <unfinished ...>\n10231 rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 fcntl64(3, F_SETFL, O_RDWR|O_NONBLOCK) = 0\n10231 read(3, 0x8203ab8, 8192)          = -1 EAGAIN (Resource temporarily \nunavailable)\n10231 fcntl64(3, F_SETFL, O_RDWR)       = 0\n10231 write(3, \"\\1\\0\\0\\0\\1\", 5)         = 5\n10231 shutdown(3, 2 /* send and receive */) = 0\n10231 close(3)                          = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 rt_sigprocmask(SIG_BLOCK, NULL, [], 8) = 0\n10231 write(1, \"ca,sans-serif\\\" size=\\\"2\\\" color=\\\"#\"..., 1190) = 1190\n10231 munmap(0x40018000, 4096)          = 0\n10231 _exit(0)                          = ?\n22383 <... writev resumed> )            = 2230\n22383 --- SIGCHLD (Child exited) ---\n22383 writev(3, [{\"#DFF3FF\\\"><font face=\\\"Arial,Helve\"..., 1872}, {\"\\r\\n\", 2}], \n2) = 1874\n22383 read(7, \"ca,sans-serif\\\" size=\\\"2\\\" color=\\\"#\"..., 8192) = 1190\n22383 read(7, \"\", 8192)                 = 0\n22383 close(7)                          = 0\n22383 read(9, \"\", 4096)                 = 0\n22383 close(9)          ", "id": 33248, "time": "2003-03-16T02:02:48Z", "creator": "jon18_uk2002@yahoo.co.uk", "creation_time": "2003-03-16T02:02:48Z", "attachment_id": null}]
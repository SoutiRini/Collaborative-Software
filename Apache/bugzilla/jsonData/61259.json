[{"count": 0, "tags": [], "bug_id": 61259, "attachment_id": null, "id": 199620, "time": "2017-07-07T06:58:11Z", "creator": "liu_xp2003@sina.com", "creation_time": "2017-07-07T06:58:11Z", "is_private": false, "text": "When I want to test JDBC with transaction and disable auto commit in JDBC Connection Configuration panel, Each JDBC sampler will be rollback.\nThis behavior is different with JMeter 2.13+excalibur package and the multiple JDBC sampler transaction couldn't be tested on latest JMeter version.\n\nJDBC Test Sampler\n1. select * from testplan where CreatorId = 10001;\n2. select count(1) from testplan;\n3. commit\n\nJMeter 2.13+excalibur\nWireshark.info from JDBC client side:\nStatement [truncated]: /* mysql-connector-java-5.1.40 ( Revision: 402933ef52cad9aa82624e80acbea46e3a701ce6 ) */SELECT  @@session.auto_increment_increment AS auto_increment_increment, @@character_set_client AS character_set_client, @@charac\nStatement: SET NAMES utf8\nStatement: SET character_set_results = NULL\nStatement: SET autocommit=0\nStatement: select * from testplan where CreatorId = 10001;\nStatement: select count(1) from testplan;\nStatement: commit\nStatement: rollback\nCommand: Quit (1)\n\n\nJMeter 3.2+commons-dbcp2\nWireshark.info from JDBC client side:\nStatement [truncated]: /* mysql-connector-java-5.1.40 ( Revision: 402933ef52cad9aa82624e80acbea46e3a701ce6 ) */SELECT  @@session.auto_increment_increment AS auto_increment_increment, @@character_set_client AS character_set_client, @@charac\nStatement: SET NAMES utf8\nStatement: SET character_set_results = NULL\nStatement: SET autocommit=0\nStatement: select * from testplan where CreatorId = 10001;\nStatement: rollback\nStatement: SET autocommit=1\nStatement: SET autocommit=0\nStatement: select count(1) from testplan;\nStatement: rollback\nStatement: SET autocommit=1\nStatement: SET autocommit=0\nStatement: commit\nStatement: rollback\nStatement: SET autocommit=1\nCommand: Quit (1)"}, {"count": 1, "tags": [], "text": "Author: pmouawad\nDate: Sun Jul 16 14:48:48 2017\nNew Revision: 1802065\n\nURL: http://svn.apache.org/viewvc?rev=1802065&view=rev\nLog:\nBug 61259 - JDBC Request : since JMeter 3.0, when JDBC auto-commit is false, a rollback statement happens each time a Request is executed\nBugzilla Id: 61259\n\nModified:\n    jmeter/trunk/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/DataSourceElement.java\n    jmeter/trunk/xdocs/changes.xml", "is_private": false, "bug_id": 61259, "id": 199830, "time": "2017-07-16T14:49:13Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-07-16T14:49:13Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "liu_xp2003@sina.com", "attachment_id": null, "is_private": false, "id": 199913, "time": "2017-07-21T07:27:59Z", "bug_id": 61259, "creation_time": "2017-07-21T07:27:59Z", "text": "To make different JDBC Sampler committed in one transaction, we also need the following code after fixed line position.\ndataSource.setEnableAutoCommitOnReturn(false);"}, {"count": 3, "tags": [], "bug_id": 61259, "attachment_id": null, "id": 199915, "time": "2017-07-21T07:41:25Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-07-21T07:41:25Z", "is_private": false, "text": "(In reply to Liu XP from comment #2)\n> To make different JDBC Sampler committed in one transaction, we also need\n> the following code after fixed line position.\n> dataSource.setEnableAutoCommitOnReturn(false);\n\nI don't think this is not needed , did you try setting Auto Commit to false in JDBC Connection Configuration ?\n\nThanks"}, {"count": 4, "tags": [], "creator": "liu_xp2003@sina.com", "attachment_id": null, "id": 199922, "time": "2017-07-21T09:22:50Z", "bug_id": 61259, "creation_time": "2017-07-21T09:22:50Z", "is_private": false, "text": "Yes. I have verified it and it need to be fixed with the additional setting.\ndataSource.setEnableAutoCommitOnReturn(false);\n\nYou can try to test with following three JDBC Sampler with current fix soluction.\n\n1. Prepare some records into AAAA table and truncate table BBBB.\n2. Do following SQL with 3 JDBC Sampler in one thread.\ninsert into BBBB (select *  from AAAA)\nselect Name from BBBB\nQuery Type with Rollback\n\n3. And then check the BBBB table at last.\nIf transaction worked normally, the BBBB table should be empty.But,you will find the table BBBB is not empty."}, {"count": 5, "tags": [], "bug_id": 61259, "attachment_id": null, "id": 199947, "time": "2017-07-22T12:56:27Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-07-22T12:56:27Z", "is_private": false, "text": "Author: pmouawad\nDate: Sat Jul 22 12:55:58 2017\nNew Revision: 1802688\n\nURL: http://svn.apache.org/viewvc?rev=1802688&view=rev\nLog:\nBug 61259 - JDBC Request : since JMeter 3.0, when JDBC auto-commit is false, a rollback statement happens each time a Request is executed\nBugzilla Id: 61259\n\nModified:\n    jmeter/trunk/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/DataSourceElement.java\n    jmeter/trunk/xdocs/changes.xml"}]
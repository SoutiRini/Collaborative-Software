[{"count": 0, "tags": [], "creator": "peter@wizardslair.net", "text": "Hi,\n\nI am receiving the above error when I try to execute a JSP page which attempts\nto access a MySQL database via a DataSource. The configuration is following the\nJNDI reference in the documentation. I have experienced this with both 5.0.25\nand 5.0.28.\n\nContext initContext = new InitialContext();\nContext envContext  = (Context)initContext.lookup(\"java:/comp/env\");\nDataSource ds = (DataSource)envContext.lookup(\"jdbc/test\");\n  Statement stmt = null;\n  ResultSet rs = null;\n  Connection conn = null;\n  try {\n    conn = ds.getConnection();  <-- error occurs here\n\nApplicationDispatcher[/sportsweb] Servlet.service() for servlet jsp threw exception\njava.lang.NoClassDefFoundError: org/apache/commons/collections/CursorableLinkedList\n        at org.apache.commons.pool.impl.GenericObjectPool.<init>(Unknown Source)\n        at org.apache.commons.pool.impl.GenericObjectPool.<init>(Unknown Source)\n        at\norg.apache.commons.dbcp.AbandonedObjectPool.<init>(AbandonedObjectPool.java:97)\n        at\norg.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:545)\n        at\norg.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:312)\n        at org.apache.jsp.dbtest_jsp._jspService(dbtest_jsp.java:58)\n\t\n# java -version\njava version \"1.4.2_03\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_03-b02)\nJava HotSpot(TM) Client VM (build 1.4.2_03-b02, mixed mode)\n\nTomcat 5 was installed by extracting the tar.gz version and modifying the conf\nfiles appropriately.\n\nI have searched through the mailing list archive but can't find anything\nregarding this. \n\nMy common/lib directory containg commons-collections-3.1.jar as distributed with\nTomcat 5.0.28 (20 Sep 04)\n\nAny help will be appreciated.\n\nThanks,\nPeter Johnson", "id": 63838, "time": "2004-09-20T00:00:08Z", "bug_id": 31304, "creation_time": "2004-09-20T00:00:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "First, using DBCP works for me out of the box with Tomcat 5.0.28.  So you must \nhave changed something in order to get this error.\n\nDid you modify the commons-pool, commons-collections, or commons-dbcp versions \nthat shipped with Tomcat?  Did you place additional versions of any of these \njars in $CATALINA_HOME/common/lib or in your webapp's WEB-INF/lib directory?\n\nThis is the kind of issue that's best discussed on tomcat-user first, rather \nthan opening a Tomcat bug report right away, as it's much more likely to be a \nconfiguration error on your part than an actual Tomcat bug.", "attachment_id": null, "id": 63891, "creator": "yoavs@computer.org", "time": "2004-09-20T16:46:16Z", "bug_id": 31304, "creation_time": "2004-09-20T16:46:16Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "yoavs@computer.org", "text": "Looking at the Jakarta Commons-Collections 3.1 JavaDoc makes it clear that \norg.apache.commons.collections.CursorableLinkedList exists (although it's \ndeprecated).", "id": 63892, "time": "2004-09-20T16:48:13Z", "bug_id": 31304, "creation_time": "2004-09-20T16:48:13Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 31304, "text": "Yoav,\n\nAll that was added was the mysql-connector JAR to common/lib and a session\ncounting listener to common/classes. Both WEB-INF/lib and WEB-INF/classes are empty.\n\n--- # jar tf common/lib/commons-collections-3.1.jar ---\n\norg/apache/commons/collections/CursorableLinkedList$Listable.class\norg/apache/commons/collections/CursorableLinkedList$ListIter.class\norg/apache/commons/collections/CursorableLinkedList$Cursor.class\norg/apache/commons/collections/CursorableLinkedList.class\n\nSo yes it exists in mine as well. To be expected really since I haven't modified\nanything.\n\n--- context config ---\n\n  <Resource auth=\"container\" name=\"jdbc/test\" type=\"javax.sql.DataSource\"/>\n  <ResourceParams name=\"jdbc/test\">\n    <parameter>\n      <name>url</name>\n      <value>jdbc:mysql://dev:3306/test?autoReconnect=true</value>\n    </parameter>\n    <parameter>\n      <name>validationQuery</name>\n      <value>select id, foo, bar from testdata</value>\n    </parameter>\n    <parameter>\n      <name>maxIdle</name>\n      <value>5</value>\n    </parameter>\n    <parameter>\n      <name>maxActive</name>\n      <value>100</value>\n    </parameter>\n    <parameter>\n      <name>driverClassName</name>\n      <value>com.mysql.jdbc.Driver</value>\n    </parameter>\n    <parameter>\n      <name>maxWait</name>\n      <value>10000</value>\n    </parameter>\n    <parameter>\n      <name>removeAbandoned</name>\n      <value>true</value>\n    </parameter>\n    <parameter>\n      <name>factory</name>\n      <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n    </parameter>\n    <parameter>\n      <name>username</name>\n      <value>test</value>\n    </parameter>\n    <parameter>\n      <name>logAbandoned</name>\n      <value>true</value>\n    </parameter>\n    <parameter>\n      <name>removeAbandonedTimeout</name>\n      <value>60</value>\n    </parameter>\n    <parameter>\n      <name>password</name>\n      <value>test</value>\n    </parameter>\n  </ResourceParams>\n\n--- WEB-INF/web.xml ---\n\n<resource-ref>\n  <description>\n    DB Connection Pool\n  </description>\n  <res-ref-name>\n    jdbc/test\n  </res-ref-name>\n  <res-type>\n    javax.sql.DataSource\n  </res-type>\n  <res-auth>\n    Container\n  </res-auth>\n</resource-ref>\n\n--- test JSP ---\n\n<%@ page import=\"java.sql.*,\n                 javax.naming.Context,\n                 javax.naming.InitialContext,\n                 javax.sql.DataSource\"%>\n<%\n  Context initContext = new InitialContext();\n  Context envContext  = (Context)initContext.lookup(\"java:/comp/env\");\n  DataSource ds = (DataSource)envContext.lookup(\"jdbc/test\");\n  Statement stmt = null;\n  ResultSet rs = null;\n  Connection conn = null;\n  if (ds != null) {\n  try {\n    conn = ds.getConnection();\n    stmt = conn.createStatement();\n    rs = stmt.executeQuery(\"select id, foo, bar from testdata\");\n    while (rs.next()) {\n       %>id: <%= rs.getInt(\"id\") %>, foo: <%= rs.getString(\"foo\") %>, bar: <%=\nrs.getInt(\"bar\") %><br/><%\n    }\n    rs.close();\n    rs = null;\n    stmt.close();\n    stmt = null;\n    conn.close();\n    conn = null;\n  } catch (SQLException e) { ; } finally {\n    if (rs != null) {\n      try { rs.close(); } catch (SQLException e) { ; }\n      rs = null;\n    }\n    if (stmt != null) {\n      try { stmt.close(); } catch (SQLException e) { ; }\n      stmt = null;\n    }\n    if (conn != null) {\n      try { conn.close(); } catch (SQLException e) { ; }\n      conn = null;\n    }\n  }\n  } else {\n      %> DataSource is null <%\n  }\n%>\n\nI also have a page that performs the same function but by going directly using\nthe same settings i.e. Class.forName ... etc ...", "count": 3, "id": 63940, "time": "2004-09-21T00:01:06Z", "creator": "peter@wizardslair.net", "creation_time": "2004-09-21T00:01:06Z", "is_private": false}, {"text": "Can you please attach a .war file to this issue with your test JSP, web.xml, \nand META-INF/context.xml file?  Obviously you can use dummy database URL, \nusername, and password, as I'll have to use local test values.  I'd like to try \nto reproduce it, although obviously if this was true out of the box we'd have \nheard about it on the mailing list.", "tags": [], "bug_id": 31304, "attachment_id": null, "count": 4, "id": 64010, "time": "2004-09-21T19:57:31Z", "creator": "yoavs@computer.org", "creation_time": "2004-09-21T19:57:31Z", "is_private": false}, {"attachment_id": 12875, "tags": [], "bug_id": 31304, "text": "Created attachment 12875\ntest webapp war file", "count": 5, "id": 64297, "time": "2004-09-28T09:31:19Z", "creator": "peter@wizardslair.net", "creation_time": "2004-09-28T09:31:19Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 31304, "attachment_id": null, "text": "Yoav,\n\nPlease accept my apologies for the delay in providing the war file. I don't\nnormally deploy using one so I hope it is what you were after.\n\nThanks again.", "id": 64298, "time": "2004-09-28T09:32:38Z", "creator": "peter@wizardslair.net", "creation_time": "2004-09-28T09:32:38Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 31304, "attachment_id": null, "text": "I took your WAR, and modified it for my environment.  The only changes were the \nJDBC driver class (I have Oracle locally, so oracle.jdbc.driver.OracleDriver), \nand of course database URL, username, and password.  Whether I deploy as a \npacked WAR, or as an expanded directory structure, both dbtest.jsp and \ndbtestdirect.jsp work for me.  (I had to create a dummy table testdata of \ncourse to match your query).  I get no errors at all, much less that \ncollections error you quote.\n\nThis was on a clean, new 5.0.28 installation, using Sun JDK 1.4.2 on Solaris \n8.  I repeated the same thing on Windows 2000, same results.  It all works.  So \nI'm closing this item as WORKSFORME.\n\nIf I were you, I'd try it with a clean installation, as there's no other \nexplanation for what you're seeing.\n", "id": 64753, "time": "2004-10-07T13:33:48Z", "creator": "yoavs@computer.org", "creation_time": "2004-10-07T13:33:48Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 31304, "attachment_id": null, "id": 65705, "time": "2004-10-26T10:26:05Z", "creator": "peter@wizardslair.net", "creation_time": "2004-10-26T10:26:05Z", "is_private": false, "text": "After numerous fresh installs on my laptop with no success I attempted an\ninstall on another machine. It worked. But for the life of me still can't see\nwhy it doesn't on my laptop ...\n\nThanks for your help Yoav, sorry for troubling you."}]
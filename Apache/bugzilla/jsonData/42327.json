[{"count": 0, "tags": [], "creator": "bugs@ausics.net", "text": "apache 2.2.4, linux.\nDBDriver and DBParams setup in global\n\nUse of mysql fails to auth users, creating a 500 error.\nSetup as directed in docs.\nUsed in virtualhosts\nconnects and logs in OK to mysql DB, but does nothing more, apache logs show\nNo DBD Authn configured!\n.......but there most certainly is...\n\nmysql log shows:\n070503 9:42:57       4 Connect     apache@IP.REMOVED on http_AuthDB\n070503 9:42:59       4 Quit\n\n\nMaybe related, docs reflect DBDriver/DBParams etc able to be placed in global\nand virtualhost block, I also tried in virt block, apache bails, saying not\nallowed here.", "id": 102815, "time": "2007-05-03T05:41:57Z", "bug_id": 42327, "creation_time": "2007-05-03T05:41:57Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 102817, "time": "2007-05-03T07:14:34Z", "bug_id": 42327, "creation_time": "2007-05-03T07:14:34Z", "is_private": false, "text": "Please use a user support forum for problems like this (and the week of apachecon might not be the ideal \ntiming - try again next week if necessary).\n\nThe error message is saying you didn't configure a SELECT statement valid for the scope you're trying to \nuse it in."}, {"count": 2, "attachment_id": null, "bug_id": 42327, "is_private": false, "id": 102832, "time": "2007-05-03T14:51:05Z", "creator": "bugs@ausics.net", "creation_time": "2007-05-03T14:51:05Z", "tags": [], "text": "(In reply to comment #1)\n> Please use a user support forum for problems like this (and the week of\napachecon might not be the ideal \n> timing - try again next week if necessary).\n> \n> The error message is saying you didn't configure a SELECT statement valid for\nthe scope you're trying to \n> use it in.\n\nFirstly I have posted in users mailing list, with no responses,w hich is why I\nopted to log it here.\n\nin the global I have\nDBDriver mysql\nDBDParams \"host=HOST.REMOVED dbname=http_AuthDB user=NOPE pass=NOTONURLIFE\"\nDBDPersist off\n\nSecondly. I do have a select statement, As I said, I set it up as per the apache\ndocs, out of the vhost block using the alias method and inside it like\n\n-start directory block inside a vhost block\n  AuthName \"Manage\"\n  AuthType Basic\n  AuthBasicProvider dbd\n  AuthDBDUserPWQuery  \"SELECT user_passwd FROM user_info WHERE user_name = %s\"\n  Require valid-user\n-end directory block inside vhost block\n\nIf this is wrong, the docs are incomplete or I keep reading the wrong docs, even\nvia google. Google did show this problem with many hits, even a comment from you\nNick, asking if this was still a problem with 2.2.4 and someone responded yes,\nbut nothing I found after days of googling, found any workarounds or corrections\nto the procedures, if I'm wrong I'll eat humble pie.\n\n"}, {"count": 3, "attachment_id": null, "bug_id": 42327, "is_private": false, "id": 102922, "time": "2007-05-07T18:51:36Z", "creator": "bugs@ausics.net", "creation_time": "2007-05-07T18:51:36Z", "tags": [], "text": "RE-opening as it clearly does not work as documented in 2.2.4\n\n"}, {"count": 4, "attachment_id": null, "bug_id": 42327, "is_private": false, "id": 103022, "time": "2007-05-09T20:31:59Z", "creator": "bugs@ausics.net", "creation_time": "2007-05-09T20:31:59Z", "tags": [], "text": "Closing, a couple of bugs were found in mod_dbd, a patch has been submitted by\nBojan to devel that fixes this problem. Hopefully they'll commit it ASAP.\n\n"}, {"count": 5, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 103028, "time": "2007-05-10T03:53:05Z", "bug_id": 42327, "creation_time": "2007-05-10T03:53:05Z", "is_private": false, "text": "It's not fixed until we get the patch in, and an open bug reference helps with\ngetting it reviewed (which is necessary: that's the rules for a stable branch,\nhowever trivial the fix).\n\nFor reference, here's Bojan's patch:\n\nIndex: modules/database/mod_dbd.c\n===================================================================\n--- modules/database/mod_dbd.c\t(revision 536728)\n+++ modules/database/mod_dbd.c\t(working copy)\n@@ -661,7 +661,7 @@\n     svr_cfg *svr;\n     server_rec *sp;\n     for (sp = s; sp; sp = sp->next) {\n-        const char *key = apr_psprintf(s->process->pool, \"%pp\", s);\n+        const char *key = apr_psprintf(s->process->pool, \"%pp\", sp);\n         svr = ap_get_module_config(sp->module_config, &dbd_module);\n         svr->prepared = apr_hash_get(dbd_prepared_defns, key,\n                                      APR_HASH_KEY_STRING);\n"}, {"count": 6, "tags": [], "bug_id": 42327, "attachment_id": 20161, "text": "Created attachment 20161\nBojan's patches, attached here for easy reference.\n\nThis supersedes my comment #5, made after I'd reviewed only the first (trivial\nbut crucial) patch.", "id": 103029, "time": "2007-05-10T04:26:13Z", "creator": "nick@webthing.com", "creation_time": "2007-05-10T04:26:13Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 42327, "attachment_id": null, "text": "The is a duplicate of PR #41302.  The mod_dbd.c code in trunk should\nsolve these issues; see r503931, which I'll propose for back-porting to\nthe 2.2.x branch shortly:\n\nhttp://svn.apache.org/viewvc?view=rev&revision=503931\n\nAlso the fourth section of this posting:\n\nhttp://marc.info/?l=apache-httpd-dev&m=116742014418304&w=2\n\n*** This bug has been marked as a duplicate of 41302 ***", "id": 103249, "time": "2007-05-15T18:37:35Z", "creator": "chrisd@apache.org", "creation_time": "2007-05-15T18:37:35Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 60724, "is_private": false, "id": 196924, "creation_time": "2017-02-10T23:36:42Z", "time": "2017-02-10T23:36:42Z", "creator": "gwoolsey@apache.org", "text": "Per the Excel documentation:\n\nhttps://support.office.com/en-us/article/SUBTOTAL-function-7b027003-f060-4ade-9040-e478765b9939\n\nIn the \"Remarks\" section, both the all rows and \"ignore hidden rows\" versions of the totals functions should ignore all rows hidden by an auto-filter.  POI isn't doing that yet.\n\nI see this empirically, with the additional behavior that if you manually hide a row that passes an auto-filter, it is also ignored by BOTH versions of the formula methods.\n\nI don't even know where to start looking to figure out if a row is hidden or not in the formula evaluation flow. It will require investigating whether there are TwoDEvals in the operands we can use or if the Ptg array has anything we can use to look back at the row properties for a cell value, or if this needs to be handled at a higher level somewhere.\n\nOne of the sheets in a new test workbook I'm building for conditional formatting has this case as well, discovered by accident.  Once I check that in, I'll point to it here as a test case that can be used to verify a fix.", "attachment_id": null}, {"count": 1, "tags": [], "text": "It appears there is no direct link in the persisted XML between a row marked hidden and a table AutoFilter.  This matches the observed Excel behavior, where manually hiding a row that passes filter still gets its value skipped by both versions of the function.\n\nThat actually makes the POI code simpler, as we don't have to evaluate filters, just know if a table has one applied or not when checking the hidden attribute of included rows.", "is_private": false, "bug_id": 60724, "id": 196971, "time": "2017-02-13T20:03:18Z", "creator": "gwoolsey@apache.org", "creation_time": "2017-02-13T20:03:18Z", "attachment_id": null}]
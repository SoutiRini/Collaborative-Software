[{"count": 0, "tags": [], "bug_id": 44448, "text": "Configuration:\n\napache httpd (2.2.6) -> mod_jk (1.2.25) -> tomcat (5.5.25)\n\nIf a request to tomcat results in a 304 (not modified) response, tomcat also\nsends a body > 0: \n\ncorrect:\nx.x.x.x - - [05/Feb/2008:11:06:17+0100] \"GET /download/userResources/logo\nHTTP/1.1\" 200 39897\n\nwrong (truncated body, should be 0):\nx.x.x.x - - [05/Feb/2008:11:06:27+0100] \"GET /download/userResources/logo\nHTTP/1.1\" 304 16368\n\nthis also results in an error in the mod_jk.log file:\n\n[Mon Feb 04 19:03:25.826 2008] [5826:1325496672] [info]\najp_process_callback::jk_ajp_common.c (1603): Writing to client aborted or\nclient network problems\n[Mon Feb 04 19:03:25.826 2008] [5826:1325496672] [info]\najp_service::jk_ajp_common.c (2186): (worker1) sending request to tomcat failed\n(unrecoverable), because of client write error (attempt=1)\n[Mon Feb 04 19:03:25.827 2008] [5826:1325496672] [info] service::jk_lb_worker.c\n(1188): unrecoverable error 200, request failed. Client failed in the middle of\nrequest, we can't recover to another instance.\n[Mon Feb 04 19:03:25.827 2008] [5826:1325496672] [info] jk_handler::mod_jk.c\n(2357): Aborting connection for worker=router\n[Mon Feb 04 19:03:25.877 2008] [5828:1325496672] [info]\najp_process_callback::jk_ajp_common.c (1603): Writing to client aborted or\nclient network problems\n[Mon Feb 04 19:03:25.877 2008] [5828:1325496672] [info]\najp_service::jk_ajp_common.c (2186): (worker1) sending request to tomcat failed\n(unrecoverable), because of client write error (attempt=1)\n[Mon Feb 04 19:03:25.878 2008] [5828:1325496672] [info] service::jk_lb_worker.c\n(1188): unrecoverable error 200, request failed. Client failed in the middle of\nrequest, we can't recover to another instance.\n[Mon Feb 04 19:03:25.878 2008] [5828:1325496672] [info] jk_handler::mod_jk.c\n(2357): Aborting connection for worker=router\n\nThis behavious has been encoutered for different version of mod_jk, tomcat and\nmod_proxy_ajp, and seems to be a problem of the AJP Connector as the same\nconfiguration with mod_proxy_http is working fine.\n\nThe same issue has been reported before, and was reported to be fixed\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=40317.", "id": 113859, "time": "2008-02-18T09:36:13Z", "creator": "tneidhart@know-center.at", "creation_time": "2008-02-18T09:36:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "tneidhart@know-center.at", "attachment_id": null, "text": "Additional Comments:\n\n * the wrong handling of 304 Responses results in corrupt images in the browser\nwindow if a user hits reload.\n\n * the HTTP connector has specific handling of certain response types:\n\n   Http11Processor.java:1516:\n\n        if ((statusCode == 204) || (statusCode == 205)\n            || (statusCode == 304)) {\n            // No entity body\n            outputBuffer.addActiveFilter\n                (outputFilters[Constants.VOID_FILTER]);\n            entityBody = false;\n            contentDelimitation = true;\n        }\n\n   whereas the AJP Connector does not.", "id": 113860, "time": "2008-02-18T09:45:45Z", "bug_id": 44448, "creation_time": "2008-02-18T09:45:45Z", "is_private": false}, {"count": 2, "tags": [], "creator": "william.barker@wilshire.com", "text": "\n\n*** This bug has been marked as a duplicate of 40317 ***", "id": 113865, "attachment_id": null, "bug_id": 44448, "creation_time": "2008-02-18T17:29:42Z", "time": "2008-02-18T17:29:42Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 44448, "text": "This was closed as a duplicate of bug #40317. \n\nHowever that bug was, IMO rightly, closed as invalid.\n\nSo the ball is again back in the tomcat yard.\n\nI have confirmed that both firefox and safari become totally confused due to this bug, see:\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=363109\n\nSo reopening, the original reporter was spot on.\n\nRegards, Robert.", "id": 114593, "time": "2008-03-13T09:41:39Z", "creator": "robert@manamind.com", "creation_time": "2008-03-13T09:41:39Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 44448, "text": "I have just checked this with:\nhttpd 2.2.4\nmod_proxy_ajp\nTomcat 5.5.HEAD\n\nI have stepped through the code and Tomcat correctly sets a content length of zero. Further, an examination of the headers received by the UA do not show any invalid content length.\n\nI don't see how this could be happening as to get the behaviour described here you would have to have replaced Tomcat's DefaultServlet.\n\nI am resolving this as worksforme for now but I am more than happy to look at this further if you can provide the steps to reproduce from a clean install of all components (mod_proxy_ajp preferred). You should be able to reproduce the error using tomcat.gif file in the ROOT webapp.", "id": 115431, "time": "2008-04-08T15:04:20Z", "creator": "markt@apache.org", "creation_time": "2008-04-08T15:04:20Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 44448, "text": "(In reply to comment #4)\n\nThe problem isn't with a response header stating the body size is greater than 0, the problem is with actually sending a response body when there shouldn't be one for a 304 request.\n\nAccording to the Mozilla bug details, this is only being seen when compression is enabled, and the body is actually a gzipped version of nothing - so this appears to rather be a bug in mod_gzip.", "id": 139525, "time": "2010-08-27T18:25:38Z", "creator": "vkleinschmidt@blackboard.com", "creation_time": "2010-08-27T18:25:38Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Since mod_gzip is not an ASF provided module, you'll need to take this up directly with the mod_gzip maintainers.", "id": 139528, "time": "2010-08-28T04:48:58Z", "bug_id": 44448, "creation_time": "2010-08-28T04:48:58Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 47549, "attachment_id": null, "is_private": false, "id": 128998, "time": "2009-07-20T06:45:45Z", "creator": "jagusztinl@freemail.hu", "creation_time": "2009-07-20T06:45:45Z", "text": "We have the following setting in mod_proxy:\n\n\n   BalancerMember http://server1:48080 route=sp_server1 connectiontimeout=3 timeout=120\n\n   BalancerMember http://server2:48080 route=sp_server2 connectiontimeout=3 timeout=120\n\nWe tried it, but the tcp connection timeout does not works, in case of network failure it waits much longer (few minutes) instead of 3 secs. We checked the mod_prixy code, and found that it should be corrected."}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "id": 129001, "creation_time": "2009-07-20T09:18:57Z", "time": "2009-07-20T09:18:57Z", "bug_id": 47549, "text": "If you already had a look at the code: Do you care to tell us were the changes would need to be done?", "attachment_id": null}, {"count": 2, "tags": [], "creator": "jagusztinl@freemail.hu", "is_private": false, "text": "We had the following config:\n<Proxy balancer://sp_cluster>\n   BalancerMember http://t1:48080 route=sp_server1 timeout=120\n   BalancerMember http://t2:48080 route=sp_server2 timeout=120\n   ProxySet stickysession=JSESSIONID\n</Proxy>\n\nBut we got:\n\nSyntax error on line 12 of /home/webapp/apache/conf/vh.spportal.sp_cluster.conf:\n\nBalancerMember Connectiontimeout has wrong format\nThe configuration is not proper, so the server spportal_server cannot start!\n\nWe found that the bug somewhere here:\n \nif (ap_timeout_parameter_parse(val, &timeout, \"s\") != APR_SUCCESS)\n            return \"Connectiontimeout has wrong format\";\n\nBut it is very complicated..\n\n\nBut from another forum a similar problem with release 2.2.11:\n\nSite index \u00b7 List index\nMessage view \t\u00ab Date \u00bb \u00b7 \u00ab Thread \u00bb\nTop \t\u00ab Date \u00bb \u00b7 \u00ab Thread \u00bb\nFrom \t\"Ian Lea\" <ian....@gmail.com>\nSubject \t[users@httpd] 2.2.11: BalancerMember Ping/Pong timeout has wrong format\nDate \tWed, 31 Dec 2008 12:20:01 GMT\n\nHi\n\n\nOn apache 2.2.10 a config file with these lines\n\n<Proxy balancer://xxx>\n     BalancerMember ajp://localhost:17100 route=yyy ping=10\n</Proxy>\n\nworks fine, but on 2.2.11 it fails to parse, showing error\n\nSyntax error on line 73 of /opt/apache-2.2.11/conf/test.conf:\nBalancerMember Ping/Pong timeout has wrong format\n\n\nI see that the changes file includes\n\n  mod_proxy: Add the possibility to set the worker parameters\n  connectiontimeout and ping in milliseconds. [Ruediger Pluem]\n\nIf I've followed the code path correctly (far from certain),\nserver/util.c says that the following units are understood\n\n* ms    : milliseconds\n* s     : seconds\n* mi[n] : minutes\n* h     : hours\n\nbut adding any of those makes no difference - they all still fail with\nthe parse error.\n\n\nAny suggestions?\nIan.\nian.lea@gmail.com\n\n\nAnd also refer to this:\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=46500", "id": 129417, "time": "2009-08-03T14:05:14Z", "bug_id": 47549, "creation_time": "2009-08-03T14:05:14Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 47549, "attachment_id": null, "id": 129418, "time": "2009-08-03T14:12:47Z", "creator": "jagusztinl@freemail.hu", "creation_time": "2009-08-03T14:12:47Z", "is_private": false, "text": "And found a possible solution on a forum:\n\n....\nFound the same issue here.\n\nHave debugged the problem with gdb. In function util.c:ap_timeout_parameter_parse\nthe first errno checking is true, so it returns an error to its caller.\n\nThe apr_strings.c:apr_strtoi64 function just above should clear the errno\nvariable at the beginning, I think.\n\nThe following patch against apr_strings.c works for me.\n\ndiff -uNr /httpd-2.2.11/srclib/apr/strings/apr_strings.c.orig \\\n/httpd-2.2.11/srclib/apr/strings/apr_strings.c\n--- /httpd-2.2.11/srclib/apr/strings/apr_strings.c.orig  2006-08-03\n+12:55:31.000000000 +0200\n+++ /httpd-2.2.11/srclib/apr/strings/apr_strings.c       2009-01-14\n+23:24:55.000000000 +0100\n@@ -244,6 +244,7 @@\n\n APR_DECLARE(apr_int64_t) apr_strtoi64(const char *nptr, char **endptr, int base)\n {\n+    errno = 0;\n #ifdef APR_INT64_STRFN\n     return APR_INT64_STRFN(nptr, endptr, base);\n #else\n\nRegards,\n\nJavi."}, {"count": 4, "tags": [], "bug_id": 47549, "attachment_id": null, "is_private": false, "id": 129419, "time": "2009-08-03T14:14:55Z", "creator": "rpluem@apache.org", "creation_time": "2009-08-03T14:14:55Z", "text": "(In reply to comment #2)\n\n> \n> On apache 2.2.10 a config file with these lines\n> \n> <Proxy balancer://xxx>\n>      BalancerMember ajp://localhost:17100 route=yyy ping=10\n> </Proxy>\n> \n> works fine, but on 2.2.11 it fails to parse, showing error\n> \n\nThis was a bug in apr. The version now bundled with 2.2.12 does not contain this problem. So please retest with 2.2.12."}, {"count": 5, "tags": [], "creator": "fgaillard@w3architect.com", "attachment_id": null, "id": 129487, "creation_time": "2009-08-05T09:16:09Z", "time": "2009-08-05T09:16:09Z", "bug_id": 47549, "text": "(In reply to comment #4)\n> (In reply to comment #2)\n> \n> > \n> > On apache 2.2.10 a config file with these lines\n> > \n> > <Proxy balancer://xxx>\n> >      BalancerMember ajp://localhost:17100 route=yyy ping=10\n> > </Proxy>\n> > \n> > works fine, but on 2.2.11 it fails to parse, showing error\n> > \n> \n> This was a bug in apr. The version now bundled with 2.2.12 does not contain\n> this problem. So please retest with 2.2.12.\n\nJust test the same configuration with version 2.2.12.\nThe apr_strings.c seems to have been patched, but i still get the same error :\n\nBalancerMember Ping/Pong timeout has wrong format\n\nRegards,\n\n--Fabrice Gaillard", "is_private": false}, {"count": 6, "tags": [], "bug_id": 47549, "attachment_id": null, "is_private": false, "id": 129496, "time": "2009-08-05T11:32:20Z", "creator": "rpluem@apache.org", "creation_time": "2009-08-05T11:32:20Z", "text": "(In reply to comment #5)\n\n> > This was a bug in apr. The version now bundled with 2.2.12 does not contain\n> > this problem. So please retest with 2.2.12.\n> \n> Just test the same configuration with version 2.2.12.\n> The apr_strings.c seems to have been patched, but i still get the same error :\n> \n> BalancerMember Ping/Pong timeout has wrong format\n> \n\nI cannot reproduce this issue with 2.2.12. Either you use an older apr version that is installed somewhere else on your system or you have any kind of crappy characters in your config (maybe invisible to your editor)."}, {"count": 7, "tags": [], "creator": "wsartori@gmail.com", "is_private": false, "text": "*** Bug 48893 has been marked as a duplicate of this bug. ***", "id": 135284, "time": "2010-03-11T19:58:13Z", "bug_id": 47549, "creation_time": "2010-03-11T19:58:13Z", "attachment_id": null}]
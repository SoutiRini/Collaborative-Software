[{"count": 0, "tags": [], "creator": "zb@bisp.com", "attachment_id": null, "text": "When I use standard taglibs in jsp to setResourceBundle I get an\nexception on JBOSS(it's good on jetspeed2). I found this is because\ngetRequestLocale in Util.java use  request.getHeaders(\"accept-language\")  to get\na values(Enumeration), and expected this values to be not null.\nBut servlet api said \"If the container does not allow access to header\ninformation, return null\". I guess this is the case in JBOSS. So I add a check\nfor values and return request.getLocales() when values is null, the problem\nresolved. The following is the patch:\n\n\n*** standard/src/org/apache/taglibs/standard/tag/common/core/Util.java\n2006-04-02 16:12:11.000000000 +0800\n--- Util.java.new\t2006-04-03 12:11:59.000000000 +0800\n***************\n*** 278,283 ****\n--- 278,286 ----\n       */\n      public static Enumeration getRequestLocales(HttpServletRequest request) {\n       \n          Enumeration values = request.getHeaders(\"accept-language\");\n+ \t\tif(values == null){\n+ \t\t\treturn request.getLocales();\n+ \t\t}\n          if (values.hasMoreElements()) {\n              // At least one \"accept-language\". Simply return\n              // the enumeration returned by request.getLocales().", "id": 87553, "time": "2006-04-04T03:33:14Z", "bug_id": 39195, "creation_time": "2006-04-04T03:33:14Z", "is_private": false}, {"attachment_id": 18023, "tags": [], "creator": "zb@bisp.com", "text": "Created attachment 18023\npatch to Util.java getRequestLocale", "count": 1, "id": 87554, "time": "2006-04-04T03:35:11Z", "bug_id": 39195, "creation_time": "2006-04-04T03:35:11Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "bayard@apache.org", "is_private": false, "count": 2, "id": 97378, "time": "2006-12-27T14:10:01Z", "bug_id": 39195, "creation_time": "2006-12-27T14:10:01Z", "text": "\nThe javadoc says:\n\n\"a String containing the value of the requested header, or null  if the request\ndoes not have a header of that name\"\n\nhttp://java.sun.com/products/servlet/2.2/javadoc/javax/servlet/http/HttpServletRequest.html#getHeader(java.lang.String)\n\nSo null protecting here seems fine. I'm not sure that the fix below makes sense\nthough - reading the source it looks more likely that an empty enumeration\nshould be returned and not request.getLocales()."}, {"attachment_id": null, "tags": [], "creator": "bayard@apache.org", "is_private": false, "count": 3, "id": 101064, "time": "2007-03-27T12:22:44Z", "bug_id": 39195, "creation_time": "2007-03-27T12:22:44Z", "text": "I'm fixing this by returning a new empty enumeration when there's a null\naccept-language header:\n\nIndex: src/org/apache/taglibs/standard/tag/common/core/Util.java\n===================================================================\n--- src/org/apache/taglibs/standard/tag/common/core/Util.java   (revision 523035)\n+++ src/org/apache/taglibs/standard/tag/common/core/Util.java   (working copy)\n@@ -278,6 +278,12 @@\n      */\n     public static Enumeration getRequestLocales(HttpServletRequest request) { \n      \n         Enumeration values = request.getHeaders(\"accept-language\");\n+        if (values == null) {\n+            // No header for \"accept-language\". Simply return\n+            // a new empty enumeration.\n+            // System.out.println(\"Null accept-language\");\n+            return new Vector().elements();\n+        } else\n         if (values.hasMoreElements()) {\n             // At least one \"accept-language\". Simply return\n             // the enumeration returned by request.getLocales(). \n\n\n\n\nsvn ci -m \"Fixing the issue raised in 39195. It's legal for a null request\nheader to come back.\n \" src/org/apache/taglibs/standard/tag/common/core/Util.java \nSending        src/org/apache/taglibs/standard/tag/common/core/Util.java\nTransmitting file data .\nCommitted revision 523043.\n\nsvn ci -m \"Adding missing import for Vector\"\nsrc/org/apache/taglibs/standard/tag/common/core/Ut\nil.java \nSending        src/org/apache/taglibs/standard/tag/common/core/Util.java\nTransmitting file data .\nCommitted revision 523045."}]
[{"count": 0, "tags": [], "creator": "rvprasad@cis.ksu.edu", "attachment_id": null, "id": 50381, "time": "2004-01-12T01:39:05Z", "bug_id": 26049, "creation_time": "2004-01-12T01:39:05Z", "is_private": false, "text": "Hi,\n\nJustIce indicates that the storing of a newly created object in a local before\ncalling it's constructor as an error.  However, this is incorrect as the local\nis not accessed along any control flow path before the constructor is called. \nThis is also safe in a multithreaded setting. Also, the same class file is well\ninterpreted by java interpreters from SUN, Blackdown, and IBM.  Moreover, there\nis no restriction on handling (not using) of uninitialized objects in the JVM spec.\n\nASM output of the correponding class file and JustIce' output are inlined.\n\npublic static main ([Ljava/lang/String;)V\n    NEW excpsync\n    ASTORE 1\n    ALOAD 1\n    INVOKESPECIAL excpsync <init> ()V\n    ALOAD 1\n    ASTORE 1\n    NEW java/lang/Thread\n    ASTORE 2\n    ALOAD 2\n    ALOAD 1\n    INVOKESPECIAL java/lang/Thread <init> (Ljava/lang/Runnable;)V\n    ALOAD 2\n    INVOKEVIRTUAL java/lang/Thread start ()V\n    NEW java/lang/Thread\n    ASTORE 2\n    NEW f\n    ASTORE 3\n    ALOAD 3\n    INVOKESPECIAL f <init> ()V\n    ALOAD 2\n    ALOAD 3\n    INVOKESPECIAL java/lang/Thread <init> (Ljava/lang/Runnable;)V\n    ALOAD 2\n    INVOKEVIRTUAL java/lang/Thread start ()V\n    LDC \"Hi\"\n    ASTORE 2\n    ALOAD 1\n    ALOAD 2\n    PUTFIELD excpsync o Ljava/lang/String;\n    ALOAD 2\n    PUTSTATIC excpsync t Ljava/lang/String;\n    RETURN\n    MAXSTACK = 2\n    MAXLOCALS = 4\n\nJustIce by Enver Haase, (C) 2001-2002.\n<http://bcel.sourceforge.net>\n<http://jakarta.apache.org/bcel>\n\nNow verifying: excpsync\n\nPass 1:\nVERIFIED_OK\nPassed verification.\n\nPass 2:\nVERIFIED_OK\nPassed verification.\n\nPass 3a, method number 0 ['public void <init>()']:\nVERIFIED_OK\nPassed verification.\n\nPass 3b, method number 0 ['public void <init>()']:\nVERIFIED_OK\nPassed verification.\n\nPass 3a, method number 1 ['public static void main(String[] arg0)']:\nVERIFIED_OK\nPassed verification.\n\nPass 3b, method number 1 ['public static void main(String[] arg0)']:\nVERIFIED_REJECTED\nConstraint violated in method 'public static void main(String[] arg0)':\nInstruction ASTORE constraint violated: Working on an uninitialized object\n'<UNINITIALIZED OBJECT OF TYPE 'excpsync'>'.\nInstructionHandle:    3: astore_1[76](1)\n\nExecution Frame:\nLocal Variables:\n0: java.lang.String[]\n1: <unknown object>\n2: <unknown object>\n3: <unknown object>\nOperandStack:\nSlots used: 1 MaxStack: 2.\n<UNINITIALIZED OBJECT OF TYPE 'excpsync'> (Size: 1)\nExecution flow:\n   0: new 12\t[InstructionContext]\n   3: astore_1\t[InstructionContext]\n\nPass 3a, method number 2 ['public void run()']:\nVERIFIED_OK\nPassed verification.\n\nPass 3b, method number 2 ['public void run()']:\nVERIFIED_OK\nPassed verification."}, {"count": 1, "tags": [], "bug_id": 26049, "is_private": false, "id": 50647, "creation_time": "2004-01-16T15:31:50Z", "time": "2004-01-16T15:31:50Z", "creator": "rvprasad@cis.ksu.edu", "text": "Created attachment 9978\nPatch to InstConstraintVisitor.java to relax certain \"assumed\" constraint checks", "attachment_id": 9978}, {"count": 2, "tags": [], "text": "I looked at InstConstraintVisitor.java and would suggest that the verifier =\nnot check if the reference is initialized when an\nobject is loaded/stored, but rather check for intialized-ness before using =\nit in operations such as method invocation or field\naccess expressions. Hence, the solution would be to allow uninitialized obj=\nects to exists in the heap if they are only\naccessible from locals in the method and to check for initialized-ness befo=\nre exposing them to the rest of the system by\nassigning them to fields, returning them from the method, or passing them a=\ns arguments into a method. The following patch\nenables this form of constraint checking.\n\nPlease do mail me any questions/comments/suggestions you may have about the=\n proposed approach.\n\n[Attachment 01/16/04 15:31 has the corresponding patch]\n", "is_private": false, "bug_id": 26049, "id": 50648, "time": "2004-01-16T15:32:44Z", "creator": "rvprasad@cis.ksu.edu", "creation_time": "2004-01-16T15:32:44Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "tcurdt@apache.org", "attachment_id": null, "is_private": false, "id": 86372, "time": "2006-03-02T04:24:14Z", "bug_id": 26049, "creation_time": "2006-03-02T04:24:14Z", "text": "applied please cross check"}]
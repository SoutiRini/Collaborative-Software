[{"count": 0, "attachment_id": null, "bug_id": 35928, "text": "I have come across some files generated by scientific instruments whose\nbig-block size is not 512, but rather 4096. The power-of-two (12) is properly\nstored in the header, but POIFS ignores that entirely, resorting to a built-in\nconstant. I'd post some files, but they average 260MB each.\n\nI can help develop/test this, but I'll probably need some guidance first.", "id": 77827, "time": "2005-07-29T15:10:33Z", "creator": "nutello@sweetness.com", "creation_time": "2005-07-29T15:10:33Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 35928, "is_private": false, "id": 77830, "attachment_id": null, "creator": "poi-support@buni.org", "creation_time": "2005-07-29T15:39:14Z", "time": "2005-07-29T15:39:14Z", "text": "Please write the dev list.  I'm unsure of this one because IIRC XLS files have a\ndefault block size of 4096 (for smaller files)...  It could be we said \"heck\nwith it\" if it liked the smaller one too."}, {"count": 2, "tags": [], "creator": "poi-support@buni.org", "text": "Marc confirmed this. . He needs a file though.  Any way to generate a smaller\nfile?  if not then if you have ssh (and scp in particular), email me and I can\ngive you a spot to upload it to. (please tar/bz2 or tar/gz it first :-) )", "id": 77831, "time": "2005-07-29T15:46:18Z", "bug_id": 35928, "creation_time": "2005-07-29T15:46:18Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Created attachment 18875\nPatch for current SVN tree; checks the first few bytes of a POIFS file to see if the big-block size is 512 or 4096.", "is_private": false, "bug_id": 35928, "id": 93658, "time": "2006-09-16T18:08:20Z", "creator": "linkert@wisc.edu", "creation_time": "2006-09-16T18:08:20Z", "attachment_id": 18875}, {"count": 4, "tags": [], "bug_id": 35928, "attachment_id": null, "text": "The patch doesn't look to be threadsafe to me\n\nIf we had two files open, one with a 512 blocksize, and another with a 4096\nblocksize, then I think it'd fail, as it's all using a single static int on\nPOIFSFileSystem\n\nI think before we could apply this, we would need a sample file with the\nalternate block size (so we can write a unit test for all this), and the patch\nwould need to be slightly re-worked to be threadsafe (i.e. not use a static for\nsomething that can vary between concurrantly open files).", "id": 112671, "time": "2008-01-09T01:40:17Z", "creator": "apache@gagravarr.org", "creation_time": "2008-01-09T01:40:17Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 35928, "text": "> I think before we could apply this, we would need a sample file with the alternate block size\n\nMaybe attached file could help: WordExtractor fails to decode it with:\njava.io.IOException: Unable to read entire block; 122 bytes read before EOF; expected 512 bytes", "id": 114569, "time": "2008-03-13T03:39:01Z", "creator": "batrakov@gmail.com", "creation_time": "2008-03-13T03:39:01Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "batrakov@gmail.com", "attachment_id": 21663, "id": 114571, "time": "2008-03-13T03:46:14Z", "bug_id": 35928, "creation_time": "2008-03-13T03:46:14Z", "is_private": false, "text": "Created attachment 21663\ndocfile with incorrect(?) block size"}, {"count": 7, "tags": [], "creator": "apache@gagravarr.org", "text": "Word files should always be 512 byte blocks, so I think attachment 21663 isn't quite appropriate for this bug - it's probably just a truncated file", "id": 114583, "time": "2008-03-13T06:23:18Z", "bug_id": 35928, "creation_time": "2008-03-13T06:23:18Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "but it's being opened OK in word 2003 :)", "attachment_id": null, "id": 114680, "creation_time": "2008-03-17T05:13:57Z", "time": "2008-03-17T05:13:57Z", "creator": "batrakov@gmail.com", "bug_id": 35928, "is_private": false}, {"count": 9, "tags": [], "bug_id": 35928, "text": "There has been partial, thread safe support for this in svn for a while now\n\nHowever, without a file with a 4096 block size, we can't test that this works properly\n\nIf you do have a file with 4096 blocks, please do re-open the bug and upload it, then we can write a unit test for it. Alas all the files we can find (word, powerpoint, excel, visio etc) are all 512 byte blocks.", "id": 127078, "time": "2009-05-17T11:54:49Z", "creator": "apache@gagravarr.org", "creation_time": "2009-05-17T11:54:49Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 35928, "attachment_id": null, "text": "This has now been properly solved, along with sample files for unit tests, see bug #49139", "id": 136605, "time": "2010-05-03T13:21:33Z", "creator": "apache@gagravarr.org", "creation_time": "2010-05-03T13:21:33Z", "is_private": false}]
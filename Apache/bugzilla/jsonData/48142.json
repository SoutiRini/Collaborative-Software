[{"count": 0, "tags": [], "creator": "v.shreeraghavan@gmail.com", "attachment_id": null, "id": 131745, "time": "2009-11-05T13:00:17Z", "bug_id": 48142, "creation_time": "2009-11-05T13:00:17Z", "is_private": false, "text": "Hi Frds,\n\nI am facing an issue with log4j.\n\nInitially we had java processes running in a physical server(Linux useclpcll068apa.nbcuni.ge.com 2.4.21-27.0.2.ELsmp #1 SMP Wed Jan 12 23:35:44 EST 2005 i686 i686 i386 GNU/Linux , Red Hat Enterprise Linux AS release 3 (Taroon Update 3)) with java version 1.4 for around two years and log file rotation was happening fine. \n\nNow recently we have moved the process to a VM (2.6.18-53.1.21.el5 #1 SMP Wed May 7 08:42:34 EDT 2008 x86_64 x86_64 x86_64 GNU/Linux , Red Hat Enterprise Linux Server release 5.1 (Tikanga)) with java version 1.5. But now currently when the file reaches the maximum size, then it is not able to rotate the log file. The issue is apvs.log is getting renamed as apvs.log.1 but I am getting the below errors and the new file apvs.log is not getting created. I could not get solution for this in web. When i reduced the size to 1 KB also, i am facing the same issue and it is not consistent and no patter also. Can someone pls help me on this.\n\nProperty file entry\n==================\n\n#Defining the Application Specific Loggers(APVS) and defining their File Appenders\nlog4j.logger.com.ge.nbc.program=debug,apvs\nlog4j.logger.com.ge.nbc.media=debug,apvs\nlog4j.appender.apvs=org.apache.log4j.RollingFileAppender\nlog4j.appender.apvs.Threshold=DEBUG\nlog4j.appender.apvs.File=/nbcpbat01/appl_data/apv/logs/encoderMgr/138/apvs.log\nlog4j.appender.apvs.MaxFileSize=20MB\nlog4j.appender.apvs.MaxBackupIndex=5\nlog4j.appender.apvs.layout=org.apache.log4j.PatternLayout\nlog4j.appender.apvs.layout.ConversionPattern=%d{yy/MM/dd;HH:mm:ss;SSS;} %-5p %C{3};:(%F:%M():%L) - %m%n\n\nError that i received in javaerr.log\n====================================\nlog4j:ERROR Could not close org.apache.log4j.helpers.CountingQuietWriter@13c296b\njava.io.IOException: Input/output error\n\tat java.io.FileOutputStream.close0(Native Method)\n\tat java.io.FileOutputStream.close(FileOutputStream.java:279)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.implClose(StreamEncoder.java:431)\n\tat sun.nio.cs.StreamEncoder.close(StreamEncoder.java:160)\n\tat java.io.OutputStreamWriter.close(OutputStreamWriter.java:222)\n\tat java.io.FilterWriter.close(FilterWriter.java:92)\n\tat org.apache.log4j.FileAppender.closeFile(FileAppender.java:171)\n\tat org.apache.log4j.RollingFileAppender.rollOver(RollingFileAppender.java:135)\n\tat org.apache.log4j.RollingFileAppender.subAppend(RollingFileAppender.java:228)\n\tat org.apache.log4j.WriterAppender.append(WriterAppender.java:150)\n\tat org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:221)\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:57)\n\tat org.apache.log4j.Category.callAppenders(Category.java:187)\n\tat org.apache.log4j.Category.forcedLog(Category.java:372)\n\tat org.apache.log4j.Category.debug(Category.java:241)\n\tat com.ge.nbc.media.adapter.encoder.helper.MediaEncoderAdapterHelper.findEncoderStatus(Unknown Source)\n\tat com.ge.nbc.media.bus.recording.helper.MediaRecordingHelper.processMediaEncoding(MediaRecordingHelper.java:7145)\n\tat com.ge.nbc.media.bus.recording.helper.MediaRecordingHelper.processMediaRecording(MediaRecordingHelper.java:1892)\n\tat com.ge.nbc.media.bus.recording.bd.MediaRecordingBD.processMediaRecording(MediaRecordingBD.java:338)\n\tat com.ge.nbc.program.bus.recording.helper.ProgramRecordingHelper.processProgramRecording(ProgramRecordingHelper.java:624)\n\tat com.ge.nbc.program.bus.recording.bd.ProgramRecordingBD.processProgramRecording(ProgramRecordingBD.java:370)\n\tat com.ge.nbc.program.app.recording.handler.ProgramRecordingHandler.onMessage(ProgramRecordingHandler.java:2933)\n\tat com.tibco.tibjms.TibjmsSession._submit(TibjmsSession.java:2775)\n\tat com.tibco.tibjms.TibjmsSession._dispatchAsyncMessage(TibjmsSession.java:1413)\n\tat com.tibco.tibjms.TibjmsSession$Dispatcher.run(TibjmsSession.java:2491)\n**Exception in MessageListener**:\njava.lang.IllegalStateException: Current state = FLUSHED, new state = CODING\n\tat java.nio.charset.CharsetEncoder.throwIllegalStateException(CharsetEncoder.java:941)\n\tat java.nio.charset.CharsetEncoder.encode(CharsetEncoder.java:537)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.implWrite(StreamEncoder.java:384)\n\tat sun.nio.cs.StreamEncoder.write(StreamEncoder.java:136)\n\tat sun.nio.cs.StreamEncoder.write(StreamEncoder.java:146)\n\tat java.io.OutputStreamWriter.write(OutputStreamWriter.java:204)\n\tat java.io.Writer.write(Writer.java:126)\n\tat org.apache.log4j.helpers.CountingQuietWriter.write(CountingQuietWriter.java:36)\n\tat org.apache.log4j.WriterAppender.subAppend(WriterAppender.java:292)\n\tat org.apache.log4j.RollingFileAppender.subAppend(RollingFileAppender.java:225)\n\tat org.apache.log4j.WriterAppender.append(WriterAppender.java:150)\n\tat org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:221)\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:57)\n\tat org.apache.log4j.Category.callAppenders(Category.java:187)\n\tat org.apache.log4j.Category.forcedLog(Category.java:372)\n\tat org.apache.log4j.Category.error(Category.java:303)\n\tat com.ge.nbc.program.app.recording.handler.ProgramRecordingHandler.onMessage(ProgramRecordingHandler.java:2958)\n\tat com.tibco.tibjms.TibjmsSession._submit(TibjmsSession.java:2775)\n\tat com.tibco.tibjms.TibjmsSession._dispatchAsyncMessage(TibjmsSession.java:1413)\n\tat com.tibco.tibjms.TibjmsSession$Dispatcher.run(TibjmsSession.java:2491)\n**Exception in MessageListener**:\njava.lang.IllegalStateException: Current state = FLUSHED, new state = CODING\n\nThanks,\nJayasree"}, {"count": 1, "tags": [], "creator": "hoju@visi.com", "attachment_id": null, "id": 131751, "time": "2009-11-05T20:21:41Z", "bug_id": 48142, "creation_time": "2009-11-05T20:21:41Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of bug 48141 ***"}]
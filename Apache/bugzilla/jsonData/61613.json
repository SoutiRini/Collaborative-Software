[{"count": 0, "tags": [], "creator": "AL00339146@techmahindra.com", "attachment_id": null, "id": 201433, "time": "2017-10-13T11:36:26Z", "bug_id": 61613, "creation_time": "2017-10-13T11:36:26Z", "is_private": false, "text": "I am getting following error to start Apache service after upgrading Apache httpd from 2.4.27 to 2.4.28.\n\nhttpd: Syntax error on line 130 of /opt/SP/apache/httpd_current/conf/httpd.conf: Cannot load modules/mod_ssl.so into server: libssl.so.1.1: cannot open shared object file: No such file or directory\n\nBelow dependency packages for Apache 2.4.28 are installed:\n\nOpenSSL 1.0.2j\nApr-1.6.2\nApr-util-1.6.0\nPcre-8.41\n\nIt is unable to find libssl.so.1.1 and libcrypto.so.1.1. While in Apache httpd 2.4.27 this two library files were not required.\n\n\n[apache@ ~]$ ldd /opt/SP/apache/httpd_current/modules/mod_ssl.so\n        linux-vdso.so.1 =>  (0x00007ffe9cf2e000)\n        libssl.so.1.1 => not found\n        libcrypto.so.1.1 => not found\n        librt.so.1 => /lib64/librt.so.1 (0x00007faa35def000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007faa35bb8000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007faa3599b000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007faa35797000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007faa353d4000)\n        libfreebl3.so => /lib64/libfreebl3.so (0x00007faa351d0000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007faa3624d000)\n\n\nCould you please check for this issue. Is this related to the recent changes related to mod_ssl, ab: Fix compatibility with LibreSSL.  PR 61184.\n\n\nThanks and Regards,\nAakash Lodha"}, {"count": 1, "tags": [], "creator": "dferradal@gmail.com", "text": "Where is your openssl installation?\n\nHave you added the /path/to/openssl/lib directory to LD_LIBRARY_PATH in envvars file or through other means before trying to start httpd?", "id": 201437, "time": "2017-10-13T13:37:30Z", "bug_id": 61613, "creation_time": "2017-10-13T13:37:30Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "toscano.luca@gmail.com", "text": "Moreover, how did you configure/compile httpd? Can you attach the related config.log?", "id": 201439, "time": "2017-10-13T13:50:22Z", "bug_id": 61613, "creation_time": "2017-10-13T13:50:22Z", "is_private": false, "attachment_id": null}, {"count": 3, "text": "I have installed openssl on below path and same I have used to configure Apache https:\n\n/opt/SP/apache/dependency.\n\nNo I haven't set LD_LIBRARY_PATH separately as it was not required in prior versions(httpd 2.4.27 and prior).\n\n\nBelow are the steps used to configure Apache httpd:\n\ni.\t$ ./configure --prefix=/opt/SP/apache/httpd_current --with-apr=/opt/SP/apache/dependency/apr/bin/apr-1-config --with-apr-util=/opt/SP/apache/dependency/apr/bin/apu-1-config --with-pcre=/opt/SP/apache/dependency/pcre --with-ssl=/opt/SP/apache/dependency/openssl --enable-ssl \n\nii.\t$make\n\niii.\t$make \u2013n install\n\niv.\t$make install", "creator": "AL00339146@techmahindra.com", "is_private": false, "id": 201443, "time": "2017-10-13T14:25:16Z", "bug_id": 61613, "creation_time": "2017-10-13T14:25:16Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 61613, "attachment_id": null, "is_private": false, "id": 201444, "time": "2017-10-13T14:47:13Z", "creator": "dferradal@gmail.com", "creation_time": "2017-10-13T14:47:13Z", "text": "\n> \n> No I haven't set LD_LIBRARY_PATH separately as it was not required in prior\n> versions(httpd 2.4.27 and prior).\n\nYou are making incorrect assumptions, as if this was a new httpd thing, when what you describe is Linux/Unix operative system thing since, for ever.\n\nIt is *not* necessary *if* you compile against the operative system libssl because those lib files are already in a path your binaries can find, but when you compiled against libssl from another source, your operative system, not just httpd need those SSL libs loaded somewhere if you want binaries to find them.\n\nBeing that method:\n/etc/ld.so.conf.d/\n\nor LD_LIBRARY_PATHS called from envvars file before you run httpd.\n\n> --with-ssl=/opt/SP/apache/dependency/openssl --enable-ssl \n\nAccording to this, you need at the very least /opt/SP/apache/dependency/openssl/lib in LD_LIBRARY_PATH for mod_ssl to find the ssl libs it was compiled against.\n\nAnd yes, mod_ssl have always needed to find ssl libs it was compiled against, unless compiled statically."}, {"attachment_id": null, "tags": [], "bug_id": 61613, "text": "Thanks for the clarification.\n\nWe haven't set this LD_Library_Path earlier for prior versions. It will be really helpful if you may clear this part why we need to set this now. Below is the current output of  LD_Library_Path where Apache httpd 2.4.27 is working fine.\n\n[root@*** ~]# echo $LD_LIBRARY_PATH\n\n[root@*** ~]#\n\n\n\nThanks and Best Regards,\nAakash", "count": 5, "id": 201445, "time": "2017-10-13T15:37:25Z", "creator": "AL00339146@techmahindra.com", "creation_time": "2017-10-13T15:37:25Z", "is_private": false}, {"count": 6, "tags": [], "creator": "rpluem@apache.org", "text": "(In reply to Aakash from comment #5)\n> Thanks for the clarification.\n> \n> We haven't set this LD_Library_Path earlier for prior versions. It will be\n> really helpful if you may clear this part why we need to set this now. Below\n> is the current output of  LD_Library_Path where Apache httpd 2.4.27 is\n> working fine.\n> \n> [root@*** ~]# echo $LD_LIBRARY_PATH\n> \n> [root@*** ~]#\n> \n> \n> \n> Thanks and Best Regards,\n> Aakash\n\nWhat delivers ldd against the mod_ssl from your 2.4.27 Apache?", "id": 201446, "time": "2017-10-13T17:28:53Z", "bug_id": 61613, "creation_time": "2017-10-13T17:28:53Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 61613, "attachment_id": null, "text": "(In reply to Aakash from comment #5)\n> Thanks for the clarification.\n> \n> We haven't set this LD_Library_Path earlier for prior versions. It will be\n> really helpful if you may clear this part why we need to set this now. Below\n> is the current output of  LD_Library_Path where Apache httpd 2.4.27 is\n> working fine.\n> \n> [root@*** ~]# echo $LD_LIBRARY_PATH\n> \n> [root@*** ~]#\n> \n> \n> \n> Thanks and Best Regards,\n> Aakash\n\nI guess you need to see how you managed to compile previous versions and if you used mod_ssl.\n\nDid you compile against external openssl? Then if so, either you were previously using an envvars file pointing to the openssl libraries or you were lucky enough the operative system openssl libs were found and were the same version.\n\nBy default, httpd has a file called envvars in its bin directory, you will see it is already pointing to the lib directory of httpd itself, if you compiled httpd against other external libraries, other lib directories should go in there, otherwise when you run the binary it will look for the needed libs in system path, with mixed consequences, sometimes it may work and sometimes if the lib versions are too different there will be failures if the names match, or won't find them if the lib files in your system are not the same.", "id": 201452, "time": "2017-10-13T20:19:03Z", "creator": "dferradal@gmail.com", "creation_time": "2017-10-13T20:19:03Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 61613, "is_private": false, "count": 8, "id": 201455, "time": "2017-10-13T21:40:19Z", "creator": "wrowe@apache.org", "creation_time": "2017-10-13T21:40:19Z", "text": "Highly unlikely this is related to httpd.\n\nlibssl.so.1.1 indicates you have linked to OpenSSL 1.1.0, yet you claim\nOpenSSL 1.0.2 is in use. It was not.\n\nIt seems you might have a 1.1 -dev/-devel package installed, while the base\nor resulting openssl 1.1 libraries are absent.\n\nWe would need a whole lot more data to figure out where libssl.so.1.1 on\nyour environment is residing, and that's an exercise for the reader, and\nfor help from the users list."}, {"count": 9, "tags": [], "creator": "AL00339146@techmahindra.com", "attachment_id": null, "id": 201479, "time": "2017-10-16T10:22:56Z", "bug_id": 61613, "creation_time": "2017-10-16T10:22:56Z", "is_private": false, "text": "Hi,\n\nWe have rolled back the apache to version 2.4.27 and tried to do ldd. Following is the result:\n\n[apache@*** apache]$ ldd /opt/SP/apache/httpd_current/modules/mod_ssl.so\n        linux-vdso.so.1 =>  (0x00007ffef4f05000)\n        librt.so.1 => /lib64/librt.so.1 (0x00007fedaf0cf000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fedaee98000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fedaec7b000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fedaea77000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007fedae6b4000)\n        libfreebl3.so => /lib64/libfreebl3.so (0x00007fedae4b0000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fedaf78f000)\nKindly advice.\n\nThanks and best regards,\nAakash"}, {"count": 10, "tags": [], "text": "Should probaly use something like \"configure --enable-ssl-staticlib-deps ...\" with 2.4.27.", "attachment_id": null, "id": 201480, "creator": "ylavic.dev@gmail.com", "time": "2017-10-16T11:06:19Z", "bug_id": 61613, "creation_time": "2017-10-16T11:06:19Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 61613, "text": "(In reply to Aakash from comment #9)\n> Hi,\n> \n> We have rolled back the apache to version 2.4.27 and tried to do ldd.\n> Following is the result:\n> \n> [apache@*** apache]$ ldd /opt/SP/apache/httpd_current/modules/mod_ssl.so\n>         linux-vdso.so.1 =>  (0x00007ffef4f05000)\n>         librt.so.1 => /lib64/librt.so.1 (0x00007fedaf0cf000)\n>         libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fedaee98000)\n>         libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fedaec7b000)\n>         libdl.so.2 => /lib64/libdl.so.2 (0x00007fedaea77000)\n>         libc.so.6 => /lib64/libc.so.6 (0x00007fedae6b4000)\n>         libfreebl3.so => /lib64/libfreebl3.so (0x00007fedae4b0000)\n>         /lib64/ld-linux-x86-64.so.2 (0x00007fedaf78f000)\n> Kindly advice.\n> \n> Thanks and best regards,\n> Aakash\n\nThis confirms what was suspected in comment 7: You have compiled httpd 2.4.27 against a self compiled Openssl, but this Openssl was of the same version as the system one. So when you started httpd it used the system one and not the Openssl you compiled on your own. Now that you use a newer version of Openssl for your self compiled Openssl and compile httpd against this, this does no longer work as httpd cannot fall back to the system provided Openssl. To solve this ensure that your self compiled version of Openssl is usable for httpd by either setting LD_LIBRARY_PATH or by making it available to the dynamic linker in general (adding path to linker configuration, installing it in a path the linker already is aware of).", "id": 201487, "time": "2017-10-17T08:20:02Z", "creator": "rpluem@apache.org", "creation_time": "2017-10-17T08:20:02Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "wrowe@apache.org", "text": "Second warning to stop abusing bugzilla as a user support forum.\n\nPlease see http://httpd.apache.org/lists.html#http-users", "id": 201507, "time": "2017-10-17T19:49:22Z", "bug_id": 61613, "creation_time": "2017-10-17T19:49:22Z", "is_private": false, "attachment_id": null}]
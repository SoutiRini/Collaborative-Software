[{"count": 0, "tags": [], "bug_id": 27884, "attachment_id": null, "text": "Mod_jk2 connector seems to make an extra request when the client cuts of the \nconnection. Eg. If a page takes too much time to load and if the user cancels \nthe load of the page/clicks to go to another page, then mod_jk2 continues with \nthe first request but makes a duplicate first request again.\n\nSay if a page has two links \nLink1 linking to Page1 \nand Link2 linking to page2, if a user clicks on link1 and before page1 loads \nclicks on link2, then mod_jk2 seems to make 2 requests to page1(which is very \nwrong) and 1 request to page2(which is correct)\n\nThe behaviour is correct with mod_jk however.\n\n\nConfiguration: IIS 5.0, mod_jk2, Jakarta Tomcat 4.1.23", "id": 54519, "time": "2004-03-24T00:05:17Z", "creator": "Biju_Kunjummen@hotmail.com", "creation_time": "2004-03-24T00:05:17Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 27884, "is_private": false, "count": 1, "id": 54543, "time": "2004-03-24T08:48:08Z", "creator": "hgomez@apache.org", "creation_time": "2004-03-24T08:48:08Z", "text": "Which version of jk2 ?\n\nTake a look at the latest in CVS which will be tagged 2.0.4 today"}, {"count": 2, "tags": [], "bug_id": 27884, "attachment_id": null, "is_private": false, "id": 54570, "time": "2004-03-24T14:19:19Z", "creator": "Biju_Kunjummen@hotmail.com", "creation_time": "2004-03-24T14:19:19Z", "text": "I am using the release version 2.0.2 right now. Is there a binary version of \n2.04 that I can download from someplace. I can test out if this fixes this \nissue. From what I have seen of the 2.0.2 code, I felt that the following line \nhas an issue:\n\njk_worker_ajp13.c:\n\n#define JK_RETRIES 2\n\n\nstatic int JK_METHOD\njk2_worker_ajp13_forwardStream(jk_env_t *env, jk_worker_t *worker,\n                              jk_ws_service_t *s,\n                              jk_endpoint_t   *e )\n{\n    int err=JK_OK;\n    int attempt;\n    int has_post_body=JK_FALSE;\n    jk_channel_t *channel= worker->channel;\n\n    e->recoverable = JK_TRUE;\n    s->is_recoverable_error = JK_TRUE;\n\n    /*\n     * Try to send the request on a valid endpoint. If one endpoint\n     * fails, close the channel and try again ( maybe tomcat was restarted )\n     *\n     * XXX JK_RETRIES could be replaced by the number of workers in\n     * a load-balancing configuration\n     */\n    for(attempt = 0 ; attempt < JK_RETRIES ;attempt++) {\n\n\n\n"}, {"count": 3, "tags": [], "bug_id": 27884, "attachment_id": null, "id": 54571, "time": "2004-03-24T14:26:48Z", "creator": "hgomez@apache.org", "creation_time": "2004-03-24T14:26:48Z", "is_private": false, "text": "Thanks to check against latest JK 2.0.4 (tagged today), tarball in few hours \nand reopen if needed"}, {"count": 4, "tags": [], "bug_id": 27884, "is_private": false, "id": 54762, "creation_time": "2004-03-26T22:58:54Z", "time": "2004-03-26T22:58:54Z", "creator": "Biju_Kunjummen@hotmail.com", "text": "Henri, \nI tried with version 2.0.4 and it too has the exact same bug. Essentially when \nI don't allow a page to load(by escaping the load, or by clicking on another \nlink) mod_jk2 tends to make a duplicate request to the tomcat engine.\nThis could be because of my configuration, that is why I am including the \nrelevant configuration entries too here:\n\nworker2.properties:\n\n[shm]\nfile=E:/pr/logs/jk2.shm\nsize=1048576\n\n[channel.socket:localhost:8009]\nport=8009\nhost=127.0.0.1\nlbfactor=1\n\n[channel.socket:localhost:8010]\nport=8010\nhost=127.0.0.1\nlbfactor=1\n\n[ajp13:localhost:8009]\nchannel=channel.socket:localhost:8009\n\n[ajp13:localhost:8010]\nchannel=channel.socket:localhost:8010\n\n[lb:localhost]\nworker=ajp13:localhost:8009\nworker=ajp13:localhost:8010\n\n[uri:/scripts/Test]\ngroup=lb:localhost\n\n\nCan you please check to see what the issue is here. ", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 27884, "is_private": false, "id": 54805, "creation_time": "2004-03-29T08:31:10Z", "time": "2004-03-29T08:31:10Z", "creator": "hgomez@apache.org", "text": "Well I suspect that detection on user abort may not works fully in lb mode.\n\nI'll check if it's the case in Apache 2 also.", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 27884, "text": "Thanks for checking Henri. I doubt if it is the lb entries though. I tried with \nthe following configuration too, without a lb entry but still have the same \nerror. Mod_jk does not have this problem - \nworker2.properties:\n\n[shm]\nfile=E:/pr/logs/jk2.shm\nsize=1048576\n\n[channel.socket:localhost:8009]\nport=8009\nhost=127.0.0.1\n\n\n[uri:/scripts/Test]\nworker=ajp13:localhost:8009\n", "id": 54847, "time": "2004-03-30T04:11:57Z", "creator": "Biju_Kunjummen@hotmail.com", "creation_time": "2004-03-30T04:11:57Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 27884, "text": "Good information.\n\nThe problem is to simulate what your doing, ie stop a request\nto start a new one.\n\nBTW, I could only test on Apache 2, no IIS here\n\n", "id": 54852, "time": "2004-03-30T06:02:30Z", "creator": "hgomez@apache.org", "creation_time": "2004-03-30T06:02:30Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 27884, "is_private": false, "count": 8, "id": 68445, "time": "2004-12-14T01:36:48Z", "creator": "funkman@joedog.org", "creation_time": "2004-12-14T01:36:48Z", "text": "As of November 15, 2004, JK2 is no longer supported. All bugs related to JK2 \nwill be marked as WONTFIX. In its place, some of its features have been \nbackported to jk1. Most of those features will be seen in 1.2.7, which is \nslated for release on November 30th, 2004.\n\nAnother alternative is the ajp addition to mod_proxy which will be part of \napache 2.\n\nFor more information on the Tomat connectors docs at\nhttp://jakarta.apache.org/tomcat/connectors-doc/\n\n"}]
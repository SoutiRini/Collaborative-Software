[{"count": 0, "text": "Hi,\n\nProblem I have is that when using IE 6.0.28, I am loosing my session.\nSymtoms are.. each time I refresh the jsp page I get a new session ID.\n\nWhen looking at the headers my jsp page gets from IE, it gets multiple \nJSESSIONID value pairs.\ne.g.\ncookie : JSESSIONID=A1F4FDB2DCE970FB5350B0B7E3997C72; \nJSESSIONID=284C19AD5ED2498FE7BFECF838EB47A0\n\nto reproduce this ther are two ways, mind you they are not very consistent, \nbut usually after a short while you shold get it.\n\nMethod 1: Not necessarily happens in real life\nusign the test.jsp page, you create another JSESSIONID by either deleteing the \nID or setting it by clickign the set button. This test may not be valid, but \nit illustrates what IE does when it calls tomcat.\n\nThen each time you refresh this page, you get a new session id adn a new \nsession\n\nMethod 2: What happenes in real life\nusing an application that requires two urls, where when you hit the first url, \nit redirects you to a second url. both urls must be a jsp page.\nWhat happens is that IE will send the cookie from teh first url to teh second \nurl, then the seoncd jsp page will then not find this session,as it is a \ndifferent site. So it will then send a new id back to IE. IE then appends this \nnew id and so you now have 2 JSESSIONID cookies.\nBecasue it appends it, Tomcat doesn't see the second cookie and so when it is \ntold to refresh or get a new url, it will then create a new session again, adn \nso the cycle begins.\n\n\nAppendix test.jsp page used for both scenario\n<html>\n\n<script>\nfunction getCookie(name)\n{\n    var dc = document.cookie;\n\talert(dc);\n    var prefix = wconfig.cname.value + \"=\";\n    var begin = dc.indexOf(\"; \" + prefix);\n    if (begin == -1)\n    {\n        begin = dc.indexOf(prefix);\n        if (begin != 0) return null;\n    }\n    else\n    {\n        begin += 2;\n    }\n    var end = document.cookie.indexOf(\";\", begin);\n    if (end == -1)\n    {\n        end = dc.length;\n    }\n    alert( unescape(dc.substring(begin + prefix.length, end)));\n    return true;\n}\n\nfunction setCookie(name, value, expires, path, domain, secure)\n{\n    document.cookie= name + \"=\" + escape(value) +\n        ((expires) ? \"; expires=\" + expires.toGMTString() : \"\") +\n        ((path) ? \"; path=\" + path : \"\") +\n        ((domain) ? \"; domain=\" + domain : \"\") +\n        ((secure) ? \"; secure\" : \"\");\n}\nfunction deleteCookie(name, path, domain)\n{\n    if (getCookie(name))\n    {\n        document.cookie = name + \"=\" + \n            ((path) ? \"; path=\" + path : \"\") +\n            ((domain) ? \"; domain=\" + domain : \"\") +\n            \"; expires=Thu, 01-Jan-70 00:00:01 GMT\";\n    }\n}\n</script>\n<body>\n<%\n\nSystem.out.println(\" ****************************site index Headers \n*****************\");\n\t\t\tSystem.out.println(\"*************************** \nSession \" + session.getId());\n\t\t\tfor (java.util.Enumeration e = request.getHeaderNames\n() ; e.hasMoreElements() ;) \n\t\t\t{\n\t\t\t\tString headername = (String) e.nextElement();\n\t\t        System.out.println(headername + \" : \" + \nrequest.getHeader(headername));\n\t\t    }\n\n%>\n<%= session.getId() %>\n<form name=\"wconfig\">\n<input type=\"text\" name=\"cname\" value=\"JSESSIONID\"/>\n<input type=\"button\" name=\"view\" onClick=\"getCookie()\"/><br>\n\n<input type=\"text\" name=\"cvalue\" value=\"<%= session.getId() %>\" />\n<input type=\"button\" name=\"view\" onClick=\"setCookie(wconfig.cname.value, \nwconfig.cvalue.value)\" value=\"set\"/>\n\n<input type=\"button\" name=\"view\" onClick=\"deleteCookie(wconfig.cname.value)\" \nvalue=\"del\"/>\n\n</form>\n<a href=\"test.jsp\">goto</a>\n</body>\n</html>\n\nredirct page to place in jsp\n\n<html>\n<% newURL = http://blah.com/test.jsp %>\n<META HTTP-EQUIV=\"Refresh\"\n      CONTENT=\"0; URL=<%= newURL %>\" />\n<head>\n</head>      \n<body>\nIf this page does take you to teh Administration page please click on the this \nlink <a href=\"<%= newURL%>\">Go to site</a>\n</body>\n</html>", "creator": "pchan@chanplanet.com", "attachment_id": null, "id": 73505, "time": "2005-04-11T06:57:01Z", "bug_id": 34394, "creation_time": "2005-04-11T06:57:01Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Your test case contains several bugs and, even after fixing them, the behaviour\nyou describe does not occur.\n\nYou might want to read the following from the archives:\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=105956300319201&w=2\n\nBugzilla is not an application development support forum. For issues such as\nthis I suggest that you try searching the archives and/or posting to the\ntomcat-user mailing list rather than filing a bug report.", "id": 73553, "time": "2005-04-11T22:10:41Z", "bug_id": 34394, "creation_time": "2005-04-11T22:10:41Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 2902, "attachment_id": null, "text": "Using the 'server.xml' entries:\n\n<Host name=\"webtest\" debug=\"1\" appBase=\"/www/tomcat4b6\" unpackWARs=\"true\">\n\n<Context path=\"/ACELink\" docBase=\"ACELink\" debug=\"1\" reloadable=\"true\">\n   <Logger className=\"org.apache.catalina.logger.FileLogger\"\n           prefix=\"ACELink_log.\" suffix=\".txt\" timestamp=\"true\"/>\n</Context>\n\nUsing the Tomcat default servlet, a request to\n'http://webtest/ACELink/index.html' displays the expected page.\n\nMapping a templating servlet to serve the above request returns a '404 Not\nFound' error. Tracing that servlet code through the calls:\n\n        uri = req.getRequestURI( ) ;\n        file = new File( cfg.getServletContext( ).getRealPath( uri ) ) ;\n\nshows ... \turi  = /ACELink/index.html\n\t\tfile = /www/tomcat/ACELink/ACELink/index.html\n\nThe path should read: /www/tomcat/ACELink/index.html", "id": 4152, "time": "2001-07-30T13:07:13Z", "creator": "gunter.vanasse@sun.com", "creation_time": "2001-07-30T13:07:13Z", "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 4155, "time": "2001-07-30T14:23:08Z", "bug_id": 2902, "creation_time": "2001-07-30T14:23:08Z", "text": "Actually, no.\nThe path used in the getRealPath method is relative to the context root (as \nwith all the other methods in ServletContext).\nSo here, you should do file = new File( cfg.getServletContext( ).getRealPath\n(\"/index.html\") ) ;\n\nFrom the ServletContext.getRealPath javadoc :\nReturns a String containing the real path for a given virtual path. For \nexample, the path \"/index.html\" returns the absolute file path on the server's \nfilesystem would be served by a request \nfor \"http://host/contextPath/index.html\", where contextPath is the context path \nof this ServletContext.."}, {"count": 2, "text": "Ok. By the Servlet API specification's description of the\nServletContext.getRealPath() method, your response is correct. In essence, it\nre-iterates the example given in the specs getRealPath() description.\n\nHowever, I'll contend that, although the getRealPath() method in the\nServletContext object's behavior may be working as designed, there is now a\ndisconnect in the Servlet API. I may be missing something, and correct me if I'm\nwrong but ...\n\nFrom the client comes a request with a unique resource locator. The server\nidentifies the requested resource by the URI (path between host and query\nstring, which is what getRequestURI() returns) of the requested URL and passes\nthe request to that resource (excluding interceptor and filter from this\nscenario). \n\nWith the introduction of web applications, the server has the additional task of\nmapping the request to a context based on this URI.\n\nFollowing Tomcat's logic from the context's log ...\n\n001-07-30 15:09:57 StandardContext[/ACELink]: Mapping contextPath='/ACELink'\nwith requestURI='/ACELink/index.html' and relati\nveURI='/index.html'\n2001-07-30 15:09:57 StandardContext[/ACELink]: Decoded relativeURI='/index.html'\n2001-07-30 15:09:57 StandardContext[/ACELink]:  Mapped to servlet 'template'\nwith servlet path '' and path info '/index.html' \n\nNow, to follow through with your statement ...\n\"you should do file = new File( cfg.getServletContext( ).getRealPath\n(\"/index.html\") ) ;\" \n\nFrom the above, \"/index.html\" would be the \"relativeURI\". But the \"relativeURI\"\nis a Tomcat specific bit of information. What is available to me (the Web\ndeveloper, through the Servlet APIs) is the \"requestURI\" which is the value\nreturned by getRequestURI().\n\nYou may argue that I can get the relativeURI by taking the substring of\n(getRequestURI - getContextPath), this change breaks backward compatibility.\n\n\n\n", "bug_id": 2902, "attachment_id": null, "id": 4180, "time": "2001-07-31T07:12:38Z", "creator": "gunter.vanasse@sun.com", "creation_time": "2001-07-31T07:12:38Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "craig.mcclanahan@sun.com", "attachment_id": null, "is_private": false, "id": 4263, "time": "2001-08-03T14:46:16Z", "bug_id": 2902, "creation_time": "2001-08-03T14:46:16Z", "text": "If you believe that the servlet API should be changed, that feedback needs to be\naddressed to the Servlet Spec lead (and the corresponding expert group) that is\nresponsible for the servlet specification:\n\n  servletapi-feedback@java.sun.com\n\nTomcat cannot arbitrarily deviate from the spec.\n\nHowever, a few additional comments are in order in response to your remarks:\n\n* Tomcat 4.0 is indeed backwards compatible with Tomcat 3.x with respect\n  to the interpretation of getRealPath().  These semantics were introduced\n  in the Servlet 2.2 specification.\n\n* You can calculate the context-relative part of a path by either one of\n  two equations:\n\n    requestURI - contextPath\n\n    servletPath + pathInfo\n\n  Any and all of these values are available via the Servlet API, by calls\n  on the HttpServletRequest object.\n\n* You should not really be using file i/o to access resources in the first\n  place, because a web application will not always be run out of a directory.\n  The recommended action is to use ServletContext.getResourceAsStream():\n\n    InputStream is =\n     getServletContext().getResourceAsStream(\"/index.html\");\n\n  This will work on all web servers, whether or not your webapp is actually\n  deployed into a directory structure, executed directly from a WAR file\n  (which is an option in Tomcat 4), or deployed in some other fashion\n  (such as BLOB objects in a database).  In either of the latter two cases,\n  getRealPath() will return null because there is no such thing as a \n  pathname to the resource.\n\nTomcat's implementation of getRealPath() is *not* going to be changed.\n\n        Craig McClanahan\n"}, {"count": 4, "text": "This bug is happening again in v4.1.12 on Win32.\n", "bug_id": 2902, "attachment_id": null, "id": 25505, "time": "2002-11-02T13:03:24Z", "creator": "paechoi@earthlink.net", "creation_time": "2002-11-02T13:03:24Z", "tags": [], "is_private": false}, {"count": 5, "text": "In servlet, try the following code.\n\nServletContext sctx = getServletContext();\n// BUG\nString wsContextBugPath = sctx.getRealPath(reqRef.getContextPath());\n\nWe will get the duplicated context name twice as follows:\n\n<CATALINA_HOME>\\webapps\\<context_name>\\<context_name>\n\nThis is from TC v4.1.12 with J2SDK 1.4.1_01 on Win32. I have not\ntested on Linux yet.\n", "creator": "paechoi@earthlink.net", "is_private": false, "id": 25580, "time": "2002-11-03T15:34:05Z", "bug_id": 2902, "creation_time": "2002-11-03T15:34:05Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 2902, "attachment_id": null, "text": "This report is invalid (the URI is relative to the context root). Please DO NOT \nreopen it.", "id": 35201, "time": "2003-04-15T15:33:58Z", "creator": "remm@apache.org", "creation_time": "2003-04-15T15:33:58Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 23837, "attachment_id": null, "id": 45734, "time": "2003-10-15T13:16:07Z", "creator": "rdk@krupczak.org", "creation_time": "2003-10-15T13:16:07Z", "is_private": false, "text": "On a freshly installed RH8.0 system (vanilla install, no mods to it), \nsimple/default config fails with:\n\nserver/.libs/libmain.al(exports.lo)(.data+0xb40): undefined reference to\n`apr_threadkey_private_delete'\ncollect2: ld returned 1 exit status\n\nI have searched google and found only single match with someone with\nsimilar problem with 2.0.45 but he cannot recall how he fixed it.  He\nsaid he thought it was a configure option.  I have tried different config options.\n\nI have searched FAQs, httpd-users mailing list and archive, etc.  No luck.\n\n/bin/sh /mankato/stuff/httpd-2.0.47/srclib/apr/libtool --silent --mode=link gcc\n -g -O2    -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -DAP_HAVE_DESIGNATED_INITIALIZER\n  -I/mankato/stuff/httpd-2.0.47/srclib/apr/include\n-I/mankato/stuff/httpd-2.0.47/srclib/apr-util/include -I.\n-I/mankato/stuff/httpd-2.0.47/os/unix\n-I/mankato/stuff/httpd-2.0.47/server/mpm/prefork\n-I/mankato/stuff/httpd-2.0.47/modules/http\n-I/mankato/stuff/httpd-2.0.47/modules/filters\n-I/mankato/stuff/httpd-2.0.47/modules/proxy\n-I/mankato/stuff/httpd-2.0.47/include\n-I/mankato/stuff/httpd-2.0.47/modules/dav/main -export-dynamic    -o httpd \nmodules.lo  modules/aaa/mod_access.la modules/aaa/mod_auth.la\nmodules/filters/mod_include.la modules/loggers/mod_log_config.la\nmodules/metadata/mod_env.la modules/metadata/mod_setenvif.la\nmodules/http/mod_http.la modules/http/mod_mime.la\nmodules/generators/mod_status.la modules/generators/mod_autoindex.la\nmodules/generators/mod_asis.la modules/generators/mod_cgi.la\nmodules/mappers/mod_negotiation.la modules/mappers/mod_dir.la\nmodules/mappers/mod_imap.la modules/mappers/mod_actions.la\nmodules/mappers/mod_userdir.la modules/mappers/mod_alias.la\nmodules/mappers/mod_so.la server/mpm/prefork/libprefork.la server/libmain.la\nos/unix/libos.la  /mankato/stuff/httpd-2.0.47/srclib/pcre/libpcre.la\n/mankato/stuff/httpd-2.0.47/srclib/apr-util/libaprutil-0.la -lgdbm -ldb-4.0\n-lexpat /mankato/stuff/httpd-2.0.47/srclib/apr/libapr-0.la -lrt -lm -lcrypt\n-lnsl -ldl\nserver/.libs/libmain.al(exports.lo)(.data+0xb40): undefined reference to\n`apr_threadkey_private_delete'\ncollect2: ld returned 1 exit status\n\nI can provide config.log or other files needed.  I ended up editing\nserver/exports.c and #ifdef'ing out a function prototype in that file and\nthen linking worked.\n\nThanks,\n\nBobby"}, {"count": 1, "tags": [], "bug_id": 23837, "attachment_id": null, "id": 48608, "creation_time": "2003-12-06T09:31:15Z", "time": "2003-12-06T09:31:15Z", "creator": "codeslob@iinet.net.au", "text": "It appears there is a symbol exported that should only be exported if HAVE_PTHRE\nAD_KEY_DELETE is defined.\n\nMy fix:\n----- cut here -----\n--- /tmp/apache-2.0.48-r1/work/httpd-\n2.0.48/srclib/apr/include/apr_thread_proc.h        2003-12-06 \n20:23:42.000000000 +1100\n+++ ./srclib/apr/include/apr_thread_proc.h      2003-12-06 20:16:04.000000000 \n+1100\n@@ -365,7 +365,9 @@\n  * Free the thread private memory\n  * @param key The handle for the desired thread private memory\n  */\n+#ifdef HAVE_PTHREAD_KEY_DELETE\n APR_DECLARE(apr_status_t) apr_threadkey_private_delete(apr_threadkey_t *key);\n+#endif\n\n /**\n  * Return the pool associated with the current threadkey.\n----- cut here -----\n\nWith the above change, apache now compiles on my Gentoo with apache 2.0.48 (gent\noo package net-www/apache-2.0.48-r1).\n", "is_private": false}, {"count": 2, "text": "Thanks for the patch, though it's not quite right since HAVE_PTHREAD_KEY_DELETE\nis never exported in the APR API.  I've checked a different fix in and will\nbackport it for the next 2.0 release:\n\nhttp://cvs.apache.org/viewcvs.cgi/apr/threadproc/unix/threadpriv.c?r1=1.38&r2=1.39", "bug_id": 23837, "is_private": false, "id": 48823, "time": "2003-12-10T16:29:45Z", "creator": "jorton@redhat.com", "creation_time": "2003-12-10T16:29:45Z", "tags": [], "attachment_id": null}]
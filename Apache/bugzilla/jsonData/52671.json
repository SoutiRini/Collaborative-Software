[{"count": 0, "attachment_id": null, "bug_id": 52671, "text": "JDK versions tested with: 1.7.0_02 (x64) and 1.7.0_03 (x64)\n\n\nI am using the new NIO connector, configured like this:\n\n   <Connector protocol=\"org.apache.coyote.ajp.AjpNioProtocol\"\n               port=\"8009\" redirectPort=\"8443\" URIEncoding=\"UTF-8\"\n               maxThreads=\"50\" minSpareThreads=\"10\"\n               connectionTimeout=\"600000\"\n               acceptorThreadCount=\"2\" />\n\n\nI query the JMX proxy for the thread pool status like this:\n\nhttp://www.mydomain.com/manager/jmxproxy/?qry=Catalina:type=ThreadPool,name=%22ajp-nio-8009%22\n\nThe JMX proxy servlet returns a valid response, and the server's general operation is not affected in any way.\n\n\nBut at the same time, Tomcat logs the following two exceptions to catalina.out:\n\nFeb 15, 2012 12:26:49 PM org.apache.catalina.mbeans.MBeanDumper dumpBeans\nSchwerwiegend: Error getting attribute Catalina:type=ThreadPool,name=\"ajp-nio-8009\" readBufSize\njavax.management.RuntimeOperationsException: Exception invoking method readBufSize\n        at org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:197)\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:647)\n        at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:668)\n        at org.apache.catalina.mbeans.MBeanDumper.dumpBeans(MBeanDumper.java:81)\n        at org.apache.catalina.manager.JMXProxyServlet.listBeans(JMXProxyServlet.java:166)\n        at org.apache.catalina.manager.JMXProxyServlet.doGet(JMXProxyServlet.java:121)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:621)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:108)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:224)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:581)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)\n        at org.apache.coyote.ajp.AjpNioProcessor.process(AjpNioProcessor.java:184)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:579)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1600)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: java.lang.NullPointerException\n        at org.apache.tomcat.util.net.SocketProperties.getRxBufSize(SocketProperties.java:251)\n        at org.apache.tomcat.util.net.NioEndpoint.getReadBufSize(NioEndpoint.java:613)\n        at sun.reflect.GeneratedMethodAccessor1196.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:601)\n        at org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:190)\n        ... 25 more\n\nFeb 15, 2012 12:26:49 PM org.apache.catalina.mbeans.MBeanDumper dumpBeans\nSchwerwiegend: Error getting attribute Catalina:type=ThreadPool,name=\"ajp-nio-8009\" writeBufSize\njavax.management.RuntimeOperationsException: Exception invoking method writeBufSize\n        at org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:197)\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:647)\n        at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:668)\n        at org.apache.catalina.mbeans.MBeanDumper.dumpBeans(MBeanDumper.java:81)\n        at org.apache.catalina.manager.JMXProxyServlet.listBeans(JMXProxyServlet.java:166)\n        at org.apache.catalina.manager.JMXProxyServlet.doGet(JMXProxyServlet.java:121)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:621)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:108)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:224)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:581)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)\n        at org.apache.coyote.ajp.AjpNioProcessor.process(AjpNioProcessor.java:184)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:579)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1600)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: java.lang.NullPointerException\n        at org.apache.tomcat.util.net.SocketProperties.getTxBufSize(SocketProperties.java:283)\n        at org.apache.tomcat.util.net.NioEndpoint.getWriteBufSize(NioEndpoint.java:609)\n        at sun.reflect.GeneratedMethodAccessor1151.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:601)\n        at org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:190)\n        ... 25 more", "id": 153805, "time": "2012-02-15T11:47:03Z", "creator": "sven.asf@woltmann.com", "creation_time": "2012-02-15T11:47:03Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 52671, "attachment_id": null, "is_private": false, "id": 153821, "time": "2012-02-15T21:42:09Z", "creator": "markt@apache.org", "creation_time": "2012-02-15T21:42:09Z", "text": "Fixed in trunk and 7.0.x and will be included in 7.0.26 onwards."}, {"count": 2, "attachment_id": null, "bug_id": 52671, "text": "For reference:\nThe NPE was thrown from the following code in SocketProperties, where Integer txBufSize is null:\n\n    public int getTxBufSize() {\n        return txBufSize.intValue();\n    }\n\nMBeanDumper#dumpBeans() skips null values. It is OK to skip such NPEs as well. The fix in 7.0.26 is r1244746", "id": 153859, "time": "2012-02-17T00:44:47Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-02-17T00:44:47Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 52671, "text": "Hi,\n\nIt's strange but I've got almost the same exception but at Tomcat 8.0.33.\n\n2017-07-20 14:18:45,572 ERROR [chedulerFactoryBean#0_Worker-9] [shc.ecom.sywlocal.monitoring.HTTPReporter] - Got exception: \njavax.management.RuntimeOperationsException: Exception invoking method writeBufSize\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:196)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:647)\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:678)\n\tat com.codahale.metrics.JmxAttributeGauge.getValue(JmxAttributeGauge.java:44)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.createMeasurementObject(HTTPReporter.java:123)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.createWebContainerData(HTTPReporter.java:363)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.createMeasurementObjects(HTTPReporter.java:151)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.report(HTTPReporter.java:89)\n\tat sun.reflect.GeneratedMethodAccessor151.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.util.MethodInvoker.invoke(MethodInvoker.java:269)\n\tat org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean$MethodInvokingJob.executeInternal(MethodInvokingJobDetailFactoryBean.java:312)\n\tat org.springframework.scheduling.quartz.QuartzJobBean.execute(QuartzJobBean.java:114)\n\tat org.quartz.core.JobRunShell.run(JobRunShell.java:202)\n\tat org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:525)\nCaused by: java.lang.NullPointerException\n\tat org.apache.tomcat.util.net.SocketProperties.getTxBufSize(SocketProperties.java:300)\n\tat org.apache.tomcat.util.net.NioEndpoint.getWriteBufSize(NioEndpoint.java:493)\n\tat sun.reflect.GeneratedMethodAccessor147.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:189)\n\t... 15 more\n\nWill create proper bug for Tomcat 8.0.33 later.\n\nThanks,\nEvgeny Kochnev", "id": 199898, "time": "2017-07-20T19:28:12Z", "creator": "ekochnev@gmail.com", "creation_time": "2017-07-20T19:28:12Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 52671, "attachment_id": null, "text": "and ...\n2017-07-20 14:15:37,491 ERROR [chedulerFactoryBean#0_Worker-9] [shc.ecom.sywlocal.monitoring.HTTPReporter] - Got exception: \njavax.management.RuntimeOperationsException: Exception invoking method readBufSize\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:196)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:647)\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:678)\n\tat com.codahale.metrics.JmxAttributeGauge.getValue(JmxAttributeGauge.java:44)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.createMeasurementObject(HTTPReporter.java:123)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.createWebContainerData(HTTPReporter.java:363)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.createMeasurementObjects(HTTPReporter.java:151)\n\tat com.shc.ecom.sywlocal.monitoring.HTTPReporter.report(HTTPReporter.java:89)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.util.MethodInvoker.invoke(MethodInvoker.java:269)\n\tat org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean$MethodInvokingJob.executeInternal(MethodInvokingJobDetailFactoryBean.java:312)\n\tat org.springframework.scheduling.quartz.QuartzJobBean.execute(QuartzJobBean.java:114)\n\tat org.quartz.core.JobRunShell.run(JobRunShell.java:202)\n\tat org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:525)\nCaused by: java.lang.NullPointerException\n\tat org.apache.tomcat.util.net.SocketProperties.getRxBufSize(SocketProperties.java:272)\n\tat org.apache.tomcat.util.net.NioEndpoint.getReadBufSize(NioEndpoint.java:497)\n\tat sun.reflect.GeneratedMethodAccessor121.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.getAttribute(BaseModelMBean.java:189)\n\t... 16 more", "id": 199899, "time": "2017-07-20T19:34:53Z", "creator": "ekochnev@gmail.com", "creation_time": "2017-07-20T19:34:53Z", "is_private": false}, {"count": 5, "tags": [], "creator": "ekochnev@gmail.com", "attachment_id": null, "text": "More info ...\n\nIt happens when I try to get:\nThreadPool.ajp-nio-8009.readBufSize\nor\nThreadPool.ajp-nio-8009.writeBufSize\n\nThanks,\nEvgeny Kochnev", "id": 199900, "time": "2017-07-20T19:38:18Z", "bug_id": 52671, "creation_time": "2017-07-20T19:38:18Z", "is_private": false}]
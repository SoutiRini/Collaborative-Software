[{"count": 0, "tags": [], "bug_id": 51244, "text": "When compileing APR 1.4.4 with APR-UTIL 1.3.11 incorrect path to apr-util will be used (system apr under /usr/lib64). this was reproduced with apr 1.4.5 aswell. Bug isnt present in APR 1.4.2\n\nCompiling options:\n\nAPR:\n./configure --prefix=$/pkg/apache/2.2.18/apr --enable-threads --enable-dso --enable-other-child\n\nLD_LIBRARY_PATH is also set after compile:\nexport LD_LIBRARY_PATH=/pkg/products/apache/2.2.18/apr/lib\n\nAPR-UTIL:\n./configure --prefix=/pkg/apache/2.2.18/apr-util --enable-util-dso --with-apr=/pkg/apache/2.2.18/apr --with-apr-iconv=../apr-iconv --with-ldap=ldap \n\nLDD apache after compile with 1.4.2:\n\n[root@kbanhidy2 apache]# ldd /pkg/products/apache/2.2.18/bin/httpd\n        libm.so.6 => /lib64/libm.so.6 (0x00002b6ed4ed8000)\n        libaprutil-1.so.0 => /pkg/products/apache/2.2.18/apr-util/lib/libaprutil-1.so.0 (0x00002b6ed515b000)\n        libexpat.so.0 => /lib64/libexpat.so.0 (0x00002b6ed537c000)\n        libapr-1.so.0 => /pkg/products/apache/2.2.18/apr/lib/libapr-1.so.0 (0x00002b6ed559f000)\n        libuuid.so.1 => /lib64/libuuid.so.1 (0x00002b6ed57cb000)\n        librt.so.1 => /lib64/librt.so.1 (0x00002b6ed59cf000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00002b6ed5bd9000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00002b6ed5e11000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00002b6ed602c000)\n        libc.so.6 => /lib64/libc.so.6 (0x00002b6ed6231000)\n        /lib64/ld-linux-x86-64.so.2 (0x00002b6ed4cbb000)", "id": 146536, "attachment_id": null, "creator": "admin@szamuraj.com", "creation_time": "2011-05-23T09:13:06Z", "time": "2011-05-23T09:13:06Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51244, "text": "Can you please clarify:\n\n- which piece of software \"uses the wrong apr-util\" (e.g. httpd?)\n- how did you compile that software (configure line)\n- what does ldd show for that software with and without setting LD_LIBRARY_PATH\n- what does \"objdump -p\" show for that software, especially the entries \"NEEDED\" and \"RPATH\"\n\nRegards,\n\nRainer", "id": 146538, "time": "2011-05-23T09:35:21Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-05-23T09:35:21Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 51244, "attachment_id": null, "is_private": false, "id": 146540, "time": "2011-05-23T11:40:05Z", "creator": "admin@szamuraj.com", "creation_time": "2011-05-23T11:40:05Z", "text": "(In reply to comment #1)\n> Can you please clarify:\n> \n> - which piece of software \"uses the wrong apr-util\" (e.g. httpd?)\n> - how did you compile that software (configure line)\n> - what does ldd show for that software with and without setting LD_LIBRARY_PATH\n> - what does \"objdump -p\" show for that software, especially the entries\n> \"NEEDED\" and \"RPATH\"\n> \n> Regards,\n> \n> Rainer\n\nobjdump is:\n[root@kbanhidy2 apache]# objdump -p /pkg/products/apache/2.2.18/bin/httpd\n\n/pkg/products/apache/2.2.18/bin/httpd:     file format elf64-x86-64\n\nProgram Header:\n    PHDR off    0x0000000000000040 vaddr 0x0000000000000040 paddr 0x0000000000000040 align 2**3\n         filesz 0x00000000000001c0 memsz 0x00000000000001c0 flags r-x\n  INTERP off    0x0000000000000200 vaddr 0x0000000000000200 paddr 0x0000000000000200 align 2**0\n         filesz 0x000000000000001c memsz 0x000000000000001c flags r--\n    LOAD off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**21\n         filesz 0x00000000000674ac memsz 0x00000000000674ac flags r-x\n    LOAD off    0x0000000000068000 vaddr 0x0000000000268000 paddr 0x0000000000268000 align 2**21\n         filesz 0x0000000000004b60 memsz 0x0000000000007f80 flags rw-\n DYNAMIC off    0x00000000000693f0 vaddr 0x00000000002693f0 paddr 0x00000000002693f0 align 2**3\n         filesz 0x0000000000000230 memsz 0x0000000000000230 flags rw-\n    NOTE off    0x000000000000021c vaddr 0x000000000000021c paddr 0x000000000000021c align 2**2\n         filesz 0x0000000000000020 memsz 0x0000000000000020 flags r--\nEH_FRAME off    0x00000000000609c8 vaddr 0x00000000000609c8 paddr 0x00000000000609c8 align 2**2\n         filesz 0x0000000000001534 memsz 0x0000000000001534 flags r--\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**3\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\n\nDynamic Section:\n  NEEDED      libm.so.6\n  NEEDED      libaprutil-1.so.0\n  NEEDED      libexpat.so.0\n  NEEDED      libapr-1.so.0\n  NEEDED      libuuid.so.1\n  NEEDED      librt.so.1\n  NEEDED      libcrypt.so.1\n  NEEDED      libpthread.so.0\n  NEEDED      libdl.so.2\n  NEEDED      libc.so.6\n  RPATH       /pkg/products/apache/2.2.18/apr-util/lib:/usr/lib64:/pkg/products/apache/2.2.18/apr/lib\n  INIT        0x25b10\n  FINI        0x563d8\n  GNU_HASH    0x240\n  STRTAB      0x114b8\n  SYMTAB      0x3400\n  STRSZ       0x82f6\n  SYMENT      0x18\n  DEBUG       0x0\n  PLTGOT      0x269880\n  PLTRELSZ    0x1aa0\n  PLTREL      0x7\n  JMPREL      0x24070\n  RELA        0x1aab8\n  RELASZ      0x95b8\n  RELAENT     0x18\n  VERNEED     0x1aa68\n  VERNEEDNUM  0x2\n  VERSYM      0x197ae\n  RELACOUNT   0x1ae\n\nVersion References:\n  required from libpthread.so.0:\n    0x09691a75 0x00 04 GLIBC_2.2.5\n  required from libc.so.6:\n    0x0d696913 0x00 03 GLIBC_2.3\n    0x09691a75 0x00 02 GLIBC_2.2.5\n\n[root@kbanhidy2 apache]# ldd /pkg/products/apache/2.2.18/bin/httpd\n        libm.so.6 => /lib64/libm.so.6 (0x00002b00c162c000)\n        libaprutil-1.so.0 => /pkg/products/apache/2.2.18/apr-util/lib/libaprutil-1.so.0 (0x00002b00c18af000)\n        libexpat.so.0 => /lib64/libexpat.so.0 (0x00002b00c1ad0000)\n        libapr-1.so.0 => /usr/lib64/libapr-1.so.0 (0x00002b00c1cf3000)\n        libuuid.so.1 => /lib64/libuuid.so.1 (0x00002b00c1f1a000)\n        librt.so.1 => /lib64/librt.so.1 (0x00002b00c211e000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00002b00c2328000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00002b00c2560000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00002b00c277b000)\n        libc.so.6 => /lib64/libc.so.6 (0x00002b00c2980000)\n        /lib64/ld-linux-x86-64.so.2 (0x00002b00c140f000)\n\nWhen checking libaprutil-1.so I see following:\n\n[root@kbanhidy2 apache]# objdump -p /pkg/products/apache/2.2.18/apr-util/lib/libaprutil-1.so\n\n/pkg/products/apache/2.2.18/apr-util/lib/libaprutil-1.so:     file format elf64-x86-64\n\nProgram Header:\n    LOAD off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**21\n         filesz 0x000000000001f6e4 memsz 0x000000000001f6e4 flags r-x\n    LOAD off    0x000000000001f6e8 vaddr 0x000000000021f6e8 paddr 0x000000000021f6e8 align 2**21\n         filesz 0x0000000000000fc8 memsz 0x0000000000001090 flags rw-\n DYNAMIC off    0x000000000001fa18 vaddr 0x000000000021fa18 paddr 0x000000000021fa18 align 2**3\n         filesz 0x0000000000000210 memsz 0x0000000000000210 flags rw-\nEH_FRAME off    0x000000000001be34 vaddr 0x000000000001be34 paddr 0x000000000001be34 align 2**2\n         filesz 0x0000000000000bec memsz 0x0000000000000bec flags r--\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**3\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\n\nDynamic Section:\n  NEEDED      libexpat.so.0\n  NEEDED      libapr-1.so.0\n  NEEDED      libuuid.so.1\n  NEEDED      librt.so.1\n  NEEDED      libcrypt.so.1\n  NEEDED      libpthread.so.0\n  NEEDED      libdl.so.2\n  NEEDED      libc.so.6\n  SONAME      libaprutil-1.so.0\n  RPATH       /usr/lib64:/pkg/products/apache/2.2.18/apr/lib\n  INIT        0x7dc8\n  FINI        0x1a7c8\n  GNU_HASH    0x158\n  STRTAB      0x3570\n  SYMTAB      0xb28\n  STRSZ       0x2180\n  SYMENT      0x18\n  PLTGOT      0x21fcd0\n  PLTRELSZ    0x1830\n  PLTREL      0x7\n  JMPREL      0x6598\n  RELA        0x5ae8\n  RELASZ      0xab0\n  RELAENT     0x18\n  VERNEED     0x5a78\n  VERNEEDNUM  0x3\n  VERSYM      0x56f0\n  RELACOUNT   0x3c\n\nVersion References:\n  required from libpthread.so.0:\n    0x09691a75 0x00 05 GLIBC_2.2.5\n  required from libcrypt.so.1:\n    0x09691a75 0x00 04 GLIBC_2.2.5\n  required from libc.so.6:\n    0x0d696913 0x00 03 GLIBC_2.3\n    0x09691a75 0x00 02 GLIBC_2.2.5\n\n[root@kbanhidy2 apache]# ldd /pkg/products/apache/2.2.18/apr-util/lib/libaprutil-1.so\n        libexpat.so.0 => /lib64/libexpat.so.0 (0x00002aea8f545000)\n        libapr-1.so.0 => /usr/lib64/libapr-1.so.0 (0x00002aea8f767000)\n        libuuid.so.1 => /lib64/libuuid.so.1 (0x00002aea8f98e000)\n        librt.so.1 => /lib64/librt.so.1 (0x00002aea8fb93000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00002aea8fd9c000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00002aea8ffd4000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00002aea901f0000)\n        libc.so.6 => /lib64/libc.so.6 (0x00002aea903f4000)\n        /lib64/ld-linux-x86-64.so.2 (0x000000343be00000)\n\nSo hence problems with APR-UTIL.\n\nTested APR 1.4.2 with APR-UTIL 1.3.11 and 1.3.12, libapr-1.so is linked correctly.\nTested APR 1.4.4 with APR-UTIL 1.3.11 and 1.3.12, libapr-1.so is linked to /usr/lib64.\nTested APR 1.4.5 with APR-UTIL 1.3.11 libapr-1.so is linked to /usr/lib64.\n\nLDD -s same when Ld_LIBRARY_PATH is set and same when not set.\n\napr compile\n./configure --prefix=$home/$ver/apr --enable-threads --enable-dso --enable-other-child\n\napr-util compile\n./configure --prefix=$home/$ver/apr-util --enable-util-dso --with-apr=$home/$ver/apr --with-apr-iconv=../apr-iconv --with-ldap=ldap --with-ldap-lib=/usr/lib --with-ldap-include=/usr/include/\n\nhttpd compile\n./configure --prefix=$home/$ver --with-ldap --enable-pie --enable-modules=all --enable-MODULE=shared --enable-auth-anon --enable-auth-dbm --enable-auth-digest --enable-authnz-ldap --enable-cache --enable-cern-meta --enable-charset-lite --enable-dav --enable-dav-fs --enable-dav-lock --enable-deflate --enable-disk-cache --enable-expires --enable-ext-filter --enable-file-cache --enable-headers --enable-ldap --enable-logio --enable-mem-cache --enable-mime-magic --enable-isapi --enable-proxy --enable-proxy-ajp --enable-proxy-balancer --enable-proxy-connect --enable-proxy-ftp --enable-proxy-http --enable-rewrite --enable-so --enable-speling --enable-unique-id --enable-usertrack --enable-vhost-alias --enable-suexec --enable-ssl=shared --enable-ssl --with-apr=$home/$ver/apr --with-ssl=$home/$ver/openssl --with-apr-util=$home/$ver/apr-util --with-mpm=prefork --enable-mods-shared=all --enable-security"}, {"count": 3, "tags": [], "bug_id": 51244, "text": "Thank you, that helps.\n\nThe problem is, that apr-util has /usr/lib64 in its RPATH before anything else. Since apr-util is loaded first, it will then retrieve its own dependencies including apr from the system lib path.\n\nWe need to investigate, why /usr/lib64 is in the RPATH, and why it comes first. Unfortunately I could not reproduce your problem. Thus more questions:\n\nCan you please also provide the objdump output for the apr library?\n\nPlease also check, whether you find any indication of /usr/lib64 in build-1/apr_rules.mk or bin/apr-1-config or lib/libapr-1.la of the installed apr 1.4.5.\n\nYou might also have a look at config.log in the build directories of apr and apr-util.\n\nRegards,\n\nRainer", "id": 146542, "time": "2011-05-23T12:27:08Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-05-23T12:27:08Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "admin@szamuraj.com", "text": "objdump for libapr:\n[root@kbanhidy2 apache]# objdump -p /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.so.0\n\n/pkg/products/apache.test/2.2.18/apr/lib/libapr-1.so.0:     file format elf64-x86-64\n\nProgram Header:\n    LOAD off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**21\n         filesz 0x000000000002a72c memsz 0x000000000002a72c flags r-x\n    LOAD off    0x000000000002a730 vaddr 0x000000000022a730 paddr 0x000000000022a730 align 2**21\n         filesz 0x0000000000001128 memsz 0x0000000000001228 flags rw-\n DYNAMIC off    0x000000000002a8b0 vaddr 0x000000000022a8b0 paddr 0x000000000022a8b0 align 2**3\n         filesz 0x00000000000001e0 memsz 0x00000000000001e0 flags rw-\nEH_FRAME off    0x000000000002504c vaddr 0x000000000002504c paddr 0x000000000002504c align 2**2\n         filesz 0x000000000000126c memsz 0x000000000000126c flags r--\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**3\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\n\nDynamic Section:\n  NEEDED      libuuid.so.1\n  NEEDED      librt.so.1\n  NEEDED      libcrypt.so.1\n  NEEDED      libpthread.so.0\n  NEEDED      libdl.so.2\n  NEEDED      libc.so.6\n  SONAME      libapr-1.so.0\n  INIT        0xa9b0\n  FINI        0x23b88\n  GNU_HASH    0x158\n  STRTAB      0x4e80\n  SYMTAB      0xf08\n  STRSZ       0x2c37\n  SYMENT      0x18\n  PLTGOT      0x22ab30\n  PLTRELSZ    0x20b8\n  PLTREL      0x7\n  JMPREL      0x88f8\n  RELA        0x80b8\n  RELASZ      0x840\n  RELAENT     0x18\n  VERNEED     0x8008\n  VERNEEDNUM  0x3\n  VERSYM      0x7ab8\n  RELACOUNT   0x44\n\nVersion References:\n  required from libdl.so.2:\n    0x09691a75 0x00 08 GLIBC_2.2.5\n  required from libpthread.so.0:\n    0x09691972 0x00 05 GLIBC_2.3.2\n    0x09691a75 0x00 04 GLIBC_2.2.5\n    0x0d696914 0x00 03 GLIBC_2.4\n  required from libc.so.6:\n    0x09691973 0x00 09 GLIBC_2.3.3\n    0x0d696913 0x00 07 GLIBC_2.3\n    0x09691972 0x00 06 GLIBC_2.3.2\n    0x09691a75 0x00 02 GLIBC_2.2.5\n\n\nI did a recompile and moved everthing under apache.test, but same script and parameters are used.\n\nunder apr source doing search:\n\n[root@kbanhidy2 apr-1.4.5]# grep -R /usr/lib64/ .\n[root@kbanhidy2 apr-1.4.5]# grep -R libapr* .\n./libapr-1.la:# libapr-1.la - a libtool library file\n./.libs/libapr-1.la:# libapr-1.la - a libtool library file\n./.libs/libapr-1.lai:# libapr-1.la - a libtool library file\n[root@kbanhidy2 apr-1.4.5]#\n\n\nunder apr-util doing search:\n\n[root@kbanhidy2 apr-1.4.5]# grep -R /usr/lib64/ ../apr-util-1.3.11/\n../apr-util-1.3.11/libaprutil-1.la:dependency_libs=' -L/usr/lib /usr/lib64/libexpat.la /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\n../apr-util-1.3.11/.libs/libaprutil-1.la:dependency_libs=' -L/usr/lib /usr/lib64/libexpat.la /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\n../apr-util-1.3.11/.libs/libaprutil-1.lai:dependency_libs=' -L/usr/lib /usr/lib64/libexpat.la /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\n[root@kbanhidy2 apr-1.4.5]# grep -R libapr* ../apr-util-1.3.11/\n../apr-util-1.3.11/Makefile:APRUTIL_LIBS = -lexpat /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl\n../apr-util-1.3.11/config.status:S[\"APRUTIL_LIBS\"]=\"-lexpat /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl\"\n../apr-util-1.3.11/config.status:S[\"APR_LIBS\"]=\" /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt  -lpthread -ldl\"\n../apr-util-1.3.11/libaprutil-1.la:dependency_libs=' -L/usr/lib /usr/lib64/libexpat.la /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\n../apr-util-1.3.11/.libs/libaprutil-1.la:dependency_libs=' -L/usr/lib /usr/lib64/libexpat.la /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\n../apr-util-1.3.11/.libs/libaprutil-1.lai:dependency_libs=' -L/usr/lib /usr/lib64/libexpat.la /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\n../apr-util-1.3.11/config.log:APRUTIL_LIBS='-lexpat /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\n../apr-util-1.3.11/config.log:APR_LIBS=' /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt  -lpthread -ldl'\n../apr-util-1.3.11/test/Makefile:APRUTIL_LIBS = -lexpat /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl\n[root@kbanhidy2 apr-1.4.5]#\n\nlooking at config.log for apr-util:\n## ----------------- ##\n## Output variables. ##\n## ----------------- ##\n\nAPRUTIL_DOTTED_VERSION='1.3.11'\nAPRUTIL_EXPORT_LIBS='-lexpat'\nAPRUTIL_INCLUDES='-I/usr/include/'\nAPRUTIL_LDFLAGS='-L/usr/lib'\nAPRUTIL_LIBNAME='aprutil-${APRUTIL_MAJOR_VERSION}'\nAPRUTIL_LIBS='-lexpat /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl'\nAPRUTIL_MAJOR_VERSION='1'\nAPRUTIL_PRIV_INCLUDES='-I/tmp/tmp.ztkYfC3285/apr-util-1.3.11/include -I/tmp/tmp.ztkYfC3285/apr-util-1.3.11/include/private'\nAPR_BUILD_DIR='/pkg/products/apache.test/2.2.18/apr/build-1'\nAPR_ICONV_DIR=''\nAPR_INCLUDES=' -I/pkg/products/apache.test/2.2.18/apr/include/apr-1 '\nAPR_LIBS=' /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.la -luuid -lrt -lcrypt  -lpthread -ldl'\nAPR_XML_DIR=''\nAPU_CONFIG_LOCATION='source'\nAPU_DSO_LIBDIR='${libdir}/apr-util-1'\nAPU_HAVE_MODULES='yes'\nAPU_LTVERSION='-version-info 3:11:3'\nAPU_MODULES='  ldap/apr_ldap.la'\n\nsee no errors exit is 0.\n\nI only found one reference to lib64 in apr config.log\n\nlt_cv_sys_global_symbol_to_c_name_address='sed -n -e '\\''s/^: \\([^ ]*\\) $/  {\\\"\\1\\\", (lt_ptr) 0},/p'\\'' -e '\\''s/^[BCDEGRST] \\([^ ]*\\) \\([^ ]*\\)$/  {\"\\2\", (lt_ptr) \\&\\2},/p'\\'''\nlt_cv_sys_global_symbol_to_cdecl='sed -n -e '\\''s/^. .* \\(.*\\)$/extern int \\1;/p'\\'''\nlt_cv_sys_lib_dlsearch_path_spec='/lib /usr/lib /samba/arch/lib '\nlt_cv_sys_lib_search_path_spec='/usr/lib/gcc/x86_64-redhat-linux/4.1.2 /usr/lib64 /lib64'\nlt_cv_sys_max_cmd_len=98304\nlt_lt_cv_prog_compiler_c_o='\"yes\"'\nlt_lt_cv_prog_compiler_c_o_CXX='\"yes\"'\n\n\nlooking at installed folder:\n\n[root@kbanhidy2 apr-1.4.5]# grep -R /usr/lib64 /pkg/products/apache.test/2.2.18/apr/\n/pkg/products/apache.test/2.2.18/apr/build-1/libtool:sys_lib_search_path_spec=\"/usr/lib/gcc/x86_64-redhat-linux/4.1.2 /usr/lib64 /lib64\"\n/pkg/products/apache.test/2.2.18/apr/build-1/libtool:sys_lib_search_path_spec=\"/usr/lib/gcc/x86_64-redhat-linux/4.1.2 /usr/lib64 /lib64\"\n[root@kbanhidy2 apr-1.4.5]#\n\n[root@kbanhidy2 apr-1.4.5]# ldd /pkg/products/apache.test/2.2.18/apr/lib/libapr-1.so.0\n        libuuid.so.1 => /lib64/libuuid.so.1 (0x00002aced1198000)\n        librt.so.1 => /lib64/librt.so.1 (0x00002aced139c000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00002aced15a5000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00002aced17de000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00002aced19f9000)\n        libc.so.6 => /lib64/libc.so.6 (0x00002aced1bfd000)\n        /lib64/ld-linux-x86-64.so.2 (0x000000343be00000)\n\n\nRegards\nKrisztian", "id": 146547, "time": "2011-05-23T14:15:53Z", "bug_id": 51244, "creation_time": "2011-05-23T14:15:53Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 51244, "is_private": false, "text": "Thanks again. Although the dependency on /usr/lib64 could also be give in one of the files as usr/lib, it seems it does not come from apr but instead apr-util.\n\nYou configure line gives /usr/lib as an explicit path to ldap, maybe there's a problem there. Would it be easy for you to recompile with giving the ldap flags (just to check, whether the /usr/lib64 entry in the RPATH in the apr util library file comes from that?\n\nWould it be possible to provide a tarball with the complete build directory of your apr 1.4.5 and apr-util 1.3.11 for download?\n\nRegards,\n\nRainer", "id": 146548, "time": "2011-05-23T14:25:40Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-05-23T14:25:40Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 51244, "is_private": false, "id": 146574, "attachment_id": null, "creator": "admin@szamuraj.com", "creation_time": "2011-05-24T07:02:08Z", "time": "2011-05-24T07:02:08Z", "text": "Of course it is possible, compile has been done, I was guessing wou wanted a compile without ldap flags, since previously it was specified.\n\n[root@kbanhidy2 apache]# ldd /tmp/bug51244/apr-util/lib/libaprutil-1.so\n        libexpat.so.0 => /lib64/libexpat.so.0 (0x00002ad3b3fdd000)\n        libapr-1.so.0 => /usr/lib64/libapr-1.so.0 (0x00002ad3b41ff000)\n        libuuid.so.1 => /lib64/libuuid.so.1 (0x00002ad3b4426000)\n        librt.so.1 => /lib64/librt.so.1 (0x00002ad3b462b000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00002ad3b4834000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00002ad3b4a6c000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00002ad3b4c88000)\n        libc.so.6 => /lib64/libc.so.6 (0x00002ad3b4e8c000)\n        /lib64/ld-linux-x86-64.so.2 (0x000000343be00000)\n\n 1013  /tmp/krisz/apr-1.4.5/configure --prefix=/tmp/bug51244/apr --enable-threads --enable-dso --enable-other-child\n\n 1017  /tmp/krisz/apr-util-1.3.11/configure --prefix=/tmp/bug51244/apr-util --enable-util-dso --with-apr=/tmp/bug51244/apr/\n\nupload has been done:\nhttps://www.transferbigfiles.com/c9044d75-48bb-421d-be15-187e00982877?rid=tKzgvtwxXgkgwp8ljw2dEw%3d%3d\n\nmomentarly only place I could upload it."}, {"count": 7, "attachment_id": null, "creator": "admin@szamuraj.com", "is_private": false, "id": 146756, "time": "2011-05-31T08:10:48Z", "bug_id": 51244, "creation_time": "2011-05-31T08:10:48Z", "tags": [], "text": "Any updates on bug?"}, {"count": 8, "tags": [], "bug_id": 51244, "attachment_id": null, "text": "I believe /usr/lib64 is added to RPATH as a result of a search for libexpat, although I don't understand the details.  I think you can work around the issue by using the --with-expat=builtin option of configure for aprutil.", "id": 148234, "time": "2011-07-27T20:48:52Z", "creator": "tsteven4@gmail.com", "creation_time": "2011-07-27T20:48:52Z", "is_private": false}, {"count": 9, "tags": [], "text": "(In reply to comment #8)\n> by using the --with-expat=builtin option of configure for aprutil.\n\nThanks, solved it for me :)\n\nHad the same problem: need to deploy two different apr-releases on the same server. It definetely is a -rpath issue. \n\nSolved this temporarily using LD_PRELOAD, because this variable is processed by ld.so before -rpath. LD_LIBRARY_PATH etc. has no effect, because of -rpath.", "is_private": false, "id": 149063, "creator": "matthias.ehrmann@bamf.bund.de", "time": "2011-09-07T12:10:17Z", "bug_id": 51244, "creation_time": "2011-09-07T12:10:17Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 51244, "attachment_id": null, "is_private": false, "id": 149065, "time": "2011-09-07T12:34:50Z", "creator": "admin@szamuraj.com", "creation_time": "2011-09-07T12:34:50Z", "text": "(In reply to comment #8)\n> I believe /usr/lib64 is added to RPATH as a result of a search for libexpat,\n> although I don't understand the details.  I think you can work around the issue\n> by using the --with-expat=builtin option of configure for aprutil.\n\nHello,\n\n\nAccording to our investigations, that didnt solve the problem.\n\nThe problem lies when adding support with ldap. While libldap is used before expat, it explicitly adds the -L/usr/lib  LDFLAG, and thus when arriving to expat, it finds the incorrect libexpat.\n\nfor some reason when using the --with-expat=builtin we get same behaviour."}, {"count": 11, "attachment_id": null, "creator": "matthias.ehrmann@bamf.bund.de", "is_private": false, "id": 149067, "time": "2011-09-07T12:46:18Z", "bug_id": 51244, "creation_time": "2011-09-07T12:46:18Z", "tags": [], "text": "From my side: no explicit usage of ldap. Only use an own libiconv\n\nMy configure call that works:\n\n./configure --prefix=%{TARGET_DIR} \\\n            --with-apr=%{TARGET_DIR}/bin/apr-1-config \\\n            --with-iconv=%{TARGET_DIR} \\\n            --with-expat=builtin"}, {"count": 12, "tags": [], "bug_id": 51244, "attachment_id": null, "text": "Forgot: \nThe configure call only produces a rpath-polluted libaprutil.sp if --with-expat=inbuilt is omitted", "id": 149068, "time": "2011-09-07T12:49:39Z", "creator": "matthias.ehrmann@bamf.bund.de", "creation_time": "2011-09-07T12:49:39Z", "is_private": false}, {"count": 13, "attachment_id": null, "creator": "admin@szamuraj.com", "text": "(In reply to comment #12)\n> Forgot: \n> The configure call only produces a rpath-polluted libaprutil.sp if\n> --with-expat=inbuilt is omitted\n\nCurrently our config options that have solved the problem:\n\n./configure --disable-example --disable-version --enable-MODULE=shared --enable-auth-anon --enable-auth-dbm \\\n\t--enable-auth-digest --enable-authnz-ldap --enable-cache --enable-cern-meta --enable-charset-lite --enable-dav \\\n\t--enable-dav-fs --enable-dav-lock --enable-deflate --enable-disk-cache --enable-expires --enable-ext-filter \\\n\t--enable-file-cache --enable-headers --enable-info --enable-isapi --enable-ldap --enable-logio --enable-log-config \\\n\t--enable-log-forensic --enable-logio --enable-mem-cache --enable-mime-magic --enable-mods-shared=all --enable-modules=all \\\n\t--enable-nonportable-atomics=yes --enable-pie --enable-proxy --enable-proxy-ajp --enable-proxy-balancer \\\n\t--enable-proxy-connect --enable-proxy-ftp --enable-proxy-http --enable-rewrite --enable-security --enable-so \\\n\t--enable-speling --enable-ssl=shared --enable-static-support --enable-substitute --enable-suexec --enable-unique-id \\\n\t--enable-usertrack --enable-vhost-alias --prefix=$xxx/prefork --with-apr-util=$xxx/apr-util \\\n\t--with-apr=$xxx/apr --with-ldap --with-mpm=prefork --with-pcre=$xxx/pcre --with-ssl=$xxx/openssl\n\nAlso we have included into the compile our own versions of the following applications:\nApache=\"2.2.19\"\nAPR=\"1.4.2\"\nAPR iconv=\"1.2.1\"\nAPR Util==\"1.3.9\"\nOpenssl=\"1.0.0d\"\nLibiconv=\"1.13.1\"\nlibxml2=\"2.7.8\"\nmod_secucrity2=\"2.5.13\"\npcre=\"8.12\"\nmod_jk=\"1.2.31\"\ncurl=\"7.21.6\"\nexpat=\"2.0.1\"\nopenldap=\"2.4.23\"\nkrb5=\"1.9.1\"\nmod_kerb=\"5.4\"\nperl=\"5.10.1\"\nmod_perl=\"2.0.5\"\nphp=\"5.3.6\"\nlibjpeg=\"8c\"\nlibpng=\"1.5.4\"\nicu=\"4_8_1\"\nmcrypt=\"2.5.7\"\nimap=\"2007f\"\noci=\"11.2.0.2.0\"\nocishort=\"11_2\"\n\nWe have compiled all these as since our installation needs them on deployed systems.\n\nAlso expat compile is done before apr-util compile and the options for apr-util is:  \n\n./configure --prefix=$xxx/apr-util --enable-util-dso --with-apr=$xxx/apr --with-apr-iconv=../apr-iconv \\\n\t--with-ldap=ldap --with-ldap-lib=$xxx/ldap/lib --with-ldap-include=$xxx/ldap/include \\\n\t--with-expat=$xxx/expat --without-pgsql --without-mysql --without-odbc --without-oracle --without-sqlite2 \\\n\t--without-sqlite3 --without-berkeley-db --without-oracle --without-freetds\n\nAfter these changes compile goes without error.", "id": 149070, "time": "2011-09-07T13:13:23Z", "bug_id": 51244, "creation_time": "2011-09-07T13:13:23Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "bug_id": 51244, "is_private": false, "text": "This annoying issue still exists in v1.5.1. Here the tail from my try to build this mess:\n\n/bin/sh /opt/eldk/powerpc/sysroots/powerpc-linux/usr/build-1/libtool --silent --mode=link  powerpc-linux-gcc -pthread  -m32 -mhard-float  --sysroot=/opt/eldk-5.1/powerpc/sysroots/powerpc-linux -DHAVE_CONFIG_H -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE  -m32 -mhard-float  --sysroot=/opt/eldk-5.1/powerpc/sysroots/powerpc-linux -I/home/jddev/czsensor-development/czsensor-libraries/apr-util-1.5.1/include -I/home/jddev/czsensor-development/czsensor-libraries/apr-util-1.5.1/include/private  -I/opt/eldk/powerpc/sysroots/powerpc-linux/usr/include/apr-1  -I/home/jddev/czsensor-development/czsensor-libraries/apr-util-1.5.1/xml/expat/lib  -version-info 5:1:5   --sysroot=/opt/eldk-5.1/powerpc/sysroots/powerpc-linux -o libaprutil-1.la -rpath /opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib buckets/apr_brigade.lo buckets/apr_buckets.lo buckets/apr_buckets_alloc.lo buckets/apr_buckets_eos.lo buckets/apr_buckets_file.lo buckets/apr_buckets_flush.lo buckets/apr_buckets_heap.lo buckets/apr_buckets_mmap.lo buckets/apr_buckets_pipe.lo buckets/apr_buckets_pool.lo buckets/apr_buckets_refcount.lo buckets/apr_buckets_simple.lo buckets/apr_buckets_socket.lo crypto/apr_crypto.lo crypto/apr_md4.lo crypto/apr_md5.lo crypto/apr_passwd.lo crypto/apr_sha1.lo crypto/crypt_blowfish.lo crypto/getuuid.lo crypto/uuid.lo dbd/apr_dbd.lo dbm/apr_dbm.lo dbm/apr_dbm_sdbm.lo dbm/sdbm/sdbm.lo dbm/sdbm/sdbm_hash.lo dbm/sdbm/sdbm_lock.lo dbm/sdbm/sdbm_pair.lo encoding/apr_base64.lo hooks/apr_hooks.lo ldap/apr_ldap_stub.lo ldap/apr_ldap_url.lo memcache/apr_memcache.lo misc/apr_date.lo misc/apr_queue.lo misc/apr_reslist.lo misc/apr_rmm.lo misc/apr_thread_pool.lo misc/apu_dso.lo misc/apu_version.lo strmatch/apr_strmatch.lo uri/apr_uri.lo xlate/xlate.lo xml/apr_xml.lo    -luuid -lrt -lcrypt  -lpthread  /home/jddev/czsensor-development/czsensor-libraries/apr-util-1.5.1/xml/expat/libexpat.la              /opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libapr-1.la -luuid -lrt -lcrypt -lpthread\n/bin/grep: /usr/lib/libuuid.la: No such file or directory\n/bin/sed: can't read /usr/lib/libuuid.la: No such file or directory\nlibtool: link: `/usr/lib/libuuid.la' is not a valid libtool archive\nmake[1]: *** [libaprutil-1.la] Error 1\nmake[1]: Leaving directory `/home/jddev/czsensor-development/czsensor-libraries/apr-util-1.5.1'\nmake: *** [all-recursive] Error 1\n\n\nSearching for the library at the correct place in cross toolchanin gives the expected result:\n\n~$ ls /opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libuuid*\n/opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libuuid.a   /opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libuuid.so    /opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libuuid.so.1.2\n/opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libuuid.la  /opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libuuid.so.1  /opt/eldk/powerpc/sysroots/powerpc-linux/usr/lib/libuuid.so.1.3.0\n\n\nObviously configure script does set the library paths incorrect and does ignore LDFLAGS.\n\nBecause this bug is rather old and apr-utils is still unusable on non-intel platform I set this issue to blocker and raise the importance level.", "id": 164183, "time": "2012-12-20T16:09:14Z", "creator": "kirsche40@gmx.de", "creation_time": "2012-12-20T16:09:14Z", "attachment_id": null}]
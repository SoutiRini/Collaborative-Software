[{"count": 0, "tags": [], "bug_id": 40580, "attachment_id": null, "id": 94000, "time": "2006-09-22T11:55:02Z", "creator": "janekdb@gmail.com", "creation_time": "2006-09-22T11:55:02Z", "is_private": false, "text": "Note: the version select list in ASF Bugzilla is missing 5.5.17 so I choose\nNightly Build instead.\n\nMy web-app is being supplied with the wrong ServletContext when the path is not\n/. In general it is getting a different ServletContext for each path, but each\npath gets the same ServletContext.\n\nTo check this the method \"dump\" dumps the attributes of the ServletContext\nobject and it's id.\n\nWhen the method \"dump\" is invoked when requesting /index.html this dumped,\n\ndump start\ndump: application: org.apache.catalina.core.ApplicationContextFacade@1953685\ndump: application: 26556037\ndump: org.apache.catalina.jsp_classpath\ndump: javax.servlet.context.tempdir\ndump: intl-channel-attribute\ndump: service-locator-default\ndump: service-locator-intl-chid\ndump: org.apache.catalina.resources\ndump: org.apache.catalina.WELCOME_FILES\ndump end\n\nThis is the \"dump\" method,\n\n\tprivate static void dump(ServletContext application) {\n\t\tSystem.out.println(\"dump start\");\n\t\tSystem.out.println(\"dump: application: \" + application.toString());\n\t\tSystem.out.println(\"dump: application: \" + System.identityHashCode(application));\n\n\t\tfor (Enumeration e = application.getAttributeNames(); e.hasMoreElements();) {\n\t\t\tString attrName = (String) e.nextElement();\n\t\t\tSystem.out.println(\"dump: \" + attrName);\n\t\t}\n\t\tSystem.out.println(\"dump end\");\n\t}\n\nHOWEVER when a different path is requested the ServletContext is different and\nhas lost the attributes that were set on it, This is what I got when requesting\n/search/search.html\n\ndump start\ndump: application: org.apache.catalina.core.ApplicationContextFacade@1a4dd95\ndump: application: 27581845\ndump: org.apache.catalina.jsp_classpath\ndump: javax.servlet.context.tempdir\ndump: org.apache.catalina.resources\ndump: org.apache.catalina.WELCOME_FILES\ndump end\n\nIn general different paths give different ServletContext and only /index.html\ngives the ServletContext as it was initialised by the ServletContextListener.\n\nI do not have this problem with 5.5.12.\n\nThe web-app is deployed as a directory containing WEB-INF, index.html etc\n\njsp> ls -d1 intl/W* intl/i* intl/search/search.html\nintl/index.html\nintl/search/search.html\nintl/WEB-INF\n\nThis is the <Host> element\n\n      <Host name=\"intl.development\" debug=\"0\" appBase=\"/opt/xl/web/jsp/intl\"\n       unpackWARs=\"false\" autoDeploy=\"false\" liveDeploy=\"false\">\n        <Context path=\"\" docBase=\"\" debug=\"0\" allowLinking=\"true\" />\n      </Host>\n\nWhat has changed between 5.5.12 and 5.5.17 to cause this and can I prevent it?"}, {"text": "This is because you are using an invalid and unsupported configuration that only\never worked by chance in previous versions. Fixes to various bugs now mean this\nconfiguration doesn't work.\n\ndocBase should never be the same as appBase. You need to move the contents of\n/opt/xl/web/jsp/intl to /opt/xl/web/jsp/intl/ROOT and change your configuration to:\n\n<Host name=\"intl.development\" debug=\"0\" appBase=\"/opt/xl/web/jsp/intl\"\n       unpackWARs=\"false\" autoDeploy=\"false\" liveDeploy=\"false\">\n        <Context docBase=\"ROOT\" debug=\"0\" allowLinking=\"true\" />\n</Host>\n\nI'd be interested in where you got this configuration from. Lots of people have\nthe same problem and I can't see anything in the Tomcat docs that says to do it\nlike this.", "tags": [], "bug_id": 40580, "attachment_id": null, "count": 1, "id": 94001, "time": "2006-09-22T12:02:44Z", "creator": "markt@apache.org", "creation_time": "2006-09-22T12:02:44Z", "is_private": false}, {"count": 2, "tags": [], "creator": "janekdb@gmail.com", "text": "Thanks. I will look at updating my configuration.\n\nThis configuration is what I have been using since Tomcat 4.0. I cannot remember\nthe exact place the configuration came from.\n", "id": 94004, "time": "2006-09-22T13:16:04Z", "bug_id": 40580, "creation_time": "2006-09-22T13:16:04Z", "is_private": false, "attachment_id": null}]
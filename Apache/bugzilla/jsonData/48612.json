[{"count": 0, "tags": [], "text": "When I stop Tomcat, I get the following error message:\n\n2010-01-25 14:33:52,891 ERROR [org.apache.catalina.mbeans.ServerLifecycleListener] destroyMBeans: Throwable\njavax.management.MalformedObjectNameException: Cannot create object name for org.apache.catalina.connector.Connector@1d49247 java.lang.ClassCastException: java.net.Inet4Address cannot be cast to java.lang.String\n  at org.apache.catalina.mbeans.MBeanUtils.createObjectName(MBeanUtils.java:758)\n  at org.apache.catalina.mbeans.MBeanUtils.destroyMBean(MBeanUtils.java:1412)\n  at org.apache.catalina.mbeans.ServerLifecycleListener.destroyMBeans(ServerLifecycleListener.java:678)\n  at org.apache.catalina.mbeans.ServerLifecycleListener.destroyMBeans(ServerLifecycleListener.java:1005)\n  at org.apache.catalina.mbeans.ServerLifecycleListener.destroyMBeans(ServerLifecycleListener.java:971)\n  at org.apache.catalina.mbeans.ServerLifecycleListener.lifecycleEvent(ServerLifecycleListener.java:154)\n  at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n  at org.apache.catalina.core.StandardServer.stop(StandardServer.java:748)\n  at org.apache.catalina.startup.Catalina.stop(Catalina.java:643)\n  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  at java.lang.reflect.Method.invoke(Method.java:597)\n  at org.apache.catalina.startup.Bootstrap.stop(Bootstrap.java:301)\n  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  at java.lang.reflect.Method.invoke(Method.java:597)\n  at org.apache.commons.daemon.support.DaemonLoader.stop(DaemonLoader.java:200)\n\nThere are actually 2 errors here; the problem that is causing the exception shown above, and the fact that the catch block that logs the exception is swallowing the original exception and stack trace.\n\nI changed:\n\n} catch (Exception e) {\n  throw new MalformedObjectNameException(\"Cannot create object name for \" + connector + e);\n}\n\nto\n\n} catch (Exception e) {\n   MalformedObjectNameException tim = new MalformedObjectNameException\n       (\"Cannot create object name for \" + connector);\n   tim.initCause(e);\n   throw tim;\n}\n\nand determined the actual cause of the exception:\n\nCaused by: java.lang.ClassCastException: java.net.Inet4Address cannot be cast to java.lang.String\n  at org.apache.catalina.mbeans.MBeanUtils.createObjectName(MBeanUtils.java:745)\n\nMBeanUtils.java line 745 looks like this:\n\nString address = (String)\n                IntrospectionUtils.getProperty(connector, \"address\");\n\nThe \"address\" property on the Http 1.1 connector is indeed of type Inet4Address, and not of type String.  In the Tomcat 6.0.20 source, the line above was wrapped inside of the following check:\n\nif (connector.getClass().getName().indexOf(\"CoyoteConnector\") >= 0 ) {\n\non line 737.  In the Tomcat 6.0.24 source, this check was removed, and this causes the exception reported above.\n\nHere is my <Connector> element from my server.xml if that helps:\n\n<Connector allowTrace=\"false\" emptySessionPath=\"false\" enableLookups=\"false\" maxPostSize=\"2097152\" maxSavePostSize=\"4096\" redirectPort=\"-1\" scheme=\"http\" secure=\"false\" URIEncoding=\"UTF-8\" acceptCount=\"100\" address=\"0.0.0.0\" bufferSize=\"2048\" compressableMimeType=\"text/html,text/xml,text/plain\" compression=\"off\" connectionLinger=\"-1\" connectionTimeout=\"20000\" disableUploadTimeout=\"true\" maxHttpHeaderSize=\"8192\" maxKeepAliveRequests=\"1\" maxSpareThreads=\"50\" maxThreads=\"200\" minSpareThreads=\"4\" noCompressionUserAgents=\"\" port=\"4080\" restrictedUserAgents=\"\" socketBuffer=\"9000\" strategy=\"ms\" tcpNoDelay=\"true\" threadPriority=\"java.lang.Thread#NORM_PRIORITY\" server=\"Apache\"/>", "attachment_id": null, "id": 133908, "creator": "tmccune@yahoo-inc.com", "time": "2010-01-25T14:44:47Z", "bug_id": 48612, "creation_time": "2010-01-25T14:44:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 48612, "is_private": false, "text": "This was already fixed in trunk by the fix for bug48424. I have fixed the swallowed exception in trunk and proposed both fixes for 6.0.x", "id": 134109, "time": "2010-02-01T09:40:44Z", "creator": "markt@apache.org", "creation_time": "2010-02-01T09:40:44Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 48612, "is_private": false, "id": 134638, "time": "2010-02-18T10:47:55Z", "creator": "markt@apache.org", "creation_time": "2010-02-18T10:47:55Z", "tags": [], "text": "This has been fixed in 6.0.x and will be included in 6.0.25 onwards."}]
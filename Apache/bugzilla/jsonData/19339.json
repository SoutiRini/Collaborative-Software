[{"count": 0, "tags": [], "bug_id": 19339, "is_private": false, "id": 36155, "creation_time": "2003-04-25T21:23:29Z", "time": "2003-04-25T21:23:29Z", "creator": "andrew_walduck@hotmail.com", "text": "Hi...\n\nThe default mode for stdin in a VC++ 5.0 C cgi-bin executable is TEXT. On a \n<form> with type=multipart/form-data this results in the 0x0D 0x0A character \nsequences being mapped to one character only. As result the following code \ndoesn't work. The CONTENT_LENGTH is off from the actual number read by the \nnumber of 0x0D 0x0A pairs that have been converted. Is there a server based \nsolution for this?\n\nCheers.\nAndrew Walduck\n\n    char* content_length_string;\n    content_length_string = getenv(\"CONTENT_LENGTH\");\n    if(content_length_string != 0)\n    {\n      size_t content_length;\n      content_length = strtoul(content_length_string, 0, 10);\n      if(content_length != 0)\n      {\n        FILE* fp;\n        char* buffer;\n        fp = fopen(\"C:/tmp/CONTENT.txt\", \"wb\");\n        buffer = (char*) malloc(content_length);\n        if(buffer != 0)\n        {\n\n          fread(buffer, 1, content_length, stdin);\n          fwrite(buffer, 1, content_length, fp);\n        }\n        fclose(fp);\n      }\n    }", "attachment_id": null}, {"count": 1, "tags": [], "creator": "andrew_walduck@hotmail.com", "is_private": false, "text": "I've changed the priority to high. There is no real working around on the cgi \nside. The only work around is on the server. The cgi-bin stdin (VC++ 5.0) is \nreplacing 0x0D 0x0A sequences with 0x0A only. The only work around is to byte \nstuff the entire data stream being sent to the client during a form upload of \ntype multipart/form-data but use the original CONTENT_LENGTH. The server needs \nto look at the CONTENT_TYPE environment variable and if it is multipart/form-\ndata convert all 0x0D 0x0A sequences to 0x0D 0x0D 0x0A. A configuration flag \nwill need to be added to turn this behaviour on and off as different compilers \nmay read stdin in binary vs text mode. \n", "id": 36159, "time": "2003-04-26T03:49:00Z", "bug_id": 19339, "creation_time": "2003-04-26T03:49:00Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "andrew_walduck@hotmail.com", "is_private": false, "id": 36162, "time": "2003-04-26T05:35:32Z", "bug_id": 19339, "creation_time": "2003-04-26T05:35:32Z", "tags": [], "text": "I figured out how to change the stdin mode on windows to be binary...\nDo the following:\n#ifdef _WIN32\n#include <io.h>\n#include <fcntl.h>\n#endif\n\n#ifdef _WIN32\n  _setmode(_fileno(stdin), _O_BINARY);\n#endif\nThat turns off the CRLF mapping.\n\nWhat a bozo I am... I had to read the Microsoft C library source to figure it \nout... blech.\n"}]
[{"count": 0, "tags": [], "text": "If your custom realm extends RealmBase but uses a custom principal, just like mine, you need to duplicate the entire #hasRole(Wrapper, Princpal, String) method.\n\nThe only interesting part for an implementor is\n!(principal instanceof GenericPrincipal)\nand\nGenericPrincipal gp = (GenericPrincipal) principal;\nboolean result = gp.hasRole(role);\n\nA verbatim copy of the method is need just to adapt three lines. Which basically means to double-check every Tomcat release for changes in this method.\n\nI am proposing to introduce a new sub-method: hasRoleInternal(Wrapper, Principal, String) (or alike) which performs just the code above. The entire boilerplate code remains in #hasRole()\n\nMy custom realm would simply do:\n\npublic boolean hasRoleInternal(Wrappr wrapper, Principal principal, String role) {\n  if(!(principal instanceof CustomPrincipal))\n    return false;\n\n  CustomPrincipal cp = (CustomPrincipal) principal;\n  return cp.hasRole(role);\n}\n\nI can provide a patch for that if you agree with.", "is_private": false, "id": 195459, "creator": "1983-01-06@gmx.net", "time": "2016-12-12T13:20:19Z", "bug_id": 60469, "creation_time": "2016-12-12T13:20:19Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 60469, "text": "I disagree, it's not worth changing the API for it and it's worse than \"checking for changes\" which actually never happens.\nBTW, this is an \"enhancement\", not a \"major\" bug.", "count": 1, "id": 195460, "time": "2016-12-12T13:23:40Z", "creator": "remm@apache.org", "creation_time": "2016-12-12T13:23:40Z", "is_private": false}, {"count": 2, "tags": [], "creator": "1983-01-06@gmx.net", "is_private": false, "text": "(In reply to Remy Maucherat from comment #1)\n> I disagree, it's not worth changing the API for it and it's worse than\n> \"checking for changes\" which actually never happens.\n> BTW, this is an \"enhancement\", not a \"major\" bug.\n\nWhy do you close this issue without having a discussion first?\n\nNo one is changing the API. You can still continue to override #hasRole(), it will have the same effect. The change can happen and are not a part of an API at at all. The code of RealmBase#hasRole() is implementation specific, not to be known to the user at best.", "id": 195461, "time": "2016-12-12T13:32:50Z", "bug_id": 60469, "creation_time": "2016-12-12T13:32:50Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 60469, "is_private": false, "count": 3, "id": 196900, "time": "2017-02-10T09:53:11Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-02-10T09:53:11Z", "text": "Anyone else care to share an opinion on that?"}, {"count": 4, "tags": [], "creator": "chris@christopherschultz.net", "is_private": false, "text": "Feel free to post a patch. I think it's a reasonable change.", "id": 196913, "time": "2017-02-10T18:50:04Z", "bug_id": 60469, "creation_time": "2017-02-10T18:50:04Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "1983-01-06@gmx.net", "text": "(In reply to Christopher Schultz from comment #4)\n> Feel free to post a patch. I think it's a reasonable change.\n\nThanks, I will prepare one next week.", "id": 196931, "time": "2017-02-11T11:01:45Z", "bug_id": 60469, "creation_time": "2017-02-11T11:01:45Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 60469, "attachment_id": null, "is_private": false, "id": 197426, "time": "2017-03-03T14:25:18Z", "creator": "markt@apache.org", "creation_time": "2017-03-03T14:25:18Z", "text": "Fixed in:\n- trunk for 9.0.0.M18 onwards\n- 8.5.x for 8.5.12 onwards"}, {"count": 7, "tags": [], "bug_id": 60469, "attachment_id": null, "text": "(In reply to Mark Thomas from comment #6)\n> Fixed in:\n> - trunk for 9.0.0.M18 onwards\n> - 8.5.x for 8.5.12 onwards\n\nPer(In reply to Mark Thomas from comment #6)\n> Fixed in:\n> - trunk for 9.0.0.M18 onwards\n> - 8.5.x for 8.5.12 onwards\n\nPerfect, couldn't be better. Thank you!", "id": 197442, "time": "2017-03-03T20:22:12Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-03-03T20:22:12Z", "is_private": false}]
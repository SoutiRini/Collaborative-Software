[{"count": 0, "tags": [], "bug_id": 59913, "attachment_id": 34081, "is_private": false, "id": 192720, "time": "2016-07-30T02:23:28Z", "creator": "dopey@moonteeth.com", "creation_time": "2016-07-30T02:23:28Z", "text": "Created attachment 34081\nExample webapp\n\nI have a really simply example (courtesy of the developer that discovered this issue) at:\nhttps://dl.dropboxusercontent.com/u/24563006/TestApp.war\n\nIt contains a test.jsp that does:\n\n<%\n   String href= \"/WEB-INF/jsp/test/test1.jsp\";\n   RequestDispatcher rd = request.getRequestDispatcher(href);\n   rd.forward(request, response);\n%>\n\ntest1.jsp simply dumps out all the attributes and then:\n<jsp:include page=\"/WEB-INF/jsp/test/test2.jsp\" />\n\nand test2.jsp dumps out attributes again.\n\nIn tomcat 8.0.36 the output of\nhttp://server/TestApp/test.jsp is:\n\nYou are in test1.jsp \n\ntest1 inRequest org.apache.catalina.core.ApplicationHttpRequest@22f9afc4\ntest1 inRequest.getServletPath() /WEB-INF/jsp/test/test1.jsp\njavax.servlet.forward.request_uri :: /TestApp/test.jsp\njavax.servlet.forward.context_path :: /TestApp\njavax.servlet.forward.servlet_path :: /test.jsp\n\n\n\nYou are in test2.jsp \n\ntest2 inRequest org.apache.catalina.core.ApplicationHttpRequest@21695eed\ntest2 inRequest.getServletPath() /WEB-INF/jsp/test/test1.jsp\njavax.servlet.include.request_uri :: /TestApp/WEB-INF/jsp/test/test2.jsp\njavax.servlet.include.context_path :: /TestApp\njavax.servlet.include.servlet_path :: /WEB-INF/jsp/test/test2.jsp\njavax.servlet.forward.request_uri :: /TestApp/test.jsp\njavax.servlet.forward.context_path :: /TestApp\njavax.servlet.forward.servlet_path :: /test.jsp\n\nNote that the \"You are in test2.jsp\" block contains javax.servlet.forward.*\n\nIn tomcat 8.5.4 (and 8.5.3 too)\nIt looks like:\nYou are in test1.jsp \n\ntest1 inRequest org.apache.catalina.core.ApplicationHttpRequest@31d80a34\ntest1 inRequest.getServletPath() /WEB-INF/jsp/test/test1.jsp\njavax.servlet.forward.request_uri :: /TestApp/test.jsp\njavax.servlet.forward.context_path :: /TestApp\njavax.servlet.forward.servlet_path :: /test.jsp\njavax.servlet.forward.mapping :: org.apache.catalina.core.ApplicationMapping$MappingImpl@6a64c5b8\n\n\n\nYou are in test2.jsp \n\ntest2 inRequest org.apache.catalina.core.ApplicationHttpRequest@1130eccf\ntest2 inRequest.getServletPath() /WEB-INF/jsp/test/test1.jsp\njavax.servlet.include.request_uri :: /TestApp/WEB-INF/jsp/test/test2.jsp\njavax.servlet.include.context_path :: /TestApp\njavax.servlet.include.servlet_path :: /WEB-INF/jsp/test/test2.jsp\njavax.servlet.include.mapping :: org.apache.catalina.core.ApplicationMapping$MappingImpl@7e9a01d5\n\n\nServlet spec section 9.4.2 Forwarded Request Parameters\nstates this:\nThese attributes are accessible from the forwarded servlet via the\ngetAttribute method on the request object. Note that these attributes must always reflect the information in the original request even under the situation that multiple forwards and subsequent includes are called."}, {"count": 1, "attachment_id": null, "bug_id": 59913, "is_private": false, "id": 192974, "time": "2016-08-09T21:24:23Z", "creator": "markt@apache.org", "creation_time": "2016-08-09T21:24:23Z", "tags": [], "text": "Thanks for the report and the test case. A good example of why magic values cause maintenance problems.\n\nOnly 9.0.x and 8.5.x were affected. This has been fixed in:\n- 9.0.x for 9.0.0.M10 onwards\n- 8.5.x for 8.5.5 onwards"}]
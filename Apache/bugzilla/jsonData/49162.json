[{"count": 0, "tags": [], "creator": "aoxiaojian@gmail.com", "attachment_id": null, "id": 136289, "time": "2010-04-21T06:14:59Z", "bug_id": 49162, "creation_time": "2010-04-21T06:14:59Z", "is_private": false, "text": "I'am interesting in the new feature comes from ant 1.8.0:\n\n\"<import> can now import from any file- or URL-providing resource - this includes <javaresource>.\"\n\nYesteday I had a try to import URL-providing ant xml file, I had some ant build files like this :\n\n-root of product\n    - commom/\n        + common.xml\n        + ivy.xml\n        + publish.xml\n    - project1\n        + build.xml\n    - project2\n        + build.xml\n\nThe build.xml files in project1/2/3/4... import the common.xml file, and common.xml file imports all other xml files in common directory. This is very common for multiple projects to share the common build targets.\n\nThese ant build file work well when I use normal file import. But when I move common directory and all the ant xml file to a jar and then in project1/2/3/4... import this common.xml as URL-providing resource. These ant builf file work well except a warnning in ant log:\n\n\"Duplicated project name in import. Project *** defined first in **** and again in null\"\n\nI'm sure that all the project name are not Duplicated.\n\nAnd this warning will only appear in this specifical case: using <buildlist> to get a build files list of project1/2/3/4...  and then execute the target in each build file. If only one project's build.xml, this warning would not happen.\n\nI have download the source code of ant 1.8 and found the reason of this warning:\n\n1. in org.apache.tools.ant.helper.ProjectHelper2\n\n                if (context.isIgnoringProjectTag() && !dupFile.equals(context.getBuildFile())) {\n                    project.log(\"Duplicated project name in import. Project \"\n                            + context.getCurrentProjectName() + \" defined first in \" + dup\n                            + \" and again in \" + context.getBuildFile(), Project.MSG_WARN);\n                }\n\n    Compare to the warning log \"and again in null\", we can know that  context.getBuildFile() would return null. In this case, !dupFile.equals(context.getBuildFile()) would always return true and cause the incorrect warning.\n\n2. in org.apache.tools.ant.helper.AntXMLContext\n\n    public void setBuildFile(File buildFile) {\n        this.buildFile = buildFile;\n        ......\n    }\n\n    /**\n     * @since Ant 1.8.0\n     */\n    public void setBuildFile(URL buildFile) throws MalformedURLException {\n        this.buildFileURL = buildFile;\n        ........\n    }\n\n    public File getBuildFile() {\n        return buildFile;\n    }\n\n    Now we can see that if we use URL import, the setBuildFile(URL buildFile) method will be invoked but it will set attibute buildFileURL, not attibute  buildFile, so the method getBuildFile() will always return null.\n\n    I think this would be a bug, the check logic for duplicated project name would be updated for the new fearture URL-providing import added in ant 1.8."}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 136320, "time": "2010-04-22T07:18:52Z", "bug_id": 49162, "creation_time": "2010-04-22T07:18:52Z", "is_private": false, "text": "I think this is fixed now by svn revision 936784 but I'm having a hard time creating a test case.\n\nCould you try to build Ant from svn and see whether the problem is really fixed?"}, {"count": 2, "tags": [], "bug_id": 49162, "text": "1.8.1 is about to be released soon.  In fact the archives that will make up\nthe release are currently voted on and can be found at\nhttp://people.apache.org/~antoine/dist/\n\nIt would be great if you could give it a try before we announce the final\nrelease - we may be able to delay the release if the problem still persists.", "id": 136623, "time": "2010-05-04T08:14:30Z", "creator": "bodewig@apache.org", "creation_time": "2010-05-04T08:14:30Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 49162, "is_private": false, "id": 136742, "creation_time": "2010-05-09T07:36:24Z", "time": "2010-05-09T07:36:24Z", "creator": "aoxiaojian@gmail.com", "text": "I have verified this bug with new version 1.8.1, this warning doesn't appear now.\n\nAlso I have checked the source code of class org.apache.tools.ant.helper ProjectHelper2, the code above in my bug report has been updated to add check for both context.getBuildFileURL() and context.getBuildFile():\n\nif (MagicNames.ANT_FILE_TYPE_URL.equals(dupType)) {\n    ...\n    contextFile = context.getBuildFileURL();\n} else {\n    ...\n    contextFile = context.getBuildFile();\n}\n\nif (context.isIgnoringProjectTag() && !dupFile.equals(contextFile)) {\n    project.log(\"Duplicated project name in import. Project \"\n       + context.getCurrentProjectName() + \" defined first in \" + dup\n       + \" and again in \" + contextFile, Project.MSG_WARN);\n }\n\nI think this bug has been fix and this issue would be closed.\n\nThanks to all.", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "nicholas.jasieniecki@orbitz.com", "attachment_id": null, "text": "There is an old bug that seems to have been popped back up again. \n\nBasically i have an ant script that starts jmeter via the java target, and when my test gets to the end i get \n\nTidying up...\nEnd of test....\n\n\nAnd it sits there forever.\n\nThis happens when my test contains a beanshell sampler and code inside the sampler causes a network call to happen. The jmeter log shows the test completing successfully with no errors.\n\nMy exact circumstance is i have a controller that starts a spring container, and the samplers get beans out of the container and those beans then make network calls over HTTP.\n\nIn JM 2.2 this works, but in 2.4 and 2.5 its broken again. The original bug ID is 40189.", "id": 149146, "time": "2011-09-10T19:48:30Z", "bug_id": 51798, "creation_time": "2011-09-10T19:48:30Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "can you provide a simple test case?\n\nAlternatively, can you provide a thread dump of the hang?", "id": 149154, "time": "2011-09-11T13:59:59Z", "bug_id": 51798, "creation_time": "2011-09-11T13:59:59Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 51798, "text": "I'll see if i can produce a simple test case tomorrow when i get back into work. \n\nFor the thread dump does kill -QUIT suffice?", "id": 149156, "time": "2011-09-11T18:45:02Z", "creator": "nicholas.jasieniecki@orbitz.com", "creation_time": "2011-09-11T18:45:02Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "Any thread dump will do.", "id": 149175, "time": "2011-09-12T14:01:05Z", "bug_id": 51798, "creation_time": "2011-09-12T14:01:05Z", "is_private": false}, {"count": 4, "tags": [], "creator": "apache@spedge.com", "attachment_id": null, "is_private": false, "id": 149228, "time": "2011-09-14T15:47:35Z", "bug_id": 51798, "creation_time": "2011-09-14T15:47:35Z", "text": "Suffering from the same problem, even with a bare test with no thread groups. It gets to\n\nTidying up ...    @ Wed Sep 14 16:38:45 BST 2011 (1316014725372)\n... end of run\n\nthen just hangs :S"}, {"text": "Sorry, let me clarify.\n\nI'm running JMeter using the command line via the JMeter Maven plugin. This behaviour exists in 2.4 and 2.5, but not in 2.3 of JMeter.\n\nThe same JMX file does NOT exhibit the hanging behaviour if I run it straight from the command line of JMeter 2.5 itself. \n\nHas something changed perhaps in the way JMeter exits post 2.3?", "tags": [], "bug_id": 51798, "is_private": false, "count": 5, "id": 149231, "time": "2011-09-14T16:29:17Z", "creator": "apache@spedge.com", "creation_time": "2011-09-14T16:29:17Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 51798, "text": "Yes, there were some changes to fix other issues in test completion.\n\nBut without a test plan that can be used to reproduce the issue, or a thread dump, it's going to be difficult to find the bug.", "id": 149237, "time": "2011-09-14T17:36:47Z", "creator": "sebb@apache.org", "creation_time": "2011-09-14T17:36:47Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "apache@spedge.com", "attachment_id": 27500, "is_private": false, "id": 149256, "time": "2011-09-15T10:15:01Z", "bug_id": 51798, "creation_time": "2011-09-15T10:15:01Z", "text": "Created attachment 27500\nThread Dump of hanging test\n\nSebb, \n\nAttached is the thread dump I have from the plugin. As you can see, there's Maven and the Maven plugin, but the top thread seems to show it waiting for a signal.\n\nHope this helps, \n\nStuart"}, {"count": 8, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "Thanks. \n\nYes, there is a JMeter thread, but it is a daemon thread so should not affect shutdown.\n\nThe thread is the UDP shutdown monitor which waits on port 4445\n\n# To disable, set the port to 1000 or less.\n#jmeterengine.nongui.port=4445\n\nTry setting the port to 0. That may fix the problem.\n\nBut the Maven plugin ought to be able to cope with a leftover daemon thread.\n\nNote also that JMeter unit tests are run by Ant and don't hang - see the \"batchtest\" target in build.xml in the source archive for details.", "id": 149280, "time": "2011-09-15T15:41:09Z", "bug_id": 51798, "creation_time": "2011-09-15T15:41:09Z", "is_private": false}, {"count": 9, "tags": [], "creator": "nicholas.jasieniecki@orbitz.com", "attachment_id": 27503, "text": "Created attachment 27503\nThread dump of bug", "id": 149284, "time": "2011-09-15T16:11:36Z", "bug_id": 51798, "creation_time": "2011-09-15T16:11:36Z", "is_private": false}, {"count": 10, "tags": [], "creator": "nicholas.jasieniecki@orbitz.com", "attachment_id": null, "text": "I added my own thread dump as well from jmeter 2.4.\n\nI tried setting the port to 0 but no luck.", "id": 149285, "time": "2011-09-15T16:12:05Z", "bug_id": 51798, "creation_time": "2011-09-15T16:12:05Z", "is_private": false}, {"count": 11, "tags": [], "text": "AFAICT, the \"Thread dump of bug\" contains no JMeter code at all.\n\nThe hang must be in whatever is being used to run JMeter.\n\nIf you can produce a hang when using the standard JMeter command script, please attach the dump.\n\nOtherwise, this issue will be closed as being irrelevant to JMeter.", "attachment_id": null, "bug_id": 51798, "id": 149286, "time": "2011-09-15T16:31:12Z", "creator": "sebb@apache.org", "creation_time": "2011-09-15T16:31:12Z", "is_private": false}, {"count": 12, "tags": [], "creator": "nicholas.jasieniecki@orbitz.com", "attachment_id": null, "text": "Its entirely possible that this only shows up when calling from ant/maven, but it worked fine in jmeter 2.2 and 2.3. 2.3.1 is the release version it seems to have stopped working in.", "id": 149287, "time": "2011-09-15T16:33:43Z", "bug_id": 51798, "creation_time": "2011-09-15T16:33:43Z", "is_private": false}, {"count": 13, "tags": [], "text": "Without clear evidence of what the problem is (e.g. thread dump that shows a JMeter problem), or a *simple* reproducer, it's impossible to investigate and provide a fix.", "is_private": false, "bug_id": 51798, "id": 149288, "time": "2011-09-15T16:38:35Z", "creator": "sebb@apache.org", "creation_time": "2011-09-15T16:38:35Z", "attachment_id": null}, {"count": 14, "tags": [], "creator": "apache@spedge.com", "attachment_id": null, "text": "Sebb,\n\nIf I download a fresh copy of jmeter-2.5, then using an basic JMX file (saved from the initial startup of the GUI, so basically blank).\n\njmeter -n -t Workbench.jmx\n\nThe output is as follows...\n\nCreated the tree successfully using WorkBench.jmx\nStarting the test @ Thu Sep 15 17:39:03 BST 2011 (1316104743765)\nWaiting for possible shutdown message on port 4445\nTidying up ...    @ Thu Sep 15 17:39:03 BST 2011 (1316104743843)\n... end of run\n\nNow, looking at the source of JMeter 2.5, that to me looks like a UDP thread is being created to listen to as per the default port. I can't change that number to be anything else - I've tried editing the user.properties, the jmeter.properties file, the system.properties file - but nowhere will it overwrite the property \"jmeterengine.nongui.port\"\n\nI've even tried specifying that it should use a custom property file by doing \n\njmeter -n -t Workbench.jmx -J jmeterengine.nongui.port=100\n\nBut that doesn't fix it, it's still looking for port 4445.\n\nAny thoughts?", "id": 149289, "time": "2011-09-15T17:10:53Z", "bug_id": 51798, "creation_time": "2011-09-15T17:10:53Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 51798, "attachment_id": null, "id": 149290, "time": "2011-09-15T17:43:05Z", "creator": "apache@spedge.com", "creation_time": "2011-09-15T17:43:05Z", "is_private": false, "text": "I've run through this with a remote debugger on it, and in JMeter.java, line 137 and 140, the UDP_PORT is set up without the property file actually being loaded.\n\nThus, the listener is always going to be invoked no matter what we do - and will not change from the default port."}, {"text": "Yes, there's a bug in the code that sets the UDP_PORT and UDP_PORT_MAX - they are static fields, which are normally fine for JMeter properties. However, the properties are initialised after the JMeter class loads.\n\nUnfortunately, there is no work-round with the current code (I'll fix that shortly).\n\nHowever, the UDP server runs as a daemon thread, and does not interfere with Ant launches - the example/build.xml script runs the ant-jmeter code without a problem, as does the unit test.\n\nSo although JMeter does not stop its UDP daemon thread, this should not affect external applications that run JMeter.\n\nIf there is a simple Ant test case that hangs, please provide details.", "tags": [], "bug_id": 51798, "is_private": false, "count": 16, "id": 149296, "time": "2011-09-15T22:45:39Z", "creator": "sebb@apache.org", "creation_time": "2011-09-15T22:45:39Z", "attachment_id": null}, {"count": 17, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "is_private": false, "id": 149299, "time": "2011-09-15T23:11:11Z", "bug_id": 51798, "creation_time": "2011-09-15T23:11:11Z", "text": "(In reply to comment #16)\n> Yes, there's a bug in the code that sets the UDP_PORT and UDP_PORT_MAX - they\n> are static fields, which are normally fine for JMeter properties. However, the\n> properties are initialised after the JMeter class loads.\n> \n> Unfortunately, there is no work-round with the current code (I'll fix that\n> shortly).\n\nBug 51831 raised and fixed; will be in nightly builds from r1171313."}, {"count": 18, "tags": [], "text": "I've built and run the test with the ability to change the port to 0, and have seen no hanging. This must have been the problem.\n\nWhen is the next likely stable build / release build to occur?\n\nThanks,\n\nStuart", "is_private": false, "bug_id": 51798, "id": 149311, "time": "2011-09-16T10:29:52Z", "creator": "apache@spedge.com", "creation_time": "2011-09-16T10:29:52Z", "attachment_id": null}, {"count": 19, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "is_private": false, "id": 149312, "time": "2011-09-16T11:08:01Z", "bug_id": 51798, "creation_time": "2011-09-16T11:08:01Z", "text": "(In reply to comment #18)\n> I've built and run the test with the ability to change the port to 0, and have\n> seen no hanging. This must have been the problem.\n\nThe code running JMeter should not care if there is an extra daemon thread.\n\nThat is a bug in the Maven plugin."}, {"count": 20, "tags": [], "creator": "apache@spedge.com", "attachment_id": null, "is_private": false, "id": 149318, "time": "2011-09-16T13:47:11Z", "bug_id": 51798, "creation_time": "2011-09-16T13:47:11Z", "text": "Indeed, but sadly the Maven plugin is less supported than JMeter :)\n\nAt least we've fixed a bug here. I can make a start on the other side now!"}, {"text": "Sebb, you are spot on. There is a bug in the plugin whereby it does not deal with Daemon threads correctly - and thus it will hang incorrectly. Managed to fix that too :)", "tags": [], "bug_id": 51798, "is_private": false, "count": 21, "id": 149329, "time": "2011-09-16T15:16:07Z", "creator": "apache@spedge.com", "creation_time": "2011-09-16T15:16:07Z", "attachment_id": null}, {"count": 22, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "The message \"... end of run\" can be printed even though some threads have not ended. See Bug 51839.", "id": 149370, "time": "2011-09-17T14:30:41Z", "bug_id": 51798, "creation_time": "2011-09-17T14:30:41Z", "is_private": false}, {"count": 23, "tags": [], "bug_id": 51798, "text": "I think this is now fixed.\n\nIf the problem still exists in JMeter 2.5.1 (to be released shortly) please re-open with full details", "id": 149915, "time": "2011-09-28T14:28:47Z", "creator": "sebb@apache.org", "creation_time": "2011-09-28T14:28:47Z", "is_private": false, "attachment_id": null}, {"count": 24, "tags": [], "creator": "mpermar@gmail.com", "attachment_id": null, "text": "Hi Guys. \n\nI'm experiencing this same issue on the latest stable version 2.5.1. \n\nThe sceneario is very similar. I use jmeter to run some functional tests which will open some xmpp connection to do stuff. Once the test finishes, jmeter frozens. Initially I was running this from Ant, so I thought it could be an issue related to the ant task and how it works. So I tried to run my jmeter test from the command line but I found the same behavior. JMeter freezes once the test is finished. \n\nThis is how my command line output looks like:\n\nmartin@martin:~$ cd git/rayo/rayo-load-tests/\nmartin@martin:~/git/rayo/rayo-load-tests$ java -jar /opt/jakarta-jmeter-2.5.1/bin/ApacheJMeter.jar -n -t src/test/jmeter/rayo-load-tests.jmx\nCreated the tree successfully using src/test/jmeter/rayo-load-tests.jmx\nStarting the test @ Thu Dec 15 15:41:38 CET 2011 (1323960098762)\nTidying up ...    @ Thu Dec 15 15:41:40 CET 2011 (1323960100888)\n... end of run\n\nI'm also adding a thread dump to see if this helps. \n\nBest,\nMartin", "id": 152196, "time": "2011-12-15T14:52:44Z", "bug_id": 51798, "creation_time": "2011-12-15T14:52:44Z", "is_private": false}, {"count": 25, "tags": [], "bug_id": 51798, "attachment_id": 28074, "id": 152197, "time": "2011-12-15T14:53:33Z", "creator": "mpermar@gmail.com", "creation_time": "2011-12-15T14:53:33Z", "is_private": false, "text": "Created attachment 28074\nStacktrace"}, {"count": 26, "tags": [], "text": "Thanks for the stack dump.\nThis shows that there are several RMI threads active.\n\nJMeter does not use RMI in non-GUI stand-alone mode, so the XMPP code must be starting them, and the sampler should close them down.\n\nJMeter only attempts to stop RMI threads if it starts them, i.e. if it is using client-server mode.\n\nAFAICT this is a bug in the XMPP sampler code, which is presumably a 3rd party add-on?", "attachment_id": null, "bug_id": 51798, "id": 152202, "time": "2011-12-15T16:07:16Z", "creator": "sebb@apache.org", "creation_time": "2011-12-15T16:07:16Z", "is_private": false}, {"count": 27, "tags": [], "creator": "mpermar@gmail.com", "attachment_id": null, "text": "Hi Sebb, \n\nAlright I thought JMeter would quit when the test finished independently on whether the test could have open threads or not. So in this case it is probably my JUnit code not properly shutting down some thread. \n\nI'll have a look. Thanks for your quick response. I'm marking this issue as resolved.", "id": 152222, "time": "2011-12-16T15:20:04Z", "bug_id": 51798, "creation_time": "2011-12-16T15:20:04Z", "is_private": false}, {"count": 28, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "(In reply to comment #27)\n> Hi Sebb, \n> \n> Alright I thought JMeter would quit when the test finished independently on\n> whether the test could have open threads or not. \n\nIt used to, but that causes issues when embedding JMeter.\n\nBesides, that would just hide the problem.\n\n> So in this case it is probably\n> my JUnit code not properly shutting down some thread. \n> \n> I'll have a look. Thanks for your quick response. I'm marking this issue as\n> resolved.\n\nOK; might be worth seeing if JMeter can easily detect if there are any non-daemon threads still lurking, and log/display a message if so - see Bug 52346.", "id": 152227, "time": "2011-12-16T16:19:25Z", "bug_id": 51798, "creation_time": "2011-12-16T16:19:25Z", "is_private": false}, {"count": 29, "tags": [], "text": "Sure, a message would help :)\n\nPersonally I believe that JMeter should execute its task and quit when the task is done without depending on whatever the application is doing or making any assumptions. Like for example when you run a test on your favoite IDE. But that might be just me. \n\nBest,\nMartin", "is_private": false, "bug_id": 51798, "id": 152228, "time": "2011-12-16T18:49:50Z", "creator": "mpermar@gmail.com", "creation_time": "2011-12-16T18:49:50Z", "attachment_id": null}, {"count": 30, "tags": [], "creator": "dbennettksm58@gmail.com", "attachment_id": null, "text": "(In reply to Sebb from comment #16)\n> Yes, there's a bug in the code that sets the UDP_PORT and UDP_PORT_MAX -\n> they are static fields, which are normally fine for JMeter properties.\n> However, the properties are initialised after the JMeter class loads.\n> \n> Unfortunately, there is no work-round with the current code (I'll fix that\n> shortly).\n> \n> However, the UDP server runs as a daemon thread, and does not interfere with\n> Ant launches - the example/build.xml script runs the ant-jmeter code without\n> a problem, as does the unit test.\n> \n> So although JMeter does not stop its UDP daemon thread, this should not\n> affect external applications that run JMeter.\n> \n> If there is a simple Ant test case that hangs, please provide details.", "id": 203404, "time": "2018-01-22T18:13:13Z", "bug_id": 51798, "creation_time": "2018-01-22T18:13:13Z", "is_private": false}]
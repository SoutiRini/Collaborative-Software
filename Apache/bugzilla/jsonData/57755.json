[{"count": 0, "tags": [], "bug_id": 57755, "is_private": false, "text": "Hello\n\nI'am using POI in order to read excels files from my users. In one of the cells, i've got this formula :\n\nIF(H24>0,((D24*(Q24))/((3600*H24)/I24))+IF(AND(N24>0,L24>0),(D24*L24*(Q24)/N24),0),0)\nThe problem arrive when i've got a 0 value for N24. In this case, POI returns me an DIV/0 error, but i don't understand why .. because of the IF (N24>0) test.\n\nAnyway, I tried changing the formula and keep only the latest part like this : IF (N24>0,D24*L24*(Q24)/N24,0) => still doesn't work.\n\nTo Evaluate the formula I use : FormulaEvaluator evaluator = wb.getCreationHelper().createFormulaEvaluator();\n\nAnd then i do a switch.", "id": 182086, "time": "2015-03-25T07:36:31Z", "creator": "jp.iwasinta@gmail.com", "creation_time": "2015-03-25T07:36:31Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "Can you try stepping into the formula evaluator in a debugger, and see why the evaluation is coming out that way?", "id": 182090, "time": "2015-03-25T11:05:59Z", "bug_id": 57755, "creation_time": "2015-03-25T11:05:59Z", "is_private": false}, {"count": 2, "tags": [], "creator": "jp.iwasinta@gmail.com", "attachment_id": null, "text": "I made some test.\nWhen changed :\nIF (N24>0,D24*L24*(Q24)/N24,0) \nby \nIF ((N24*1)>0,D24*L24*(Q24)/N24,0) it works.\n\nThen trying to explain why :\nI checked the excel file : The type in Standard Number\nThen\nI checked the code and i made cell.getCellType() which return a String ... so because of the string return the test  N24 > 0 was always true ... so that's why i had a DIV/0 error.\n\nThe thing i don't understand is why the getCell returns a string ... in place of a number.", "id": 182092, "time": "2015-03-25T12:38:05Z", "bug_id": 57755, "creation_time": "2015-03-25T12:38:05Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 57755, "is_private": false, "id": 182138, "creation_time": "2015-03-27T09:59:19Z", "time": "2015-03-27T09:59:19Z", "creator": "jp.iwasinta@gmail.com", "text": "We found a Bypass. When using the method evaluateFormulaCell, it was impossible to get the catchedValue.\n\nBy using the valuator.evaluate(cell), we still have the error but we can get the catchedValue.", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 57755, "attachment_id": null, "is_private": false, "id": 182139, "time": "2015-03-27T11:05:44Z", "creator": "jp.iwasinta@gmail.com", "creation_time": "2015-03-27T11:05:44Z", "text": "Thanks for your response and sorry ...\n\nI found an error of programation.\n\nTo get a long, the developer used this method :\npublic static Object getCellValue(Row row, int index) {\n\t\tif (row == null || row.getCell(index) == null) {\n\t\t\treturn null;\n\t\t}\n\t\tObject retour = null;\n\t\tCell cell = row.getCell(index);\n\t\tcell.setCellType(Cell.CELL_TYPE_STRING);\n\t\tString val = cell.getStringCellValue().trim();\n\t\tif (val != null && !\"\".equals(val)) {\n\t\t\tretour = cell.getStringCellValue();\n\t\t}\n\t\t\n\t\treturn retour;\n\t}\n\nThe gulty is : cell.setCellType(Cell.CELL_TYPE_STRING); ...."}, {"count": 5, "tags": [], "bug_id": 57755, "attachment_id": null, "id": 182143, "creation_time": "2015-03-27T13:34:17Z", "time": "2015-03-27T13:34:17Z", "creator": "apache@gagravarr.org", "text": "The javadocs for cell.setCellType do warn you not to do that!\n\nI'd suggest switching to using a missing cell policy on the cell fetch, and using DataFormatter to give the string\n\nGlad to hear that the formula parser wasn't the issue after all!", "is_private": false}]
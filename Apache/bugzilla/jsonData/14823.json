[{"count": 0, "tags": [], "bug_id": 14823, "attachment_id": null, "text": "Removing sheets during rewriting of documents that contain macros seems to\ncorrupt those files.\n\nWay to reproduce bug:\n1) Create empty excel document,\n2) Add this macro to 'ThisWorbook':\nPrivate Sub Workbook_Open()\nEnd Sub\n3) Save file to input.xls,\n4) Compile and run this code:\n\nimport org.apache.poi.hssf.usermodel.*;\nimport org.apache.poi.poifs.filesystem.*;\nimport java.io.*;\n\npublic class Test\n{\t\n\tpublic static void main(String[] args)\n\t{\n\t\ttry {\n\t\t\tHSSFWorkbook workBook = new HSSFWorkbook(new POIFSFileSystem(new\nFileInputStream(\"input.xls\")),\n                                    true);\n\t\t\tHSSFSheet sheet = workBook.createSheet(\"X\");\n\t\t\tworkBook.removeSheetAt(0);\n\n\t\t\tFileOutputStream fileOut = new FileOutputStream(\"output.xls\", false);\n\t\t\tworkBook.write(fileOut);\n\t\t\tfileOut.close();\n\t\t}\n\t\tcatch (Exception ex){\n\t\t\tex.printStackTrace();\n\t\t}\n\t}\n}\n \n4) Open output.xls and turn macros on\n\nWhen Excel executes macro in Workbook_Open() Sub procedure, it exits with system\nerror message.\n\nVersion of poi:  poi-1.8.0-dev-20020919 and poi-1.9.0-dev-20021122\nVersion of os/excel: windows98se/excel97, windows98se/excel2000,\nwindowsme/excel97, windowsme/excel2000 (all polish versions)\nDoesn\u2019t occur on: windows2000prof/excel2002 (polish version)\nVersion of jdk: sun jdk 1.3.1\nCompile command: javac -classpath \".\\jakarta-poi-1.9.0-dev-20021122.jar\"\nExecution command: java -classpath \".;.\\jakarta-poi-1.9.0-dev-20021122.jar\"\n\nAdditional information:\n1) Cloning exiting sheet using cloneSheet() method solves problem until cloned\nsheet is removed too.\n2) Name of removed sheet steel exists in Visual Basic Editor in VBAProject tree", "id": 26938, "time": "2002-11-25T14:21:09Z", "creator": "nbaraka@wp.pl", "creation_time": "2002-11-25T14:21:09Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 14823, "attachment_id": 3947, "is_private": false, "id": 26939, "time": "2002-11-25T14:23:51Z", "creator": "nbaraka@wp.pl", "creation_time": "2002-11-25T14:23:51Z", "text": "Created attachment 3947\nexample input file created with excel97"}, {"count": 2, "tags": [], "bug_id": 14823, "attachment_id": 3948, "id": 26940, "time": "2002-11-25T14:24:52Z", "creator": "nbaraka@wp.pl", "creation_time": "2002-11-25T14:24:52Z", "is_private": false, "text": "Created attachment 3948\noutput file created with sample program"}, {"count": 3, "tags": [], "text": "ArkuszX where X=1,2,... is the default name of new sheet created in polish\nversion of Excel.", "attachment_id": null, "bug_id": 14823, "id": 26941, "time": "2002-11-25T14:28:34Z", "creator": "nbaraka@wp.pl", "creation_time": "2002-11-25T14:28:34Z", "is_private": false}, {"count": 4, "tags": [], "creator": "poi-support@buni.org", "attachment_id": null, "id": 41297, "time": "2003-07-24T13:50:40Z", "bug_id": 14823, "creation_time": "2003-07-24T13:50:40Z", "is_private": false, "text": "I think I know whats happening...However it will require some structural\nchanges.  Best do it in 3.0"}, {"count": 5, "tags": [], "text": "someone know when we'll have this bug solved ?", "attachment_id": null, "bug_id": 14823, "id": 66456, "time": "2004-11-04T15:55:59Z", "creator": "magoo.floripa@brturbo.com", "creation_time": "2004-11-04T15:55:59Z", "is_private": false}, {"count": 6, "tags": [], "text": "Please check if the problem still exists in 3.1-beta1.\n\nYegor", "is_private": false, "id": 116748, "creator": "yegor@dinom.ru", "time": "2008-05-17T06:49:58Z", "bug_id": 14823, "creation_time": "2008-05-17T06:49:58Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Guessing this is now fixed. Please re-open the bug if it still occurs on re-testing with a recent version (eg 3.1)", "attachment_id": null, "bug_id": 14823, "id": 119447, "time": "2008-08-05T15:56:25Z", "creator": "apache@gagravarr.org", "creation_time": "2008-08-05T15:56:25Z", "is_private": false}]
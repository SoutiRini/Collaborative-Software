[{"count": 0, "tags": [], "bug_id": 34023, "attachment_id": null, "id": 72460, "time": "2005-03-15T21:26:16Z", "creator": "tcat.seq@gmail.com", "creation_time": "2005-03-15T21:26:16Z", "is_private": false, "text": "I'm facing an issue with the shiftRows(...) method while trying to insert rows \ninto an existing excel\nspreadsheet. The following program reads an excel spreadsheet (which has cells \nwith formulae in it) from \nthe command line, inserts 10 rows and outputs the modified spreadsheet to the \nname specified in the\ncommand line.\n\nThe issue I'm having is that if the original row (row that will be shifted \nduring the \"shiftRows\" method)\nhad a cell that contained a formula that referenced other cells, the cell \nreferences do not change after \n\"shiftRows\" has been called. This behavior is different when you manually shift \nrows using MS Excel or\nOpen Office. When you do it manually, the cell references are updated in the \nformula as the row is being\nshifted.\n\nI know the developers of POI don't expect POI to be a replacement to Excel (see \nhttp://mail-archives.eu.apache.org/mod_mbox/jakarta-poi-user/200406.mbox/%\n3c1088257363.889.1.camel@IT-avik.in.itellix.net%3e),\nbut if there is a shiftRows method I think it should duplicate the \nfunctionality. Am I missing something here?\n\nI haven't looked at the source code to understand POI since I've just started \nusing POI. Lame excuse, I know :)\nBut if someone could confirm they are seeing the same behavior and whether the \nexisting implementation/functionality of\nshiftRows is the correct functionality, I'd really appreciate it.\n\nI browsed through the user list archives, but could not find any indication \nthat someone had faced this\nproblem. Maybe I missed something.\n\nEnvironment:\nWindows XP\nJDK 1.4.1_01\npoi-2.5.1-final-20040804.jar\n\nTested on:\nMS Excel 2002 SP3\nOpen Office 1.1.4\n\nTo run this example:\n\n1) Compile HSSFCreateSheet.java (javac HSSFCreateSheet.java). Make sure you \nhave \n   poi-2.5.1-final-20040804.jar in your classpath\n2) Create an empty excel file in the same location as the compiled class. Add a \nvalue 0 to cell B14 and 100 to cell C14. Add the formula =B14/C14 to cell B17. \nSave the excel file Test.xls.\n3) Run HSSFCreateSheet as follows: java HSSFCreateSheet Test.xls shiftedTest.xls\n4) Open \"shiftedTest.xls\". And check the formulae in the shifted row. The cell \nreferences in the \n   formula didn't change during the shift.\n\n\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\n\nimport org.apache.poi.hssf.usermodel.HSSFCell;\nimport org.apache.poi.hssf.usermodel.HSSFCellStyle;\nimport org.apache.poi.hssf.usermodel.HSSFRow;\nimport org.apache.poi.hssf.usermodel.HSSFSheet;\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\nimport org.apache.poi.poifs.filesystem.POIFSFileSystem;\n\npublic class HSSFCreateSheet \n{\n\tprivate String fileName = null;\n\t\n\tprivate HSSFWorkbook hssfWb = null;\n\t\n\tpublic static void main(String [] args)\n\t{\n\t\ttry\n\t\t{\n\t\t\tHSSFCreateSheet hssf = new HSSFCreateSheet(args[0]);\n\t\t\tHSSFWorkbook wb = hssf.hssfWb;\n\t\t\tHSSFSheet sheet = wb.getSheetAt(0);\n\n            // insert 10 rows starting at row 9\n\t\t\tsheet.shiftRows(8, sheet.getLastRowNum(), 10, true, \ntrue);\n\n\t\t\tFileOutputStream fos = new FileOutputStream(args[1]);\n\t\t\twb.write(fos);\n\t\t\t\n\t\t\tfos.close();\n\t\t}\n\t\tcatch (Exception e)\n\t\t{\n\t\t\tSystem.out.println(\"Exception encountered...\" + \ne.getMessage());\n\t\t\te.printStackTrace();\n\t\t}\n    }\n\n\tpublic HSSFCreateSheet(String inputExcelFileName) throws \nFileNotFoundException, IOException \n\t{\n\t\tthis.fileName = inputExcelFileName;\n\t\tPOIFSFileSystem fs = new POIFSFileSystem(new FileInputStream\n(fileName));\n\t\thssfWb = new HSSFWorkbook(fs);\n\t}\n\n}\n\n\nThanks much,\nRAS"}, {"count": 1, "tags": [], "bug_id": 34023, "text": "Created attachment 14493\nTest.xls is the input to the HSSFCreateSheet program", "id": 72461, "time": "2005-03-15T21:29:57Z", "creator": "tcat.seq@gmail.com", "creation_time": "2005-03-15T21:29:57Z", "is_private": false, "attachment_id": 14493}, {"count": 2, "tags": [], "text": "This is more of a feature request.  I can confirm the functionality that you \nare seeing as when I wrote the shiftRows method, I didn't want to spend the \ntime required to parse the forumula and move anything along with it.  I would \nget the most recent source and start looking at how to shift a formula (a \nshiftFormula function?).", "is_private": false, "id": 72465, "creator": "slaubach@apache.org", "time": "2005-03-15T22:58:09Z", "bug_id": 34023, "creation_time": "2005-03-15T22:58:09Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 34023, "text": "Thanks Shawn. Atleast I wasn't hallucinating.\nI'll take a look at the source and see what I can do.\n\nRAS", "id": 72468, "time": "2005-03-16T01:46:17Z", "creator": "tcat.seq@gmail.com", "creation_time": "2005-03-16T01:46:17Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 34023, "attachment_id": 19550, "id": 99131, "time": "2007-02-08T12:37:43Z", "creator": "bkalbfus@emerginghealthit.com", "creation_time": "2007-02-08T12:37:43Z", "is_private": false, "text": "Created attachment 19550\nAdds shiftFormulas method into shiftRows functionality\n\nPlease review and apply this patch.  It uses regex matching to update row\nreferences in formulas referencing rows being shifted.\tIt matches relative and\nabsolute references (i.e.  \"A5:D7\" or \"$A$5:$D$7\".  It does not match\nreferences to entire rows (i.e.  \"5:7\" or \"$5:$7\").\nThanks,\nBrian"}, {"count": 5, "tags": [], "bug_id": 34023, "attachment_id": null, "id": 102218, "time": "2007-04-24T04:18:02Z", "creator": "tjacyno@galasoft.net", "creation_time": "2007-04-24T04:18:02Z", "is_private": false, "text": "The patch submitted by Brian works well. However, in order for the behaviour to\nbe similar to \"shiftRows\", the following should be added to the beginning of the\n\"shiftFormulas\" method:\n\n    startRow++;\n    endRow++;\n\nThanks."}, {"count": 6, "tags": [], "text": "Fixed in svn\n\n(Didn't use the supplied patch, instead processes the formulas properly, and\nupdates the reference parts it spots as required)", "is_private": false, "id": 112634, "creator": "apache@gagravarr.org", "time": "2008-01-08T09:19:21Z", "bug_id": 34023, "creation_time": "2008-01-08T09:19:21Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 52863, "attachment_id": null, "is_private": false, "id": 154717, "time": "2012-03-09T02:14:30Z", "creator": "simonsharry@gmail.com", "creation_time": "2012-03-09T02:14:30Z", "text": "1. When converting a bunch of Microsoft Word documents using the command,\n\n    java -jar tika-app-1.1-SNAPSHOT.jar -v -t\n\n, I'm getting the following exception. Ditto with Tika 1.1 release candidate.\n\norg.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@5d3ac0\n    at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:244)\n    at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n    at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)\n    at org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:130)\n    at org.apache.tika.cli.TikaCLI$TikaServer$1.run(TikaCLI.java:735)\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 487\n    at org.apache.poi.hwpf.sprm.SprmOperation.initSize(SprmOperation.java:174)\n    at org.apache.poi.hwpf.sprm.SprmOperation.<init>(SprmOperation.java:80)\n    at org.apache.poi.hwpf.sprm.SprmIterator.next(SprmIterator.java:48)\n    at org.apache.poi.hwpf.sprm.ParagraphSprmUncompressor.uncompressPAP(ParagraphSprmUncompressor.java:67)\n    at org.apache.poi.hwpf.usermodel.Paragraph.newParagraph(Paragraph.java:103)\n    at org.apache.poi.hwpf.usermodel.Range.getTable(Range.java:943)\n    at org.apache.tika.parser.microsoft.WordExtractor.handleParagraph(WordExtractor.java:146)\n    at org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:97)\n    at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:185)\n    at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:160)\n    at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n    ... 4 more\n\nA user, Nick Burch, has advised me to raise this as a POI bug.\n\n2. Here's the output of the BFF Validator tool:\n\n<BFFValidation path=\"failing.doc\" datetime=\"03/08/12 07:14:27\" result=\"FAILED\">\n<ParseStack>\n<Type builtinType=\"Docfile\" docName=\"MS-DOC\" sectionTitle=\"File Structure\" msdnLink=\"http://msdn.microsoft.com/en-us/library/4eaddc8f-4abd-43bb-8fd4-aef9c6121737\">\n<Info>Built-in type \"Docfile\": The root storage object of an OLE compound file. For more information, see http://msdn.microsoft.com/en-us/library/dd942138.aspx.</Info>\n</Type>\n<Type builtinType=\"Stream\" docName=\"MS-DOC\" sectionTitle=\"File Structure\" msdnLink=\"http://msdn.microsoft.com/en-us/library/4eaddc8f-4abd-43bb-8fd4-aef9c6121737\" streamName=\"WordDocument\" streamOffset=\"0\" hexStreamOffset=\"0x0\">\n<Info>Built-in type \"Stream\": Any stream object for OLE compound files. The entire file contents for other files.</Info>\n</Type>\n<Type docName=\"MS-DOC\" sectionTitle=\"Fib\" sectionNumber=\"2.5.1\" msdnLink=\"http://msdn.microsoft.com/en-us/library/9AEAA2E7-4A45-468E-AB13-3F6193EB9394\" streamName=\"WordDocument\" streamOffset=\"0\" hexStreamOffset=\"0x0\"/>\n<Type docName=\"MS-DOC\" sectionTitle=\"FibBase\" sectionNumber=\"2.5.2\" msdnLink=\"http://msdn.microsoft.com/en-us/library/26FB6C06-4E5C-4778-AB4E-EDBF26A545BB\" streamName=\"WordDocument\" streamOffset=\"0\" hexStreamOffset=\"0x0\"/>\n<Type builtinType=\"USHORT\" streamName=\"WordDocument\" bitfield=\"True\" bitOffsetWithinStruct=\"84\" hexBitOffsetWithinStruct=\"0x54\" bitCount=\"4\" streamOffsetOfStruct=\"0\" hexStreamOffsetOfStruct=\"0x0\" streamOffset=\"10\" hexStreamOffset=\"0xa\" childId=\"10\" hexChildId=\"0xa\">\n<Info>Built-in type \"USHORT\": Unsigned 2-byte integer.</Info>\n</Type>\n</ParseStack>\n<LastData><![CDATA[\nEC A5 01 01 4D 20 09 04  00 00 08 12 BF 00 00 00  ....M...........\n00 00 00 30 00 00 00 00  00 08 00 00 66 EF 00 00  ...0........f...\n]]></LastData>\n</BFFValidation>\n--------------------------------------------\n\nWould greatly appreciate a timely fix, as I have 2000+ of documents that POI/Tika are failing on. I cannot proceed any further."}, {"count": 1, "tags": [], "text": "Can you upload a failing document? \n\nYegor", "is_private": false, "id": 154737, "creator": "yegor@dinom.ru", "time": "2012-03-09T11:33:23Z", "bug_id": 52863, "creation_time": "2012-03-09T11:33:23Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Unfortunately, this is a classified document.", "attachment_id": null, "id": 154740, "creator": "simonsharry@gmail.com", "time": "2012-03-09T12:14:24Z", "bug_id": 52863, "creation_time": "2012-03-09T12:14:24Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 52863, "text": "Do you know the origin of these failing docs? Were they created by MS Word or by OpenOffice or by what ? \n\nWithout a sample file we can't do much.\n\nYegor\n\n(In reply to comment #2)\n> Unfortunately, this is a classified document.", "id": 154741, "time": "2012-03-09T12:17:03Z", "creator": "yegor@dinom.ru", "creation_time": "2012-03-09T12:17:03Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "> Do you know the origin of these failing\n> docs? Were they created by MS Word or\n> by OpenOffice or by what ? \n\nThey were created by a post-2003 and pre-2007 version of MS Word. \n\n\n> Without a sample file we can't do much.\n\nJust the name itself of the document is 'Business Intelligence', so you can imagine my difficulty. Even other documents that failing are sensitive enough. I thought, I should be able to remove the sensitive parts of this document and then upload it for the Tika/POI developers. But even mere re-saving the document in Word 2007 (i.e., without any new edits whatsoever) makes the problem mostly go away. I say 'mostly' because, while Tika/POI are then able to extract the text, they also append text like this to the output\n\n_-1388201556/ole-[42, 4D, 0E, 0A, 00, 00, 00, 00]\n\n_-1388203796/ole-[42, 4D, 2E, 0A, 00, 00, 00, 00]\n\n_-1388843352/ole-[42, 4D, 2E, 0A, 00, 00, 00, 00]\n\n_-1388845272/ole-[42, 4D, BA, 09, 00, 00, 00, 00]\n\n_-1388297360/ole-[42, 4D, BA, 09, 00, 00, 00, 00]\n\n_-1388297680/ole-[42, 4D, D6, 09, 00, 00, 00, 00]\n\n_-1388296720/ole-[42, 4D, BA, 09, 00, 00, 00, 00]\n\n_-1388203476/ole-[42, 4D, 66, 09, 00, 00, 00, 00]\n\n_-1382869532/ole-[42, 4D, 36, 0C, 00, 00, 00, 00]\n\n_-1388200596/ole-[42, 4D, 2E, 0A, 00, 00, 00, 00]\n\n_-1388200916/ole-[42, 4D, BA, 09, 00, 00, 00, 00]\n\n_-1383036196/ole-[42, 4D, 12, 09, 00, 00, 00, 00]\n\n_-1382867932/ole-[42, 4D, 86, 0A, 00, 00, 00, 00]\n\n_-1382868252/ole-[42, 4D, 2E, 0A, 00, 00, 00, 00]\n\n_-1380808936/ole-[42, 4D, 2E, 0A, 00, 00, 00, 00]\n\n\nBeing a developer myself, I am fully aware how hard it can be to fix (certain) bugs without appropriate test input. I will watch out for newer releases.", "is_private": false, "id": 154773, "creator": "simonsharry@gmail.com", "time": "2012-03-10T01:33:39Z", "bug_id": 52863, "creation_time": "2012-03-10T01:33:39Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "sepp@nightmail.ru", "attachment_id": 28554, "text": "Created attachment 28554\nThe same problem with MS PowerPoint files\n\nHi *,\n\nI have the same problem with tika-app-1.1.jar und MS PowerPoint files. In the zip archive you can find 2 PPT files. The file Tika.ppt is the \"old\" file, that cannot be converted with the error message:\n\nSystem.ApplicationException : Extraction of text from the file 'Tika.ppt' failed.\n  ----> org.apache.tika.exception.TikaException : Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@2a784f5\n  ----> java.lang.ArrayIndexOutOfBoundsException : \nat TikaOnDotNet.TextExtractor.Extract(String filePath) in d:\\Work\\tikaondotnet.git\\trunk\\TikaOnDotnet\\TextExtractor.cs:line 63\nat TikaOnDotNet.tikadriver_examples.should_extract_from_ppt() in d:\\Work\\tikaondotnet.git\\trunk\\TikaOnDotnet\\tikadriver_examples.cs:line 104\n--TikaException\nat org.apache.tika.parser.CompositeParser.parse(InputStream stream, ContentHandler handler, Metadata metadata, ParseContext context)\nat org.apache.tika.parser.CompositeParser.parse(InputStream stream, ContentHandler handler, Metadata metadata, ParseContext context)\nat org.apache.tika.parser.AutoDetectParser.parse(InputStream stream, ContentHandler handler, Metadata metadata, ParseContext context)\nat TikaOnDotNet.TextExtractor.Extract(String filePath) in d:\\Work\\tikaondotnet.git\\trunk\\TikaOnDotnet\\TextExtractor.cs:line 55\n--ArrayIndexOutOfBoundsException\nat IKVM.Runtime.ByteCodeHelper.arraycopy_primitive_1(Array src, Int32 srcStart, Array dest, Int32 destStart, Int32 len)\nat org.apache.poi.util.LittleEndian.getByteArray(Byte[] data, Int32 offset, Int32 size)\nat org.apache.poi.hpsf.UnicodeString..ctor(Byte[] , Int32 )\nat org.apache.poi.hpsf.TypedPropertyValue.readValue(Byte[] , Int32 )\nat org.apache.poi.hpsf.Vector.read(Byte[] , Int32 )\nat org.apache.poi.hpsf.TypedPropertyValue.readValue(Byte[] , Int32 )\nat org.apache.poi.hpsf.VariantSupport.read(Byte[] src, Int32 offset, Int32 length, Int64 type, Int32 codepage)\nat org.apache.poi.hpsf.Property..ctor(Int64 id, Byte[] src, Int64 offset, Int32 length, Int32 codepage)\nat org.apache.poi.hpsf.Section..ctor(Byte[] src, Int32 offset)\nat org.apache.poi.hpsf.PropertySet.init(Byte[] , Int32 , Int32 )\nat org.apache.poi.hpsf.PropertySet..ctor(InputStream stream)\nat org.apache.tika.parser.microsoft.SummaryExtractor.parseSummaryEntryIfExists(DirectoryNode , String )\nat org.apache.tika.parser.microsoft.SummaryExtractor.parseSummaries(DirectoryNode )\nat org.apache.tika.parser.microsoft.OfficeParser.parse(DirectoryNode root, ParseContext context, Metadata metadata, XHTMLContentHandler xhtml)\nat org.apache.tika.parser.microsoft.OfficeParser.parse(InputStream stream, ContentHandler handler, Metadata metadata, ParseContext context)\nat org.apache.tika.parser.CompositeParser.parse(InputStream stream, ContentHandler handler, Metadata metadata, ParseContext context)\n\nThe second file Tika_new.ppt is the same file, that has been saved with the MS PowerPoint 2010 (File -> Save as...), can be converted without any problems.\n\nWith tika-app-0.9.jar the file Tika.ppt can be converted too ==> the error is in the new version of tika-app-1.1.jar???\n\nThank you\nSepp", "id": 157239, "time": "2012-04-06T16:23:22Z", "bug_id": 52863, "creation_time": "2012-04-06T16:23:22Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 52863, "attachment_id": null, "is_private": false, "id": 163202, "time": "2012-11-05T16:06:44Z", "creator": "vlsergey@gmail.com", "creation_time": "2012-11-05T16:06:44Z", "text": "Since there is a problem with original file (i.e. structure is broken), i'm closing this bug as WONTFIX.\n\nBut in trunk the workaround will be added to skip the problematic SPRMs. I could NOT guarantee that the file will be correctly processed after such errors, but it worse to try."}]
[{"count": 0, "tags": [], "bug_id": 59034, "attachment_id": null, "id": 188609, "time": "2016-02-19T15:09:29Z", "creator": "benoit.wiart@gmail.com", "creation_time": "2016-02-19T15:09:29Z", "is_private": false, "text": "Each parallel sampler execution create a new httpclient + connection pool.\nThat's bad as :\n- it does not reproduce the browser max connection per host limit\n- the connections are not re-used between download as a browser would do"}, {"count": 1, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 188642, "time": "2016-02-21T15:31:11Z", "bug_id": 59034, "creation_time": "2016-02-21T15:31:11Z", "is_private": false, "text": "Hi,\nI submitted this PR for this:\nhttps://github.com/apache/jmeter/pull/135\n\nPlease be aware that patch would not work if PR 132 for Bug 52073 was applied as the Thread Pool in the fix is shared among all threads while for now there is 1 pool per Virtual User Thread.\n\n\nIf the PR 132 was applied, a solution would be for example to:\n\n- Create a Session Manager that generate a zone per virtual user (with UUID)\n- The current HTTPCLIENTS_CACHE_PER_THREAD_AND_HTTPCLIENTKEY would be available per the virtual user key\n- This would make it sharing possible without switching to InheritableThreadLocal\n\n\nI benchmarked current patch vs current trunk (5 minutes test / 15 threads):\n\nBefore:\nsummary = 499819 in 00:05:07 = 1627.8/s Avg:    14 Min:     0 Max: 11821 Err:    26 (0.01%)\n\nAfter:\nsummary = 1177289 in 00:05:07 = 3834.1/s Avg:     4 Min:     0 Max:  2172 Err:    38 (0.00%)\n\n\n\nAs you can see:\n- Throughput is 135% higher\n- Response times are also much more realistic\n- Compared to bench mentionned in Bug 58950, there is no more huge ephemeral ports consumption and no more CPU pause during the test\n\n\nFeedback very welcome"}, {"count": 2, "tags": [], "text": "Created attachment 33577\nTest Plan used for benching against a Tomcat 8.30", "attachment_id": 33577, "bug_id": 59034, "id": 188643, "time": "2016-02-21T15:32:22Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-21T15:32:22Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 59034, "attachment_id": null, "is_private": false, "id": 188657, "time": "2016-02-21T21:46:17Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-21T21:46:17Z", "text": "*** Bug 59029 has been marked as a duplicate of this bug. ***"}, {"count": 4, "tags": [], "bug_id": 59034, "attachment_id": null, "id": 188659, "time": "2016-02-21T21:55:21Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-21T21:55:21Z", "is_private": false, "text": "Author: pmouawad\nDate: Sun Feb 21 21:49:31 2016\nNew Revision: 1731570\n\nURL: http://svn.apache.org/viewvc?rev=1731570&view=rev\nLog:\nBug 59034 - Parallel downloads connection management is not realistic\nBugzilla Id: 59034\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerBase.java\n    jmeter/trunk/xdocs/changes.xml\n\n\n\nBased on:\nhttps://github.com/apache/jmeter/pull/135\nhttps://github.com/apache/jmeter/pull/136"}]
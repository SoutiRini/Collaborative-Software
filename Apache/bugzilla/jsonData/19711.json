[{"count": 0, "tags": [], "text": "Neither SetEnvIf nor SetEnvIfNoCase work with Apache 2.0.45 under Windows 2000.  I have never tried it with an older version of Apache.\n\nI have tried the following configurations (using SetEnvIf and SetEnvIfNoCase): \n\nSetEnvIfNoCase Remote_Addr \"192\\.168\\.20\\.18\" logtswebreq\nCustomLog logs/tsweb.log common env=logtswebreq\n\nthen...\n\nSetEnvIfNoCase Request_URI \"/tsweb$\" logtswebreq\nCustomLog logs/tsweb.log common env=logtswebreq\n\nAnd even various other variation.  None of them work.  I therefore am convinced that this is a bug.\n\nPlease comment.\n\nThanks", "attachment_id": null, "id": 36787, "creator": "fehe@hotmail.com", "time": "2003-05-06T23:21:01Z", "bug_id": 19711, "creation_time": "2003-05-06T23:21:01Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 19711, "attachment_id": null, "id": 36788, "time": "2003-05-06T23:34:14Z", "creator": "nd@perlig.de", "creation_time": "2003-05-06T23:34:14Z", "is_private": false, "text": "\"Does not work\" lacks a bit of information :)\n\nWhat did you expect and what happened instead?"}, {"count": 2, "tags": [], "bug_id": 19711, "attachment_id": null, "is_private": false, "id": 36950, "time": "2003-05-09T03:00:54Z", "creator": "fehe@hotmail.com", "creation_time": "2003-05-09T03:00:54Z", "text": "What should have happened is that Apache should have written to tsweb.log whenever a client request for the URI /tsweb/ was received.  For the other example, Apache should have written to tsweb.log whenever a request was received from client 192.168.20.18.\n\nIn both cases, logging to the custom log did not occur.  I know that custom logging, by itself, works because I have used it before; therefore, the problem must exist with SetEnvIf and SetEnvIfNoCase.\n\nJust in case this makes any difference, I am connecting via an SSL session using Mod_SSL.\n\n\nThanks"}, {"count": 3, "tags": [], "text": "Hmm. The following config works on my box (win2k, more or less with default config):\n\nSetEnvIf remote_addr 127\\.0\\.0\\.1 foo\nCustomLog logs/access.log common\nCustomLog logs/foo.log common env=foo\n\nIt logs into both files. Are you absolutely sure that your remote_addr is that\nIP address (and not, say, 127.0.0.1)?\n\nThe second\n\nSetEnvIfNoCase Request_URI \"/tsweb$\" logtswebreq\n\ndoesn't match /tsweb/, so it's certainly not a bug. (The $ anchor means \"end of\nstring\", you probably want to use \"^/tsweb/\" or something).", "attachment_id": null, "id": 36951, "creator": "nd@perlig.de", "time": "2003-05-09T03:18:18Z", "bug_id": 19711, "creation_time": "2003-05-09T03:18:18Z", "is_private": false}, {"count": 4, "tags": [], "creator": "fehe@hotmail.com", "attachment_id": null, "text": "I am positive about the source IP.  When I check acess.log, it shows the correct source.\n\nAs far as \"/tsweb/$\" goes, I have tried all of the following with no luck. :-(\n\n\"^/tsweb/\"\n\"^/tsweb\"\n\"^/tsweb$\"\n\"^/tsweb/$\"\n\"/tsweb\"\n\"/tsweb/\"\n\"tsweb$\"\n\"tsweb\"\n\nMaybe I should also mention that I am using Apache as a secure authenticating portal/proxy and /tsweb is an IIS site that is behind the apache proxy.\n\nAny ideas?\n\nThanks", "id": 36969, "time": "2003-05-09T12:15:26Z", "bug_id": 19711, "creation_time": "2003-05-09T12:15:26Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 19711, "is_private": false, "count": 5, "id": 36970, "time": "2003-05-09T12:36:46Z", "creator": "nd@perlig.de", "creation_time": "2003-05-09T12:36:46Z", "text": "Can you post your proxy configuration? I'll try to reproduce it with proxy enabled.\nIf it's ok for you, you may alternatively attach here or email me your whole\nconfiguration, perhaps there are other nasty interactions."}, {"count": 6, "tags": [], "bug_id": 19711, "attachment_id": 6301, "id": 37007, "time": "2003-05-09T21:54:32Z", "creator": "fehe@hotmail.com", "creation_time": "2003-05-09T21:54:32Z", "is_private": false, "text": "Created attachment 6301\nMy apache.conf file (modified for security reasons)"}, {"count": 7, "tags": [], "text": "My proxy config is pasted below.  I have also attached a copy of my httpd.conf file.  Note:  some directory names and host addresses have been modified, for security reasons.  Otherwise, the config file is largely intact.\n\nAs I mentioned earlier, the Apache server + Mod_SSL proxies to back-end IIS server.\n\nI appreciate you taking the time to look into this.\n\nThanks\n\n\n<IfModule mod_proxy.c>\nProxyRequests On\n\n<Proxy *>\n    Order deny,allow\n\tDeny from all\n    Allow from 0.0.0.0/0.0.0.0\n</Proxy>\n\nProxyPass /tsweb http://127.0.0.1:97\nProxyPassReverse /tsweb http://127.0.0.1:97\nProxyPass /acid http://127.0.0.1:96\nProxyPassReverse /acid http://127.0.0.1:96\nProxyPass /ftp http://127.0.0.1:95\nProxyPassReverse /ftp http://127.0.0.1:95\n", "is_private": false, "id": 37008, "creator": "fehe@hotmail.com", "time": "2003-05-09T21:55:26Z", "bug_id": 19711, "creation_time": "2003-05-09T21:55:26Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 19711, "attachment_id": null, "id": 37013, "time": "2003-05-09T23:44:14Z", "creator": "nd@perlig.de", "creation_time": "2003-05-09T23:44:14Z", "is_private": false, "text": "Hmm. That is really strange. It works for me like a charm and I cannot find any\nodds. But I cannot test SSLProxy at the moment. Can you confirm that it doesn't\nwork without SSL enabled?\n\nMy config (extracted from yours, just exchanged some values)\n\nSetEnvIf Remote_Addr \"192\\.168\\.0\\.1\" mylogvar\nCustomLog logs/mylog.log common env=mylogvar\n\nand\n\nProxyRequests On\n#\n<Proxy *>\n    Order deny,allow\n\tDeny from all\n    Allow from 0.0.0.0/0.0.0.0\n</Proxy>\n\nProxyPass /foo http://otherhost\nProxyPassReverse /foo http://otherhost\n\n(By the way, if you want to deny all proxy requests, just turn ProxyRequests Off\nand remove the <Proxy> container.)"}, {"count": 9, "tags": [], "text": "Andre, thanks so much for all the help.  Your successful test helped point me in the right direction.  Turns out it was related to Mod_SSL.  After extensive testing and reconfiguration, here is a summary of the final solution:\n\n1. When using Mod_SSL, CustomLog entries in apache.log do not get processed.\n2. To resolve this issue, the CustomLog entries have to be placed in the ssl.conf file.\n3. My CustomLog configuration in ssl.conf then became:\n\nSetEnvIfNoCase Request_URI \"^/tsweb/$\" mylogvar\nCustomLog logs/mylog.log common env=mylogvar\n\nIt would be nice if the developers could find some way of resolving this so that CustomLog entries in apache.conf do not get ignored when using Mod_SSL.  However, since there is a workaround, I will now mark this bug report as WORKSFORME - unless someone feels a more elegant resolution is warranted from the Apache development team.\n\nAgain, thanks a lot.\n\n", "is_private": false, "id": 37016, "creator": "fehe@hotmail.com", "time": "2003-05-10T02:59:06Z", "bug_id": 19711, "creation_time": "2003-05-10T02:59:06Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 19711, "attachment_id": null, "id": 37023, "time": "2003-05-10T13:33:29Z", "creator": "nd@perlig.de", "creation_time": "2003-05-10T13:33:29Z", "is_private": false, "text": "Hmm, do you have an extra virtualhost running that handles the requests (defined\nin ssl.conf)?"}, {"count": 11, "tags": [], "bug_id": 19711, "attachment_id": null, "is_private": false, "id": 37033, "time": "2003-05-10T23:10:21Z", "creator": "fehe@hotmail.com", "creation_time": "2003-05-10T23:10:21Z", "text": "Nope.  No virtual hosts (neither in apache.conf nor ssl.conf).  Using only the proxy redirects in my apache.conf file."}, {"count": 12, "tags": [], "text": "Can you please attach the ssl.conf, too? Would be useful for further research, I\nthink.\n\nThanks!", "attachment_id": null, "id": 37034, "creator": "nd@perlig.de", "time": "2003-05-10T23:31:50Z", "bug_id": 19711, "creation_time": "2003-05-10T23:31:50Z", "is_private": false}, {"count": 13, "text": "Created attachment 6312\nssl.conf file used with Mod_SSL (modified for security reasons)", "creator": "fehe@hotmail.com", "is_private": false, "id": 37037, "time": "2003-05-11T03:05:42Z", "bug_id": 19711, "creation_time": "2003-05-11T03:05:42Z", "tags": [], "attachment_id": 6312}, {"count": 14, "tags": [], "text": "I have now attached the ssl.conf file.  As before, I have made modifications to paths, names, etc., for security reasons.\n\nRegarding your previous question about virtual hosts in the ssl.conf file, I guess practically my whole ssl.conf entries are within a virtualhost definition; however, it points to the exact same website I would be connecting to even if I disabled Mod_SSL.  Are you suspecting that this could be a problem?", "is_private": false, "id": 37038, "creator": "fehe@hotmail.com", "time": "2003-05-11T03:07:45Z", "bug_id": 19711, "creation_time": "2003-05-11T03:07:45Z", "attachment_id": null}]
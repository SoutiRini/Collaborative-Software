[{"count": 0, "tags": [], "text": "I'm using isapi_redirect.dll 1.2.15 on IIS-6 Windows 2003 server and seems \nthat isapi_redirect is not respecting the underscores of the header \nlines. \nIs there someone else how is having this problem. And how can i solve this \nproblem?\n \nHere is a small part of my logging:\n \nLogging of the headers on HTTP port 80 IIS6:\n\n\tPOST /mapxtreme471/mapxtreme HTTP/1.1 \n\t Content-Type: text/xml \n\n\t MI_XMLProtocolRequest: ServerCapabilitiesRequest \n\t MI_XMLProtocolVersion: \nMI_XML_Protocol_ServerCapabilitiesRequest_4_7_1 \n\n\t User-Agent: Mozilla/4.0 (Windows 2003 5.2) Java/1.5.0_06 \n\t Host: holds002 \n\t Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 \n\t Connection: keep-alive \n\t Content-Length: 217 \n\n\t <?xml version=\"1.0\" encoding=\"UTF-8\"?> \n\t <!DOCTYPE RequestEnvelope SYSTEM\n\"MI_XML_Protocol_ServerCapabilitiesRequest_4_7_1.dtd\"> \n\t <RequestEnvelope><ServerCapabilitiesRequest\nGetXMLEncoding=\"true\" /></RequestEnvelope> \n\nLogging of the headers on AJP13 port 8009 Tomcat 5.0.30\n\n\t.4.s....HTTP/1.1.../mapxtreme471/mapxtreme..\n\t10.0.0.160..\n\t10.0.0.160...holds002..P......\n\tkeep-alive.....217.....text/xml....4text/html, image/gif, image/jpeg, \n*; q=.2, */*; q=.2.....holds002....,Mozilla/4.0 (Windows\n2003 5.2)\nJava/1.5.0_06...mi-xmlprotocolrequest...ServerCapabilitiesRequest...mi-x\nmlprotocolversion../MI_XML_Protocol_ServerCapabilitiesRequest_4_7_1.....\n......4....<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n\t<!DOCTYPE RequestEnvelope SYSTEM\n\"MI_XML_Protocol_ServerCapabilitiesRequest_4_7_1.dtd\">\n\n\t<RequestEnvelope><ServerCapabilitiesRequest\nGetXMLEncoding=\"true\" /></RequestEnvelope> \n\n\nYou can see the \"_\" is changed to a \"-\" \n\n\tMI_XMLProtocolRequest ==> ajp13 ==> mi-xmlprotocolrequest\n\tMI_XMLProtocolVersion ==> ajp13 ==> mi-xmlprotocolversion\n\t \nCan someone help me ? Is this an isapi_redirect problem or is it an IIS problem ?\n \nGroet\n          Carlos Rutenfrans\n          Lekdijk west 16\n          3961 MC Wijk bij Duurstede\n          Holland\n \n          tel:        06-14255398\n          e-mail:   carlos@holds.nl", "is_private": false, "bug_id": 38895, "id": 86609, "time": "2006-03-08T17:49:37Z", "creator": "carlos@holds.nl", "creation_time": "2006-03-08T17:49:37Z", "attachment_id": null}, {"text": "I'm not an AJP expert, and I've never heard of this bug before, but I'm curious,\ndoes it happen on Tomcat 5.5.16 as well?", "tags": [], "bug_id": 38895, "attachment_id": null, "count": 1, "id": 88085, "time": "2006-04-14T18:40:24Z", "creator": "yoavs@computer.org", "creation_time": "2006-04-14T18:40:24Z", "is_private": false}, {"count": 2, "tags": [], "text": "(In reply to comment #1)\nAs you can see the logging is between IIS 6  port 80 and AJP port 8009. So it's\nbefore you enter Tomcat. I don't think that the version of Tomcat matters for\nthis problem. \nIf you want I can try it with Tomcat 5.5.16, but I think that this problem is\nsomething in ISAPI.", "is_private": false, "bug_id": 38895, "id": 88121, "time": "2006-04-15T07:40:47Z", "creator": "carlos@holds.nl", "creation_time": "2006-04-15T07:40:47Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "Tim.Whittington@orionhealth.com", "attachment_id": null, "id": 133437, "time": "2010-01-07T13:31:47Z", "bug_id": 38895, "creation_time": "2010-01-07T13:31:47Z", "is_private": false, "text": "This is an explicit behaviour in the ISAPI Redirector controlled by a compile time directive (USE_RAW_HEADERS) that exists in all versions of the redirector.\n\nThe redirector can be built in two ways:\n\n1) By default, the headers are queries from IIS using the ALL_HTTP server variable.\nThis results in all the headers being upper cased, the names being prepended with HTTP_ and (undocumented it seems) all dashes being converted to underscores.\nThere is code in the redirector to adjust for all this, but unfortunately it means that the case of header names is lost, and all underscores are converted to dashes.\n\n2) With USE_RAW_HEADERS defined, headers are retrieved in their raw state using the ALL_RAW server variable.\n\nI've confirmed that a build with USE_RAW_HEADERS defined fixes your problem, but I'm not sure why the option is there in the first place (and why the default is to not do this) - perhaps someone with a longer memory can comment.\n\nThis issue should probably be resolved as by design, but I'd like to see if there's a good reason to not have USE_RAW_HEADERS as the default."}, {"count": 4, "tags": [], "creator": "timw@apache.org", "attachment_id": null, "text": "Changed the default behaviour to use ALL_RAW instead of ALL_HTTP to obtain headers, which prevents the CGI style header name munging.\nOld behaviour is available by defining USE_CGI_HEADERS.\n\nWill be part of 1.2.31", "id": 135154, "time": "2010-03-07T21:28:28Z", "bug_id": 38895, "creation_time": "2010-03-07T21:28:28Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 38895, "attachment_id": null, "text": "General comment (without knowing tomcat): HTTP RFC 2616 defines HTTP header field names as case-insensitive. Existing applications will break if suddenly the raw headers are used and the problems may not surface in testing as your test client probably uses the same casing as your server app.\n\nhttp://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2\n\nMy best guess why underscores are converted to hyphens by tomcat is that apache httpd converts in the other direction (in order to generate valid environment variable names for CGI programs).", "id": 139653, "time": "2010-09-03T05:02:02Z", "creator": "jwagner@computing.dcu.ie", "creation_time": "2010-09-03T05:02:02Z", "is_private": false}, {"count": 6, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 139655, "time": "2010-09-03T05:15:56Z", "bug_id": 38895, "creation_time": "2010-09-03T05:15:56Z", "is_private": false, "text": "This is not about Tomcat itself but instead about forwarding requests through a web server reverse proxy. More precisely about using the ISAPI redirector plugin to IIS provided by the Tomcat connectors project.\n\nTraditionally that plugin does some mangling of the request headers before forwarding them to Tomcat (because of using a specific part of the IIS API which behaves similar to the CGI headers convention). After the change, te headers will be forward to Tomcat as is."}]
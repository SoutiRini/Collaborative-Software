[{"count": 0, "tags": [], "bug_id": 3443, "attachment_id": null, "id": 5129, "creation_time": "2001-09-05T13:17:38Z", "time": "2001-09-05T13:17:38Z", "creator": "jemiller@uchicago.edu", "text": "If you have a servlet that uses JNI and loads a native library using a static \ninitializer, you will receive an error message similar to the following when \nthe servlet gets reloaded due to a change.\n\njava.lang.UnsatisfiedLinkError: Native Library <library> already loaded in \nanother classloader", "is_private": false}, {"count": 1, "tags": [], "bug_id": 3443, "attachment_id": null, "id": 5133, "time": "2001-09-05T15:33:42Z", "creator": "remm@apache.org", "creation_time": "2001-09-05T15:33:42Z", "is_private": false, "text": "It's up to the servlet to avoid calling loadLibrary more than once (since that\nthing is VM wide); alternatively, you could also catch the error, but\nunfortunately the same error is thrown when the library is not found.\nI can't think of any workaround to this on the Catalina side (if you can think\nof something, please let me know).\n\nThat will need to be mentioned in the known issues list."}, {"count": 2, "tags": [], "bug_id": 3443, "is_private": false, "text": "I tried using a try/catch block like the following. This did trap the error. \nHowever, that doesn't work because the next time you call a method that is in \nthat library, you receive an error messsage that it isn't found.\n\nFor some reason, it's being loaded by another class loader? What does that \nmean? Does it mean that the first time through the class is being loaded by a \ndifferent class loader? Is there a way to fix that in Tomcat? \n\nAs far as I know, even if there was a way for me to query to see whether the \nlibrary was loaded or not, that wouldn't solve my problem, because it's not in \nthe right class loader?\n\nAs far as I can tell, there isn't anything that I can do about it on the \napplication/servlet side of things.\n\n static\n {\n  try\n  {\n   System.loadLibrary(\"ccso_CCSOConnection\");\n  }\n  catch(UnsatisfiedLinkError e)\n  {\n   if(e.getMessage().indexOf(\"already loaded in another classloader\") != -1)\n   {\n    System.err.println(e);\n   }\n   else\n   {\n    throw e;\n   }\n  }\n }\n\nJon\n", "id": 5135, "time": "2001-09-05T15:53:32Z", "creator": "jemiller@uchicago.edu", "creation_time": "2001-09-05T15:53:32Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 3443, "is_private": false, "text": "You should place the class that loads this native library into a shared\nrepository (such as $CATALINA_HOME/lib) so that it will only be initialized\nonce, rather than initializing it every time your web application is loaded.\n\nThere is nothing a servlet container can do to prevent this problem.\n", "id": 5141, "time": "2001-09-05T22:11:25Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-05T22:11:25Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 3443, "is_private": false, "text": "Thanks Craig, that did the trick. Good thinking. It might be helpful to have \nthat documented somewhere though, assuming it isn't and I haven't seen it. Not \nsure where you would document that though... at any rate, thanks.\n\nJon\n", "id": 5159, "time": "2001-09-06T07:48:01Z", "creator": "jemiller@uchicago.edu", "creation_time": "2001-09-06T07:48:01Z", "attachment_id": null}]
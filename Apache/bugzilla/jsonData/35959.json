[{"count": 0, "tags": [], "bug_id": 35959, "attachment_id": null, "text": "Hi,\n\npeople must enable apache's UseCanonicalName-option to make sure, that mod_jk\nsends the servername (and not the http-hosh-header value) to tomcat.\n\nIt would be nice to leave UseCanonicalName off and instead set a mod_jk specific\noption for it.", "id": 77887, "time": "2005-08-01T07:56:48Z", "creator": "sven.koehler@gmail.com", "creation_time": "2005-08-01T07:56:48Z", "is_private": false}, {"count": 1, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "text": "The servlet spec (@see section 14.2.16) is very specific that \nrequest.getServerName() must be the value of the Host header.", "id": 77890, "time": "2005-08-01T09:21:52Z", "bug_id": 35959, "creation_time": "2005-08-01T09:21:52Z", "is_private": false}, {"count": 2, "text": "I feel a bit misunderstood.\n\nI'm sure, the Servlet Spec is clear about HTTP-Headers. The HTTP-Headers should\nbe transmitted unchanged to Tomcat, no dought!\n\nThe thing i talk about is the AJP13 layer. Beside the headers, mod_jk sends\nanother field. You talked about it in Bug 34648. You called it\nrequest.getLocalName()\n\nI'd like mod_jk to alway send the servername of apache's vhost no matter what\nUseCanonicalName is set to.\n", "bug_id": 35959, "is_private": false, "id": 77891, "time": "2005-08-01T09:39:53Z", "creator": "sven.koehler@gmail.com", "creation_time": "2005-08-01T09:39:53Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 35959, "attachment_id": null, "text": "Addition:\n\nI will refer to http://jakarta.apache.org/tomcat/connectors-doc/common/ajpv13a.html\n\nAJP13_FORWARD_REQUEST contains a field called \"server_name\". I expect this to\nthe what you referred to as request.getLocalName().\n\nI'd like an option for mod_jk, so that field \"server_name\" always matches the\nServerName of apache's vhost - which is not the case AFAIK.", "id": 77892, "time": "2005-08-01T09:48:19Z", "creator": "sven.koehler@gmail.com", "creation_time": "2005-08-01T09:48:19Z", "is_private": false}, {"count": 4, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "This field is meant to implement the new Servlet API call, nothing more, nothing\nless.", "id": 77893, "time": "2005-08-01T09:58:16Z", "bug_id": 35959, "creation_time": "2005-08-01T09:58:16Z", "attachment_id": null}, {"count": 5, "text": "Section 14.2.16 doesn't say anything, how this data is obtained - for example\nwhether the result of getLocalName() is obtained by a DNS-reverselookup or by\nusing the host-header or the name of the host like it is stored in tomcat's config.\n\nWell, there's no secure source for that _except_ a reverselookup. The\nhost-header isn't reliable, so why should the data send by mod_jk be? Well, it\nisn't, since mod_jk sends the host-header if UseCanonicalName iss off and sends\nthe ServerName of apache's vhost if UseCanonicalName is enabled.\n\nSo where's you're point?", "bug_id": 35959, "is_private": false, "id": 77894, "time": "2005-08-01T10:31:37Z", "creator": "sven.koehler@gmail.com", "creation_time": "2005-08-01T10:31:37Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 35959, "text": "Could you please explain your use case? I think it's good, that you can switch\nthe behaviour with UseCanonicalName, because it makes the behaviour of the\nreverse proxy consistent with a single directive. Why do you need to have\nUseCanonicalName set to off and still want mod_jk to send the data extracted\nfrom ServerName to Tomcat?", "id": 112456, "time": "2008-01-03T05:36:36Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-03T05:36:36Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "sven.koehler@gmail.com", "attachment_id": null, "text": "UseCanonialName was simply unwanted by me. I didn't want users to be redirected\nbetween domains just because they hit one of Apache's redirection.\nThat also causes losing of the session, doesn't it?\n\nAt the same time, i wouldn't want to clone a rather complicated VirtualHost\nconfig in Tomcat. Whatever VirtualHost Apache chooses, i want to be sure, which\nHost will be used on the Tomcat side. I'd like a clear association, instead of\ntwo configs which i have to keep in sync.\nActually i ask myself, if any Apache-config can be represented by a Tomcat-config.\n\n\nThe easiest (and only) way for a clean association between Apache and Tomcat\nHosts was (and still is?), to \"UseCanonialName on\" on Apache side and\nuseIPVHosts=\"true\" on Tomcat side.\n", "id": 112478, "time": "2008-01-03T15:12:52Z", "bug_id": 35959, "creation_time": "2008-01-03T15:12:52Z", "is_private": false}, {"count": 8, "text": "I don't really understand your answer, maybe there are to many aspects in it.\n\nCould we start simple: please give a basic setup where your initial statement\napplies:\n\n\"It would be nice to leave UseCanonicalName off and instead set a mod_jk specific\noption for it.\"\n\nPlease give a concrete example.", "bug_id": 35959, "is_private": false, "id": 112520, "time": "2008-01-05T09:31:26Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-05T09:31:26Z", "tags": [], "attachment_id": null}, {"count": 9, "tags": [], "creator": "rainer.jung@kippdata.de", "is_private": false, "text": "No response in nearly 4 years.\nUser didn't provide a concrete use case for the feature.", "id": 150903, "time": "2011-10-25T18:08:21Z", "bug_id": 35959, "creation_time": "2011-10-25T18:08:21Z", "attachment_id": null}, {"count": 10, "tags": [], "creator": "sven.koehler@gmail.com", "attachment_id": null, "text": "(In reply to comment #9)\n> No response in nearly 4 years.\n> User didn't provide a concrete use case for the feature.\n\nUseCanonicalName influences things like redirects on the apache side. As far as I can recall, a redirect will use the canonical name if UseCanonicalName=on. That behaviour of apache can be totally undesired, since obviously the http client would be redirected to another domain and therefor cookies will be invalid \nand whatnot.\n\nOn the other hand, UseCanonicalName=on was the only way to make sure that a http-request that matched a certain vhost on the apache site goes to a specific tomcat vhost. With UseCanonicalName=off you would basically have to adjust the tomcat config so that resembles the apache config with its servernames and serveraliases as close as possible. I'm not sure, if the latter is even possible in any case. The apache configuration language might be more powerful than the tomcat's.\n\nSo with respect to mod_jk, UseCanonicalName=on can be desired  while at the same time UseCanonicalName=off can be desired for redirect on the apache side.", "id": 150913, "time": "2011-10-25T19:03:59Z", "bug_id": 35959, "creation_time": "2011-10-25T19:03:59Z", "is_private": false}, {"count": 11, "text": "I understand the use case.\n\nUsing the canonical name on the Tomcat side is going to trigger the same set of issues (e.g. broken cookies) as it triggers on the httpd side. The subset of users for which this is not a concern is going to be very small.\n\nIt should be possible to configure Tomcat's virtual hosts to align with httpd's. Since this issue was raised Tomcat added limited support for wildcards (see bug 18500).\n\nDepending on the exact requirements, it is likely that other httpd configuration options (mod_headers, mod_rewrite, etc.) can be used to achieve the desired results.", "bug_id": 35959, "is_private": false, "id": 202617, "time": "2017-12-07T10:22:09Z", "creator": "markt@apache.org", "creation_time": "2017-12-07T10:22:09Z", "tags": [], "attachment_id": null}]
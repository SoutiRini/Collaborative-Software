[{"count": 0, "tags": [], "creator": "brian.bothwell@wisdomtools.com", "attachment_id": null, "is_private": false, "id": 12453, "time": "2002-03-28T12:21:46Z", "bug_id": 7572, "creation_time": "2002-03-28T12:21:46Z", "text": "This bug was submitted by Martin Lichtin <martin@lichtin.net> to the old Apache\nbug system back in May 2000:\n\nhttp://bugs.apache.org/index.cgi/full/6127\n\nI discovered this issue when trying to upload large files over slow connections\nto our web application, which uses a light front-end mod_proxy server to pass\nrequests to many heavy mod_perl server.  We were getting the following error on\nthe mod_perl backend servers:\n\nCGI.pm: Server closed socket during multipart read (client aborted?).\n[Tue Mar 26 16:44:59 2002] [error] [client 63.74.45.131] Premature end of script\nheaders: /www/cgi-bin/test.cgi\n\nTurned out the uploads would fail after 300 seconds, the \"Timeout\" value on the\nmod_proxy server.  I confirmed this by setting the Timeout to 10 seconds as well\nas 10000 seconds, and the behavior was as exepected.\n\nI found a link to Martin's bug report, and the included patch applied to both\nour 1.3.20 and 1.3.24 servers fixed the problem. For some reason this bug was\nmissed or ignored, but it or something like it should be added the next Apache\nrelease in order to fix this issue.\n\nthe patch to the 1.3.9 tree \n(proxy_http.c):\n***************\n*** 355,362 ****\n  /* send the request data, if any. */\n\n      if (ap_should_client_block(r)) {\n!       while ((i = ap_get_client_block(r, buffer, sizeof buffer)) > 0)\n            ap_bwrite(f, buffer, i);\n      }\n      ap_bflush(f);\n      ap_kill_timeout(r);\n--- 338,347 ----\n  /* send the request data, if any. */\n\n      if (ap_should_client_block(r)) {\n!       while ((i = ap_get_client_block(r, buffer, sizeof buffer)) > 0) {\n!             ap_reset_timeout(r);\n            ap_bwrite(f, buffer, i);\n+         }\n      }\n      ap_bflush(f);\n      ap_kill_timeout(r);"}, {"count": 1, "tags": [], "bug_id": 7572, "attachment_id": null, "text": "Here's the patch for 1.3.24:\n(just a change of line #'s since 1.3.9)\n---------------------------------------\n\n*** proxy_http.c        Thu Mar 28 13:42:32 2002\n--- proxy_http.c.patched        Thu Mar 28 13:42:17 2002\n***************\n*** 377,384 ****\n\n      /* send the request data, if any. */\n      if (ap_should_client_block(r)) {\n!         while ((i = ap_get_client_block(r, buffer, sizeof buffer)) > 0)\n!             ap_bwrite(f, buffer, i);\n      }\n      ap_bflush(f);\n      ap_kill_timeout(r);\n--- 377,386 ----\n\n      /* send the request data, if any. */\n      if (ap_should_client_block(r)) {\n!       while ((i = ap_get_client_block(r, buffer, sizeof buffer)) > 0) {\n!       ap_reset_timeout(r);\n!       ap_bwrite(f, buffer, i);\n!       }\n      }\n      ap_bflush(f);\n      ap_kill_timeout(r);\n", "id": 12466, "time": "2002-03-28T18:44:16Z", "creator": "brian.bothwell@wisdomtools.com", "creation_time": "2002-03-28T18:44:16Z", "is_private": false}, {"count": 2, "tags": [], "text": "Patch applied.\n", "is_private": false, "bug_id": 7572, "id": 12963, "time": "2002-04-07T19:14:27Z", "creator": "minfrin@sharp.fm", "creation_time": "2002-04-07T19:14:27Z", "attachment_id": null}]
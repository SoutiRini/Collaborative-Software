[{"count": 0, "tags": [], "creator": "hendrul@hotmail.com", "text": "Created attachment 31877\nLineChart example showing the case ROW()-1 which fails\n\nUsually I need to combine the Excel functions: INDIRECT, ADDRESS, ROW and COLUMN in order to avoid reference problems when deleting rows in columns with formulas like:\n\nIF(INDIRECT(ADDRESS(ROW()-1, COLUMN())) > 0, INDIRECT(ADDRESS(ROW()-1, COLUMN())), 0)\n\nHere we check if the value of the cell before the current row is valid (in this case greater than zero) and if so we return that value. \n\nThis works ok on Excel but when evaluating in POI I get an exception with message: \"row index may not be negative\", this only happens with rows when ROW()-1 not when COLUMN()-1. I attached two eclipse projects with a modification of de LineChart example showing the case with ROW()-1 (Failure) and the case with COLUMN()-1 (Pass)", "id": 176936, "time": "2014-08-05T21:32:59Z", "bug_id": 56820, "creation_time": "2014-08-05T21:32:59Z", "is_private": false, "attachment_id": 31877}, {"count": 1, "tags": [], "bug_id": 56820, "attachment_id": 31878, "id": 176937, "time": "2014-08-05T21:35:08Z", "creator": "hendrul@hotmail.com", "creation_time": "2014-08-05T21:35:08Z", "is_private": false, "text": "Created attachment 31878\nLineChart example showing the case COLUMN()-1 which pass"}, {"count": 2, "tags": [], "bug_id": 56820, "attachment_id": null, "text": "Any chance you could re-test with 3.11 beta 1, and verify if the problem still remains or not in that?\n\n(We've done quite a bit of work on the formula parser since 3.10 final)", "id": 176939, "time": "2014-08-05T21:36:35Z", "creator": "apache@gagravarr.org", "creation_time": "2014-08-05T21:36:35Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "hendrul@hotmail.com", "text": "I'll try and reply", "id": 176940, "time": "2014-08-05T21:39:34Z", "bug_id": 56820, "creation_time": "2014-08-05T21:39:34Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "hendrul@hotmail.com", "text": "Same problem with 3.11 beta 2. Both versions falls into line 136 of org.apache.poi.ss.util.CellReference.java there is a TODO saying:\n\n// TODO - \"-1\" is a special value being temporarily used for whole row and whole column area references. \n// so these checks are currently N.Q.R.\n\nI dont know what could this mean.", "id": 176941, "time": "2014-08-05T22:18:46Z", "bug_id": 56820, "creation_time": "2014-08-05T22:18:46Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "apache@gagravarr.org", "text": "Are you able to create a simpler junit test that shows the problem? \n\n(Your sample project doesn't seem to build properly with Maven, so I can't easily test it, and doesn't seem to mention the ROW function anywhere obvious to allow for a simple test)\n\nAs an example, take a look at TestXSSFBugs, at a method like bug56502() - I think that's a similar-ish case and is a nice simple self contained test (just a few lines plus a sample file) that's easy to run + test + fix", "id": 176942, "time": "2014-08-05T22:36:52Z", "bug_id": 56820, "creation_time": "2014-08-05T22:36:52Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "text": "Created attachment 31879\nJUnit test cases describing the issue\n\nA simple test Eclipse, Maven project run from Eclipse or Maven using \"mvn test\". Both tests fails. The test uses version 3.10 FINAL but it's the same result with version 3.11 beta 2", "attachment_id": 31879, "id": 176945, "creator": "hendrul@hotmail.com", "time": "2014-08-06T05:27:13Z", "bug_id": 56820, "creation_time": "2014-08-06T05:27:13Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 56820, "text": "Thanks for this, that helps a lot\n\nBad news - there's no obvious quick fix. It's going to need some time spent with a debugger, watching how the Ptgs get turned into Evals, and what order those then evaluate in, to spot what's going wrong.", "id": 176949, "time": "2014-08-06T14:23:05Z", "creator": "apache@gagravarr.org", "creation_time": "2014-08-06T14:23:05Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 56820, "attachment_id": null, "id": 181480, "time": "2015-03-03T20:19:35Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-03-03T20:19:35Z", "is_private": false, "text": "I tried it with newer versions: 3.11 still fails, but with the latest 3.12-beta1 your tests work fine, therefore I think this was fixed via one of the fixes applied since 3.11. Please reopen if this is still a problem for you with that version."}]
[{"count": 0, "attachment_id": null, "creator": "amz_sid@trashmail.net", "text": "Hi,\n\nWe have installed Apache 2.2.6 with mod_jk 1.2.26.\nWe configured our workers.properties file to as shown below.  However, when\nchecking the JK Status Manager console it shows the property as false.  Also\nwhen testing this at runtime it behaved as switched off.\n\nworker.loadBalancerVxe1.type=lb\nworker.loadBalancerVxe1.balance_workers=server1Node0,server1Node1\nworker.loadbalancerVxe1.sticky_session=True\nworker.loadbalancerVxe1.sticky_session_force=True\n\nWe have tried the value in all lower case and even tried the value '1' but to no\navail.\nWe found that we could switch the property on the fly through the JK Status\nConsole and this worked.", "id": 113400, "time": "2008-02-04T03:22:11Z", "bug_id": 44349, "creation_time": "2008-02-04T03:22:11Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "I tested Apache/2.0.52 with mod_jk/1.2.22 and it picked up the property setting\ncorrectly. ", "attachment_id": null, "id": 113403, "creator": "amz_sid@trashmail.net", "time": "2008-02-04T04:38:28Z", "bug_id": 44349, "creation_time": "2008-02-04T04:38:28Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44349, "text": "(In reply to comment #1)\n> I tested Apache/2.0.52 with mod_jk/1.2.22 and it picked up the property setting\n> correctly. \n\nPlease ignore this last comment as I had checked the behaviour only and not the\nJK Status console with mod_jk/1.2.22.  It still behaves incorrectly in that it\nhas sticky_session_force=True but when one of the servers is down with a session\nalready established it loadbalances to the other server causing errors in our\napplication because we do not have the original session.  Please note that we do\nnot require session replication switched on.", "id": 113405, "attachment_id": null, "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-04T05:01:58Z", "time": "2008-02-04T05:01:58Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 44349, "text": "(In reply to comment #2)\n> (In reply to comment #1)\n> > I tested Apache/2.0.52 with mod_jk/1.2.22 and it picked up the property setting\n> > correctly. \n> \n> Please ignore this last comment as I had checked the behaviour only and not the\n> JK Status console with mod_jk/1.2.22.  It still behaves incorrectly in that it\n> has sticky_session_force=True but when one of the servers is down with a session\n> already established it loadbalances to the other server causing errors in our\n> application because we do not have the original session.  Please note that we do\n> not require session replication switched on.\n\nI have just checked the JK Status Console for mod_jk/1.2.22 and low and behold\nit does not show the sticky_session_force property as True even though it has\nbeen configured.  Has this ever worked?", "id": 113406, "time": "2008-02-04T05:08:58Z", "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-04T05:08:58Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "amz_sid@trashmail.net", "text": "Also I thought it was worth pointing out a nasty side effect due to this issue.\nWe get the following error on the second server in the cluster when the first\nserver is brought down with a session already established (without session\nreplication enabled).\n\n\nLog snippet:\n\n12:49:51,329 INFO  [StandardEngine] Starting Servlet Engine: Apache Tomcat/5.5.17\n.\n.\n12:58:51,817 ERROR [[action]] Servlet.service() for servlet action threw exception\njava.lang.StackOverflowError\n\tat org.apache.catalina.connector.Request.getAttribute(Request.java:835)\n\tat org.apache.catalina.connector.RequestFacade.getAttribute(RequestFacade.java:260)\n\tat\norg.apache.catalina.core.ApplicationHttpRequest.getAttribute(ApplicationHttpRequest.java:221)\n\tat\norg.apache.catalina.core.ApplicationHttpRequest.getAttribute(ApplicationHttpRequest.java:221)\n.\n.\n.", "id": 113408, "time": "2008-02-04T05:30:13Z", "bug_id": 44349, "creation_time": "2008-02-04T05:30:13Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "creator": "rainer.jung@kippdata.de", "text": "This works for me (1.2.26).\n\nPlease do a startup with JkLogLevel debug and look for the following lines in\nyou jk log file:\n\n[Mon Feb 04 23:09:43.003 2008] [15514:1] [debug] jk_map_read_property::jk_map.c\n(492): Adding property 'worker.loadbalancer.sticky_session_force' with value\n'True' to map.\n\nwhen parsing the workers.properties and\n\n[Mon Feb 04 23:09:43.009 2008] [15514:1] [debug] jk_map_dump::jk_map.c (590):\nDump of map: 'worker.loadbalancer.sticky_session_force' -> 'True'\n\nafter reading the full config.\n\nIn case your results differ, you haven't given enough configuration to analyze\nthe problem (full workers.properties, all relevant httpd JK directives and vhost\nstructure in httpd.\n\nIf you get the same lines during startup, then we would want to check the shm\nfile (JkShmFile). There should be startup lines similar to:\n\n[Mon Feb 04 23:09:43.002 2008] [15514:1] [debug] do_shm_open::jk_shm.c (402):\nTruncated shared memory to 28800\n[Mon Feb 04 23:09:43.002 2008] [15514:1] [debug] do_shm_open::jk_shm.c (447):\nInitialized shared memory size=28800 free=28672 addr=0xfef60000\n[Mon Feb 04 23:09:43.003 2008] [15514:1] [debug] do_shm_open_lock::jk_shm.c\n(321): Opened shared memory lock /my/httpd/path/logs/jk-runtime-status.15514.lock\n[Mon Feb 04 23:09:43.003 2008] [15514:1] [debug] init_jk::mod_jk.c (2775):\nInitialized shm:/my/httpd/path/logs/jk-runtime-status.15514 (28672 bytes)\n[Mon Feb 04 23:09:43.018 2008] [15514:1] [debug] jk_lb_push::jk_lb_worker.c\n(288): syncing shm for lb 'loadbalancer' from mem\n\nFinally: I don't expect the StackOverflow on the Tomcat side to be related to\nthis. 5.5.17 is now very outdated, we are at 5.5.25 and close to 5.5.26.\n\nRegards,\n\nRainer\n", "id": 113417, "time": "2008-02-04T14:14:11Z", "bug_id": 44349, "creation_time": "2008-02-04T14:14:11Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 44349, "text": "Created attachment 21467\nmod_jk.log in debug mode\n\nmod_jk.log in debug mode", "id": 113425, "attachment_id": 21467, "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-05T02:28:54Z", "time": "2008-02-05T02:28:54Z", "is_private": false}, {"count": 7, "tags": [], "text": "Created attachment 21468\nhttpd.conf file\n\nhttpd.conf file attached.", "attachment_id": 21468, "id": 113426, "creator": "amz_sid@trashmail.net", "time": "2008-02-05T02:42:09Z", "bug_id": 44349, "creation_time": "2008-02-05T02:42:09Z", "is_private": false}, {"count": 8, "tags": [], "creator": "amz_sid@trashmail.net", "attachment_id": 21469, "id": 113427, "time": "2008-02-05T02:45:01Z", "bug_id": 44349, "creation_time": "2008-02-05T02:45:01Z", "is_private": false, "text": "Created attachment 21469\nmod-jk.conf ) attached"}, {"count": 9, "tags": [], "text": "Created attachment 21470\nworkers.properties attached", "is_private": false, "id": 113428, "creator": "amz_sid@trashmail.net", "time": "2008-02-05T02:46:26Z", "bug_id": 44349, "creation_time": "2008-02-05T02:46:26Z", "attachment_id": 21470}, {"count": 10, "tags": [], "bug_id": 44349, "is_private": false, "id": 113429, "attachment_id": 21471, "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-05T02:47:21Z", "time": "2008-02-05T02:47:21Z", "text": "Created attachment 21471\nuriworkermap.properties attached"}, {"count": 11, "tags": [], "bug_id": 44349, "is_private": false, "id": 113430, "attachment_id": null, "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-05T02:57:09Z", "time": "2008-02-05T02:57:09Z", "text": "(In reply to comment #5)\nThanks for the information.  We have tried the JkLogLevel debug mode and checked\nwhat you have asked to be checked.  We have attached all the files to this\nticket for analysis.\nIt now seems that the property is read correctly according to the log (see\nmod_jk.log). However, the JK Status Manager reports the session_sticky_force\nproperty as false for all the load balancers.  Also, the behaviour is as if it\nis switched off."}, {"count": 12, "tags": [], "creator": "pr@objektpark.de", "text": "I also check this and it works for me.\n\nTested with apache 2.2.6 and mod_jk 1.2.26 \nchecked with  JkWorkerProperty and extern worker.properties config.\n\nThe attachted mod-jk log says that both attributes are reading correct.\n \nVery Strange effect!", "id": 113432, "time": "2008-02-05T05:01:24Z", "bug_id": 44349, "creation_time": "2008-02-05T05:01:24Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 44349, "attachment_id": null, "is_private": false, "id": 113433, "time": "2008-02-05T05:28:40Z", "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-05T05:28:40Z", "text": "(In reply to comment #12)\n> I also check this and it works for me.\n> \n> Tested with apache 2.2.6 and mod_jk 1.2.26 \n> checked with  JkWorkerProperty and extern worker.properties config.\n> \n> The attachted mod-jk log says that both attributes are reading correct.\n>  \n> Very Strange effect!\n\nPeter, does your JK Status Manager console report the sticky session force\nproperty as true?"}, {"count": 14, "tags": [], "text": "Yes, it works for me!\n\nIt reported at jkstatus and sticky_session_force=true works as expected.\n\n", "is_private": false, "bug_id": 44349, "id": 113434, "time": "2008-02-05T06:37:50Z", "creator": "pr@objektpark.de", "creation_time": "2008-02-05T06:37:50Z", "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 44349, "attachment_id": null, "text": "Thanks for the attachments. They look fine (config and debug log).\nSo we would need to investigate, why the worker config isn't shown correctly in\nthe status worker. The communication between the worker config and the status\nworker display is done by shared memory. So:\n\nAre you able to see the file\n\n/usr/local/apache-2.2.6/logs/jk.shm.PID\n\n(PID is the process ID of the main httpd process) after starting httpd?\nIf so: could you provide the file? I would then try to inspect it's contents to\ncheck, if either the config is not reflected by the file, or the status worker\ndoesn't get the right contents.\n\nIf we get closer to your problem: are you able to compile the module for\nyourself (in case we would like to add some debug statements)?\n\nWhich compiler do you use and what's your detailed Linux platform?\n\nMany questions, but until now nobody observed this problem.", "id": 113450, "time": "2008-02-05T13:11:58Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-02-05T13:11:58Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 44349, "attachment_id": 21484, "is_private": false, "id": 113477, "time": "2008-02-06T05:40:24Z", "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-06T05:40:24Z", "text": "Created attachment 21484\njk.shm.[PID] attached"}, {"count": 17, "attachment_id": 21485, "creator": "amz_sid@trashmail.net", "text": "Created attachment 21485\njk.shm.[PID] attached", "id": 113478, "time": "2008-02-06T05:42:05Z", "bug_id": 44349, "creation_time": "2008-02-06T05:42:05Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "bug_id": 44349, "text": "The Linux environment running the Apache is:\n\nCentos 4.4 (=Redhat Enterprise Linux 4 update 4)\nLinux Kernel 2.6.9-42.0.10.ELsmp\nGlibc 2.3.4-2.25\n", "id": 113479, "time": "2008-02-06T05:48:03Z", "creator": "amz_sid@trashmail.net", "creation_time": "2008-02-06T05:48:03Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 44349, "is_private": false, "id": 113496, "attachment_id": null, "creator": "rainer.jung@kippdata.de", "creation_time": "2008-02-06T13:02:57Z", "time": "2008-02-06T13:02:57Z", "text": "The file contains sticky_session_force=0 (False/Off).\nCan you confirm, that the file belongs to the startup test which logged\nsticky_session_force=True, i.e. it's timestamp and PID are OK? I want to exclude\nthe possibility, that we are talking about a stale file.\n\nI'll now think about ways, how the wrong information could get into the shm file."}, {"count": 20, "tags": [], "text": "(In reply to comment #19)\n> The file contains sticky_session_force=0 (False/Off).\n> Can you confirm, that the file belongs to the startup test which logged\n> sticky_session_force=True, i.e. it's timestamp and PID are OK? I want to exclude\n> the possibility, that we are talking about a stale file.\n> \n> I'll now think about ways, how the wrong information could get into the shm file.\n\nI have just:\n- stopped the Apache processes.\n- cleared out all [APACHE_INSTALL]/logs/jk.shm.* files.\n- Checked that the workers.properties is configured with sticky_session_force=True.\n- Started the Apache process up again.\n- found the files:\n    - [APACHE_INSTALL]/logs/jk.shm.3597.lock\n    - [APACHE_INSTALL]/logs/jk.shm.3597\n- checked the Apache process and it was 3597.\n- I will attach jk.shm.3597 file to the ticket too.", "is_private": false, "id": 113508, "creator": "amz_sid@trashmail.net", "time": "2008-02-07T00:54:16Z", "bug_id": 44349, "creation_time": "2008-02-07T00:54:16Z", "attachment_id": null}, {"count": 21, "tags": [], "text": "Created attachment 21489\njk.shm.3597", "attachment_id": 21489, "id": 113509, "creator": "amz_sid@trashmail.net", "time": "2008-02-07T00:57:28Z", "bug_id": 44349, "creation_time": "2008-02-07T00:57:28Z", "is_private": false}, {"count": 22, "tags": [], "bug_id": 44349, "is_private": false, "text": "Sorry for the long delay.\n\nCould you please retest with version 1.2.32 is the problem persists?\nThere have been multiple changes to the SHM handling, so it could well be that the problem is gone.\n\nThanks!", "id": 150910, "time": "2011-10-25T18:30:20Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-10-25T18:30:20Z", "attachment_id": null}, {"count": 23, "tags": [], "bug_id": 44349, "is_private": false, "id": 179968, "attachment_id": null, "creator": "rainer.jung@kippdata.de", "creation_time": "2014-12-22T18:24:20Z", "time": "2014-12-22T18:24:20Z", "text": "I will resolve this as WORKSFORME because lots of people use this with correct display of configuration by the status worker and we didn't have any feedback for years."}]
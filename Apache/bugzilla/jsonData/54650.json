[{"count": 0, "attachment_id": null, "bug_id": 54650, "is_private": false, "id": 165705, "time": "2013-03-07T00:50:16Z", "creator": "lesson_one@21cn.com", "creation_time": "2013-03-07T00:50:16Z", "tags": [], "text": "Program received signal SIGPIPE, Broken pipe.\n[Switching to Thread 0xaf2ddb70 (LWP 2585)]\n0xb7889424 in __kernel_vsyscall ()\n(gdb) bt\n#0  0xb7889424 in __kernel_vsyscall ()\n#1  0xb73eacbe in __libc_writev (fd=118, vector=0xaf2d8cf0, count=1) at ../sysdeps/unix/sysv/linux/writev.c:56\n#2  0xb766e646 in apr_socket_sendv (sock=0xab49478, vec=0xaf2d8cf0, nvec=1, len=0xaf2d8bec) at network_io/unix/sendrecv.c:275\n#3  0x080b3629 in writev_it_all (s=0xab49478, vec=0xaf2d8cf0, nvec=1, len=1460, nbytes=0xaf2d8d94) at core_filters.c:530\n#4  0x080b4832 in ap_core_output_filter (f=0xab49a68, b=0xb9e9b68) at core_filters.c:1078\n#5  0x080a80f9 in ap_content_length_filter (f=0xbb79d80, b=0xbb7ac40) at protocol.c:1363\n#6  0xb72d44e6 in output_filter (f=0xbb7a5b8, bb_in=0xbb7ac40) at apache2_io.c:985\n#7  0xb72a16b0 in ap_proxy_http_process_response (p=0xbb78fc8, r=0xbb79008, backend=0xb4cfd28, origin=0xabc6808, conf=0x9699900, \n    server_portstr=0xaf2dd08f \"\") at mod_proxy_http.c:1826\n#8  0xb72a29c4 in proxy_http_handler (r=0xbb79008, worker=0x96c4be0, conf=0x9699900, url=0xbb7a586 \"http://93.184.71.21/eset_upd/v5/update.ver\", \n    proxyname=0x0, proxyport=0) at mod_proxy_http.c:2083\n#9  0xb72bbf14 in proxy_run_scheme_handler (r=0xbb79008, worker=0x96c4be0, conf=0x9699900, \n    url=0xbb7a586 \"http://93.184.71.21/eset_upd/v5/update.ver\", proxyhost=0x0, proxyport=0) at mod_proxy.c:2438\n#10 0xb72bc9e3 in proxy_handler (r=0xbb79008) at mod_proxy.c:1033\n#11 0x080ba836 in ap_run_handler (r=0xbb79008) at config.c:164\n#12 0x080babf1 in ap_invoke_handler (r=0xbb79008) at config.c:382\n#13 0x080c8950 in ap_process_request (r=0xbb79008) at http_request.c:282\n#14 0x080c59e0 in ap_process_http_connection (c=0xab49628) at http_core.c:190\n#15 0x080c1406 in ap_run_process_connection (c=0xab49628) at connection.c:43\n#16 0x080cefee in process_socket (thd=0x96c50f0, dummy=0x980dc70) at worker.c:588\n#17 worker_thread (thd=0x96c50f0, dummy=0x980dc70) at worker.c:938\n#18 0xb76834f6 in dummy_worker (opaque=0x96c50f0) at threadproc/unix/thread.c:142\n#19 0xb7601e99 in start_thread (arg=0xaf2ddb70) at pthread_create.c:304\n#20 0xb73f2cbe in clone () at ../sysdeps/unix/sysv/linux/i386/clone.S:130\n(gdb) c\nContinuing."}, {"count": 1, "tags": [], "creator": "apache-issuetracker@ashetic.net", "attachment_id": null, "text": "Same problem here...\n\nThis is the gdb run and stack trace:\n\n[Switching to Thread 0x7fffd77eb700 (LWP 26768)]\n0x00007ffff65c4c47 in __libc_writev (fd=<value optimized out>, vector=<value optimized out>, \n    count=<value optimized out>) at ../sysdeps/unix/sysv/linux/writev.c:56\n56\t      result = INLINE_SYSCALL (writev, 3, fd, CHECK_N (vector, count), count);\n\n#0  0x00007ffff65c4c47 in __libc_writev (fd=<value optimized out>, vector=<value optimized out>, \n    count=<value optimized out>) at ../sysdeps/unix/sysv/linux/writev.c:56\n#1  0x00007ffff6ab1726 in apr_socket_sendv (sock=0x7fffd0006cd8, vec=0x7fffd81eb870, nvec=4, len=0x7fffd81eb678)\n    at network_io/unix/sendrecv.c:205\n#2  0x00007ffff7fd3ab3 in writev_it_all (s=0x7fffd0006cd8, vec=0x7fffd81eb870, nvec=4, len=16008, \n    nbytes=0x7fffd81eb9a0) at /usr/src/debug/httpd-2.2.15/server/core_filters.c:321\n#3  0x00007ffff7fd4a65 in ap_core_output_filter (f=0x7fffd00076a0, b=0x7fffbc0e7f78)\n    at /usr/src/debug/httpd-2.2.15/server/core_filters.c:869\n#4  0x00007ffff7fe69c4 in ap_http_chunk_filter (f=0x7fffbc0e8300, b=0x7fffbc0e7f78)\n    at /usr/src/debug/httpd-2.2.15/modules/http/chunk_filter.c:189\n#5  0x00007ffff7fc9a00 in ap_content_length_filter (f=0x7fffbc003e88, b=0x7fffbc0e7f78)\n    at /usr/src/debug/httpd-2.2.15/server/protocol.c:1357\n#6  0x00007ffff5c5c623 in send_parsed_content (f=0x7fffbc0141a8, b=0x7fffbc00da30)\n    at /usr/src/debug/httpd-2.2.15/modules/filters/mod_include.c:3190\n#7  includes_filter (f=0x7fffbc0141a8, b=0x7fffbc00da30)\n    at /usr/src/debug/httpd-2.2.15/modules/filters/mod_include.c:3671\n#8  0x00007ffff7fce63c in default_handler (r=0x7fffbc002978) at /usr/src/debug/httpd-2.2.15/server/core.c:3766\n#9  0x00007ffff7fd5530 in ap_run_handler (r=0x7fffbc002978) at /usr/src/debug/httpd-2.2.15/server/config.c:158\n#10 0x00007ffff7fd8dee in ap_invoke_handler (r=0x7fffbc002978) at /usr/src/debug/httpd-2.2.15/server/config.c:376\n#11 0x00007ffff7fe41f0 in ap_process_request (r=0x7fffbc002978)\n    at /usr/src/debug/httpd-2.2.15/modules/http/http_request.c:282\n#12 0x00007ffff7fe1068 in ap_process_http_connection (c=0x7fffd0006ef0)\n    at /usr/src/debug/httpd-2.2.15/modules/http/http_core.c:190\n#13 0x00007ffff7fdd038 in ap_run_process_connection (c=0x7fffd0006ef0)\n    at /usr/src/debug/httpd-2.2.15/server/connection.c:43\n#14 0x00007ffff7fe9f02 in process_socket (thd=0x7ffff86aca88, dummy=<value optimized out>)\n    at /usr/src/debug/httpd-2.2.15/server/mpm/worker/worker.c:544\n#15 worker_thread (thd=0x7ffff86aca88, dummy=<value optimized out>)\n    at /usr/src/debug/httpd-2.2.15/server/mpm/worker/worker.c:894\n#16 0x00007ffff687f9d1 in start_thread (arg=0x7fffd81ec700) at pthread_create.c:301\n#17 0x00007ffff65ccb5d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:115\n\nIt happens pretty often on a moderately high load server (around 2k requests/s).", "id": 175913, "time": "2014-06-19T20:29:21Z", "bug_id": 54650, "creation_time": "2014-06-19T20:29:21Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 54650, "is_private": false, "id": 175915, "time": "2014-06-19T20:51:25Z", "creator": "trawick@apache.org", "creation_time": "2014-06-19T20:51:25Z", "tags": [], "text": "This is simply what happens in gdb when a write call returns -1/EPIPE.  httpd ignores SIGPIPE as a signal and just deals with -1/EPIPE as return code feedback.  In both of the backtraces in this bug, the peer closed the socket before httpd finished writing some response.  Not uncommon.\n\nIf you need to debug httpd in gdb without getting interrupted like this, try the gdb command \"handle SIGPIPE nostop\"."}, {"count": 3, "attachment_id": null, "bug_id": 54650, "text": "Thanks Jeff for the answer, but i think it doesn't apply.\nThe client was me using curl from another server on the same vlan.\nWhat happens is a uncompleted page (in my case, it's an SSI with a lot of included files).\n\nThanks.", "id": 175917, "time": "2014-06-19T21:29:20Z", "creator": "apache-issuetracker@ashetic.net", "creation_time": "2014-06-19T21:29:20Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 54650, "attachment_id": null, "is_private": false, "id": 175918, "time": "2014-06-19T21:38:05Z", "creator": "trawick@apache.org", "creation_time": "2014-06-19T21:38:05Z", "text": "So the real problem symptom is: \"uncompleted page (in my case, it's an SSI with a lot of included files)\"\n\nIf you get that error while you're in gdb for whatever reason, you have to continue in gdb after gdb's SIGPIPE handling before any timeouts elapse or disable SIGPIPE handling by gdb.\n\nBut I guess you first got the problem symptom (incomplete page), then attached to httpd with gdb to try to see what is going on, then saw the gdb handling of the normal SIGPIPE condition, then reported that as the bug.  Is that correct?  If so, take the issue to the user support mailing list and if that doesn't help then open another bug with the incomplete page as the problem symptom.\n\nThe subject of this bug shouldn't be changed since it should hopefully catch other complaints about the gdb message."}]
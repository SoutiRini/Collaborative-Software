[{"count": 0, "tags": [], "bug_id": 47358, "text": "I'm trying to run the sample code found at the bottom of http://poi.apache.org/spreadsheet/eval.html for re-calculating all formulas in a workbook (I had to modify the code to the following to get it to compile).\n\nFileInputStream fis = new FileInputStream(filename);\n        FileOutputStream out = new FileOutputStream(filename.replaceAll(\".xls\",\"temp.xls\"));\n        org.apache.poi.ss.usermodel.Workbook wb = new HSSFWorkbook(fis); //or new XSSFWorkbook(\"/somepath/test.xls\")\n        FormulaEvaluator evaluator = wb.getCreationHelper().createFormulaEvaluator();\n        for(int sheetNum = 0; sheetNum < wb.getNumberOfSheets(); sheetNum++) {\n            org.apache.poi.ss.usermodel.Sheet sheet = wb.getSheetAt(sheetNum);\n            RoadmapGUIView.updateProgressText(\"Updating sheet \" + sheetNum);\n            for(org.apache.poi.ss.usermodel.Row r : sheet) {\n                for(org.apache.poi.ss.usermodel.Cell c : r) {\n                    if(c.getCellType() == org.apache.poi.ss.usermodel.Cell.CELL_TYPE_FORMULA) {\n                        evaluator.evaluateFormulaCell(c);\n                    }\n                }\n            }\n        }\n        wb.write(out);\n        out.close();\n\nWhen I run the program, I'm getting the error java.lang.RuntimeException: Could not resolve external workbook name 'rm0509.xls'. Workbook environment has not been set up.\n\nrm0509.xls is a linked spreadsheet within the spreadsheet I'm trying to update.\n\nI can't find any information on this error.\n\nCan you help?", "id": 127899, "time": "2009-06-11T12:58:54Z", "creator": "kevinrmckee@hotmail.com", "creation_time": "2009-06-11T12:58:54Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47358, "is_private": false, "text": "P.S. I've tried poi-3.5-beta6-20090402.jar and poi-3.5-beta7-20090611.jar", "id": 127900, "time": "2009-06-11T12:59:33Z", "creator": "kevinrmckee@hotmail.com", "creation_time": "2009-06-11T12:59:33Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 47358, "text": "You need to tell POI about all workbooks involved in the evaluation.  This is done with the method HSSFFormulaEvaluator.setupEnvironment()\n\nYou can get away with not doing this if the cell you are evaluation does not depend on the other workbook(s).  However, in your case the other workbook is required (hence the error).\n\n----    ----\nHere is some sample code:\n\nString dirName = \"c:/somedir/\";\nString bookNameA = \"test.xls\";\nString bookNameB = \"rm0509.xls\";\n\n\nHSSFWorkbook wb = new HSSFWorkbook(new FileInputStream(dirName + bookNameA));\nHSSFWorkbook wbB = new HSSFWorkbook(new FileInputStream(dirName + bookNameB));\n\nHSSFFormulaEvaluator evaluator = new HSSFFormulaEvaluator(wb);\nHSSFFormulaEvaluator feB = new HSSFFormulaEvaluator(wbB);\n\n// Set up the workbook environment for evaluation\nString[] workbookNames = { bookNameA, bookNameB, };\nHSSFFormulaEvaluator[] evaluators = { evaluator, feB, };\nHSSFFormulaEvaluator.setupEnvironment(workbookNames, evaluators);\n\n// do an evaluation\nHSSFCell cell = wb.getSheetAt(0).getRow(0).getCell(0);\nevaluator.evaluateFormulaCell(cell);\n\n----    ----\n\nThis feature is currently only implemented for HSSF.", "id": 127904, "time": "2009-06-11T13:18:06Z", "creator": "josh@apache.org", "creation_time": "2009-06-11T13:18:06Z", "is_private": false, "attachment_id": null}]
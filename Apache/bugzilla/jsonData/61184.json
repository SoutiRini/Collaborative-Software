[{"count": 0, "tags": [], "creator": "brnrd@freebsd.org", "attachment_id": 35052, "text": "Created attachment 35052\nunified diff for httpd 2.4.26-dev\n\nHi,\n\nJust tried building httpd 2.4.26-dev with LibreSSL and ran into some compile failures. These failures are related to the added OpenSSL 1.1 support in 2.4.26.\n\nLibreSSL defines OPENSSL_VERSION_NUMBER as 0x20000000L whereas it does not implement all post-1.0.1f (point of forking) features. LibreSSL added LIBRESSL_VERSION_NUMBER allowing checks.\n\nAttached patches touch mod_ssl and ab. Adding checks for defined(LIBRESSL_VERSION_NUMBER).\n\nHope you can still include these in the release.\n\nThanks,\n\nBernard Spil\nMaintainer of OpenSSL and LibreSSL ports in FreeBSD.", "id": 199184, "time": "2017-06-13T20:07:13Z", "bug_id": 61184, "creation_time": "2017-06-13T20:07:13Z", "is_private": false}, {"count": 1, "attachment_id": 35053, "creator": "brnrd@freebsd.org", "is_private": false, "id": 199185, "time": "2017-06-13T20:38:28Z", "bug_id": 61184, "creation_time": "2017-06-13T20:38:28Z", "tags": [], "text": "Created attachment 35053\nBuild log FreeBSD 11.0-p9\n\nPoudriere logs on FreeBSD 11.0-p9 with LibreSSL replacing OpenSSL in base."}, {"count": 2, "attachment_id": 35054, "bug_id": 61184, "is_private": false, "id": 199186, "time": "2017-06-13T21:08:10Z", "creator": "brnrd@freebsd.org", "creation_time": "2017-06-13T21:08:10Z", "tags": [], "text": "Created attachment 35054\nunified diff for httpd 2.4.26-dev\n\nReplace patches, were incomplete. Built OK but still warnings.\nThis patch-set stopped all compile warnings."}, {"count": 3, "tags": [], "text": "Created attachment 35055\nBuild log FreeBSD 11.0-p9\n\nBuilt with new patch-set", "is_private": false, "bug_id": 61184, "id": 199187, "time": "2017-06-13T21:12:59Z", "creator": "brnrd@freebsd.org", "creation_time": "2017-06-13T21:12:59Z", "attachment_id": 35055}, {"count": 4, "tags": [], "creator": "stefan@eissing.org", "text": "Hmm. This looks ugly. Would it make more sense to re#define Libressl's sense of superiority? Something like\n\n#if defined(LIBRESSL_VERSION_NUMBER) && LIBRESSL_VERSION_NUMBER >= 0x20000000L\n#undef OPENSSL_VERSION_NUMBER\n#define OPENSSL_VERSION_NUMBER 0x1000200eL\n#endif\n\nOr whatever version it currently is closest to? You know better than me.\n\nRegarding the release: how would the impact be, if you need to patch that yourself for debian? I am not sure if we want to restart the already late release only for this. If something else comes up, we can take it in of course.", "id": 199212, "time": "2017-06-15T11:08:34Z", "bug_id": 61184, "creation_time": "2017-06-15T11:08:34Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "stefan@eissing.org", "attachment_id": null, "id": 199213, "time": "2017-06-15T11:09:53Z", "bug_id": 61184, "creation_time": "2017-06-15T11:09:53Z", "is_private": false, "text": "What I mean was\n\n#if defined(LIBRESSL_VERSION_NUMBER) && OPENSSL_VERSION_NUMBER >= 0x20000000L\n..."}, {"count": 6, "attachment_id": 35062, "creator": "brnrd@freebsd.org", "is_private": false, "id": 199302, "time": "2017-06-20T20:13:02Z", "bug_id": 61184, "creation_time": "2017-06-20T20:13:02Z", "tags": [], "text": "Created attachment 35062\nunified diff for Apache 2.4.26"}, {"count": 7, "attachment_id": 35063, "bug_id": 61184, "is_private": false, "id": 199303, "time": "2017-06-20T20:16:29Z", "creator": "brnrd@freebsd.org", "creation_time": "2017-06-20T20:16:29Z", "tags": [], "text": "Created attachment 35063\nBuild log FreeBSD 11.0-p9\n\nI went through the code more rigorously checking diff between 2.4.25 and 2.4.26 for changes that I needed to tend to. Further to that I verified method availability in LibreSSL 2.5.4.\n\nPlease do review this thoroughly!\n\nThanks,\n\nBernard."}, {"count": 8, "attachment_id": 35070, "creator": "brnrd@freebsd.org", "is_private": false, "id": 199357, "time": "2017-06-23T08:28:37Z", "bug_id": 61184, "creation_time": "2017-06-23T08:28:37Z", "tags": [], "text": "Created attachment 35070\nunified diff for Apache 2.4.26\n\nUpdated patch for support/ab.c\n\"next release of LibreSSL (2.6.x) will contain SSL_CTX_set_{min,max}_proto_version() and it is already available in -current.\" see https://github.com/libressl-portable/openbsd/commit/56f107201baefb5533486d665a58d8f57fd3aeda"}, {"count": 9, "tags": [], "creator": "ylavic.dev@gmail.com", "text": "(In reply to Bernard Spil from comment #8)\n> \n> \"next release of LibreSSL (2.6.x) will contain\n> SSL_CTX_set_{min,max}_proto_version() and it is already available in\n> -current.\"\n\nSo wouldn't somethig like:\n    #if defined(LIBRESSL_VERSION_NUMBER) \\\n        && !defined(SSL_CTRL_SET_MIN/MAX_PROTO_VERSION)\nor:     && !defined(SSL_CTX_set_min/max_proto_version)\nbe relevant right now?\n\nAlso, instead of:\n    #if OPENSSL_VERSION_NUMBER < 0x10100000L \\\n        || defined(LIBRESSL_VERSION_NUMBER)\nall over the place, couldn't we:\n    #if OPENSSL_VERSION_NUMBER >= 0x10100000L \\\n        && !defined(LIBRESSL_VERSION_NUMBER)\n    #define MODSSL_HAVE_SSL_1_1_API 1\n    #endif\nand test this instead (maybe with a better name)?\n\n\nThanks for the patch anyway! I plan to commit it but wanted your/team's feedbacks on this change before.", "id": 199380, "time": "2017-06-24T11:36:24Z", "bug_id": 61184, "creation_time": "2017-06-24T11:36:24Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "text": "I think you also need to change ssl_engine_vars.c line 117-121.\n\n#if OPENSSL_VERSION_NUMBER < 0x10100000L || defined(LIBRESSL_VERSION_NUMBER)\n        md = EVP_get_digestbynid(OBJ_obj2nid(x->sig_alg->algorithm));\n#else\n        md = EVP_get_digestbynid(X509_get_signature_nid(x));\n#endif\n\n\nOtherwise, I get the following error when starting the server:\n\nhttpd: Syntax error on line 139 of /usr/local/apache2/conf/httpd.conf: Cannot load modules/mod_ssl.so into server: Error relocating /usr/local/apache2/modules/mod_ssl.so: X509_get_signature_nid: symbol not found", "is_private": false, "bug_id": 61184, "id": 199479, "time": "2017-06-29T06:31:59Z", "creator": "bz.apache.org@chsc.dk", "creation_time": "2017-06-29T06:31:59Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 61184, "attachment_id": null, "text": "Committed to trunk in r1803396 and proposed for backport to 2.4.x.", "id": 200108, "time": "2017-07-29T23:34:16Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2017-07-29T23:34:16Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 61184, "attachment_id": null, "text": "Backported to 2.4.28 in r1807734.", "id": 201274, "time": "2017-10-03T12:02:41Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2017-10-03T12:02:41Z", "is_private": false}]
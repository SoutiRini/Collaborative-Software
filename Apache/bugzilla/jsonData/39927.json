[{"attachment_id": null, "tags": [], "creator": "matthew@linuxfromscratch.org", "is_private": false, "count": 0, "id": 90743, "time": "2006-06-28T22:07:55Z", "bug_id": 39927, "creation_time": "2006-06-28T22:07:55Z", "text": "Using Ubuntu 6.06 with gcj-4.1.0 installed, FOP trunk fails to build:\n\n    [echo] Apache Ant version 1.6.5 compiled on October 26 2005\n     [echo] VM: 4.1.0 (Ubuntu 4.1.0-1ubuntu8), Free Software Foundation, Inc.\n     [echo] JAVA_HOME: /usr/lib/jvm/java-gcj/\n     [echo] Jimi Support NOT Present\n     [echo] JAI Support NOT Present\n     [echo] JCE Support PRESENT\n     [echo] JUnit Support NOT Present - Committers are required to have JUnit\nworking\n     [echo] XMLUnit Support NOT Present - you can get it from\nhttp://xmlunit.sourceforge.net\n\n...\n\n    [style] Processing /home/matthew/fop-trunk/src/codegen/encodings.xml to\n/home/matthew/fop-trunk/build/gensrc/org/apache/fop/fonts/CodePointMapping.java\n    [style] Loading stylesheet\n/home/matthew/fop-trunk/src/codegen/code-point-mapping.xsl\n    [style] Failed to process /home/matthew/fop-trunk/src/codegen/encodings.xml\n\nBUILD FAILED\n/home/matthew/fop-trunk/build.xml:315: java.lang.NullPointerException\n\nI'm not sure whether this is a bug in FOP or a bug in GCJ or even in Xalan. \nSearching Ubuntu's bug database (https://launchpad.net/distros/ubuntu/+bugs),\nthere are no hits for either FOP (not surprising, as FOP isn't currently\npackaged) or NullPointerException.\n\nLet me know how I can help in debugging this one as I'm eager to get FOP\nbuildable under Ubuntu before 1.0!"}, {"count": 1, "tags": [], "text": "Created attachment 18545\nLog of build failure\n\nBuild log captured using `ant -verbose`", "attachment_id": 18545, "id": 90744, "creation_time": "2006-06-28T22:08:54Z", "time": "2006-06-28T22:08:54Z", "creator": "matthew@linuxfromscratch.org", "bug_id": 39927, "is_private": false}, {"count": 2, "tags": [], "creator": "jeremias@apache.org", "attachment_id": null, "text": "The exception clearly happens in GNU Classpath's XSLT implementation\n(gnu.xml.transform) which I've had rather bad experiences with. Frankly, I don't\nunderstand why those guys reinvented the wheel instead of using Xerces and Xalan\nbut I guess it's because they think the Apache License is not compatible with\nthe GPL/LGPL. Either try to work with them to fix their bug or try to replace\ntheir JAXP implementation with the latest Apache one (I don't know how to do\nthis with GCJ). I assume you'll run into additional problems with gnu.transform\nwhen you've overcome this problem.\n\nBesides that, I'm grateful for your willingness to help make FOP work with GCJ.\nI'm looking into this, too, but only as a side-show. So your help is welcome.\nLet's keep this issue open as a communication platform for this issue. I've\nadjusted the subject slightly to adjust for that.", "id": 90752, "time": "2006-06-29T08:46:22Z", "bug_id": 39927, "creation_time": "2006-06-29T08:46:22Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "matthew@linuxfromscratch.org", "is_private": false, "count": 3, "id": 90767, "time": "2006-06-29T17:07:35Z", "bug_id": 39927, "creation_time": "2006-06-29T17:07:35Z", "text": "Thanks for the quick response, Jeremias.  There don't appear to be any relevant\nbugs on either Ubuntu or GCC upstream using search terms like 'gcj' or\n'transform'.  Plan of attack is:\n\n1. Build GCC-SVN to see if the bug still exists\n2. If it does, reduce the testcase then report it to GCC upstream and to Ubuntu,\nlinking to the upstream bug.\n3. If the bug no longer exists in GCC-SVN, ascertain which patch fixed it and\nbackport it for inclusion in Ubuntu.\n\nRegards,\n\nMatt."}, {"attachment_id": null, "tags": [], "creator": "matthew@linuxfromscratch.org", "is_private": false, "count": 4, "id": 91745, "time": "2006-07-31T18:54:07Z", "bug_id": 39927, "creation_time": "2006-07-31T18:54:07Z", "text": "Sorry for taking so long on this.  I'm still able to reproduce the bug having\nupgraded to gcc-4.1.1, so I've raised a bug at\nhttp://gcc.gnu.org/bugzilla/show_bug.cgi?id=28555 to see whether the\ngcc/classpath folks can help us out."}, {"attachment_id": null, "tags": [], "creator": "matthew@linuxfromscratch.org", "text": "Well, I've finally got passed those transform errors with the patch at\nhttp://gcc.gnu.org/bugzilla/attachment.cgi?id=11991.  Now, my next problem is\nthat  tools.jar provided by java-gcj-compat wants the Eclipse Compiler for Java\n(ecj) installed:\n\ncompile-java:\n    [mkdir] Created dir: /sources/blfs/fop-0.92beta/build/classes\n    [javac] Compiling 732 source files to /sources/blfs/fop-0.92beta/build/classes\n    [javac] java-gcj-compat: tools.jar: failed to read\n/usr/share/java/eclipse-ecj.jar\n\nQuite why it needs ecj when gcj's already installed I don't know.  Oh well,\nafter trying to avoid having two Java compilers it looks like I'm going to need\nthem anyway!", "count": 5, "id": 91802, "time": "2006-08-02T09:50:32Z", "bug_id": 39927, "creation_time": "2006-08-02T09:50:32Z", "is_private": false}, {"count": 6, "tags": [], "text": "And now I seem to have hit a pretty big problem!  I'm hoping it's just an\nincorrectly configured environment:\n\n    [javac] Compiling 732 source files to /sources/blfs/fop-0.92beta/build/classes\n    [javac] ----------\n    [javac] 1. ERROR in\n/sources/blfs/fop-0.92beta/build/gensrc/org/apache/fop/fonts/CodePointMapping.java\n    [javac]  (at line 1)\n    [javac]\n    [javac] package org.apache.fop.fonts;\n    [javac]     ^\n    [javac] The type java.lang.Object cannot be resolved. It is indirectly\nreferenced from required .class files\n    [javac] ----------\n    [javac] 1 problem (1 error)\n", "is_private": false, "bug_id": 39927, "id": 91804, "time": "2006-08-02T10:44:54Z", "creator": "matthew@linuxfromscratch.org", "creation_time": "2006-08-02T10:44:54Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "matthew@linuxfromscratch.org", "text": "In the meantime, it looks as if there's another bug in GCJ's 'transform'\npackage, or it's not being passed an option it requires. The generated\nCodePointMappings.java contains lot's of XML entities such as '&lt;', '&gt;' and\n'&amp;'.  So, for whatever reason, they're not getting resolved to their\nrespective '<', '>' & '&' characters!", "count": 7, "id": 91805, "time": "2006-08-02T11:55:19Z", "bug_id": 39927, "creation_time": "2006-08-02T11:55:19Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "jeremias@apache.org", "is_private": false, "count": 8, "id": 91806, "time": "2006-08-02T11:55:50Z", "bug_id": 39927, "creation_time": "2006-08-02T11:55:50Z", "text": "I'm no specialist in that particular area, but both your last two comments make\nme suspect that the real problem lies somewhere in Ant or rather its javac task.\nAFAIK, GCJ can compile to .class files directly, i.e. it doesn't really need the\nEclipse Java Compiler. Maybe Ant does not deal correctly with your environment\nselecting the right way to compile. Comment #6 goes in a similar direction. If\nit doesn't find java.lang.Object it means the compiler has no class library at\nits disposal. Ok, FOP's Ant build is not customized for use with GCJ, but I'd\nexpect the javac task to behave more or less the same whether you have a Sun JDK\nor GCJ on your machine. Anyway, I'd check the Ant manual and FAQ for any clues\nabout problems like this."}, {"count": 9, "text": "(In reply to comment #7)\n> In the meantime, it looks as if there's another bug in GCJ's 'transform'\n> package, or it's not being passed an option it requires. The generated\n> CodePointMappings.java contains lot's of XML entities such as '&lt;', '&gt;' and\n> '&amp;'.  So, for whatever reason, they're not getting resolved to their\n> respective '<', '>' & '&' characters!\n\nOuch. That's a pretty basic thing. Maybe it would be worthwhile investigating if\nyou can inject Xerces/Xalan to replace the default JAXP set to avoid any nasty\nproblems with this.", "bug_id": 39927, "is_private": false, "id": 91807, "time": "2006-08-02T11:58:10Z", "creator": "jeremias@apache.org", "creation_time": "2006-08-02T11:58:10Z", "tags": [], "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 39927, "text": "(In reply to comment #9)\n> (In reply to comment #7)\n> > In the meantime, it looks as if there's another bug in GCJ's 'transform'\n> > package, or it's not being passed an option it requires. The generated\n> > CodePointMappings.java contains lot's of XML entities such as '&lt;', '&gt;' and\n> > '&amp;'.  So, for whatever reason, they're not getting resolved to their\n> > respective '<', '>' & '&' characters!\n> \n> Ouch. That's a pretty basic thing.\n\nWell, having had a quick look at code-point-mapping.xsl and the XSLT spec at\nhttp://www.w3.org/TR/xslt#disable-output-escaping I think GNU's transform is\nactually conformant as there is no explicit instruction, that I can see, to tell\nit to not output conformant XML.", "id": 91808, "time": "2006-08-02T12:07:21Z", "creator": "matthew@linuxfromscratch.org", "creation_time": "2006-08-02T12:07:21Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "(In reply to comment #10)\n> (In reply to comment #9)\n> > (In reply to comment #7)\n> > > In the meantime, it looks as if there's another bug in GCJ's 'transform'\n> > > package, or it's not being passed an option it requires. The generated\n> > > CodePointMappings.java contains lot's of XML entities such as '&lt;',\n'&gt;' and\n> > > '&amp;'.  So, for whatever reason, they're not getting resolved to their\n> > > respective '<', '>' & '&' characters!\n> > \n> > Ouch. That's a pretty basic thing.\n> \n> Well, having had a quick look at code-point-mapping.xsl and the XSLT spec at\n> http://www.w3.org/TR/xslt#disable-output-escaping I think GNU's transform is\n> actually conformant as there is no explicit instruction, that I can see, to tell\n> it to not output conformant XML.\n\nBut disable-output-escaping is for the XML output method and we're using the\ntext output method. And it's not the output that's wrong, I think it's the\nparsing of the stylesheet that's not happening as it should. The XSLT should\ninternally work with unescaped characters.", "attachment_id": null, "id": 91809, "creation_time": "2006-08-02T12:15:27Z", "time": "2006-08-02T12:15:27Z", "creator": "jeremias@apache.org", "bug_id": 39927, "is_private": false}, {"attachment_id": null, "tags": [], "creator": "jeremias@apache.org", "is_private": false, "count": 12, "id": 91812, "time": "2006-08-02T13:04:56Z", "bug_id": 39927, "creation_time": "2006-08-02T13:04:56Z", "text": "I tried replacing the JAXP implementation and it actually helped. Getting\n\"access denied\" message when writing into the /usr/share/ant1.6/lib directory\nand being a Unix dummy, I downloaded Ant 1.6.5, extracted it to a new directory,\npointed ANT_HOME to it and symlinked ~/bin/ant to the right place. I then copied\nall JAXP-related JARs from FOP's lib directory to Ant's lib directory. I then\nset build.compiler=gcj in build-local.properties in FOP's home directory. When I\nthen run \"ant\" I get past code generation. However, compilation fails because\ngcj does not find CodePointMapping.java although it has been generated (file is\nthere) and the gcj call looks good. Maybe that helps. No idea though, how to get\npast this one. Maybe you have further ideas."}, {"count": 13, "tags": [], "text": "(In reply to comment #8)\n> I'm no specialist in that particular area, but both your last two comments make\n> me suspect that the real problem lies somewhere in Ant or rather its javac task.\n> AFAIK, GCJ can compile to .class files directly, i.e. it doesn't really need the\n> Eclipse Java Compiler.\n\nWell, this seems to stem from the fact that ANT needs a tools.jar, and that\ncomes from java-gcj-compat.  It's that tools.jar that requires ecj (and no, I've\nnot figured out why yet).\n\n> Comment #6 goes in a similar direction. If\n> it doesn't find java.lang.Object it means the compiler has no class library at\n> its disposal.\n\nYup, google suggest I need an rt.jar which I don't at the moment.  I'm trying to\nfigure out whether gcj or java-gcj-compat should be providing it.\n\n(In reply to comment #11)\n> (In reply to comment #10)\n> > Well, having had a quick look at code-point-mapping.xsl and the XSLT spec at\n> > http://www.w3.org/TR/xslt#disable-output-escaping I think GNU's transform is\n> > actually conformant as there is no explicit instruction, that I can see, to tell\n> > it to not output conformant XML.\n> \n> But disable-output-escaping is for the XML output method and we're using the\n> text output method. And it's not the output that's wrong, I think it's the\n> parsing of the stylesheet that's not happening as it should. The XSLT should\n> internally work with unescaped characters.\n\nYep, having had a longer look at the spec I see that the XSLT processor\nshouldn't be doing any output escaping when using the text output method. So\nyes, I'd agree, it looks like GNU's JAXP implementation is outputting what it\nread in, rather than its internally resolved characters.\n\nAs both libxslt and Xalan output the resolved characters, I've reported this at\nhttp://gcc.gnu.org/bugzilla/show_bug.cgi?id=28572.\n\n\n(In reply to comment #12)\n> I tried replacing the JAXP implementation and it actually helped.\n\nGood to know, but I'm still intent on having things work out of the box with\ngcj.  Yes, I'm a glutton for punishment :-)\n\n> I then set build.compiler=gcj in build-local.properties in FOP's home directory.\n\nDoh!  I've just done this myself and my problem in comment 6 has now gone away.\n\n> However, compilation fails because\n> gcj does not find CodePointMapping.java although it has been generated (file is\n> there) and the gcj call looks good. Maybe that helps. No idea though, how to get\n> past this one. Maybe you have further ideas.\n\nUnfortunately not.  Compilation of CodePointMapping.java is attempted here, but\nobviously bails out when it sees those XML entities!\n\nThanks for your help Jeremias.  Do you mind if we keep this bug open so we can\nkeep track of how GCC are progressing and any other issues I run into further on\ndown the line?  That way everything's in one place in case anyone else is as\ndaft as me and tries to do this!", "is_private": false, "bug_id": 39927, "id": 91813, "time": "2006-08-02T13:48:46Z", "creator": "matthew@linuxfromscratch.org", "creation_time": "2006-08-02T13:48:46Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "matthew@linuxfromscratch.org", "is_private": false, "count": 14, "id": 91815, "time": "2006-08-02T13:57:26Z", "bug_id": 39927, "creation_time": "2006-08-02T13:57:26Z", "text": "After manually using `sed' to resolve those XML entities I get to this:\n\n   [javac]\n/sources/blfs/fop-0.92beta/src/java/org/apache/fop/util/DOMBuilderContentHandlerFactory.java:68:\nerror: Type \u2018ObjectBuiltListener\u2019 not found in declaration of field \u2018obListener\u2019.\n\nAdding \"import org.apache.fop.util.ContentHandlerFactory.ObjectBuiltListener;\"\nworks, but I suspect it's not the right fix?\n\nNow I've hit a really nice one.  GCC's just segfaulted on me while trying to\ncompile layoutmgr/PageBreakingAlgorithm.java :-(\n"}, {"count": 15, "tags": [], "text": "(In reply to comment #13)\n<snip/>\n> Thanks for your help Jeremias.  Do you mind if we keep this bug open so we can\n> keep track of how GCC are progressing and any other issues I run into further on\n> down the line?  That way everything's in one place in case anyone else is as\n> daft as me and tries to do this!\n\nYes, that's ok. Once it works we can write a Wiki or web page to provide\ninstructions for people who want to do the same.\n\n(In reply to comment #14)\n> After manually using `sed' to resolve those XML entities I get to this:\n> \n>    [javac]\n>\n/sources/blfs/fop-0.92beta/src/java/org/apache/fop/util/DOMBuilderContentHandlerFactory.java:68:\n> error: Type \u2018ObjectBuiltListener\u2019 not found in declaration of field \u2018obListener\u2019.\n> \n> Adding \"import org.apache.fop.util.ContentHandlerFactory.ObjectBuiltListener;\"\n> works, but I suspect it's not the right fix?\n\nWell, Sun's compiler can do without so GCJ should probably be able to do the\nsame. Another bug report for you to file. :-(\n\n> Now I've hit a really nice one.  GCC's just segfaulted on me while trying to\n> compile layoutmgr/PageBreakingAlgorithm.java :-(\n\nEeeek. Looks like you'll need nerves of steel to finish this. I'd have given up\nalready for the lack of sufficient motivation. I'd probably resort to compiling\nFOP separately and just concentrate on running it. But I guess if you're\ntracking down all the little problems GCJ will obviously profit.\n\n", "attachment_id": null, "id": 91817, "creation_time": "2006-08-02T14:12:17Z", "time": "2006-08-02T14:12:17Z", "creator": "jeremias@apache.org", "bug_id": 39927, "is_private": false}, {"count": 16, "tags": [], "bug_id": 39927, "attachment_id": null, "id": 91988, "time": "2006-08-06T20:46:36Z", "creator": "matthew@linuxfromscratch.org", "creation_time": "2006-08-06T20:46:36Z", "is_private": false, "text": "FYI, the patch mentioned in comment 5 has just been applied to the GNU Classpath\nrepository.  There are plans to backport most of the core library to the gcc-4.1\nbranch, though no timescales are known at present."}, {"count": 17, "tags": [], "bug_id": 39927, "is_private": false, "text": "gcj is not used by standard fop build process", "id": 157177, "time": "2012-04-04T21:48:40Z", "creator": "gadams@apache.org", "creation_time": "2012-04-04T21:48:40Z", "attachment_id": null}, {"count": 18, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "text": "batch transition resolved+wontfix to closed+wontfix", "id": 158556, "time": "2012-04-30T00:14:40Z", "bug_id": 39927, "creation_time": "2012-04-30T00:14:40Z", "is_private": false}, {"count": 19, "text": "batch transition resolved+wontfix to closed+wontfix; if you believe this remains a bug and can demonstrate it with appropriate input FO file and output PDF file (as applicable), then you may reopen", "bug_id": 39927, "is_private": false, "id": 158601, "time": "2012-04-30T00:17:12Z", "creator": "gadams@apache.org", "creation_time": "2012-04-30T00:17:12Z", "tags": [], "attachment_id": null}]
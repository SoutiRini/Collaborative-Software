[{"count": 0, "tags": [], "creator": "jturnbul@uow.edu.au", "attachment_id": 28029, "is_private": false, "id": 151987, "time": "2011-12-06T03:17:28Z", "bug_id": 52288, "creation_time": "2011-12-06T03:17:28Z", "text": "Created attachment 28029\nTest document that causes the crash\n\nI have just started using POI and I am trying to set the font family for a XWPFRun using XWPFRun#setFontFamily() but it always crashes with a NullPointerException.  I have tried this with POI versions 3.7 and 3.8 Beta 4 with the same results.\n\nThe font exists and the run's text is not null so why would this fail?  I cannot locate the source in question but the actual exception is:\n\njava.lang.NullPointerException\n                at org.apache.poi.xwpf.usermodel.XWPFRun.setFontFamily(XWPFRun.java:465)\n\nDoes anyone know how I can get around this?  Calling XWPFRun#getFontFamily() immediately before trying to set it returns null but I wouldn't have thought that would matter.\n\nThanks,\n\n-jct\n\nHere is the code for a test case to use with the attached document:\n\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.util.Iterator;\n\nimport org.apache.poi.xwpf.usermodel.XWPFDocument;\nimport org.apache.poi.xwpf.usermodel.XWPFParagraph;\nimport org.apache.poi.xwpf.usermodel.XWPFRun;\n\npublic class RunTest {\n\n\tprivate static final String INPUT_FILE_NAME = \"C:\\\\input.docx\";\n\tprivate static final String OUTPUT_FILE_NAME = \"C:\\\\output.docx\";\n\n\tpublic static void main(final String[] args) {\n\t\ttry {\n\t\t\tfinal XWPFDocument doc = new XWPFDocument(new FileInputStream(INPUT_FILE_NAME));\n\t\t\tfinal Iterator<XWPFParagraph> paragraphs = doc.getParagraphsIterator();\n\t\t\twhile (paragraphs.hasNext()) {\n\t\t\t\tfinal XWPFParagraph paragraph = paragraphs.next();\n\t\t\t\tfor (final XWPFRun run : paragraph.getRuns()) {\n\t\t\t\t\tif (run != null) {\n\t\t\t\t\t\tfinal String text = run.getText(0);\n\t\t\t\t\t\tif (text != null) {\n\t\t\t\t\t\t\trun.setFontFamily(\"Times New Roman\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdoc.write(new FileOutputStream(OUTPUT_FILE_NAME));\n\t\t} catch (final Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n}"}, {"count": 1, "tags": [], "bug_id": 52288, "attachment_id": null, "id": 151989, "time": "2011-12-06T03:33:50Z", "creator": "apache@gagravarr.org", "creation_time": "2011-12-06T03:33:50Z", "is_private": false, "text": "I've just tried adding your sample file and testcase to head. Good and bad news - it passes already without any changes needed...\n\nThe test was added in r1210768. I'd suggest you try a recent svn nightly build (or wait a week or two for beta 5), and it should be fixed there"}, {"count": 2, "tags": [], "creator": "jturnbul@uow.edu.au", "attachment_id": null, "is_private": false, "id": 152038, "time": "2011-12-07T02:24:25Z", "bug_id": 52288, "creation_time": "2011-12-07T02:24:25Z", "text": "Thanks.  So it doesn't crash in recent builds but does it actually work as well?  I read somewhere else that setting the font size before setting the font family avoids the NPE but I noticed that it doesn't actually change the font family in the run.  Do you know if this works now that the NPE has been fixed in SVN?  I have not been able to try it yet."}]
[{"count": 0, "tags": [], "creator": "rstoyanchev@yahoo.com", "text": "Created attachment 30129\nA proposed fix\n\nWsServerContainer.findMapping fails with a NullPointerException if there is no matching WsMappingResult. Also WsFilter needs a conditional clause to let the request through if there is no matching mapping.\n\nAttached is a patch.", "id": 166299, "time": "2013-04-01T19:32:18Z", "bug_id": 54781, "creation_time": "2013-04-01T19:32:18Z", "is_private": false, "attachment_id": 30129}, {"count": 1, "tags": [], "text": "Comment on attachment 30129\nA proposed fix\n\n>Index: java/org/apache/tomcat/websocket/server/WsServerContainer.java\n>===================================================================\n>--- java/org/apache/tomcat/websocket/server/WsServerContainer.java\t(revision 1463173)\n>+++ java/org/apache/tomcat/websocket/server/WsServerContainer.java\t(working copy)\n>@@ -232,6 +232,11 @@\n>         SortedSet<TemplatePathMatch> templateMatches =\n>                 configTemplateMatchMap.get(key);\n> \n>+        if (templateMatches == null) {\n>+            // No match\n>+        \treturn null;\n>+        }\n>+\n>         // List is in alphabetical order of normalised templates.\n>         // Correct match is the first one that matches.\n>         Map<String,String> pathParams = null;\n>Index: java/org/apache/tomcat/websocket/server/WsFilter.java\n>===================================================================\n>--- java/org/apache/tomcat/websocket/server/WsFilter.java\t(revision 1463173)\n>+++ java/org/apache/tomcat/websocket/server/WsFilter.java\t(working copy)\n>@@ -120,7 +120,12 @@\n>         } else {\n>             path = req.getServletPath() + pathInfo;\n>         }\n>+\n>         WsMappingResult mappingResult = sc.findMapping(path);\n>+        if (mappingResult == null) {\n>+            chain.doFilter(request, response);\n>+            return;\n>+        }\n> \n>         ServerEndpointConfig sec = mappingResult.getConfig();\n> \n>Index: build.xml\n>===================================================================\n>--- build.xml\t(revision 1463173)\n>+++ build.xml\t(working copy)\n>@@ -1000,8 +1000,9 @@\n>              includeantruntime=\"false\">\n>     </javac>\n> \n>-    <!-- Add sources for examples -->\n>+    <!-- Add sources for examples\n>     <antcall target=\"examples-sources\" />\n>+     -->\n> \n>     <copy file=\"${tomcat-dbcp.jar}\" todir=\"${tomcat.build}/lib\"\n>       failonerror=\"false\"/>", "attachment_id": 30129, "bug_id": 54781, "id": 166300, "time": "2013-04-01T19:34:23Z", "creator": "rstoyanchev@yahoo.com", "creation_time": "2013-04-01T19:34:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54781, "attachment_id": 30130, "id": 166301, "time": "2013-04-01T19:35:24Z", "creator": "rstoyanchev@yahoo.com", "creation_time": "2013-04-01T19:35:24Z", "is_private": false, "text": "Created attachment 30130\nA proposed fix (updated)\n\nAn updated patch containing only the files for the proposed fix."}, {"count": 3, "tags": [], "text": "*** Bug 54806 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 54781, "id": 166420, "time": "2013-04-05T15:22:52Z", "creator": "jfarcand@apache.org", "creation_time": "2013-04-05T15:22:52Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 166794, "time": "2013-04-23T19:58:51Z", "bug_id": 54781, "creation_time": "2013-04-23T19:58:51Z", "is_private": false, "text": "This has been fixed in trunk."}]
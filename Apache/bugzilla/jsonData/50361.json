[{"count": 0, "tags": [], "bug_id": 50361, "text": "Hi, With JSVGCanvas I load predefinded svg skeleton image and add various kind of elements like rectangle, circle, polyline etc later.\nNew elements can be added unlimited numer of times until svg is converted to jpeg using transcoder API fith the folowing lines\n\n        String skeletalImagePath=System.getProperty(\"java.io.tmpdir\")+\"\\\\skeleton.jpg\";\n         try {\n            JPEGTranscoder t = new JPEGTranscoder();\n            // Set the transcoding hints.\n            t.addTranscodingHint(JPEGTranscoder.KEY_QUALITY, new Float(.99));\n            TranscoderInput input = new TranscoderInput(doc);\n           // Create the transcoder output.\n            OutputStream ostream = new FileOutputStream(skeletalImagePath);\n            TranscoderOutput output = new TranscoderOutput(ostream);\n            // Save the image.\n            try {\n                t.transcode(input, output);\n            } catch (TranscoderException et) {\n                et.printStackTrace();\n            }\n            // Flush and close the stream.\n            ostream.flush();\n            ostream.close();\n        } catch (FileNotFoundException eu) {\n            JOptionPane.showMessageDialog(null, eu.getMessage(), \"\",\n                                          JOptionPane.INFORMATION_MESSAGE);\n            eu.printStackTrace();\n        } catch (IOException et) {\n            JOptionPane.showMessageDialog(null, et.getMessage(), \"\",\n                                          JOptionPane.INFORMATION_MESSAGE);\n            et.printStackTrace();\n        }\n\nAfter that if new element is added using folowing function null point exection error appears.\n\n    private void addPMDefect(final int x,final int y,final int bodyPartBoneId, final int id){\n        UpdateManager um = jSVGCanvas1.getUpdateManager();\n        um.getUpdateRunnableQueue().invokeLater(new Runnable() {\n                                                     public void run() {\n        SVGElement svgRoot = svgDocument.getRootElement();\n        String dot1,dot2,dot3, dot4;\n        dot1=Integer.toString(x-15)+\",\"+Integer.toString(y+5);\n        dot2=Integer.toString(x-5)+\",\"+Integer.toString(y-5);\n        dot3=Integer.toString(x+5)+\",\"+Integer.toString(y+5);\n        dot4=Integer.toString(x+15)+\",\"+Integer.toString(y-5);\n\n        Element el = svgDocument.createElementNS (svgNS, \"polyline\");\n        el.setAttributeNS (null, \"fill\", \"none\");\n        el.setAttributeNS (null, \"stroke\", PMDefectColor);\n        el.setAttributeNS (null, \"stroke-width\", \"2\");\n        el.setAttributeNS (null, \"points\", dot1+\" \"+dot2+\" \"+dot3+\" \"+dot4);\n        el.setAttributeNS (null, \"id\", \"observ1\"+Integer.toString(id));\n        svgRoot.appendChild(el);\n            }\n         }\n        );\n    }\n\nError message:\njava.lang.NullPointerException\n\tat org.apache.batik.bridge.CSSUtilities.convertDisplay(CSSUtilities.java:565)\n\tat org.apache.batik.bridge.AbstractGraphicsNodeBridge.getDisplay(AbstractGraphicsNodeBridge.java:158)\n\tat org.apache.batik.bridge.GVTBuilder.build(GVTBuilder.java:134)\n\tat org.apache.batik.bridge.SVGGElementBridge.handleElementAdded(SVGGElementBridge.java:123)\n\tat org.apache.batik.bridge.SVGGElementBridge.handleDOMNodeInsertedEvent(SVGGElementBridge.java:107)\n\tat org.apache.batik.bridge.BridgeContext$DOMNodeInsertedEventListener.handleEvent(BridgeContext.java:1601)\n\tat org.apache.batik.dom.events.EventSupport.fireEventListeners(EventSupport.java:324)\n\tat org.apache.batik.dom.events.EventSupport.fireEventListeners(EventSupport.java:366)\n\tat org.apache.batik.dom.events.EventSupport.dispatchEvent(EventSupport.java:258)\n\tat org.apache.batik.dom.AbstractNode.dispatchEvent(AbstractNode.java:1014)\n\tat org.apache.batik.dom.AbstractParentNode.fireDOMNodeInsertedEvent(AbstractParentNode.java:422)\n\tat org.apache.batik.dom.AbstractParentNode.appendChild(AbstractParentNode.java:224)\n\tat view.JSkeletonCanvas$6.run(JSkeletonCanvas.java:351)\n\tat org.apache.batik.util.RunnableQueue.run(RunnableQueue.java:237)\n\tat java.lang.Thread.run(Thread.java:619)\n\nLine 351 is: svgRoot.appendChild(el);\n\nAm I doind something wrong?\nThanks", "id": 142103, "time": "2010-11-29T04:40:29Z", "creator": "amir.mandzuka@ic-mp.org", "creation_time": "2010-11-29T04:40:29Z", "is_private": false, "attachment_id": null}, {"text": "*** Bug 50362 has been marked as a duplicate of this bug. ***", "tags": [], "creator": "amir.mandzuka@ic-mp.org", "attachment_id": null, "count": 1, "id": 142106, "time": "2010-11-29T04:56:42Z", "bug_id": 50361, "creation_time": "2010-11-29T04:56:42Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 50361, "text": "I believe your problem is that you can not use the Image Transcoder with a document while it is attached to the Canvas (the Image transcoder will replace the canvas's rendering tree with it's own).  \n\nYou need to either clone the document and use the cloned version with the Image transcoder or detach the document from the canvas before transcoding and then attach it again after.", "id": 142110, "time": "2010-11-29T05:47:42Z", "creator": "deweese@apache.org", "creation_time": "2010-11-29T05:47:42Z", "is_private": false, "attachment_id": null}, {"text": "Thanks for quick reply. \nDo you have some link to working example on how to clone SVGDocument.\nI have tried\n        SVGDocument tempDoc;\n\n        try {\n            tempDoc = (SVGDocument)jSVGCanvas1.getSVGDocument().clone();\n        } catch (CloneNotSupportedException e) {\n            e.printStackTrace();\n        }\nand error is raised\nError(5686,65): method clone() not found in interface org.w3c.dom.svg.SVGDocument\n\nAlso \n SVGDocument tempDoc=jSVGCanvas1.getSVGDocument();\n and calling transcoder on tempDoc still corrupts that canvas's rendering tree.\nRegards", "tags": [], "creator": "amir.mandzuka@ic-mp.org", "attachment_id": null, "count": 3, "id": 142113, "time": "2010-11-29T06:28:38Z", "bug_id": 50361, "creation_time": "2010-11-29T06:28:38Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 50361, "text": "For now this seams that it works very well\n\nSVGDocument tempDoc=(SVGDocument)svgDocument.cloneNode(true);\n\nsvgDocument is attached to JSVGCanvas and\ntempDoc is used with transcoder", "id": 142115, "time": "2010-11-29T06:54:37Z", "creator": "amir.mandzuka@ic-mp.org", "creation_time": "2010-11-29T06:54:37Z", "is_private": false, "attachment_id": null}, {"text": "(In reply to comment #4)\n> For now this seams that it works very well\n\nDoes this mean that the issue is now solved? If so, why haven't you closed it (\"invalid\", as Thomas hinted)?\n\nIf the issue is still reproducible, please attach a *reduced* test case and add further information (Java version, operating system, double check Batik version and/or test with a 1.8 development snapshot, etc.), so that further analysis can be done. Note that the issue tracker isn't meant for support requests, those are better aimed at batik-users@ (or batik-dev@ for development-related matters) [2].\n\n\n[1] http://xmlgraphics.apache.org/batik/download.cgi#Current+development+snapshot\n[2] http://xmlgraphics.apache.org/batik/mailing-lists.html", "tags": [], "creator": "helder.magalhaes@gmail.com", "attachment_id": null, "count": 5, "id": 142177, "time": "2010-11-30T05:17:17Z", "bug_id": 50361, "creation_time": "2010-11-30T05:17:17Z", "is_private": false}, {"count": 6, "tags": [], "creator": "amir.mandzuka@ic-mp.org", "attachment_id": null, "is_private": false, "id": 142179, "time": "2010-11-30T05:25:03Z", "bug_id": 50361, "creation_time": "2010-11-30T05:25:03Z", "text": "I thought that this was a bug. It is solved now. Sorry because i left it as still active issue."}]
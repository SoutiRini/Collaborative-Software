[{"count": 0, "tags": [], "text": "When a <macrodef> has a nested <copy> with two nested <fileset>s each of which\nreferencing the same <element>, Ant fails with: \nBUILD FAILED\n/qv/apps/u117424/elements.xml:10: The following error occurred while executing\nthis line:\n/qv/apps/u117424/elements.xml:20: Missing attribute \"name\" for a pattern\n\nHowever this should be a legal operation.\n\nIt appears that the first use of the element is destructive, causing some/all\nelement data to be null upon the second use.\n\ne.g.\n    <copy todir=\"outdir\">\n      <fileset>\n        <myelement/>\n      </fileset>\n      <fileset>\n        <myelement/>   <!-- myelement->* == null !! -->\n     </fileset>\n    </copy>\n\nThe second instance of myelement appears to be nullified by the first.\n\nAttached build.xml to follow demonstrating the failure.", "is_private": false, "bug_id": 39694, "id": 89621, "time": "2006-05-31T16:50:45Z", "creator": "purplefloyd@gmail.com", "creation_time": "2006-05-31T16:50:45Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "purplefloyd@gmail.com", "attachment_id": 18380, "is_private": false, "id": 89622, "time": "2006-05-31T16:53:22Z", "bug_id": 39694, "creation_time": "2006-05-31T16:53:22Z", "text": "Created attachment 18380\nbuild.xml to recreate bug #39694"}, {"count": 2, "tags": [], "creator": "antoine@apache.org", "attachment_id": null, "is_private": false, "id": 89633, "time": "2006-06-01T03:12:11Z", "bug_id": 39694, "creation_time": "2006-06-01T03:12:11Z", "text": "Hi,\nI have tested the attached build file with Ant 1.6.5.\nI can reproduce your error.\nBut the error goes away when using Ant 1.7 alpha (what is currently in SVN).\nSo I mark the bug as closed with target Ant 1.7\nI do not know what fixed it, but there have been a lot of changes, both\naffecting copy which is now implemented with Resources and macrodef.\n\nRegards,\nAntoine"}, {"count": 3, "tags": [], "text": "I've just come across this issue again in Ant 1.6.5 using a non-copy operation.\n So to clarify, it looks to affect anything using an same element in more than\none <fileset> belonging to a single parent task.\n\nThis time I was writing a wrapper around the JAXB xjc task and had, e.g.:\n\n  <macrodef name=\"myxjcwrapper\">\n    <attribute name=\"schema.dir\"/>\n    <element name=\"schema_fileset\"/>\n    <sequential>\n      <xjc>\n        <schema dir=\"@{schema.dir}\">\n          <schema_fileset/>\n        </schema>\n        <depends dir=\"@{schema.dir}\">\n          <schema_fileset/>\n        </depends>\n        <produces file=\"blah\"/>\n      </xjc>\n\nNote the two uses of <schema_fileset>.  The second of which throws the error\nmentioned in the initial bug report.  NB both <schema> and <depends> elements\nare aliased <fileset>s.\n\nFortuantely after reading the xjc docs it is not neccessary to specify a depends\nset if it matches your schema set, so I was able to get around the prob by\nremoving the <depends> set altogether.", "attachment_id": null, "bug_id": 39694, "id": 93799, "time": "2006-09-19T17:23:47Z", "creator": "purplefloyd@gmail.com", "creation_time": "2006-09-19T17:23:47Z", "is_private": false}, {"count": 4, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "id": 93800, "time": "2006-09-19T17:28:11Z", "bug_id": 39694, "creation_time": "2006-09-19T17:28:11Z", "is_private": false, "text": "Can you test with ant 1.7beta2 ?"}, {"count": 5, "tags": [], "text": "Tested with ant 1.7beta2 and it works OK.\n\n", "is_private": false, "id": 93911, "creation_time": "2006-09-20T10:26:59Z", "time": "2006-09-20T10:26:59Z", "creator": "purplefloyd@gmail.com", "bug_id": 39694, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 39694, "is_private": false, "text": "Thanks, peter", "id": 93912, "time": "2006-09-20T10:41:08Z", "creator": "peterreilly@apache.org", "creation_time": "2006-09-20T10:41:08Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 26839, "attachment_id": null, "is_private": false, "id": 52078, "time": "2004-02-10T19:56:15Z", "creator": "apache@pjt33.f2g.net", "creation_time": "2004-02-10T19:56:15Z", "text": "Consider the class\n\npublic class Demo\n{\n    public static void main(String[] args)\n    {\n        Object[] objs = new Integer[1];\n        objs[0] = o();\n    }\n\n    private static Object o()\n    {\n        return null;\n    }\n}\n\nIt compiles fine, and\njava -verify Demo\nexecutes without errors. However,\njava org.apache.bcel.verifier.Verifier Demo\ncomplains:\n\nPass 3b, method number 1 ['public static void main(String[] arg0)']:\nVERIFIED_REJECTED\nConstraint violated in method 'public static void main(String[] arg0)':\nInstruction AASTORE constraint violated: The type of 'value' ('java.lang.Object') is not assignment \ncompatible to the components of the array 'arrayref' refers to. ('java.lang.Integer')\netc.\n\nThe problem is that while the vmspec2 says \"The type of every value stored into an array of type \nreference by an aastore instruction must be assignment compatible (\u00a72.6.7) with the component \ntype of the array\", the class file doesn't contain information on the compile-time component type \nof the array. I suspect the native verifier does nothing about this requirement, leaving the VM to \nthrow an ArrayStoreException if problems arise.\n\nEnver Haase asked me to mention in this report that while the error message says \"assignment \ncompatible to\" and the vmspec2 says \"assignment compatible with\", it's not a case of doing the \ncheck the wrong way round."}, {"count": 1, "tags": [], "creator": "scheng@innaworks.com", "attachment_id": null, "is_private": false, "id": 52079, "time": "2004-02-10T21:29:51Z", "bug_id": 26839, "creation_time": "2004-02-10T21:29:51Z", "text": "Here is my understanding of the problem:\n1. Verification type of objs is Object[]\n2. Run-time type of objs (in this particular case) is Integer[]\n3. Verification type of the result of o() is Object\n\nVerification should pass, since it is purely concerned about verification \ntype. However a run-time error should be thrown if o() return a non-null \nvalue. In this case since o() return null it shouldn't.\n\nscheng@innaworks.com"}, {"count": 2, "attachment_id": null, "bug_id": 26839, "text": "Not quite. A run-time error should be thrown if o() return a non-null value which is not an Integer.", "id": 52137, "time": "2004-02-11T16:38:33Z", "creator": "apache@pjt33.f2g.net", "creation_time": "2004-02-11T16:38:33Z", "tags": [], "is_private": false}]
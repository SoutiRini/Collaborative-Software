[{"count": 0, "tags": [], "bug_id": 14763, "attachment_id": null, "id": 26772, "time": "2002-11-22T10:38:16Z", "creator": "admin@ter-net.com", "creation_time": "2002-11-22T10:38:16Z", "is_private": false, "text": "I run apache (with mpm perchild) on linux with NameBased virtual host in such a way:\n...\n<IfModule perchild.c>\nNumServers           2\nStartThreads         10\nMinSpareThreads      5\nMaxSpareThreads     10\nMaxThreadsPerChild  2000\nMaxRequestsPerChild 1000\nChildPerUserID soloma users 1\nChildPerUserID boris users 1\n</IfModule>\n...\n<VirtualHost *>\n    AssignUserId boris users\n    ServerAdmin webmaster@dummy-host.example.com\n    DocumentRoot /var/home/boris/www/\n    ServerName boris.hosts\n    ErrorLog logs/dummy-host.example.com-error_log\n    CustomLog logs/dummy-host.example.com-access_log common\n</VirtualHost>\n<VirtualHost *>\n    AssignUserId soloma users\n    ServerAdmin webmaster@dummy-host.example.com\n    DocumentRoot /var/home/soloma/www/\n    ServerName soloma.hosts\n    ErrorLog logs/dummy-host.example.com-error_log\n    CustomLog logs/dummy-host.example.com-access_log common\n</VirtualHost>\n\nIn this case both hosts (soloma.hosts, boris.hosts) works from the same user.\n\nPossible reason:\nin function perchild_post_read:\n/////\n      ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,\n                     \"Determining if request should be passed. \"\n                     \"Child Num: %d, SD: %d, sd from table: %d, hostname from\nserver: %s\", child_num,\n                     sconf->input, child_info_table[child_num].input,\n                     r->server->server_hostname);\n        /* sconf is the server config for this vhost, so if our socket\n         * is not the same that was set in the config, then the request\n         * needs to be passed to another child. */\n        if (sconf->input != child_info_table[child_num].input) {\n            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,\n                         \"Passing request.\");\n            if (pass_request(r) == -1) {\n                ap_log_error(APLOG_MARK, APLOG_ERR, 0,\n                             ap_server_conf, \"Could not pass request to proper \"\n                             \"child, request will not be honored.\");\n            }\n            longjmp(jmpbuffer, 1);\n//////////////\n\nI think this is incorrect for several virtual hosts\n\nCorrect version may be like this:\n/////\n       if (sconf->input != child_info_table[child_num].input) {\n\n            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,\n                         \"Passing request.\");\n            for(i=0; i< num_daemons;i++)\n            {\n            if(sconf->input == child_info_table[i].input)\n            {\n                if (pass_request(r, i) == -1) {\n                ap_log_error(APLOG_MARK, APLOG_ERR, 0,\n                             ap_server_conf, \"Could not pass request to proper \"\n                             \"child, request will not be honored.\");\n\n                }\n                break;\n            }\n            }\n            longjmp(jmpbuffer, 1);\n        }\n\n/////"}, {"count": 1, "tags": [], "text": "The perchild MPM is not supported, and not under any development.\n\nThe 'Metux' MPM is being developed outside of mainline apache, and might provide a viable alternative:\nhttp://www.metux.de/mpm/", "is_private": false, "id": 62679, "creator": "chip@force-elite.com", "time": "2004-08-30T01:46:11Z", "bug_id": 14763, "creation_time": "2004-08-30T01:46:11Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 57868, "attachment_id": 32696, "is_private": false, "id": 182699, "time": "2015-04-28T17:15:30Z", "creator": "jose@w3.org", "creation_time": "2015-04-28T17:15:30Z", "text": "Created attachment 32696\nFixes sigsev in mod_authz_dbd when server lacks access rights to the db table\n\nIf the dbd handle preparation fails due to a misconfiguration of the database server or the access rights to the table, the server logs something along these lines:\n\n   AH00632: failed to prepare SQL statements: UPDATE command denied to \n   user 'foo'@'exampleorg' for table 'bar'\n\nAs a consequence, the call to dbd_handle(r) returns NULL. However, in mod_authz_dbd, there was no control for the value of dbd before its being used in both authz_dbd_login() and authzdbd_group():\n\n       ap_dbd_t *dbd = dbd_handle(r);\n       ...\n        query = apr_hash_get(dbd->prepared, <--- SIGSEV\n\nI'm attaching a patch that solves this issue. I didn't check to see if it also occurs in other nz modules based on mod_dbd.c"}, {"count": 1, "tags": [], "creator": "ylavic.dev@gmail.com", "text": "Thanks for the report, but attachment 32696 does not look correct (simple text, not a patch).", "id": 183467, "time": "2015-06-11T15:21:12Z", "bug_id": 57868, "creation_time": "2015-06-11T15:21:12Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57868, "attachment_id": 32811, "text": "Created attachment 32811\nFixes sigsev in mod_authz_dbd when server lacks access rights to the db table\n\nResubmitting as my previous patch upload failed. Sorry about that!\n\nTested with apache_2.4.10, but patch submitted against trunk as this module has not changed between these versions.", "id": 183471, "time": "2015-06-11T15:50:12Z", "creator": "jose@w3.org", "creation_time": "2015-06-11T15:50:12Z", "is_private": false}, {"count": 3, "tags": [], "creator": "ylavic.dev@gmail.com", "text": "Thanks, committed in r1688660.", "id": 183835, "time": "2015-07-01T14:38:01Z", "bug_id": 57868, "creation_time": "2015-07-01T14:38:01Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "christophe.jaillet@wanadoo.fr", "attachment_id": null, "id": 184412, "time": "2015-08-07T15:23:44Z", "bug_id": 57868, "creation_time": "2015-08-07T15:23:44Z", "is_private": false, "text": "(In reply to Jose Kahan from comment #0)\n\n> I didn't check to see if it also occurs in other nz modules based on mod_dbd.c\n\nApparently, ap_dbd_acquire is only used in mod_authz_dbd, mod_authn_dbd, mod_session_dbd and mod_rewrite.\n\nYou fixed the first one.\nmod_authn_dbd and mod_session_dbd already have a test to check for NULL.\nmod_rewrite seems to have the same problem in 'lookup_map_dbd'.\n\nI'll check deeper and propose a patch if confirmed."}, {"count": 5, "tags": [], "creator": "christophe.jaillet@wanadoo.fr", "text": "RewriteMap with MapType bbd or fastdbd has the same issue.\nProposed patch committed in r1695170", "id": 184459, "time": "2015-08-10T21:32:14Z", "bug_id": 57868, "creation_time": "2015-08-10T21:32:14Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 57868, "attachment_id": null, "is_private": false, "id": 184479, "time": "2015-08-11T21:04:07Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2015-08-11T21:04:07Z", "text": "Proposed for backport in r1695378"}, {"count": 7, "tags": [], "text": "This is in 2.4.17", "is_private": false, "bug_id": 57868, "id": 185922, "time": "2015-10-25T05:48:17Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2015-10-25T05:48:17Z", "attachment_id": null}]
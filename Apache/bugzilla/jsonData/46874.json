[{"attachment_id": null, "tags": [], "creator": "gmortellwork@gmail.com", "text": "Overview:\n---------------------------------------------\norg.apache.poi.hssf.usermodel.HSSFWorkbook.getCellStyleAt() method calls the\norg.apache.poi.hssf.model.Workbook.getExFormatAt() method with a short, when it requires an integer index.   This results in the code crashing (see stack trace below).\n\n\nBackground -\n----------------------------------------------\nThis is my first time reporting a bug, so I apologize in advance if I'm missing anything.\n\nI am trying to create a java app to read in an Excel spreadsheet & split it out into multiple spreadsheets, based upon key data.   To do this I need to clone the CellStyles from the input workbook to each of the output workbooks, so dates and currency formats will be the same in the output spreadsheets as they are in the input spreadsheet. \n\nSteps to Reproduce: My Code That Initializes Each Output Workbook -\n-------------------------------------------------------------------\n//Clone the input workbook's CellStyles into the output workbook's CellStyles...\n\nfor (short i = 0 ; i <= inputHSSFWorkbook.getNumCellStyles() ; i++)\n{\n    LOG.info(\"Synchronizing input & output workbook CellStyles...i = \" +i);\n    if (i > numberOfCellStylesOut)\n    {   //create a new CellStyle (blank) and add it to the W/B's CellStyle table.\n        outputHSSFWorkbook.createCellStyle();\n    }\n\n    // Now try to synchronize all of the input & output workbook's CellStyle's.\n    // the 'outputHSSFWorkbook.getCellStyleAt(i)' piece below returns the output workbook's\n    // HSSFCellStyle object at index i.   Clone it from the input CellStyle at index i.\n    outputHSSFWorkbook.getCellStyleAt(i).cloneStyleFrom(inputHSSFWorkbook.getCellStyleAt(i));\n}\n\nnumberOfCellStylesOut = outputHSSFWorkbook.getNumCellStyles();\nLOG.debug(\"After synchronizing Input & Output CellStyle's - The number of CellStyles in this output workbook is \" + numberOfCellStylesOut);\n\nThere were 28 CellStyles in the input workbook and 21 in the new output workbook.  I would expect to now see 28 CellStyles in each output workbook\n\nActual Results: The Stack Trace From the Crash -\n------------------------------------------------\n\n    Exception in thread \"main\" java.lang.ClassCastException: org.apache.poi.hssf.record.StyleRecord\n        at org.apache.poi.hssf.model.Workbook.getExFormatAt(Workbook.java:742)\n        at org.apache.poi.hssf.usermodel.HSSFWorkbook.getCellStyleAt(HSSFWorkbook.java:1125)\n\n\n\nExpected Results:\n-----------------------------------------------\nI expected the code to clone the CellStyles from the input workbook to each of the output workbooks.\n\n\nBuild Date & Platform: \n-----------------------------------------------\nI encountered this on both the 3.2-FINAL build and the 3.5-Beta5 builds.  I think this will only happen on versions 3.2-FINAL and higher, since that is when the cloneStyleFrom() methosd was available.  Here's the MANIFEST.MF file from my POI jar...\n\nManifest-Version: 1.0\nAnt-Version: Apache Ant 1.6.2\nCreated-By: 1.5.0_13-b05 (Sun Microsystems Inc.)\nBuilt-By: yegor\nSpecification-Title: Apache POI\nSpecification-Version: 3.2-FINAL-20081019\nSpecification-Vendor: Apache\nImplementation-Title: Apache POI\nImplementation-Version: 3.2-FINAL-20081019\nImplementation-Vendor: Apache\n\n\nAdditional Information - The Apache POI HSSF Code - \n----------------------------------------------------\norg.apache.poi.hssf.usermodel.HSSFWorkbook.getCellStyleAt() method passes a short to the \norg.apache.poi.hssf.model.Workbook.getExFormatAt() method, which doesn't have a signature to accept a short.   getExFormatAt()'s signature is for an int.\n\nIf the org.apache.poi.hssf.usermodel.HSSFWorkbook.getCellStyleAt() method assigns its input short to an int, it could pass the int in the method call to org.apache.poi.hssf.model.Workbook.getExFormatAt() method.  \n\nI believe that this will work without crashing.   To be honest, I'm not as experienced as most Java developers, so this might not be right.   You folks would know better.\n\nHope this helps,\n\nGerald Mortell", "count": 0, "id": 125615, "time": "2009-03-18T11:42:05Z", "bug_id": 46874, "creation_time": "2009-03-18T11:42:05Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "apache@gagravarr.org", "text": "I'm almost certain that you have two copies of poi in your classpath, and that's what is breaking things. I'd suggest you try the code in the faq for checking where classes come from, and that ought to help you spot your two conflicting versions\n\n(It all works fine for me, and for all the unit tests)", "count": 1, "id": 125770, "time": "2009-03-24T10:00:08Z", "bug_id": 46874, "creation_time": "2009-03-24T10:00:08Z", "is_private": false}]
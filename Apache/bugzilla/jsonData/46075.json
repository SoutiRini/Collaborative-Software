[{"count": 0, "tags": [], "creator": "rich@bitwise-systems.com", "text": "The DefaultFileItem class in pacakge org.apache.tomcat.util.http.fileupload creates a ByteArrayOutputStream of the full threshold size for every control on the submitted form. I have a form with 63 controls (checkboxes, text boxes and one File input), and I set the threshold to 20 Meg to allow upload of large image files into memory. I get an OutOfMemory exception since it tries to allocate 63 lots of 20M, although only 1 control requires the requested size.\n\nI think it would be much more sensible to create the ByteArrayOutputStream with an initial size of only a few kilobytes size it automatically increases its size as data is written to it.", "id": 121814, "time": "2008-10-23T03:35:53Z", "bug_id": 46075, "creation_time": "2008-10-23T03:35:53Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 121929, "time": "2008-10-27T15:43:30Z", "bug_id": 46075, "creation_time": "2008-10-27T15:43:30Z", "is_private": false, "text": "Thanks for the report. I have applied a patch that uses the default (10k) as an initial size unless the threshold is less than 10k in which case the threshold is used.\n\nThe patch has been proposed for 6.0.x"}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "The patch has been applied to 6.0.x and will be included in 6.0.19 onwards.", "id": 122212, "time": "2008-11-05T08:09:42Z", "bug_id": 46075, "creation_time": "2008-11-05T08:09:42Z", "is_private": false, "attachment_id": null}]
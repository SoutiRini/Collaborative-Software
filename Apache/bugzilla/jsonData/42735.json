[{"count": 0, "tags": [], "bug_id": 42735, "is_private": false, "text": "The behavior of the available task with a nested <filepath> has changed from\n1.6.5 to 1.7: Since 1.7.0 files can't be collected with nested filesets like\n\n<available file=\"list.xml\" >\n\t<filepath>\n\t\t<fileset dir=\".\" includes=\"**/*.xml\"/>\n\t</filepath>\n</available>\n \nTherefore the build-file described below produces different output with the two\nant versions:\n ANT 1.6.5:\n    [echo] Value of exist0: true\n    [echo] Value of exist1: true\n    [echo] Value of exist2: true\n    [echo] Value of exist3: ${exist3} - no existence expected\n    [echo] Value of exist4: true\n    [echo] Value of exist5: ${exist5} - no existence expected\n    [echo] Value of exist6: true\n    [echo] Value of exist9: true\n\n ANT 1.7.0:\n    [echo] Value of exist0: true\n    [echo] Value of exist1: ${exist1}\n    [echo] Value of exist2: ${exist2}\n    [echo] Value of exist3: ${exist3} - no existence expected\n    [echo] Value of exist4: true\n    [echo] Value of exist5: ${exist5} - no existence expected\n    [echo] Value of exist6: ${exist6}\n    [echo] Value of exist9: ${exist9}\n\n\n\n<project name=\"test\" default=\"test\" basedir=\".\">\n\t<description>Test target for the available task.</description>\n\n\t<target name=\"prepare\">\n\t\t<mkdir dir=\"subDir\"/>\n\t\t<echo file=\"subDir/list.xml\">\n\t\t\t<![CDATA[\n<xxx>\n   <bbb>AAA</bbb>\n   <bbb>BBB</bbb>\n   <bbb>CCC</bbb>\n</xxx>\n\t\t\t]]>\n\t\t</echo>\n\t</target>\n\t\n\t<target name=\"available\"  description=\"Test available\">\n\t\t<condition property=\"exist0\" value=\"true\">\n\t\t\t<available file=\"list.xml\" filepath=\"subDir\">\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist0: ${exist0}\"/>\n\t\t\n\t\t<condition property=\"exist1\" value=\"true\">\n\t\t\t<available file=\"list.xml\" >\n\t\t\t\t<filepath>\n\t\t\t\t\t<fileset dir=\".\" includes=\"**/*.xml\"/>\n\t\t\t\t</filepath>\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist1: ${exist1}\"/>\n\t\t\n\t\t<condition property=\"exist2\" value=\"true\">\n\t\t\t<available file=\"list.xml\" >\n\t\t\t\t<filepath>\n\t\t\t\t\t<fileset dir=\".\" includes=\"**/*.xml\">\n\t\t\t\t\t\t<contains text=\"AAA\"/>\n\t\t\t\t\t</fileset>\n\t\t\t\t</filepath>\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist2: ${exist2}\"/>\n\t\t\n\t\t<condition property=\"exist3\" value=\"true\">\n\t\t\t<available file=\"list.xml\" >\n\t\t\t\t<filepath>\n\t\t\t\t\t<fileset dir=\".\" includes=\"**/*.xml\">\n\t\t\t\t\t\t<contains text=\"AAH\"/>\n\t\t\t\t\t</fileset>\n\t\t\t\t</filepath>\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist3: ${exist3} - no existence expected\"/>\n\t\t\n\t\t<condition property=\"exist4\" value=\"true\">\n\t\t\t<available file=\"list.xml\" filepath=\"subDir\" >\n\t\t\t\t<filepath>\n\t\t\t\t\t<fileset file=\"list.xml\"/>\n\t\t\t\t</filepath>\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist4: ${exist4}\"/>\n\t\t\n\t\t<condition property=\"exist5\" value=\"true\">\n\t\t\t<available file=\"list.xml\" >\n\t\t\t\t<filepath>\n\t\t\t\t\t<fileset file=\"subDir/list.xml\" >\n\t\t\t\t\t\t<selector>\n\t\t\t\t\t\t\t<or>\n\t\t\t\t\t\t\t\t<contains text=\"BBA\"/>\n\t\t\t\t\t\t\t\t<contains text=\"AAG\"/>\n\t\t\t\t\t\t\t</or>\n\t\t\t\t\t\t</selector>\n\t\t\t\t\t</fileset>\n\t\t\t\t</filepath>\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist5: ${exist5} - no existence expected\"/>\n\t\t\n\t\t<condition property=\"exist6\" value=\"true\">\n\t\t\t<available file=\"list.xml\" >\n\t\t\t\t<filepath>\n\t\t\t\t\t<fileset file=\"subDir/list.xml\" >\n\t\t\t\t\t\t<selector>\n\t\t\t\t\t\t\t<or>\n\t\t\t\t\t\t\t\t<contains text=\"BBB\"/>\n\t\t\t\t\t\t\t\t<contains text=\"AAG\"/>\n\t\t\t\t\t\t\t</or>\n\t\t\t\t\t\t</selector>\n\t\t\t\t\t</fileset>\n\t\t\t\t</filepath>\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist6: ${exist6}\"/>\n\t\t\n\t\t<condition property=\"exist9\" value=\"true\">\n\t\t\t<available file=\"list.xml\" filepath=\"subDir/subSubDir\" >\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist9: ${exist9}\"/>\n\t\t\n\t<!--\t<condition property=\"exist11\" value=\"true\">\n\t\t\t<available file=\"list.xml\"  filepath=\"subDir\" >\n\t\t\t\t<filepath>\n\t\t\t\t\t<fileset file=\"subDir/list.xml\" >\n\t\t\t\t\t\t<selector>\n\t\t\t\t\t\t\t<or>\n\t\t\t\t\t\t\t\t<contains text=\"BBA\"/>\n\t\t\t\t\t\t\t\t<contains text=\"AAG\"/>\n\t\t\t\t\t\t\t</or>\n\t\t\t\t\t\t</selector>\n\t\t\t\t\t</fileset>\n\t\t\t\t</filepath>\n\t\t\t</available>\n\t\t</condition>\n\t\t<echo message=\"Value of exist11: ${exist11} - no existence expected\"/>-->\n\t\t\n\t</target>\n\t\n\t<target name=\"test\" depends=\"prepare,available\"/>\n\n</project>", "id": 104688, "time": "2007-06-25T08:25:06Z", "creator": "Tobias.Kaese@gmx.net", "creation_time": "2007-06-25T08:25:06Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "mbenson@apache.org", "text": "*** Bug 42734 has been marked as a duplicate of this bug. ***", "id": 104693, "time": "2007-06-25T09:08:09Z", "bug_id": 42735, "creation_time": "2007-06-25T09:08:09Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 42735, "attachment_id": null, "id": 104695, "time": "2007-06-25T10:01:40Z", "creator": "peterreilly@apache.org", "creation_time": "2007-06-25T10:01:40Z", "is_private": false, "text": "Thanks for the report and especially thanks for\nthe build file.\n\nAvailable has changed in ant 1.7.0, in ant 1.6.5 and lower\navailable would search all the parent directories for\na file. This was not expected behavior, \nsee: http://issues.apache.org/bugzilla/show_bug.cgi?id=39549\nthe question was raised on the dev list and it was decided\nto change the code.\nThis however has introduced a bug, with the filelist.\n\nI have made a fix, however, exist9 will still not\nfind a file.\n\nthe dir layout is:\n ./subDir/list.xml\n\nthe filepath is subDir/subsubDir\nsince subDir/subsubDir/list.xml does not exist, the test\nwill fail.\n\nOne can use the (ant 1.7.0) attribute seachparents to get\nthe old behavior:\n   <condition property=\"exist9\" value=\"true\">\n      <available searchparents=\"yes\" file=\"list.xml\" filepath=\"subDir/subSubDir\" >\n      </available>\n    </condition>\n \n\n\n- for example one\nmay look for a file named \"etc\" "}, {"count": 3, "tags": [], "bug_id": 42735, "is_private": false, "text": "I have made and committed the change.\nThe following is now the output:\n\nBuildfile: /work/reilly/learning/a/available/build.xml\n\nprepare:\n\navailable:\nValue of exist0: true\nValue of exist1: true\nValue of exist2: true\nValue of exist3: ${exist3} - no existence expected\nValue of exist4: true\nValue of exist5: ${exist5} - no existence expected\nValue of exist6: true\nValue of exist9: ${exist9}\n\ntest:\n\nBUILD SUCCESSFUL\n\nMarking as fixed (with the explained change in behavior for\nthe exist9 test).\n", "id": 104696, "time": "2007-06-25T10:38:07Z", "creator": "peterreilly@apache.org", "creation_time": "2007-06-25T10:38:07Z", "attachment_id": null}]
[{"count": 0, "attachment_id": 26910, "creator": "jochen@apache.org", "text": "Created attachment 26910\nTest class, which is used to create ConditionalFormula.xls\n\nThe attached Java class creates a file called ConditionalFormula.xls. This file is basically identical with the attached file ConditionalFormula2.xls, with one important exception: The cells D3, D4, etc. have a conditional formula. When inspecting this formula in the first file, which is created by POI, then the formula is shown constant in Excel. In the second file, the formula is modified by Excel and the row number matches the cells row number.\n\nHowever, on the POI API level, there is no meaningful difference between the files, as can be shown by running the \"Test\" class. This class is used to extract the relevant information from the excel files.", "id": 145884, "time": "2011-04-20T05:44:42Z", "bug_id": 51089, "creation_time": "2011-04-20T05:44:42Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 51089, "attachment_id": 26911, "text": "Created attachment 26911\nJava class, which is used to inspect an Excel files conditional formulas", "id": 145885, "time": "2011-04-20T05:45:44Z", "creator": "jochen@apache.org", "creation_time": "2011-04-20T05:45:44Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 51089, "attachment_id": 26912, "text": "Created attachment 26912\nFile, which has been created by POI using the Java class", "id": 145886, "time": "2011-04-20T05:46:24Z", "creator": "jochen@apache.org", "creation_time": "2011-04-20T05:46:24Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51089, "attachment_id": 26913, "id": 145887, "time": "2011-04-20T05:46:52Z", "creator": "jochen@apache.org", "creation_time": "2011-04-20T05:46:52Z", "is_private": false, "text": "Created attachment 26913\nFile, which has been created by editing the conditional formula manually"}, {"count": 4, "tags": [], "bug_id": 51089, "attachment_id": null, "id": 145889, "time": "2011-04-20T06:08:57Z", "creator": "apache@gagravarr.org", "creation_time": "2011-04-20T06:08:57Z", "is_private": false, "text": "Can you use BiffViewer (org.apache.poi.hssf.dev.BiffViewer) to spot what's different between POI and Excel? It's mostly the conditional formatting records that'll be of interest, are they set up differently? Are the formulas on them different?"}, {"attachment_id": 26914, "tags": [], "creator": "jochen@apache.org", "text": "Created attachment 26914\nBiff viewer output for POI file", "count": 5, "id": 145891, "time": "2011-04-20T06:35:00Z", "bug_id": 51089, "creation_time": "2011-04-20T06:35:00Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 51089, "text": "Created attachment 26915\nBiff viewer output for manually created Excel file", "id": 145892, "time": "2011-04-20T06:35:25Z", "creator": "jochen@apache.org", "creation_time": "2011-04-20T06:35:25Z", "is_private": false, "attachment_id": 26915}, {"count": 7, "tags": [], "text": "I think the interesting part is this one:\n\n\n [CFHEADER]\n        .id             = 1b0\n        .numCF                  = 1\n-       .needRecalc        = false\n+       .needRecalc        = true\n        .enclosingCellRange= org.apache.poi.ss.util.CellRangeAddress [D3:D6]\n        .cfranges=[org.apache.poi.ss.util.CellRangeAddress [D3:D6]]\n [/CFHEADER]", "attachment_id": null, "bug_id": 51089, "id": 145893, "time": "2011-04-20T06:35:51Z", "creator": "jochen@apache.org", "creation_time": "2011-04-20T06:35:51Z", "is_private": false}, {"count": 8, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "You should be able to get at the CFHeaderRecord from the sheet. Can you try changing the recalc flag on that, and seeing if that fixes your file? (If so we can alter the default value)", "id": 145898, "time": "2011-04-20T07:14:40Z", "bug_id": 51089, "creation_time": "2011-04-20T07:14:40Z", "is_private": false}, {"attachment_id": 26919, "tags": [], "bug_id": 51089, "text": "Created attachment 26919\nFile, which has been created by POI using the Java class\n\nUpdated file, which has been created with needRecalc set to true. Still, the problem stays the same.", "count": 9, "id": 145920, "time": "2011-04-21T03:26:02Z", "creator": "jochen@apache.org", "creation_time": "2011-04-21T03:26:02Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 51089, "text": "Created attachment 26920\nBiff viewer output for POI file\n\nUpdated Biff viewer output for file generated by POI.", "id": 145921, "time": "2011-04-21T03:26:44Z", "creator": "jochen@apache.org", "creation_time": "2011-04-21T03:26:44Z", "is_private": false, "attachment_id": 26920}, {"count": 11, "tags": [], "bug_id": 51089, "text": "I have modified my program to set needRecalc=true. Still, the problem remains the same.", "id": 145922, "time": "2011-04-21T03:27:21Z", "creator": "jochen@apache.org", "creation_time": "2011-04-21T03:27:21Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "jochen@apache.org", "attachment_id": 26921, "text": "Created attachment 26921\nTest class, which is used to create ConditionalFormula.xls\n\nUpdated Java class to recreate Excel file using POI, with needRecalc=true.", "id": 145923, "time": "2011-04-21T04:40:45Z", "bug_id": 51089, "creation_time": "2011-04-21T04:40:45Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 51089, "attachment_id": 26950, "text": "Created attachment 26950\nFile, which has been created by POI using the Java class\n\nFound another difference: The presence of a RECALCID record. Doesn't help either. Attaching updated Java class, which creates the RECALCID record as well.", "id": 146083, "time": "2011-05-03T12:03:04Z", "creator": "jochen@apache.org", "creation_time": "2011-05-03T12:03:04Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 51089, "attachment_id": 26951, "text": "Created attachment 26951\nBiff viewer output for POI file", "id": 146084, "time": "2011-05-03T12:03:49Z", "creator": "jochen@apache.org", "creation_time": "2011-05-03T12:03:49Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 51089, "attachment_id": 26952, "id": 146085, "time": "2011-05-03T12:04:19Z", "creator": "jochen@apache.org", "creation_time": "2011-05-03T12:04:19Z", "is_private": false, "text": "Created attachment 26952\nFile, which has been created by POI using the Java class"}, {"count": 16, "tags": [], "bug_id": 51089, "text": "Created attachment 26953\nTest class, which is used to create ConditionalFormula.xls", "id": 146086, "time": "2011-05-03T12:05:24Z", "creator": "jochen@apache.org", "creation_time": "2011-05-03T12:05:24Z", "is_private": false, "attachment_id": 26953}, {"count": 17, "tags": [], "bug_id": 51089, "attachment_id": null, "text": "I can't see anything obviously different in the cells or the CF stuff between the Excel and POI files\n\nThe only thing I can see that might be different is the PLS block, which we don't currently seem to handle fully. You might want to look at [MS-XLS].pdf and see if that mentions anything about Conditional Formatting and that record?", "id": 146094, "time": "2011-05-04T01:18:27Z", "creator": "apache@gagravarr.org", "creation_time": "2011-05-04T01:18:27Z", "is_private": false}]
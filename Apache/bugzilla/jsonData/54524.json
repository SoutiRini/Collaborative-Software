[{"count": 0, "tags": [], "creator": "shovuu.wang@gmail.com", "text": "Created attachment 29919\nmaterial about the problem\n\nWhile shift rows upward, the reference like \"A2:A3\" in a formula can't be updated normally, an error occurred instead.\n\nException stacks as blew:\n=============================================================================================================\nException in thread \"main\" java.lang.IllegalStateException: Situation not covered: (3, 5, -1, 1, 2)\n\tat org.apache.poi.ss.formula.FormulaShifter.rowMoveAreaPtg(FormulaShifter.java:331)\n\tat org.apache.poi.ss.formula.FormulaShifter.adjustPtgDueToRowMove(FormulaShifter.java:152)\n\tat org.apache.poi.ss.formula.FormulaShifter.adjustPtg(FormulaShifter.java:119)\n\tat org.apache.poi.ss.formula.FormulaShifter.adjustFormula(FormulaShifter.java:107)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.shiftFormula(XSSFRowShifter.java:188)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.updateRowFormulas(XSSFRowShifter.java:156)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.updateSheetFormulas(XSSFRowShifter.java:143)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.updateFormulas(XSSFRowShifter.java:130)\n\tat org.apache.poi.xssf.usermodel.XSSFSheet.shiftRows(XSSFSheet.java:2364)\n\tat org.apache.poi.xssf.usermodel.XSSFSheet.shiftRows(XSSFSheet.java:2306)\n\tat Main.main(Main.java:15)\n=============================================================================================================\n\nThere are two parts in the attachment uploaded.\n1. A sample with a excel file(.xlsx format) and a java source.\n2. A modified source(org.apache.poi.ss.formula.FormulaShifter.java) to resolve the problem.\n\nIt will be helpful if whether the problem is truely existing and whether the modified is OK are confirmed ASAP.\nThank you.", "id": 165073, "time": "2013-02-05T09:18:52Z", "bug_id": 54524, "creation_time": "2013-02-05T09:18:52Z", "is_private": false, "attachment_id": 29919}, {"count": 1, "tags": [], "creator": "shovuu.wang@gmail.com", "text": "The source I modified in FormulaShifter.java is at line 325.", "id": 165074, "time": "2013-02-05T09:21:39Z", "bug_id": 54524, "creation_time": "2013-02-05T09:21:39Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "stasdat@gmail.com", "attachment_id": null, "id": 168062, "time": "2013-06-26T07:58:28Z", "bug_id": 54524, "creation_time": "2013-06-26T07:58:28Z", "is_private": false, "text": "I should say that solution rhys.wang provided is working (tested in production for 2 months)."}, {"count": 3, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 169722, "time": "2013-08-26T20:09:51Z", "bug_id": 54524, "creation_time": "2013-08-26T20:09:51Z", "is_private": false, "text": "Should be fixed in next release via commit r1517676, thanks for the patch."}, {"count": 4, "attachment_id": null, "bug_id": 54524, "text": "For the record, this fix makes POI consistent with Microsoft Office. Note that other spreadsheets applications may have different behavior.\n\nAfter sheet.shiftRows(3, 5, -1):\n\nMicrosoft Office 2013 behavior:\nA3 -> formula=`=SUM(A2:A2)`, cachedValue=1\n\nLibreOffice Calc 4.0.4.2 behavior (probably the same as OpenOffice)\nA3 -> formula=`=SUM(A2:A3)`, cachedValue=Err:522 (circular reference)", "id": 184774, "time": "2015-08-26T20:40:18Z", "creator": "onealj@apache.org", "creation_time": "2015-08-26T20:40:18Z", "tags": [], "is_private": false}]
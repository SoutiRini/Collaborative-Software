[{"count": 0, "tags": [], "creator": "dan@dan-franklin.com", "text": "The %{cookie}C logging directive will grab the wrong cookie if it is presented\nwith a cookie that has the requested cookie name as a prefix.\n\nTo reproduce:\n \nSet up a LogFormat using the cookie-logging directive, such as:\n \n  LogFormat \"%h %{logcookie}C %t \\\"%r\\\" %>s %b \\\"%{User-Agent}i\\\"\" combtest\n  CustomLog logs/access_log combtest\n \nIssue a command such as the following to return two cookies, the first of\nwhich has a name for which the cookie to be logged is a prefix:\n \n  GET -H 'Cookie: $Version=0; logcookie2=wrong_value; logcookie=right_value'\nhttp://localhost/\n \nCheck the log.  Note that instead of \"right_value\" it has recorded\n\"=wrong_value\".\n \n  127.0.0.1 =wrong_value [20/Mar/2004:18:12:24 -0500] \"GET / HTTP/1.1\" 403 2898\n\"lwp-request/1.39\"\n \nThe following fix to function log_cookie seems to work, but I have not\ntested it in a production environment:\n \n*** httpd-2.0.49/modules/loggers/mod_log_config.c\n--- httpd-2.0.49-DLF/modules/loggers/mod_log_config.c\n***************\n*** 430,438 ****\n      const char *start_cookie;\n    \n      if ((cookies = apr_table_get(r->headers_in, \"Cookie\"))) {\n!         if ((start_cookie = ap_strstr_c(cookies,a))) {\n              char *cookie, *end_cookie;\n!             start_cookie += strlen(a) + 1; /* cookie_name + '=' */\n              cookie = apr_pstrdup(r->pool, start_cookie);\n              /* kill everything in cookie after ';' */\n              end_cookie = strchr(cookie, ';');\n--- 430,445 ----\n      const char *start_cookie;\n    \n      if ((cookies = apr_table_get(r->headers_in, \"Cookie\"))) {\n!       /* To avoid matching on longer cookie names having value of \"a\" as prefix,\n!        * create string consisting of value of \"a\" followed by \"=\" and match that.\n!        */\n!       int cookie_name_len = strlen(a);\n!       char* cookie_name = apr_palloc(r->pool, cookie_name_len + 2);\n!       strcpy(cookie_name, a);\n!       strcat(cookie_name, \"=\");\n!         if ((start_cookie = ap_strstr_c(cookies,cookie_name))) {\n              char *cookie, *end_cookie;\n!             start_cookie += cookie_name_len + 1; /* cookie_name + '=' */\n              cookie = apr_pstrdup(r->pool, start_cookie);\n              /* kill everything in cookie after ';' */\n              end_cookie = strchr(cookie, ';');\n\nDan Franklin", "id": 54338, "time": "2004-03-21T17:37:24Z", "bug_id": 27823, "creation_time": "2004-03-21T17:37:24Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 27823, "attachment_id": null, "is_private": false, "id": 54862, "time": "2004-03-30T10:21:53Z", "creator": "trawick@apache.org", "creation_time": "2004-03-30T10:21:53Z", "text": "28037 has later patch (which could have just been added to this PR by the way ;) )\n\n*** This bug has been marked as a duplicate of 28037 ***"}]
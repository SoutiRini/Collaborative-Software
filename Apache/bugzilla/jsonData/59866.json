[{"count": 0, "tags": [], "creator": "caijunj@apache.org", "attachment_id": null, "text": "During startup, Tomcat incorrectly scans the WEB-INF/classes/META-INF/resources folder to find classses, which also presents a performance penalty.\n\nThis happens in two situations:\n\n1. When Tomcat tries to find classes to cache. The code in problem is at Line 2275 in [1]. It calls the webapp classloader's getResourceAsStream() method and eventually ends up doing a lookup in WEB-INF/classes/META-INF/resources for many Java class.\n\n2. When Tomcat tries to load some classes using the webapp classloader, the classloader's findClassInternal() calls its findResourceInternal() method, which may do a lookup in its repository (aka WEB-INF/classes), see Line 3291 in [2].\n\nThe code actually does the lookup in the WEB-INF/classes/META-INF/resources is at Line 502 in [3]. The above situations can be easily observed by setting a breakpoint at this line and then start tomcat in debug mode with all the default configurations (addWebinfClassesResources is false, though even if it's set to true the above behavior is wrong).\n\nThis same issue may exist in Tomcat 8 and onwards as well.\n\n[1] http://svn.apache.org/repos/asf/tomcat/tc7.0.x/tags/TOMCAT_7_0_70/java/org/apache/catalina/startup/ContextConfig.java\n[2] http://svn.apache.org/repos/asf/tomcat/tc7.0.x/tags/TOMCAT_7_0_70/java/org/apache/catalina/loader/WebappClassLoaderBase.java\n[3] http://svn.apache.org/repos/asf/tomcat/tc7.0.x/tags/TOMCAT_7_0_70/java/org/apache/naming/resources/BaseDirContext.java", "id": 192405, "time": "2016-07-15T15:59:51Z", "bug_id": 59866, "creation_time": "2016-07-15T15:59:51Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59866, "is_private": false, "id": 192501, "creation_time": "2016-07-18T20:19:08Z", "time": "2016-07-18T20:19:08Z", "creator": "caijunj@apache.org", "text": "Anybody who can take a look to confirm this is a valid issue?", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 59866, "text": "The first issues applies to 7.0.x onwards.\nThe second issue applies only to 7.0.x.\n\nThis has been fixed in:\n9.0.x for 9.0.0.M10 onwards\n8.5.x for 8.5.5 onwards\n8.0.x for 8.0.37 onwards\n7.0.x for 7.0.71 onwards", "id": 192822, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2016-08-02T15:20:50Z", "time": "2016-08-02T15:20:50Z", "is_private": false}]
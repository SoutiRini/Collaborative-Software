[{"count": 0, "tags": [], "creator": "yonemitsuv@bpl.on.ca", "text": "When I try and create a new password file under any win32 OS, with the win32 \nbinary install I get the following error:\nThis a dump of what happened\n\nMicrosoft(R) Windows DOS\n(C)Copyright Microsoft Corp 1990-2001.\n\nF:\\PROGRA~1\\APACHE~1\\APACHE2\\BIN>htpasswd -c /windows/passfile vince\nHTPASSWD: -c and -n options conflict\n\nI can not create a password file called passfile I have tried numerous \ndifferent paths including c:\\passfile, c:\\windows\\passfile\nIf I omit the -c it goes to the password part but it doesn't create a file. If \nI try -n I get the same error as with -c.\nIt could be that I am just doing something wrong.", "id": 19618, "time": "2002-07-16T15:19:24Z", "bug_id": 10870, "creation_time": "2002-07-16T15:19:24Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 10870, "is_private": false, "count": 1, "id": 19632, "time": "2002-07-16T17:49:26Z", "creator": "jwoolley@apache.org", "creation_time": "2002-07-16T17:49:26Z", "text": "This is a well-known and frequently reported bug.  Please see http://www.apache.org/dist/httpd/patches/apply_to_2.0.39/ (or use the htpasswd from any other version of Apache -- they are compatible). "}, {"count": 2, "tags": [], "bug_id": 10870, "text": "In order to get a working htpasswd, I found that fixing one problem uncovered \nothers when compiling this with gcc-2.95 on a Linux system (particularly the \ngrouping of logical expressions partially fixed in patch \"c and n options \nconflict\".  That patches one place; the same kind of thing was needed in \nseveral).\n\nThe following is a patch which addresses several problems, but I am not \nsatisfied it supplies the expected logic of the options.  However, it produces a \nfunctioning htpasswd.  By \"expected logic\", I mean for example, if a password \nfile exists, and the -c option is used again, should it just carry out the rest \nof the operation without recreating the file, or should it warn and quit?\n\nI put this here for review of other patch writers, and to give you a functioning \nhtpasswd, if not one perfectly acceptable to everyone:\n\n------------------ cut here ------------------------------------\n\n--- httpd-2.0.39/support/htpasswd.c\tSun Jul 21 21:51:13 2002\n+++ httpd-2.0.39.work/support/htpasswd.c\tMon Jul 22 00:58:34 2002\n@@ -297,7 +297,7 @@\n  */\n static int writable(apr_pool_t *pool, char *fname)\n {\n-    return accessible(pool, fname, APR_APPEND);\n+    return accessible(pool, fname, APR_WRITE);\n }\n \n /*\n@@ -375,7 +375,7 @@\n         }\n     }\n \n-    if (*mask & (APHTP_NEWFILE | APHTP_NOFILE)) {\n+    if (*mask & APHTP_NEWFILE && *mask & APHTP_NOFILE) {\n         apr_file_printf(errfile, \"%s: -c and -n options conflict\\n\", argv[0]);\n         exit(ERR_SYNTAX);\n     }\n@@ -486,14 +486,15 @@\n                 \"just not work on this platform.\\n\");\n     }\n #endif\n-    if (! mask & APHTP_NOFILE) {\n+    if (! (mask & APHTP_NOFILE)) {\n         /*\n          * Only do the file checks if we're supposed to frob it.\n          *\n          * Verify that the file exists if -c was omitted.  We give a special\n          * message if it doesn't.\n          */\n-        if ((! mask & APHTP_NEWFILE) && (! exists(pwfilename, pool))) {\n+\n+        if ((! (mask & APHTP_NEWFILE)) && (! exists(pwfilename, pool))) {\n             apr_file_printf(errfile,\n                     \"%s: cannot modify file %s; use '-c' to create it\\n\",\n                     argv[0], pwfilename);\n@@ -504,7 +505,7 @@\n          * Verify that we can read the existing file in the case of an update\n          * to it (rather than creation of a new one).\n          */\n-        if ((! mask & APHTP_NEWFILE) && (! readable(pool, pwfilename))) {\n+        if ((! (mask & APHTP_NEWFILE)) && (! readable(pool, pwfilename))) {\n             apr_file_printf(errfile, \"%s: cannot open file %s for read \naccess\\n\",\n                     argv[0], pwfilename);\n             perror(\"apr_file_open\");\n@@ -590,13 +591,16 @@\n             else {\n                 /* We found the user we were looking for, add him to the file.\n                  */\n+\t\tfound = -1;\n                 apr_file_printf(errfile, \"Updating \");\n+\t\tstrcat(record, \"\\n\");\n                 putline(ftemp, record);\n             }\n         }\n     }\n     if (!found) {\n         apr_file_printf(errfile, \"Adding \");\n+\tstrcat(record, \"\\n\");\n         putline(ftemp, record);\n     }\n     apr_file_printf(errfile, \"password for user %s\\n\", user);\n\n------------------ cut here ------------------------------------\n\n", "id": 19958, "time": "2002-07-22T08:25:02Z", "creator": "josmhinkle@netscape.net", "creation_time": "2002-07-22T08:25:02Z", "is_private": false, "attachment_id": null}]
[{"attachment_id": null, "tags": [], "creator": "andreas@apache.org", "is_private": false, "count": 0, "id": 104816, "time": "2007-06-28T06:08:26Z", "bug_id": 42762, "creation_time": "2007-06-28T06:08:26Z", "text": "When opening a file with Kupu in a proxy environment, I get this error:\n\nMalformed lenyadoc: URI: publication part not found [lenyadoc://]\n\n\tat <map:serialize type=\"xhtml\"> -\nfile:/Users/nobby/apache/lenya/trunk/src/modules/kupu/sitemap.xmap:150:42\n\tat <map:transform> -\nfile:/Users/nobby/apache/lenya/trunk/src/modules/kupu/sitemap.xmap:149:83\n\tat <map:transform type=\"proxy\"> -\nfile:/Users/nobby/apache/lenya/trunk/src/modules/kupu/sitemap.xmap:146:41\n\n...\n\nCaused by: java.net.MalformedURLException: Malformed lenyadoc: URI: publication\npart not found [lenyadoc://]\n\tat\norg.apache.lenya.cms.cocoon.source.LenyaDocSourceFactory.getSource(LenyaDocSourceFactory.java:137)\n\tat\norg.apache.excalibur.source.impl.SourceResolverImpl.resolveURI(SourceResolverImpl.java:208)\n\tat\norg.apache.cocoon.components.CocoonComponentManager.resolveURI(CocoonComponentManager.java:558)\n\tat\norg.apache.cocoon.environment.AbstractEnvironment.resolveURI(AbstractEnvironment.java:553)\n\tat\norg.apache.cocoon.environment.AbstractEnvironment.resolveURI(AbstractEnvironment.java:540)\n\tat org.apache.cocoon.generation.FileGenerator.setup(FileGenerator.java:79)"}, {"count": 1, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "Now the document is loaded (in my working copy), but images don't appear.", "id": 104818, "time": "2007-06-28T06:19:48Z", "bug_id": 42762, "creation_time": "2007-06-28T06:19:48Z", "is_private": false}, {"count": 2, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "Image URLs aren't properly rewritten:\n\n<img src=\"tutorial/lenya-document:d8758a70-2577-11dc-94d6-bc82d05e55eb\" ... />", "id": 104819, "time": "2007-06-28T06:22:07Z", "bug_id": 42762, "creation_time": "2007-06-28T06:22:07Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 42762, "text": "(In reply to comment #2)\n> Image URLs aren't properly rewritten:\n> \n> <img src=\"tutorial/lenya-document:d8758a70-2577-11dc-94d6-bc82d05e55eb\" ... />\n\nThe problem is in\n\nmodules/kupu/resources/kupu/apache-lenya/lenya/content2edit.xsl\n\nWe have to check for lenya-document URLs:\n\n   <xsl:template name=\"object2img\">\n      <img border=\"0\">\n        <xsl:attribute name=\"src\">\n          <xsl:choose>\n\n            <!-- don't change lenya-document URLs -->\n            <xsl:when test=\"starts-with(@data, 'lenya-document:')\">\n              <xsl:value-of select=\"@data\"/>\n            </xsl:when>\n\n            <xsl:when test=\"not(starts-with(@data, '/'))\">\n              <xsl:value-of select=\"$nodeid\"/>/<xsl:value-of select=\"@data\"/>\n            </xsl:when>\n            <xsl:otherwise>            \n              <xsl:value-of select=\"@data\"/>\n            </xsl:otherwise>\n          </xsl:choose>\n        </xsl:attribute>\n", "id": 104820, "time": "2007-06-28T06:24:27Z", "creator": "andreas@apache.org", "creation_time": "2007-06-28T06:24:27Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 42762, "text": "Created attachment 20411\nChecks for lenya-document URLs when transforming content XHTML to Kupu-editable XHTML.\n\nI can't apply the patch because Kupu is an external SVN resource.", "id": 104821, "time": "2007-06-28T06:26:15Z", "creator": "andreas@apache.org", "creation_time": "2007-06-28T06:26:15Z", "is_private": false, "attachment_id": 20411}, {"attachment_id": null, "tags": [], "creator": "andreas@apache.org", "is_private": false, "count": 5, "id": 104822, "time": "2007-06-28T06:27:47Z", "bug_id": 42762, "creation_time": "2007-06-28T06:27:47Z", "text": "The image preview (in the \"insert image\" popup dialog) doesn't work yet."}, {"attachment_id": null, "tags": [], "creator": "andreas@apache.org", "is_private": false, "count": 6, "id": 104823, "time": "2007-06-28T06:34:48Z", "bug_id": 42762, "creation_time": "2007-06-28T06:34:48Z", "text": "(In reply to comment #5)\n> The image preview (in the \"insert image\" popup dialog) doesn't work yet.\n\nThe image library functions in kupu.js don't use proxy URLs yet."}, {"count": 7, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "After saving, image URLs are malformed:\n\n<object data=\"/cms.example.com/tutorial/foo.jpg\" title=\"Foo\" type=\"\" />\n", "id": 104827, "time": "2007-06-28T06:44:52Z", "bug_id": 42762, "creation_time": "2007-06-28T06:44:52Z", "is_private": false}, {"count": 8, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "(In reply to comment #6)\n> (In reply to comment #5)\n> > The image preview (in the \"insert image\" popup dialog) doesn't work yet.\n> \n> The image library functions in kupu.js don't use proxy URLs yet.\n\nThis is fixed now.", "id": 104828, "time": "2007-06-28T06:45:48Z", "bug_id": 42762, "creation_time": "2007-06-28T06:45:48Z", "is_private": false}, {"count": 9, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "(In reply to comment #7)\n> After saving, image URLs are malformed:\n> \n> <object data=\"/cms.example.com/tutorial/foo.jpg\" title=\"Foo\" type=\"\" />\n\nIn the PUT request, the URL still looks OK:\n\n<img src=\"https://cms.example.com/tutorial/foo.jpg\" ... />\n", "id": 104830, "time": "2007-06-28T06:51:03Z", "bug_id": 42762, "creation_time": "2007-06-28T06:51:03Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "andreas@apache.org", "is_private": false, "count": 10, "id": 104832, "time": "2007-06-28T06:53:27Z", "bug_id": 42762, "creation_time": "2007-06-28T06:53:27Z", "text": "(In reply to comment #9)\n> (In reply to comment #7)\n> > After saving, image URLs are malformed:\n> > \n> > <object data=\"/cms.example.com/tutorial/foo.jpg\" title=\"Foo\" type=\"\" />\n> \n> In the PUT request, the URL still looks OK:\n> \n> <img src=\"https://cms.example.com/tutorial/foo.jpg\" ... />\n\nI guess the problem is in modules/xhtml/xslt/clean-xhtml.xsl:\n\n        <xsl:choose>\n          <xsl:when test=\"starts-with(@src, '/')\">\n            <xsl:value-of select=\"@src\"/>              \n          </xsl:when>\n          <xsl:otherwise>\n            <xsl:value-of select=\"substring-after(@src, '/')\"/>\n          </xsl:otherwise>\n        </xsl:choose>\n      </xsl:attribute>\n\n\n"}, {"count": 11, "tags": [], "bug_id": 42762, "text": "(In reply to comment #10)\n> (In reply to comment #9)\n> > (In reply to comment #7)\n> > > After saving, image URLs are malformed:\n> > > \n> > > <object data=\"/cms.example.com/tutorial/foo.jpg\" title=\"Foo\" type=\"\" />\n> > \n> > In the PUT request, the URL still looks OK:\n> > \n> > <img src=\"https://cms.example.com/tutorial/foo.jpg\" ... />\n> \n> I guess the problem is in modules/xhtml/xslt/clean-xhtml.xsl:\n> \n>         <xsl:choose>\n>           <xsl:when test=\"starts-with(@src, '/')\">\n>             <xsl:value-of select=\"@src\"/>              \n>           </xsl:when>\n>           <xsl:otherwise>\n>             <xsl:value-of select=\"substring-after(@src, '/')\"/>\n>           </xsl:otherwise>\n>         </xsl:choose>\n>       </xsl:attribute>\n\nFixed in revision 551560.\n\n", "id": 104834, "time": "2007-06-28T06:56:02Z", "creator": "andreas@apache.org", "creation_time": "2007-06-28T06:56:02Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 42762, "is_private": false, "text": "OK, that's it for the moment.", "id": 104835, "time": "2007-06-28T06:56:33Z", "creator": "andreas@apache.org", "creation_time": "2007-06-28T06:56:33Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "sebastien.bilbeau@univ-rennes1.fr", "attachment_id": null, "id": 130231, "time": "2009-09-09T02:47:33Z", "bug_id": 47807, "creation_time": "2009-09-09T02:47:33Z", "is_private": false, "text": "Since we have upgrade lot of our frontend server in version 2.2.13 we have an issue with mod_proxy_balancer or mod_proxy_ajp.\n\nIn our logs we can see this message :\nhttpd[17077]: [error] proxy: dialog to 129.***.***.***:9554 (jent2.****.fr) failed\nhttpd[29288]: [error] proxy: dialog to 129.***.***.***:9554 (jent5.****.fr) failed\nhttpd[10466]: [error] proxy: dialog to 129.***.***.***:9554 (jent5.****.fr) failed\nhttpd[28229]: [error] proxy: dialog to 129.***.***.***:9554 (jent2.****.fr) failed\nhttpd[29287]: [error] proxy: dialog to 129.***.***.***:9554 (jent1.****.fr) failed\nhttpd[17539]: [error] proxy: dialog to 129.***.***.***:9554 (jent3.****.fr) failed\nhttpd[28229]: [error] proxy: dialog to 129.***.***.***:9554 (jent1.****.fr) failed\n\nAll five backend server are under Tomcat 5.5.27.\n\nApache configuration :\n\n<VirtualHost 129.***.***.***:80>\n    ServerName ent.******.fr\n    VirtualDocumentRoot /dev/null\n    # Balancing\n    ProxyPass /balancer-manager !\n    ProxyPass / balancer://mycluster/ stickysession=JSESSIONID\n    <Proxy balancer://mycluster>\n        BalancerMember ajp://129.***.***.***:9554 min=0 max=100 smax=50 ttl=10 route=ent1 timeout=60 loadfactor=100\n        BalancerMember ajp://129.***.***.***:9554 min=0 max=100 smax=50 ttl=10 route=ent2 timeout=60 loadfactor=100\n        BalancerMember ajp://129.***.***.***:9554 min=0 max=100 smax=50 ttl=10 route=ent3 timeout=60 loadfactor=100\n        BalancerMember ajp://129.***.***.***:9554 min=0 max=100 smax=50 ttl=10 route=ent4 timeout=60 loadfactor=100\n        BalancerMember ajp://129.***.***.***:9554 min=0 max=100 smax=50 ttl=10 route=ent5 timeout=60 loadfactor=100\n    </Proxy>\n</VirtualHost>\n\nTo fix this issue, we just come back to the 2.2.11 version ..."}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 130234, "time": "2009-09-09T03:59:17Z", "bug_id": 47807, "creation_time": "2009-09-09T03:59:17Z", "is_private": false, "text": "Please set the LogLevel to debug for further diagnostics."}, {"count": 2, "tags": [], "bug_id": 47807, "attachment_id": null, "text": "Out of curiosity, if you revert this patch and recompile mod_proxy_ajp;\n\nhttp://svn.apache.org/viewvc/httpd/httpd/branches/2.2.x/modules/proxy/mod_proxy_ajp.c?r1=768507&r2=768506&pathrev=768507\n\ndo the problems go away?", "id": 130255, "time": "2009-09-09T10:02:04Z", "creator": "wrowe@apache.org", "creation_time": "2009-09-09T10:02:04Z", "is_private": false}, {"count": 3, "tags": [], "creator": "poirier@pobox.com", "text": "waiting for answers to comments", "id": 130609, "time": "2009-09-23T07:44:49Z", "bug_id": 47807, "creation_time": "2009-09-23T07:44:49Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 47807, "attachment_id": null, "text": "Same problem (Apache 2.2.13 + Tomcat 5.5.26 with uPortal webapp)\n\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(687): ajp_read_header: ajp_ilink_received 04\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(697): ajp_parse_type: got 04\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(516): ajp_unmarshal_response: status = 200\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(537): ajp_unmarshal_response: Number of headers is = 5\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(599): ajp_unmarshal_response: Header[0] [uPortal-version] = [uPortal_rel-2-6-1]\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(599): ajp_unmarshal_response: Header[1] [pragma] = [no-cache]\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(599): ajp_unmarshal_response: Header[2] [Cache-Control] = [no-cache, max-age=0, must-revalidate]\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(599): ajp_unmarshal_response: Header[3] [Expires] = [Thu, 01 Jan 1970 00:00:00 GMT]\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(599): ajp_unmarshal_response: Header[4] [Content-Type] = [text/html;charset=UTF-8]\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(609): ajp_unmarshal_response: ap_set_content_type done\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(687): ajp_read_header: ajp_ilink_received 04\n[Fri Sep 25 13:15:29 2009] [debug] ajp_header.c(697): ajp_parse_type: got 04\n[Fri Sep 25 13:15:29 2009] [debug] mod_proxy_ajp.c(424): proxy: Backend sent headers twice.\n[Fri Sep 25 13:15:29 2009] [debug] mod_proxy_ajp.c(540): proxy: Processing of request failed backend: 1, output: 0\n[Fri Sep 25 13:15:29 2009] [error] proxy: dialog to 127.0.0.1:8009 (localhost) failed", "id": 130676, "time": "2009-09-25T04:26:37Z", "creator": "maelstro@hotmail.com", "creation_time": "2009-09-25T04:26:37Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 47807, "attachment_id": null, "text": "There can be several reasons, why the backend sends the headers duplicate. It could be a webapp problem, but there's also a Tomcat bug, that has been fixed recently:\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=46770\n\nThe probem starts in 5.5.26 and is fixed in 5.5.28. So you can either apply the patch\n\nhttp://svn.apache.org/viewvc?view=rev&revision=755236\n\nor update your Tomcat to 5.5.28.\n\nIf this doesn't help, then it's likely something in your webapp.\n\nThe other option is removing the protocol hardening done by the httpd patch that Bill Wrowe mentioned in Comment #2.\n\nCould both of you, \"S\" and \"ML\" please check, whether the problem goes away when using TC 5.5.28?", "id": 130677, "time": "2009-09-25T04:39:08Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-09-25T04:39:08Z", "is_private": false}, {"count": 6, "tags": [], "creator": "maelstro@hotmail.com", "text": "No more errors for me after upgrading to Tomcat 5.5.28. Thanks.", "id": 130678, "time": "2009-09-25T05:09:38Z", "bug_id": 47807, "creation_time": "2009-09-25T05:09:38Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "sebastien.bilbeau@univ-rennes1.fr", "attachment_id": null, "id": 130679, "time": "2009-09-25T06:24:27Z", "bug_id": 47807, "creation_time": "2009-09-25T06:24:27Z", "is_private": false, "text": "@Will Rowe : sorry but I can't revert the patch now. Our servers are in production and users (30 000 connexions per day) can't tolerate another issues.\n\n@ML : I think we have exactly the same issue, because we use uPortal webapps too ... :-)\n\nI think I upgrade Tomcat servers in 5.5.28 version soon ..."}]
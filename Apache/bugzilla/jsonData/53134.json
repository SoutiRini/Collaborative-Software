[{"count": 0, "tags": [], "bug_id": 53134, "is_private": false, "id": 158307, "attachment_id": null, "creator": "michael@weiser.dinsnail.net", "creation_time": "2012-04-23T14:30:37Z", "time": "2012-04-23T14:30:37Z", "text": "As discussed on httpd-users (http://mail-archives.apache.org/mod_mbox/httpd-users/201204.mbox/%3C20120406121150.GC22138@dinsnail.net%3E) and httpd-dev (http://mail-archives.apache.org/mod_mbox/httpd-dev/201204.mbox/%3C4F7F6F8C.5020409@primary.net%3E), httpd-2.4 and later reverse proxies use SNI towards the backend server. If ProxyPreserveHost is turned On, a mismatch between Host header and SNI data can occur which may cause the backend server to deny the request. This could be fixed by extracting the Host header from the request and putting its hostname into the SNI data."}, {"count": 1, "tags": [], "bug_id": 53134, "attachment_id": 28658, "is_private": false, "id": 158308, "time": "2012-04-23T14:33:21Z", "creator": "michael@weiser.dinsnail.net", "creation_time": "2012-04-23T14:33:21Z", "text": "Created attachment 28658\nuse Host header for SNI data if ProxyPreserveHost is on\n\nThis patch parses the Host header, extracts the hostname and uses it for the CN check and SNI data if ProxyPreserveHost is On. This fixes the issue for me."}, {"count": 2, "tags": [], "text": "I forgot: The patch is against httpd-trunk as of 2012-04-22. But it also applies against httpd-2.4 HEAD as of the same date.", "is_private": false, "id": 158309, "creator": "michael@weiser.dinsnail.net", "time": "2012-04-23T14:52:09Z", "bug_id": 53134, "creation_time": "2012-04-23T14:52:09Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "text": "Created attachment 28697\nSlightly different approach\n\nI think it is better to use r->hostname instead of reparsing the host header again. Can you please check if this patch works for you as well?", "id": 158663, "time": "2012-04-30T13:18:14Z", "bug_id": 53134, "creation_time": "2012-04-30T13:18:14Z", "attachment_id": 28697}, {"count": 4, "tags": [], "creator": "michael@weiser.dinsnail.net", "text": "(In reply to comment #3)\n> Can you please check if this patch works for you as well?\n\nYes, your patch works fine.", "id": 158792, "time": "2012-05-03T18:08:02Z", "bug_id": 53134, "creation_time": "2012-05-03T18:08:02Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "rpluem@apache.org", "text": "Committed to trunk as r1333969. Thanks for testing.", "id": 158827, "time": "2012-05-04T14:07:00Z", "bug_id": 53134, "creation_time": "2012-05-04T14:07:00Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "michael@weiser.dinsnail.net", "attachment_id": null, "id": 159060, "time": "2012-05-15T08:20:25Z", "bug_id": 53134, "creation_time": "2012-05-15T08:20:25Z", "is_private": false, "text": "Will this automaticlly show up in a 2.4.x release or do I need to do something more to make it happen?"}, {"count": 7, "tags": [], "bug_id": 53134, "attachment_id": null, "is_private": false, "id": 159063, "time": "2012-05-15T12:05:09Z", "creator": "rpluem@apache.org", "creation_time": "2012-05-15T12:05:09Z", "text": "Proposed for backport to 2.4.x as r1338662."}, {"count": 8, "tags": [], "bug_id": 53134, "attachment_id": null, "is_private": false, "id": 160428, "time": "2012-07-03T19:45:52Z", "creator": "sf@sfritsch.de", "creation_time": "2012-07-03T19:45:52Z", "text": "Will be in 2.4.3: r1356881"}, {"count": 9, "tags": [], "text": "Released with 2.4.3.\nProposed for 2.2.x.", "attachment_id": null, "id": 161590, "creator": "rainer.jung@kippdata.de", "time": "2012-08-21T16:31:11Z", "bug_id": 53134, "creation_time": "2012-08-21T16:31:11Z", "is_private": false}, {"count": 10, "tags": [], "text": "When I checked (April 2012), 2.2 couldn't do SNI when reverse proxying. A backport (of just the fix) is mute then...", "is_private": false, "id": 161705, "creator": "michael@weiser.dinsnail.net", "time": "2012-08-26T12:41:03Z", "bug_id": 53134, "creation_time": "2012-08-26T12:41:03Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 53134, "attachment_id": null, "text": "I can confirm that the problem is fixed in 2.4.3. As far as I am concerned, the bug can be closed. Thank you for all your help.\n\nBTW: I'm now facing a follow-up problem with subjectAltNames for which I've opened another bug #54030 with patches for 2.4.2 and trunk.", "id": 162855, "time": "2012-10-21T16:49:05Z", "creator": "michael@weiser.dinsnail.net", "creation_time": "2012-10-21T16:49:05Z", "is_private": false}]
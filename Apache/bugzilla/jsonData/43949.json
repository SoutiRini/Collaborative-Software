[{"count": 0, "tags": [], "creator": "dersim@gmx.de", "attachment_id": null, "id": 111012, "time": "2007-11-23T07:17:43Z", "bug_id": 43949, "creation_time": "2007-11-23T07:17:43Z", "is_private": false, "text": "Hello.\n\nMy POI-Version: poi-bin-3.0.1-FINAL-20070705.zip\n\nI've generated XLS-File with:\n\n\t\ttry {\n\t\t\tHSSFWorkbook wb = new HSSFWorkbook();\n\t\t\tHSSFCellStyle styleDate = wb.createCellStyle();\n\t\t\tstyleDate.setDataFormat(HSSFDataFormat.getBuiltinFormat(\"m/d/yy\"));\n\n\t\t\tif (result != null) {\n\t\t\t\t// create a new sheet\n\t\t\t\tHSSFSheet s = wb.createSheet();\n\n\t\t\t\t// declare a row object reference\n\t\t\t\tHSSFRow r = null;\n\n\t\t\t\t// declare a cell object reference\n\t\t\t\tHSSFCell c = null;\n\n\t\t\t\twb.setSheetName(0, \"RemovalInstallationList\");\n\n\t\t\t\t// first row with headings\n\t\t\t\tr = s.createRow(0);\n\n\t\t\t\tc = r.createCell((short) 0);\n\t\t\t\tc.setCellValue(new HSSFRichTextString(\"Three Letter Code\"));\n\t\t\t\n\t\t\t\t....\n\n\t\t\t\tc = r.createCell((short) 37);\n\t\t\t\tc.setCellValue(new HSSFRichTextString(\"Description\"));\n\t\t\t\t\n\t\t\t\ts.setColumnWidth((short) (0), (short) ((50 * 4) / ((double) 1 / 20)));\n\t\t\t\n\t\t\t\t....\n\n\t\t\t\ts.setColumnWidth((short) (37), (short) ((50 * 4) / ((double) 1 / 20)));\n\t\t\t\t\n\t\t\t\tIterator it = result.iterator();\n\t\t\t\tfor (int i = 0; it.hasNext(); i++) {\n\t\t\t\t\tRemovalInstallationReportResultRowModel resultModel = null;\n\t\t\t\t\tresultModel = (RemovalInstallationReportResultRowModel) it.next();\n\n\t\t\t\t\t// create a row with data\n\t\t\t\t\tr = s.createRow(i + 1);\n\n\t\t\t\t\tc = r.createCell((short) 0);\n\t\t\t\t\tif (resultModel.getThreeLC() != null) {\n\t\t\t\t\t\tc.setCellValue(new HSSFRichTextString(resultModel.getThreeLC()));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.setCellValue(new HSSFRichTextString(\"\"));\n\t\t\t\t\t}\n\t\t\t\n\t\t\t\t\t....\n\n\t\t\t\t\tc = r.createCell((short) 37);\n\t\t\t\t\tif (resultModel.getDescriptionPartNoInstalledComponent() != null) {\n\t\t\t\t\t\tc.setCellValue(new\nHSSFRichTextString(resultModel.getDescriptionPartNoInstalledComponent()));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.setCellValue(new HSSFRichTextString(\"\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn new RemovalInstallationReportCSVModel(Status.OK, wb.getBytes());\n\t\t\t}\n\t\t\t\n\t\t\tcalling method:\n\t\t\t\n\t\t\tbyte[] resultAsByte = csvModel.getTransferObject();\n\t\t\tif (result != null) {\n\t\t\tinputStream = new ByteArrayInputStream(resultAsByte);\n\t\t}\n\t\tinput();\n\t\treturn \"exportCSV\";\t\t\n\n\n    Struts-Config.xml\n\n\t\t<result name=\"exportCSV\" type=\"stream\">\n\t\t\t  <param name=\"contentType\">application/vnd.ms-excel</param>\n\t\t\t  <param name=\"inputName\">inputStream</param>\n\t\t\t  <param name=\"contentDisposition\">filename=\"document.xls\"</param>\n\t\t</result>\n\t\t\n\t\tThe result is a message from Excel during opening the file like:\n\t\t\n\t\tMicrosoft Excel Datei-Reparatur Protokoll\n\n\t\tIn Datei 'D:\\tmp\\exported_file_damaged_231107.xls' wurden Fehler festgestellt\n\t\tDie folgenden Reparaturen wurden durchgef\u00fchrt:\n\t\tDie Zusammenfassungs-Information des Dokumentes ist verloren gegangen.\n\nThe resulting exported file is attached.\n\nKind regards."}, {"count": 1, "tags": [], "creator": "dersim@gmx.de", "attachment_id": 21177, "id": 111013, "time": "2007-11-23T07:19:16Z", "bug_id": 43949, "creation_time": "2007-11-23T07:19:16Z", "is_private": false, "text": "Created attachment 21177\ncorrupted damaged XLS file"}, {"count": 2, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "id": 111020, "time": "2007-11-23T07:48:17Z", "bug_id": 43949, "creation_time": "2007-11-23T07:48:17Z", "is_private": false, "text": "You are not supposed to call workbook.getBytes() directly. This method is used\nto construct the Workbook node in the document file system. \n\nChange the following line\nreturn new RemovalInstallationReportCSVModel(Status.OK, wb.getBytes());\n\nto\n\nByteArrayOutputStream out = new ByteArrayOutputStream();\nwb.write(out); \nreturn new RemovalInstallationReportCSVModel(Status.OK, out.toByteArray());\n\nIt should work.\n\nYegor "}, {"count": 3, "tags": [], "creator": "dersim@gmx.de", "attachment_id": null, "id": 111021, "time": "2007-11-23T07:57:40Z", "bug_id": 43949, "creation_time": "2007-11-23T07:57:40Z", "is_private": false, "text": "@Yegor: Thank you very much, it work's now. Best regards & a nice weekend."}]
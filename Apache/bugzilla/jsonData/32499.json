[{"count": 0, "tags": [], "creator": "jeff_murdoch@merck.com", "text": "When constructing a response within a servlet, I set the Content-Type to:\n\n   Content-Type: image/jpeg\n\nand that it how I transmit it.  When received by the browser, the header has\nbeen altered to:\n\n   Content-Type: image/jpeg;charset=UTF-8\n\nwhich to my mind (and apparently the browser's mind) doesn't make any sense.\nMozilla 1.7.3 reports:\n\nThe image \n\"http://server:port/dir/MyServlet?param=x&option=y\"\ncannot be displayed, because it contains errors.\n\nWhen the servlet returning the image is accessed directly from the original\nserver, not passed on through my servlet, it has no charset header and works well.\n\nAny ideas?  Thanks!!\n\nJeff", "id": 67814, "time": "2004-12-02T20:04:35Z", "bug_id": 32499, "creation_time": "2004-12-02T20:04:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 32499, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 24970 ***", "id": 67815, "time": "2004-12-02T20:21:33Z", "creator": "william.barker@wilshire.com", "creation_time": "2004-12-02T20:21:33Z", "is_private": false}, {"count": 2, "tags": [], "creator": "sbridges.geo@yahoo.com", "attachment_id": null, "text": "This bug was marked as a duplicate of 24970, but it is not a duplicate.  \n\nBug 24970 was marked as wont fix, which is appropriate.  The justification for\n24970 being won't fix is in comment #24 on the bug which reads,\n\n\"The servlet spec expert group has decided that all Servlets that use a Writer \n(and this includes all JSPs) must include a charset in the 2.4 servlet spec.  \nSince Tomcat 4 uses the same connectors as Tomcat 5, and Tomcat 5 must set the \ncharset, this will certainly not be fixed.\"\n\nHowever the code for this bug does not use a servlet or a JSP. \n\nAs a test, execute this code in a servlet using Tomcat 5.5.17,\n\nHttpServletResponse sresp = ...\nsresp.setContentType(\"application/xml\");\nSystem.out.println(sresp.getContentType());\n\nwill print,\n\napplication/xml;charset=ISO-8859-1\n\nThis bug makes serving xml files particularly difficult as the charset may be\nset in the xml declaration <?xml charset='...' ?>, or by the first several bytes\nof the xml file.  Often when serving xml, you want to set the mime type as\napplication/xml, and let the client parser determine the charset from the file\ncontents.\n\nTracing through the code, it seems this bug stems from the\nResponse.setLocale(Locale locale) method calling,\ncoyoteResponse.setCharacterEncoding(charset).\n\nIn the method setCharacterEncoding(String charset), there is the line\ncharsetSet=true;\n\nIt may be better if the ResponseObject has a reference to the locale, and if a\ndefault char set is needed, the charset is read from the locale.\n", "id": 102179, "time": "2007-04-23T16:49:28Z", "bug_id": 32499, "creation_time": "2007-04-23T16:49:28Z", "is_private": false}, {"count": 3, "tags": [], "text": "Please do not reopen the report. If you want to discuss this, please use the\nuser list.\n\n*** This bug has been marked as a duplicate of 24970 ***", "attachment_id": null, "id": 102180, "creator": "remm@apache.org", "time": "2007-04-23T17:22:15Z", "bug_id": 32499, "creation_time": "2007-04-23T17:22:15Z", "is_private": false}]
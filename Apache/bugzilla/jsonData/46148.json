[{"count": 0, "tags": [], "bug_id": 46148, "is_private": false, "text": "Created attachment 22830\nSimple test that gets an exception when log_level.jmeter.util is set to DEBUG\n\nIf I set \"log_level.jmeter.util=DEBUG\" in jmeter.properties, SSL requests in HTTP Sampler fails with an exception. If log_level.jmeter.util is set to INFO or not explicitly set, everything works as it should.\n\nThis is the stack trace I get as \"Response data\":\njavax.net.ssl.SSLException: Received fatal alert: unexpected_message\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source)\n\tat java.lang.reflect.Constructor.newInstance(Unknown Source)\n\tat sun.net.www.protocol.http.HttpURLConnection$6.run(Unknown Source)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat sun.net.www.protocol.http.HttpURLConnection.getChainedException(Unknown Source)\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(Unknown Source)\n\tat java.net.HttpURLConnection.getResponseCode(Unknown Source)\n\tat sun.net.www.protocol.https.HttpsURLConnectionImpl.getResponseCode(Unknown Source)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSampler.readResponse(HTTPSampler.java:233)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:463)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1021)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1007)\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:290)\n\tat java.lang.Thread.run(Unknown Source)\nCaused by: javax.net.ssl.SSLException: Received fatal alert: unexpected_message\n\tat com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.recvAlert(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.readDataRecord(Unknown Source)\n\tat com.sun.net.ssl.internal.ssl.AppInputStream.read(Unknown Source)\n\tat java.io.BufferedInputStream.fill(Unknown Source)\n\tat java.io.BufferedInputStream.read1(Unknown Source)\n\tat java.io.BufferedInputStream.read(Unknown Source)\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(Unknown Source)\n\tat sun.net.www.http.HttpClient.parseHTTP(Unknown Source)\n\tat sun.net.www.http.HttpClient.parseHTTP(Unknown Source)\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(Unknown Source)\n\tat sun.net.www.protocol.http.HttpURLConnection.getHeaderField(Unknown Source)\n\tat java.net.URLConnection.getHeaderFieldInt(Unknown Source)\n\tat java.net.URLConnection.getContentLength(Unknown Source)\n\tat sun.net.www.protocol.https.HttpsURLConnectionImpl.getContentLength(Unknown Source)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSampler.readResponse(HTTPSampler.java:203)\n\t... 5 more", "id": 122196, "time": "2008-11-05T00:47:25Z", "creator": "haavard.wigtil@kantega.no", "creation_time": "2008-11-05T00:47:25Z", "attachment_id": 22830}, {"count": 1, "tags": [], "creator": "haavard.wigtil@kantega.no", "attachment_id": 22831, "is_private": false, "id": 122197, "time": "2008-11-05T00:48:25Z", "bug_id": 46148, "creation_time": "2008-11-05T00:48:25Z", "text": "Created attachment 22831\nLog file from the test"}, {"count": 2, "tags": [], "creator": "haavard.wigtil@kantega.no", "attachment_id": 22832, "is_private": false, "id": 122198, "time": "2008-11-05T00:48:45Z", "bug_id": 46148, "creation_time": "2008-11-05T00:48:45Z", "text": "Created attachment 22832\njmeter.properties"}, {"id": 122204, "tags": [], "bug_id": 46148, "is_private": false, "count": 3, "text": "The problem is the debug in HttpSSLProtocolSocketFactory; if you turn that off using\n\nlog_level.jmeter.util.HttpSSLProtocolSocketFactory=INFO\n\nthen the test works OK.\n\nThere is a comment in the debug code that says:\n\n            /* Warning: the next line seems to cause the error\n            * javax.net.ssl.SSLException: Received fatal alert: unexpected_message\n            * with certain sites\n            */\n            SSLSession sslSession = sock.getSession();\n\nLooks like that debug message should be removed.", "time": "2008-11-05T05:41:34Z", "creator": "sebb@apache.org", "creation_time": "2008-11-05T05:41:34Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "is_private": false, "id": 122207, "time": "2008-11-05T07:04:26Z", "bug_id": 46148, "creation_time": "2008-11-05T07:04:26Z", "text": "The getSession() method may initiate the handshake, which is presumably what causes the problem.\n\nThe offending code has been removed:\n\nURL: http://svn.apache.org/viewvc?rev=711582&view=rev\nLog:\nBug 46148 - HTTP sampler fails on SSL requests when logging for jmeter.util is set to DEBUG\nRemove the debug code, as it has side effects\n\n\nThanks for reporting the problem."}]
[{"count": 0, "tags": [], "creator": "kevinj@develop.com", "text": "I have a tld file which is in WEB-INF (called messageboard.tld). This has a \n<listener> element\n\n<listener>\n    <listener-\nclass>com.develop.ejsp.listeners.IntializeDatabaseConnection</listener-class>\n  </listener>\n\nIf I place this in the web.xml file then it is instantiated and works fine. In \nthe tld file however it's not picked up.\n\nAccording to the spec:\n\nJSP.7.1.2.2 Event Listeners\nA tag library may include classes that are event listeners (see the Servlet 2.3\nspecification). The listeners classes are listed in the tag library descriptor \nand the\nJSP container automatically instantiates them and registers them. A container is\nrequired to locate all TLD files (see Section JSP.7.3.1 ...)\n\nJSP.7.3.1 Identifying Tag Library Descriptors\nTag library descriptor files have names that use the extension \u201c.tld\u201d, and the\nextension indicates a tag library descriptor file. \n...\nWhen deployed directly into a web application, the tag library\ndescriptor files must always be in the WEB-INF directory, or some subdirectory\nof it.\n\nMy deployment seems OK, the tld is parsed OK. Is this a bug?", "id": 10010, "time": "2002-01-29T10:19:01Z", "bug_id": 6090, "creation_time": "2002-01-29T10:19:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "craig.mcclanahan@sun.com", "text": "Kevin, this works for me against both the HEAD branch and the current code on\nthe 4.0 branch (which is essentially the same as 4.0.2b2).  I was able to \nsuccessfully register a listener, and see that it was started (because it logged \na message to the servlet context log) simply by virtue of its presence in a TLD \nfile in the WEB-INF subdirectory.\n\nCould you please try this against 4.0.2b2 and verify that it works for you, and \nreopen the report if it does not?\n", "id": 10140, "time": "2002-01-31T21:44:26Z", "bug_id": 6090, "creation_time": "2002-01-31T21:44:26Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "kevinj@develop.com", "is_private": false, "text": "Thanks Craig,\n\nI've created the simplest app I can\n\nI now have this\n\nwebapps\\test\\web-inf\\test.tld\n\ntest.tld looks like this\n(the DOCTYPE)\n<taglib>\n  <tlib-version>1.0</tlib-version>\n  <jsp-version>1.2</jsp-version>\n  <short-name>Test Tags</short-name>\n  \n  <listener>\n    <listener-class>SomeListener</listener-class>\n  </listener>\n\n</taglib>\n\n\n\nMy listener has a System.out.println in contextInitialised. If I install the \nlistener in the web.xml file I see the println. But if I remove the entry from \nweb.xml and do the above it fails.\n\nAm I missing a step, the spec implies to me (but you know how good I am at \nreading specs :-) ) that simply dropping the tld into the web-inf directory \nwould work. \n\nMy web.xml is empty i.e. \n\n<web-app>\n</web-app>\n\nAs I said, if I put the <listener> entry here the listener loads (so I know the \nlistener is OK).\n\nAm I missing a simple step somewhere?", "id": 10165, "time": "2002-02-01T15:13:22Z", "bug_id": 6090, "creation_time": "2002-02-01T15:13:22Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 6090, "attachment_id": null, "text": "Kevin, your \"simple\" test case is a little too simple, so this TLD is going to \nfail XML validation and be rejected.  Why?  If you look at the DTD for tag \nlibrary descriptors, you'll see that \"tag\" has a \"+\" after it -- in other words, \na valid TLD must have at least one <tag> element.  (Yes, that is a horrible bug \nin the spec, but nothing we can do about it this time around ...)\n\nSo, you should be getting a stack trace from a failed validation in one of the \nlog files -- if not (haven't checked yet) that is clearly a Tomcat bug.\n\nNone of this, of course, would explain why a valid (in the XML sense) TLD with a \nlistener in it wouldn't work for you ...\n", "id": 10187, "time": "2002-02-01T21:49:33Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2002-02-01T21:49:33Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 6090, "attachment_id": null, "text": "Craig,\n\n> Kevin, your \"simple\" test case is a little too simple, so this TLD is going to\n> fail XML validation and be rejected.  Why?  If you look at the DTD for tag \n> library descriptors, you'll see that \"tag\" has a \"+\" after it -- in other \n> words, a valid TLD must have at least one <tag> element.  \n> (Yes, that is a horrible bug in the spec, but nothing we can do \n> about it this time around ...)\n> So, you should be getting a stack trace from a failed validation in one of \n> the log files -- if not (haven't checked yet) that is clearly a Tomcat bug.\n\nagreed, but I'm not seeing failures, there's no stack dump and my real test \ncase does have <tag>s in the tld and that didn't work either.\n\nI've fixed the tld and I'm still not seeing it.\n\n\n> None of this, of course, would explain why a valid (in the XML sense) TLD \n> with a listener in it wouldn't work for you ...\n\nCan you re-create this, or is it just me?\n\nKevin", "id": 10188, "time": "2002-02-01T23:12:34Z", "creator": "kevinj@develop.com", "creation_time": "2002-02-01T23:12:34Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 6090, "attachment_id": null, "is_private": false, "id": 10639, "time": "2002-02-13T13:04:33Z", "creator": "kevinj@develop.com", "creation_time": "2002-02-13T13:04:33Z", "text": "I've just tried this on 4.0.2 and I still get the error. My listener is this\n\npublic class SomeListener implements ServletContextListener{\n    public void contextInitialized(ServletContextEvent servletContextEvent){\n        System.out.println(\"*** cI::SomeListener\");\n    }\n    \n    public void contextDestroyed(ServletContextEvent servletContextEvent){\n        System.out.println(\"*** cD::SomeListener\");\n    }\n}\n\nMy tld is in WEB-INF and looks like this\n\n<taglib>\n  <tlib-version>1.0</tlib-version>\n  <jsp-version>1.2</jsp-version>\n  <short-name>Test Tags</short-name>  \n  <listener>\n    <listener-class>SomeListener</listener-class>\n  </listener>\n  <tag>\n    <name>UserName</name>\n    <tag-class>com.develop.ejsp.tags.UserName</tag-class>\n    <body-content>empty</body-content>\n  </tag>\n</taglib>\n\n(I've left the DOCTYPE out for simplicity)\n\nMy web.xml looks like this\n<web-app>\n</web-app>\n\nIf I put the listener entry into the web.xml it works fine.\n\nI've tried this with test.tld and test.TLD"}, {"count": 6, "tags": [], "creator": "remm@apache.org", "text": "Fixed in both branches. Nightly for 02/20 will have the fix.", "id": 10941, "time": "2002-02-20T03:20:59Z", "bug_id": 6090, "creation_time": "2002-02-20T03:20:59Z", "is_private": false, "attachment_id": null}]
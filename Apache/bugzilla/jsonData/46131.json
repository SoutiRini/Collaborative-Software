[{"count": 0, "tags": [], "text": "Javadoc for HttpServletRequest#getContextPath() says:\nFor servlets in the default (root) context, this method returns \"\"\n\nAs long as i do no forward Tomcat does it right.\nHowever, when forwarding via a Filter to another resource the result of getContextPath() changes from \"\" to \"/\".\n\nSmall demo code:\n\npublic class TestFilter implements Filter {\n public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) {\n  String path = ((HttpServletRequest)req).getContextPath();\n  System.out.println(\"Filter context path:\" + path);\n  //prints \"\"\n\n  RequestDispatcher disp = req.getRequestDispatcher(\"/testservlet\");\n  disp.forward(request, response);\n  }\n  ...\n}\n\npublic class TestServlet extends HttpServlet {\n public void service(ServletRequest req, ServletResponse res) {\n  String path = ((HttpServletRequest)req).getContextPath();\n  System.out.println(\"Servlet context path:\" + path);\n  //prints \"\" but when coming from filter prints \"/\"\n }\n}\n\nSmall issue but i've had big problems when using JSF (myfaces) and UrlRewriteFilter for a root context application.\nAs long as no rewriterule matches, JSF generates URLs like \"/path/to/file.jsf\" which the browser interprets as \"http://www.myhost.com/path/to/file.jsf\".\nBut when a rewriterule matches (and a  forward is processed)\nJSF generates URLs like \"//path/to/file.jsf\" which the browser interprets as \"http://path/to/file.jsf\"\n\nMy workaround:\nA HttpServletRequestWrapper which overrides getContextPath()\npublic String getContextPath() {\n return \"/\".equals(super.getContextPath()) ? \"\" : super.getContextPath();\n}", "is_private": false, "bug_id": 46131, "id": 122025, "time": "2008-10-30T06:52:40Z", "creator": "denny.strietzbaum@hybris.de", "creation_time": "2008-10-30T06:52:40Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 46131, "attachment_id": null, "text": "This works for me with a simple filter and servlet. I suspect something else in your setup is responsible for the incorrect return value. ", "id": 122085, "time": "2008-11-01T03:33:25Z", "creator": "markt@apache.org", "creation_time": "2008-11-01T03:33:25Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 46131, "attachment_id": null, "id": 122108, "time": "2008-11-01T14:30:29Z", "creator": "denny.strietzbaum@hybris.de", "creation_time": "2008-11-01T14:30:29Z", "is_private": false, "text": "You're absolutely right.\nI've tried it again at a my home machine and the problem was gone.\nI still have this problem at work with a preconfigured tomcat installation.\nAnyway, i'll change this bug to \"invalid\"."}, {"count": 3, "tags": [], "bug_id": 46131, "attachment_id": null, "text": "Reopened because i've found out more.\nThe problem only occurs when declare the context within server.xml and\nsetting the path to \"/\".\n\nThis (correct) context declaration works as expected:\n<Context path=\"\" docBase=\"D:/path/to/docbase\" />\n\nWhereas this (not so correct) one produces the decribed issue:\n<Context path=\"/\" docBase=\"D:/path/to/docbase\" />\n\nI know it's not a good thing to use the server.xml but unluckily \ni have no influence on that.\n", "id": 122171, "time": "2008-11-04T04:12:10Z", "creator": "denny.strietzbaum@hybris.de", "creation_time": "2008-11-04T04:12:10Z", "is_private": false}, {"count": 4, "tags": [], "text": "A path setting of \"/\" is invalid.", "is_private": false, "bug_id": 46131, "id": 122174, "time": "2008-11-04T06:50:55Z", "creator": "markt@apache.org", "creation_time": "2008-11-04T06:50:55Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "(In reply to comment #4)\n> A path setting of \"/\" is invalid\n\nI know that as i already said this setting is not correct (but it's clear what is meant).\nI don't want discussions about specifications.\nSpecifications must be kept and when they aren't an error or warning should be thrown.\nIt's easy to detected \"/\" as an invalid value and it's even easy to correct this value automatically.\n\nMy motivation simply is that i wasn't responsible for that setting as our server.xml gets generated by a build process which i haven't written.\nI wouldn't have had lost so much time when Tomcat would let me know that there's a problem with it's configuration.\n\nOn the other side that incorrect setting works (as getContextPath returns \"\") as long is i don't do any forwards.\nYou can't say that this is a consistently behavior.\n", "attachment_id": null, "bug_id": 46131, "id": 122201, "time": "2008-11-05T01:41:00Z", "creator": "denny.strietzbaum@hybris.de", "creation_time": "2008-11-05T01:41:00Z", "is_private": false}]
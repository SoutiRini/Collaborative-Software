[{"count": 0, "tags": [], "bug_id": 46534, "attachment_id": 23119, "id": 124066, "time": "2009-01-14T20:06:32Z", "creator": "r.egglestone@auckland.ac.nz", "creation_time": "2009-01-14T20:06:32Z", "is_private": false, "text": "Created attachment 23119\nUse ap_http_scheme and ap_get_server_port to determine the scheme and port\n\nAt present mod_proxy_ajp will always send through the real scheme and port of the request through to a backend server. If the backend server wishes to perform a redirect, then the client will be redirected to the wrong place.\n\n\nFor example, I'm using SSL offload appliance sitting in front of Apache, and Apache receives http on either 80 or 81 for normal or secure. At present, Apache will send http+81 through to the backend server, however with UseCanonicalName off, UseCanonicalPhysicalPort off, and a ServerName of \"https://....:443\", I believe it should be going through as https+443. (Following the advice given in http://httpd.apache.org/docs/2.2/mod/core.html#servername)\n\n\nThe attached patch makes use of the ap_http_scheme and ap_get_server_port functions, so that the UseCanonicalX directives are respected."}]
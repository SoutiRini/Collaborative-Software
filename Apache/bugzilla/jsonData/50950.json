[{"count": 0, "text": "Because this issue (https://issues.apache.org/bugzilla/show_bug.cgi?id=47502) is fixed I re-enabled using the security-constraint in web.xml to protect some pages instead of using my own workaround. But now I get a somewhat similar exception.\n\nThis is running Tomcat 6.0.32 (directly from your tar.gz) on Debian 5 in a cluster of 3 nodes.\nI access my password protected pages over https.\n\n Mar 11, 2011 1:20:48 PM org.apache.catalina.ha.session.DeltaManager requestCompleted\n SEVERE: Unable to serialize delta request for sessionid [7D6D6A80C080C132F7EDCDAA3DFCEFB7]\n java.io.NotSerializableException: org.apache.catalina.realm.GenericPrincipal\n     at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1164)\n     at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:330)\n     at java.util.LinkedList.writeObject(LinkedList.java:943)\n     at sun.reflect.GeneratedMethodAccessor65.invoke(Unknown Source)\n     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n     at java.lang.reflect.Method.invoke(Method.java:597)\n     at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)\n     at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1469)\n     at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1400)\n     at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1158)\n     at java.io.ObjectOutputStream.access$300(ObjectOutputStream.java:143)\n     at java.io.ObjectOutputStream$PutFieldImpl.writeFields(ObjectOutputStream.java:1677)\n     at java.io.ObjectOutputStream.writeFields(ObjectOutputStream.java:462)\n     at javax.security.auth.Subject$SecureSet.writeObject(Subject.java:1281)\n     at sun.reflect.GeneratedMethodAccessor64.invoke(Unknown Source)\n     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n     at java.lang.reflect.Method.invoke(Method.java:597)\n     at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)\n     at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1469)\n     at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1400)\n     at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1158)\n     at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1518)\n     at java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:422)\n     at java.util.Collections$SynchronizedCollection.writeObject(Collections.java:1602)\n     at sun.reflect.GeneratedMethodAccessor63.invoke(Unknown Source)\n     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n     at java.lang.reflect.Method.invoke(Method.java:597)\n     at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)\n     at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1469)", "creator": "ronald-lists@klop.ws", "is_private": false, "id": 145115, "time": "2011-03-20T13:28:18Z", "bug_id": 50950, "creation_time": "2011-03-20T13:28:18Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 50950, "attachment_id": null, "text": "I can't reproduce this issue. Additionally:\n- GenericPrincipal should always be converted to SerializablePrincipal by Tomcat (I can;t see anywhere it isn't)\n- The stack trace provided below is incomplete\n\nIf you re-open this issue you will need to provide information necessary to reproduce this issue from a clean install of the latest Tomcat 6.0.x release.", "id": 145181, "time": "2011-03-21T17:27:19Z", "creator": "markt@apache.org", "creation_time": "2011-03-21T17:27:19Z", "is_private": false}, {"count": 2, "tags": [], "creator": "ronald-lists@klop.ws", "attachment_id": 26798, "text": "Created attachment 26798\nserver.xml and context to reproduce the issue\n\nIf you set up a cluster and ask for /index.jsp than it is ok.\nIf you ask for /intern/index.jsp (behind a password) than you get serialization exceptions.\nAs far as I see, there is no other Realm type which is serializable.\nWhy is this object on the session anyway?\n\nMar 25, 2011 5:35:17 PM org.apache.catalina.ha.session.DeltaManager requestCompleted\nSEVERE: Unable to serialize delta request for sessionid [F9D61003F2344ED314504FDE3BDF9FDA]\njava.io.NotSerializableException: org.apache.catalina.realm.GenericPrincipal\n        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1180)\n        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:346)\n        at java.util.LinkedList.writeObject(LinkedList.java:960)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)", "id": 145261, "time": "2011-03-25T12:51:55Z", "bug_id": 50950, "creation_time": "2011-03-25T12:51:55Z", "is_private": false}, {"count": 3, "text": "You asked for the complete stack.\nMar 25, 2011 5:35:17 PM org.apache.catalina.ha.session.DeltaManager requestCompleted\nSEVERE: Unable to serialize delta request for sessionid [F9D61003F2344ED314504FDE3BDF9FDA]\njava.io.NotSerializableException: org.apache.catalina.realm.GenericPrincipal\n        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1180)\n        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:346)\n        at java.util.LinkedList.writeObject(LinkedList.java:960)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:616)\n        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:962)\n        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1480)\n        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1416)\n        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1174)\n        at java.io.ObjectOutputStream.access$300(ObjectOutputStream.java:161)\n        at java.io.ObjectOutputStream$PutFieldImpl.writeFields(ObjectOutputStream.java:1687)\n        at java.io.ObjectOutputStream.writeFields(ObjectOutputStream.java:478)\n        at javax.security.auth.Subject$SecureSet.writeObject(Subject.java:1300)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:616)\n        at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:962)\n        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1480)\n        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1416)\n        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1174)\n        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1528)\n        at java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:438)", "bug_id": 50950, "attachment_id": null, "id": 145262, "time": "2011-03-25T12:53:38Z", "creator": "ronald-lists@klop.ws", "creation_time": "2011-03-25T12:53:38Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 50950, "text": "(In reply to comment #3)\n> You asked for the complete stack.\n\nThe stack trace is still incomplete. What calls the last line in your comment (below)? - where the ObjectOutputStream is called from?\n\n>(...)\n> java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:438)\n\nNote, that is is not necessary to paste the stacktrace as a comment:\nyou can attach it as a file.", "id": 145278, "time": "2011-03-25T18:45:16Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-03-25T18:45:16Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 50950, "attachment_id": 26803, "id": 145331, "time": "2011-03-28T03:09:58Z", "creator": "ronald-lists@klop.ws", "creation_time": "2011-03-28T03:09:58Z", "is_private": false, "text": "Created attachment 26803\nfull stacktrace\n\nMmm, my (new) terminal doesn't copy what is outside the viewport. Now you have a complete stack."}, {"count": 6, "tags": [], "bug_id": 50950, "attachment_id": null, "id": 146136, "time": "2011-05-05T10:31:40Z", "creator": "markt@apache.org", "creation_time": "2011-05-05T10:31:40Z", "is_private": false, "text": "The attached test case is just an empty zip. Not helpful.\n\nFailing to mention that this only occurs when running a security manager and that the stack trace appears on session expiration was also not helpful. \n\nFortunately, there were enough clues in the stacktrace to figure out what was going on and I can now reproduce this. I'm currently working on a fix."}, {"count": 7, "tags": [], "bug_id": 50950, "text": "This is fixed in 7.0.x and will be included in 7.0.13 onwards.\n\nIt looks like back-porting the 7.0.x will be insufficient to address all the issues in 6.0.x. I'm working on a 6.0.x patch.", "id": 146138, "time": "2011-05-05T12:46:36Z", "creator": "markt@apache.org", "creation_time": "2011-05-05T12:46:36Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 50950, "text": "Hmm. The reproduction steps that worked on Tomcat 7, don't on Tomcat 6.\n\nPlease provide the steps and configuration necessary to reproduce this on the latest Tomcat 6 source. Without steps to reproduce, this will eventually get resolved as WORKSFORME.", "id": 146139, "time": "2011-05-05T13:23:42Z", "creator": "markt@apache.org", "creation_time": "2011-05-05T13:23:42Z", "is_private": false, "attachment_id": null}, {"attachment_id": 26979, "tags": [], "creator": "ronald-lists@klop.ws", "text": "Created attachment 26979\nzip with content (logs/web dir/conf)\n\nHi, in the attachment more content hopefully. I must be a dumb-ass to upload an empty zip.\nIndeed I use the security manager, because my app uses rmi. Didn't mention it, because I run it for years already and didn't think about it.\n\nIn the zip is a context. I use 'pen -fr 8080 localhost:8081 localhost:8082' as a loadbalancer and 'connection: close' for this test, so requests go round robin.\nIf you go to / (or /index.jsp) you get a session and all is well. If you than go to /intern/ you get an exception as is seen in catalina.out.node-b.\n\nThis is on 6.0.32 as you can see in the logs.\n\nI hope I have provided better info this time. Thanks for looking into this.", "count": 9, "id": 146216, "time": "2011-05-09T16:04:45Z", "bug_id": 50950, "creation_time": "2011-05-09T16:04:45Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 50950, "attachment_id": null, "text": "Thanks. That did it. The fix is the same in 6 as it was in 7. I have proposed the patch.", "id": 146223, "time": "2011-05-09T17:15:18Z", "creator": "markt@apache.org", "creation_time": "2011-05-09T17:15:18Z", "is_private": false}, {"count": 11, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "Fixed in 6.0.x and will be included in 6.0.33 onwards.", "id": 146238, "time": "2011-05-10T08:36:25Z", "bug_id": 50950, "creation_time": "2011-05-10T08:36:25Z", "attachment_id": null}]
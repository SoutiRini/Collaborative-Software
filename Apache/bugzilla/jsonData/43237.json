[{"count": 0, "tags": [], "bug_id": 43237, "attachment_id": null, "id": 107383, "time": "2007-08-29T05:05:06Z", "creator": "hussein@xmlmind.com", "creation_time": "2007-08-29T05:05:06Z", "is_private": false, "text": "This IndexOutOfBoundsException:\n\n===============================================================\njava.lang.IndexOutOfBoundsException: Index: 1, Size: 1\n        at java.util.ArrayList.RangeCheck(ArrayList.java:508)\n        at java.util.ArrayList.get(ArrayList.java:320)\n        at\norg.apache.fop.layoutmgr.PageBreakingAlgorithm.computeDemerits(PageBreakingAlgorithm.java:644)\n        at\norg.apache.fop.layoutmgr.BreakingAlgorithm.considerLegalBreak(BreakingAlgorithm.java:737)\n        at\norg.apache.fop.layoutmgr.PageBreakingAlgorithm.considerLegalBreak(PageBreakingAlgorithm.java:309)\n        at\norg.apache.fop.layoutmgr.BreakingAlgorithm.findBreakingPoints(BreakingAlgorithm.java:485)\n        at\norg.apache.fop.layoutmgr.BreakingAlgorithm.findBreakingPoints(BreakingAlgorithm.java:403)\n        at\norg.apache.fop.layoutmgr.AbstractBreaker.doLayout(AbstractBreaker.java:338)\n        at\norg.apache.fop.layoutmgr.AbstractBreaker.doLayout(AbstractBreaker.java:263)\n        at\norg.apache.fop.layoutmgr.PageSequenceLayoutManager.activateLayout(PageSequenceLayoutManager.java:144)\n        at\norg.apache.fop.area.AreaTreeHandler.endPageSequence(AreaTreeHandler.java:233)\n        at\norg.apache.fop.fo.pagination.PageSequence.endOfNode(PageSequence.java:145)\n        at\norg.apache.fop.fo.FOTreeBuilder$MainFOHandler.endElement(FOTreeBuilder.java:378)\n        at org.apache.fop.fo.FOTreeBuilder.endElement(FOTreeBuilder.java:194)\n===============================================================\n\nWorkaround:\n\n  In src/java/org/apache/fop/layoutmgr/PageBreakingAlgorithm.java, replace:\n\n===============================================================\nif (footnotesPending) {\n    if (footnoteListIndex < footnotesList.size() - 1) {\n        // add demerits for the deferred footnotes\n        demerits += (footnotesList.size() - 1 - footnoteListIndex) \n                        * deferredFootnoteDemerits;\n    }\n    if (footnoteElementIndex \n            < ((LinkedList) footnotesList.get(footnoteListIndex)).size() - 1) {\n        // add demerits for the footnote split between pages\n        demerits += splitFootnoteDemerits;\n    }\n}\n===============================================================\n \n  by:\n\n===============================================================\nif (footnotesPending) {\n    int footnotesListSize = footnotesList.size();\n    if (footnoteListIndex < footnotesListSize - 1) {\n        // add demerits for the deferred footnotes\n        demerits += (footnotesListSize - 1 - footnoteListIndex) \n                        * deferredFootnoteDemerits;\n    }\n    if (footnoteListIndex < footnotesListSize &&\n        footnoteElementIndex \n            < ((LinkedList) footnotesList.get(footnoteListIndex)).size() - 1) {\n        // add demerits for the footnote split between pages\n        demerits += splitFootnoteDemerits;\n    }\n}\n==============================================================="}, {"attachment_id": null, "tags": [], "creator": "vhennebert@gmail.com", "is_private": false, "count": 1, "id": 107475, "time": "2007-08-30T08:16:13Z", "bug_id": 43237, "creation_time": "2007-08-30T08:16:13Z", "text": "Hi,\n\nCan you please attach to this bug a short FO file showing the exception? It\nmight serve as a testcase.\n\nThanks,\nVincent"}, {"count": 2, "tags": [], "bug_id": 43237, "attachment_id": null, "id": 107476, "time": "2007-08-30T09:04:54Z", "creator": "hussein@xmlmind.com", "creation_time": "2007-08-30T09:04:54Z", "is_private": false, "text": "I'm really sorry but I don't have a short XSL-FO file which may be used to\neasily reproduce this problem. I just have a large one, moreover full of\nfo:external-graphic.\n\nI presumed that by reading the code pinpointed by the stack trace, you could\nguess   in which conditions such IndexOutOfBoundsException occurs.\n\n"}, {"count": 3, "tags": [], "bug_id": 43237, "attachment_id": null, "is_private": false, "id": 107695, "time": "2007-09-04T05:50:53Z", "creator": "rainer.maximini@ser.de", "creation_time": "2007-09-04T05:50:53Z", "text": "I have exact the same problem here, but also only in a very large XSL-FO file.\nThe described workaround does not works correct because the first footnote is\nalways missing.\n"}, {"count": 4, "tags": [], "bug_id": 43237, "attachment_id": null, "is_private": false, "id": 108345, "time": "2007-09-18T09:24:08Z", "creator": "LaslovD@spardat.at", "creation_time": "2007-09-18T09:24:08Z", "text": "I did an other workaround, that seems to work: I changed \n\n==========================================\n    private void resetFootnotes(LinkedList elementLists) {\n        for (int i = 0; i < elementLists.size(); i++) {\n            LinkedList removedList = (LinkedList)\nfootnotesList.remove(footnotesList.size() - 1);\n            lengthList.remove(lengthList.size() - 1);\n\n            // update totalFootnotesLength\n            if (lengthList.size() > 0) {\n                totalFootnotesLength = ((Integer)\nlengthList.get(lengthList.size() - 1)).intValue();\n            } else {\n                totalFootnotesLength = 0;\n            }\n        }\n        // update footnotesPending;\n        if (footnotesList.size() == 0) {\n            footnotesPending = false;\n        }\n    }\n=================================================\n\nto \n\n=================================================\n    private void resetFootnotes(LinkedList elementLists) {\n        for (int i = 0; i < elementLists.size(); i++) {\n            LinkedList removedList = (LinkedList)\nfootnotesList.remove(footnotesList.size() - 1);\n            lengthList.remove(lengthList.size() - 1);\n\n            // update totalFootnotesLength\n            if (lengthList.size() > 0) {\n                totalFootnotesLength = ((Integer)\nlengthList.get(lengthList.size() - 1)).intValue();\n            } else {\n                totalFootnotesLength = 0;\n            }\n        }\n        footnoteListIndex = footnotesList.size() - 1;\n        // update footnotesPending;\n        if (footnotesList.size() == 0) {\n            footnotesPending = false;\n        }\n    }\n=================================================\n\n(difference is only adding one line)\n\nBTW: my FO is very huge too (about 1.7 MB)\n"}, {"count": 5, "tags": [], "bug_id": 43237, "attachment_id": null, "id": 108588, "time": "2007-09-25T12:53:39Z", "creator": "jmt4b04d4v@gmail.com", "creation_time": "2007-09-25T12:53:39Z", "is_private": false, "text": "Got into same issue, my scenario:\n  * svn-book.fo (Subversion Book), FO file obtained with Xalan-J-2.7.0 (from\nfop-0.94 distro), not xsltproc. Testcase candidate? (I tried to attach .fo file\nwithout results)"}, {"count": 6, "tags": [], "bug_id": 43237, "attachment_id": null, "is_private": false, "id": 157318, "time": "2012-04-07T01:41:25Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:41:25Z", "text": "resetting P2 open bugs to P3 pending further review"}]
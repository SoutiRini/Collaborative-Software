[{"count": 0, "tags": [], "creator": "knut@tech.cj.com", "text": "We're using version 1.0.2, but the source code for newer releases have no change\nin this area.  The problem is the expression evaluator:\n\njakarta-taglibs/standard/src/org/apache/taglibs/standard/lang/jstl/ELEvaluator.java\n\nBy default it sets up a hash map to cache the values of each expression it\nevaluates, but there is no upper limit on how large the cache is allowed to\ngrow.  In our case the application grows approx 500 MByte in a 24 hour period. \nI have searched for other mentionings of the same problem and found only one:\n\nhttp://www.mail-archive.com/taglibs-user@jakarta.apache.org/msg07007.html\n\nFor now I have set up a bit of a hack to work around the issue.  Since there is\nno easy way to access this class from outside the package I had to make a new\nclass in a package with the same name.  This is a subclass of\njava.util.LinkedHashMap that won't grow indefinitely.  I just swap it in\nreplacing the existing ELEvaluator.sCachedExpressionStrings\n\nI think the standard cache in ELEvaluatorCache should have an upper size limit.\n\n\n\n\n\nimport org.apache.taglibs.standard.lang.support.ExpressionEvaluatorManager;\nimport java.util.Collections;\nimport java.util.LinkedHashMap;\nimport java.util.Map;\nimport javax.servlet.jsp.JspException;\nimport org.apache.log4j.Logger;\n\n/**\n * @author Knut Forkalsrud\n */\npublic class EvaluatorCache\n    extends LinkedHashMap\n{\n    int maxEntries;\n\n    public EvaluatorCache(int maxEntries) {\n        super((int)((float)maxEntries / 0.75), (float)0.75, true);\n        this.maxEntries = maxEntries;\n    }\n\n    protected boolean removeEldestEntry(Map.Entry eldest) {\n        return size() > maxEntries;\n    }\n\n    public static void replaceCacheImpl(int maxEntries) {\n        ELEvaluator.sCachedExpressionStrings\n            = Collections.synchronizedMap(new EvaluatorCache(maxEntries));\n    }\n}\n\n// eof", "id": 60670, "time": "2004-07-16T01:32:13Z", "bug_id": 30136, "creation_time": "2004-07-16T01:32:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "dhiru.pandey@sun.com", "text": "\n\n*** This bug has been marked as a duplicate of 31789 ***", "id": 71411, "time": "2005-02-23T19:35:06Z", "bug_id": 30136, "creation_time": "2005-02-23T19:35:06Z", "is_private": false, "attachment_id": null}]
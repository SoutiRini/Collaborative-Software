[{"count": 0, "tags": [], "bug_id": 1646, "attachment_id": null, "text": "Error: 500\nLocation: /nwd/src/db/NWDJ_DBlinkInfo.jsp\nInternal Servlet Error:\norg.apache.jasper.JasperException: Unable to rename class file /\nopt/tomcat/work/localhost_8080%2Fnwd/src/db/_0002fsrc_0002fdb_\n0002fNWDJ_0005fDBlinkInfo_0002ejspNWDJ_0005fDBlinkInfo_jsp_11.\nclass to /opt/tomcat/work/localhost_8080%2Fnwd/_0002fsrc_0002fdb\n_0002fNWDJ_0005fDBlinkInfo_0002ejspNWDJ_0005fDBlinkInfo.class\nat org.apache.jasper.compiler.Compiler.compile(Compiler.  java:263)\nat org.apache.jasper.runtime.JspServlet.loadJSP (JspServlet.java:413)\nat org.apache.jasper.runtime.JspServlet$ JspServletWrapper.loadIfNecessary\n(JspServlet.java:149)\nat org.apache.jasper.runtime.JspServlet$ JspServletWrapper.service\n(JspServlet.java:161)\n\nAfter release a new version of JSP , Tomcat will recompile and reload the JSP \nwhen the first request for the JSP comes. But if servral requests come on the \nsame time , the error above may happen.\n\nThe reason that I think is a programming miss in \norg.apache.jasper.runtime.JspServlet.java :\n412        try {\n413            outDated = compiler.compile();\n414            if ((jspClass == null) || (compiler.isOutDated())) {\n415                synchronized ( this ) {\n416                    if ((jspClass == null) || (compiler.isOutDated() ))\n417                        outDated = compiler.compile();\n418                }\n419            }\n\nThe line 413 is not synchronized so more than one thread may compile the same \nJSP on the same time. So in org.apache.jasper.compiler.Compiler.compile\n(Compiler.  java:263),one thread can not rename a class file that had already \nbeen renamed and moved by another thread. You can have the error easier by add \na sleep just befor Compiler.java:line 263.\n\nIn fact line 414 to line 418 do the same job perfect.I don't understand why \nline 413 is there. I try to delete the line 413 and test again , there is no \nerror any more.\n\nI test this on Tomcat 3.1, but it seems the same source is also in Tomcat3.2.1.\nI am not sure whether it is a bug or fix it on the right way. Thank you very \nmuch for your help.", "id": 2304, "time": "2001-05-07T22:29:41Z", "creator": "zhongdong-wang@togem.kawatetsu.ne.jp", "creation_time": "2001-05-07T22:29:41Z", "is_private": false}, {"count": 1, "tags": [], "creator": "marc.saegesser@apropos.com", "attachment_id": null, "id": 3130, "time": "2001-06-20T12:50:52Z", "bug_id": 1646, "creation_time": "2001-06-20T12:50:52Z", "is_private": false, "text": "JspServlet was substantially rewritten for Tomcat 3.2.2 to avoid this and \nseveral other thread synchronization problems.  "}]
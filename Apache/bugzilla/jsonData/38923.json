[{"count": 0, "tags": [], "creator": "rmg@terc.edu", "attachment_id": null, "id": 86694, "time": "2006-03-10T19:58:25Z", "bug_id": 38923, "creation_time": "2006-03-10T19:58:25Z", "is_private": false, "text": "Given a misspelled request with more than one likely correct spelling,\nmod_speling returns a list of variant spellings to the client. When it does, it\nmay produce incorrect and/or broken links due to incorrect escaping of its\noutput. For example:\n\n[build (with --enable-speling) and install httpd-2.2.0]\n[set \"CheckSpelling On\" in httpd.conf, and run httpd]\ncd $PREFIX/htdocs\ntouch \"lamp making\"\ntouch \"ramp making\"\ntouch \"&amp making\"\n[visit /camp%20making in a browser (tested with Firefox)]\n[note the broken link to \"& making\"]\n\nSo mod_speling fails to perform html escaping on the uri-escaped filenames.\n\nNot only that, it incorrectly escapes the \"?\" and contents of the query string\nin variant spellings if a query string is included in the original request. For\nexample:\n\ntouch foo\ntouch goo\n[visit /yoo?hoo=%3f in a browser]\n[note the broken links to \"foo%3fhoo=%253f\" and \"goo%3fhoo=%253f\"]\n\nSo it needs to perform uri escaping only on the filename part of each URL and\nthen add the \"?\" and query string to produce the link. Plus html-escaping the\nwhole thing (see first example). \n\nAs well, mod_speling output may include a link to the referring page. This link\nneeds to be html-escaped instead of being uri-escaped as it is now. It is\nnormally already uri-escaped by the browser, and double-escaping it will break\nthe link. For example, a referer URL of \"http://example.com/foo?bar=%3f\" becomes\n\"http://example.com/foo%3fbar=%253f\", which refers to a resource named\n\"foo?bar=%3f\" rather than a resource named \"foo\" plus a query string as\nintended. If the browser isn't already sending properly escaped referer URLs,\nthen it probably deserves to be broken.\n\nAs best I can tell, these bugs are also present in the 1.3.x and 2.0.x versions\nof mod_speling.\n\nI'll plan to work on a patch later today unless someone else wants to do it."}, {"count": 1, "attachment_id": 17866, "creator": "rmg@terc.edu", "is_private": false, "id": 86696, "time": "2006-03-10T20:03:09Z", "bug_id": 38923, "creation_time": "2006-03-10T20:03:09Z", "tags": [], "text": "Created attachment 17866\ntrivial patch to fix referer escaping"}, {"count": 2, "tags": [], "text": "Created attachment 17870\nfix escaping of variant links\n\n- query string is built and html-escaped in a separate variable\n- query string is not displayed in anchor text\n- resource name is html-escaped and uri-escaped in links\n- v array size increased to account for additional query string\n- t array size was already big enough", "is_private": false, "bug_id": 38923, "id": 86705, "time": "2006-03-11T03:58:53Z", "creator": "rmg@terc.edu", "creation_time": "2006-03-11T03:58:53Z", "attachment_id": 17870}, {"count": 3, "tags": [], "bug_id": 38923, "attachment_id": 17871, "is_private": false, "id": 86706, "time": "2006-03-11T08:40:23Z", "creator": "rmg@terc.edu", "creation_time": "2006-03-11T08:40:23Z", "text": "Created attachment 17871\ncode style tweaks"}, {"count": 4, "tags": [], "bug_id": 38923, "is_private": false, "text": "Finally fixed in 2.4.28 (r1808780) by removing the Referer link in the error page (of today).", "id": 201277, "time": "2017-10-03T13:11:24Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2017-10-03T13:11:24Z", "attachment_id": null}]
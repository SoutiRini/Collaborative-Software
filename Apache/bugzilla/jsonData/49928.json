[{"count": 0, "tags": [], "creator": "mrbobsmithdev@gmail.com", "attachment_id": 26025, "id": 139866, "time": "2010-09-14T10:48:47Z", "bug_id": 49928, "creation_time": "2010-09-14T10:48:47Z", "is_private": false, "text": "Created attachment 26025\nA cell containing \u00a31, that is formatted by POI as $1\n\nSteps to reproduce:\n\n1. Using a machine set to the English locale, create an xlsx file using Excel 2007.\n2. Type \"\u00a31\" into a cell and observe that Excel converts it to a currency type cell with the \"\u00a3\" symbol. (See attachment).\n3. Use POI to read the cell from step 2; call [new org.apache.poi.ss.usermodel.DataFormatter.formatCellValue(Cell)] on the cell.\n4. Observe that the returned value is \"$1\", not \"\u00a31\" as expected."}, {"count": 1, "tags": [], "bug_id": 49928, "text": "I'm pretty sure you're being bitten by an excel \"feature\". Excel is probably treating your \u00a3 as a generic currency symbol, and actually storing a $ in the file\n\nCan you please try opening your sample file on a computer set to be in the US, and see what you get in excel?\n\nI've just created a file with formattings of both $00.00 and \u00a300.00, and POI is able to retrieve both symbols properly. So, I think the problem is with how you're setting the format, and not with POI", "id": 139933, "time": "2010-09-17T10:19:56Z", "creator": "apache@gagravarr.org", "creation_time": "2010-09-17T10:19:56Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 49928, "attachment_id": null, "id": 140429, "time": "2010-10-04T05:53:39Z", "creator": "mrbobsmithdev@gmail.com", "creation_time": "2010-10-04T05:53:39Z", "is_private": false, "text": "> Can you please try opening your sample file on a computer set to be in the US,\nand see what you get in excel?\n\nI have set my locale to US, and when I open the sample file I am shown \"\u00a31\". I have tried this on two different systems - running Vista and Windows 7.\n\nFor reference, in the following posts I will attach screenshots of how the formatting dialog looks when opening the sample file in an English locale, and in a US locale."}, {"count": 3, "tags": [], "bug_id": 49928, "attachment_id": 26116, "id": 140430, "time": "2010-10-04T05:54:54Z", "creator": "mrbobsmithdev@gmail.com", "creation_time": "2010-10-04T05:54:54Z", "is_private": false, "text": "Created attachment 26116\nThe Excel format dialog in an English locale"}, {"attachment_id": 26117, "tags": [], "creator": "mrbobsmithdev@gmail.com", "is_private": false, "count": 4, "id": 140431, "time": "2010-10-04T05:56:05Z", "bug_id": 49928, "creation_time": "2010-10-04T05:56:05Z", "text": "Created attachment 26117\nThe Excel format dialog in a US locale"}, {"count": 5, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "OK, this is odd\n\nIn the english locale, it shows up as the default currency symbol. This is what I'd expect, as excel is actually writing the file with a $ and not a \u00a3\n\nIn the US locale, excel seems to know that it really does need to be a \u00a3, and not be the default currency. Thus, it shows up as a custom format with a \u00a3 in it\n\nQuite how Excel is managing to know this I've no idea...\n\nI'll need to do some more digging when I have a minute", "id": 140432, "time": "2010-10-04T06:08:42Z", "bug_id": 49928, "creation_time": "2010-10-04T06:08:42Z", "is_private": false}, {"count": 6, "tags": [], "text": "Fixed in r1005726, junit added. \n\nThe problem workbook demonstrates an unexpected behavior. Excel has a set of built-in formats referenced by an integer id in the range [0, 164]. If a custom format is applied then it is created with a new id above 164. This behavior is observed in Excel 2003 and Excel 2007, both for the .xls and .xlsx formats.\n\nIn your case a custom format was applied, but its formatId was 6, i.e. in the built-in range. As the result, DataFormatter picked up a wrong built-in format with Dollar instead of Pound. \n\nI fixed the order in which formats are checked, now overridden formats have higher priority than built-in ones regardless from formatId. \n\nYegor", "is_private": false, "bug_id": 49928, "id": 140577, "time": "2010-10-08T04:42:22Z", "creator": "yegor@dinom.ru", "creation_time": "2010-10-08T04:42:22Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 49928, "text": "I am re-opening this, because although the fix works for .xlsx files, it does not work for .xls files.", "id": 142855, "time": "2010-12-20T08:03:57Z", "creator": "mrbobsmithdev@gmail.com", "creation_time": "2010-12-20T08:03:57Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "Created attachment 26427\nThe original test-case file, saved as .xls\n\nThis file was created from the originally posted test-case by using Excel to save-as .xls. The original test case file does not exhibit the bug any more, but this file does.", "is_private": false, "bug_id": 49928, "id": 142856, "time": "2010-12-20T08:06:18Z", "creator": "mrbobsmithdev@gmail.com", "creation_time": "2010-12-20T08:06:18Z", "attachment_id": 26427}, {"count": 9, "tags": [], "bug_id": 49928, "is_private": false, "id": 143097, "creation_time": "2011-01-05T12:22:18Z", "time": "2011-01-05T12:22:18Z", "creator": "mrbobsmithdev@gmail.com", "text": "> The original test case file does not exhibit the bug any more, but this file does.\n\nTo be clear, I mean that in version 3.7 the bug has been fixed for .xlsx/XSSF, but not for .xls/HSSF.", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 49928, "text": "Looks like the .xls has overridden some standard formats as well:\n\nOffset=0x000003DA(986) recno=44 sid=0x041E size=0x0018(24)\n[FORMAT]\n    .indexcode       = 0x0005\n    .isUnicode       = false\n    .formatstring    = \"\u00a3\"#,##0;\\-\"\u00a3\"#,##0\n[/FORMAT]\n\nOffset=0x000003F6(1014) recno=45 sid=0x041E size=0x001D(29)\n[FORMAT]\n    .indexcode       = 0x0006\n    .isUnicode       = false\n    .formatstring    = \"\u00a3\"#,##0;[Red]\\-\"\u00a3\"#,##0\n[/FORMAT]", "id": 143494, "time": "2011-01-20T07:43:15Z", "creator": "apache@gagravarr.org", "creation_time": "2011-01-20T07:43:15Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 143496, "time": "2011-01-20T08:20:51Z", "bug_id": 49928, "creation_time": "2011-01-20T08:20:51Z", "is_private": false, "text": "Should be fixed for HSSF too in r1061288 - needed a similar fix"}]
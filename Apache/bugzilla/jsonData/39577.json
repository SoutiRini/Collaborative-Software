[{"count": 0, "tags": [], "creator": "mslinn@mslinn.com", "text": "JSPs in subdirectories can't access classes in WEB-INF/classes or WEB-INF/lib. \nFor example, if webapps/ROOT/x.jsp contains:\n<pre><% com.mslinn.util.Test test = new com.mslinn.util.Test(); %>\n<%=test.test()%></pre>\nand Test is very short:\n<pre>package com.mslinn.util; \npublic class Test {\n\t   public Test() {}\n\t   public String test() { return \"Ya varmint!\";}\n}</pre>\nThen the JSP will compile and run properly.  If, however, the JSP is moved to\n/webapps/ROOT/blah/x.jsp then errors result:\n<pre>HTTP Status 500 -\n\ntype Exception report\n\nmessage\n\ndescription The server encountered an internal error () that prevented it from\nfulfilling this request.\n\nexception\n\norg.apache.jasper.JasperException: Exception in JSP: /x.jsp:2\n\n1: <% com.mslinn.util.Test test = new com.mslinn.util.Test(); %>\n2: <%=test.test()%>\n\n\nStacktrace:\n\torg.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:504)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:375)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nroot cause\n\njavax.servlet.ServletException: com.mslinn.util.Test.test()Ljava/lang/String;\n\torg.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:858)\n\torg.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:791)\n\torg.apache.jsp.x_jsp._jspService(x_jsp.java:51)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:97)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:332)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nroot cause\n\njava.lang.NoSuchMethodError: com.mslinn.util.Test.test()Ljava/lang/String;\n\torg.apache.jsp.x_jsp._jspService(x_jsp.java:44)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:97)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:332)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nnote The full stack trace of the root cause is available in the Apache\nTomcat/5.5.17 logs.\nApache Tomcat/5.5.17</pre>", "id": 89091, "time": "2006-05-14T10:53:19Z", "bug_id": 39577, "creation_time": "2006-05-14T10:53:19Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "This works for me (with a default configuration).\n\nPlease make sure, that \n\n- your compiled class com.mslinn.util.Test is up to date, so that it really\nincludes a method with the signature \n   com.mslinn.util.Test.test()Ljava/lang/String;\nNote that the class could be found, but there was no method with the right\nsignature in there: java.lang.NoSuchMethodError.\n\n- you called the right URL: your excepton stack indicates, that tomcat didn't\ncall /blah/x.jsp instead it called /x.jsp. So maybe the log entry does not\nbelong to the observed error. Try again with a clean setup.\n\n- you don't have a context \"blah\" defined somewhere\n\n- you inspect the Java source file jasper produced for /blah/x.jsp.\nThe file is located in\n$CATALINA_BASE/work/<ENGINE_NAME,DEFAULT=Catalina>/<HOST_NAME,DEFAULT=localhost>/_/org/apache/jsp/blah/x_jsp.java\n\nIf you want to reopen the issue, please attach a self-contained war file.", "id": 89093, "time": "2006-05-14T11:51:32Z", "bug_id": 39577, "creation_time": "2006-05-14T11:51:32Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 39577, "attachment_id": null, "text": "My sample code with 'blah' in it were intended to be generic; the example was\nconcrete using the 'includes' directory.  Apologies for the confusion.  (I wrote\nthe bug report at 4am after a long struggle.)\n\nI know that the method signature is correct because test.jsp works when in the\nroot directory, but not in a subdirectory, as previously stated.\n\nI am not using a war file.  I will upload the files in question.\n\nThe configuration includes several CATALINA_BASE instances; this bug pertains to\nCATALINA_BASE=/var/home/www/mslinn.com/www/production, using Engine=msp.  I see\ntest_jsp.java in two subdirectories, corresponding to the two subdirectories\nthat I have tried to load from:\n/var/home/www/mslinn.com/www/production/work/msp/www.mslinn.com/_/org/apache/jsp/test_jsp.java\n/var/home/www/mslinn.com/www/production/work/msp/www.mslinn.com/includes/org/apache/jsp/test_jsp.java", "id": 89094, "time": "2006-05-14T15:40:01Z", "creator": "mslinn@mslinn.com", "creation_time": "2006-05-14T15:40:01Z", "is_private": false}, {"count": 3, "tags": [], "creator": "mslinn@mslinn.com", "attachment_id": 18271, "id": 89095, "time": "2006-05-14T15:41:38Z", "bug_id": 39577, "creation_time": "2006-05-14T15:41:38Z", "is_private": false, "text": "Created attachment 18271\nignore this file\n\nThis file works when in webapps/ROOT/, but not when in\nwebapps/ROOT/someOtherDirectory."}, {"count": 4, "tags": [], "creator": "mslinn@mslinn.com", "attachment_id": 18271, "id": 89096, "time": "2006-05-14T15:43:27Z", "bug_id": 39577, "creation_time": "2006-05-14T15:43:27Z", "is_private": false, "text": "Comment on attachment 18271\nignore this file\n\n<% com.mslinn.util.Test test = new com.mslinn.util.Test(); %>\n<%=test.test()%>"}, {"count": 5, "tags": [], "creator": "mslinn@mslinn.com", "attachment_id": 18272, "id": 89097, "time": "2006-05-14T15:45:50Z", "bug_id": 39577, "creation_time": "2006-05-14T15:45:50Z", "is_private": false, "text": "Created attachment 18272\nDemonstrates JSP problem\n\n<% com.mslinn.util.Test test = new com.mslinn.util.Test(); %>\n<%=test.test()%>"}, {"count": 6, "tags": [], "bug_id": 39577, "attachment_id": 18273, "text": "Created attachment 18273\nGenerated source for /var/home/www/mslinn.com/www/production/work/msp/www.mslinn.com/_/org/apache/jsp/test_jsp.java", "id": 89098, "time": "2006-05-14T15:49:49Z", "creator": "mslinn@mslinn.com", "creation_time": "2006-05-14T15:49:49Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 39577, "is_private": false, "id": 89099, "attachment_id": 18273, "creator": "mslinn@mslinn.com", "creation_time": "2006-05-14T15:52:50Z", "time": "2006-05-14T15:52:50Z", "text": "Comment on attachment 18273\nGenerated source for /var/home/www/mslinn.com/www/production/work/msp/www.mslinn.com/_/org/apache/jsp/test_jsp.java\n\nThis file is not created when test.jsp is placed in a subdirectory"}, {"count": 8, "tags": [], "bug_id": 39577, "attachment_id": 18274, "text": "Created attachment 18274\ncustom server.xml", "id": 89100, "time": "2006-05-14T15:53:36Z", "creator": "mslinn@mslinn.com", "creation_time": "2006-05-14T15:53:36Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 39577, "text": "Created attachment 18275\nClass demonstrating problem\n\nWhen referencing a class that did not have a method which returned a String,\nthe problem did not manifest.  This attachment does have a method returning a\nString.", "id": 89101, "attachment_id": 18275, "creator": "mslinn@mslinn.com", "creation_time": "2006-05-14T15:55:45Z", "time": "2006-05-14T15:55:45Z", "is_private": false}, {"count": 10, "tags": [], "creator": "mslinn@mslinn.com", "attachment_id": 18276, "id": 89103, "time": "2006-05-14T16:07:05Z", "bug_id": 39577, "creation_time": "2006-05-14T16:07:05Z", "is_private": false, "text": "Created attachment 18276\ncustom server.xml"}, {"count": 11, "tags": [], "bug_id": 39577, "attachment_id": 18276, "text": "Comment on attachment 18276\ncustom server.xml\n\nI wonder if the Host appBase=\"webapps/ROOT\" is a problem.  Note that the\nContext docBase is \"\"", "id": 89104, "time": "2006-05-14T16:09:15Z", "creator": "mslinn@mslinn.com", "creation_time": "2006-05-14T16:09:15Z", "is_private": false}, {"count": 12, "tags": [], "creator": "mslinn@mslinn.com", "attachment_id": null, "id": 89105, "time": "2006-05-14T16:17:16Z", "bug_id": 39577, "creation_time": "2006-05-14T16:17:16Z", "is_private": false, "text": "Discovered the problem, and a workaround.\n\nIn server.xml, I had Host appBase=\"webapps/ROOT\" and Context docBase=\"\".  When I\nchanged the two attributes back to their default values the problem went away.\n(appBase=\"webapps\" and docBase=\"ROOT\")\n\nI used the nonstandard values because in another webapp I have three contexts:\n 1) webapps/ROOT\n 2) webapps/secondContext\n 3) webapps/thirdContext\n\nTomcat 5.5.17 did not like the above, and generated an error message.  I'll post\na separate bug on this issue."}, {"count": 13, "text": "(In reply to comment #12)\n> Tomcat 5.5.17 did not like the above, and generated an error message.  I'll post\n> a separate bug on this issue.\n\nCool, so this bug is invalid since it is caused by the setup that Tomcat doesn't\nlike (most likely the file abstraction doesn't get set up properly, or Tomcat\nignores your docBase since it's inside appBase). Most likely this is not\nsomething that will get fixed.\n\nThanks for not flooding, BTW.\n", "bug_id": 39577, "attachment_id": null, "id": 89106, "time": "2006-05-14T17:25:05Z", "creator": "remm@apache.org", "creation_time": "2006-05-14T17:25:05Z", "tags": [], "is_private": false}]
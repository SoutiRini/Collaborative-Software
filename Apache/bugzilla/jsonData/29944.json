[{"count": 0, "tags": [], "creator": "jah@progress.com", "attachment_id": null, "text": "Apache 2.0.49 (and 2.0.50-dev) util_ldap shared memory cache is not using shared\nmemory for cache entries. This is caused by util_ald_create_cache() function not\ninitializing the cache->rmm_addr at all. I will attach a patch that fixes this\nproblem.\n\nAnother issue is the cache creation logic in util_ald_create_cache().\n\nIf the build doesn't use shared memory (APR_HAS_SHARED_MEMORY is not defined),\nthe cache will be created as long as st->search_cache_size > 0.\n\nIf APR_HAS_SHARED_MEMORY is defined, the cache will only be created if we have\nshared memory allocated (st->cache_rmm is not NULL).\n\nIf st->cache_rmm is NULL, shouldn't the cache be created in process memory (with\ncalloc) instead of not creating it at all ? This behavior would be consistent\nwith documentation.", "id": 60224, "time": "2004-07-07T09:21:25Z", "bug_id": 29944, "creation_time": "2004-07-07T09:21:25Z", "is_private": false}, {"count": 1, "attachment_id": 12044, "bug_id": 29944, "is_private": false, "id": 60225, "time": "2004-07-07T09:23:38Z", "creator": "jah@progress.com", "creation_time": "2004-07-07T09:23:38Z", "tags": [], "text": "Created attachment 12044\nPatch to set cache->rmm_addr correctly"}, {"count": 2, "tags": [], "bug_id": 29944, "attachment_id": 12054, "id": 60236, "time": "2004-07-07T14:02:47Z", "creator": "jah@progress.com", "creation_time": "2004-07-07T14:02:47Z", "is_private": false, "text": "Created attachment 12054\nPatch to fix shared/local cache behavior"}, {"count": 3, "tags": [], "bug_id": 29944, "attachment_id": null, "id": 60239, "time": "2004-07-07T14:11:45Z", "creator": "jah@progress.com", "creation_time": "2004-07-07T14:11:45Z", "is_private": false, "text": "The code in the attached patch (shared/local cache behavior) will create a\nshared memory cache if LDAPSharedCacheFile is set and a local (calloc) cache if\nLDAPSharedCacheFile is not set. The cache can be disabled by setting\nLDAPCacheEntries to 0.\n\nI also changed util_ldap_cache_module_kill() so that it will always run\nutil_ald_destroy_cache() regardless of APR_HAS_SHARED_MEMORY.\n"}, {"count": 4, "tags": [], "creator": "bnicholes@apache.org", "is_private": false, "text": "Are these patches against the 2.0 source tree or the CVS HEAD?  There have been \na lot of changes regarding shared memory caching behavior and locking that have \nnot yet been backported to the 2.0 source tree.  The caching code that is in \nthe 2.0 source tree today will not work simply because of the locking \nmechanism.  That code is still using local reader/writer locks instead of \nglobal mutexes.  This has all been fixed in CVS HEAD and is waiting for \nbackport votes.", "id": 60247, "time": "2004-07-07T15:42:21Z", "bug_id": 29944, "creation_time": "2004-07-07T15:42:21Z", "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 29944, "text": "These patches are against 2.0 tree.\n\nI guess I should take a closer look at what is going on with the development\nversions.", "id": 60248, "time": "2004-07-07T15:49:42Z", "creator": "jah@progress.com", "creation_time": "2004-07-07T15:49:42Z", "tags": [], "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 29944, "text": "I looked at the CVS HEAD util_ldap. Indeed there are lots of changes to the SHM\ncode.\n\nBut if I understand the 2.1 code right, there is no way to create a process\nlocal cache if the module is compiled with APR_HAS_SHARED_MEMORY. I'm just\nwondering if there would be situations (troubleshooting perhaps ?) where someome\nwould want a local cache on a shared memory platform.", "id": 60294, "time": "2004-07-08T11:32:00Z", "creator": "jah@progress.com", "creation_time": "2004-07-08T11:32:00Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "text": "Is it possible to check whether this problem is still present in v2.0.52?\n", "attachment_id": null, "bug_id": 29944, "id": 64525, "time": "2004-10-03T16:13:18Z", "creator": "minfrin@apache.org", "creation_time": "2004-10-03T16:13:18Z", "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 29944, "text": "Is this still a problem, or can I close this bug?\n", "id": 65241, "time": "2004-10-17T18:15:25Z", "creator": "minfrin@apache.org", "creation_time": "2004-10-17T18:15:25Z", "tags": [], "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 29944, "text": "Yes I think the problem is fixed and this bug can be closed.", "id": 65273, "time": "2004-10-18T08:17:02Z", "creator": "jah@progress.com", "creation_time": "2004-10-18T08:17:02Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 31947, "is_private": false, "text": "When building a war file using the War task and the <lib> element, the files\nspecified by the <lib> should be automatically flattened as they are added to\nthe WAR file.\n\nThere is no reason to put a jar under WEB-INF/lib except to have it included in\nthe servlet classpath, but only files exactly inside WEB-INF/lib will be added.\n\nIn my build environment, I'm collecting a number of jar files spread over a few\ndifferent directories; the names of the JARs will be unique, but they are buried\none level deep (a structure based on the maven group id of the JAR).\n\nCurrenlty, I have to copy and flatten the files to a single directory and\ninclude that.  This is somewhat haphazard I think and should be rolled directly\ninto the task.", "id": 65940, "time": "2004-10-28T21:17:51Z", "creator": "hlship@apache.org", "creation_time": "2004-10-28T21:17:51Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "j_a_fernandez@yahoo.com", "attachment_id": null, "is_private": false, "id": 66043, "time": "2004-10-29T09:58:41Z", "bug_id": 31947, "creation_time": "2004-10-29T09:58:41Z", "text": "Can't you use a mapper to flatten things if that is what you want?"}, {"count": 2, "attachment_id": null, "creator": "hlship@apache.org", "text": "Unless I'm missing something (entirely possible), the <mapper> functionality is\npart of the Copy task, not the FileSet type.  The <lib> element of the War task\nis a FileSet.", "id": 66050, "time": "2004-10-29T10:51:11Z", "bug_id": 31947, "creation_time": "2004-10-29T10:51:11Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 31947, "attachment_id": null, "text": "Right, no mapper, and no obvious/intuitive way to include one.  It's been a \nwhile since I've done webapps, WARs and so on, but I can't find any evidence \nthat files stored in subdirectories of WEB-INF/lib would be used for anything.  \nI think this may end up an entry in WHATSNEW under \"Changes that could break \nolder environments:\" i.e. a bug for which our correct response is to break BC \n(highly unlikely in this case but theoretically so).", "id": 66089, "time": "2004-10-29T15:49:00Z", "creator": "mbenson@apache.org", "creation_time": "2004-10-29T15:49:00Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 31947, "attachment_id": null, "text": "<mapper> is a generic concept. If <war/> does not support mappers in the \ndifferent locations it should. I suggest you ask for them to be added.\nBut to request that <war/> be changed to start flattening is unreasonable.\n\nThere is no reason why my libraries cannot beorganized in several directories.\nEven after deployment. Having a mapper will allow user to do whatever they may \nwant. Actually, maybe the functionality should be added to <zipfileset/>\n\nIt will make a lot of sense. And you can always do the same as <lib/> using\na <zipfileset/>.\n\n", "id": 66092, "time": "2004-10-29T15:59:11Z", "creator": "j_a_fernandez@yahoo.com", "creation_time": "2004-10-29T15:59:11Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 31947, "attachment_id": null, "text": "\"but I can't find any evidence that files stored in subdirectories of WEB-\nINF/lib would be used for anything\"\n\nWell, assuming it's expanded on disk and uses a \"normal\" URLClassLoader, yes, \nthey would if any JARs in WEB-INF/lib had a Class-Path manifest entry pointing \nto them. --DD", "id": 66095, "time": "2004-10-29T16:32:09Z", "creator": "ddevienne@lgc.com", "creation_time": "2004-10-29T16:32:09Z", "is_private": false}, {"count": 6, "attachment_id": null, "creator": "hlship@apache.org", "is_private": false, "id": 66096, "time": "2004-10-29T16:40:04Z", "bug_id": 31947, "creation_time": "2004-10-29T16:40:04Z", "tags": [], "text": "I validated with Jetty (4.2.8) that the .jar files must be directly contained in\nWEB-INF/lib.  I strongly doubt other servlet containers are more flexible and I\nwouldn't doubt that the spec indicates that they should be directly contained."}, {"count": 7, "attachment_id": null, "creator": "hlship@apache.org", "text": "Thanks for the pointer; the zipfileset is a good workaround for me that wasn't\nobvious (to me).", "id": 66097, "time": "2004-10-29T16:41:33Z", "bug_id": 31947, "creation_time": "2004-10-29T16:41:33Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 31947, "is_private": false, "text": "Oh I see ... no that's not a workaround. No place to add a <mapper> to a\n<zipfileset> (you were suggesting it).\n\nI'm thiking that, in general, FileSets should support a nested Mapper.  Is this\nfeasible?", "id": 66100, "time": "2004-10-29T16:50:04Z", "creator": "hlship@apache.org", "creation_time": "2004-10-29T16:50:04Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 31947, "attachment_id": null, "text": "I agree with that. It would make my life easier too (for example with <sync> and multiple source filesets with different mappers).", "id": 66102, "time": "2004-10-29T16:58:26Z", "creator": "alexeys@inventigo.com", "creation_time": "2004-10-29T16:58:26Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 31947, "attachment_id": null, "id": 66103, "time": "2004-10-29T17:07:07Z", "creator": "mbenson@apache.org", "creation_time": "2004-10-29T17:07:07Z", "is_private": false, "text": "Actually, on viewing the source you can see that <lib> actually IS a \nZipFileSet; however its prefix attribute is explicitly set in War.  I can \naccept DD's argument here... albeit grudgingly.  ;)  Anyway, it really doesn't \nmake a whole lot of sense add a <mapper> to <fileset>; it might make sense to \nadd a <mapper> to <zipfileset>.  I haven't had enough sleep to think about the \nproper behavior for it right now though.  Also, if anyone can suggest a sane \nbehavior for a <mapper> with regard to a plain <fileset> I'm all ears.\n\nHoward:  I assume your <lib> entry has a dir attribute pointing to some \ndirectory, and you're including either the whole directory or \"**/*.jar\" or \nsomething.  Just checking, you do NOT know the names of the subdirectories \nahead of time or you would just include multiple <lib> entries, correct?\n\n\n"}, {"count": 11, "attachment_id": null, "creator": "j_a_fernandez@yahoo.com", "text": "<mapper>s talk about destinations. Since <filesets> are use for things that \nonly read but do not write, this is not the right place for them.\n\nOn the other hand, <zipfileset>s are always written (into the Zipfile) hence \nit makes much more sense to have a mapper here.\n", "id": 66106, "time": "2004-10-29T17:32:55Z", "bug_id": 31947, "creation_time": "2004-10-29T17:32:55Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "bug_id": 31947, "attachment_id": null, "id": 66107, "time": "2004-10-29T17:35:24Z", "creator": "alexeys@inventigo.com", "creation_time": "2004-10-29T17:35:24Z", "is_private": false, "text": "It is a right place for them - they would create a virtual file system (view)\nwith file in correct places, so <copy>, <sync>, <war> would just copy files\nfrom one file system into another."}, {"count": 13, "tags": [], "creator": "j_a_fernandez@yahoo.com", "attachment_id": null, "is_private": false, "id": 66110, "time": "2004-10-29T17:43:31Z", "bug_id": 31947, "creation_time": "2004-10-29T17:43:31Z", "text": "What do you mean, that the files returned by the <fileset> will say they are \nin one place but they are actually comming from a different place? So when I \nfind an error in some file, the class will write the wrong location because it \nthinks it is in a place where it is not?\n\nSuch thing will break 90% of the tasks that use <fileset>s. Most tasks do \ntheir own mapping given by its own rules (like javac). You cannt just change \nthem any way you want and not expect concequences.\n\nBut I could agreed that we should have a more centralized concept for things \nthat do read/write. Today read is expressed by <fileset> and write by <mapper>.\nMuch more tasks should support these two."}, {"count": 14, "tags": [], "creator": "alexeys@inventigo.com", "attachment_id": null, "text": "You are right. That would mean that some tasks will accept FileSet and some other tasks will accept VirtualFileSet and most ANT internal tasks (<copy>, <sync>, ...) will work just fine with virtual file sets. Plus it would also solve fileset/filelist differences.\n", "id": 66137, "time": "2004-10-29T20:07:57Z", "bug_id": 31947, "creation_time": "2004-10-29T20:07:57Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 31947, "attachment_id": null, "id": 66138, "time": "2004-10-29T20:09:33Z", "creator": "alexeys@inventigo.com", "creation_time": "2004-10-29T20:09:33Z", "is_private": false, "text": "when I start remembering to add newlines....\n\nYou are right. That would mean that some tasks will accept FileSet and some \nother tasks will accept VirtualFileSet and most ANT internal tasks (<copy>, <sync>, ...) \nwill work just fine with virtual file sets. Plus it would also solve \nfileset/filelist differences.\n\n"}, {"count": 16, "tags": [], "bug_id": 31947, "text": "Oh, no!  Not the virtual file debate again!  :)  Believe me, I was always PRO-\nvirtual files long before I became a committer... but I was forced to come to \ngrips with the fact that Ant 1.x internals are just not what they would need to \nbe to make this work.  :(", "id": 66139, "time": "2004-10-29T20:23:12Z", "creator": "mbenson@apache.org", "creation_time": "2004-10-29T20:23:12Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 31947, "attachment_id": null, "text": "Is there ANT 2.0 in plans?", "id": 66140, "time": "2004-10-29T20:28:06Z", "creator": "alexeys@inventigo.com", "creation_time": "2004-10-29T20:28:06Z", "is_private": false}, {"count": 18, "attachment_id": null, "creator": "alexeys@inventigo.com", "text": "This bug just needs flatten=\"true\" attribute for <lib> node.", "id": 66141, "time": "2004-10-29T20:28:57Z", "bug_id": 31947, "creation_time": "2004-10-29T20:28:57Z", "tags": [], "is_private": false}, {"count": 19, "tags": [], "bug_id": 31947, "attachment_id": null, "id": 66146, "time": "2004-10-29T21:00:00Z", "creator": "mbenson@apache.org", "creation_time": "2004-10-29T21:00:00Z", "is_private": false, "text": "Indeed that would solve this issue, but adding a <mapper> to <zipfileset> is \npotentially a more useful solution--i.e. it may prevent some other bugrep down \nthe line.  Remains to be seen whether implementation is practical, however.  :)"}, {"count": 20, "tags": [], "creator": "alexeys@inventigo.com", "attachment_id": null, "text": "It is dangerous, because it will be difficult to associate a mapper to \na particular fileset. There are other filesets there, so unless you put \na mapper within <lib> (a fileset!), it will create a confusion.", "id": 66148, "time": "2004-10-29T21:26:30Z", "bug_id": 31947, "creation_time": "2004-10-29T21:26:30Z", "is_private": false}, {"count": 21, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "is_private": false, "id": 66149, "time": "2004-10-29T21:37:02Z", "bug_id": 31947, "creation_time": "2004-10-29T21:37:02Z", "text": "As stated above, the <lib> IS a <zipfileset>.  So adding the <mapper> to one \nadds it to the other."}, {"count": 22, "tags": [], "creator": "alexeys@inventigo.com", "attachment_id": null, "is_private": false, "id": 74648, "time": "2005-05-10T02:02:36Z", "bug_id": 31947, "creation_time": "2005-05-10T02:02:36Z", "text": "*** Bug 34830 has been marked as a duplicate of this bug. ***"}, {"count": 23, "tags": [], "bug_id": 31947, "attachment_id": null, "id": 103778, "time": "2007-05-29T10:05:01Z", "creator": "herve.boutemy@free.fr", "creation_time": "2007-05-29T10:05:01Z", "is_private": false, "text": "Working on Maven Ant Tasks, flattening a fileset resolved by Maven would be a\ngreat enhancement: see http://jira.codehaus.org/browse/MANTTASKS-39\n\nI looked at o.a.t.a.tasks.War class:\n\npublic void addLib(ZipFileSet fs) {\n        // We just set the prefix for this fileset, and pass it up.\n        fs.setPrefix(\"WEB-INF/lib/\");\n        super.addFileset(fs);\n    }\n\nInstead of\n\n// We just set the prefix for this fileset, and pass it up.\nfs.setPrefix(\"WEB-INF/lib/\");\n\nI think\n\n// We just set the full path for this fileset, and pass it up.\nfs.setFullpath(\"WEB-INF/lib/\");\n\nwould do what we are expecting.\n\nWDYT?"}, {"count": 24, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "text": "we havent been working on this as Ivy works differently...personally I think the\nway to do it would be a new resource collection that includes mapping rules;\nthis could be reused more broadly than an inconsistent patch to one or two tasks..", "id": 104024, "time": "2007-06-04T02:57:31Z", "bug_id": 31947, "creation_time": "2007-06-04T02:57:31Z", "is_private": false}, {"count": 25, "attachment_id": null, "creator": "mlauritse@yahoo.com", "is_private": false, "id": 121306, "time": "2008-10-08T06:29:44Z", "bug_id": 31947, "creation_time": "2008-10-08T06:29:44Z", "tags": [], "text": "I can see that this is marked for \"target milestone 1.8.0\".\n\nWhat exactly is going to be done?\n\nI think adding a \"flatten\" attribute with default value \"false\" will have minimum impact on existing users, while providing an easy way out for those of us who have hierarchies that we don't really want in our \"WEB-INF/lib\"s.\n\nI am not (by far) an ANT code contributor, so I don't know how hard this would be to implement - is the implementation of this feature already planned or would I increase the chances of it happening by diving into the ANT code and providing a fix?\n\nPlease note that not everybody use Ivy with ANT, it would be great to have a \"pure\" ANT solution for this problem.\n"}, {"count": 26, "attachment_id": null, "creator": "bodewig@apache.org", "text": "I can't say why Kev changed the target from unspecified to 1.8.0.\n\nSure it would help if a patch including tests was contributed, otherwise all people waiting for this feature simply have to wait until any committer feels like working on it, which doesn't seem to be too likely given the history of this report.", "id": 121311, "time": "2008-10-08T07:35:20Z", "bug_id": 31947, "creation_time": "2008-10-08T07:35:20Z", "tags": [], "is_private": false}, {"count": 27, "tags": [], "bug_id": 31947, "text": "svn trunk now contains a <mappedresources> collection that does the job.\nFrom the manual\n\n    <war destfile=\"${output}\">\n      <mappedresources>\n        <restrict>\n          <path path=\"${java.class.path}\"/>\n          <type type=\"file\"/>\n        </restrict>\n        <chainedmapper>\n          <flattenmapper/>\n          <globmapper from=\"*\" to=\"WEB-INF/lib/*\"/>\n        </chainedmapper>\n      </mappedresources>\n    </war>\n\nthis flattens all files from CLASSPATH and puts them into WEB-INF/lib\n\n*** This bug has been marked as a duplicate of bug 4240 ***", "id": 122625, "time": "2008-11-19T03:13:14Z", "creator": "bodewig@apache.org", "creation_time": "2008-11-19T03:13:14Z", "is_private": false, "attachment_id": null}]
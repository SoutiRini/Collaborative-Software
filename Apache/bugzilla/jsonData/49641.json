[{"count": 0, "tags": [], "creator": "jessebrand@gmail.com", "attachment_id": null, "id": 138651, "time": "2010-07-23T07:14:28Z", "bug_id": 49641, "creation_time": "2010-07-23T07:14:28Z", "is_private": false, "text": "Hello.\n\nWe encountered some problems after migrating our servers from 6.0.20 to 6.0.28 . When the session on the request is invalidated and a new session is created afterwards, the JSESSIONID cookie is no longer overriden. In 6.0.20 and before, this used to be the case. Since the cookie is no longer set, the session can not be recovered by the next request which in our case, resulted in users being logged out.\n\nExample program to illustrate:\nprotected void doGet(HttpServletRequest request, HttpServletResponse response)\n\t\tthrows ServletException, IOException {\n\tSystem.out.println();\n\tCookie[] cookies = request.getCookies();\n\tif (cookies != null) {\n\t\tfor (Cookie cookie : request.getCookies()) {\n\t\t\tif (cookie.getName().equals(\"JSESSIONID\")) {\n\t\t\t\tSystem.out.println(\"value in cookie: \" + cookie.getValue());\n\t\t\t}\n\t\t}\n\t}\n\tHttpSession session = request.getSession(true);\n\tSystem.out.println(\"old sessionid = \" + session.getId());\n\tsession.invalidate();\n\tsession = request.getSession(true);\n\tSystem.out.println(\"new sessionid = \" + session.getId());\n}\t\n\nWhen calling this servlet twice in succession, in tomcat 6.0.20, something similar to this will be written to the console.\n\nold sessionid = 62AD53E16A9569D5AC4FBF19858C5891\nnew sessionid = 803B5B8E3E02E3AC22C05AD358F223AB\n\nvalue in cookie: 803B5B8E3E02E3AC22C05AD358F223AB\nold sessionid = 803B5B8E3E02E3AC22C05AD358F223AB\nnew sessionid = E05A9C20C24B674B3248D9CC90D1977E\n\nHowever, when calling the same servlet in tomcat 6.0.28, the following is written to the console.\n\nold sessionid = 33DEDE7EF2FC2DC6402F762B990D4181\nnew sessionid = B3B59185E8A4DC77090EFDE0F726936F\n\nvalue in cookie: 33DEDE7EF2FC2DC6402F762B990D4181\nold sessionid = 37844A45333F3F72B08EE35067A03C5A\nnew sessionid = 73C1B799ABF7C24CBCC71F0BA177E24D\n\nAs you can see, upon handling the second request, the cookie still retains the sessionid of the previous session and not that of the newly created session.\n\nWe hope this problem shall be addressed in a future release. We have hacked around this problem by explicitly setting the cookie after the session has been changed, but this should not be a permanent solution as far as we are concerned."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 138652, "time": "2010-07-23T07:19:57Z", "bug_id": 49641, "creation_time": "2010-07-23T07:19:57Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of bug 49598 ***"}]
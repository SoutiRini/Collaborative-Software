[{"attachment_id": 27681, "tags": [], "bug_id": 51944, "is_private": false, "count": 0, "id": 150105, "time": "2011-10-03T23:27:29Z", "creator": "rpi_alum@yahoo.com", "creation_time": "2011-10-03T23:27:29Z", "text": "Created attachment 27681\nPatch of two files\n\nA handful of word97-2003 (though could be even earlier) documents produce an ArrayOutOfBoundsException stemming from the OldPAPBinTable.<init>. These documents may also have additional encodings included from the Hong Kong region. (Unable to include sample due to sensitive nature of documents)\n\nEssentially the parsing of the file thinks there are more elements in the array than are present.  The patch included prevents the error by including a public member call within PAPFormattedDiskPage to return the actual size of the _papxList property.  The initial usage of pfkp.size() within OldPAPBinTable<init> does not seem to always be accurate.\n\nStack Trace (Daily Build)\n----------------------------------------------------------------\nCaused by: java.lang.IndexOutOfBoundsException: Index: 36, Size: 36\n\tat java.util.ArrayList.RangeCheck(ArrayList.java:547)\n\tat java.util.ArrayList.get(ArrayList.java:322)\n\tat org.apache.poi.hwpf.model.PAPFormattedDiskPage.getPAPX(PAPFormattedDiskPage.java:145)\n\tat org.apache.poi.hwpf.model.OldPAPBinTable.<init>(OldPAPBinTable.java:58)\n\tat org.apache.poi.hwpf.HWPFOldDocument.<init>(HWPFOldDocument.java:108)\n\tat org.apache.tika.parser.microsoft.WordExtractor.parseWord6(WordExtractor.java:410)\n\tat org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:69)\n\tat org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:200)\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n\t... 60 more\n\n\nThe supplied patch allows these documents to be extracted, however there do appear to be additional underlying issues at play.  (I've only tested more indepth on 2 of the 12 failed ones).  One document ended up being truncated mid file and had random newline and carriage returns inserted.  The other appeared to have repetition of some paragraphs added and additional newlines added, although all of the documents text was extracted.\n\nDue to this, I'm not sure if you'd want to go forward with the patch.  Though I'd think getting as much text out as possible would be preferable than to no text at all.\n\nThanks in advance,\n\nJeremy"}, {"count": 1, "tags": [], "creator": "rpi_alum@yahoo.com", "is_private": false, "text": "Created attachment 27847\nTest File with Range Issue\n\nAttached is a test file that will demonstrate the issue being seen.  This file actually seems to have its text extracted properly.  I'll try to hex edit out the other longer file that gets truncated.", "id": 150920, "time": "2011-10-25T20:28:46Z", "bug_id": 51944, "creation_time": "2011-10-25T20:28:46Z", "attachment_id": 27847}, {"attachment_id": null, "tags": [], "bug_id": 51944, "is_private": false, "count": 2, "id": 151036, "time": "2011-10-30T00:06:03Z", "creator": "vlsergey@gmail.com", "creation_time": "2011-10-30T00:06:03Z", "text": "Jeremy, thanks for the patch, but this king of bug is already fixed for [new]PAPBinTable, so I just copied the solution from it.\n\nThis bug is fixed both for OldPAPBinTable and OldCHPBinTable.\n\nThanks for the report!"}, {"attachment_id": null, "tags": [], "bug_id": 51944, "text": "Fixed in revision 1195079", "count": 3, "id": 151037, "time": "2011-10-30T00:06:48Z", "creator": "vlsergey@gmail.com", "creation_time": "2011-10-30T00:06:48Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 28963, "text": "I noticed that when mod_usertrack issues a cookie, our servlet engine didn't see\nit until the browser did another hit and sent the cookie back. That actually\nconfuses reporting for us. I've added a call to add a Cookie: header to the\nincoming headers so that other handlers should see a usertrack-issued cookie as\nif the browser had sent it.\n\nThis patch is against 1.3.31.\n\n--- mod_usertrack-old.c\t2004-05-13 12:06:03.000000000 -0700\n+++ mod_usertrack.c\t2004-05-13 12:06:09.000000000 -0700\n@@ -29,7 +29,7 @@\n  * If we don't find one then the user hasn't been to this site since\n  * starting their browser or their browser doesn't support cookies.  So\n  * we generate a unique Cookie for the transaction and send it back to\n- * the browser (via a \"Set-Cookie\" header)\n+ * the browser (via a \"Set-Cookie\" header).\n  * Future requests from the same browser should keep the same Cookie line.\n  *\n  * By matching up all the requests with the same cookie you can\n@@ -239,7 +239,10 @@\n     ap_table_addn(r->headers_out,\n                   (dcfg->style == CT_COOKIE2 ? \"Set-Cookie2\" : \"Set-Cookie\"),\n                   new_cookie);\n-    ap_table_setn(r->notes, \"cookie\", ap_pstrdup(r->pool, cookiebuf));   /* log\nfirst time */\n+    /* let other handlers see the new cookie */\n+    ap_table_setn(r->headers_in, \"Cookie\", new_cookie);\n+   /* log first time */\n+    ap_table_setn(r->notes, \"cookie\", ap_pstrdup(r->pool, cookiebuf));\n     return;\n }", "id": 57380, "time": "2004-05-13T20:15:01Z", "creator": "sabat@eloan.com", "creation_time": "2004-05-13T20:15:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 28963, "attachment_id": null, "text": "wontfix, because:\n\n- that would lie about the header\n- (more important) the set-cookie header value has differs from the cookie\nheader value. (see RFC 2965).\n\nThanks anyway for the suggestion.", "id": 57381, "time": "2004-05-13T20:23:45Z", "creator": "nd@perlig.de", "creation_time": "2004-05-13T20:23:45Z", "is_private": false}]
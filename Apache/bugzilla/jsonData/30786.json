[{"text": "Summary\n=======\nWhen running Tomcat as a service, JSPs cannot be compiled on the fly because \nthe JDK's tools.jar is not found in the classpath.  However, when running the \nsame server from startup.bat, there is no problem.  The cause of the problem \nappears to be that \"service.bat\" does not include a reference to tools.jar (or \nany path under JAVA_HOME) when installing the service. The result is that \nTomcat seems to search the JRE directory for tools.jar, which is therefore not \nfound.  Perhaps service.bat should call setclasspath.bat rather than setting it \nto %CATALINA_HOME%\\bin\\bootstrap.jar as at present?\n\nI did a google search and found that a few people have had this problem but are \nworking around it by copying tools.jar from their JDK bin directory to the JRE \nbin directory, which seems to be a bit of a fudge to me.\n\nDetails\n=======\nToday I downloaded and installed JDK 1.4.2_05 and tomcat 5.0.27.  I checked my \nenv variables and they are OK:\nJAVA_HOME=C:\\j2sdk1.4.2\nCATALINA_HOME=c:\\jakarta-tomcat-5.0.27\n\nI first ran the server from the startup.bat script and all was OK.\n\nI want to run Tomcat as a service, so I stopped the server and ran \"service \ninstall\" at the dos command line in C:\\jakarta-tomcat-5.0.27\\bin, then started \nthe service.  All works OK until I access a JSP that needs to be compiled.  \nThis causes an error \"Unable to find a javac compiler;\ncom.sun.tools.javac.Main is not on the classpath.\nPerhaps JAVA_HOME does not point to the JDK\"\n\nAfter some investigation I found that when starting from startup.bat, the \nCLASSPATH variable is as follows:\nC:\\j2sdk1.4.2\\lib\\tools.jar;c:\\jakarta-tomcat-5.0.27\\bin\\bootstrap.jar\n\nIn other words, the JDK's tools.jar is referenced on the classpath when running \nfrom startup.bat.\n\nHowever when running as a service, the CLASSPATH does not refer to tools.jar. \nThe service.bat script sets it as follows:\nset PR_CLASSPATH=%CATALINA_HOME%\\bin\\bootstrap.jar\n\nTo fix it, I uninstalled the service using \"service remove\", then modified the \nservice.bat script to add %JAVA_HOME%\\lib\\tools.jar to the classpath, restarted \nthe service, and the problem was solved.\n\nPerhaps service.bat should call setclasspath.bat rather than setting it to %\nCATALINA_HOME%\\bin\\bootstrap.jar ?\n\nAn extract of my stdout.log file is included below, this shows the error plus \nthe classpath.  If you would like copies of my config files I have saved them \nand can email them to you, please just email me to ask.  Hope this helps.  \nThanks.\n\n================================================================\n21-Aug-2004 15:38:04 org.apache.jasper.compiler.Compiler generateClass\nSEVERE: Javac exception \nUnable to find a javac compiler;\ncom.sun.tools.javac.Main is not on the classpath.\nPerhaps JAVA_HOME does not point to the JDK\n\tat \norg.apache.tools.ant.taskdefs.compilers.CompilerAdapterFactory.getCompiler\n(CompilerAdapterFactory.java:106)\n\tat org.apache.tools.ant.taskdefs.Javac.compile(Javac.java:935)\n\tat org.apache.tools.ant.taskdefs.Javac.execute(Javac.java:764)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:382)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:472)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:451)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:511)\n\tat org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:295)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:292)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:237)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:157)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:214)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.StandardContextValve.invokeInternal\n(StandardContextValve.java:198)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:152)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:137)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:117)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:102)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:109)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:160)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:799)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:705)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:577)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:683)\n\tat java.lang.Thread.run(Unknown Source)\n21-Aug-2004 15:38:04 org.apache.jasper.compiler.Compiler generateClass\nSEVERE: Env: Compile: javaFileName=/C:/jakarta-tomcat-\n5.0.27/work/Catalina/localhost/aoadmin//org/apache/jsp/jsp\\Test_jsp.java\n    classpath=/C:/jakarta-tomcat-5.0.27/webapps/aoadmin/WEB-\nINF/classes/;C:\\jakarta-tomcat-5.0.27\n\\work\\Catalina\\localhost\\aoadmin;/C:/jakarta-tomcat-5.0.27/webapps/aoadmin/WEB-\nINF/classes/;C:/jakarta-tomcat-5.0.27/shared/classes/;C:/jakarta-tomcat-\n5.0.27/common/classes/;C:/jakarta-tomcat-\n5.0.27/common/endorsed/xercesImpl.jar;C:/jakarta-tomcat-\n5.0.27/common/endorsed/xml-apis.jar;C:/jakarta-tomcat-5.0.27/common/lib/ant-\nlauncher.jar;C:/jakarta-tomcat-5.0.27/common/lib/ant.jar;C:/jakarta-tomcat-\n5.0.27/common/lib/commons-collections-2.1.1.jar;C:/jakarta-tomcat-\n5.0.27/common/lib/commons-dbcp-1.2.1.jar;C:/jakarta-tomcat-\n5.0.27/common/lib/commons-el.jar;C:/jakarta-tomcat-5.0.27/common/lib/commons-\npool-1.2.jar;C:/jakarta-tomcat-5.0.27/common/lib/jasper-compiler.jar;C:/jakarta-\ntomcat-5.0.27/common/lib/jasper-runtime.jar;C:/jakarta-tomcat-\n5.0.27/common/lib/jsp-api.jar;C:/jakarta-tomcat-5.0.27/common/lib/mysql-\nconnector-java-3.0.14-production-bin.jar;C:/jakarta-tomcat-\n5.0.27/common/lib/naming-common.jar;C:/jakarta-tomcat-5.0.27/common/lib/naming-\nfactory.jar;C:/jakarta-tomcat-5.0.27/common/lib/naming-java.jar;C:/jakarta-\ntomcat-5.0.27/common/lib/naming-resources.jar;C:/jakarta-tomcat-\n5.0.27/common/lib/servlet-api.jar;/C:/jakarta-tomcat-\n5.0.27/bin/bootstrap.jar;/C:/Program%\n20Files/Java/j2re1.4.2_05/lib/ext/dnsns.jar;/C:/Program%\n20Files/Java/j2re1.4.2_05/lib/ext/ldapsec.jar;/C:/Program%\n20Files/Java/j2re1.4.2_05/lib/ext/localedata.jar;/C:/Program%\n20Files/Java/j2re1.4.2_05/lib/ext/sunjce_provider.jar\n    cp=c:\\jakarta-tomcat-5.0.27\\bin\\bootstrap.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\webapps\\aoadmin\\WEB-INF\\classes\n    cp=C:\\jakarta-tomcat-5.0.27\\work\\Catalina\\localhost\\aoadmin\n    cp=C:\\jakarta-tomcat-5.0.27\\webapps\\aoadmin\\WEB-INF\\classes\n    cp=C:\\jakarta-tomcat-5.0.27\\shared\\classes\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\classes\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\endorsed\\xercesImpl.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\endorsed\\xml-apis.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\ant-launcher.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\ant.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\commons-collections-2.1.1.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\commons-dbcp-1.2.1.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\commons-el.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\commons-pool-1.2.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\jasper-compiler.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\jasper-runtime.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\jsp-api.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\mysql-connector-java-3.0.14-\nproduction-bin.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\naming-common.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\naming-factory.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\naming-java.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\naming-resources.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\common\\lib\\servlet-api.jar\n    cp=C:\\jakarta-tomcat-5.0.27\\bin\\bootstrap.jar\n    cp=C:\\Program%20Files\\Java\\j2re1.4.2_05\\lib\\ext\\dnsns.jar\n    cp=C:\\Program%20Files\\Java\\j2re1.4.2_05\\lib\\ext\\ldapsec.jar\n    cp=C:\\Program%20Files\\Java\\j2re1.4.2_05\\lib\\ext\\localedata.jar\n    cp=C:\\Program%20Files\\Java\\j2re1.4.2_05\\lib\\ext\\sunjce_provider.jar\n    work dir=C:\\jakarta-tomcat-5.0.27\\work\\Catalina\\localhost\\aoadmin\n    extension dir=C:\\Program Files\\Java\\j2re1.4.2_05\\lib\\ext\n    srcDir=C:\\jakarta-tomcat-5.0.27\\work\\Catalina\\localhost\\aoadmin\n    include=org/apache/jsp/jsp/Test_jsp.java\n\n21-Aug-2004 15:38:04 org.apache.jasper.compiler.Compiler generateClass\nSEVERE: Error compiling file: /C:/jakarta-tomcat-\n5.0.27/work/Catalina/localhost/aoadmin//org/apache/jsp/jsp\\Test_jsp.java     \n[javac] Compiling 1 source file\n================================================================", "tags": [], "bug_id": 30786, "attachment_id": null, "count": 0, "id": 62286, "time": "2004-08-21T15:14:42Z", "creator": "apache-bug-db@web-startup.co.uk", "creation_time": "2004-08-21T15:14:42Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 30786, "text": "Already fixed in the CVS.\nPlease wait for the next TC release.", "id": 62287, "attachment_id": null, "creator": "mturk@apache.org", "creation_time": "2004-08-21T15:21:27Z", "time": "2004-08-21T15:21:27Z", "is_private": false}]
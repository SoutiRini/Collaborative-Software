[{"count": 0, "tags": [], "creator": "albegley@apple.com", "text": "Digest authentication via mod_digest no longer works in 1.3.31, apparently due to ap_auth_nonce() \nreturning different values.\n\nI added a log message to the ap_auth_nonce() function in the standard version of http_core.c from \nApache 1.3.31. (This function was added in 1.3.31). It's short so here's the whole function with the log \nmessage:\n\nAPI_EXPORT(const char *) ap_auth_nonce(request_rec *r)\n{\n    core_dir_config *conf;\n    conf = (core_dir_config *)ap_get_module_config(r->per_dir_config,\n                                                   &core_module);\n    if (conf->ap_auth_nonce)\n       return conf->ap_auth_nonce;\n\n    /* Ideally we'd want to mix in some per-directory style\n     * information; as we are likely to want to detect replay\n     * across those boundaries and some randomness. But that\n     * is harder due to the adhoc nature of .htaccess memory\n     * structures, restarts and forks.\n     *\n     * But then again - you should use AuthDigestRealmSeed in your config\n     * file if you care. So the adhoc value should do.\n     */\n\tchar* nonce = ap_psprintf(r->pool,\"%pp%pp%pp%pp%pp\",\n           (void *)&((r->connection->local_addr).sin_addr ),\n           (void *)ap_user_name,\n           (void *)ap_listeners,\n           (void *)ap_server_argv0,\n           (void *)ap_pid_fname);\n\tap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, r->server,\n             \"nonce = '%s'\", nonce);\n\n\treturn nonce;\n}\n\nThe log message shows that this function returns one value when called to provide the nonce to pass to \nthe client, and a different value when called later to verify that the nonce received from the client was \nthe one sent (check_nonce()). So the check fails, and the client cannot access the realm. The change is \nin the first of the 5 concatenated addresses (the one based on the request record address):\n\n[Sat Aug 28 16:40:53 2004] [info] nonce = '82b834813e608261c0bffffd52803b98'\n\n(User enters name and password at a WebDAV client...)\n\n[Sat Aug 28 16:40:58 2004] [info] nonce = '82e834813e608261c0bffffd52803b98'\n[Sat Aug 28 16:40:58 2004] [error] [client 17.221.41.169] Client is using a nonce which was not issued \nby this server for this context: /\n[Sat Aug 28 16:40:58 2004] [info] nonce = '82e834813e608261c0bffffd52803b98'\n\n(User gets the name and password dialog again...)\n\nThe problem can be worked around by specifying the AuthDigestRealmSeed directive, or by switching \nto mod_auth_digest, but existing configurations are broken by this.", "id": 62658, "time": "2004-08-28T23:56:40Z", "bug_id": 30920, "creation_time": "2004-08-28T23:56:40Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "Thanks for the report.  The fix has been checked in for the next 1.3 release:\n\nhttp://cvs.apache.org/viewcvs.cgi/apache-1.3/src/main/http_core.c?r1=1.337&r2=1.338\n", "bug_id": 30920, "is_private": false, "id": 64397, "time": "2004-09-30T10:27:05Z", "creator": "jorton@redhat.com", "creation_time": "2004-09-30T10:27:05Z", "tags": [], "attachment_id": null}]
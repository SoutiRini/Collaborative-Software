[{"count": 0, "tags": [], "bug_id": 34288, "attachment_id": null, "text": "Threads in Apache 2.0.53 locks up the cpu sometimes. I never saw this in 2.0.52.\nI am using the worker mpm on linux 2.6, Debian Sarge with ssl enabled.\n\nServer status shows the connection as \"closing\".\n\npid strace:\n\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n6794  futex(0xa826de3c, FUTEX_WAIT, 2, NULL) = -1 EAGAIN (Resource temporarily u\nnavailable)\n....\n\nbacktrace of spinning thread:\n\nThread 12 (Thread -1365873744 (LWP 14119)):\n#0  0xffffe410 in __kernel_vsyscall ()\n#1  0xb7caa7db in __lll_mutex_lock_wait ()\n   from /lib/tls/i686/cmov/libpthread.so.0\n#2  0xb7ca7a03 in _L_mutex_lock_26 () from /lib/tls/i686/cmov/libpthread.so.0\n#3  0x00000013 in ?? ()\n#4  0x0000011f in ?? ()\n#5  0xae9669b8 in ?? ()\n#6  0x080e9468 in ?? ()\n#7  0xb7d0e278 in ?? () from /usr/lib/libapr-0.so.0\n#8  0xa8a5c2f8 in ?? ()\n#9  0xae966998 in ?? ()\n#10 0xb7d07a52 in apr_thread_mutex_lock () from /usr/lib/libapr-0.so.0\n#11 0xb7d07a52 in apr_thread_mutex_lock () from /usr/lib/libapr-0.so.0\n#12 0xb7d0ad1a in apr_allocator_set_mutex () from /usr/lib/libapr-0.so.0\n#13 0xb7e4f545 in apr_bucket_free () from /usr/lib/libaprutil-0.so.0\n#14 0xb7e4d999 in apr_bucket_shared_make () from /usr/lib/libaprutil-0.so.0\n#15 0xb7e4e5a8 in apr_brigade_cleanup () from /usr/lib/libaprutil-0.so.0\n#16 0xb7e4e55f in apr_bucket_pipe_create () from /usr/lib/libaprutil-0.so.0\n#17 0xb7d0a42d in apr_pool_cleanup_run () from /usr/lib/libapr-0.so.0\n#18 0xb7d09b6d in apr_pool_destroy () from /usr/lib/libapr-0.so.0\n#19 0xb7d09b28 in apr_pool_clear () from /usr/lib/libapr-0.so.0\n#20 0x08076e47 in ap_graceful_stop_signalled ()\n#21 0xb7d04e56 in apr_threadattr_stacksize_set () from /usr/lib/libapr-0.so.0\n#22 0xb7ca5ca3 in start_thread () from /lib/tls/i686/cmov/libpthread.so.0\n#23 0xb7c449ba in clone () from /lib/tls/i686/cmov/libc.so.6\n\nI am not able to understand this backtrace, is it making any sense to anybody\nelse ? \n\nthanks\namund", "id": 73254, "time": "2005-04-04T15:47:53Z", "creator": "amudev@amuel.net", "creation_time": "2005-04-04T15:47:53Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 34288, "text": "Nope, it looks corrupt unfortunately.  Did you try attaching to the process a\ncouple of times to see if it always comes out like that?  Or stepping a few\ntimes with 's' in gdb to see if it rights itself?", "id": 73282, "time": "2005-04-05T09:15:30Z", "creator": "jorton@redhat.com", "creation_time": "2005-04-05T09:15:30Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 34288, "attachment_id": null, "text": "Got a fresh backtrace today from a debug 2.0.53 build I installed on one\nproduction server last weekend. The other server has been downgraded to 2.0.52.\nIt has not locked up since.\n\nI have tried finish/next/step, and reattatching several times, but it seems\nstuck. Any more clues in this trace?\n\nAny opinions on how I could gather more information, eg would rebuilding with\nAPR_BUCKET_DEBUG be a good idea ? \n\n#0  0xffffe410 in __kernel_vsyscall ()\n#1  0xb7ca27db in __lll_mutex_lock_wait ()\n   from /lib/tls/i686/cmov/libpthread.so.0\n#2  0xb7c9fa03 in _L_mutex_lock_26 () from /lib/tls/i686/cmov/libpthread.so.0\n#3  0x4266217c in ?? ()\n#4  0x080f4468 in ?? ()\n#5  0x00000000 in ?? ()\n#6  0x00000000 in ?? ()\n#7  0xb7d0a998 in __JCR_LIST__ () from /usr/lib/libapr-0.so.0\n#8  0xb215bb04 in ?? ()\n#9  0xb215b968 in ?? ()\n#10 0xb7d0325d in apr_thread_mutex_lock (mutex=0xa90f033c)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/locks/unix/thread_mutex.c:92\n#11 0xb7d0325d in apr_thread_mutex_lock (mutex=0xa90f0338)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/locks/unix/thread_mutex.c:92\n#12 0xb7d06e53 in allocator_free (allocator=0xa90f0350, node=0xa8cdfb00)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/memory/unix/apr_pools.c:313\n#13 0xb7d056a9 in apr_allocator_free (allocator=0xa90f0350, node=0xa8cdfb00)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/memory/unix/apr_pools.c:377\n#14 0xb7e4bcc8 in apr_bucket_free (mem=0xa8cdfb28)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr-util/buckets/apr_buckets_alloc.c:175\n#15 0xb7e49b32 in heap_bucket_destroy (data=0xa8cf8450)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr-util/buckets/apr_buckets_heap.c:36\n#16 0xb7e4a8a7 in apr_brigade_cleanup (data=0xa8840ab8)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr-util/buckets/apr_brigade.c:48\n#17 0xb7e4a849 in brigade_cleanup (data=0xa8840ab8)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr-util/buckets/apr_brigade.c:34\n#18 0xb7d0663f in run_cleanups (cref=0xa883ee60)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/memory/unix/apr_pools.c:1952\n#19 0xb7d05b7c in apr_pool_destroy (pool=0xa883ee50)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/memory/unix/apr_pools.c:731\n#20 0xb7d05aa3 in apr_pool_clear (pool=0x8222698)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/memory/unix/apr_pools.c:691\n#21 0x0807b62d in worker_thread (thd=0x81ce680, dummy=0x821b8a0)\n    at /home/admin/apache2-2.0.53/build-tree/apache2/server/mpm/worker/worker.c:838\n#22 0xb7cffa0c in dummy_worker (opaque=0x81ce680)\n    at\n/home/admin/apache2-2.0.53/build-tree/apache2/srclib/apr/threadproc/unix/thread.c:105\n#23 0xb7c9dca3 in start_thread () from /lib/tls/i686/cmov/libpthread.so.0\n#24 0xb7c3c9ba in clone () from /lib/tls/i686/cmov/libc.so.6\n\n", "id": 73892, "time": "2005-04-21T13:34:41Z", "creator": "amudev@amuel.net", "creation_time": "2005-04-21T13:34:41Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 34288, "attachment_id": null, "text": "> Any opinions on how I could gather more information, eg would rebuilding with\n> APR_BUCKET_DEBUG be a good idea ? \n\nThat would be fairly informative, yes, since it seems relatively likely that\nthis is a double-free scenario involving buckets.  APR_BUCKET_DEBUG would detect\nthis scenario early.\n\nBe aware that APR_BUCKET_DEBUG does add a good deal of overhead, but if you can\nafford to run with it for just long enough to get a backtrace, that would be nice.\n\nThanks,\nCliff", "id": 73911, "time": "2005-04-21T16:53:58Z", "creator": "jwoolley@apache.org", "creation_time": "2005-04-21T16:53:58Z", "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 34288, "is_private": false, "id": 96040, "time": "2006-11-21T09:47:59Z", "creator": "thushw@gmail.com", "creation_time": "2006-11-21T09:47:59Z", "tags": [], "text": "here is what I got back from gdb on the hung apache process:\n\n[New Thread -1208064320 (LWP 4800)]\nLoaded symbols for /lib/tls/libpthread.so.0 Reading symbols from\n/lib/libdl.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libdl.so.2\nReading symbols from /lib/tls/libc.so.6...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libc.so.6\nReading symbols from /lib/ld-linux.so.2...\n(no debugging symbols found)...done.\nLoaded symbols for /lib/ld-linux.so.2\nReading symbols from /lib/libnss_files.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libnss_files.so.2 Reading symbols from\n/lib/libnss_dns.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libnss_dns.so.2\nReading symbols from /usr/local/apache/modules/mod_rewrite.so...(no\ndebugging symbols found)...done.\nLoaded symbols for /usr/local/apache/modules/mod_rewrite.so\nReading symbols from /usr/local/apache/modules/mod_headers.so...(no\ndebugging symbols found)...done.\nLoaded symbols for /usr/local/apache/modules/mod_headers.so\nReading symbols from /usr/local/apache/modules/mod_unique_id.so...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/local/apache/modules/mod_unique_id.so\nReading symbols from /usr/local/apache/modules/mod_adm.so...(no\ndebugging symbols found)...done.\nLoaded symbols for /usr/local/apache/modules/mod_adm.so\n0x00a147a2 in _dl_sysinfo_int80 () from /lib/ld-linux.so.2\n(gdb) bt\n#0  0x00a147a2 in _dl_sysinfo_int80 () from /lib/ld-linux.so.2\n#1  0x00330bfe in __lll_mutex_lock_wait () from /lib/tls/libc.so.6\n#2  0x002c367b in _L_mutex_lock_3220 () from /lib/tls/libc.so.6\n#3  0x00000000 in ?? ()\n"}, {"count": 5, "tags": [], "creator": "nick@webthing.com", "text": "Closing because even if this problem still exists, httpd 2.0 is no longer supported.  If a similar problem happens in 2.2 or later we should try and diagnose it.", "id": 138530, "time": "2010-07-19T20:24:15Z", "bug_id": 34288, "creation_time": "2010-07-19T20:24:15Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "varch03@ca.com", "attachment_id": null, "id": 159701, "time": "2012-06-05T10:19:46Z", "bug_id": 53363, "creation_time": "2012-06-05T10:19:46Z", "is_private": false, "text": "I installed Apache2.4.2 (with APR 1.4.6 & APR-Util 1.4.1) in 32-bit mode on Suse Linux 11 (64-bit) OS. I plugged-in my custom module by adding the below lines to \"httpd.conf\" file.\nLoadModule sm_module \"/opt/CA/webagent/bin/libmod_sm24.so\"\nSmInitFile \"/apache24_32/conf/WebAgent.conf\"\n\nI registered \"SmInitFile\" command as shown below:\n----------------------------------------------------------------------------\nconst command_rec sm_auth_cmds[] =\n{\n\n\tAP_INIT_TAKE1(\"SmInitFile\",\n\t\t\t\t\treinterpret_cast<const char* (*const) ()>(set_webagentconfpath),\n\t\t\t\t\tNULL,\n\t\t\t\t\tRSRC_CONF,\n\t\t\t\t\t\"Full path to WebAgent.conf (e.g. /opt/netegrity/siteminder/conf/WebAgent.conf)\"),\n\tAP_INIT_ITERATE(\"SmAddInputFilter\",\n\t\t\t\t\treinterpret_cast<const char* (*const) ()>(SmAddThirdPartyInputFilter),\n\t\t\t\t\tNULL,\n\t\t\t\t\tRSRC_CONF,\n\t\t\t\t\t\"One or more third party filters to add to the input filter stack before pre-fetch, delimited by a space\"),\n    { NULL }\n};\n\n\nextern \"C\" module AP_MODULE_DECLARE_DATA sm_module =\n{\n    STANDARD20_MODULE_STUFF,\n    create_sm_dir_config,   /* per directory config creator */\n    NULL,                   /* dir config merger */\n    create_sm_server_config,/* per server config creator */\n    NULL,                   /* server config merger */\n    sm_auth_cmds,           /* command table */\n    sm_register_hooks\n};\n-----------------------------------------------------------------------------\n\nIn \"set_webagentconfpath\" method, I am trying to duplicate the config path given in \"httpd.conf\" file (\"/apache24_32/conf/WebAgent.conf\"). The code for \"set_webagentconfpath\" is shown below. This string copy operation is crashing in \"apr_palloc\" method.\n-----------------------------------------------------------------------------\nextern \"C\" const char *set_webagentconfpath(cmd_parms *cmd, void *smdirconf, const char *szConfPath)\n{\n\tif (szConfPath == NULL)\n\t\treturn \"SmInitFile command not found in Apache configuration file.\";\n\n\tsm_server_config_struct *smserverconf = (sm_server_config_struct *) ap_get_module_config(cmd->server->module_config, &sm_module);\n\tsmserverconf->szConfigFile = apr_pstrdup(cmd->pool,szConfPath);\n\n\tg_sConfigPath = szConfPath;\n\n\treturn NULL;\n}\n------------------------------------------------------------------------------\n\nApache 2.2.16 (in both 32-bit & 64-bit) & Apache 2.4.2 (in 64-bit only) is working fine on Suse Linux11 (64-bit) OS with my custom module. Core file and call stack screen shot is attached. Please let me know why this crash came?"}, {"count": 1, "attachment_id": 28889, "bug_id": 53363, "text": "Created attachment 28889\nApache 2.4.2 (32-bit) core dump on Linux (64-bit) OS with custom module", "id": 159702, "time": "2012-06-05T10:22:40Z", "creator": "varch03@ca.com", "creation_time": "2012-06-05T10:22:40Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 53363, "attachment_id": null, "text": "I analyzed the issue and found the below details:\n\nThe \"parms->pool\" (in invoke_cmd method for TAKE1 plug-in) address is not the received by the custom TAKE1 plug-in method.\n\nIn config.c (invoke_cmd method), before calling the TAKE1 plug-in:\n------------------------------------------------------------------------------\nparms->pool: 0x80c40a8\np *(parms->pool): {parent = 0x80c20a0, child = 0x8186998, sibling = 0x0, ref = 0x80e6138, cleanups = 0x8139a40, free_cleanups = 0x0, allocator = 0x80be008,subprocesses = 0x0, abort_fn = 0x8068e40 <abort_on_oom>, user_data = 0x0, tag = 0x80a8b1f \"pconf\", active = 0x8138848, self = 0x80c4090, self_first_avail = 0x80c40e8 \"\\250@\\f\\bh\\003\\023\\b\\350@\\f\\b\", pre_cleanups = 0x0}\n\n------------------------------------------------------------------------------\n  \nIn apr_pstrdup (called from custom TAKE1 plug-in method \"set_webagentconfpath\"):\n\n-------------------------------------------------------------------------------\n(apr_pool_t*) pool: 0x812a178\npool->active: 0x6f6c2f72\n\n*pool: \n  {parent = 0x812a168, child = 0x812a1a0, sibling = 0x81367d0, ref = 0x0, cleanups = 0x0, free_cleanups = 0x0, allocator = 0x8129ad8,\n  subprocesses = 0x43, abort_fn = 0, user_data = 0x0, tag = 0x73752f22 <Address 0x73752f22 out of bounds>, active = 0x6f6c2f72, self = 0x2f6c6163, self_first_avail = 0x63617061 <Address 0x63617061 out of bounds>, pre_cleanups = 0x2f326568}\n------------------------------------------------------------------------------\n\nthe pool address is a different value received by custom plug-in method (in this case from 0x80c40a8 to 0x812a178). \n\nThis issue is occurring only in Apache 2.4 32-bit case. With Apache 2.4 64-bit or Apache 2.2 (both 32-bit & 64-bit), no issues (pool address received by custom plug-in method is same as the one sent from invoke_cmd method). \n\nCould you please tell me any changes required in my custom module for Apache 2.4 32-bit with respect to \"command_rec\"?", "id": 159708, "time": "2012-06-05T12:50:49Z", "creator": "varch03@ca.com", "creation_time": "2012-06-05T12:50:49Z", "is_private": false}, {"count": 3, "tags": [], "creator": "wrowe@apache.org", "text": "I believe you will get more prompt attention by taking this whole line of\nquestioning to the modules-dev@httpd.apache.org peer support group for module\nauthors.  Bugzilla is for reporting defects in the httpd source distribution.\n\nhttp://httpd.apache.org/lists.html#modules-dev\n\nI rather believe you compiled httpd or your module with different optimization\nlevels, which can cause the misalignment of program arguments, as the first\narg is passed by register in certain optimization models.  But again, ask for\nhelp on that list, not here on bugzilla.", "id": 159728, "time": "2012-06-05T23:33:44Z", "bug_id": 53363, "creation_time": "2012-06-05T23:33:44Z", "is_private": false, "attachment_id": null}]
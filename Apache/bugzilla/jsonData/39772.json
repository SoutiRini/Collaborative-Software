[{"count": 0, "tags": [], "bug_id": 39772, "text": "I have a Web application using struts, the page parses a date string, \nintermittently, I am getting following error:\n\njava.lang.Error: RE internal error: Invalid opcode '0'\n\tat org.apache.regexp.RE.internalError(Unknown Source)\n\tat org.apache.regexp.RE.matchNodes(Unknown Source)\n\tat org.apache.regexp.RE.matchNodes(Unknown Source)\n\tat org.apache.regexp.RE.matchAt(Unknown Source)\n\tat org.apache.regexp.RE.match(Unknown Source)\n\tat org.apache.regexp.RE.match(Unknown Source)\n\tat org.apache.regexp.RE.match(Unknown Source)\n\tat com.ew.util.Regex.getDatePattern(Regex.java:95)\n\tat com.ew.util.DateUtil.parse(DateUtil.java:69)\n\tat com.parser.ReportParser.parseReport(ReportParser.java:40)\n\nthe getDatePattern code looks like:\n\npublic static String getDatePattern(String dateStr) throws EWException {\n  \n \tRE regexp = new RE();\n        String datePattern = null;\n \n        try {\n \t   // if no data string, throw exception\n  \t   if (StringUtils.isEmpty(dateStr)) {\n  \t      throw new EWException(new IllegalArgumentException(  \t\n\t\t\t\t    \"The date string is empty\"));\n \t   } else {\n  \t      // if one Date REProgram is null, consider all of them are\n  \t      // yet instatiated.\n  \t       \t\n  \t      if (dateFormatMap.size() == 0) {\n  \t\t dateFormatMap.put(DATE_PATTERN_0, compiler.compile(DATE_0));\n  \t         dateFormatMap.put(DATE_PATTERN_1, compiler.compile(DATE_1));\n  \t         dateFormatMap.put(DATE_PATTERN_2, compiler.compile(DATE_2));\n  \t         dateFormatMap.put(DATE_PATTERN_3, compiler.compile(DATE_3));\n  \t\t dateFormatMap.put(DATE_PATTERN_4, compiler.compile(DATE_4));\n  \t         dateFormatMap.put(DATE_PATTERN_5, compiler.compile(DATE_5));\n  \t         dateFormatMap.put(DATE_PATTERN_6, compiler.compile(DATE_6));\n  \t         dateFormatMap.put(DATE_PATTERN_7, compiler.compile(DATE_7));\n  \t         dateFormatMap.put(DATE_PATTERN_8, compiler.compile(DATE_8));\n  \t         dateFormatMap.put(DATE_PATTERN_9, compiler.compile(DATE_9));\n\t                \n  \t       }\n  \t\n  \t       // find the pattern that matches the date string\n  \t       Iterator keys = dateFormatMap.keySet().iterator();\n  \t       String pattern;\n  \t       while(keys.hasNext()) {\n \t           pattern = (String) keys.next();\n  \t\t   regexp.setProgram((REProgram)dateFormatMap.get(pattern));\n  \t\t   if (regexp.match(dateStr)){\n  \t              datePattern = pattern;\n \t              break;\n \t\t   }                \n \t       }\n\n       ..................\n\nOnce the problem happens, we have to restart the server. Sometimes, we have to \nrestart the server couple of times to remove the error. But the problem is not \nthat easy to reproduce. it happens intermittently in production. We could not \nreproduce it in QA.", "id": 90034, "time": "2006-06-09T22:59:08Z", "creator": "tianyu17@yahoo.com", "creation_time": "2006-06-09T22:59:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 39772, "is_private": false, "text": "Please specify regexp version you've used.", "id": 90250, "time": "2006-06-15T17:33:11Z", "creator": "vgritsenko@apache.org", "creation_time": "2006-06-15T17:33:11Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "ergotrye@myway.com", "text": "The error you're getting is because RE is not Threadsafe. \n\nThis is really a dupe of bug 28412.", "id": 91389, "time": "2006-07-18T14:15:55Z", "bug_id": 39772, "creation_time": "2006-07-18T14:15:55Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 39772, "is_private": false, "id": 91398, "creation_time": "2006-07-18T19:59:00Z", "time": "2006-07-18T19:59:00Z", "creator": "vgritsenko@apache.org", "text": "I think he is not using RE itself from different threads, and REProgram\ninstances are thread safe. Most probably it is duplicate of bug 3877.", "attachment_id": null}]
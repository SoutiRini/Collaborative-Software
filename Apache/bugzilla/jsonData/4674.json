[{"text": "I have resently reported a number of SSI-Servlet bugs. Happily, they have all\nbeen quickly fixed, but unfortunately at the same time at least one new bug has\nsneaked into the code.\n\nThis new bug appears in the latest nighly builds only, and it makes the\nSSI-Servlet to produce invalid character encoding headers. In particular, the\n'Content-Encoding' header SSI-Servlet generates has always the value 'UTF-8'.\nThis is wrong! Instead, the encoding should be taken from server MIME type\nmapping table, defined in Tomcat 'server.xml' configuration file.\n\nHere is the faulty source code, and a proposed fix (thanks to my colleague Mikko\nKurkisuonio for providing it):\n\nin requestHandler() method:\n        // Get the SsiEnvironment instance for this request.\n        ssiEnv = SsiEnvironment.createSsiEnvironment(servletContext,\n                                                      req, res, path);\n        ssiEnv.setIsVirtualWebappRelative(isVirtualWebappRelative);\n\n        res.setContentType(\"text/html;charset=UTF-8\");\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nThe countent type should probably be resolved like with the DefaultServlet:\n\n        // Find content type.\n        String contentType =\n            getServletContext().getMimeType(resourceInfo.path);", "tags": [], "bug_id": 4674, "is_private": false, "count": 0, "id": 7583, "time": "2001-11-06T04:20:31Z", "creator": "rami.hanninen@davisor.com", "creation_time": "2001-11-06T04:20:31Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 4674, "is_private": false, "text": "Fixed. Should be available in the next nightly build.", "id": 7801, "time": "2001-11-12T16:36:56Z", "creator": "amyroh@apache.org", "creation_time": "2001-11-12T16:36:56Z", "attachment_id": null}]
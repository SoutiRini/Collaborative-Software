[{"count": 0, "tags": [], "creator": "edouard.gomez@docubase-systems.fr", "attachment_id": null, "is_private": false, "id": 68039, "time": "2004-12-07T11:40:21Z", "bug_id": 32559, "creation_time": "2004-12-07T11:40:21Z", "text": "Bug report:\n--------------------------------------------------------------------------------\n\nAs described in the example shown in the Servlet 2.3 specs (SRV 10.2.2), the\nServletContextAttributeEvent.attributeRemoved method should be called when\nstopping a webapp.\n\nHowever Tomcat 4.1.31 exhibits bad implementation of the specs, as it doesn't\ncall the attributeRemoved methods when stopping an application. It calls them\nonly when reloading an application.\n\nAfter reading the sources, it's clear that \"reload\" and \"stop\" mismatch on two\npoints:\n- ApplicationContext.clearAttributes call is missing in the\nStandardContext.stop() method whereas it is present in the reload method.\n- The reload method and the stop method mismatch on the order of certain method\ncalls, and i think this can introduce some behavior differences (not observed\nexcept for the missing clearAttributes call).\n\nA brief review of the Tomcat 5.5 CVS sources make me think this bug may still\nexist in the latest dev tree, however as the code changed quite a bit, i'm not\nsure the event call mechanism is still the same. If the event calling mechanism\nis the same, and as \"reload\" is simply a wrapper on top  of \"start\" and \"stop\",\nboth \"reload\" and \"stop\" would miss the clearAttributes call.\n\nI'm sorry but i had no time to confirm the bug on Tomcat 5.5 tree.\n\nHow to trigger the bug:\n--------------------------------------------------------------------------------\n\n- Create a simple webapp, add a ServletContextAttributeEvent object that simply\nlogs the events and declare it in the web.xml file. Add a Servlet loaded on\nstartup that adds a few attributes to the servlet context.\n- Go to the tomcat manager\n 1 - reload the application:\n   the listener attributeRemoved method is called and logs the event\n   then the listener attributeAdded method is called and logs the event\n 2 - stop the application\n   Only the listener attributeAdded method is called and logs the event"}, {"count": 1, "tags": [], "bug_id": 32559, "is_private": false, "text": "Created attachment 13667\nTestcase\n\nA simple webapp exhibiting stop/reload behavior mismatch.", "id": 68040, "time": "2004-12-07T12:19:56Z", "creator": "edouard.gomez@docubase-systems.fr", "creation_time": "2004-12-07T12:19:56Z", "attachment_id": 13667}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 68966, "time": "2004-12-24T17:50:38Z", "bug_id": 32559, "creation_time": "2004-12-24T17:50:38Z", "text": "Fixed in TC4.1.x and TC5.5.x\n\nThanks for the report and especially for the test case."}, {"count": 3, "tags": [], "bug_id": 32559, "is_private": false, "text": "The initial comment quotes portions of the specification which do not exist.\nNever in the spec there's something which says that\n\"ServletContextAttributeEvent.attributeRemoved method should be called when\nstopping a webapp\". As a result, this caused bug 33463.\n\nYou definitely had me fooled, good job :(", "id": 70698, "time": "2005-02-09T13:27:15Z", "creator": "remm@apache.org", "creation_time": "2005-02-09T13:27:15Z", "attachment_id": null}]
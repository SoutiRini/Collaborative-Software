[{"count": 0, "tags": [], "bug_id": 59209, "attachment_id": null, "is_private": false, "id": 189626, "time": "2016-03-22T06:07:19Z", "creator": "huxing.zhang@gmail.com", "creation_time": "2016-03-22T06:07:19Z", "text": "Steps to reproduce:\n1. download tomcat 8.5.0 release candidate.\n2. uncomment the following configuration:\n\n    <!--\n    <Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\"\n               maxThreads=\"150\" SSLEnabled=\"true\" >\n        <UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\" />\n        <SSLHostConfig honorCipherOrder=\"false\" >\n            <Certificate certificateKeyFile=\"conf/localhost-rsa-key.pem\"\n                         certificateFile=\"conf/localhost-rsa-cert.pem\"\n                         certificateChainFile=\"conf/localhost-rsa-chain.pem\"\n                         type=\"RSA\" />\n        </SSLHostConfig>\n    </Connector>\n    -->\n3. adjust the certificate configurations\n4. start tomcat\n\nObserved result:\nThere is NoSuchMethodException appeared in standard output.\n\n22-Mar-2016 13:51:30.539 WARNING [main] org.apache.tomcat.util.IntrospectionUtils.setProperty IntrospectionUtils: InvocationTargetException for class org.apache.tomcat.util.net.SSLHostConfig honorCipherOrder=false)\n java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.tomcat.util.IntrospectionUtils.setProperty(IntrospectionUtils.java:126)\n\tat org.apache.tomcat.util.IntrospectionUtils.setProperty(IntrospectionUtils.java:47)\n\tat org.apache.tomcat.util.digester.SetPropertiesRule.begin(SetPropertiesRule.java:72)\n\tat org.apache.tomcat.util.digester.Digester.startElement(Digester.java:1188)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.startElement(AbstractSAXParser.java:509)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1363)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2786)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:606)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:510)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:848)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:777)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1213)\n\tat com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:648)\n\tat org.apache.tomcat.util.digester.Digester.parse(Digester.java:1461)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:578)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:629)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:311)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:494)\nCaused by: java.lang.UnsupportedOperationException: Java Runtime does not support \"useServerCipherSuitesOrder\". You must use Java 8 or later to use this feature.\n\tat org.apache.tomcat.util.net.SSLHostConfig.setHonorCipherOrder(SSLHostConfig.java:354)\n\t... 27 more\nCaused by: java.lang.NoSuchMethodException: javax.net.ssl.SSLParameters.setUseCipherSuitesOrder(boolean)\n\tat java.lang.Class.getMethod(Class.java:1670)\n\tat org.apache.tomcat.util.net.SSLHostConfig.setHonorCipherOrder(SSLHostConfig.java:352)\n\t... 27 more\n\nSuggested  fix:\n\nin conf/server.xml, remove honorCipherOrder=\"false\" from the default configuration:\n\n    <!--\n    <Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\"\n               maxThreads=\"150\" SSLEnabled=\"true\" >\n        <UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\" />\n        <SSLHostConfig>\n            <Certificate certificateKeyFile=\"conf/localhost-rsa-key.pem\"\n                         certificateFile=\"conf/localhost-rsa-cert.pem\"\n                         certificateChainFile=\"conf/localhost-rsa-chain.pem\"\n                         type=\"RSA\" />\n        </SSLHostConfig>\n    </Connector>\n    -->"}, {"count": 1, "tags": [], "bug_id": 59209, "attachment_id": 33689, "is_private": false, "id": 189630, "time": "2016-03-22T06:49:23Z", "creator": "huxing.zhang@gmail.com", "creation_time": "2016-03-22T06:49:23Z", "text": "Created attachment 33689\nremove honorCipherOrder in SSLConfig configuration"}, {"attachment_id": null, "tags": [], "creator": "violetagg@apache.org", "is_private": false, "count": 2, "id": 189635, "time": "2016-03-22T08:01:16Z", "bug_id": 59209, "creation_time": "2016-03-22T08:01:16Z", "text": "Hi,\n\nThanks for the report and the patch.\nThe fix will be available from 9.0.0.M5 and 8.5.1 onwards.\n\nRegards,\nVioleta"}, {"count": 3, "tags": [], "text": "Hi Violeta,\n\nShould this patch be applied to 9.0.0.x? I main concern is:\nTomcat needs to be configured with honorCipherOrder=\"false\" otherwise Tomcat will prefer a cipher suite that is blacklisted by HTTP/2. [1]\n\n[1] http://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/coyote/http2/Http2UpgradeHandler.html", "is_private": false, "id": 189645, "creator": "huxing.zhang@gmail.com", "time": "2016-03-22T09:33:28Z", "bug_id": 59209, "creation_time": "2016-03-22T09:33:28Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "violetagg@apache.org", "is_private": false, "count": 4, "id": 189646, "time": "2016-03-22T09:39:36Z", "bug_id": 59209, "creation_time": "2016-03-22T09:39:36Z", "text": "(In reply to Huxing Zhang from comment #3)\n> Hi Violeta,\n> \n> Should this patch be applied to 9.0.0.x? I main concern is:\n> Tomcat needs to be configured with honorCipherOrder=\"false\" otherwise Tomcat\n> will prefer a cipher suite that is blacklisted by HTTP/2. [1]\n\nYep you are right I'll revert that in 9.0.0.x\n\nThanks,\nVioleta\n \n> [1]\n> http://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/coyote/http2/\n> Http2UpgradeHandler.html"}, {"count": 5, "tags": [], "text": "(In reply to Huxing Zhang from comment #3)\n> Hi Violeta,\n> \n> Should this patch be applied to 9.0.0.x? I main concern is:\n> Tomcat needs to be configured with honorCipherOrder=\"false\" otherwise Tomcat\n> will prefer a cipher suite that is blacklisted by HTTP/2.\n\nIf that cipher suite has been blacklisted by h2, then why are you specifying it in your cipher suites list, or why are you specifying it early in the list of supported cipher suites?", "is_private": false, "id": 189656, "creator": "chris@christopherschultz.net", "time": "2016-03-22T20:49:47Z", "bug_id": 59209, "creation_time": "2016-03-22T20:49:47Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "huxing.zhang@gmail.com", "is_private": false, "text": "Hi\uff0c\n\nI think specifying cipher suites is another solution, but may be more complicate, because:\n1) we don't know what http version client will use, HTTP/1.x over TLS or HTTP/2 over TLS\n2) different client may support different protocols, e.g.  ECDHE-ECDSA-CHACHA20-POLY1305 is only supported by Chrome\n\nYou have to care about the cipher list, as well as the cipher order.", "id": 189660, "time": "2016-03-23T00:50:19Z", "bug_id": 59209, "creation_time": "2016-03-23T00:50:19Z", "attachment_id": null}]
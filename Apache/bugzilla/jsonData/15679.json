[{"count": 0, "tags": [], "bug_id": 15679, "text": "The configure script is broken if the selected layout begins on the first\nline of config.layout.\n\nTo reproduce:\n\ncd httpd-2.0.43\nmv config.layout config.layout.orig\nsed -n '13,34p' config.layout.orig | tee config.layout\n./configure\n# the result is an exceedingly unobvious error from the APR sub configure\n# script which complains about \"--bindir: NONE/bin\"\nsed -n '12,34p' config.layout.orig | tee config.layout\n./configure\n# works\n\nThis is with GNU Sed 4.0.4 which is relevent because the problem is with the\nsed program that configure uses to parse config.layout.\n\nThe following patch (which i will also attach, if the system lets me) fixes\nthe problem for me.\n\n--- acinclude.m4.orig\t2002-12-27 01:26:56.000000000 -0500\n+++ acinclude.m4\t2002-12-27 01:27:28.000000000 -0500\n@@ -275,7 +275,7 @@\n   fi\n   pldconf=./config.pld\n   changequote({,})\n-  sed -e \"1,/[ \t]*<[lL]ayout[ \t]*$2[ \t]*>[ \t]*/d\" \\\n+  sed -e \"0,/[ \t]*<[lL]ayout[ \t]*$2[ \t]*>[ \t]*/d\" \\\n       -e '/[ \t]*<\\/Layout>[ \t]*/,$d' \\\n       -e \"s/^[ \t]*//g\" \\\n       -e \"s/:[ \t]*/=\\'/g\" \\\n\nI am tempted to indulge in a rant about the wisdom of using configure args\ninstead of weird config files in this situation but this bug report is hardly\nthe place.\n\nI will however indulge in a suggestion. Something like:\nif [ ! -s \"$pldconf\" ];then\n    echo \"*** Error: unable to find layout \\\"$LAYOUT\\\"\"\n    exit 1\nfi\nat the logical place would give a much clearer error message.", "id": 28285, "time": "2002-12-27T07:35:00Z", "creator": "sk@sethwklein.net", "creation_time": "2002-12-27T07:35:00Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "sk@sethwklein.net", "attachment_id": 4274, "id": 28286, "time": "2002-12-27T07:38:19Z", "bug_id": 15679, "creation_time": "2002-12-27T07:38:19Z", "is_private": false, "text": "Created attachment 4274\npatch to acinclude.m4 to fix sed program used to parse config.layout"}, {"count": 2, "tags": [], "bug_id": 15679, "attachment_id": null, "id": 31023, "time": "2003-02-10T17:34:05Z", "creator": "trawick@apache.org", "creation_time": "2003-02-10T17:34:05Z", "is_private": false, "text": "*** Bug 15678 has been marked as a duplicate of this bug. ***"}, {"count": 3, "tags": [], "creator": "jerenkrantz@apache.org", "text": "Adding the 0, causes the leading parts of the files to still be included.  I finally figured out what the  right sed invocation was and committed a fix.\n\nhttpd-2.0: acinclude.m4 r1.136, configure.in r1.244\napr: build/apr_common.m4: 1.52\n\nNote that it is really unlikely that this will be backported to 2.0 though.\n\nThanks for using Apache HTTP Server!", "id": 31390, "time": "2003-02-17T02:39:00Z", "bug_id": 15679, "creation_time": "2003-02-17T02:39:00Z", "is_private": false, "attachment_id": null}]
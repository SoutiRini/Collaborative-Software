[{"count": 0, "tags": [], "bug_id": 8359, "is_private": false, "text": "It seems that Ant or the exec task disregards quotes and apostrophes in \nattributes.\n\nExample:\n<exec executable=\"plink.exe\" dir=\".\" failonerror=\"true\">\n  <arg line=\"-ssh\" />\n  <arg line=\"-pw ${DEPLOY_PASSWD}\" />\n  <arg line=\"${DEPLOY_USER}@${_remote_deploy_host}\" />\n  <arg line=\"find ${DEPLOY_ROOT_UNIX}/* -depth -not \\( \" />\n  <arg line=\"-path */${module_name}/files/nicko/*.xml -or \" />\n  <arg line=\"-path */${module_name}/files/nicko -or \" />\n  <arg line=\"-path */${module_name}/files/lifestyle/*.xml -or \" />\n  <arg line=\"-path */${module_name}/files/lifestyle -or \" />\n  <arg line=\"-path */${module_name}/files/channelv/*.xml -or \" />\n  <arg line=\"-path */${module_name}/files/channelv -or \" />\n  <arg line=\"-path */${module_name}/files -or \" />\n  <arg line=\"-path */${module_name} \" />\n  <arg line=\"\\) \" />\n  <arg line=\"-exec rm -f &quot;{}&quot; &quot;;&quot;\" />\n</exec>\n\nresults in:\n\n[exec] plink.exe -ssh -pw [password_removed] itvbuild@itvapache \nfind /austar_p4/* -depth -not \\( -path */html_interfaces/files/nicko/*.xml -or -\npath */html_interfaces/files/nicko -or -\npath /html_interfaces/files/lifestyle/*.xml -or -path \n*/html_interfaces/files/lifestyle -or -path \n*/html_interfaces/files/channelv/*.xml -or -path \n*/html_interfaces/files/channelv -or -path */html_interfaces/files -or -path \n*/html_interfaces \\) -exec rm -f {} ;\n[exec] find: missing argument to `-exec'\n\nThe exec task should be passed .... -exec rm -r \"{}\" \";\"\n\nThe same problem pops up when &apos; or 's are used in the argument definition, \nagain only ... -exec rm -f {} ; is passed to the command.\n\nThank you,\nJan", "id": 14218, "time": "2002-04-22T04:17:03Z", "creator": "jmoravec@austar.com.au", "creation_time": "2002-04-22T04:17:03Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 8359, "attachment_id": null, "text": "All of the following work for me:\n  <target name=\"echoit\">\n    <exec executable=\"echo\">\n      <arg value='\"This text is \\\"quoted\\\"\"'/>\n    </exec>\n  </target>\n\n  <target name=\"runfind\">\n    <exec executable=\"find\" vmlauncher=\"no\">\n      <arg line='src -type f -exec echo \"{}\" \";\"'/>\n    </exec>\n  </target>\n\n  <target name=\"doawk\">\n    <exec executable=\"sh\">\n      <arg line='-c \"awk &apos;{ print $$1 ; }&apos; build.properties\"'/>\n    </exec>\n  </target>\n\nBut there's a different problem with your approach -- the asterisks.\nI doubt they'll ever do what you want them to (note that I didn't include\na -name \"*.whatever\" in my find), so you're probably going to have to \ncome up with a different way of doing this anyway.", "id": 14391, "time": "2002-04-23T02:34:37Z", "creator": "holtdl@yahoo.com", "creation_time": "2002-04-23T02:34:37Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 8359, "is_private": false, "text": "The find command runs perfectly when run on the actual box and when run \nremotelly using plink. I tried your examples and especially the runfind one, \nbut found that it does not work. It seems that all ', &apos; and \" are stripped \nfrom the string specified in the arg's line attribute. This results in this:\n\n     [exec] Current OS is Windows NT\n     [exec] find . -type f -exec echo {} ;\n     [exec] FIND: Parameter format not correct\n     [exec] Result: 2\n\nAs you can see all apostrophes/quotes disappear. I tried the following targets \nnone of which worked. I am running it on a WinNT box.\n\n  <target name=\"runfind\">\n    <exec executable=\"find\" vmlauncher=\"no\">\n      <arg line='. -type f -exec echo \"{}\" \";\"'/>\n    </exec>\n  </target>\n  \n  <target name=\"runfind2\">\n    <exec executable=\"find\" vmlauncher=\"no\">\n      <arg line=\". -type f -exec echo &apos;{}&apos; &apos;;&apos;\"/>\n    </exec>\n  </target>\n  \n  <target name=\"runfind3\">\n    <exec executable=\"find\" vmlauncher=\"no\">\n      <arg line=\". -type f -exec echo '{}' ';'\"/>\n    </exec>\n  </target>\n\nI modified my original example and used <arg value=...\"/> rather then <arg \nline=\"...\"/> and avoided all white-space in attr values (otherwise the values \nget encolsed in \"s). The result is very ungly, but it eventually works:\n\n<target name=\"plink\">\n    <exec executable=\"plink.exe\" dir=\".\" failonerror=\"true\">\n      <arg value=\"-ssh\" />\n      <arg value=\"-pw\" />\n      <arg value=\"[password deleted]\" />\n      <arg value=\"itvbuild@itvapache\" />\n      <arg value=\"find\" />\n      <arg value=\"/austar_p4/html_interfaces/*\" />\n      <arg value=\"-depth\" />\n      <arg value=\"-not\" />\n      <arg value=\"\\(\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces/files/nicko/*.xml\" />\n      <arg value=\"-or\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces/files/nicko\" />\n      <arg value=\"-or\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces/files/lifestyle/*.xml\" />\n      <arg value=\"-or\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces/files/lifestyle\" />\n      <arg value=\"-or\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces/files/channelv/*.xml\" />\n      <arg value=\"-or\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces/files/channelv\" />\n      <arg value=\"-or\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces/files\" />\n      <arg value=\"-or\" />\n      <arg value=\"-path\" />\n      <arg value=\"*/html_interfaces\" />\n      <arg value=\"\\)\" />\n      <arg value=\"-exec\" />\n      <arg value=\"rm\" />\n      <arg value=\"-rf\" />\n      <arg value=\"'{}'\" />\n      <arg value=\"';'\" />\n    </exec>\n  </target>\n\nPS: you are right about the asterisks, they shoud be escaped.\n\nThanks for your help.\nJan", "id": 14582, "time": "2002-04-24T01:34:50Z", "creator": "jmoravec@austar.com.au", "creation_time": "2002-04-24T01:34:50Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "holtdl@yahoo.com", "attachment_id": null, "id": 14584, "time": "2002-04-24T02:06:55Z", "bug_id": 8359, "creation_time": "2002-04-24T02:06:55Z", "is_private": false, "text": "I'm also running on an NT, with Cygwin -- is that what you have? You said when \nyou run the 'find' directly on the box, it runs okay, so I assume you've got \nsome kind of Unix-type shell, yes? But given the error message you got, it \nlooks like the 'find' that got executed from Ant was the DOS one -- are you \nrunning Ant from a DOS window?\n\nAs for the -verbose output -- don't believe it. Just because you can't see the \nquotes in that output doesn't mean the shell didn't get passed the right thing \n(which it did, since all those examples work for me). So you might want to try \nyour original one again, changing:\n  <arg line=\"-exec rm -f &quot;{}&quot; &quot;;&quot;\"/>\nto\n  <arg line='-exec rm -f \"{}\" \";\"'/>\nand see if it does work for you.\n\nOtherwise, since your workaround is pretty yuck, wouldn't it be better to just \nput it in a script and <exec> that?\n\nBTW: Thanks for mentioning escaping an asterisk -- I hadn't thought of doing \nthat, but I just tried adding -name \"\\*.java\" to my <arg> and it worked. (Cool)"}, {"count": 4, "tags": [], "bug_id": 8359, "attachment_id": null, "text": "What I meant when I said that I the find runs OK locally was that when I run \nthe plink with the find command (it runs the find command on a remote box) it \nworked. So the command was actually only initiated on the local host, but it \nexecuted on the remote host. It was just to check that the find command's \nsyntax was right. Sorry about the confusion. \n\nI also tried to run the find command locally on my WiNT box with the results I \ndescribed in the prev. comment. And you were right, I was running the old DOS \nfind. I have got Cygwin as well, so I tried to run it with good results.\n\nI cannot figure how this is different:\n\n  <target name=\"plink\">\n    <exec executable=\"plink.exe\" dir=\".\" failonerror=\"true\">\n      <arg value=\"-ssh\" />\n      <arg value=\"-pw\" />\n      <arg value=\"password\" />\n      <arg value=\"itvbuild@itvapache\" />\n      <arg value=\"find\" />\n      <arg value=\".\" />\n      <arg value=\"-name\" />\n      <arg value=\"\\*\" />\n      <arg value=\"-exec\" />\n      <arg value=\"echo\" />\n      <arg value=\"'{}'\" />\n      <arg value=\"';'\" />\n    </exec>\n  </target>\n\nWorks OK, see this:\nplink:\n     [exec] Current OS is Windows NT\n     [exec] plink.exe -ssh -pw password itvbuild@itvapache find . -name \\*\n-exec echo \"'{}'\" \"';'\"\n     [exec] ./Desktop\n     [exec] ./Desktop/kontrol-panel\n     <cut>\n     [exec] ./.cedit/cooledit.temp\n\nfrom:\n  \n  <target name=\"plink2\">\n    <exec executable=\"plink.exe\" dir=\".\" failonerror=\"true\">\n      <arg line=\"-ssh -pw password itvbuild@itvapache \"/>\n      <arg line=\"find . -name \\* -exec echo '{}' ';'\" />\n    </exec>\n  </target>\n\nDoes not work, see this:\nplink2:\n     [exec] Current OS is Windows NT\n     [exec] plink.exe -ssh -pw password itvbuild@itvapache find . -name \\*\n-exec echo {} ;\n     [exec] find: missing argument to `-exec'\n\nWhat happens when one uses <arg line=\"\"/>? Is the contents passsed to the \nexecutable as a single parameter, or is it passed as it is with all the spaces? \nThere must be some substiantial difference from <arg value=\"\"/>.\n\nThanks,\nJan", "id": 14589, "time": "2002-04-24T05:27:42Z", "creator": "jmoravec@austar.com.au", "creation_time": "2002-04-24T05:27:42Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 8359, "attachment_id": null, "text": "Does\n\n<arg line=\"find . -name \\* -exec echo &quot;'{}'&quot; &quot;';'&quot;\" />\n\ndo what you want?\n\n<arg line> will be split into several arguments using a home brewed parser, Ant\ndoes not pass a single string as the command line, it uses the String[] exec\nmethod of Runtime.\n\nWhat do you get when using 1.5beta2?", "id": 17599, "time": "2002-06-11T15:15:57Z", "creator": "bodewig@apache.org", "creation_time": "2002-06-11T15:15:57Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 8359, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 5906 ***", "id": 20832, "time": "2002-08-09T08:54:21Z", "creator": "bodewig@apache.org", "creation_time": "2002-08-09T08:54:21Z", "is_private": false}]
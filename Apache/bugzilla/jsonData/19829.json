[{"count": 0, "tags": [], "text": "in some situations ProjectHelperImpl.RootHandler.resolveEntity is being called\nwith ../common/targets.xml instead of file:c:/path/to/project/common/targers.xml\ncausing a No Protocol Error.\n\nsteps to reproduce.\ndown load jwsdp1.1 including the tutorial.\ncopy C:\\jwsdp-1.1\\docs\\tutorial\\examples\\jaxrpc to another directory [in my case\nC:\\Documents and Settings\\USER.DOMAIN\\My Documents\\Projects]\n\ncd into new directory\n>cd hello\n>ant\n\nOUTPUT:\nBuildfile: build.xml\n\nBUILD FAILED\nError reading project file: no protocol: ../common/targets.xml\n\nTotal time: 1 second\n\n>ant -debug\n\nERROR-STREAM\n\n\nBUILD FAILED\nError reading project file: no protocol: ../common/targets.xml\n\tat org.apache.tools.ant.helper.ProjectHelperImpl.parse(ProjectHelperImpl.java:183)\n\tat org.apache.tools.ant.ProjectHelper.configureProject(ProjectHelper.java:117)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:597)\n\tat org.apache.tools.ant.Main.start(Main.java:196)\n\tat org.apache.tools.ant.Main.main(Main.java:235)\nCaused by: java.net.MalformedURLException: no protocol: ../common/targets.xml\n\tat java.net.URL.<init>(URL.java:579)\n\tat java.net.URL.<init>(URL.java:476)\n\tat java.net.URL.<init>(URL.java:425)\n\tat org.apache.xerces.impl.XMLEntityManager.startEntity(XMLEntityManager.java:881)\n\tat org.apache.xerces.impl.XMLEntityManager.startEntity(XMLEntityManager.java:792)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEntityReference(XMLDocumentFragmentScannerImpl.java:1159)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1577)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:346)\n\tat org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:529)\n\tat org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:585)\n\tat org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1142)\n\tat org.apache.tools.ant.helper.ProjectHelperImpl.parse(ProjectHelperImpl.java:155)\n\t... 4 more\n--- Nested Exception ---\njava.net.MalformedURLException: no protocol: ../common/targets.xml\n\tat java.net.URL.<init>(URL.java:579)\n\tat java.net.URL.<init>(URL.java:476)\n\tat java.net.URL.<init>(URL.java:425)\n\tat org.apache.xerces.impl.XMLEntityManager.startEntity(XMLEntityManager.java:881)\n\tat org.apache.xerces.impl.XMLEntityManager.startEntity(XMLEntityManager.java:792)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEntityReference(XMLDocumentFragmentScannerImpl.java:1159)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1577)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:346)\n\tat org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:529)\n\tat org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:585)\n\tat org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1142)\n\tat org.apache.tools.ant.helper.ProjectHelperImpl.parse(ProjectHelperImpl.java:155)\n\tat org.apache.tools.ant.ProjectHelper.configureProject(ProjectHelper.java:117)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:597)\n\tat org.apache.tools.ant.Main.start(Main.java:196)\n\tat org.apache.tools.ant.Main.main(Main.java:235)\n\nTotal time: 1 second\n\nSTANDARD OUT\n...\n...\nresolving systemId: ../common/targets.xml\n\n\n\nwhen run from the install location the same line of the debug out put says\nresolving systemId:\nfile:c:/jwsdp-1.1/docs/tutorial/examples/jaxrpc/common/targets.xml\n\n\nI did what I suspect is a nasty fix\n\npublic InputSource resolveEntity(String publicId,\n                                         String systemId) {\n\n\t   \n\t    helperImpl.project.log(\"resolving systemId: \" + e.getStackTrace(),\nProject.MSG_VERBOSE);\n\t    \n\t    \n\t    if(systemId.startsWith(\"../\")){\n\t        String path = systemId.substring(2);\n\t\tpath = helperImpl.getBuildFileParent().getParent().replace('\\\\', '/') + path;\n\t\tpath = \"file:\" + path;\n\t\thelperImpl.project.log(\"Translating systemId [\"+systemId+\"]-->[\"+path+\"] \",\nProject.MSG_VERBOSE);\n\t\tsystemId = path;\n\t    }\n\t\t    \n\n\t    helperImpl.project.log(\"resolving systemId : \" + systemId ,\nProject.MSG_VERBOSE);", "attachment_id": null, "bug_id": 19829, "id": 37039, "time": "2003-05-11T03:54:13Z", "creator": "dwat001@hotmail.com", "creation_time": "2003-05-11T03:54:13Z", "is_private": false}, {"count": 1, "tags": [], "creator": "dwat001@hotmail.com", "attachment_id": 6313, "is_private": false, "id": 37040, "time": "2003-05-11T03:55:41Z", "bug_id": 19829, "creation_time": "2003-05-11T03:55:41Z", "text": "Created attachment 6313\nThe full changes I made to this file"}, {"count": 2, "tags": [], "bug_id": 19829, "attachment_id": null, "text": "Sorry disorginised the attachment is of\napache-ant-1.5.3-1\\src\\main\\org\\apache\\tools\\ant\\helper\\ProjectHelperImpl.java", "id": 37041, "time": "2003-05-11T03:58:35Z", "creator": "dwat001@hotmail.com", "creation_time": "2003-05-11T03:58:35Z", "is_private": false}, {"attachment_id": 6314, "tags": [], "bug_id": 19829, "is_private": false, "count": 3, "id": 37042, "time": "2003-05-11T04:16:45Z", "creator": "dwat001@hotmail.com", "creation_time": "2003-05-11T04:16:45Z", "text": "Created attachment 6314\napache-ant-1.5.3-1\\src\\main\\org\\apache\\tools\\ant\\helper\\ProjectHelperImpl.java  - not the other one"}, {"count": 4, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 37174, "time": "2003-05-14T12:04:25Z", "bug_id": 19829, "creation_time": "2003-05-14T12:04:25Z", "is_private": false, "text": "Any chance you could explain what those \"some situations\" are?\n\nWhat does you <!ENTITY> look like?  Which XML parser are you using?"}, {"count": 5, "attachment_id": null, "bug_id": 19829, "is_private": false, "id": 37228, "time": "2003-05-14T22:01:28Z", "creator": "dwat001@free.net.nz", "creation_time": "2003-05-14T22:01:28Z", "tags": [], "text": "Iteram Response: I'm not at a computer with ant installed right now I may \nupdate this.\nWarning: I am an Ant newbie so may have somthing triaval wrong.\nThe Entity \n<!DOCTYPE project [\n  <!ENTITY commonTargets SYSTEM \"../common/targets.xml\">\n]>\nI have no idea what XML parser I'm using. I downloaded suns webservice tutorial \nhttp://java.sun.com/webservices/downloads/webservicestutorial.html\n\nand was working with that pretty much unmodified.\nIt was working fine with every thing in the default directorys, then I moved a \nself contained sub tree to a different location \n\n>> copy C:\\jwsdp-1.1\\docs\\tutorial\\examples\\jaxrpc to another directory \n>> [in my case C:\\Documents and Settings\\USER.DOMAIN\\My Documents\\Projects]\n\nI have attached a zip of the subtree. The ant setup I was using was straight \nfrom suns site contained within Java Web Services Developer Pack v1.1 at the \nsame URL as above, so all setup I don't know about is there :)\n\nHope that is enough detail.\n\nDavid"}, {"count": 6, "tags": [], "text": "Created attachment 6360\nA Zip of the code that produced this error.", "is_private": false, "id": 37229, "creator": "dwat001@free.net.nz", "time": "2003-05-14T22:02:44Z", "bug_id": 19829, "creation_time": "2003-05-14T22:02:44Z", "attachment_id": 6360}, {"count": 7, "text": "Cd to where you copied the SUN stuff, in the directory containing the build.xml \nthat's not working. do:\n\ncd ../common\n\nif the command fails, or you don't see a targets.xml there, then your problem \nis simply that you need to copy the common directory as well, such that the \nrelative path to access targets.xml from the build.xml is concerved. --DD", "bug_id": 19829, "is_private": false, "id": 37230, "time": "2003-05-14T22:05:41Z", "creator": "ddevienne@lgc.com", "creation_time": "2003-05-14T22:05:41Z", "tags": [], "attachment_id": null}, {"count": 8, "tags": [], "creator": "dwat001@free.net.nz", "text": "Not that simple error :)\nI move the directory above the code I was trying to buid.\n>cd tutorial/examples\n>cp jaxrpc <new location>\n>cd <new location>/jaxrpc\n>ls\n   common\n   hello\n   ....\n>cd hello\n>Ant\nFail\n\nDavid", "id": 37231, "time": "2003-05-14T22:12:42Z", "bug_id": 19829, "creation_time": "2003-05-14T22:12:42Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "count": 9, "id": 37250, "time": "2003-05-15T12:12:13Z", "bug_id": 19829, "creation_time": "2003-05-15T12:12:13Z", "text": "<!ENTITY commonTargets SYSTEM \"../common/targets.xml\">\n\nis the problem, it should be \n\n<!ENTITY commonTargets SYSTEM \"file:../common/targets.xml\">\n"}, {"count": 10, "tags": [], "bug_id": 19829, "attachment_id": null, "text": "OK, thanks for that I'm sorry for fileing a bug if its my fault.\nWhat made me think it was a bug way the the same file's built in one directory \nand not in another, to expand on the example I gave:\n\n>cd tutorial/examples\n>cd jaxrpc/hello\n>ant\n    success\n>cd ../../\n>cp jaxrpc <new location>\n>cd <new location>/jaxrpc\n>ls\n   common\n   hello\n   ....\n>cd hello\n>Ant\n    fail\nAny way if file ENTITY's should always have the file: identifer thats problem \nsovle.\n\nThanks once more for your time\n\nDavid", "id": 37288, "time": "2003-05-15T21:28:23Z", "creator": "dwat001@free.net.nz", "creation_time": "2003-05-15T21:28:23Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 19829, "attachment_id": null, "is_private": false, "id": 37294, "time": "2003-05-16T06:05:47Z", "creator": "bodewig@apache.org", "creation_time": "2003-05-16T06:05:47Z", "text": "Actually I'm not entirely sure that you must always use the file protocol\nwhen giving relative file URIs - but for Ant' built-in entitiy resolver to work,\nthis is necessary.\n\nEither Crimson or Xerces, can't remember which, require file: as well.\n\nThat it works sometimes and sometimes doesn't means that you are using an XML\nparser which doesn't require the file protocol.  Ant's entity resolver doesn't\nhandle the enitity because the protocol is missing and thus the default resolver\nof the parser gets into the game.  And this default resolver will expand the path\nrelative to your current working directory instead of relative to your build file\n- that's why you see different results depending on the directory you invoke\nAnt from."}]
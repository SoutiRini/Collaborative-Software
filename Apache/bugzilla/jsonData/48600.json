[{"count": 0, "tags": [], "creator": "adrien.futschik@atosorigin.com", "attachment_id": null, "text": "When upgrading from Tomcat 5.5.x to Tomcat 6.0.x we are experiencing performance issues.\n\nWe are using the same exact application in both versions. The application uses JSP & tags.\n\nHere is a quick list of the average loading time recorded (in ms) using Jmeter :\n\nTomcat 5.5.23 : 32\nTomcat 6.0.18 / 6.0.20 : 143\n\nWhen positioning the metadata-complete=\"true\" in the web.xml file the loading are much better :\n\nTomcat 6.0.18 / 6.0.20 : 34\n\nHow would you explain this ?\n\nThe metadata-complete=\"true\" parameter is not a real solution for us because we would like to use annotations in the future.\n\nAdrien", "id": 133837, "time": "2010-01-22T04:59:36Z", "bug_id": 48600, "creation_time": "2010-01-22T04:59:36Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "I can't see anything that would impact per request. You are going to take a hit on the annotation scanning on first load. A profiler will tell you more.\n\nThis is really a topic more suited to the users list. Please follow up there.", "id": 134114, "time": "2010-02-01T16:43:18Z", "bug_id": 48600, "creation_time": "2010-02-01T16:43:18Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 48600, "text": "With Tomcat 6.0.x, when the metadata-complete is set to true, the AnnotationProcessor is empty, and all annotation like @Resources in tag are not managed.\n\nI think the spec never say that.\n\nThe performance issues is due to the presence of AnnotationProcessor with a page with many tags. Because the implementation have not a cache, and manage all the super class (to class Object !), a big loop is present for each attributs, each methods, for each tag classes and super classes, before and after the tag.\n\nWe think it's may be better to add a cache to remember of classes with or without annotations.\n\nPhilippe", "id": 134128, "time": "2010-02-02T02:35:18Z", "creator": "apache@prados.fr", "creation_time": "2010-02-02T02:35:18Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 134132, "time": "2010-02-02T03:18:55Z", "bug_id": 48600, "creation_time": "2010-02-02T03:18:55Z", "tags": [], "text": "Patches are always welcome"}, {"count": 4, "tags": [], "creator": "adrien.futschik@atosorigin.com", "is_private": false, "text": "(In reply to comment #3)\n> Patches are always welcome\n\nWe are working on a patch based on TRUNK to implement a cache and are trying to test out DefaultAnnotationProcessor.java. Our solution improves performance drastically but we need to test it more deeply.\n\nDo you have some unit-tests for this class ?\n\nAdrien", "id": 134147, "time": "2010-02-02T09:01:02Z", "bug_id": 48600, "creation_time": "2010-02-02T09:01:02Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 48600, "attachment_id": null, "id": 134148, "time": "2010-02-02T09:02:28Z", "creator": "markt@apache.org", "creation_time": "2010-02-02T09:02:28Z", "is_private": false, "text": "Very little I am afraid. All we have is in the test dir."}, {"count": 6, "tags": [], "creator": "apache@prados.fr", "attachment_id": 24924, "text": "Created attachment 24924\nPatch to add cache in DefaultAnnotationProcessor\n\nWith some test case, this version is 6 times faster !\n\nJBoss use a DummpAnnotationProcessor to remove this capabilities. I think, now, JBoss can use this new version.\n\nRegards\n\nPhilippe Prados", "id": 134213, "time": "2010-02-04T01:28:14Z", "bug_id": 48600, "creation_time": "2010-02-04T01:28:14Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 48600, "attachment_id": null, "text": "*** Bug 48750 has been marked as a duplicate of this bug. ***", "id": 134560, "time": "2010-02-16T13:00:02Z", "creator": "remm@apache.org", "creation_time": "2010-02-16T13:00:02Z", "is_private": false}, {"count": 8, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "(In reply to comment #6)\n> JBoss use a DummpAnnotationProcessor to remove this capabilities. I think, now,\n> JBoss can use this new version.\n\nWhich version of JBoss AS are you talking about ? If it's branch 4.2, then it doesn't support EE 5, so it's not supposed to be doing injection. That makes things simpler obviously.\n\nJBoss AS (for the releases that do injection) uses an implementation of Tomcat's instance manager (which may or may not perform better, as I didn't micro bench it).", "id": 134562, "time": "2010-02-16T13:44:56Z", "bug_id": 48600, "creation_time": "2010-02-16T13:44:56Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 48600, "text": "With JBoss 5.0.0 GA, the class \norg.apache.catalina.core.StandardContext.DummyAnnotationProcessor\nimplements an empty processor.\nIt's hard coding to use this \"special\" version.\n\nPhilippe Prados", "id": 134566, "time": "2010-02-16T15:44:54Z", "creator": "apache@prados.fr", "creation_time": "2010-02-16T15:44:54Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 48600, "text": "(In reply to comment #9)\n> With JBoss 5.0.0 GA, the class \n> org.apache.catalina.core.StandardContext.DummyAnnotationProcessor\n> implements an empty processor.\n> It's hard coding to use this \"special\" version.\n\nYes, but this \"implementation\" does nothing but delegate to the InstanceManager, which then does the same things as Tomcat's AnnotationProcessor (except slightly slower). For some background history, the AnnotationProcessor interface was replaced with the InstanceManager interface to also take over the object instance creation.\n\nAS 5 scans injections ahead of time, so it does what your caching does more or less. The main problem here is that the newer JSP specs made tags non poolable in many cases, *and* injectable. Not a very good plan ...\n\nBTW, your patch would need some syncs I think.", "id": 134666, "time": "2010-02-18T17:40:37Z", "creator": "remm@apache.org", "creation_time": "2010-02-18T17:40:37Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 48600, "text": "Ok. It's correct with JBoss but no with Tomcat.", "id": 135163, "time": "2010-03-08T11:03:45Z", "creator": "apache@prados.fr", "creation_time": "2010-03-08T11:03:45Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "text": "Do you do something to optimize the code ?", "is_private": false, "id": 136729, "creator": "apache@prados.fr", "time": "2010-05-07T11:11:28Z", "bug_id": 48600, "creation_time": "2010-05-07T11:11:28Z", "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 48600, "text": "Caching has been added in the 7.0.x series but will not be back-ported to 6.0.x.", "id": 159922, "time": "2012-06-12T14:04:24Z", "creator": "markt@apache.org", "creation_time": "2012-06-12T14:04:24Z", "is_private": false, "attachment_id": null}]
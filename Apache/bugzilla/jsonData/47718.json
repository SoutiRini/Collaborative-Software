[{"count": 0, "tags": [], "bug_id": 47718, "text": "On operating systems where /dev/urandom exists, org.apache.catalina.session.ManagerBase will use it as a source of data for getRandomBytes().\n\nIf you stop a context or undeploy a host, the number of file descriptors that have /dev/urandom open tomcat remains constant.\n\nFor example, if you use the manager application to stop or undeploy a context, the number of file descriptors to /dev/urandom is the same as before the stop.\n\nFile descriptor use is determined by using lsof or examining the /proc/<pid>/fd directory on Linux.\n\nThe same issue is seen if you undeploy a virtual host.\n\nIf you undeploy/deploy a context, or remove/add a virtual host, the # of file descriptors to /dev/urandom will increase each time.\n\nThis is because ManagerBase does not close the DataInputStream it holds to /dev/urandom.\n\nThe patch shown below resolves this issue. Stopping a context, or undeploying a virtual host will close the session manager's reference to /dev/urandom.\n\n--- apache-tomcat-5.5.28-src/container/catalina/src/share/org/apache/catalina/session/ManagerBase.java\t2009-07-24 13:35:00.000000000 -0600\n+++ apache-tomcat-5.5.28-gls/container/catalina/src/share/org/apache/catalina/session/ManagerBase.java\t2009-08-20 13:38:03.000000000 -0600\n@@ -688,10 +688,17 @@\n     }\n\n    public void destroy() {\n         if( oname != null )\n             Registry.getRegistry(null, null).unregisterComponent(oname);\n+        if (randomIS!=null) {\n+            try {\n+                randomIS.close();\n+            } catch (IOException ioe) {\n+            }\n+            randomIS=null;\n+        }\n         initialized=false;\n         oname = null;\n         // Don't clear log since it is required in case attributes are changed\n         // (eg via JMX) whilst the manager is stopped.\n     }", "id": 129828, "time": "2009-08-20T14:48:26Z", "creator": "gsexton@mhsoftware.com", "creation_time": "2009-08-20T14:48:26Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47718, "text": "This issue also applies to Tomcat 6.0.20.", "id": 131334, "time": "2009-10-23T11:38:12Z", "creator": "gsexton@mhsoftware.com", "creation_time": "2009-10-23T11:38:12Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Many thanks for the patch. It has been applied to trunk and proposed for 6.0.x and 5.5.x", "id": 132203, "time": "2009-11-22T11:41:38Z", "bug_id": 47718, "creation_time": "2009-11-22T11:41:38Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "markt@apache.org", "text": "The patch has been applied to 6.0.x and will be included in 6.0.21 onwards.", "id": 132867, "time": "2009-12-16T08:40:14Z", "bug_id": 47718, "creation_time": "2009-12-16T08:40:14Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "The patch was applied to 5.5, will be in 5.5.29 onwards. Thank you.", "attachment_id": null, "id": 133918, "creator": "knst.kolinko@gmail.com", "time": "2010-01-25T21:22:59Z", "bug_id": 47718, "creation_time": "2010-01-25T21:22:59Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "bug_id": 44388, "is_private": false, "id": 113598, "time": "2008-02-10T21:16:55Z", "creator": "ivan.pechorin@gmail.com", "creation_time": "2008-02-10T21:16:55Z", "tags": [], "text": "Hi, \n\nWe are facing an issue related to Apache 2.0.63 (32-bit) on AIX 5.3 (64-bit):\nchild process crashes when serving request. We use latest IBM XL C compiler for\nAIX (9.0.0.2)\n\nSteps performed: \n\n1) build zlib and openssl 0.9.8g static libraries (32-bit)\n\n2) configure and build apache 2.0.63 \n\nconfigure flags:\n\nCC=\"xlc_r\"; export CC\n\"./configure\" \\\n\"--with-mpm=worker\" \\\n\"--enable-so\" \\\n\"--enable-layout=Apache\" \\\n\"--prefix=/opt/apache\" \\\n\"--enable-static-support\" \\\n\"--enable-mods-static=most\" \\\n\"--enable-rewrite\" \\\n\"--disable-include\" \\\n\"--disable-proxy\" \\\n\"--disable-cgid\" \\\n\"--disable-cgi\" \\\n\"--disable-userdir\" \\\n\"--disable-imap\" \\\n\"--enable-ssl=static\" \\\n\"--with-ssl=/home/apache/build/openssl-for-apache\" \\\n\"--with-expat=/home/apache/build/httpd-2.0.63/srclib/apr-util/xml/expat\" \\\n\"--enable-deflate\" \\\n\"--with-z=/home/apache/build/zlib-for-apache\" \\\n\"CC=xlc_r\" \\\n\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/opt/apache\"\n -D SUEXEC_BIN=\"/opt/apache/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\nCompiled in modules:\n  core.c\n  mod_access.c\n  mod_auth.c\n  mod_deflate.c\n  mod_log_config.c\n  mod_env.c\n  mod_setenvif.c\n  mod_ssl.c\n  worker.c\n  http_core.c\n  mod_mime.c\n  mod_status.c\n  mod_autoindex.c\n  mod_asis.c\n  mod_negotiation.c\n  mod_dir.c\n  mod_actions.c\n  mod_alias.c\n  mod_rewrite.c\n  mod_so.c\n\nI configured virtual host with SSL requiring client certificate. \n\n\n$ cat error_log\n[Mon Feb 11 08:50:18 2008] [notice] Apache configured -- resuming normal operations\n<< This is where I made an HTTP request >>\n[Mon Feb 11 08:50:34 2008] [notice] child pid 401588 exit signal Segmentation\nfault (11)\n<< Core dump was created here >>\n\n\n$ dbx /opt/apache/bin/httpd core\nType 'help' for help.\n[using memory image in core]\nreading symbolic information ...\n\nSegmentation fault in sig_coredump at line 1055 in file \"\" ($t4)\ncould not read \"mpm_common.c\"\n(dbx) where\nsig_coredump(sig = 11), line 1055 in \"mpm_common.c\"\nsetExcludes__FP11request_recP13WLExcludeNodePCc(0x304b8978, 0x304bb730,\n0x300e9ab8) at 0xd1eb7fec\nupdateConfigParam__FP11request_recP10ConfigInfoPcT3(0x304b8978, 0x301c9dd8,\n0x301c9c34, 0x300e9ab8) at 0xd1eb7c70\ninitConfigInfo__FP11request_recP10ConfigInfo(0x304b8978, 0x301c9dd8) at 0xd1eaeeac\nrequest_handler(0x304b8978) at 0xd1ead790\nap_run_handler(r = 0x304b8978), line 152 in \"config.c\"\nap_invoke_handler(r = 0x304b8978), line 364 in \"config.c\"\nap_process_request(r = 0x304b8978), line 249 in \"http_request.c\"\nap_process_http_connection(c = 0x304aea28), line 253 in \"http_core.c\"\nap_run_process_connection(c = 0x304aea28), line 43 in \"connection.c\"\nap_process_connection(c = 0x304aea28, csd = 0x304ae938), line 176 in \"connection.c\"\nprocess_socket(p = 0x304ae900, sock = 0x304ae938, my_child_num = 0,\nmy_thread_num = 1, bucket_alloc = 0x304b0910), line 522 in \"worker.c\"\nworker_thread(thd = 0x300f1c10, dummy = 0x3014f0e8), line 842 in \"worker.c\"\ndummy_worker(opaque = 0x300f1c10), line 105 in \"thread.c\"\n(dbx)"}, {"count": 1, "tags": [], "text": "Created attachment 21501\nSSL error log (LogLevel=debug)", "is_private": false, "bug_id": 44388, "id": 113599, "time": "2008-02-10T21:19:42Z", "creator": "ivan.pechorin@gmail.com", "creation_time": "2008-02-10T21:19:42Z", "attachment_id": 21501}, {"count": 2, "tags": [], "creator": "ivan.pechorin@gmail.com", "attachment_id": 21502, "id": 113600, "time": "2008-02-10T21:21:00Z", "bug_id": 44388, "creation_time": "2008-02-10T21:21:00Z", "is_private": false, "text": "Created attachment 21502\ncore dump (fullcore enabled)"}, {"count": 3, "tags": [], "creator": "ivan.pechorin@gmail.com", "attachment_id": null, "is_private": false, "id": 113601, "time": "2008-02-10T21:30:14Z", "bug_id": 44388, "creation_time": "2008-02-10T21:30:14Z", "text": "Request is made via SSL with client certificate\nConfiguration for this virtual host:\n\n<IfDefine SSL>\n\nNameVirtualHost 192.168.108.32:443\n<VirtualHost 192.168.108.32:443>\n     ServerAdmin ivan.pechorin@cma.ru\n     DocumentRoot /opt/apache/htdocs\n     ServerName secure.test.apus.az:443\n\n     LogLevel debug\n     ErrorLog logs/ssl_error.log\n     CustomLog /opt/apache/logs/ssl_request.log \\\n          \"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x %{SSL_COMPRESS_METHOD}x \\\"%r\\\" %b\"\n\n     SetOutputFilter DEFLATE\n\n     SSLEngine on\n     SSLProxyEngine on\n\n     SSLCertificateFile /opt/apache/conf/ssl.crt/secure.test.apus.az.crt\n     SSLCertificateKeyFile /opt/apache/conf/ssl.key/secure.test.apus.az.key\n     SSLCACertificateFile /opt/apache/conf/ssl.crt/ca-bundle.crt\n     SSLVerifyClient require\n\n     # Weblogic parameters\n     WebLogicHost apuscft01\n     WebLogicPort 7002\n     SecureProxy ON\n     TrustedCAFile /opt/apache/conf/ssl.crt/ca-bundle.crt\n\n     <Location /iCareConsole>\n         SetHandler weblogic-handler\n         WLLogFile /opt/apache/logs/wl-iCareConsole.log\n         Debug ALL\n         WLExcludePathOrMimeType *.jpg,*.gif,*.css,*.js,*.htm,*.html,*.jar\n     </Location>\n\n     <Location /APUS>\n         SetHandler weblogic-handler\n         WLLogFile /opt/apache/logs/wl-IPW.log\n         Debug ALL\n         WLExcludePathOrMimeType *.jpg,*.gif,*.css,*.js,*.htm,*.html,*.jar\n     </Location>\n\n</VirtualHost>\n\n\nThe HTTP request which causes Apache child crash is for /iCareConsole and should\nbe handled by weblogic-handler (i.e. it is not excluded by directive\nWLExcludePathOrMimeType).\n\nIf I disable second WLExcludePathOrMimeType parameter (in location /APUS ),\nproblem seems to be resolved: child is no longer crashed and requests are\nprocessed normally. However, Weblogic documentation specifies that this\nparameter can be defined locally at the Location tag level as well as globally\n(http://edocs.bea.com/wls/docs81/plugins/plugin_params.html#1158077)"}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "id": 113608, "time": "2008-02-11T03:24:29Z", "bug_id": 44388, "creation_time": "2008-02-11T03:24:29Z", "is_private": false, "text": "The crash is inside a third-party module, presumably WebLogic, please report it\nto the vendor.\n\nsetExcludes__FP11request_recP13WLExcludeNodePCc(0x304b8978, 0x304bb730,\n0x300e9ab8) at 0xd1eb7fec\nupdateConfigParam__FP11request_recP10ConfigInfoPcT3(0x304b8978, 0x301c9dd8,\n0x301c9c34, 0x300e9ab8) at 0xd1eb7c70\ninitConfigInfo__FP11request_recP10ConfigInfo(0x304b8978, 0x301c9dd8) at 0xd1eaeeac\nrequest_handler(0x304b8978) at 0xd1ead790\n"}, {"count": 5, "tags": [], "text": "Thanks for clarification.", "is_private": false, "bug_id": 44388, "id": 113614, "time": "2008-02-11T04:29:06Z", "creator": "ivan.pechorin@gmail.com", "creation_time": "2008-02-11T04:29:06Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 36044, "attachment_id": null, "is_private": false, "id": 78169, "time": "2005-08-05T17:10:11Z", "creator": "sean.mullan@oracle.com", "creation_time": "2005-08-05T17:10:11Z", "text": "If your Signature dereferences an element with no children and then passes it\nto an XPath transform that results in an empty node-set, an \nArrayIndexOutOfBoundsException will be thrown by \norg.apache.xml.security.c14n.implementations.CanonicalizerBase.canonicalizeXPathNodeSet\n\n     [java] Exception in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: -1\n     [java]     at java.util.ArrayList.remove(ArrayList.java:393)\n     [java]     at\norg.apache.xml.security.c14n.implementations.NameSpaceSymbTable.pop(Unknown Source)\n     [java]     at\norg.apache.xml.security.c14n.implementations.CanonicalizerBase.canonicalizeXPathNodeSet(Unknown\nSource)\n     [java]     at\norg.apache.xml.security.c14n.implementations.CanonicalizerBase.engineCanonicalizeXPathNodeSetInternal(Unknown\nSource)\n     [java]     at\norg.apache.xml.security.c14n.implementations.CanonicalizerBase.engineCanonicalize(Unknown\nSource)\n     [java]     at\norg.apache.xml.security.signature.XMLSignatureInput.updateOutputStream(Unknown\nSource)\n     [java]     at\norg.apache.xml.security.signature.Reference.calculateDigest(Unknown Source)\n     [java]     at\norg.apache.xml.security.signature.Reference.generateDigestValue(Unknown Source)\n     [java]     at\norg.apache.xml.security.signature.Manifest.generateDigestValues(Unknown Source)\n     [java]     at org.apache.xml.security.signature.XMLSignature.sign(Unknown\nSource)\n     [java]     at\norg.apache.xml.security.samples.signature.CreateMerlinsExampleTwentyThree.main(Unknown\nSource)\n     [java] Java Result: 1\n\nI have slightly modified the CreateMerlinsExampleTwentyThree sample program to\nreproduce the problem. I will attach it.\n\nI have a fix but I would like Raul to check it before I commit it:\n\n$ diff -c CanonicalizerBase.java CanonicalizerBase.java.fixed\n*** CanonicalizerBase.java      Fri Aug  5 10:56:37 2005\n--- CanonicalizerBase.java.fixed        Thu Aug  4 16:25:36 2005\n***************\n*** 482,488 ****\n                                } else {\n                                        ns.pop();\n                                }\n!                       sibling= currentNode.getNextSibling();\n                        } else {\n                                parentNode=currentElement;\n                        }\n--- 482,490 ----\n                                } else {\n                                        ns.pop();\n                                }\n!                               if (parentNode != null) {\n!                                       sibling= currentNode.getNextSibling();\n!                               }\n                        } else {\n                                parentNode=currentElement;\n                        }"}, {"count": 1, "tags": [], "bug_id": 36044, "attachment_id": 15904, "id": 78172, "time": "2005-08-05T17:14:11Z", "creator": "sean.mullan@oracle.com", "creation_time": "2005-08-05T17:14:11Z", "is_private": false, "text": "Created attachment 15904\nTest program \n\nThis is exactly the same as the original sample except I have commented out\nline\n178:\n\n//\t   object1.appendChild(doc.createTextNode(\"I am the text.\"));"}, {"count": 2, "tags": [], "text": "Closing old bugs.", "is_private": false, "id": 91982, "creator": "raul-info@r-bg.com", "time": "2006-08-06T18:07:49Z", "bug_id": 36044, "creation_time": "2006-08-06T18:07:49Z", "attachment_id": null}]
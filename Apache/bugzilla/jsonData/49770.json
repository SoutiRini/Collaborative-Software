[{"count": 0, "tags": [], "bug_id": 49770, "attachment_id": null, "text": "After a graceful restart of our RHEL 5.5's Apache 2.2 (httpd-2.2.3-43.el5.x86_64), all four of our webservers complained that:\n\n[Tue Aug 17 08:48:54 2010] [notice] Graceful restart requested, doing restart\n[Tue Aug 17 09:28:41 2010] [error] (111)Connection refused: proxy: AJP: attempt to connect to 128.227.74.27:8000 (sakaiapp-prod06.osg.ufl.edu) failed\n[Tue Aug 17 09:28:41 2010] [error] ap_proxy_connect_backend disabling worker for (sakaiapp-prod06.osg.ufl.edu)\n[Tue Aug 17 09:28:41 2010] [error] proxy: AJP: failed to make connection to backend: sakaiapp-prod06.osg.ufl.edu\n[Tue Aug 17 09:28:41 2010] [error] proxy: BALANCER: (balancer://elearning2.courses.ufl.edu). All workers are in error state for route (sakaiapp-prod05.osg.ufl.edu)\n[Tue Aug 17 09:32:00 2010] [error] (111)Connection refused: proxy: AJP: attempt to connect to 128.227.74.13:8000 (sakaiapp-prod04.osg.ufl.edu) failed\n[Tue Aug 17 09:32:00 2010] [error] ap_proxy_connect_backend disabling worker for (sakaiapp-prod04.osg.ufl.edu)\n[Tue Aug 17 09:32:00 2010] [error] proxy: AJP: failed to make connection to backend: sakaiapp-prod04.osg.ufl.edu\n[Tue Aug 17 09:32:00 2010] [error] proxy: BALANCER: (balancer://elearning2.courses.ufl.edu). All workers are in error state for route (sakaiapp-prod03.osg.ufl.edu)\n\n\nIn the Tomcat 5.5.30 logs, we saw hundreds of:\n2010-08-17 09:00:34.601 [ERROR] org.apache.coyote.ajp.AjpMessage:239 - Cannot append null value\njava.lang.NullPointerException\n        at org.apache.coyote.ajp.AjpMessage.appendString(AjpMessage.java:239)\n        at org.apache.coyote.ajp.AjpMessage.appendBytes(AjpMessage.java:175)\n        at org.apache.coyote.ajp.AjpAprProcessor.prepareResponse(AjpAprProcessor.java:1005)\n        at org.apache.coyote.ajp.AjpAprProcessor.action(AjpAprProcessor.java:510)\n        at org.apache.coyote.Response.action(Response.java:183)\n        at org.apache.coyote.Response.sendHeaders(Response.java:379)\n        at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:313)\n        at org.apache.catalina.connector.OutputBuffer.close(OutputBuffer.java:280)\n        at org.apache.catalina.connector.Response.finishResponse(Response.java:484)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:177)\n        at org.apache.coyote.ajp.AjpAprProcessor.process(AjpAprProcessor.java:444)\n        at org.apache.coyote.ajp.AjpAprProtocol$AjpConnectionHandler.process(AjpAprProtocol.java:472)\n        at org.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1293)\n        at java.lang.Thread.run(Thread.java:619)\n\nAll I can figure is that this a bug in the AJP connector on the Tomcat side, though doing a 'real' (i.e. not graceful) restart of Apache httpd fixed the issue.", "id": 139177, "time": "2010-08-17T18:59:09Z", "creator": "martin@mbs3.org", "creation_time": "2010-08-17T18:59:09Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 139185, "time": "2010-08-18T04:16:06Z", "bug_id": 49770, "creation_time": "2010-08-18T04:16:06Z", "is_private": false, "text": "Bugzilla is not a support forum. Please use the users mailing list.\n\nTo subscribe, send mail to\n\nusers-subscribe@tomcat.apache.org\n\nIf the discussion there reveals, that there is a real bug, you can reopen this\nissue."}, {"count": 2, "tags": [], "creator": "martin@mbs3.org", "attachment_id": null, "id": 139186, "time": "2010-08-18T04:25:40Z", "bug_id": 49770, "creation_time": "2010-08-18T04:25:40Z", "is_private": false, "text": "I'll go to the support forum, but I can't imagine what non-bug would cause the AJP connector to throw null pointer errors. It should at least be trying not to use null objects, and filling in a useful error message before throwing an NPE. :/"}, {"count": 3, "tags": [], "bug_id": 49770, "attachment_id": null, "is_private": false, "id": 139202, "time": "2010-08-18T10:46:58Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-08-18T10:46:58Z", "text": "If you would look at the following lines:\n> AjpMessage.appendString(AjpMessage.java:239)\n> AjpAprProcessor.prepareResponse(AjpAprProcessor.java:1005)\n\nyou will see that that is where AjpAprProcessor sends HTTP response headers. Some of those headers have value of null, which is illegal. You cannot pass null to response.addHeader() or setHeader() methods.\n\nBy the way, AjpMessage.appendString() recovers from this gracefully, by writing out an empty string instead of the null, but logs the error that you are seeing."}, {"attachment_id": null, "tags": [], "bug_id": 49770, "text": "Thank you for the clarification. I appreciate it.", "count": 4, "id": 139203, "time": "2010-08-18T10:50:13Z", "creator": "martin@mbs3.org", "creation_time": "2010-08-18T10:50:13Z", "is_private": false}]
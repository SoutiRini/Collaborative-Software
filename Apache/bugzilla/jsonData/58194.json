[{"count": 0, "tags": [], "bug_id": 58194, "attachment_id": 32947, "text": "Created attachment 32947\ndump file\n\nHi,\n\n\nRecently, we encountered Tomcat crash on EXCEPTION_ACCESS_VIOLATION in tcnative-1.dll. I attached error log. \n\n# Problematic frame:\n# C  [tcnative-1.dll+0x11982]\n...\nStack: [0x0000000028400000,0x0000000028500000],  sp=0x00000000284fed50,  free space=1019k\nNative frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)\nC  [tcnative-1.dll+0x11982]\nC  [tcnative-1.dll+0x11e7]\nC  0x0000000004ad4e0a\n\nJava frames: (J=compiled Java code, j=interpreted, Vv=VM code)\nJ 18420  org.apache.tomcat.jni.Address.get(IJ)J (0 bytes) @ 0x0000000004ad4d84 [0x0000000004ad4d40+0x44]\n\n\nAccording to the stack it looks that the native implementation of Address.get() does not check if sock is null before passing it to apr_socket_addr_get, which will end up dereferencing the null pointer inside apr_socket_addr_get leading to a crash.\n\nTCN_IMPLEMENT_CALL(jlong, Address, get)(TCN_STDARGS, jint which,\n                                        jlong sock)\n{\n    tcn_socket_t *s = J2P(sock, tcn_socket_t *);\n    apr_sockaddr_t *sa = NULL;\n\n    UNREFERENCED(o);\n    TCN_THROW_IF_ERR(apr_socket_addr_get(&sa,\n                        (apr_interface_e)which, s->sock), sa);\ncleanup:\n    return P2J(sa);\n}\n\nI don't know how the issue can be reproduced.", "id": 184238, "time": "2015-07-30T16:59:19Z", "creator": "olga.vingurt@gmail.com", "creation_time": "2015-07-30T16:59:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 58194, "attachment_id": null, "text": "A client recently experienced what could be the same problem (version 1.1.24 of  tc-native-1.dll running on Windows Server 2008 R2 Standard). \n\n# Problematic frame:\n# C  [tcnative-1.dll+0x11532]  Java_org_apache_tomcat_jni_OS_info+0x742\n...\nStack: [0x0000000013e10000,0x0000000013f10000],  sp=0x0000000013f0e870,  free space=1018k\nNative frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)\nC  [tcnative-1.dll+0x11532]  Java_org_apache_tomcat_jni_OS_info+0x742\n\nJava frames: (J=compiled Java code, j=interpreted, Vv=VM code)\nJ  org.apache.tomcat.jni.Address.get(IJ)J", "id": 184920, "time": "2015-09-02T23:56:22Z", "creator": "paul@tourplan.com", "creation_time": "2015-09-02T23:56:22Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 58194, "attachment_id": null, "text": "Also experiencing this issue with 8.0.28 / 1.1.33\n\nWe also see these exceptions in the logs:\n\n27-Oct-2015 14:08:15.611 WARNING [http-apr-8081-Poller] org.apache.tomcat.util.net.AprEndpoint$Poller.run Unexpected poller error\n java.lang.NullPointerException\n\tat org.apache.tomcat.util.net.AprEndpoint$AprSocketWrapper.access$400(AprEndpoint.java:2522)\n\tat org.apache.tomcat.util.net.AprEndpoint$Poller.run(AprEndpoint.java:1837)\n\tat java.lang.Thread.run(Unknown Source)\n\nSometimes we get heap dumps in the tcnative_1!Java_org_apache_tomcat_jni_Poll_poll+235 (same as bug 57140 ), but these could be unrelated issues.\n\nIs there any more info we could provide that would help with this?", "id": 186013, "time": "2015-10-27T13:55:31Z", "creator": "b.coughlan2@gmail.com", "creation_time": "2015-10-27T13:55:31Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 58194, "attachment_id": 34252, "text": "Created attachment 34252\ndump file\n\nOnly happened once but the application is working fine in Tomcat 8.5.4", "id": 193734, "time": "2016-09-14T23:05:47Z", "creator": "equintanilla@bnext.mx", "creation_time": "2016-09-14T23:05:47Z", "is_private": false}, {"count": 4, "tags": [], "creator": "hsehdar@gmail.com", "text": "We have encountered this issue in one of the production environment.Below is the excerpt \n\n    2016-12-29 16:37:29 Commons Daemon procrun stdout initialized\n    #\n    # A fatal error has been detected by the Java Runtime Environment:\n    #\n    #  EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x0000000180007e75, pid=2928, tid=4560\n    #\n    # JRE version: Java(TM) SE Runtime Environment (8.0_60-b27) (build 1.8.0_60-b27)\n    # Java VM: Java HotSpot(TM) 64-Bit Server VM (25.60-b23 mixed mode windows-amd64 compressed oops)\n    # Problematic frame:\n    # C  [tcnative-1.dll+0x7e75]\n    #\n    # Core dump written. Default location: C:\\Program Files\\foo\\bar\\hs_err_pid2928.mdmp\n    #\n    # An error report file with more information is saved as:\n    # C:\\Program Files\\foo\\bar\\hs_err_pid2928.log\n    #\n    # If you would like to submit a bug report, please visit:\n    #   http://bugreport.java.com/bugreport/crash.jsp\n    # The crash happened outside the Java Virtual Machine in native code.\n    # See problematic frame for where to report the bug.\n    #", "id": 197611, "time": "2017-03-13T01:24:32Z", "bug_id": 58194, "creation_time": "2017-03-13T01:24:32Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "hsehdar@gmail.com", "text": "Any update regarding this issue assignment or fix version?", "id": 197696, "time": "2017-03-16T01:40:49Z", "bug_id": 58194, "creation_time": "2017-03-16T01:40:49Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 200440, "time": "2017-08-24T13:51:03Z", "bug_id": 58194, "creation_time": "2017-08-24T13:51:03Z", "is_private": false, "text": "Generally, what we need to investigate issues such as these are:\n- update to the latest Tomcat Native (1.2.x) and Tomcat releases (7.0.x, 8.5.x or 9.0.x)\n- attach the dump file\n- steps to reproduce\n\nIf you can't provide steps to reproduce then as much information as what type of requests (Comet, async, WebSocket http/https, ajp) see the error and when the error occurs (shutdown, after long running, static content, dynamic content) might help us track it down."}]
[{"count": 0, "tags": [], "text": "apache refuses to startup when configured with ldap and gives a segmentation fault.\n\nTo reproduce (I am on a Gentoo Linux 1.4.14, kernel 2.4.24-ck1, gcc-3.3.3,\nglibc-2.3.3_pre20040420-r0 configuration):\n\n./configure --prefix=/www --enable-ssl --enable-proxy \\\n    --enable-mods-shared=all \\\n    --with-ldap --enable-auth-ldap=shared --enable-ldap=shared\nmake\n./httpd -t\n\ngives me a segmentation fault.\n\nIf I take out the ldap related configs, apache works as normal.\n\nThere is a bug report in the Gentoo bugzilla as well:\nhttp://bugs.gentoo.org/show_bug.cgi?id=39667", "attachment_id": null, "id": 57722, "creator": "corporate_gadfly@hotmail.com", "time": "2004-05-20T17:00:16Z", "bug_id": 29128, "creation_time": "2004-05-20T17:00:16Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 29128, "attachment_id": null, "id": 57723, "time": "2004-05-20T17:22:49Z", "creator": "chip@force-elite.com", "creation_time": "2004-05-20T17:22:49Z", "is_private": false, "text": "If you disable the ldap cache, does it work? (just comment out the directives\nstarting with  LDAPSharedCache and LDAPCache)\n\nAlso, can you please provide the configuration directives you are using related\nto LDAP?  It is hard to know exactly what is happening without the config. \n\nFinally, can you try to get a GDB backtrace as explained on\nhttp://httpd.apache.org/dev/debugging.html\n\nThanks, \n\n-Paul Querna"}, {"count": 2, "tags": [], "bug_id": 29128, "attachment_id": null, "id": 57793, "time": "2004-05-21T13:07:17Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2004-05-21T13:07:17Z", "is_private": false, "text": "Hi Paul,\n\nThanks for responding.\n\nThe configuration and compilation scenario that I described in comment 0 is from\na totally virgin httpd compile\n\ne.g.,\ntar xzvf /usr/portage/distfiles/httpd-2.0.49.tar.gz\ncd httpd-2.0.49\n./configure --prefix=/www --enable-ssl --enable-proxy \\\n    --enable-mods-shared=all \\\n    --with-ldap --enable-auth-ldap=shared --enable-ldap=shared\nmake\n\nFollowing gives gives Segmentation fault:\n.libs/httpd -f ./docs/conf/httpd-std.conf -t\n\nThe following give the expected results:\n.libs/httpd -f ./docs/conf/httpd-std.conf -v\nServer version: Apache/2.0.49\nServer built:   May 20 2004 12:50:03\n\nand:\n.libs/httpd -f ./docs/conf/httpd-std.conf -l\nCompiled in modules:\n  core.c\n  prefork.c\n  http_core.c\n  mod_so.c\n\nIf I replace the configure line with:\n./configure --prefix=/www --enable-ssl --enable-proxy \\\n    --enable-mods-shared=all\nand then do a make, then all 3 following commands give the desired output.\n\n.libs/httpd -f ./docs/conf/httpd-std.conf -l\nCompiled in modules:\n  core.c\n  prefork.c\n  http_core.c\n  mod_so.c\n\n.libs/httpd -f ./docs/conf/httpd-std.conf -v\nServer version: Apache/2.0.49\nServer built:   May 21 2004 09:03:21\n\n.libs/httpd -f ./docs/conf/httpd-std.conf -t\nhttpd: could not open document config file /www/docs/conf/httpd-std.conf\n(notice, how its not a segmentation fault)\n\nI am working on getting the gdb backtrace. In the meantime, hopefully you will\nbe able to reproduce what I described. Hope this was helpful."}, {"attachment_id": null, "tags": [], "creator": "minfrin@sharp.fm", "is_private": false, "count": 3, "id": 57849, "time": "2004-05-21T17:41:53Z", "bug_id": 29128, "creation_time": "2004-05-21T17:41:53Z", "text": "Currently I am struggling to get v2.0.49 built under Redhat Enterprise 3\n(grumble ssl problems grumble...). Would it be possible to post a stacktrace of\nthis problem?\n\nIf you run httpd with the -X option it won't try and fork (although with -t I\ndon't think it tries to fork anyway).\n"}, {"count": 4, "tags": [], "bug_id": 29128, "attachment_id": null, "id": 57855, "time": "2004-05-21T18:37:06Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-21T18:37:06Z", "is_private": false, "text": "I cannot seem to replicate this at all - if I run the -t on the config file you\nwere trying, I get errors about ServerRoot not being configured correctly, as a\nmake install needs to be done first before this will work.\n"}, {"count": 5, "tags": [], "bug_id": 29128, "attachment_id": null, "is_private": false, "id": 57857, "time": "2004-05-21T18:39:02Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2004-05-21T18:39:02Z", "text": "Okay, then I will focus on getting the backtrace.\n\nThe instructions on http://httpd.apache.org/dev/debugging.html are a little\ngeneric. Can you give me some specifics on what do I need to do EXACTLY to get\nthe stacktrace?\n\nThanks,"}, {"attachment_id": null, "tags": [], "creator": "minfrin@sharp.fm", "text": "This is what I get with v2.0.49 on RHEL3:\n\n[minfrin@gatekeeper www]$ ./bin/httpd -f ./conf/httpd-std.conf -t\nSyntax OK\n\nCan you try organise a backtrace of this, and if you're still getting the\nsegfault, please reopen this bug.\n", "count": 6, "id": 57858, "time": "2004-05-21T18:42:18Z", "bug_id": 29128, "creation_time": "2004-05-21T18:42:18Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 29128, "attachment_id": null, "text": "Hi Graham,\n\nI hope I got the backtrace information right. In a clean directory, I did the\nfollowing:\n\n./configure --prefix=/www \\\n     --with-ldap \\\n     --enable-auth-ldap=shared \\\n     --enable-ldap=shared \\\n     --enable-maintainer-mode\nmake\ngdb .libs/httpd\n\nGNU gdb 6.1\nCopyright 2004 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i686-pc-linux-gnu\"...Using host libthread_db library\n\"/lib/libthread_db.so.1\".\n\n(gdb) run -t\nStarting program: /home/haroon/src/build/httpd-2.0.49/.libs/httpd -t\nwarning: Unable to find dynamic linker breakpoint function.\nGDB will be unable to debug shared library initializers\nand track explicitly loaded dynamic code.\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x4043ab1c in memcpy () from /lib/libc.so.6\n(gdb) backtrace\n#0  0x4043ab1c in memcpy () from /lib/libc.so.6\n#1  0x402fbc0e in call_resolver (sa=0x80c0754, hostname=0x0, family=135240080, \n    port=0, flags=0, p=0x80bd8b8) at sockaddr.c:396\n#2  0x08084a7d in init_server_config (process=0x80f9990, p=0x80bd8b8)\n    at config.c:1829\n#3  0x08084afe in ap_read_config (process=0x80f9990, ptemp=0x80f79a0, \n    filename=0x80ab273 \"conf/httpd.conf\", conftree=0x80b4a74) at config.c:1850\n#4  0x0808717a in main (argc=2, argv=0xbfffe9a4) at main.c:531\n(gdb) list\n531         server_conf = ap_read_config(process, ptemp, confname, &ap_conftree);\n532         if (ap_run_pre_config(pconf, plog, ptemp) != OK) {\n533             ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR, 0,\n534                          NULL, \"Pre-configuration failed\\n\");\n535             destroy_and_exit_process(process, 1);\n536         }\n537     \n538         ap_process_config_tree(server_conf, ap_conftree, process->pconf, ptemp);\n539         ap_fixup_virtual_hosts(pconf, server_conf);\n540         ap_fini_vhost_config(pconf, server_conf);\n(gdb) The program is running.  Exit anyway? (y or n) y\n\nDoes this qualify as a valid backtrace?", "id": 59337, "time": "2004-06-16T18:01:49Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2004-06-16T18:01:49Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "count": 8, "id": 61674, "time": "2004-08-08T22:58:49Z", "bug_id": 29128, "creation_time": "2004-08-08T22:58:49Z", "text": "*** Bug 29572 has been marked as a duplicate of this bug. ***"}, {"count": 9, "tags": [], "creator": "jorton@redhat.com", "text": "#1  0x402fbc0e in call_resolver (sa=0x80c0754, hostname=0x0, family=135240080, \n    port=0, flags=0, p=0x80bd8b8) at sockaddr.c:396\n\nthis is pretty weird, as is the fact that this crash in memcpy only been\nreported by two Gentoo users.  family is passed as AF_INET, which will always\nand forever be 2, this could be stack corruption of some kind.\n\nIs either APR or httpd patched in any way?  Can anyone reproduce this if\nbuilding 2.0.50 from vanilla sources?\n\n", "id": 61675, "time": "2004-08-08T23:02:04Z", "bug_id": 29128, "creation_time": "2004-08-08T23:02:04Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 29128, "attachment_id": null, "text": "Sorry I see this posting has a repro case from vanilla sources, disregard that\nrequest.", "id": 61677, "time": "2004-08-08T23:04:44Z", "creator": "jorton@redhat.com", "creation_time": "2004-08-08T23:04:44Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 29128, "attachment_id": null, "id": 62365, "time": "2004-08-23T21:29:31Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2004-08-23T21:29:31Z", "is_private": false, "text": "Please consider this bug as resolved/invalid. I'm pretty sure I know the cause\nof the problem (discovered while diagnosing a problem with openldap and bind).\nAt the time of reporting the following 2 conditions were true on my Gentoo machine:\n\n1) net-dns/bind was installed\n2) /usr/lib/libbind.* files were present\n\nNow that I have re-installed bind (the libbind files are no longer there - the\ngentoo maintainers must have done something to disable libbind) apache runs\nwithout any problems.\n\nSigh... sorry for the bother but it was a legitimate problem (it was just hard\nto try and figure out why the problem was occurring in the first place)."}, {"count": 12, "tags": [], "bug_id": 29128, "attachment_id": null, "text": "I can confirm your solution. Thanks. :)\n\nAlthough I'd like to note that the actual problem seems to be that OpenLDAP is \nusing libbind in favor of libresolv. So even after re-installing Bind without \nlibbind, one has to re-install OpenLDAP as well, since it is OpenLDAP having \nthe dependency on libbind, not Apache itself. Furthermore, the presence of \nlibbind is not a problem as long as one makes sure OpenLDAP is not being \ncompiled against libbind, but instead against libresolv (patching of the \nconfiguration script for example).\n\nI found this (old) OpenLDAP issue, which might be related: \nhttp://www.openldap.org/its/?findid=1304\n", "id": 62392, "time": "2004-08-24T12:04:38Z", "creator": "bugs.apache@starbase12.cjb.net", "creation_time": "2004-08-24T12:04:38Z", "is_private": false}]
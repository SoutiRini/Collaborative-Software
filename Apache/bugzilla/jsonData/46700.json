[{"count": 0, "attachment_id": 23249, "bug_id": 46700, "is_private": false, "id": 124790, "time": "2009-02-11T22:06:03Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-02-11T22:06:03Z", "tags": [], "text": "Created attachment 23249\nexcel file for test\n\nI use POI to open the attached \"test.xlsx\", call XSSFRow.shift(...) to shift 1 row. But if failed and throw FormulaParseException, it may be caused by the named ranged specified in the formula.\n\nSample Code:\n--\n\nWorkbook wb = new XSSFWorkbook(\"test.xlsx\");\nSheet sheet = wb.getSheet(\"Test\");\nsheet.shiftRows(4, sheet.getLastRowNum(), 1, true, true);\nwb.write(new FileOutputStream(\"output.xlsx\"));\n\n\nException Details:\n--\norg.apache.poi.ss.formula.FormulaParser$FormulaParseException: Specified named range 'HSI' does not exist in the current workbook.\n\tat org.apache.poi.ss.formula.FormulaParser.parseNameOrCellRef(FormulaParser.java:440)\n\tat org.apache.poi.ss.formula.FormulaParser.parseRangeExpression(FormulaParser.java:336)\n\tat org.apache.poi.ss.formula.FormulaParser.parseFunctionReferenceOrName(FormulaParser.java:332)\n\tat org.apache.poi.ss.formula.FormulaParser.parseSimpleFactor(FormulaParser.java:733)\n\tat org.apache.poi.ss.formula.FormulaParser.percentFactor(FormulaParser.java:693)\n\tat org.apache.poi.ss.formula.FormulaParser.powerFactor(FormulaParser.java:680)\n\tat org.apache.poi.ss.formula.FormulaParser.Term(FormulaParser.java:982)\n\tat org.apache.poi.ss.formula.FormulaParser.additiveExpression(FormulaParser.java:1083)\n\tat org.apache.poi.ss.formula.FormulaParser.concatExpression(FormulaParser.java:1067)\n\tat org.apache.poi.ss.formula.FormulaParser.comparisonExpression(FormulaParser.java:1024)\n\tat org.apache.poi.ss.formula.FormulaParser.Arguments(FormulaParser.java:665)\n\tat org.apache.poi.ss.formula.FormulaParser.function(FormulaParser.java:562)\n\tat org.apache.poi.ss.formula.FormulaParser.parseFunctionReferenceOrName(FormulaParser.java:324)\n\tat org.apache.poi.ss.formula.FormulaParser.parseSimpleFactor(FormulaParser.java:733)\n\tat org.apache.poi.ss.formula.FormulaParser.percentFactor(FormulaParser.java:693)\n\tat org.apache.poi.ss.formula.FormulaParser.powerFactor(FormulaParser.java:680)\n\tat org.apache.poi.ss.formula.FormulaParser.Term(FormulaParser.java:982)\n\tat org.apache.poi.ss.formula.FormulaParser.additiveExpression(FormulaParser.java:1083)\n\tat org.apache.poi.ss.formula.FormulaParser.concatExpression(FormulaParser.java:1067)\n\tat org.apache.poi.ss.formula.FormulaParser.comparisonExpression(FormulaParser.java:1024)\n\tat org.apache.poi.ss.formula.FormulaParser.unionExpression(FormulaParser.java:1003)\n\tat org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:1125)\n\tat org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:192)\n\tat org.apache.poi.xssf.usermodel.XSSFRow.shiftFormula(XSSFRow.java:454)\n\tat org.apache.poi.xssf.usermodel.XSSFRow.shift(XSSFRow.java:426)\n\tat org.apache.poi.xssf.usermodel.XSSFSheet.shiftRows(XSSFSheet.java:1457)\n\tat com.dttn.excel.connector.TestPOI.main(TestPOI.java:98)"}, {"count": 1, "tags": [], "bug_id": 46700, "attachment_id": null, "is_private": false, "id": 125175, "time": "2009-02-26T00:21:11Z", "creator": "yegor@dinom.ru", "creation_time": "2009-02-26T00:21:11Z", "text": "shiftRows fails because of an unknown name UOM. This undefined name is used in formulas in the cells H2 and H3, and also in the data validation rule for J3.\n\nThe formula in H2 that can't be parsed looks as follows:\nIF(ISERROR(VLOOKUP(\"\",UOM,2,FALSE)),\"\",VLOOKUP(\"\",UOM,2,FALSE))\n\nShifting a formula in XSSF includes the following operations:\n - parse formula into an array of tokens (Ptgs)\n - update column and row references of the parsed tokens according to the shifting rule\n - serialize the updated Ptgs into string\n - update the formula value in the cell\n\nTo parse a formula all its parts must be defined. If FormulaParser fails to resolve a token it throws FormulaParseException as in your case. \n\nPlease note, that FormulaParser has been recently updated to handle names with backslashes. With this change the exception message is different from reported. Current code in trunk throws org.apache.poi.ss.formula.FormulaParser$FormulaParseException: Specified named range 'UOM' does not exist in the current workbook.\n\nYegor"}]
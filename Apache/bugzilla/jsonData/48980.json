[{"count": 0, "tags": [], "bug_id": 48980, "attachment_id": null, "text": "complete-ant-cmd.pl is a helper script which allows BASH and KSH users to complete ant targets using shell completion facility.\n\nIt works by calling ant -p to get list of possible targets, and caching the result. The cached result is stored in working directory, in file \".ant-targets-XXX.xml\" (XXX stands for the build file name)\n\nUnfortunately, if ant -p fails (e.g. with OOM exception), empty completion list is cached for the directory.\n\nOnce this happens, the completion stops working.\n\n\nSteps to reproduce (bash):\n\n1. Associate complete-ant-cmd.pl with the bash completion facility:\n\n     complete -C $ANT_HOME/bin/complete-ant-cmd.pl ant\n \n2. create build file build.xml, containing the following input:\n\n   <project name=\"test\">\n      <target name=\"test\"/>\n   </project>\n\n2. verify that ant completion works \n   type ant and hit TAB (assuming TAB is the completion key)\n   \n   Expected result: the command line should be completed to \n   \n   $ ant test\n\n3. Delete file ./.ant-targets-build.xml\n \n4. Simulate exception in ant. One way to do so would be setting ANT_HOME to wrong location: \n   export ANT_HOME=/tmp\n\n5. type ant and hit TAB \n   Expected result: ant Exception in thread \"main\" \n   java.lang.NoClassDefFoundError: org/apache/tools/ant/launch/Launcher\n\n   Expected result - 0 sized file called ./.ant-targets-build.xml will be created.\n\n6. restore ANT_HOME to original value \n\n7. type ant and hit TAB \n\nCompletion will not work.", "id": 135600, "time": "2010-03-24T20:37:16Z", "creator": "omer.shapira@gmail.com", "creation_time": "2010-03-24T20:37:16Z", "is_private": false}, {"count": 1, "tags": [], "creator": "omer.shapira@gmail.com", "attachment_id": 25179, "id": 135601, "time": "2010-03-24T20:45:07Z", "bug_id": 48980, "creation_time": "2010-03-24T20:45:07Z", "is_private": false, "text": "Created attachment 25179\nProposed patch to the bug\n\nThe proposed patch checks if the cache file exists, but is empty. \n\nIn this case, the completion script proceeds to regenerating the cache file."}, {"count": 2, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 135621, "time": "2010-03-25T14:02:59Z", "bug_id": 48980, "creation_time": "2010-03-25T14:02:59Z", "is_private": false, "text": "Omar, please don't assign the bug to yourself or the Ant developers won't see any changes."}, {"count": 3, "tags": [], "bug_id": 48980, "text": "I'm sorry I misspelled your name, will look into your patch shortly.", "id": 135622, "time": "2010-03-25T14:04:18Z", "creator": "bodewig@apache.org", "creation_time": "2010-03-25T14:04:18Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 48980, "attachment_id": null, "text": "patch is in svn revision 927416\n\nThanks!", "id": 135623, "time": "2010-03-25T14:15:06Z", "creator": "bodewig@apache.org", "creation_time": "2010-03-25T14:15:06Z", "is_private": false}]
[{"attachment_id": null, "tags": [], "bug_id": 42263, "is_private": false, "count": 0, "id": 102466, "time": "2007-04-26T07:01:03Z", "creator": "stephan.classen@adnovum.ch", "creation_time": "2007-04-26T07:01:03Z", "text": "when calling subant without inheritall=\"true\" ant.version is not set.\n\nexample\n\ntop level build file:\n<target name=\"test1\">\n   <echo message=\"${ant.project.name}\" />\n   <echo message=\"${ant.version}\" />\n   <subant target=\"test\" buildpathref=\"subpath\" />\n</target>\n\nand in the build file specified by the path \"subpath\":\n<target name=\"test1\">\n   <echo message=\"${ant.project.name}\" />\n   <echo message=\"${ant.version}\" />\n</target>\n\n\n\nThe output of \"ant test\" is:\n\ntest project\nApache Ant version 1.7.0 compiled on December 13 2006\ntest project subcomponent\n${ant.version}"}, {"attachment_id": null, "tags": [], "bug_id": 42263, "is_private": false, "count": 1, "id": 103164, "time": "2007-05-14T06:03:11Z", "creator": "stevel@apache.org", "creation_time": "2007-05-14T06:03:11Z", "text": "I am seeing this too. \n\n\n===================================================================\n= SSH 2.4.1, (C) Copyright 1998-2007 Hewlett-Packard Development Company, LP\n(${ant.version})"}, {"count": 2, "tags": [], "bug_id": 42263, "text": "as you can see, we dont get ant.version passed down in subant, more importanly\nwe dont get any other ant built in props handed down.\n]\nWhat#s happening is that the Ant init code creates a new project and calls \nsetJavaVersionProperty(), whereas it maybe ought to be doing something like\ninitProperties():\n\n\n    public void initProperties() throws BuildException {\n        setJavaVersionProperty();\n        setSystemProperties();\n        setPropertyInternal(MagicNames.ANT_VERSION, Main.getAntVersion());\n        setAntLib();\n    }\n\n\nAs it is, there's probably a fair bit of the initial state of a subant project\nthat isnt being set up right.\n\nWhat to do?\n(a) stay broken and hope nobody notices\n(b) fix and hope nothing breaks.\n\nif (b), what do we pass down? Everything from initProperties()?", "id": 103171, "time": "2007-05-14T07:24:46Z", "creator": "stevel@apache.org", "creation_time": "2007-05-14T07:24:46Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 42263, "text": "(In reply to comment #2)\n> as you can see, we dont get ant.version passed down in subant, more importanly\n> we dont get any other ant built in props handed down.\n> ]\n> What#s happening is that the Ant init code creates a new project and calls \n> setJavaVersionProperty(), whereas it maybe ought to be doing something like\n> initProperties():\n> \n> \n>     public void initProperties() throws BuildException {\n>         setJavaVersionProperty();\n>         setSystemProperties();\n>         setPropertyInternal(MagicNames.ANT_VERSION, Main.getAntVersion());\n>         setAntLib();\n>     }\n> \n> \n> As it is, there's probably a fair bit of the initial state of a subant project\n> that isnt being set up right.\n> \n> What to do?\n> (a) stay broken and hope nobody notices\n> (b) fix and hope nothing breaks.\n> \n> if (b), what do we pass down? Everything from initProperties()?\n\nYep, probably so.  Looks like the right thing to do is replace newProject.setJavaVersionProperty() with \nnewProject.init() in Ant.init() IMO.", "id": 103173, "time": "2007-05-14T07:37:22Z", "creator": "mbenson@apache.org", "creation_time": "2007-05-14T07:37:22Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 42263, "text": "It does look like a bug all right.\nThe code in Ant.java calls  newProject.setSystemProperties();\nbut does not call setJavaVersion() or \n setPropertyInternal(MagicNames.ANT_VERSION, Main.getAntVersion())\n\nThe one thing I would be concerened about from Project#initProperties()\nis setAntLib() which from some reason calls Locator.getClassSource()\nwhich does some File IO and antlib.getAbsolutePath() which\ndoes more FileIO.\n\nMaybe the solution would be to make ant.version and the java version\nproperties to be user properties, these always get copied\nto sub-projects.\n", "id": 103184, "time": "2007-05-14T08:30:44Z", "creator": "peterreilly@apache.org", "creation_time": "2007-05-14T08:30:44Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 42263, "text": "Just note that at least ant.version worked fine in 1.6.5, so it's probably 1.7.0\nregression.", "id": 103271, "time": "2007-05-16T13:07:07Z", "creator": "caster@gentoo.org", "creation_time": "2007-05-16T13:07:07Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 42263, "is_private": false, "count": 6, "id": 103290, "time": "2007-05-17T00:58:53Z", "creator": "peterreilly@apache.org", "creation_time": "2007-05-17T00:58:53Z", "text": "Yep,\nyou are correct, the problem does not happen with ant 1.6.5.\n"}, {"count": 7, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "text": "ant.version was a user property\nthis change seems to have made it a normal version\nhttp://svn.apache.org/viewvc?view=rev&revision=388848", "id": 103291, "time": "2007-05-17T01:28:58Z", "bug_id": 42263, "creation_time": "2007-05-17T01:28:58Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 42263, "is_private": false, "count": 8, "id": 103294, "time": "2007-05-17T03:15:14Z", "creator": "stevel@apache.org", "creation_time": "2007-05-17T03:15:14Z", "text": "that's good, I can change it without fear of lots of things breaking.\n\nWhich properties were passed down in ant1.6.5?"}, {"count": 9, "tags": [], "creator": "peterreilly@apache.org", "text": "Doing a quick grep in the ant 1.6.5 codebase I see the following\nuses of project.setUserProperty.\n\nMain.java:    \"ant.version\", \"ant.file\"\n\nProjectHelper2.java \"ant.file\"\n\nProject.java: \"ant.project.name\"\n\nVAJBuildInfo.java: \"ant.file\"\n\nAnt.java: \"ant.file\"\n", "id": 103297, "time": "2007-05-17T04:54:38Z", "bug_id": 42263, "creation_time": "2007-05-17T04:54:38Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "stevel@apache.org", "text": "Fixed in SVN_HEAD...with a test to catch any regressions.\n\nI'm calling Oroject.initProperties() to do the initialisation, not Project.init(). ", "id": 103307, "time": "2007-05-17T09:17:32Z", "bug_id": 42263, "creation_time": "2007-05-17T09:17:32Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "text": "Yeah, looks like initProperties() is better than init() for ComponentHelper reasons I'm sure you already \ndeduced.  :)", "id": 103308, "time": "2007-05-17T09:28:39Z", "bug_id": 42263, "creation_time": "2007-05-17T09:28:39Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 42263, "text": "*** Bug 42715 has been marked as a duplicate of this bug. ***", "id": 104600, "time": "2007-06-21T08:25:38Z", "creator": "stevel@apache.org", "creation_time": "2007-06-21T08:25:38Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "text": "*** Bug 42715 has been marked as a duplicate of this bug. ***", "id": 104606, "time": "2007-06-21T13:09:55Z", "bug_id": 42263, "creation_time": "2007-06-21T13:09:55Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 42263, "text": "Updating title as this bug affects all <ant>, <subant> and <antcall>\n", "id": 104607, "time": "2007-06-21T13:11:08Z", "creator": "peterreilly@apache.org", "creation_time": "2007-06-21T13:11:08Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 42263, "is_private": false, "count": 15, "id": 105930, "time": "2007-07-25T03:41:03Z", "creator": "peterreilly@apache.org", "creation_time": "2007-07-25T03:41:03Z", "text": "*** Bug 42970 has been marked as a duplicate of this bug. ***"}, {"attachment_id": null, "tags": [], "bug_id": 42263, "is_private": false, "count": 16, "id": 115147, "time": "2008-03-31T10:34:10Z", "creator": "jglick@apache.org", "creation_time": "2008-03-31T10:34:10Z", "text": "Also affected ${ant.core.lib} in Ant 1.7.0. Manually confirmed fixed in 1.7.1 and dev. Added test and updated WHATSNEW in trunk (#643076), just WHATSNEW in branch (#643079)."}]
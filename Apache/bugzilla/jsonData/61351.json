[{"count": 0, "tags": [], "creator": "tweek@tweek.dk", "attachment_id": 35182, "id": 200068, "time": "2017-07-27T08:06:45Z", "bug_id": 61351, "creation_time": "2017-07-27T08:06:45Z", "is_private": false, "text": "Created attachment 35182\nServlet that logs url-mappings (maven project)\n\nHi,\n\nStarting with revision 1793440 (introduced 8.5.15) I can no longer use non-US-ASCII letters in url-mappings i web.xml. This is still true for the latest revision (revision 1803056).\n\nThis affects my setup, where I have a servlet mapped to /m\u00e6lk/data .\n\nIf I URL-encode the url-mapping (/m%C3%A6lk/data) then it works again.\n\nI've attached a simple servlet that does nothing except logging it's name and mappings to catalina.out. I have added some non-US-ASCII letters to the servlet name just to make sure that the web.xml is parsed correctly.\n\nKind regards,\nMartin"}, {"count": 1, "tags": [], "bug_id": 61351, "attachment_id": null, "text": "The requirement the URL patterns in web.xml must be decoded dates back to Servlet 2.3 (see r285186).\n\nIn more recent times this has been tweaked so the the charset used to do the decoding is consistent with the charset used for the web.xml file (see r1758423).\n\nHowever, the expectation from the Java EE XSD is that:\n<quote>\nThis pattern is assumed to be in URL-decoded form and must not contain CR(#xD) or LF(#xA)\n</quote>\n\nThe Servlet specification also references RFC 3986 although it doesn't offer a view on where that RFC applies and where it does not.\n\nThose do not appear to be entirely consistent.\n\nGiven the above, it is also worth noting the rare edge cases where a literal '*' or '%' needs to be used in the url-pattern.\n\nSo, where to go from here?\n\nMy current thinking is that Tomcat needs to assume the url-patterns may be partially decoded. i.e. they may contain characters not permitted by RFC 3986 and they may also contain %nn sequences that need to be decoded. Therefore, r1793440 needs to be reverted / rewritten on that basis.\n\nI'm going to start work in this direction but if folks disagree with my analysis or think I have missed one or more important points, please do speak up.", "id": 200071, "time": "2017-07-27T10:30:49Z", "creator": "markt@apache.org", "creation_time": "2017-07-27T10:30:49Z", "is_private": false}, {"count": 2, "tags": [], "text": "Interesting analysis.\n\nA servlet-mapping can be created by a tool. E.g. JspC:\n\nhttps://svn.apache.org/viewvc/tomcat/trunk/java/org/apache/jasper/JspC.java?revision=1800816&view=markup#l1092\n\no.a.j.JspC.generateWebMapping()\n\nEncoding of generated web.xml file is configurable (\"-webxmlencoding\" switch), but the pattern itself is simply written as\n\n> mappingout.write(file.replace('\\\\', '/'));\n\nIf we are to require that url-mapping pattern is urlencoded, JspC should be adjusted for that.", "attachment_id": null, "bug_id": 61351, "id": 200072, "time": "2017-07-27T12:00:39Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2017-07-27T12:00:39Z", "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 61351, "text": "Hi Mark,\n\nIf the 'pattern is assumed to be in URL-decoded form', why decode it again?\n\nKind regards,\nMartin", "id": 200073, "time": "2017-07-27T12:03:20Z", "creator": "tweek@tweek.dk", "creation_time": "2017-07-27T12:03:20Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 61351, "text": "The requirement the URL patterns in web.xml must be decoded dates back to Servlet 2.3 (see r285186).", "id": 200078, "time": "2017-07-27T16:40:07Z", "creator": "markt@apache.org", "creation_time": "2017-07-27T16:40:07Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 61351, "attachment_id": null, "text": "Thanks for the report. This has been fixed in trunk (for 9.0.0.M26) and 8.5.x (for 8.5.20 onwards).", "id": 200081, "time": "2017-07-27T19:17:46Z", "creator": "markt@apache.org", "creation_time": "2017-07-27T19:17:46Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 61351, "attachment_id": null, "text": "Thanks Mark,\n\nBoth for the explanation and the quick fix.\nMy url-mappings work again from r1803226. :-)\n\nKind regards,\nMartin", "id": 200092, "time": "2017-07-28T08:11:04Z", "creator": "tweek@tweek.dk", "creation_time": "2017-07-28T08:11:04Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "The HTTP_PORT env var was working correctly in 2.2, but it seems 2.4 has introduced a bug where HTTP_PORT is always 80, even when the true connected port is something else, like 8080 example.\n\nThis is really problematic, as many settings and script relying on HTTP_PORT for configuration now fail.\n\nSteps to reproduce (on Linux):\n\n1: Clean install of 2.4.10\n2: Add \"Listen 8080\" to httpd.conf\n3: Add \"%{local}p\" to LogFormat so that you can monitor and verify the real port\n4: Enable cgi-bin and verify that http://host/cgi-bin/printenv works\n5: Enable port forwarding \"sysctl net.ipv4.ip_forward=1\"\n6: Add simple forwarding rule for testing purposes: \n   \"iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080\"\n   This will forward any connection on port 80 to port 8080.\n7: Navigate to http://host/cgi-bin/printenv\n8: Observe bug: HTTP_PORT should be 8080, but it's 80.\n\nIf you added \"%{local}p\" to LogFormat you can verify that port 8080 is being\nused, as the port is correctly reported in the log. \n\nYou can also verify the connection to 8080 with \"netstat -na | grep 8080\" \nfor example.\n\nThe server status line has the same bug, and port 80 is always displayed there.\n\nLike I said in 2.2 this was working completely without problems. The real connection port was always reported in HTTP_PORT, and on the status line.\n\nIn 2.4 how can I now get the real connection port? There's no other ENV \nvars which display the port number.", "attachment_id": null, "id": 178245, "creator": "casper.cg@gmail.com", "time": "2014-10-03T03:43:47Z", "bug_id": 57051, "creation_time": "2014-10-03T03:43:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57051, "attachment_id": null, "id": 178246, "time": "2014-10-03T04:22:01Z", "creator": "casper.cg@gmail.com", "creation_time": "2014-10-03T04:22:01Z", "is_private": false, "text": "SERVER_PORT !!, not HTTP_PORT (don't write bug reports at 5 AM)."}, {"count": 2, "tags": [], "text": "SERVER_PORT !!, not HTTP_PORT (don't write bug reports at 5 AM).", "is_private": false, "id": 178247, "creator": "casper.cg@gmail.com", "time": "2014-10-03T04:22:16Z", "bug_id": 57051, "creation_time": "2014-10-03T04:22:16Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 57051, "text": "http://httpd.apache.org/docs/current/mod/core.html#usecanonicalphysicalport has the same default in 2.2 and 2.4 as far as I can tell", "id": 178263, "time": "2014-10-03T11:56:39Z", "creator": "covener@gmail.com", "creation_time": "2014-10-03T11:56:39Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 57051, "text": "Eric apparently not. I didn't know about that setting, and I didn't use it before in 2.2. \n\nJust added it to my 2.4 installation and it resolved my problem. Sorry for the noise.", "id": 178264, "time": "2014-10-03T12:10:22Z", "creator": "casper.cg@gmail.com", "creation_time": "2014-10-03T12:10:22Z", "tags": [], "is_private": false}]
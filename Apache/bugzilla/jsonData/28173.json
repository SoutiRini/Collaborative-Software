[{"count": 0, "tags": [], "bug_id": 28173, "attachment_id": null, "is_private": false, "id": 55209, "time": "2004-04-03T00:12:42Z", "creator": "Rolf.Sponsel@kstr.lth.se", "creation_time": "2004-04-03T00:12:42Z", "text": "According to my understanding of customizable error responses they can be\ndivided into two distinct features.\n\n* The first feature is *localization*, which is accomplished by editing the\nfiles found in the 'error' directory in the 'ServerRoot', i.e. by default in\n'/usr/local/apache2/error'.\n\n* The second feature is *appearance*, which is accomplished by editing the files\nfound in the 'include' subdirectory to the 'error' directory mentioned above,\ni.e. by default in '/usr/local/apache2/error/include'.\n\n\nTo enable these features one has to uncomment the customizable error related\ndirectives in the 'httpd.conf' file. E.g. like this:\n\n\n...\n\nAlias /error/ \"/usr/local/apache2/error/\"\n\n<Directory \"/usr/local/apache2/error\">\n    AllowOverride None\n    Options IncludesNoExec\n    AddOutputFilter Includes html\n    AddHandler type-map var\n    Order allow,deny\n    Allow from all\n    LanguagePriority en cs de es fr it nl sv pt-br ro\n    ForceLanguagePriority Prefer Fallback\n</Directory>\n\nErrorDocument 400 /error/HTTP_BAD_REQUEST.html.var\nErrorDocument 401 /error/HTTP_UNAUTHORIZED.html.var\nErrorDocument 403 /error/HTTP_FORBIDDEN.html.var\nErrorDocument 404 /error/HTTP_NOT_FOUND.html.var\nErrorDocument 405 /error/HTTP_METHOD_NOT_ALLOWED.html.var\nErrorDocument 408 /error/HTTP_REQUEST_TIME_OUT.html.var\nErrorDocument 410 /error/HTTP_GONE.html.var\nErrorDocument 411 /error/HTTP_LENGTH_REQUIRED.html.var\nErrorDocument 412 /error/HTTP_PRECONDITION_FAILED.html.var\nErrorDocument 413 /error/HTTP_REQUEST_ENTITY_TOO_LARGE.html.var\nErrorDocument 414 /error/HTTP_REQUEST_URI_TOO_LARGE.html.var\nErrorDocument 415 /error/HTTP_UNSUPPORTED_MEDIA_TYPE.html.var\nErrorDocument 500 /error/HTTP_INTERNAL_SERVER_ERROR.html.var\nErrorDocument 501 /error/HTTP_NOT_IMPLEMENTED.html.var\nErrorDocument 502 /error/HTTP_BAD_GATEWAY.html.var\nErrorDocument 503 /error/HTTP_SERVICE_UNAVAILABLE.html.var\nErrorDocument 506 /error/HTTP_VARIANT_ALSO_VARIES.html.var\n\n...\n\n./.\n\nAfter restaring apache, if one triggers an error, e.g. by creating a\nREAD-PROTECTED file in the 'DocumentRoot' directory and then trying to access\nthat file, a customizable error response (see below) is displayed instead of the\ngeneric error response.\n\n> Access forbidden!\n>\n> You don't have permission to access the requested object. It is either\nread-protected or not readable by the server.\n\n> If you think this is a server error, please contact the webmaster.\n> Error 403\n> hostname\n> Sat Apr 03 01:16:27 2004\n> Apache/2.0.49 (Unix) \n\nAll this is okay so far.\n\nAccording to the information in the default 'httpd.conf' (httpd-std.conf) it's\nalso possible to specify another location for the \"appearance\" files, i.e. for\nthe files 'bottom.html', 'spacer.html', and 'top.html' which by default are\nfound in sub-directory 'include' of directory 'error'. This following\ninformation can be found in the 'httpd.conf' file:\n\n# You can modify the messages' appearance without changing any of the\n# default HTTP_<error>.html.var files by adding the line:\n#\n#   Alias /error/include/ \"/your/include/path/\"\n#\n# which allows you to create your own set of files by starting with the\n# /usr/local/apache2/error/include/ files and copying them to /your/include/path/,\n# even on a per-VirtualHost basis.\n\n\nNow, let's *prove* the statement made in the subject of this bug report, i.e.\nthat \"Customizable error responses don't work the way they are intended to\".\n\n\nIn order to manifest this, instead of creating an alternative directory with the\n\"appearance\" files just move the 'include' directory to the same level as our\n'error' directory AND at the same time rename it, e.g. 'error-include'. Now,\nbecause we have moved them out of the original directory hierarcy of 'error'\nthey now no longer inherit the directives speified for 'error', and therefore we\nmust apply an explicit \"Directory\" directive for our moved 'error-include'\ndirectory.\n\nThis is can easily be accomplished by copying the \"Directory ...\" directive\nblock for 'error' and just changing '.../error' to read '.../error-include'.\nIn addition, according to the information in 'httpd.conf' (see above) we now\nhave to add the 'Alias /error/include/ \"/usr/local/apache2/error-include/'\ndirective to our 'httpd.conf' file. I.e. in addition to before our 'httpd.conf'\nfile now also contains:\n\n...\n\nAlias /error/include/ \"/usr/local/apache2/error-include/\"\n\n<Directory \"/usr/local/apache2/error-include\">\n    AllowOverride None\n    Options IncludesNoExec\n    AddOutputFilter Includes html\n    AddHandler type-map var\n    Order allow,deny\n    Allow from all\n    LanguagePriority en cs de es fr it nl sv pt-br ro\n    ForceLanguagePriority Prefer Fallback\n</Directory>\n\n...\n\n./.\n\nAfter restarting the apache server, and triggering an error, e.g. as described\nabove, we will receive an error response, but this time something like:\n\n\n[an error occurred while processing this directive] You don't have permission to\naccess the requested object. It is either read-protected or not readable by the\nserver. [an error occurred while processing this directive]\n\n\nNOTE: Don't leave the original sub-directory 'include' in 'error', or this will\nbe used and you might not notice the problem and think everything works just\nfine. If you leave it in place, you can for example modify the background for\nthe error response in 'top.html', e.g. to #FF0000 instead of #FFFFFF, to make it\nobvious which \"include\" directory is used.\n\n\n*Eventually* once this BUG has been corrected to handle the case where the\n\"include\" directory has been moved, you need to make sure that the case where\nthe original \"include\" directory is left in place, but is overridden by an\nalias, also works. (And that it works when 'ServerRoot' is different from\n'/usr/local/apache2', which actually was the case when I noticed this problem in\nthe first place).\n\n\n\n\nOne last thing; I guess that this is a NEW FEATURE REQUEST though!?\n\nIMHO, it should be possible to modify the appearance of the \"generic\" error\nresponse messages too. Why not in the same way as for these customizable error\nresponses? By just defining that 'Alias /error/include/ ...', and if the\ncusomized documents, i.e. 'bottom.html', 'spacer.html', and 'top.html' are found\nthey're used, otherwise fall back to how it is \n\n\nBest Regards,\nRolf Sponsel\n\nPs. This is probably not only a SPARC/Solaris issue,\n    but that is where is have verified the problem.\n    Please adjust the 'Platform' and 'OS' accordingly."}, {"count": 1, "tags": [], "creator": "slive@apache.org", "text": "You need to list the\nAlias /errors/include/ ...\nABOVE the \nAliase /errors/ ...\nor else it will be ignored.\n\nWe should mention that explicitly in the comments.\n\nIn a future version, you will also get an error in the error log if you\nuse an Alias that will be ignored like that.\n\nAs far as customizing the \"generic\" (I assume you mean internal) error messages,\nthere is really no reason to do that when you can simply use custom\nerror messages.", "id": 55210, "time": "2004-04-03T00:28:58Z", "bug_id": 28173, "creation_time": "2004-04-03T00:28:58Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 28173, "is_private": false, "id": 55212, "time": "2004-04-03T00:53:49Z", "creator": "Rolf.Sponsel@kstr.lth.se", "creation_time": "2004-04-03T00:53:49Z", "tags": [], "text": "Well, I wish it was that easy.\n\nIt doesn't work *even* when listing\n\nAlias /error/include/ ...\n\nABOVE\n\nAlias /error/ ...\n\nThat was the way I had it when I discovered the problem.\nIt just happened to be listed BELOW during my verification of the problem, and\nthus in my report. I just tried to move the Alias for '/error/include/' and the\n'Directory' directive ABOVE those for '/error/'. RESULT: Problem still exists.\n\nThus it's NOT a DOCUMENTATION issue ONLY,\nand therefore the 'Component' should be\nmoved back to \"CORE\", unless there is a\nbetter one (of course).\n\nBest Regards,\nRolf Sponsel\n\nPlease feel free to request more information.\n\n\nPs. Restoring original summary for this issue, i.e.:\n\nCustomizable error responses don't work the way they are intended to\n \n    thereby deleting:\n\nComment fix: alias for /errors/include/ must be above alias for /errors/\n\n"}, {"count": 3, "tags": [], "bug_id": 28173, "is_private": false, "text": "You really have not at all convinced me that you have identified a bug.\nMost likely you have a configuration problem that should be addressed\non a user support forum.\n\nYou need to identify the source of the error in the SSI\nby looking in the apache error log.  But the bug database is not the place to \nget help with these issues.\n\nPlease take your problem to the mailing list at\nhttp://httpd.apache.org/userslist.html\nIf you can't solve your problem there, then feel free to reopen this\nbug with additional details about what has failed.", "id": 55215, "time": "2004-04-03T04:35:07Z", "creator": "slive@apache.org", "creation_time": "2004-04-03T04:35:07Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "Rolf.Sponsel@kstr.lth.se", "attachment_id": null, "id": 55257, "time": "2004-04-04T15:12:36Z", "bug_id": 28173, "creation_time": "2004-04-04T15:12:36Z", "is_private": false, "text": "I'm glad to be able to confirm that this is NOT an issue, after having\nthoroughly tested all possible situations I could think of. Even in case of\ninvolving virtual hosts.\n\nUnless one places the 'Alias /error/include/ \"...\"' directive after the 'Alias\n/error/ \"...\"' directive I cannot repeat any previous problems.\n\nAlthough the SSI related problems occured due to having moved 'error/include' to\n'error-include' (i.e. to the same level as 'error'), at the same time as having\ndefined 'Alias /error/include/ \"/usr/local/apache2/error-include/\"' but having\nput it AFTER 'Alias /error/ ...'. Because 'Alias /error/include/ ...' in this\ncase is ignored, SSI - of course - couldn't find the files residing in the\n'include' sub-directory of directory 'error'.\n\nI have no explanation to why I still got the same error after having moved the\n'Alias /error/include/ ...' directive BEFORE the 'Alias /error/ ...' directive,\nother than having forgotten to restart the server or having forgotten to clear\nmy browsers cache. Anyway, that doesn't matter. The important thing is that it\nworks.\n\nThus I have to do a \"pudel\", and appologize for the doubts my false alarm may\nhave caused.\n\nKind Regards,\nRolf Sponsel\n\nBTW, Yes I think it might be good to point this out in the\ndocumentation/httpd-std.conf file, unless this is not the default behaviour when\nusing the 'Alias' directive. I couldn't find that information in the Apache2\ndocumentation."}, {"count": 5, "tags": [], "text": "Thanks for the confirmation.\n\nI'll try to fix the comments in httpd.conf.", "attachment_id": null, "bug_id": 28173, "id": 55260, "time": "2004-04-04T16:58:14Z", "creator": "slive@apache.org", "creation_time": "2004-04-04T16:58:14Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 28173, "is_private": false, "text": "Created attachment 11147\n% diff httpd-std.conf httpd.conf > httpd.conf.diff", "id": 55352, "time": "2004-04-05T20:52:27Z", "creator": "Rolf.Sponsel@kstr.lth.se", "creation_time": "2004-04-05T20:52:27Z", "attachment_id": 11147}, {"count": 7, "attachment_id": null, "bug_id": 28173, "is_private": false, "id": 55355, "time": "2004-04-05T21:36:03Z", "creator": "Rolf.Sponsel@kstr.lth.se", "creation_time": "2004-04-05T21:36:03Z", "tags": [], "text": "Joshua,\n\nThere seems to be an issue, although minor, with customizable error responses\ndespite all. I decided to post it in this thread as it's slightly related and\ndefinitely covered by the summary of this report.\n\nForget all that we've been discussing earlier in this thread.\n\nIt's about error responses in an virtual hosts environment, and I've attached a\ndiff file showing the differences between the httpd-std.conf file and the\nhttpd.conf file I have used. It contains the minimal modifications required in\norder to reproduce my observations.\n\nFollow these steps to reproduce:\n\n1). Create/use a default installation of apache httpd-2.0.49\n\n2). In the DocumentRoot, i.e. htdocs, create a file, e.g. READ-PROTECTED-FILE,\nand make sure it's not readable (just in order to have some file by means which\nwe can trigger the error).\n\n3). Create 2 virtual hosts (by applying the provided diff in attachement 11147).\n    Edit the virtual hosts' ServerName to something that suites your installation.\n    Just for the sake of simplicity both virtual hosts do use the same\nDocumentRoot (which is inherited from the default configuration).\n    The first virtual host is supposed to generate a default error response, the\nsecond is supposed to generate a customized error response as it has the 'Alias\n/error/ ...' directive defined.\n    (In my particular case the ServerName '192.168.0.1' refers to a gateway that\nforwards the request to 192.168.0.100:80. You could use just any host alias of\n192.168.0.100 instead. I've verified that)\n\n4). Now, if you access that same read-protected file through either the first or\nthe second virtual host a 403 Forbidden error is triggered, which is expected.\n\nThe SECOND virtual server displays (just as it is expected to):\n\n> Access forbidden!\n>\n> You don't have permission to access the requested object. It is either\n> read-protected or not readable by the server.\n>\n> If you think this is a server error, please contact the webmaster.\n>\n> Error 403\n> 192.168.0.1\n> Mon Apr 05 22:31:57 2004\n> Apache/2.0.49 (Unix) \n\nThe FIRST virtual server displays (which contains *additional* information to\nwhat it usually does, i.e. if NO 'ErrorDocument' directive had been specified):\n\n> Forbidden\n>\n> You don't have permission to access /READ-PROTECTED-FILE on this server.\n> \n> Additionally, a 404 Not Found error was encountered while trying to use\n> an ErrorDocument to handle the request.\n>\n> Apache/2.0.49 (Unix) Server at 192.168.0.100 Port 80\n\n5). If you now comment out the ONLY ONE ErrorDocument directive specified in\nyour httpd.conf file, then the generic error response renders the expected\nresult (i.e. which is generated by default under normal conditions), i.e.:\n\n> Forbidden\n>\n> You don't have permission to access /READ-PROTECTED-FILE on this server.\n>\n> Apache/2.0.49 (Unix) Server at 192.168.0.100 Port 80\n\n\nNow, how does this impact an apache server installation?\n\nThis means that you do not get a \"clean\" default error response for a virtual\nhost *if* one or more virtual hosts enable and share one set of customized error\nresponse documents. If you on the other hand do not share (i.e. define any\nshared 'ErrorDocument ...' directives, then this is not an issue.\n\nThis raises the question what actually triggers the use of customized error\nresponses?\n\nAt least to me, it seems like it's the definition of any 'ErrorDocument'\ndirectives. IMHO this shouldn't be the case. The 'ErrorDocument' directives\nshould only define the documents, not trigger/bind the use of them. Once again,\nIMHO, the actual triggering/binding should occur when specifying the 'Alias\n/error/ ...' directive; either in the default server, or withing any virtual host.\n\n\nAs I said before; this is *not* a big issue.\nI just wanted to make sure that you were aware of this though.\n\n\nKind Regards,\nRolf Sponsel\n\n\nDon't hesitate to ask for more information, in case you need.\n\n\n\n\n"}, {"count": 8, "tags": [], "text": "Sorry, but it is definitely the ErrorDocument directive that triggers the\nuse of custom error documents, not the Alias.  The Alias is just a generic\ndirective to map content from one place to another.\n\nYou are correct that there is no way to have a global set of custom\nerror documents, and then have one virtual host \"opt out\" and get the\nbuilt-in error documents.  In this case, what you need to do is\nput the ErrorDocument directives inside the virtual hosts that want\nthem.  This may, of course, involve duplicating configuration directives\nin many virtual hosts, but there is no way around it.  That's just how\nApache works.", "attachment_id": null, "bug_id": 28173, "id": 55357, "time": "2004-04-05T23:37:04Z", "creator": "slive@apache.org", "creation_time": "2004-04-05T23:37:04Z", "is_private": false}]
[{"count": 0, "attachment_id": 25079, "creator": "mdietze@gmail.com", "is_private": false, "id": 134989, "time": "2010-03-02T10:33:37Z", "bug_id": 48840, "creation_time": "2010-03-02T10:33:37Z", "tags": [], "text": "Created attachment 25079\nSuppresses the printing of a path cd'ed to when computing $CATALINA_HOME\n\nOn a newly installed Ubuntu system, this line in catalina.sh fails:\n\n[ -z \"$CATALINA_HOME\" ] && CATALINA_HOME=`cd \"$PRGDIR/..\" ; pwd`\n\nAfter this line, $CATALINA_HOME has a value like this (using '\\n' as newline which actually appears in the variable's value):\n\n/path/to/tomcat\\n/path/to/tomcat\n\nIt seems like when cd'ing the path is printed to stdout, so that $CATALINA_HOME ends up unusable.\n\nThis behaviour has been observed with this version of bash:\n\n$ bash --version\nGNU bash, Version 4.0.33(1)-release (i486-pc-linux-gnu)\nCopyright (C) 2009 Free Software Foundation, Inc.\n[...]\n\nThe problem can be fixed using the attached patch."}, {"count": 1, "attachment_id": null, "creator": "mdietze@gmail.com", "is_private": false, "id": 134990, "time": "2010-03-02T11:05:05Z", "bug_id": 48840, "creation_time": "2010-03-02T11:05:05Z", "tags": [], "text": "Actually it seems like the behaviour of the 'cd' command as observed on this recent Ubuntu installation is not a bash default but caused by the distro's default settings.\n\nNote how 'cd' echos any path cd'ed to:\n\n$ cd foo/bar\nfoo/bar\n$ _\n\nThis is brain-dead but my patch should make catalina.sh bullet-proof against such nonsense."}, {"count": 2, "tags": [], "bug_id": 48840, "attachment_id": null, "is_private": false, "id": 134995, "time": "2010-03-02T11:49:15Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-03-02T11:49:15Z", "text": "Thank you for the patch.\n\nHow about setting an explicit value for the CATALINA_HOME variable?\nI would say that that is the recommended way to run these scripts.\n\nThe POSIX standard [1] defines that there are circumstances when \"cd\" command should print directory name to stdout. Do you have the CDPATH variable defined?\n\n[1] http://www.opengroup.org/onlinepubs/009695399/utilities/cd.html"}, {"count": 3, "tags": [], "text": "Yes, CDPATH is the culprit. As we all (may) know the bash developers are trying to move towards more POSIX compatibility with every new version. It seems like they've now implemented POSIX-compliant behaviour for the 'cd' command if CDPATH is set. Thus bash behaves correctly (apologies for the 'brain-dead' thing, guys), and scripts need to be cleaned up to deal with this.\n\nActually I'm not sure what you mean by explicitly setting $CATALINA_HOME. It is already honoured if set, and most people simply do not want to deal with this (e.g. if you're a developer and tend to run several tomcat instances from different directories etc.). \nI'd probably go for the simpler \"`dirname $0`/..\" stuff as long as the funny-looking relative path in it does not break anything.", "attachment_id": null, "id": 134996, "creator": "mdietze@gmail.com", "time": "2010-03-02T13:03:47Z", "bug_id": 48840, "creation_time": "2010-03-02T13:03:47Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 48840, "attachment_id": null, "id": 134997, "time": "2010-03-02T13:09:40Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-03-02T13:09:40Z", "is_private": false, "text": "And what your CDPATH value looks like?"}, {"count": 5, "tags": [], "text": "CDPATH on my colleague's system is this: \".:$HOME/src\"", "attachment_id": null, "id": 134999, "creator": "mdietze@gmail.com", "time": "2010-03-02T13:58:38Z", "bug_id": 48840, "creation_time": "2010-03-02T13:58:38Z", "is_private": false}, {"count": 6, "tags": [], "creator": "knst.kolinko@gmail.com", "is_private": false, "id": 135002, "creation_time": "2010-03-02T15:03:09Z", "time": "2010-03-02T15:03:09Z", "bug_id": 48840, "text": "OK, now I see why it happens.\nAn alternative solution though would be to add\nunset CDPATH\nto the beginning of catalina.sh", "attachment_id": null}, {"count": 7, "tags": [], "creator": "mdietze@gmail.com", "is_private": false, "text": "Hmm, I'd rather make the mechanism more robust. Who knows for which other reasons we may get output from 'cd' on the standard output in the future...", "id": 135003, "time": "2010-03-02T15:08:45Z", "bug_id": 48840, "creation_time": "2010-03-02T15:08:45Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 48840, "attachment_id": null, "id": 135747, "time": "2010-03-29T11:55:52Z", "creator": "markt@apache.org", "creation_time": "2010-03-29T11:55:52Z", "is_private": false, "text": "Thanks for the patch. After some deliberation I went with the original proposal rather than using unset.\n\nThe patch has been applied to trunk and proposed for 6.0.x and 5.5.x"}, {"count": 9, "tags": [], "creator": "markt@apache.org", "is_private": false, "id": 136960, "creation_time": "2010-05-19T12:03:06Z", "time": "2010-05-19T12:03:06Z", "bug_id": 48840, "text": "The patch has been applied to 5.5.x and will be included in 5.5.30 onwards.", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 48840, "attachment_id": null, "is_private": false, "id": 136961, "time": "2010-05-19T12:11:29Z", "creator": "markt@apache.org", "creation_time": "2010-05-19T12:11:29Z", "text": "This has been fixed in 6.0.x and will be included in 6.0.27 onwards."}, {"count": 11, "tags": [], "bug_id": 48840, "is_private": false, "text": "The fix was also applied to tool-wrapper.sh. Will be in 5.5.30, 6.0.27.", "id": 137062, "time": "2010-05-24T06:52:54Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-05-24T06:52:54Z", "attachment_id": null}]
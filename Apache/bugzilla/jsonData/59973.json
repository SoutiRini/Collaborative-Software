[{"count": 0, "tags": [], "text": "When JMeter writes XML JTL files, it uses header with XML version 1.0\ndeclared\n(https://github.com/apache/jmeter/blob/trunk/src/core/org/apache/jmeter/reporters/ResultCollector.java#L82)\n\nHere's example that I generated with ResultCollector, reproducing the\nissue from one of the users:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<testResults version=\"1.2\">\n<sample t=\"0\" it=\"0\" lt=\"0\" ts=\"1469356444856\" s=\"false\" lb=\"\" rc=\"\"\nrm=\"&#x9;\" tn=\"\" dt=\"\" by=\"0\" ng=\"0\" na=\"0\"/>\n\n</testResults>\n\nIf we will use strict XML parser, like http://www.validome.org/validate\nor other strict XML reading library, we will get the error for the above\ntext, because &#x9 is a character entity, only allowed in XML 1.1.\nXStream writer that we use generates XML 1.1 data and there is FAQ entry\nfor this case: http://x-stream.github.io/faq.html#XML_control_char\n\nIt is a bug of writing file body as XML 1.1 while\ndeclaration says 1.0.", "attachment_id": null, "id": 193006, "creator": "apc4@ya.ru", "time": "2016-08-11T10:09:21Z", "bug_id": 59973, "creation_time": "2016-08-11T10:09:21Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59973, "text": "Date: Thu Aug 11 10:27:45 2016\nNew Revision: 1755929\n\nURL: http://svn.apache.org/viewvc?rev=1755929&view=rev\nLog:\nBug 59973 - Issue with XML version in JTL files\n\nModified:\n    jmeter/trunk/bin/testfiles/BatchTestLocal.xml\n    jmeter/trunk/bin/testfiles/BatchTestLocalRemote.xml\n    jmeter/trunk/bin/testfiles/Bug47165.xml\n    jmeter/trunk/bin/testfiles/Bug50898.xml\n    jmeter/trunk/bin/testfiles/Bug52310.xml\n    jmeter/trunk/bin/testfiles/Bug52968.xml\n    jmeter/trunk/bin/testfiles/Bug54685.xml\n    jmeter/trunk/bin/testfiles/Bug55375.xml\n    jmeter/trunk/bin/testfiles/Bug56243.xml\n    jmeter/trunk/bin/testfiles/Bug56811.xml\n    jmeter/trunk/bin/testfiles/HTMLParserTestFile_2.xml\n    jmeter/trunk/bin/testfiles/TEST_HTTPS.xml\n    jmeter/trunk/src/core/org/apache/jmeter/reporters/ResultCollector.java\n    jmeter/trunk/xdocs/changes.xml", "id": 193009, "time": "2016-08-11T10:38:05Z", "creator": "apc4@ya.ru", "creation_time": "2016-08-11T10:38:05Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 59973, "attachment_id": null, "id": 193149, "time": "2016-08-17T09:16:59Z", "creator": "milamber@apache.org", "creation_time": "2016-08-17T09:16:59Z", "is_private": false, "text": "\n\nThe first commits introduce a regression I think.\n\nWith the trunk version, if I try to open a JTL file (recorded by trunk version too) into a listenr, I have this error message (the listener dont display the results) :\n\n2016/08/17 10:11:28 WARN  - jmeter.reporters.ResultCollector: Failed to load /directory/Results-20160816-1625.jtl using XStream. Error was: com.thoughtworks.xstream.io.StreamException:  : only 1.0 is supported as <?xml version not '1.1' (position: START_DOCUMENT seen <?xml version=\"1.1\"... @1:19)"}, {"count": 3, "tags": [], "bug_id": 59973, "text": "Funny... Xstream writes XML 1.1, but requires 1.0 declaration... I'll investigate it more", "id": 193150, "time": "2016-08-17T09:54:41Z", "creator": "apc4@ya.ru", "creation_time": "2016-08-17T09:54:41Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 59973, "text": "Milamber, which version of XStream library do you have? I have 1.4.8 and don't experience this. Also, I tried searching for this kind of error message in XStream sources of 1.4.8 and did not find it.", "id": 193151, "time": "2016-08-17T10:36:56Z", "creator": "apc4@ya.ru", "creation_time": "2016-08-17T10:36:56Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "\nThe version from the trunk: xstream-1.4.8.jar", "attachment_id": null, "id": 193158, "creator": "milamber@apache.org", "time": "2016-08-17T18:46:22Z", "bug_id": 59973, "creation_time": "2016-08-17T18:46:22Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 59973, "text": "\nTest case :\n\n- Compile JMeter from trunk (ant distribution)\n- unzip the binary, launch JMeter (with Java8)\n- Create a simple test plan:\nThread Group\n   |-- HTTP request\n   |-- View Results Tree with a file to record into JTL (inside Configure button select all options)\n- Run\n- Close JMeter and reopen\n- Add a View Results Tree, a try to open the jtl file from the simple test.", "id": 193159, "time": "2016-08-17T19:20:41Z", "creator": "milamber@apache.org", "creation_time": "2016-08-17T19:20:41Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "apc4@ya.ru", "attachment_id": null, "text": "Thanks for the reproducing case. I have investigated it and found that issue is in xpp3 library we use. It is 10 years old and has xml 1.0 requirement hardcoded into it. There are no newer versions of this library that could load XML 1.1.\nSo it's a deadlock: we write XML 1.1 as body, we state that it's 1.0 in header because reading flow is unable to accept 1.1 header. However, it perfectly eats 1.1 body, which means that xpp3 does not conform to XML standard.\n\nFrom their FAQ (http://x-stream.github.io/faq.html#XML_control_char) I can assume that the only way is to rollback my changes. Also, we should document somewhere here (http://jmeter.apache.org/usermanual/listeners.html#xmlformat2.1) that JTL and JMX files produced by JMeter do not conform XML 1.0 standard and cannot be read by strict parsers. Users should be aware of this issue.", "id": 193160, "time": "2016-08-17T20:03:44Z", "bug_id": 59973, "creation_time": "2016-08-17T20:03:44Z", "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 59973, "text": "I have reverted the modifications", "id": 193161, "time": "2016-08-17T20:11:47Z", "creator": "apc4@ya.ru", "creation_time": "2016-08-17T20:11:47Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "(In reply to Andrey Pokhilko from comment #7)\n> Thanks for the reproducing case. I have investigated it and found that issue\n> is in xpp3 library we use. It is 10 years old and has xml 1.0 requirement\n> hardcoded into it. There are no newer versions of this library that could\n> load XML 1.1.\n> So it's a deadlock: we write XML 1.1 as body, we state that it's 1.0 in\n> header because reading flow is unable to accept 1.1 header. However, it\n> perfectly eats 1.1 body, which means that xpp3 does not conform to XML\n> standard.\n> \n> From their FAQ (http://x-stream.github.io/faq.html#XML_control_char) I can\n> assume that the only way is to rollback my changes. Also, we should document\n> somewhere here\n> (http://jmeter.apache.org/usermanual/listeners.html#xmlformat2.1) that JTL\n> and JMX files produced by JMeter do not conform XML 1.0 standard and cannot\n> be read by strict parsers. Users should be aware of this issue.\n\nSee this Bug 58679 related to this issue, this would be the final fix.", "id": 193162, "time": "2016-08-17T20:22:01Z", "bug_id": 59973, "creation_time": "2016-08-17T20:22:01Z", "is_private": false}, {"count": 10, "tags": [], "text": "And this https://github.com/x-stream/xstream/issues/51#issuecomment-210155359", "attachment_id": null, "id": 193163, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2016-08-17T20:22:56Z", "bug_id": 59973, "creation_time": "2016-08-17T20:22:56Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 59973, "attachment_id": null, "id": 193164, "time": "2016-08-17T20:35:39Z", "creator": "apc4@ya.ru", "creation_time": "2016-08-17T20:35:39Z", "is_private": false, "text": "Date: Wed Aug 17 20:11:30 2016\nNew Revision: 1756681\n\nURL: http://svn.apache.org/viewvc?rev=1756681&view=rev\nLog:\nBug 59973 - revert all modifications\n\nModified:\n    jmeter/trunk/bin/testfiles/BatchTestLocal.xml\n    jmeter/trunk/bin/testfiles/BatchTestLocalRemote.xml\n    jmeter/trunk/bin/testfiles/Bug47165.xml\n    jmeter/trunk/bin/testfiles/Bug50898.xml\n    jmeter/trunk/bin/testfiles/Bug52310.xml\n    jmeter/trunk/bin/testfiles/Bug52968.xml\n    jmeter/trunk/bin/testfiles/Bug54685.xml\n    jmeter/trunk/bin/testfiles/Bug55375.xml\n    jmeter/trunk/bin/testfiles/Bug56243.xml\n    jmeter/trunk/bin/testfiles/Bug56811.xml\n    jmeter/trunk/bin/testfiles/HTMLParserTestFile_2.xml\n    jmeter/trunk/bin/testfiles/TEST_HTTPS.xml\n    jmeter/trunk/src/core/org/apache/jmeter/reporters/ResultCollector.java\n    jmeter/trunk/xdocs/changes.xml"}, {"count": 12, "tags": [], "bug_id": 59973, "text": "Date: Wed Aug 17 20:24:21 2016\nNew Revision: 1756682\n\nURL: http://svn.apache.org/viewvc?rev=1756682&view=rev\nLog:\nBug 59973 - document non-standard XML in docs and code\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/reporters/ResultCollector.java\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "id": 193165, "time": "2016-08-17T20:36:28Z", "creator": "apc4@ya.ru", "creation_time": "2016-08-17T20:36:28Z", "is_private": false, "attachment_id": null}]
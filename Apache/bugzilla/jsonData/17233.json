[{"attachment_id": null, "tags": [], "creator": "s.prescott@chem.usyd.edu.au", "text": "Under Cygwin 1.3.20 on Win2kSP3, Apache 2.0.44 apachectl assumes that \"ulimit\" \nexists.\n\nThis results in unsightly but it would appear otherwise benign warnings on \nstartup:\n\n$ ./apachectl start\nulimit: ulimit: not available on this system\n\nulimit: ulimit: not available on this system\n\nPerhaps apachectl should test -x for the presence of ulimit first? or use \nautoconf to see if it exists?", "count": 0, "id": 31649, "time": "2003-02-20T05:26:11Z", "bug_id": 17233, "creation_time": "2003-02-20T05:26:11Z", "is_private": false}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "text": "At configure time, the ulimit command is tested, and it is used in apachectl\nonly if it worked at configure time.\n\nApparently the test isn't working correctly on your box?  Try to do some\ndebugging of the test at configure time.  You might need to put some echo\nstatements in configure around the test of ulimit to see what is going on.\n\n", "id": 31666, "time": "2003-02-20T12:25:29Z", "bug_id": 17233, "creation_time": "2003-02-20T12:25:29Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "s.prescott@chem.usyd.edu.au", "text": "A bit of digging gives me this...\n\nConfigure was originally run as ./configure from a /bin/bash prompt (hence is \nactually running under /bin/sh from the #! line. Configure then tests to see \nif /bin/bash exists, makes sure it is not broken and restarts itself \nunder /bin/bash. (/bin/sh under cygwin is not symlink to /bin/bash; I think sh \nis actually ash under cygwin)\n\nUnder /bin/bash on Cygwin, ulimit exists and so we get:\n\n    ULIMIT_MAX_FILES=\"ulimit -S -n `ulimit -H -n`\"\n\nas it correctly passes all the tests (as you correctly noted, configure does \ntest for ulimit... I hadn't looked :(\n\nBut apachectl runs under /bin/sh from it's #!, and in /bin/sh under cygwin, \nulimit does not exist.\n\nChanging the #! in apachectl to /bin/bash solves this as ulimit does exist \nin /bin/bash. (AFAIK, it is not functional, but does exist)\n\nShould apachectl.in use #!@SHELL@ instead of #!/bin/sh always? certainly it \nappears that one needs to ensure that apachectl and configure use the same \nshell to avoid such problems.\n\n\nadditional info:\n\nBASH_VERSION='2.05b.0(8)-release'\n\nuname -a:\nCYGWIN_NT-5.0 xeno 1.3.20(0.73/3/2) 2003-02-08 12:10 i686 unknown unknown Cygwin\n", "id": 31715, "time": "2003-02-20T23:52:43Z", "bug_id": 17233, "creation_time": "2003-02-20T23:52:43Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 17233, "attachment_id": null, "is_private": false, "id": 31808, "time": "2003-02-23T12:06:50Z", "creator": "trawick@apache.org", "creation_time": "2003-02-23T12:06:50Z", "text": "Your proposed fix (change apachectl.in to use @SHELL@) makes sense to me.\n\nThe code to check for bash and start running with that seems pretty evil.  In\nfact, I can't find a reference to bash in my configure, but I generated it\nlocally with autoconf 2.13.\n\nIf you can try it out with Cygwin, we can verify that it doesn't hurt other\nplatforms and then give folks on dev@httpd a chance to point out pitfalls before\ncommitting.\n\nThanks!\n"}, {"count": 4, "tags": [], "creator": "s.prescott@chem.usyd.edu.au", "text": "\nReplacing \n\n#!/bin/sh \n\nwith \n\n#!@SHELL@ \n\nin apachectl.in seems to work fine OOTB under cygwin. From a clean tarball, I \nmade that change, then ./configure && make && make install all went fine.\n\nI guess that's over to the next level to work out why that won't work on other \nsystems ;)\n\n\nFYI the section of configure that was in the 2.0.44 tarball that tests for the \nshell is:\n\nfor as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH\ndo\n  IFS=$as_save_IFS\n  test -z \"$as_dir\" && as_dir=.\n  for as_base in sh bash ksh sh5; do\n         case $as_dir in\n         /*)\n           if (\"$as_dir/$as_base\" -c '\n  as_lineno_1=$LINENO\n  as_lineno_2=$LINENO\n  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`\n  test \"x$as_lineno_1\" != \"x$as_lineno_2\" &&\n  test \"x$as_lineno_3\"  = \"x$as_lineno_2\" ') 2>/dev/null; then\n             $as_unset BASH_ENV || test \"${BASH_ENV+set}\" != set || { BASH_ENV=;\n export BASH_ENV; }\n             $as_unset ENV || test \"${ENV+set}\" != set || { ENV=; export ENV; }\n             CONFIG_SHELL=$as_dir/$as_base\n             export CONFIG_SHELL\n             exec \"$CONFIG_SHELL\" \"$0\" ${1+\"$@\"}\n           fi;;\n         esac\n       done\ndone\n\n\nUnder cygwin, sh fails the addition test as it is actually ash not bash. Hence \nconfigure is relaunched using bash.", "id": 31829, "time": "2003-02-24T01:13:33Z", "bug_id": 17233, "creation_time": "2003-02-24T01:13:33Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 17233, "attachment_id": null, "id": 104248, "time": "2007-06-08T18:27:28Z", "creator": "davi@apache.org", "creation_time": "2007-06-08T18:27:28Z", "is_private": false, "text": "It seems that newer versions of Cygwin includes a ash version with the ulimit built-in."}]
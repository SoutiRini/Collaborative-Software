[{"count": 0, "tags": [], "text": "Hello,\n\nI think there's a bug at the \norg.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory at the time of parsing a \ncertain MySQL url. When the connection url contains the \"sessionVariables\" \nproperty alone, everything works ok. However, when other properties are \nspecified in addition to \"sessionVariables\", then an Exception is thrown when \ntrying to establish a new connection. If the same url is specified using a \nConnection object inside my code, then NO error is thrown. It only happens \nwhen that same url is set at the Resource config of the server.xml file. I \ninclude some examples to reproduce the error:\n\nEverything goes fine when this is the config of the resource (note that the \nimportant part is the url):\n\n<Resource name=\"jdbc/starnum\" auth=\"Container\" type=\"javax.sql.DataSource\"\n     factory=\"org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory\"\n     maxActive=\"15\"\n     maxIdle=\"5\"\n     validationQuery=\"SELECT 1\"\n     testOnBorrow=\"false\"\n     testWhileIdle=\"true\"\n     timeBetweenEvictionRunsMillis=\"10000\"\n     minEvictableIdleTimeMillis=\"60000\"\n     username=\"user\"\n     password=\"pass\"\n     driverClassName=\"com.mysql.jdbc.Driver\"\n     url=\"jdbc:mysql://localhost:3316/db?\nsessionVariables=@date='0',@version='1.0';\"\n/>\n\nHowever, if we set this other url, an error will be printed on the tomcat's \nlog file:\n\njdbc:mysql://localhost:3316/db?\ntransformedBitIsBoolean=true&sessionVariables=@da\nte='0',@version='1.0';\n\nIt seems to be a bug when sessionVariables is specified in addition to other\nproperties, like transformedBitIsBoolean in the previous example.\n\nAs I mentioned above, when this same url is set using a Connection object \ninside my application, no Exception is thrown, so I think the bug is located \nat the BasicDataSourceFactory class.\n\nThank you!", "is_private": false, "id": 98323, "creator": "rh3_sp@yahoo.es", "time": "2007-01-21T12:25:13Z", "bug_id": 41428, "creation_time": "2007-01-21T12:25:13Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 41428, "attachment_id": null, "is_private": false, "id": 98395, "time": "2007-01-23T05:38:40Z", "creator": "rh3_sp@yahoo.es", "creation_time": "2007-01-23T05:38:40Z", "text": "I forgot to include the exception thrown. Here it is:\n\norg.xml.sax.SAXParseException: The reference to entity \"sessionVariables\" must \nend with the ';' delimiter.\n\tat org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException\n(Unknown Source)\n\tat org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown \nSource)\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\n\tat org.apache.xerces.impl.XMLScanner.reportFatalError(Unknown Source)\n\tat org.apache.xerces.impl.XMLScanner.scanAttributeValue(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanAttribute\n(Unknown Source)\n\tat \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown \nSource)\n\tat \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher\n.dispatch(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument\n(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown \nSource)\n\tat org.apache.tomcat.util.digester.Digester.parse(Digester.java:1561)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:489)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:543)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:294)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:432)\n\n\nHowever, when the connection is established via a Connection object everything \ngoes well. In this case, this is the code:\n\nClass.forName(\"com.mysql.jdbc.Driver\").newInstance();\nConnection connection=DriverManager.getConnection\n(\"jdbc:mysql://localhost:3316/db?\ntransformedBitIsBoolean=true&sessionVariables=@date='0',@version='1.0';\");\n\nAs you can see, the URL is the same in both cases. However, now that I've \nlooked at the Exception in detail, the bug seems to be at the \norg.apache.tomcat.util.digester.Digester.parse method and not in the DBCP."}, {"count": 2, "tags": [], "bug_id": 41428, "attachment_id": null, "text": "you need to encode the amersand in your XML configuration, otherwise the XML \nparser thinks sessionVariables is an encoded entity. Change the \"&\" to \"&amp;\":\n\njdbc:mysql://localhost:3316/db?\ntransformedBitIsBoolean=true&amp;sessionVariables=@date='0',@version='1.0';", "id": 98418, "time": "2007-01-23T12:55:12Z", "creator": "rh3_sp@yahoo.es", "creation_time": "2007-01-23T12:55:12Z", "is_private": false}]
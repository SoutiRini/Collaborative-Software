[{"count": 0, "tags": [], "bug_id": 47902, "is_private": false, "text": "Created attachment 24309\nExecutionVisitor patch\n\nMethods visitLDC() and visitLDC_W() push no values in the stack frame when the\nconstant type is a class literal, as can happen with Java 1.5 bytecode. This\nleads to a false stack underflow exception happening to a subsequent\ninstruction:\n\njava.lang.ArrayIndexOutOfBoundsException: -1\n    at java.util.ArrayList.remove(ArrayList.java:390)\n    at\norg.apache.bcel.verifier.structurals.OperandStack.pop(OperandStack.java:135)\n    at\norg.apache.bcel.verifier.structurals.ExecutionVisitor.visitPUTFIELD(ExecutionVisitor.java:1059)\n    at org.apache.bcel.generic.PUTFIELD.accept(PUTFIELD.java:78)\n\n\nMoreover, it would be desired to throw an exception when an unknown constant\ntype is encountered, rather than doing nothing at all. \n\nThis bug arises while running JiST/SWANS, a network simulator that relies on\nrewriting Java bytecode to implement simulation time. To be more specific, it\narises when running the example UDP test application, launching\njist.runtime.Main with arguments \"jist.swans.Main driver.udp\".\n\nI've attached a possible patch against its HEAD revision (411573).\n\nEnrico", "id": 130673, "time": "2009-09-25T02:52:45Z", "creator": "enrico.gueli@polito.it", "creation_time": "2009-09-25T02:52:45Z", "attachment_id": 24309}, {"count": 1, "tags": [], "bug_id": 47902, "is_private": false, "text": "(In reply to comment #0)\n> Moreover, it would be desired to throw an exception when an unknown constant\n> type is encountered, rather than doing nothing at all. \n\nI've just read the Javadoc of ExecutionVisitor, that states that it doesn't check for correct types on the OperandStack. Therefore I remove the checks and just add the class literal constant. Sorry for the inconvenience.\n\nEnrico", "id": 130674, "time": "2009-09-25T03:27:19Z", "creator": "enrico.gueli@polito.it", "creation_time": "2009-09-25T03:27:19Z", "attachment_id": null}, {"count": 2, "text": "Created attachment 24310\nExecutionVisitor patch (updated)", "bug_id": 47902, "attachment_id": 24310, "id": 130675, "time": "2009-09-25T03:28:45Z", "creator": "enrico.gueli@polito.it", "creation_time": "2009-09-25T03:28:45Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "creator": "tcurdt@apache.org", "is_private": false, "count": 3, "id": 133485, "time": "2010-01-10T12:18:16Z", "bug_id": 47902, "creation_time": "2010-01-10T12:18:16Z", "text": "Thx! Applied."}]
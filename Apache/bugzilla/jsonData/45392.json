[{"count": 0, "tags": [], "text": "Created attachment 22251\npatch to add basic support for OCSP\n\nStandalone tocmat (tomcat6) with apr support (tcnative 1.1.13) has no support for OCSP checking in the certificates even if the certificates have OCSP information. This permits clients with revoked certificates to use them as authentication method. The following patch that is attached adds basic functionality for OCSP support to prevent this type of attack. (patch made against tomcat native 1.1.13).\n\nMore info http://email.uoa.gr/projects/misc/tomcat-ocsp/", "is_private": false, "bug_id": 45392, "id": 118615, "time": "2008-07-14T03:33:40Z", "creator": "arisg@noc.edunet.gr", "creation_time": "2008-07-14T03:33:40Z", "attachment_id": 22251}, {"count": 1, "text": "Created attachment 22252\npatch to add basic support for OCSP for tomcat-native 1.1.14\n\npatch for tomcat native 1.1.14", "bug_id": 45392, "attachment_id": 22252, "id": 118616, "time": "2008-07-14T03:35:16Z", "creator": "arisg@noc.edunet.gr", "creation_time": "2008-07-14T03:35:16Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "is_private": false, "id": 118617, "time": "2008-07-14T03:54:15Z", "bug_id": 45392, "creation_time": "2008-07-14T03:54:15Z", "text": "Few things, about the patch.\n1. Please use 4 spaces instead TAB\n2. New files must have ASL 2.0 license header at the top.\n\nPlease make the patch against the svn trunk.\nSome documentation would be great if additional setup is required.\n\n\nOther then that, the patch is pretty promissing.\nIt would be nice to use the APR for make_socket, but that can be done later.\n\nRegards"}, {"count": 3, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 118618, "time": "2008-07-14T04:45:36Z", "bug_id": 45392, "creation_time": "2008-07-14T04:45:36Z", "is_private": false, "text": "-1. Please do not add zillions of random features to the Tomcat native code. If APR supports it, then it's ok, otherwise I don't think this is a good idea."}, {"count": 4, "tags": [], "creator": "arisg@noc.edunet.gr", "attachment_id": null, "id": 118620, "time": "2008-07-14T05:13:52Z", "bug_id": 45392, "creation_time": "2008-07-14T05:13:52Z", "is_private": false, "text": "(In reply to comment #3)\n> -1. Please do not add zillions of random features to the Tomcat native code. If\n> APR supports it, then it's ok, otherwise I don't think this is a good idea.\n> \n\nPlz correct me if I'm wrong on this, but tomcat using APR in order to have the openSSL functionality makes callbacks to tha native code that exists within apache tomcat. So actually for client authentication the function that is used to verify the certs is in sslutils.c :\n/*\n * This OpenSSL callback function is called when OpenSSL\n * does client authentication and verifies the certificate chain.\n */\n\n\nint SSL_callback_SSL_verify(int ok, X509_STORE_CTX *ctx)\n\n\n So i believe this part is responsibility of tomcat (or perhaps i'm getting something totally wrong) (at least the code resides on this branch)\n\n On the side note, i don't think this is a random feature for tomcat, since i haven't found a proper way of reloading the CRL (besides restarting the service) and permitting clients connecting with revoked certificates in not the best case scenario (from a security point of view there must be a good reason for a certificate to be revoked)."}, {"count": 5, "tags": [], "bug_id": 45392, "attachment_id": null, "text": "(In reply to comment #2)\n> Few things, about the patch.\n> 1. Please use 4 spaces instead TAB\n> 2. New files must have ASL 2.0 license header at the top.\n> \n> Please make the patch against the svn trunk.\n\n  I'll fix these issues, create a new patch and upload it here. \n\n> Some documentation would be great if additional setup is required.\n> \n\n  Actually at this time since the patch uses the ocsp server info found in the certificates no further setup is required. If extra functionality is to be introduced (i.e having a default ocsp server) perhaps some additional setup must be made.\n\n> \n> Other then that, the patch is pretty promissing.\n> It would be nice to use the APR for make_socket, but that can be done later.\n> \n\n  I have to find some documentation and/or look on some code on how to use APR for the socket.\n\n Thanks :)\n\n", "id": 118621, "time": "2008-07-14T05:18:15Z", "creator": "arisg@noc.edunet.gr", "creation_time": "2008-07-14T05:18:15Z", "is_private": false}, {"attachment_id": 22253, "tags": [], "creator": "arisg@noc.edunet.gr", "is_private": false, "count": 6, "id": 118631, "time": "2008-07-14T07:01:58Z", "bug_id": 45392, "creation_time": "2008-07-14T07:01:58Z", "text": "Created attachment 22253\nOCSP support for apache tomcat\n\nThe patch created using trunk (14/10/2008 at 16:20 ) adding the licence in the new files and changing the identation to 4 spaces only \n(Hopefully no mistakes :) )"}, {"attachment_id": null, "tags": [], "creator": "mturk@apache.org", "is_private": false, "count": 7, "id": 118635, "time": "2008-07-14T07:13:29Z", "bug_id": 45392, "creation_time": "2008-07-14T07:13:29Z", "text": "OK, thanks for the patch.\nHowever this won't be acceptable until you resolve portability\nissues. The <sys/socket.h, netinet/in.h, etc... are not present on\nall platforms or their functionallity is inside different headers,\nso the APR needs to be used instead.\n\nBTW, the RFC2560 is a cool thing especially cause it's integral part\nof mod_ssl and supported by OpenSSL. Think that APR-zing the needed\nstuff won't be that hard. \n\nRegards"}, {"attachment_id": 22272, "tags": [], "creator": "arisg@noc.edunet.gr", "is_private": false, "count": 8, "id": 118761, "time": "2008-07-17T07:52:26Z", "bug_id": 45392, "creation_time": "2008-07-17T07:52:26Z", "text": "Created attachment 22272\nOCSP support for apache tomcat\n\nAdded the APR support. (for the socket communication). Hopefully things are setting into place :)"}, {"attachment_id": null, "tags": [], "creator": "jfclere@gmail.com", "is_private": false, "count": 9, "id": 120133, "time": "2008-08-27T00:59:47Z", "bug_id": 45392, "creation_time": "2008-08-27T00:59:47Z", "text": "apr has a pool for memory allocation.\nCouldn't the malloc,realloc,free be changed to the apr corresponding ones?"}, {"count": 10, "text": "Created attachment 22594\nOCSP support for apache tomcat\n\nThis is a new version of the patch. Everything went to sslutils.c (as asked) and everything is in #ifdef HAVE_OCSP_SSL so that this can be made as compile time option. (i haven't touched anything that has to do with the building procedure).", "bug_id": 45392, "is_private": false, "id": 120672, "time": "2008-09-16T04:39:09Z", "creator": "arisg@noc.edunet.gr", "creation_time": "2008-09-16T04:39:09Z", "tags": [], "attachment_id": 22594}, {"count": 11, "tags": [], "text": "Created attachment 22611\nOCSP support for apache tomcat\n\nA new version of the patch. Removed the malloc/realloc/free calls and replaced them with apr_ calls. For some tests i did it didn't seem to break anything, but i'm not so familliar with APR either :) (I also think that it wasn's such a heavy usage of malloc and free, since it was mainly used for string manipulation).", "is_private": false, "bug_id": 45392, "id": 120792, "time": "2008-09-19T07:13:04Z", "creator": "arisg@noc.edunet.gr", "creation_time": "2008-09-19T07:13:04Z", "attachment_id": 22611}, {"attachment_id": null, "tags": [], "creator": "arisg@noc.edunet.gr", "is_private": false, "count": 12, "id": 162422, "time": "2012-09-26T16:30:06Z", "bug_id": 45392, "creation_time": "2012-09-26T16:30:06Z", "text": "Since this feature has been added to apache tomcat 1.1.23 shouldn't this bug be closed??"}]
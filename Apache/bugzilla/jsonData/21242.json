[{"count": 0, "tags": [], "creator": "multiphasic@comcast.net", "text": "I have been unable to find any documentation on this bug so I am reporting it.\nGiven a page \"index.html\" by appending a \".\" or \"<\" to the name it will render \nanyway ex. \"index.html.\" and \"index.html<\" instead of throwing a page not found \nerror. The problem is this applies to pages that run code as well.\nI am running coldfusion pages \"index.cfm\" with apache and if a trailing \ncharacter is appended to the page the CODE will be displayed as text rather \nthan rendered by coldfusion. This is a BIG security problem.\n\nI have tested apache 2.0.46 fresh install and by itself (no coldfusion) this \nphenomenon occurs.\n\nIf this is a misconfiguration on my part then please inform me, but if you were \nunaware of this then I hope i have helped.\n\nThanks\n- Dave", "id": 39784, "time": "2003-07-01T19:07:50Z", "bug_id": 21242, "creation_time": "2003-07-01T19:07:50Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "laurent@elanor.org", "attachment_id": null, "id": 62881, "time": "2004-09-01T08:31:13Z", "bug_id": 21242, "creation_time": "2004-09-01T08:31:13Z", "is_private": false, "text": "It seems the problem is still present on Apache 2.0.50, with a completely\ndefault install:\n\n127.0.0.1 - - [01/Sep/2004:10:16:25 +0200] \"GET /index.html.var HTTP/1.1\" 200 1494\n127.0.0.1 - - [01/Sep/2004:10:16:28 +0200] \"GET /index.html.var%20 HTTP/1.1\" 200\n1494\n127.0.0.1 - - [01/Sep/2004:10:16:37 +0200] \"GET /index.html.var. HTTP/1.1\" 200 1494\n\nIs there anything to do to avoid it?\nIn my case, it displays the source code of JSP files, which I don't want, of course.\n\nI used a quick workaround, but I'd sure like a definitive solution:\n<FilesMatch \"\\.jsp.*$\">\n  AllowOverride None\n  Deny from all\n</FilesMatch>\n\nSince that might lead to security issues, should a report be done to\nsecurity@apache.org instead of here?\n\nThanks,\n\nLaurent"}, {"count": 2, "tags": [], "bug_id": 21242, "attachment_id": null, "text": "I was forgetting:\nI know that this seems to be rather a Windows \"feature\" than an Apache bug (see\nbelow for command line example).\nHowever, it's still a very different behaviour from Unix Apache, with the same\nconfiguration file, so I'd really appreciate if a solution could be found.\n\nThanks,\n\nLaurent\n\nC:\\Temp>echo test > test.txt\n\nC:\\Temp>dir test.*\n Volume in drive C has no label.\n Volume Serial Number is 1446-92E5\n\n Directory of C:\\Temp\n\n01/09/2004  10:35                    7 test.txt\n               1 File(s)              7 bytes\n               0 Dir(s)  10 440 631 296 bytes free\n\nC:\\Temp>more test.txt\ntest\n\nC:\\Temp>more test.txt....\ntest\n\nC:\\Temp>more \"test.txt....    ....\"\ntest\n\nC:\\Temp>more \"test.txt....    ....a\"\nCannot access file C:\\Temp\\test.txt....    ....a\n", "id": 62882, "time": "2004-09-01T08:41:47Z", "creator": "laurent@elanor.org", "creation_time": "2004-09-01T08:41:47Z", "is_private": false}, {"count": 3, "tags": [], "creator": "slive@apache.org", "text": "What are you doing to activate your jsp pages?", "id": 62902, "time": "2004-09-01T13:28:53Z", "bug_id": 21242, "creation_time": "2004-09-01T13:28:53Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 21242, "attachment_id": null, "text": "I'm using the JK2 connector, and specifically that Location directive to have\nJSPs handled by Tomcat:\n\n  <Location \"/directory/*.jsp\">\n    JkUriSet worker ajp13:localhost:8009\n  </Location>\n\nI'm don't think the problem is only for JSP, though, it just happens to be what\nI'm using.", "id": 62903, "time": "2004-09-01T13:53:23Z", "creator": "laurent@elanor.org", "creation_time": "2004-09-01T13:53:23Z", "is_private": false}, {"count": 5, "tags": [], "text": "No, the problem is with the use of the <Location> section, which\nshould *never* be used to restrict access to something in the\nfilesystem.  (You are using it to restrict access in the sense that\nyou are preventing access to the source code.)  You could probably get\nthe source code simply by requesting files.JSP with your configuration.\n\nTry this instead:\n<Directory /full/path/to/directory>\n<Files *.jsp>\nJkUriSet worker ajp13:localhost:8009\n</Files>\n</Directory>\n(I haven't tested this myself, but it should be closer.)", "attachment_id": null, "bug_id": 21242, "id": 62910, "time": "2004-09-01T15:22:16Z", "creator": "slive@apache.org", "creation_time": "2004-09-01T15:22:16Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 21242, "attachment_id": null, "text": "Please note that I followed the official JK2 documentation in doing so:\nhttp://jakarta.apache.org/tomcat/connectors-doc/jk2/jk2/vhosthowto.html#APPENDIX%20A:%20httpd.conf\n\nI tried your config, .jsp are interpreted by Tomcat, but source is still\ndisplayed with .jsp%20\n\nI tried with .JSP, it does not work in either config. With each, Apache send it\nto Tomcat, and Tomcat gives a 404.\n\nI tried with .JSP%20, it does display the source, with both configs.\n\nAnd of course, even without JSPs, I'd expect Apache to return a 404 when trying\nto access .html%20\n\nI think that the problem arise because Apache does not consider that\nindex.jsp%20 is matched by *.jsp, and therefore, does not send it to Tomcat, but\nserves it itself.\nIf it did send it, the problem would be less annoying, since I'd probably get a\n404 from Tomcat.\n\nTomcat seems to be more restrictive than Apache. I remember that Tomcat used to\ndisplay the source with an extra %20, too, but that was fixed long ago. I also\nnoticed at the time that it did not change on my system, but I wasn't so sure\nwhether it was Tomcat, Apache, or the connector, and didn't get an answer. So I\nfound a workaround.\n\n", "id": 62912, "time": "2004-09-01T15:46:19Z", "creator": "laurent@elanor.org", "creation_time": "2004-09-01T15:46:19Z", "is_private": false}, {"count": 7, "tags": [], "creator": "jwoolley@apache.org", "attachment_id": null, "id": 62913, "time": "2004-09-01T15:54:51Z", "bug_id": 21242, "creation_time": "2004-09-01T15:54:51Z", "is_private": false, "text": "I believe it would have to be something more like this:\n\n<Directory /full/path/to/directory>\nDeny from all\n<Files *.jsp>\nJkUriSet worker ajp13:localhost:8009\nAllow from all\n</Files>\n</Directory>\n\nGive that a shot, please.\n\nThanks,\nCliff"}, {"count": 8, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "id": 62915, "time": "2004-09-01T17:28:13Z", "bug_id": 21242, "creation_time": "2004-09-01T17:28:13Z", "is_private": false, "text": "Laurent, the JK2 documentation is wrong.  <Location> should not be used in this\nway.  In addition, I'm not really sure it is Apache's responsibility to decide\nwhat kind of requests it will pass to the filesystem and what kind it won't.\n\nOn the other hand, apache should be canonicalizing the filename before it\nmatches agains <Directory> and <Files> sections.  I'm not sure why that is not\nhappening.\n\nCliff's solution may work (especially with an \"Order deny,allow\" directive\nadded), but I don't think that should be necessary."}, {"count": 9, "tags": [], "creator": "wrowe@apache.org", "text": "This bug was addressed in httpd some time ago for filesystem content.\nbut it does not appear you are using the httpd-2.0 filesystem handler;\n\n  \"I am running coldfusion pages \"index.cfm\" with apache and if a trailing \n   character is appended to the page\"\n\nAppears that this is a bug in cold fusion.\n\nEven if we add a new RequireCanonicalPath to enforce the exact path\nname (case sensitively, which will break much win32 web content), this\ncan always occur in a third party module, e.g. cgi arguments and non-httpd\nfilesystem handlers.\n\nIf you like, file an enhancement request to restrict filenames to their\nexact name from their directory entries.  Recogize this might not solve\nevery problem, but i'll be happy to hack it together and let you look\nat it.", "id": 62916, "time": "2004-09-01T17:46:01Z", "bug_id": 21242, "creation_time": "2004-09-01T17:46:01Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "slive@apache.org", "text": "Thanks Bill.  I should have tested this myself... It does in fact seem to work\ncorrectly with no third-party modules.\n\nI think a RequireCanonicalPath would be a good idea, in the sense that I see\nmany people incorrectly using Location/Alias/ScriptAlias etc on case-insensitive\nfile systems.  But unfortunately, the people doing this would probably never\nthink to activate such a directive.  And it would probably create tons of\nproblems to make it the default.", "id": 62917, "time": "2004-09-01T17:55:57Z", "bug_id": 21242, "creation_time": "2004-09-01T17:55:57Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "laurent@elanor.org", "attachment_id": null, "id": 62918, "time": "2004-09-01T18:08:03Z", "bug_id": 21242, "creation_time": "2004-09-01T18:08:03Z", "is_private": false, "text": "Two points here:\n\n> Appears that this is a bug in cold fusion.\n\nIf it's the same as me, certainly not, because Apache never handles the data to\nthe other party (Tomcat in my case). It serves the data itself.\n\n> Even if we add a new RequireCanonicalPath to enforce the exact path\n> name (case sensitively, which will break much win32 web content)\n\nI understand that, but then, I think there is a need of a better understanding\nbetween Apache.org sub-projects, because Tomcat does seem to enforce\ncase-sensitivity on Windows (index.jsp works, index.JSP doesn't, and displaying\nthe code with %20 was considered a bug in Tomcat).\n\nSimilar as to why one is installing in \"Apache Group\", and the other in \"Apache\nSoftware Foundation\", I guess :-)\n\nBeside, I'm probably not the only one using Location in that same way, since\nthis is the only example given by the very little JK2 doc.\n\nBut anyway, if I've got it working like that, I'll just point it out in my own\ninternal documentation.\n\nThanks for your help!"}, {"count": 12, "tags": [], "creator": "laurent@elanor.org", "text": "Cliff solution's does not seem to work, unless I messed up something:\ninstead, the source of the code is always served, whether there is a %20 or not,\nand Tomcat never gets anything to do.\n\nBelow is what I'm using as configuration, in case anybody is interested.\nAs for me, since I don't have the possibility to use a Unix system (I wish :-(\n), I think I'll get back to the officially documented bad way that works, rather\nthan the unofficial one that does not.\n\nIt's really harder than it looks to handle interaction of two Apache projects\nthat interprets filenames in opposed ways. If my management knew, they'd ask for\nswitch to IIS, and it wouldn't be me anymore tinkering with that server :-)\n\nThanks for your help, I really appreciate it. It's just that this thing has been\nin production for more than a year, and I thought I had perfectly RTFMed, and it\nappears now that the FM was wrong, and I have to start changing all the\nconfiguration...\n\n<VirtualHost host_ip_address>\n  ServerName host.name.com\n  ServerAlias host\n\n  DocumentRoot \"c:/ROOT\"\n\n  <Directory \"c:/ROOT\">\n    Options none\n    AllowOverride None\n    Order allow,deny\n    Allow from all\n  </Directory>\n\n  Alias \"/directory\" \"C:/directory\"\n\n  <Directory \"C:/directory\">\n    Options None\n    AllowOverride None\n    Order allow,deny\n    Deny from all\n\n    <Files *.jsp>\n      JkUriSet worker ajp13:localhost:8009\n      Allow from all\n    </Files>\n  </Directory>\n\n</VirtualHost>", "id": 62950, "time": "2004-09-02T08:27:35Z", "bug_id": 21242, "creation_time": "2004-09-02T08:27:35Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 21242, "attachment_id": null, "text": "I understand your frustration, but a couple notes:\n\n1. You're very unlikely to get any action around here by threatening to switch\nto IIS ;-)\n\n2. I've verified that <Files *.ext> matches a request for filename.ext%20 when\nno third-party modules are used, so you should really report this bug to the jk2\ndevelopers.\n\n3. I'd be happy to help with work-arounds, but not here.  Try the\nusers@httpd.apache.org mailing list.\n\nJoshua.", "id": 62956, "time": "2004-09-02T13:23:54Z", "creator": "slive@apache.org", "creation_time": "2004-09-02T13:23:54Z", "is_private": false}]
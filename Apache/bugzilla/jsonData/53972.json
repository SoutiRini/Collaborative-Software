[{"count": 0, "tags": [], "bug_id": 53972, "attachment_id": 29450, "id": 162590, "time": "2012-10-05T15:23:36Z", "creator": "mymuss@gmail.com", "creation_time": "2012-10-05T15:23:36Z", "is_private": false, "text": "Created attachment 29450\nFix for DV exception if PLV records exists in XLS\n\nAt least in some cases Microsoft Excel for Mac adds a PLV record that is not recognized by POI (record type 0x8C8). If that happens the HSSFSheet.addValidationData() call throws the following exception:\n\njava.lang.IllegalStateException: Unexpected (org.apache.poi.hssf.record.UnknownRecord) while looking for DV Table insert pos\n        at org.apache.poi.hssf.model.RecordOrderer.findDataValidationTableInsertPos(RecordOrderer.java:311)\n        at org.apache.poi.hssf.model.RecordOrderer.findSheetInsertPos(RecordOrderer.java:99)\n        at org.apache.poi.hssf.model.RecordOrderer.addNewSheetRecord(RecordOrderer.java:93)\n        at org.apache.poi.hssf.model.InternalSheet.getOrCreateDataValidityTable(InternalSheet.java:1629)\n        at org.apache.poi.hssf.usermodel.HSSFSheet.addValidationData(HSSFSheet.java:371)\n\nReproducible in POI 3.8 as well as 3.9-beta1.\n\nA patch that fixes the problem in 3.9-beta1 is attached."}, {"count": 1, "tags": [], "text": "Can you attach a file that results in the exception ? The proposed fix looks good but I'd like to back it by a unit test.\n\nYegor", "is_private": false, "id": 162663, "creation_time": "2012-10-10T11:57:15Z", "time": "2012-10-10T11:57:15Z", "creator": "yegor@dinom.ru", "bug_id": 53972, "attachment_id": null}, {"count": 2, "tags": [], "text": "changing status to NEEDINFO until a test file is provided", "is_private": false, "bug_id": 53972, "id": 162963, "time": "2012-10-26T13:50:24Z", "creator": "yegor@dinom.ru", "creation_time": "2012-10-26T13:50:24Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "mymuss@gmail.com", "text": "This issue still exists in 3.9 as well as 4.0-dev. I'm attaching a new patch that now includes a unit test as well as a sample Excel file that breaks unpatched builds of POI but passes on the 4.0-dev patched. The 3.9-dev patched has been deployed to our production systems about six months ago and we hadn't had of any issues since then.\n\nI was unable to recreate the problem in a brand new spreadsheet so I'm attaching one of the actual spreadsheets used in our application with sensitive information redacted. The binary file is not in the diff, it's a separate attachement, please put into test-data/spreadsheet/ directory.", "id": 166519, "time": "2013-04-10T18:40:47Z", "bug_id": 53972, "creation_time": "2013-04-10T18:40:47Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "mymuss@gmail.com", "text": "Created attachment 30177\nSample spreadsheet that breaks unpatched version of POI for unit test.\n\nPlease put into test-data/spreadsheet/ directory before running unit tests.", "id": 166520, "time": "2013-04-10T18:42:48Z", "bug_id": 53972, "creation_time": "2013-04-10T18:42:48Z", "is_private": false, "attachment_id": 30177}, {"count": 5, "tags": [], "bug_id": 53972, "attachment_id": 30178, "is_private": false, "id": 166522, "time": "2013-04-10T18:44:13Z", "creator": "mymuss@gmail.com", "creation_time": "2013-04-10T18:44:13Z", "text": "Created attachment 30178\nFix for DV exception when PLV record exists in XLS, includes unit tests"}, {"count": 6, "tags": [], "bug_id": 53972, "text": "Thanks, patch applied in r1496499.", "id": 168037, "time": "2013-06-25T14:48:36Z", "creator": "apache@gagravarr.org", "creation_time": "2013-06-25T14:48:36Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 18339, "attachment_id": null, "text": "I'm developing an Apache 2.0 module for EPP (see\nhttp://sourceforge.net/projects/aepps), which also utilizes mod_ssl. The calling\npatters thus are likely to be different than with HTTP. \n\nProblem description: When the SSL-negotiation fails (missing client cert, server\nconfig error, ...), the connection is closed TCP-wise, but this is not\ncommunicated to the connection handler, and any further reads (i.e.\nap_get_brigade) will cause a core dump.\n\nI've nailed the problem down to the state-handling of an abandoned connection.\nIn ssl_io_filter_input there is the following code-fragment:\n    if (f->c->aborted) {\n        /* XXX: Ok, if we aborted, we ARE at the EOS.  We also have\n         * aborted.  This 'double protection' is probably redundant,\n         * but also effective against just about anything.\n         */\nwhich makes a lot of sense. I seem to run into a case where c->aborted is not\nset even though the connection has been aborted. The error seems to be within\nssl_filter_io_shutdown, where c->aborted is *not* touched (in my case, nobody is\nsetting c->aborted to true). The following patch seems to fix the problem for me:\n\n--- httpd-2.0.44/modules/ssl/ssl_engine_io.c    Mon Jan 13 18:35:22 2003\n+++ httpd-2.0.44/modules/ssl/ssl_engine_io.c.new        Tue Mar 25 21:07:47 2003\n@@ -997,6 +997,7 @@\n     SSL_free(ssl);\n     sslconn->ssl = NULL;\n     filter_ctx->pssl = NULL; /* so filters know we've been shutdown */\n+    c->aborted = 1;\n\n     return APR_SUCCESS;\n }\n\nPlease apply it (or anything you think is more appropriate) against the CVS.\n\nThanks.\n\n/ol", "id": 33789, "time": "2003-03-25T20:28:34Z", "creator": "lendl@nic.at", "creation_time": "2003-03-25T20:28:34Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "jorton@redhat.com", "text": "Some patches related to this problem just got checked in to CVS - can you try\nand  reproduce this problem against CVS HEAD?", "id": 41073, "time": "2003-07-21T14:06:49Z", "bug_id": 18339, "creation_time": "2003-07-21T14:06:49Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 18339, "is_private": false, "id": 42247, "attachment_id": null, "creator": "lendl@nic.at", "creation_time": "2003-08-06T11:35:57Z", "time": "2003-08-06T11:35:57Z", "text": "I did a test with the snapshot httpd-2.0_20030806041205.tar.gz and it looks fine.\n\nBugID 15057 is still able to crash the server, though.\n\n/ol"}]
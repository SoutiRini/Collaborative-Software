[{"count": 0, "attachment_id": null, "creator": "cam@apache.org", "text": "These should be easy to implement, and would provide a way to navigate to a different document programmatically.", "id": 121804, "time": "2008-10-22T23:12:50Z", "bug_id": 46072, "creation_time": "2008-10-22T23:12:50Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 46072, "attachment_id": 22786, "id": 121979, "time": "2008-10-28T20:54:16Z", "creator": "gwadej@anomaly.org", "creation_time": "2008-10-28T20:54:16Z", "is_private": false, "text": "Created attachment 22786\nFirst attempt patch to allow changing location with script.\n\nI implemented the suggestions made by Cameron McCormack in hopes of giving the ability to assign to window.location to load a new file.\n\nTo complete this change, I would need to make a wrapper class for the location (I think) to make it scriptable and return it from getLocation(). Then I could implement the assign() and reload() methods.\n\nHowever, this is functional and some feedback/review of the implementation is appreciated."}, {"count": 2, "tags": [], "bug_id": 46072, "text": "(In reply to comment #1)\n> Created an attachment (id=22786) [details]\n> First attempt patch to allow changing location with script.\n\nCool! :-)\n\n\n\n> + * @version $Id: Loaction.java$\n\nSounds like a typo.\n\n\n\n> null == location\n\nI'd suggest the reverse (location == null) as it's more intuitive and seems to match the code \n\n\n\n> +     * @param url A string containing the URL where the user agent should\n> +     *    navigate.\n\n\"should navigate [to].\"? ;-)\n\n\n\n> However, this is functional and some feedback/review of the implementation is\n> appreciated. \n\nIntuitively it looks well, and I may help testing whenever/if this makes it into the trunk and/or if someone with more expertise (such as Cameron or Thomas, for example) states this looks good enough (by applying the patch locally). Sorry for not being able to provide a deeper review but I'm not that familiar with Batik codebase yet. ;-)", "id": 121986, "time": "2008-10-29T02:40:10Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2008-10-29T02:40:10Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 46072, "attachment_id": null, "id": 122006, "time": "2008-10-29T15:21:14Z", "creator": "gwadej@anomaly.org", "creation_time": "2008-10-29T15:21:14Z", "is_private": false, "text": "(In reply to comment #2)\n> (In reply to comment #1)\n> > Created an attachment (id=22786) [details] [details]\n> > First attempt patch to allow changing location with script.\n> \n> Cool! :-)\n> \n> \n> \n> > + * @version $Id: Loaction.java$\n> \n> Sounds like a typo.\n\nYeah. I've changed my copy. I'll send a new patch once I've got the LocationWrapper thing worked out.\n\n> \n> > null == location\n> \n> I'd suggest the reverse (location == null) as it's more intuitive and seems to\n> match the code \n\nSince 'location == null' seems to be the convention, I'll switch to that. But as an old C, C++, etc. programmer I'd argue that it's not more \"intuitive\".\n(Then again, I've been known to argue that nothing in programming is intuitive, but that's another discussion.<grin/>)\n\n> > +     * @param url A string containing the URL where the user agent should\n> > +     *    navigate.\n> \n> \"should navigate [to].\"? ;-)\n\nI was trying to avoid that for more formal English, but it does make more sense.\nI've changed it in my copy.\n\n> > However, this is functional and some feedback/review of the implementation is\n> > appreciated. \n> \n> Intuitively it looks well, and I may help testing whenever/if this makes it\n> into the trunk and/or if someone with more expertise (such as Cameron or\n> Thomas, for example) states this looks good enough (by applying the patch\n> locally). Sorry for not being able to provide a deeper review but I'm not that\n> familiar with Batik codebase yet. ;-)\n\nThank you for the help. As I said, I'll have a new patch soon.\n"}, {"count": 4, "tags": [], "bug_id": 46072, "text": "Created attachment 22794\nContains the location changes from the previous patch and the new LocationWrapper code.\n\nIn addition to including the previous code changes, this patch fixes the following:\n\n1. Style issues and typos noted in Helder Magalh\u00e3es's review.\n2. Correcting compile issues that I didn't notice because I forgot how Ant handles dependencies.\n3. Addition of new LocationWrapper that allows access to assign(url) and reload() methods on Location object from script as well as assignment through =.\n\nThis appears to cover everything needed to address my issue.\n\nThe change does not refactor the Window class to depend on the Global class as in the 1.2 specification.", "id": 122017, "time": "2008-10-29T20:23:23Z", "creator": "gwadej@anomaly.org", "creation_time": "2008-10-29T20:23:23Z", "is_private": false, "attachment_id": 22794}, {"count": 5, "tags": [], "creator": "gwadej@anomaly.org", "is_private": false, "id": 122018, "creation_time": "2008-10-29T20:25:34Z", "time": "2008-10-29T20:25:34Z", "bug_id": 46072, "text": "Created attachment 22795\nThe real patch including files that were added.\n\nThis is the real patch. I forgot to included added files when I made the other patch.", "attachment_id": 22795}, {"count": 6, "tags": [], "bug_id": 46072, "attachment_id": 22795, "id": 122226, "time": "2008-11-05T19:16:55Z", "creator": "cam@apache.org", "creation_time": "2008-11-05T19:16:55Z", "is_private": false, "text": "Comment on attachment 22795\nThe real patch including files that were added.\n\nHi G. Wade.\n\nThanks for working on the patch.  I have a few comments.  (Some are just style/formatting, and although there isn't a documented coding style, there's a de facto one that most of the code adheres to.)\n\n>Index: sources/org/apache/batik/swing/svg/JSVGComponent.java\n...\n>-        }\n>+        } \n\nLooks like an accidental space on the end of the line, which doesn't need to be there.\n\n>Index: sources/org/apache/batik/bridge/Location.java\n...\n>+        ((UserAgent)bridgeContext.getUserAgent()).loadDocument( url );\n\nNo spaces around \"url\".\n\n>+    public void reload() {\n>+        URL url = ((SVGOMDocument) bridgeContext.getDocument())\n>+                    .getURLObject();\n>+        ((UserAgent)bridgeContext.getUserAgent()).loadDocument( url.toString() );\n\nYou can use getDocumentURI() on AbstractDocument to get the the current document's URI more directly than getting the URL object and converting it to a string.  Note that you'll need to cast the returned Document to AbstractDocument so that the code will compile properly on JDKs that don't have the DOM Level 3 Core interfaces (since getDocumentURI() is a DOM 3 method).\n\nUnnecessary spaces around the loadDocument() argument here, too.\n\n>+    }\n>+\n>+    /**\n>+     * Returns the URL of this location as a String.\n>+     */\n>+    public String toString() {\n>+        URL url = ((SVGOMDocument) bridgeContext.getDocument())\n>+                    .getURLObject();\n>+        return url.toString();\n\nSame as above; use getDocumentURI() instead.\n\n>Index: sources/org/apache/batik/bridge/ScriptingEnvironment.java\n...\n>         public Window(Interpreter interp, String lang) {\n>             interpreter = interp;\n>             language = lang;\n>+            location = null;\n\nThis line is unnecessary, since location will be initialised to null automatically.\n\n>+        public Location getLocation() {\n>+            if( location == null ) {\n\nWrite this as 'if (location == null) {'.\n\n>+                location = new Location( bridgeContext );\n\nRemove the spaces.\n\n>Index: sources/org/apache/batik/script/rhino/WindowWrapper.java\n...\n>+        this.defineProperty(\"location\", WindowWrapper.class,\n>+                            ScriptableObject.PERMANENT );\n\nErrant space before the ')'.\n\n>     /**\n>+     * Return the Location for this Window.\n>+     */\n>+    public LocationWrapper getLocation() {\n>+        return new LocationWrapper( window.getLocation() );\n>+    }\n\nI don't think a wrapper class for the Location object is needed.  Wrapper classes are useful if you need to give the JS object some special behaviour that you can't get from the automatic reflection of Java objects to their JS counterparts.  Since the Location object is just a couple of simple methods, this shouldn't be needed, so you can make this method just return the Location object directly.\n\n>+++ sources/org/apache/batik/script/rhino/LocationWrapper.java\t(revision 0)\n\nThis class then wouldn't be needed.\n\n>Index: sources/org/apache/batik/script/Window.java\n...\n>+import org.w3c.dom.Location;\n\nThis import isn't used.\n\n\nWith these addressed I'd be happy to check in the patch.  I see on http://people.apache.org/~jim/committers.html that you don't have a Contributor License Agreemnt on file (see http://www.apache.org/licenses/#clas).  You'll need to submit one of those before I can commit the patch."}, {"count": 7, "tags": [], "bug_id": 46072, "text": "(In reply to comment #6)\n\nThanks Cameron,\n\nI'll modify the code and update the patch this evening.\n\n> (From update of attachment 22795 [details])\n> Hi G. Wade.\n> \n> Thanks for working on the patch.  I have a few comments.  (Some are just\n> style/formatting, and although there isn't a documented coding style, there's a\n> de facto one that most of the code adheres to.)\n> \n> >Index: sources/org/apache/batik/swing/svg/JSVGComponent.java\n> ...\n> >-        }\n> >+        } \n> \n> Looks like an accidental space on the end of the line, which doesn't need to be\n> there.\n> \n> >Index: sources/org/apache/batik/bridge/Location.java\n> ...\n> >+        ((UserAgent)bridgeContext.getUserAgent()).loadDocument( url );\n> \n> No spaces around \"url\".\n> \n> >+    public void reload() {\n> >+        URL url = ((SVGOMDocument) bridgeContext.getDocument())\n> >+                    .getURLObject();\n> >+        ((UserAgent)bridgeContext.getUserAgent()).loadDocument( url.toString() );\n> \n> You can use getDocumentURI() on AbstractDocument to get the the current\n> document's URI more directly than getting the URL object and converting it to a\n> string.  Note that you'll need to cast the returned Document to\n\nSeems like I tried that and it didn't work. But, I may be misremembering.\n\n> AbstractDocument so that the code will compile properly on JDKs that don't have\n> the DOM Level 3 Core interfaces (since getDocumentURI() is a DOM 3 method).\n> \n> Unnecessary spaces around the loadDocument() argument here, too.\n> \n> >+    }\n> >+\n> >+    /**\n> >+     * Returns the URL of this location as a String.\n> >+     */\n> >+    public String toString() {\n> >+        URL url = ((SVGOMDocument) bridgeContext.getDocument())\n> >+                    .getURLObject();\n> >+        return url.toString();\n> \n> Same as above; use getDocumentURI() instead.\n> \n> >Index: sources/org/apache/batik/bridge/ScriptingEnvironment.java\n> ...\n> >         public Window(Interpreter interp, String lang) {\n> >             interpreter = interp;\n> >             language = lang;\n> >+            location = null;\n> \n> This line is unnecessary, since location will be initialised to null\n> automatically.\n\nHabit. I tend to be explicit about these things. But, I'll change it.\n\n> >+        public Location getLocation() {\n> >+            if( location == null ) {\n> \n> Write this as 'if (location == null) {'.\n> \n> >+                location = new Location( bridgeContext );\n> \n> Remove the spaces.\n> \n> >Index: sources/org/apache/batik/script/rhino/WindowWrapper.java\n> ...\n> >+        this.defineProperty(\"location\", WindowWrapper.class,\n> >+                            ScriptableObject.PERMANENT );\n> \n> Errant space before the ')'.\n> \n> >     /**\n> >+     * Return the Location for this Window.\n> >+     */\n> >+    public LocationWrapper getLocation() {\n> >+        return new LocationWrapper( window.getLocation() );\n> >+    }\n> \n> I don't think a wrapper class for the Location object is needed.  Wrapper\n> classes are useful if you need to give the JS object some special behaviour\n> that you can't get from the automatic reflection of Java objects to their JS\n> counterparts.  Since the Location object is just a couple of simple methods,\n> this shouldn't be needed, so you can make this method just return the Location\n> object directly.\n\nI know I tried that and could not get it to work. Rhino kept reporting that it couldn't find the methods. I'll try it again, maybe I did something stupid. \n\n> >+++ sources/org/apache/batik/script/rhino/LocationWrapper.java\t(revision 0)\n> \n> This class then wouldn't be needed.\n> \n> >Index: sources/org/apache/batik/script/Window.java\n> ...\n> >+import org.w3c.dom.Location;\n> \n> This import isn't used.\n\nOkay.\n\n> With these addressed I'd be happy to check in the patch.  I see on\n> http://people.apache.org/~jim/committers.html that you don't have a Contributor\n> License Agreemnt on file (see http://www.apache.org/licenses/#clas).  You'll\n> need to submit one of those before I can commit the patch.\n\nI'll take care of it tonight. \n\nThanks.\nG. Wade", "id": 122241, "time": "2008-11-06T04:58:04Z", "creator": "gwadej@anomaly.org", "creation_time": "2008-11-06T04:58:04Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 46072, "attachment_id": 22837, "id": 122266, "time": "2008-11-06T18:50:10Z", "creator": "gwadej@anomaly.org", "creation_time": "2008-11-06T18:50:10Z", "is_private": false, "text": "Created attachment 22837\nPatch with corrections for Cameron's comments.\n\nThis contains all of the corrections suggested by Cameron McCormack.\n\nLocationWrapper has been removed and the other changes were made."}, {"count": 9, "tags": [], "bug_id": 46072, "attachment_id": 22837, "id": 122326, "creation_time": "2008-11-09T16:36:39Z", "time": "2008-11-09T16:36:39Z", "creator": "cam@apache.org", "text": "Comment on attachment 22837\nPatch with corrections for Cameron's comments.\n\nThe patch looks good.  Once the CLA has been processed, I'll commit the patch.", "is_private": false}, {"count": 10, "attachment_id": null, "creator": "jeremias@apache.org", "text": "(In reply to comment #9)\n> (From update of attachment 22837 [details])\n> The patch looks good.  Once the CLA has been processed, I'll commit the patch.\n> \n\nFYI: G. Wade Johnson's ICLA has been recorded a few minutes ago.", "id": 122346, "time": "2008-11-10T13:23:57Z", "bug_id": 46072, "creation_time": "2008-11-10T13:23:57Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 46072, "attachment_id": null, "id": 122359, "time": "2008-11-10T22:21:47Z", "creator": "cam@apache.org", "creation_time": "2008-11-10T22:21:47Z", "is_private": false, "text": "Great!  Landed in r712954.\n\nWade, note that I modified the patch very slightly to avoid the unintentional use of covariant return types of getLocation() and getParent() in BaseScriptingEnvironment.Window and ScriptingEnvironment.Window, which caused build failures on JDK 1.4.\n"}, {"count": 12, "tags": [], "bug_id": 46072, "attachment_id": null, "id": 133273, "time": "2010-01-02T13:17:34Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-01-02T13:17:34Z", "is_private": false, "text": "(In reply to comment #11)\n> Great!  Landed in r712954.\n\nShould G. Wade be listed as a contributor [1]? I'd vote so, given the non-trivial contribution.\n\n[1] http://xmlgraphics.apache.org/batik/contributors.html#contributors"}]
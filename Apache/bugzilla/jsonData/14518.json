[{"count": 0, "tags": [], "creator": "michael.teitler@cetelem.fr", "attachment_id": null, "id": 26209, "time": "2002-11-13T18:28:18Z", "bug_id": 14518, "creation_time": "2002-11-13T18:28:18Z", "is_private": false, "text": "Hi,\n\nQUESY_STRING parts is not incorporated <- bad test :\n\n  if (r->args != NULL &&\n      r->uri == r->unparsed_uri) {\n\ninstead of :\n\n  if (r->args != NULL &&\n      r->uri != r->unparsed_uri) {\n\n\nin this code :\n\n  /* make sure the QUERY_STRING and\n   * PATH_INFO parts get incorporated\n   */\n  if (r->path_info != NULL) {\n    r->filename = ap_pstrcat(r->pool, r->filename,\n                             r->path_info, NULL);\n  }\n  if (r->args != NULL &&\n      r->uri == r->unparsed_uri) {\n    /* see proxy_http:proxy_http_canon() */\n    r->filename = ap_pstrcat(r->pool, r->filename,\n                             \"?\", r->args, NULL);\n  }\n\n\nConsequence : GET args lost !\n\nRegards,"}, {"count": 1, "tags": [], "bug_id": 14518, "attachment_id": null, "is_private": false, "id": 26212, "time": "2002-11-13T18:35:49Z", "creator": "wrowe@apache.org", "creation_time": "2002-11-13T18:35:49Z", "text": "*** Bug 14519 has been marked as a duplicate of this bug. ***"}, {"count": 2, "tags": [], "creator": "minfrin@apache.org", "attachment_id": null, "text": "Backported to v2.0.53.\n", "id": 65080, "time": "2004-10-13T17:14:39Z", "bug_id": 14518, "creation_time": "2004-10-13T17:14:39Z", "is_private": false}, {"count": 3, "tags": [], "creator": "minfrin@apache.org", "attachment_id": 13078, "text": "Created attachment 13078\nFix for apache-1.3", "id": 65084, "time": "2004-10-13T18:28:05Z", "bug_id": 14518, "creation_time": "2004-10-13T18:28:05Z", "is_private": false}, {"count": 4, "tags": [], "text": "Fix applied to v1.3.32.", "is_private": false, "bug_id": 14518, "id": 65085, "time": "2004-10-13T18:46:57Z", "creator": "minfrin@apache.org", "creation_time": "2004-10-13T18:46:57Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "This patch totally hosed a reverse proxy install by apparently appending the\nquery string twice. For example:\n\nThe requested URL http://faq.deviantart.com/%3Fkeys=avatar?keys=avatar was not\nfound on this server.\n\nWe're using a RewriteRule with [P] to pass the request to a backend server.", "attachment_id": null, "id": 65574, "creator": "chrisbolt@gmail.com", "time": "2004-10-23T10:19:52Z", "bug_id": 14518, "creation_time": "2004-10-23T10:19:52Z", "is_private": false}, {"count": 6, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "text": "What exactly are your rules?", "id": 65575, "time": "2004-10-23T11:04:23Z", "bug_id": 14518, "creation_time": "2004-10-23T11:04:23Z", "is_private": false}, {"count": 7, "tags": [], "creator": "chrisbolt@gmail.com", "attachment_id": null, "id": 65604, "time": "2004-10-23T19:39:32Z", "bug_id": 14518, "creation_time": "2004-10-23T19:39:32Z", "is_private": false, "text": "RewriteMap server rnd:/usr/local/apache/conf/backend\nRewriteRule ^(http|ftp)://.* - [F]\nRewriteRule ^/(.*)$          http://${server:backend}.da/$1 [P,L]\nRewriteRule .* - [F]\n"}, {"count": 8, "tags": [], "text": "Reopened ", "is_private": false, "bug_id": 14518, "id": 65619, "time": "2004-10-24T19:50:49Z", "creator": "jim@apache.org", "creation_time": "2004-10-24T19:50:49Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "id": 65620, "time": "2004-10-24T20:56:53Z", "bug_id": 14518, "creation_time": "2004-10-24T20:56:53Z", "is_private": false, "text": "So what's the repro case and symptoms of the original bug reported here?  The\npatch seems to only *introduce* the problem?"}, {"count": 10, "text": "My original post http://marc.theaimsgroup.com/?l=apache-httpd-dev&m=109367840100510\n\nattached \"httpd-2.0.50-rewrite-args.patch\" will no longer omit $QUERY_STRINGs\nof \u00c4P\u00dc-proxypassed requests after their rewriting and \u00c4QSA\u00dc possibly merging\na new QUERY_STRING.\n.conf:\n        ServerName 10.10.145.100\n        RewriteEngine on\n        RewriteRule ^/ http://mms2.org/mms-off?operator=oskarmobil.cz \u00c4QSA,P\u00dc\nBefore patch:\n        213.220.235.217 - - \u00c427/Aug/2004:11:45:59 +0200\u00dc \"GET\nhttp://10.10.145.100/?message-id=8326039 HTTP/1.0\" 500 659\n        195.122.208.84 - - \u00c427/Aug/2004:11:45:59 +0200\u00dc \"GET /mms-off HTTP/1.1\"\n500 659\n        (2) init rewrite engine with requested uri /\n        (3) applying pattern '^/' to uri '/'\n        (2) rewrite '/' -> 'http://mms2.org/mms-off?operator=t-mobile.cz'\n        (3) split uri=http://mms2.org/mms-off?operator=t-mobile.cz ->\nuri=http://mms2.org/mms-off, args=operator=t-mobile.cz&message-id=8326039\n        (2) forcing proxy-throughput with http://mms2.org/mms-off\n        (1) go-ahead with proxy request proxy:http://mms2.org/mms-off \u00c4OK\u00dc\n                                                                               \n                                       \nAfter patch:\n        213.220.235.217 - - \u00c427/Aug/2004:13:52:20 +0200\u00dc \"GET\nhttp://10.10.145.100/?message-id=8326039 HTTP/1.0\" 200 221\n        195.122.208.84 - - \u00c427/Aug/2004:13:52:20 +0200\u00dc \"GET\n/mms-off?operator=oskarmobil.cz&message-id=8326039 HTTP/1.1\" 200 221\n        (2) init rewrite engine with requested uri /\n        (3) applying pattern '^/' to uri '/'\n        (2) rewrite '/' -> 'http://mms2.org/mms-off?operator=oskarmobil.cz'\n        (3) split uri=http://mms2.org/mms-off?operator=oskarmobil.cz ->\nuri=http://mms2.org/mms-off, args=operator=oskarmobil.cz&message-id=8326039\n        (2) forcing proxy-throughput with http://mms2.org/mms-off\n        (1) go-ahead with proxy request\nproxy:http://mms2.org/mms-off?operator=oskarmobil.cz&message-id=8326039 \u00c4OK\u00dc\n                                                                               \n                                       \nThe fix just follows the suggested /* see proxy_http:proxy_http_canon() */.\nPatch applies both to httpd-2.0.50 and httpd-2.1 CVS.\n", "creator": "web-nagoya.apache.org@jankratochvil.net", "attachment_id": null, "id": 65623, "time": "2004-10-25T00:52:51Z", "bug_id": 14518, "creation_time": "2004-10-25T00:52:51Z", "tags": [], "is_private": false}, {"attachment_id": 13211, "tags": [], "bug_id": 14518, "is_private": false, "count": 11, "id": 65624, "time": "2004-10-25T00:53:47Z", "creator": "web-nagoya.apache.org@jankratochvil.net", "creation_time": "2004-10-25T00:53:47Z", "text": "Created attachment 13211\nhttpd-2.0.50-rewrite-args.patch"}, {"count": 12, "tags": [], "text": "Nothing new but I want to confirm the report from Chris Bolt.\n\nThis bug introduced in Apache 1.3.32 is very annoying for us so we must\ndowngrade to Apache 1.3.31!\n\nWe built apache 1.3.32 on a linux machine (SuSE 9.1) in the old fashion (using\nthe src/Configure script) with only adding\n\n  AddModule modules/standard/mod_rewrite.o\n  AddModule modules/proxy/libproxy.a\n\ninto the standard file src/Configuration.\n\nThe Apache serves as an proxy to an Hyperwave server (www.my.dom) and the\nimportant rules from the httpd.conf seems to be\n\nRewriteRule  ^/dlr/(.*)$      http://www.my.dom/dlr/$1 [P,NC]\nRewriteRule  ^/dlr;(.*)$      http://www.my.dom/dlr;$1 [P,NC]\nRewriteRule  ^/dlr$           http://www.my.dom/dlr    [P,NC]\n\nHere are typical log entries showing the doubling of the arguments:\n\nApache 1.3.32\n=============\n[26/Oct/2004:11:04:32 +0200] \"GET /dlr/foo?bar HTTP/1.1\" 404 538\n\nHyperwave-Server:\n=================\n[26/Oct/2004:11:04:32 +0200] \"GET /dlr/foo%3Fbar?bar HTTP/1.1\" 404 538", "attachment_id": null, "id": 65708, "creator": "Jens.Schleusener@t-systems.com", "time": "2004-10-26T11:05:59Z", "bug_id": 14518, "creation_time": "2004-10-26T11:05:59Z", "is_private": false}, {"count": 13, "tags": [], "creator": "mark_round@ipcmedia.com", "attachment_id": null, "id": 65731, "time": "2004-10-26T14:35:11Z", "bug_id": 14518, "creation_time": "2004-10-26T14:35:11Z", "is_private": false, "text": "Just wanted to add that we're also seeing this (at least, I presume that's what\nthe problem is). \n\nWe're using \n\nRewriteRule ^/(.*\\.jsp)   http://localhost:8080/$1  [QSA,P,L]\n\nto forward jsp requests to an iPlanet server, and after upgrading to 1.3.32, we\nget the following in the iPlanet logs :\n\n[26/Oct/2004:14:58:20] warning (15794): for host 127.0.0.1 trying to GET\n/home.jsp?tem=ybw, send-file reports: HTTP4142: can't find\n/sites/docroot/home.jsp?tem=ybw (File not found)\n\nWhich I assume is iPlanet getting a request for the entire URL-encoded GET\nstring and treating it as the filename. Had to roll back to 1.3.31 as it brought\nour whole site down, and everything seems fine now we're back on the previous\nversion.\n\n-Mark \n"}, {"attachment_id": null, "tags": [], "bug_id": 14518, "is_private": false, "count": 14, "id": 65809, "time": "2004-10-27T09:17:55Z", "creator": "web-nagoya.apache.org@jankratochvil.net", "creation_time": "2004-10-27T09:17:55Z", "text": "Patch to be IMO backout from 1.3.x.\nStill it was appropriate for 2.0.x.\n"}, {"count": 15, "tags": [], "bug_id": 14518, "attachment_id": null, "id": 66085, "time": "2004-10-29T15:45:25Z", "creator": "bradyb@arl.army.mil", "creation_time": "2004-10-29T15:45:25Z", "is_private": false, "text": "I'm seeing this problem as well...it broke all of our reverse proxies.  I was\nhoping this would be fixed in 1.3.33, but doesn't look like it made it in.\n\nI'm no C guru...is there a patch out there to revert the change made to \"fix\"\nthis bug? \n\nThanks,\n\nBrady "}, {"count": 16, "tags": [], "bug_id": 14518, "attachment_id": null, "is_private": false, "id": 66093, "time": "2004-10-29T16:01:21Z", "creator": "jorton@redhat.com", "creation_time": "2004-10-29T16:01:21Z", "text": "The regression caused by this change has been fixed in 1.3.33.\n\nThe bug originally described here only triggers using a combination of QSA and P\nin a RewriteRule, by my undestanding. This bug report remains open until that\ncan be fixed without causing regressions."}, {"attachment_id": null, "tags": [], "bug_id": 14518, "is_private": false, "count": 17, "id": 66094, "time": "2004-10-29T16:03:22Z", "creator": "nd@perlig.de", "creation_time": "2004-10-29T16:03:22Z", "text": "It was backed out in 1.3.33."}, {"count": 18, "tags": [], "creator": "mz@incunabulum.de", "attachment_id": null, "id": 73904, "time": "2005-04-21T15:34:16Z", "bug_id": 14518, "creation_time": "2005-04-21T15:34:16Z", "is_private": false, "text": "Is this bug still valid? \n\nI do see similar to Chris Bolt's report symptoms on Apache 1.3.33. I. e. the\narguments behind the ? are doublicated upon rewrite. This is a tentative\nquestion. I do see these symptoms on a webhosting server we have no root access\nto. But it is as close a bug I could find to what I have.\n\nAny comment, whether this might be the issue?\n\n"}, {"attachment_id": null, "tags": [], "bug_id": 14518, "is_private": false, "count": 19, "id": 73905, "time": "2005-04-21T15:56:51Z", "creator": "jorton@redhat.com", "creation_time": "2005-04-21T15:56:51Z", "text": "Yes, this is still an issue in all releases but 2.1.x, I believe."}, {"count": 20, "tags": [], "text": "After our problems with the 1.3.32 release, the issue was resolved for us when\nthe patch was backed out in 1.3.33 (I posted the comment mentioning problems\nwith iPlanet). I can't comment on any of the 2.x series, as we're entirely a\n1.3.x shop at the moment. Perhaps the issue is due to a bad RewriteRule directive ?", "attachment_id": null, "id": 73909, "creator": "mark_round@ipcmedia.com", "time": "2005-04-21T16:35:12Z", "bug_id": 14518, "creation_time": "2005-04-21T16:35:12Z", "is_private": false}, {"count": 21, "tags": [], "text": "The rewrite rule is identical with the one I use on an apache 1.3.2x\ninstallation, where this rewrite rule works perfectly. And I am not the only one\nusing this rule. The rewrite rule is:\n\nRewriteEngine On\nRewriteRule ^(.*)\nhttp://cms-server:8089/VirtualHostBase/http/http-server:80/maring/VirtualHostRoot/$1\n[L,P]\n\nWhat I see is that the \"arguments\" after the ? are doublicated. I. E.\nwww.server.com?something=foo gives something like\nserver.com?something=foo?something=foo.\n\nI do see this on an apache 1.3.33 installation. Correct me, if our problem is no\nt related to this bug. With the following rewrite rule it works as expected,\nstrange :-)\n\n\nRedirectMatch (.*)\nhttp://sassnitz.fms.uni-rostock.de:8089/VirtualHostBase/http/www.mar-ing.com:80/maring/VirtualHostRoot$1\n\n\n", "is_private": false, "bug_id": 14518, "id": 73939, "time": "2005-04-22T08:45:27Z", "creator": "mz@incunabulum.de", "creation_time": "2005-04-22T08:45:27Z", "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 14518, "attachment_id": null, "is_private": false, "id": 73940, "time": "2005-04-22T08:48:01Z", "creator": "mz@incunabulum.de", "creation_time": "2005-04-22T08:48:01Z", "text": "Sorry, the second rewriteMatch rule works, but also redirects the browser to the\nother site completely. So, this is not what we want."}, {"count": 23, "tags": [], "creator": "web-nagoya.apache.org@jankratochvil.net", "attachment_id": null, "id": 80080, "time": "2005-09-18T00:08:46Z", "bug_id": 14518, "creation_time": "2005-09-18T00:08:46Z", "is_private": false, "text": "I just had to remove this custom patch add-on from Fedora Core 4\nhttpd-2.0.54-10.2 as it was duplicating the arguments for me now. I expect it is\nnot directly version dependent but more dependent on the present modules and\nconfiguration directives.\n"}, {"count": 24, "tags": [], "creator": "slight_@hotmail.com", "attachment_id": null, "id": 83842, "time": "2005-12-20T13:48:24Z", "bug_id": 14518, "creation_time": "2005-12-20T13:48:24Z", "is_private": false, "text": "I'd just like to confirm that we're seeing the same behaviour described in #5\nusing mod_rewrite and proxying on 1.3.33\n\nThe following (in a .htaccess)\n\n\nRewriteCond %{SERVER_PORT}  !^81$\nRewriteRule ^(.*)$          http://%{HTTP_HOST}:81%{REQUEST_URI} [R,L]\n\n\na request to \"/admin/?cmd=CheckRenderStatus\" on the port 80 (proxying) Apache\ngenerates the following in the target Apache's (port 81) access logs:\n\n\n\"GET /admin/%3Fcmd=CheckRenderStatus?cmd=CheckRenderStatus HTTP/1.1\""}, {"count": 25, "tags": [], "bug_id": 14518, "attachment_id": null, "id": 83844, "time": "2005-12-20T13:50:30Z", "creator": "slight_@hotmail.com", "creation_time": "2005-12-20T13:50:30Z", "is_private": false, "text": "Apologies, the rule in the previous post should read:\n\n\nRewriteCond %{SERVER_PORT}  !^81$\nRewriteRule ^(.*)$          http://%{HTTP_HOST}:81%{REQUEST_URI} [P,L]\n\n\nI had just changed it from P to R to check that using redirect instead of proxy\nworks as expected (it does)."}, {"count": 26, "tags": [], "creator": "web-nagoya.apache.org@jankratochvil.net", "attachment_id": null, "id": 83845, "time": "2005-12-20T13:56:55Z", "bug_id": 14518, "creation_time": "2005-12-20T13:56:55Z", "is_private": false, "text": "It is 2.x related but I hope it is worth mentioning here too: I had\ndouble-escaping problems exactly while using redirects. Currently successfully\nusing on Fedora Core httpd-2.0.54-10.2 this workaround:\nRewriteMap unescape int:unescape\nRewriteRule ^sw(|/.*)$\nhttp://%{SERVER_NAME}/project$1?${unescape:%{QUERY_STRING}} [R=301,L]\n\nThe important part there is: ?${unescape:%{QUERY_STRING}}\n"}, {"count": 27, "tags": [], "text": "I have struggled for a long time with mod_rewrite trying to pass on query \nstring arguments to a backend proxy. In my case my backend proxy server uses \nmod_perl to generate dynamic content. As a tool to allow the backend server to \nretrieve the query string arguments without relying on mod_rewrite to \ncorrectly pass them on I patched mod_proxy to create an \"X-Forwarded-Uri\" \nheader which contains the unparsed URI. I had requested a long time ago to add \nthis feature to the official release since I'm sure this could help a lot of \npeople. I hope that somebody on this list can persuade whoever has the power \nto make such a change.\n\nHere is a link to the mailing list archive with my suggestion:\n\nhttp://mail-archives.apache.org/mod_mbox/www-modproxy-dev/200312.mbox/%\n3cPine.LNX.4.21.0312191653140.28629-100000@alpha.fysix.com%3e\n\nFor your convenience here is a copy:\n\nI would like to request a feature regarding the\nX-Forwarded headers. I would like one more of those,\ncalled X-Forwarded-Uri which contains the original\nunparsed URI. This could be simply achieved by the following\nline added to proxy_http.c:\n\n  ap_table_mergen(req_hdrs, \"X-Forwarded-Uri\", r->unparsed_uri);\n\nThis could be added where all the other X-Forwarded\nheaders are defined. It would be great to see this feature\nin the official release.\n\nI am using this with mod_perl in the classic front-end / back-end\nserver setup such that the back-end mod_perl server can\nuse the info about the original URI while the front-end\nserver performs some URI rewriting. Maybe this feature\ncould be of general benefit.\n\nThanks,\nMarcus\n\n", "attachment_id": null, "id": 84207, "creator": "marcus@fysix.com", "time": "2006-01-04T16:18:03Z", "bug_id": 14518, "creation_time": "2006-01-04T16:18:03Z", "is_private": false}, {"count": 28, "tags": [], "text": "(In reply to comment #27)\n> I have struggled for a long time with mod_rewrite trying to pass on query\n> string arguments to a backend proxy.\n...\n> I patched mod_proxy to create an \"X-Forwarded-Uri\" header which contains the\n> unparsed URI.\n\nThis header looks only as a mod_rewrite bug workaround - isn't it better (only\nallowed to go mainstream) to rather fix the bug in the first place?\n", "attachment_id": null, "id": 84343, "creator": "web-nagoya.apache.org@jankratochvil.net", "time": "2006-01-08T19:04:42Z", "bug_id": 14518, "creation_time": "2006-01-08T19:04:42Z", "is_private": false}, {"count": 29, "tags": [], "text": "It seems like this bug is fixed in recent releases.  Apache HTTP Server 1.3.x is not supported anymore and no bugs will be fixed in the old codebase (cf. <http://mail-archives.apache.org/mod_mbox/httpd-announce/201002.mbox/%3C20100203000334.GA19021@infiltrator.stdlib.net%3E>). Since this bug seems to affect only 1.3.x, I'm closing it as WONTFIX.\n\nIf this bug still affects you in a recent version (version 2.2.x or the upcoming version 2.4), please open a new bug.\n\nThank you for reporting the bug.", "is_private": false, "bug_id": 14518, "id": 145161, "time": "2011-03-21T11:14:09Z", "creator": "mss@apache.org", "creation_time": "2011-03-21T11:14:09Z", "attachment_id": null}]
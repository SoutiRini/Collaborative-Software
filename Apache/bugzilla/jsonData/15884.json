[{"count": 0, "tags": [], "bug_id": 15884, "text": "Some ISAPI extensions do not specify Content-Type header.\n'Content-type: application/octet-stream' header is added to an ISAPI extension \nresponse, if file (i.e. dll) extension of that module falls into 'binaries' \ncategory, so forcing some browsers (i.e. Netscape, Mozilla) to download \ngenerated HTML code instead of displaying it.\n\nSuggestion for solution: set Content-Type header to the DefaultType \nconfiguration value. \nAdd the lines below to isapi_handler function in \\modules\\arch\\win32\n\\mod_isapi.c (just before calling ISAPI HttpExtensionProc handler):\n\n\t/* Set Content-Type header to the 'DefaultType' configuration value */\n\t/* instead of passed 'application/octet-stream' value */\n\tap_set_content_type(r, NULL);\n\nAnother suggestion for solution: do not automatically add Content-Type header \nfor an ISAPI extension response.\n\nMicrosoft way:\n[Mapping a File Extension to Content-Type] The Web server will not \nautomatically add a Content-Type: header for ISAPI extensions, filters, or ASP \npages. It is the script's responsibility to set this value, if desired.\n\nExcerpt from RFC 2616 (HTTP/1.1), section 7.2.1:\nAny HTTP/1.1 message containing an entity-body SHOULD include a Content-Type \nheader field defining the media type of that body. If and only if the media \ntype is not given by a Content-Type field, the recipient MAY attempt to guess \nthe media type via inspection of its content and/or the name extension(s) of \nthe URI used to identify the resource. If the media type remains unknown, the \nrecipient SHOULD treat it as type \"application/octet-stream\".", "id": 29004, "time": "2003-01-08T11:27:20Z", "creator": "laimis@tic.lt", "creation_time": "2003-01-08T11:27:20Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "laimis@tic.lt", "is_private": false, "id": 29007, "time": "2003-01-08T12:51:30Z", "bug_id": 15884, "creation_time": "2003-01-08T12:51:30Z", "tags": [], "text": "'AddType text/html .dll' configuration statement currently is also a \nworkaround for this problem."}, {"count": 2, "tags": [], "bug_id": 15884, "text": "\n  Remove the DefaultType directive if that's your desired behavior.  All Apache\n  directives are (or should be) respected by ISAPI, CGI, static files, etc.\n", "id": 30276, "time": "2003-01-29T16:22:56Z", "creator": "wrowe@apache.org", "creation_time": "2003-01-29T16:22:56Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 15884, "attachment_id": null, "text": "Removing the DefaultType directive does not correct the problem.\n\nThe problem is that module 'mod_isapi' ignores the DefaultType directive or \ndoes not have its own directive to control the default type for objects \nreturned by ISAPI extension.\n\nNow, the default Content-Type header for entity-body returned by ISAPI \nextension is determined by the file extension of ISAPI module called.\n\nFor example: we have lines in httpd.conf file:\n\nDefaultType text/html\nAddHandler isapi-isa .dll\nISAPICacheFile isapi.dll\n\nIf isapi.dll does not specify Content-Type header in its response, Apache \nautomatically appends the 'Content-Type: application/octet-stream' header to \nthe HTTP response, so forcing some browsers (Netscape, Mozilla) to download \nthe generated html as file instead of displaying it.\n\nAfter renaming isapi.dll to isapi.zip:\n\nDefaultType text/html\nAddHandler isapi-isa .zip\nISAPICacheFile isapi.zip\n\nApache appends the 'Content-Type: application/zip' header to the HTTP response.\n\nRenaming isapi.dll to isapi.htm is another (funny) workaround for the problem: \nApache appends the desired 'Content-Type: text/html' header.\n\n\nSuggestions for solution are:\n\n1. (Simple to correct) Do not ignore DefaultType directive for entity-body \nreturned by ISAPI extension. Just add one line of code [ap_set_content_type(r, \nNULL)] before calling ISAPI HttpExtensionProc handler; or create another \ndirective for that.\n\n2. (Microsoft way) Do not automatically add a Content-Type header for ISAPI \nextensions. It is the script's responsibility to set this value, if desired. \nAccording to RFC 2616, if the media type is not given by a Content-Type field, \nthe recipient MAY attempt to guess the media type.\n", "id": 30292, "time": "2003-01-29T20:11:51Z", "creator": "laimis@tic.lt", "creation_time": "2003-01-29T20:11:51Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 15884, "attachment_id": null, "id": 30299, "time": "2003-01-29T20:27:52Z", "creator": "wrowe@apache.org", "creation_time": "2003-01-29T20:27:52Z", "is_private": false, "text": "\n  Is there any chance you did something like\n\n  AddType binary/octet-stream .dll\n\n  or are you loading mod_mime_magic?\n\n\n"}, {"attachment_id": null, "tags": [], "creator": "laimis@tic.lt", "text": "We are using default configuration (no entry for .dll; #LoadModule \nmime_magic_module \u2013 commented).\n\u201capplication/octet-stream   bin dms lha lzh exe class so dll\u201d in mime.types.\n\nComparing files mime.types.default and MIME.TYPES\nFC: no differences encountered\n\nComparing files httpd.default.conf and HTTPD.CONF\n***** httpd.default.conf\n***** HTTPD.CONF\n\n# Virtual directory\n#\nAlias /vdir \"C:/dir\"\nAlias /Vdir \"C:/dir\"\n\n<Directory \"C:/dir\">\n       Options FollowSymLinks ExecCGI\n        AllowOverride None\n        Order allow,deny\n        Allow from all\n</Directory>\n\nDirectoryIndex default.htm index.html index.html.var\n\n# CGI & ISAPI\nAddHandler cgi-script .exe\nAddHandler isapi-isa .dll\n\nISAPICacheFile C:/dir/isapi.dll\n\n# Correcting problem for: Netscape, Mozilla\n#\nAddType text/html .dll\n*****\n\nThis problem is in version 2.0.44, too.\nAnd additional ones.... Tracing...\n", "count": 5, "id": 30304, "time": "2003-01-29T20:58:08Z", "bug_id": 15884, "creation_time": "2003-01-29T20:58:08Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 15884, "text": "\n  \u201capplication/octet-stream   bin dms lha lzh exe class so dll\u201d in mime.types\n\nis the origin of your headaches.  If you add the directive\n\n  RemoveType dll\n\nin a <Directory > block that covers your ISAPI extentions, only those\n.dll files will be affected.  If you remove it from the main server\n(or your mime.types file) then anyone attempting to download the dll\nwouldn't have an appropriate mime type.\n\nThis is no different from the behavior of CGI scripts if the .sh file,\nfor example, can be identified as application/script or whatever.\n\nI'll leave this as an open FAQ/docs issue to address in the docs.\n\n\n", "id": 30311, "time": "2003-01-29T22:49:06Z", "creator": "wrowe@apache.org", "creation_time": "2003-01-29T22:49:06Z", "is_private": false, "attachment_id": null}, {"count": 7, "text": "Adding 'RemoveType dll' directive in a <Directory > block that covers ISAPI \nextensions (or globally) does not correct the problem: 'Content-Type: \napplication/octet-stream' is still being returned.\n\nAdding directive\n\n        AddType text/html .dll\n\nin a <Directory > block that covers ISAPI extensions solves the problem \ngracefully. No further corrections needed.\n\nISAPI extensions that require the default Content-Type to be specified must be \nlocated in a separate directory from .dll modules to be downloaded, and must \nbe separate from other ISAPI extensions that require another default Content-\nType to be specified.\nISAPI extensions SHOULD specify 'Content-Type: ' header in all responses in \norder to work correctly with Apache.\n\nThank you for the hint.\n", "bug_id": 15884, "is_private": false, "id": 30392, "time": "2003-01-31T08:30:32Z", "creator": "laimis@tic.lt", "creation_time": "2003-01-31T08:30:32Z", "tags": [], "attachment_id": null}]
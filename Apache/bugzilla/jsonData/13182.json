[{"count": 0, "tags": [], "bug_id": 13182, "text": "I do not know, how does it happed.\nBut all my cgi scrips are not working after some time.\n\nHere is an example\n$ telnet hosting 80\nTrying 194.44.225.10...\nConnected to hosting.\nEscape character is '^]'.\nGET /cgi-bin/test/test.cgi HTTP/1.0\n\nHTTP/1.1 500 Internal Server Error\nDate: Tue, 01 Oct 2002 17:44:23 GMT\nServer: Apache/1.3.26 (Unix) mod_ssl/2.8.10 OpenSSL/0.9.6e PHP/4.2.3 rus/PL30.15\nConnection: close\nContent-Type: text/html; charset=windows-1251\nExpires: Thu, 01 Jan 1970 00:00:01 GMT\nLast-Modified: Tue, 01 Oct 2002 17:44:24 GMT\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<HTML><HEAD>\n<TITLE>500 Internal Server Error</TITLE>\n</HEAD><BODY>\n<H1>Internal Server Error</H1>\nThe server encountered an internal error or\nmisconfiguration and was unable to complete\nyour request.<P>\nPlease contact the server administrator, [skipped] and inform them of the time the error occurred,\nand anything you might have done that may have\ncaused the error.<P>\nMore information about this error may be available\nin the server error log.<P>\n<HR>\n<ADDRESS>Apache/1.3.26 Server at iatp.org.ua Port 80</ADDRESS>\n</BODY></HTML>\nConnection closed by foreign host.\n\nSriptLog: \n%% [Tue Oct  1 20:43:40 2002] GET /cgi-bin/test/test.cgi HTTP/1.0\n%% 500 /var/www/iatp.org.ua/cgi-bin/test/test.cgi\n%request\nHost: iatp.org.ua\n%response\n%% [Tue Oct  1 20:44:24 2002] GET /cgi-bin/test/test.cgi HTTP/1.0\n%% 500 /var/www/iatp.org.ua/cgi-bin/test/test.cgi\n%request\n%response\n\nmod_cgi is compiled with DEBUG_CGI:\nAttempting to exec /var/www/iatp.org.ua/cgi-bin/test/test.cgi as CGI child (argv0 = test.cgi)\nEnvironment:\n'CHARSET=windows-1251'\n'CHARSET_DETERMINED_BY=Default'\n'CHARSET_HTTP_METHOD=http://'\n'CHARSET_SERVER_NAME=iatp.org.ua:80'\n'CHARSET_SERVER_PORT=80'\n'DOCUMENT_ROOT=/var/www/iatp.org.ua'\n'PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/X11R6/bin:/home/petr/bin'\n'REMOTE_ADDR=194.44.225.70'\n'REMOTE_PORT=4404'\n'SCRIPT_FILENAME=/var/www/iatp.org.ua/cgi-bin/test/test.cgi'\n'SERVER_ADDR=194.44.225.10'\n'SERVER_ADMIN=tech-support@iatp.org.ua'\n'SERVER_NAME=iatp.org.ua'\n'SERVER_PORT=80'\n'SERVER_SIGNATURE=<ADDRESS>Apache/1.3.26 Server at iatp.org.ua Port 80</ADDRESS>\n'\n'SERVER_SOFTWARE=Apache/1.3.26 (Unix) mod_ssl/2.8.10 OpenSSL/0.9.6e PHP/4.2.3 \nrus/PL30.15'\n'SOURCE_CHARSET=windows-1251'\n'UNIQUE_ID=PZne98Is4QoAAHZCY7I'\n'GATEWAY_INTERFACE=CGI/1.1'\n'SERVER_PROTOCOL=HTTP/1.0'\n'REQUEST_METHOD=GET'\n'QUERY_STRING='\n'REQUEST_URI=/cgi-bin/test/test.cgi'\n'SCRIPT_NAME=/cgi-bin/test/test.cgi'\n\n\nSuexec log is empty. That means in this request suexec is not used.\n\nHere is file test.cgi:\n#!/bin/sh\n\n/usr/bin/touch ttt\n\necho \"Content-type: text/plain\"\necho\necho \"this is just a test\"\n\n/usr/bin/touch ttt2\n\nAfter http-request, it really creates two files ttt and ttt2.\n\nThis script runned manually under apache user (www) produces following output:\nContent-type: text/plain\n\nthis is just a test\n\n$ httpd -v\nServer version: Apache/1.3.26 (Unix)\nServer built:   Oct  1 2002 20:38:25\n20:56:04 [root@hosting:/var/www/iatp.org.ua/cgi-bin/test]#\n$ httpd -l\nCompiled-in modules:\n  http_core.c\n  mod_charset.c\n  mod_env.c\n  mod_define.c\n  mod_log_config.c\n  mod_mime.c\n  mod_negotiation.c\n  mod_status.c\n  mod_include.c\n  mod_autoindex.c\n  mod_dir.c\n  mod_cgi.c\n  mod_asis.c\n  mod_imap.c\n  mod_actions.c\n  mod_userdir.c\n  mod_alias.c\n  mod_access.c\n  mod_auth.c\n  mod_so.c\n  mod_setenvif.c\n  mod_ssl.c\nsuexec: enabled; valid wrapper /usr/local/sbin/suexec", "id": 23700, "time": "2002-10-01T17:58:43Z", "creator": "serg@petrovich.kiev.ua", "creation_time": "2002-10-01T17:58:43Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "id": 23705, "time": "2002-10-01T18:34:19Z", "bug_id": 13182, "creation_time": "2002-10-01T18:34:19Z", "is_private": false, "text": "Is there anything in the error log?\n\nPlease try the following:\n\n1. Disable suexec completely:\nchmod -x /usr/local/sbin/suexec\n\n2. Remove any non-standard modules like mod_ssl and mod_charset."}, {"count": 2, "tags": [], "creator": "serg@petrovich.kiev.ua", "attachment_id": null, "id": 23740, "time": "2002-10-02T08:50:01Z", "bug_id": 13182, "creation_time": "2002-10-02T08:50:01Z", "is_private": false, "text": "Sorry, I've forgotten to include error_log, by error_log contains very common error: Premature \nend of script headers: /var/www/iatp.org.ua/cgi-bin/test/test.cgi\n\n1) I've disable suxec by chmod -x, the was no chage\n\n2) I've disables mod_charset and mod_ssl  - And cgi script in 80% of cases runs ok, but in 20% \ngives standart errro 500.\n\nLooks like apache is limited by some resource. But which one? Memory is enough.\n\nsysctl -a | grep files\nkern.maxfiles: 8168\nkern.maxfilesperproc: 7351\nkern.openfiles: 973\n\n"}, {"count": 3, "text": "I've noticed that cgi scripts does not work at all  immediately after start of apache. After some time \nthay works in some cases, within one or more hours aftrer start of apache scripts works almost \nevery time. \nAnd one more  rule i've noticed.  I have more chances to run a cgi script if there are less modules in \napache. I say chances, if I remove some module from config I get my script woring more often, but \nnot 100%\n", "bug_id": 13182, "attachment_id": null, "id": 23745, "time": "2002-10-02T12:21:10Z", "creator": "serg@petrovich.kiev.ua", "creation_time": "2002-10-02T12:21:10Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 13182, "attachment_id": null, "id": 23758, "time": "2002-10-02T16:03:35Z", "creator": "slive@apache.org", "creation_time": "2002-10-02T16:03:35Z", "is_private": false, "text": "Did you download your apache from http://httpd.apache.org/?\n\nIf not, please try that.  It seems you might be using a version\nwith special patches.\n"}, {"count": 5, "text": "Yes, I was using russian apache (standart apache + mod_charset patch, http://apache.lexa.ru). \nI've just downloaded and installed apache from httpd.apache.org - and no change. I get the same \nsituation. Error 500 immediately after apache starts and cgi scripts sometimes works in some time \nlater.\nI understand, that problem may be with configuration of OS (FreeBSD), but the problem apears \nwith apache only.\n", "bug_id": 13182, "attachment_id": null, "id": 23760, "time": "2002-10-02T16:37:48Z", "creator": "serg@petrovich.kiev.ua", "creation_time": "2002-10-02T16:37:48Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 13182, "attachment_id": null, "text": "Thanks to  Dmitry Cherkasov, he is one more man who have the same trouble.\nWe have found the point of the problem is in mod_php4. If we have mod_php4 compiled with \ndefault options that are in FreeBSD ports (they are: --with-zlib --with-mysql=/usr/local) everything \nworks fine. \nI'll try to find out what option in mod_php is breaks cgi.", "id": 23761, "time": "2002-10-02T16:55:21Z", "creator": "serg@petrovich.kiev.ua", "creation_time": "2002-10-02T16:55:21Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 13182, "attachment_id": null, "text": "It is FreeBSD problem only.\nThe point was option --with-pspell=/usr/local\nStarting from some time (see \nhttp://www.freebsd.org/cgi/cvsweb.cgi/ports/textproc/pspell/Attic/Makefile?hideattic=0 )\npspell is removed from freebsd ports, insted of this tooll thay recommend to use aspell.\nAs it appears, aspell  is not compatible with pspell, and it is the cause of  this strange trouble.\n\nFor me it's to strange that the part of mod_php4 causes mod_cgi does not work.\n", "id": 23763, "time": "2002-10-02T17:28:09Z", "creator": "serg@petrovich.kiev.ua", "creation_time": "2002-10-02T17:28:09Z", "is_private": false}]
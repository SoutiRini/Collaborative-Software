[{"count": 0, "tags": [], "bug_id": 22347, "attachment_id": null, "text": "Hi,\n\nif I execute java task with following code, ant hangs and I have to kill it.\n\n<pre>\n    public static String readString(String message, String defaultValue) {\n        System.out.print(message+\" [\"+defaultValue+\"]: \");\n        String input = null;\n\n        try {\n            BufferedReader reader = new BufferedReader(new\nInputStreamReader(System.in));\n            input = reader.readLine();\n            if ( input==null || input.length()==0 )\n                return defaultValue;\n            else\n                return input;\n        } catch (IOException e) {\n            System.err.println(\"Cannot read from standard input! Reason:\n\"+e.getMessage());\n            return defaultValue;\n        }\n    }\n</pre>\n\nIt doesn't print to standard output anything (neither argument message). I may\npress enter key many times, it add new line to screen, but the method doesn't\nreturn. It block forever and I have to kill it :-(\n\nIt seems obvious, that I am not not first man who encountered this issue. See\nfollowing site:\n\nhttp://bobcat.webappcabaret.net/javachina/faq/ant_01.htm#ant_adv_Q10\n\nAny idea, why does this happen and how to avoid it? Thanks", "id": 42619, "time": "2003-08-12T12:30:01Z", "creator": "literakl@systinet.com", "creation_time": "2003-08-12T12:30:01Z", "is_private": false}, {"count": 1, "tags": [], "creator": "conor@apache.org", "attachment_id": null, "id": 42626, "time": "2003-08-12T14:04:54Z", "bug_id": 22347, "creation_time": "2003-08-12T14:04:54Z", "is_private": false, "text": "I presume you are forking the <java> task. Your code should work if you don't\nfork since you will then access System.in of the Ant VM. When forked, the <java>\ntask is run in a separate VM and no input is provided to this VM. Any attempt to\nread input will hang that VM waiting for input that is never going to arrive.\nThe input you are typing is going to Ant's VM, not the one running your Java\ncode. The Ant VM isn't trying to read it's input, it's waiting for the external\nVM to finish. The end result is that everything hangs.\n\nAnt 1.6 has much better input handling. By default when forked, the external\nVM's input stream is closed so that any attempts to read input will fail fast -\ni.e. it won't hang. Your readLine will return null. You may, however, provide\ninput to the task from a file or an Ant property. \n\nIt is not possible to connect the console to the forked <java> task in the\nexternal VM. i.e. You cannot type into console and have that input provided to\nthe external VM. In general achieving this would be difficult given that more\nthan one task may be running in parallel and there is no way to know how much\ninput each task will want.\n\nFinally Ant 1.6 adds a -noinput flag. This prevents even non-forked <java> tasks\nfrom reading input. This can be useful if you don't want to inadvertently hang\nan unattended Ant operation (say a continuous integration type of run)."}, {"count": 2, "tags": [], "bug_id": 22347, "attachment_id": null, "text": "Thank you for your helpful explanation. Initially task had following definition:\n\n&lt;java classname=\"demo.Finder\" fork=\"yes\">\n\nI tried to change value of the attribute fork to no, same result and behaviour.\nFinally I removed the attribute at all:\n\n&lt;java classname=\"demo.Finder\">\n\nWell, it couldn't read from standard input either and it hanged. But when I\nkilled ant, at least it has written the message to standard output. \n\nBasicly, if I understand it well, it is better not to read anything from\nstandard input from ant. Am I right? Thank you.", "id": 42627, "time": "2003-08-12T14:17:44Z", "creator": "literakl@systinet.com", "creation_time": "2003-08-12T14:17:44Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 22347, "attachment_id": null, "text": "In Ant 1.5, you can use the <input> task to collect input from the user. Not\nsure what else your java task does but if the input is for use in Ant, use <input>.\n\nIt would also be good to have a look at the Ant 1.6 nightly builds and try out\nthe input management there.\n\nI'm not sure why it is not working for you. This is the code I used\n\nimport java.io.*;\n\npublic class Test {\n    static public void main(String[] args) {\n        try {\n            BufferedReader br = new BufferedReader(new\nInputStreamReader(System.in));\n            System.out.println(\"Enter a line\");\n            String line = br.readLine();\n            System.out.println(\"Line is \" + line);\n        }\n        catch (IOException ioe) {\n            ioe.printStackTrace();\n        }\n    }\n}\n\nI get the following results\n\nAnt 1.5.3, forked - hangs\nAnt 1.5.3, not-forked => works\nAnt 1.6alpha, forked => prints Line is null without waiting\nAnt 1.6alpha, not-forked => works\nAnt 1.6alpha, not-forked, -noinput flag => fails with EOF exception\njava.io.EOFException: No input provided for project\n\n\n", "id": 42634, "time": "2003-08-12T15:00:21Z", "creator": "conor@apache.org", "creation_time": "2003-08-12T15:00:21Z", "is_private": false}]
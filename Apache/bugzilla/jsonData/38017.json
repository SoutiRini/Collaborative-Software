[{"count": 0, "tags": [], "bug_id": 38017, "text": "mod_cache does not serve cached content.\nWe'd like to use mod_cache + mod_disk_cache + mod_proxy + mod_proxy_ajp\nas a reverse caching proxy.\nThe backend server (tomcat) sets all the right http headers (Expires,\nLast-Modified) but apache refuses to serve cached content.\nThe same problem also shows up with mod_mem_cache and/or mod_proxy_http\nExamination shows that entries are inserted into the cache using the hostname\n\"_default_\". I assume this is because of the logic in cache_generate_key_default\nin modules/cache/cache_storage.c \nHowever, cache lookups are done with the actual hostname. So, apache cannot find\nthe data it inserted on earlier requests.\n\nOur setup is as follows:\n./configure --prefix=/software/apache-2.2.0-cache --with-mpm=worker\n--enable-cache --enable-mem-cache --enable-disk-cache --enable-proxy\n--enable-proxy-http --enable-proxy-ajp --enable-proxy-balancer --enable-rewrite\n--enable-mods-shared=all\n\nThe relevant bits in the config file are:\nProxyPreserveHost       On\nCacheDefaultExpire      60\nCacheMaxExpire          3600\nCacheIgnoreCacheControl On\nCacheIgnoreNoLastMod    On\nCacheEnable             disk    /\nCacheRoot               /e/fp/shrd02/tmp/cache\nProxyPass               /       ajp://shrd01as:8009/\nProxyPassReverse        /       ajp://shrd01as:8009/\n\nBTW:\nwe use apache-2.0.X mod_mem_cache extensively. In the 2.0.X instances caching\nworks, so I'm quite surprised to encounter problems in 2.2. I assume I must be\ndoing something wrong, but can't figure out what.", "id": 83933, "time": "2005-12-22T22:09:42Z", "creator": "Dick.Snippe@tech.omroep.nl", "creation_time": "2005-12-22T22:09:42Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "Created attachment 17342\nPatch proposal against trunk", "creator": "rpluem@apache.org", "attachment_id": 17342, "id": 84269, "time": "2006-01-05T16:23:18Z", "bug_id": 38017, "creation_time": "2006-01-05T16:23:18Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 84270, "time": "2006-01-05T16:24:28Z", "bug_id": 38017, "creation_time": "2006-01-05T16:24:28Z", "is_private": false, "text": "I can confirm that this is a regression. Could you please give the attached\npatch a try and let me know the results?"}, {"count": 3, "tags": [], "bug_id": 38017, "text": "Oh I forgot: Thanks for the good analysis of the problem. That eased my search\nfor the cause very much.", "id": 84300, "attachment_id": null, "creator": "rpluem@apache.org", "creation_time": "2006-01-06T10:34:26Z", "time": "2006-01-06T10:34:26Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 38017, "attachment_id": null, "is_private": false, "id": 84433, "time": "2006-01-10T14:51:32Z", "creator": "Dick.Snippe@tech.omroep.nl", "creation_time": "2006-01-10T14:51:32Z", "text": "(In reply to comment #2)\n> I can confirm that this is a regression. Could you please give the attached\n> patch a try and let me know the results?\n\nthe patch works!\nI tested all comninations of mod_mem_cache, mod_disk_cache and mod_proxy_http,\nmod_proxy_ajp and it appears to work in all cases"}, {"count": 5, "tags": [], "creator": "rpluem@apache.org", "text": "Thanks for testing. The patch has been commited to trunk as r367798\n(http://svn.apache.org/viewcvs.cgi?rev=367798&view=rev) and been proposed for\nbackport to 2.2.x as r367800\n(http://svn.apache.org/viewcvs.cgi?rev=367800&view=rev).", "id": 84455, "time": "2006-01-10T22:38:26Z", "bug_id": 38017, "creation_time": "2006-01-10T22:38:26Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "text": "The patch has been backported to 2.2.x as r374931\n(http://svn.apache.org/viewcvs.cgi?rev=374931&view=rev) and will be part of 2.2.1", "id": 85419, "time": "2006-02-04T22:39:42Z", "bug_id": 38017, "creation_time": "2006-02-04T22:39:42Z", "attachment_id": null}, {"count": 7, "text": "I am still seeing these errors on 2.0.58 & 2.2.2 using mod_proxy for a reverse\nproxy for RPC over HTTP and Exchange.  Downgrading to 2.0.54 fixes the problem,\nmaybe there are still some other occurences besides the ones patched here that\nhave not been fixed?  I also tried this on 2.2.2 and it didn't work either.\n\n[Tue Jun 27 18:08:08 2006] [error] (70014)End of file found: proxy: prefetch\nrequest body failed to 10.2.181.53 from 15.235.153.107 ()\n[Tue Jun 27 19:07:46 2006] [error] (104)Connection reset by peer: proxy:\nprefetch request body failed to 10.2.181.53 from 10.2.181.18 ()", "bug_id": 38017, "attachment_id": null, "id": 90749, "time": "2006-06-29T00:31:20Z", "creator": "asg1290@yahoo.com", "creation_time": "2006-06-29T00:31:20Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 38017, "attachment_id": null, "id": 90753, "time": "2006-06-29T09:24:32Z", "creator": "rpluem@apache.org", "creation_time": "2006-06-29T09:24:32Z", "is_private": false, "text": "Sorry, but your problem is completely unrelated to this bug."}]
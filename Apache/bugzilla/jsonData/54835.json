[{"count": 0, "tags": [], "bug_id": 54835, "text": "I don't fully understand the history of classpath loading, but at http://ant.apache.org/manual/Tasks/junit.html item 5 says \"Leave ant-junit.jar in its default location in ANT_HOME/lib but include junit.jar in the <classpath> passed to <junit>. (since Ant 1.7)\" - that appears not to work.\n\nI have a detailed SO question at http://stackoverflow.com/questions/15979391/class-not-found-with-ant-ivy-and-junit-error-in-build-xml but to reproduce simply:\n\nhg clone ssh://hg@bitbucket.org/isti/java-example\ncd java-example\nant test\n\nand you should see:\n\nBUILD FAILED\n/home/andrew/project/guice/hg/build.xml:33: java.lang.NoClassDefFoundError: junit/framework/TestListener\n        at java.lang.ClassLoader.defineClass1(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:791)\n...\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:280)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:109)\nCaused by: java.lang.ClassNotFoundException: junit.framework.TestListener\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n...\n\n(the above project uses ant; alternatively copy junit-4.8.2.jar to ./lib and delete the ivy task from the build.xml).", "id": 166561, "time": "2013-04-12T22:36:20Z", "creator": "andrew@acooke.org", "creation_time": "2013-04-12T22:36:20Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "andrew@acooke.org", "attachment_id": null, "id": 166562, "time": "2013-04-12T22:40:12Z", "bug_id": 54835, "creation_time": "2013-04-12T22:40:12Z", "is_private": false, "text": "Correction: \"(the above project uses ant; alternatively\" should be \"(the above project uses IVY; alternatively...\""}, {"count": 2, "tags": [], "bug_id": 54835, "text": "I'm not sure this is a good bug report, sorry - the details are mainly at the SO question.  If you'd prefer me to repeat them here I can do so.  Basically - I provide a classpath to the junit task, but it still gives a class not found error.", "id": 166563, "time": "2013-04-12T22:53:05Z", "creator": "andrew@acooke.org", "creation_time": "2013-04-12T22:53:05Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "andrew@acooke.org", "attachment_id": null, "id": 166576, "time": "2013-04-13T13:45:43Z", "bug_id": 54835, "creation_time": "2013-04-13T13:45:43Z", "is_private": false, "text": "I am now working on this repo.  The example referred to above is tagged as \"classpath problem\" so to check out please do:\n\nhg clone ssh://hg@bitbucket.org/isti/java-example\ncd java-example\nhg update -r \"classpath problem\"\n\nThanks, Andrew"}, {"count": 4, "tags": [], "bug_id": 54835, "attachment_id": null, "text": "Things are clearer now.  The following:\n\nhg clone ssh://hg@bitbucket.org/isti/java-example\ncd java-example\nhg update -r \"works with 1.8.4\"\nant bootstrap test\n\nworks (gives an error because my test is missing a constructor) with Ant 1.8.4 but fails with Ant 1.9.0.\n\nThis is with a \"virgin\" Ant install.  The \"bootstrap\" copies the Ivy jar into ~/.ant/lib and then \"test\" downloads Junit jar to the local lib directory.\n\nWith Ant 1.8.4, having the Junit jar in the classpath for the junit task works just fine.  As documented at http://ant.apache.org/manual/Tasks/junit.html (item 5).  But with Ant 1.9.0 this code DOES NOT WORK.", "id": 166585, "time": "2013-04-13T20:13:49Z", "creator": "andrew@acooke.org", "creation_time": "2013-04-13T20:13:49Z", "is_private": false}, {"count": 5, "tags": [], "creator": "jglick@apache.org", "attachment_id": null, "id": 166656, "time": "2013-04-16T17:10:13Z", "bug_id": 54835, "creation_time": "2013-04-16T17:10:13Z", "is_private": false, "text": "Michael?"}, {"count": 6, "tags": [], "creator": "mclarke@apache.org", "attachment_id": null, "id": 166753, "time": "2013-04-22T08:33:38Z", "bug_id": 54835, "creation_time": "2013-04-22T08:33:38Z", "is_private": false, "text": "It looks like the class search is being delegated to the System's classloader rather than being handled by the Ant Classloader (the system Classloader has no knoweldge of JUnit since JUnit isn't on the core Ant Classpath, but is added to the JUnit task by Ivy). Given some JUnit classes must have already been loaded to have reached this point, the Ant Classloader can see the JUnit jars loaded by Ivy, but the Split Classloader seems to be delegating incorrectly when trying to load classes used by the JUnit Runner.\n\nI suspect the list of 'split classes' in JUnitTask needs expanded to include the classes added for the @Ignore changes introduced in Ant 1.9.0. I'll do a bit more investigation on this issue to see if there are any other issues caused by JUnit being inherited from an external source rather than being in the ANTLIB directory whilst I fix this issue.\n\nIn the meantime, copying your JUnit JAR into your ANTLIB directory will allow Ant to pickup the dependent classes required to launch the JUnit task if you want to continue using Ant 1.9.0."}, {"count": 7, "tags": [], "creator": "andrew@acooke.org", "attachment_id": null, "id": 166755, "time": "2013-04-22T12:33:16Z", "bug_id": 54835, "creation_time": "2013-04-22T12:33:16Z", "is_private": false, "text": "Thanks.  I've switched back to 1.8 for now (I know that I can fix it by moving jars, but the motivation is to have the build bootstrap itself completely to simplify the process for other users)."}, {"count": 8, "tags": [], "bug_id": 54835, "attachment_id": null, "id": 166765, "creation_time": "2013-04-22T19:27:39Z", "time": "2013-04-22T19:27:39Z", "creator": "mclarke@apache.org", "text": "Fixed under SVN revision 1470668.", "is_private": false}, {"count": 9, "tags": [], "bug_id": 54835, "text": "Looks like this bug only affected calls to <junit> with fork=\"false\" (the unfortunate default), which should be considered deprecated as far as I am concerned; with fork=\"true\" it is reported to work in 1.9.0.", "id": 167311, "time": "2013-05-20T17:49:40Z", "creator": "jglick@apache.org", "creation_time": "2013-05-20T17:49:40Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 54835, "attachment_id": null, "text": "I'm still seeing this problem as of ant 1.9.1\n\nI have a unit test flagged as such:\n\n@RunWith(SpringJUnit4ClassRunner.class)\n\nand an ant test target that contains\n\n <junit printsummary=\"yes\" haltonfailure=\"yes\" fork=\"true\"  forkmode=\"once\" tempdir=\"${report.tests.dir}\">\n   <classpath refid=\"test.classpath.run\"/>\n\n   <formatter type=\"plain\"/>\n\n   <batchtest fork=\"yes\" todir=\"${report.tests.dir}\">\n     <fileset dir=\"${src.tests.dir}\">\n       <include name=\"**/*IntegrationTestCase*.java\"/>\n     </fileset>\n   </batchtest>\n\n</junit>\n\nmy classpath is built via ivy.\n\nThe ant test run does not honor the 'RunsWith' annotation.  A stack trace demonstrates this.  Running in eclipse works fine.", "id": 167639, "time": "2013-06-03T23:39:33Z", "creator": "gjbaxter@yahoo.com", "creation_time": "2013-06-03T23:39:33Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 54835, "text": "Actually, I haven't the vaguest idea.  I've tried using ant 1.8.4 with and without the junit4 jar in the lib directory, as well as ant 1.9.1.  I'm flumoxed.  This may very well be my stupidity someplace.", "id": 167640, "attachment_id": null, "creator": "gjbaxter@yahoo.com", "creation_time": "2013-06-03T23:55:21Z", "time": "2013-06-03T23:55:21Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 54835, "attachment_id": null, "text": "Totally my bad.. I didn't see that this particular case I was fiddling with extended junit3 TestCase.  Time to go shave heads.. mine and someone else's.", "id": 167641, "time": "2013-06-04T00:01:39Z", "creator": "gjbaxter@yahoo.com", "creation_time": "2013-06-04T00:01:39Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 54835, "attachment_id": null, "text": "It looks like this fix actually broke JUnit4 for me. Everything up to (and including) 1.9.0 works fine, 1.9.1-1.9.3 do not.\nI created a fairly minimal test case at my git repository\nhttps://github.com/NicoK/ant-1.9-junit\n\ngit clone https://github.com/NicoK/ant-1.9-junit.git\ncd ant-1.9-junit.git\nant test\n\n(I tested 1.9.0 by adding it to the test-lib directory and setting includeantruntime=\"false\" for the JUnit task in the ant build file)", "id": 174061, "time": "2014-03-24T16:04:46Z", "creator": "nico.kruber@gmail.com", "creation_time": "2014-03-24T16:04:46Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 54835, "attachment_id": null, "text": "actually, only providing ant-junit-1.9.0.jar in the test-lib folder is sufficient to make it work again", "id": 174063, "time": "2014-03-24T16:10:38Z", "creator": "nico.kruber@gmail.com", "creation_time": "2014-03-24T16:10:38Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 54835, "attachment_id": null, "text": "Re-closing issue since it can't be replicated with the test case in #13 on a clean build of Ant 1.9.6.", "id": 184843, "time": "2015-08-29T12:44:10Z", "creator": "mclarke@apache.org", "creation_time": "2015-08-29T12:44:10Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 54835, "attachment_id": null, "text": "As per ant version\n\nC:\\Users\\fandre\\Documents\\git\\javacc>ant -version\nApache Ant(TM) version 1.9.7 compiled on April 9 2016\n\nthis issue is always present with the script below\n\n\t\t<junit printsummary=\"yes\" haltonfailure=\"no\">\n\n\t\t\t<classpath>\n\t\t\t\t<pathelement location=\"classes\" />\n\t\t\t\t<pathelement location=\"junit\" />\n\t\t\t\t<pathelement location=\"lib/junit.jar\" />\n\t\t\t</classpath>\n\n\t\t\t<batchtest fork=\"no\" todir=\".\">\n\t\t\t\t<fileset dir=\"junit\">\n\t\t\t\t\t<include name=\"**/*Test.*\" />\n\t\t\t\t</fileset>\n\t\t\t\t<formatter type=\"failure\"/>\n\t            <!-- I want to see something ... -->\n\t            <formatter type=\"plain\" usefile=\"false\"/>\n\t\t\t</batchtest>\n\t\t</junit>\n\n\nunittest:\n   [delete] Deleting directory C:\\Users\\fandre\\Documents\\git\\javacc\\test.tmp\n    [mkdir] Created dir: C:\\Users\\fandre\\Documents\\git\\javacc\\test.tmp\n   [delete] Deleting directory C:\\Users\\fandre\\Documents\\git\\javacc\\junit\n    [mkdir] Created dir: C:\\Users\\fandre\\Documents\\git\\javacc\\junit\n    [javac] Compiling 6 source files to C:\\Users\\fandre\\Documents\\git\\javacc\\junit\n\nBUILD FAILED\nC:\\Users\\fandre\\Documents\\git\\javacc\\build.xml:229: Using loader AntClassLoader[C:\\Apache Software Foundation\\apache-ant-1.9.7\\lib\\ant-launcher.jar;C:\\Apache Software Foundation\\apache-ant-1.9.7\\lib\\ant.jar;C:\\Apache Software Foundation\\apache-ant-1.9.7\\lib\\ant-junit.jar;C:\\Apache Software Foundation\\apache-ant-1.9.7\\lib\\ant-junit4.jar;C:\\Users\\fandre\\Documents\\git\\javacc\\classes;C:\\Users\\fandre\\Documents\\git\\javacc\\junit;C:\\Users\\fandre\\Documents\\git\\javacc\\lib\\junit.jar] on class org.apache.tools.ant.taskdefs.optional.junit.FailureRecorder: java.lang.NoClassDefFoundError: junit/framework/TestListener\n        at java.lang.ClassLoader.defineClass1(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)\n        at java.net.URLClassLoader.access$100(URLClassLoader.java:73)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:368)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:362)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:361)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n        at java.lang.ClassLoader.defineClass1(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)\n        at java.net.URLClassLoader.access$100(URLClassLoader.java:73)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:368)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:362)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:361)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n        at org.apache.tools.ant.AntClassLoader.findBaseClass(AntClassLoader.java:1407)\n        at org.apache.tools.ant.AntClassLoader.loadClass(AntClassLoader.java:1085)\n        at org.apache.tools.ant.util.SplitClassLoader.loadClass(SplitClassLoader.java:58)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:348)\n        at org.apache.tools.ant.taskdefs.optional.junit.FormatterElement.createFormatter(FormatterElement.java:287)\n        at org.apache.tools.ant.taskdefs.optional.junit.JUnitTask.executeInVM(JUnitTask.java:1617)\n        at org.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:1021)\n        at org.apache.tools.ant.taskdefs.optional.junit.JUnitTask.executeOrQueue(JUnitTask.java:2105)\n        at org.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:832)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:293)\n        at sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:435)\n        at org.apache.tools.ant.Target.performTasks(Target.java:456)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1405)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1376)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1260)\n        at org.apache.tools.ant.Main.runBuild(Main.java:854)\n        at org.apache.tools.ant.Main.startAnt(Main.java:236)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:285)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:112)\nCaused by: java.lang.ClassNotFoundException: junit.framework.TestListener\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n        ... 49 more", "id": 195331, "time": "2016-12-02T09:44:53Z", "creator": "francis.andre.kampbell@orange.fr", "creation_time": "2016-12-02T09:44:53Z", "is_private": false}, {"count": 17, "tags": [], "creator": "francis.andre.kampbell@orange.fr", "attachment_id": 34497, "id": 195333, "time": "2016-12-02T09:52:55Z", "bug_id": 54835, "creation_time": "2016-12-02T09:52:55Z", "is_private": false, "text": "Created attachment 34497\njunit.jar: content"}, {"count": 18, "tags": [], "creator": "francis.andre.kampbell@orange.fr", "attachment_id": 34498, "id": 195334, "time": "2016-12-02T10:00:26Z", "bug_id": 54835, "creation_time": "2016-12-02T10:00:26Z", "is_private": false, "text": "Created attachment 34498\njunit.jar"}, {"count": 19, "tags": [], "creator": "francis.andre.kampbell@orange.fr", "attachment_id": null, "id": 195346, "time": "2016-12-04T10:31:13Z", "bug_id": 54835, "creation_time": "2016-12-04T10:31:13Z", "is_private": false, "text": "Wjunit classpath resolution for junit.jar is working with ant 1.9.3.\n\nDid not test with 1.9.4 or 1.9.5 or 1.9.6."}, {"text": "Wjunit classpath resolution for junit.jar is working with ant 1.9.3.\n\nDid not test with 1.9.4 or 1.9.5 or 1.9.6.", "tags": [], "bug_id": 54835, "attachment_id": null, "count": 20, "id": 195352, "time": "2016-12-04T13:49:22Z", "creator": "francis.andre.kampbell@orange.fr", "creation_time": "2016-12-04T13:49:22Z", "is_private": false}]
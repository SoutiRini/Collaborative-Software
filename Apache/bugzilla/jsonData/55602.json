[{"count": 0, "tags": [], "bug_id": 55602, "attachment_id": null, "id": 170304, "time": "2013-09-27T14:27:19Z", "creator": "st.mailinglists@gmail.com", "creation_time": "2013-09-27T14:27:19Z", "is_private": false, "text": "During some initial tests with the Websocket implementation in Tomcat 7.0.42 the jre crashed seemingly randomly with the following crash log.\n\nWe got the same crash 3 times during a full work day while testing an extended version of the chat examples/ app in message (not binary) mode with a few clients. No idea how to reproduce though as the crashes appeared seemingly randomly. The chat had always been working fine for some time before the crash occurred.\n\nUsing APR based Apache Tomcat Native library 1.1.27 using APR version 1.4.6.\n\n\n#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x00007f4b6a72c9dd, pid=10100, tid=139961597916928\n#\n# JRE version: Java(TM) SE Runtime Environment (7.0_40-b43) (build 1.7.0_40-b43)\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (24.0-b56 mixed mode linux-amd64 compressed oops)\n# Problematic frame:\n# C  [libtcnative-1.so.0.1.27+0x129dd]  Java_org_apache_tomcat_jni_Socket_send+0x15d\n#\n# Core dump written. Default location: /home/asok/myself/core or core.10100\n#\n# If you would like to submit a bug report, please visit:\n#   http://bugreport.sun.com/bugreport/crash.jsp\n# The crash happened outside the Java Virtual Machine in native code.\n# See problematic frame for where to report the bug.\n#\n\n---------------  T H R E A D  ---------------\n\nCurrent thread (0x00007f4928010000):  JavaThread \"http-apr-10088-exec-7\" daemon [_thread_in_native, id=18750, stack(0x00007f4b59437000,0x00007f4b59538000)]\n\nsiginfo:si_signo=SIGSEGV: si_errno=0, si_code=1 (SEGV_MAPERR), si_addr=0x0000000000000040\n\nRegisters:\nRAX=0x0000000000000000, RBX=0x00007f49280011d0, RCX=0x0000000000000000, RDX=0x00007f4b59534128\nRSP=0x00007f4b59534110, RBP=0x00007f49280101e8, RSI=0x00007f4b59534130, RDI=0x0000000000000000\nR8 =0x00007f4b59534130, R9 =0x0000000000000001, R10=0x00007f4b8d01852d, R11=0x00007f4b985e3ed0\nR12=0x0000000000000000, R13=0x0000000000000000, R14=0x00007f4b59536210, R15=0x00007f4928010000\nRIP=0x00007f4b6a72c9dd, EFLAGS=0x0000000000010246, CSGSFS=0x0000000000000033, ERR=0x0000000000000004\n  TRAPNO=0x000000000000000e\n\nTop of Stack: (sp=0x00007f4b59534110)\n0x00007f4b59534110:   327473657547202a 6f6a207361682031\n0x00007f4b59534120:   0000002e64656e69 0000000000000001\n0x00007f4b59534130:   0000000000000081 0000000000000000\n0x00007f4b59534140:   0000000000000000 0000000000000008\n0x00007f4b59534150:   0000000000000000 0000000000000000\n0x00007f4b59534160:   0000000000000000 0000000000000000\n0x00007f4b59534170:   0000000000000000 0000000000000000\n0x00007f4b59534180:   0000000000003528 0000000000000000\n0x00007f4b59534190:   0000000000005978 0000000000000000\n0x00007f4b595341a0:   0000000000005980 0000000000000000\n0x00007f4b595341b0:   0000000000000008 0000000000000000\n0x00007f4b595341c0:   0000000000000000 0000000000000000\n0x00007f4b595341d0:   0000000000000000 0000000000000000\n0x00007f4b595341e0:   0000000000000000 0000000000000000\n0x00007f4b595341f0:   0000000000000000 0000000000000000\n0x00007f4b59534200:   0000000000000000 0000000000000000\n0x00007f4b59534210:   0000000000000000 00007f4b00000008\n0x00007f4b59534220:   0000000000000000 00007f4b00000000\n0x00007f4b59534230:   00007f4900000000 00007f4900000000\n0x00007f4b59534240:   00007f4b00000000 00007f4b00000000\n0x00007f4b59534250:   0000000000000000 0000000000000000\n0x00007f4b59534260:   0000000000000000 0000000000000000\n0x00007f4b59534270:   0000000000000000 0000000000000000\n0x00007f4b59534280:   0000000000000000 0000000000000000\n0x00007f4b59534290:   0000000000000000 0000000000000000\n0x00007f4b595342a0:   0000000000000000 0000000000000000\n0x00007f4b595342b0:   0000000000000000 0000000000000000\n0x00007f4b595342c0:   0000000000000000 0000000000000b00\n0x00007f4b595342d0:   0000000000000000 0000000000000000\n0x00007f4b595342e0:   0000000000000000 0000000000000000\n0x00007f4b595342f0:   0000000000000000 0000000000000000\n0x00007f4b59534300:   0000000000000000 0000000000000000 \n\nInstructions: (pc=0x00007f4b6a72c9dd)\n0x00007f4b6a72c9bd:   89 ea 4c 89 f6 48 89 ef ff 90 40 06 00 00 48 8b\n0x00007f4b6a72c9cd:   43 30 48 8b 7b 18 48 8d 54 24 18 48 8d 74 24 20\n0x00007f4b6a72c9dd:   ff 50 40 89 c3 e9 47 ff ff ff be 58 00 00 00 48\n0x00007f4b6a72c9ed:   89 ef e8 ec a1 ff ff b8 a8 ff ff ff e9 6a ff ff \n\nRegister to memory mapping:\n\nRAX=0x0000000000000000 is an unknown value\nRBX=0x00007f49280011d0 is an unknown value\nRCX=0x0000000000000000 is an unknown value\nRDX=0x00007f4b59534128 is pointing into the stack for thread: 0x00007f4928010000\nRSP=0x00007f4b59534110 is pointing into the stack for thread: 0x00007f4928010000\nRBP=0x00007f49280101e8 is an unknown value\nRSI=0x00007f4b59534130 is pointing into the stack for thread: 0x00007f4928010000\nRDI=0x0000000000000000 is an unknown value\nR8 =0x00007f4b59534130 is pointing into the stack for thread: 0x00007f4928010000\nR9 =0x0000000000000001 is an unknown value\nR10=0x00007f4b8d01852d is at code_begin+1197 in an Interpreter codelet\nmethod entry point (kind = native)  [0x00007f4b8d018080, 0x00007f4b8d018e80]  3584 bytes\nR11=0x00007f4b985e3ed0: <offset 0x183ed0> in /lib/x86_64-linux-gnu/libc.so.6 at 0x00007f4b98460000\nR12=0x0000000000000000 is an unknown value\nR13=0x0000000000000000 is an unknown value\nR14=0x00007f4b59536210 is pointing into the stack for thread: 0x00007f4928010000\nR15=0x00007f4928010000 is a thread\n\n\nStack: [0x00007f4b59437000,0x00007f4b59538000],  sp=0x00007f4b59534110,  free space=1012k\nNative frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)\nC  [libtcnative-1.so.0.1.27+0x129dd]  Java_org_apache_tomcat_jni_Socket_send+0x15d\n\nJava frames: (J=compiled Java code, j=interpreted, Vv=VM code)\nj  org.apache.tomcat.jni.Socket.send(J[BII)I+0\nj  org.apache.coyote.http11.upgrade.UpgradeAprProcessor.write(I)V+14\nj  org.apache.coyote.http11.upgrade.UpgradeOutbound.write(I)V+5\nj  org.apache.catalina.websocket.WsOutbound.doWriteBytes(Ljava/nio/ByteBuffer;Z)V+68\nj  org.apache.catalina.websocket.WsOutbound.doWriteText(Ljava/nio/CharBuffer;Z)V+65\nj  org.apache.catalina.websocket.WsOutbound.writeTextMessage(Ljava/nio/CharBuffer;)V+44\nj  com.company.app.handler.log.chat.ChatWebSocketServlet.broadcast(Ljava/lang/String;)V+66\nj  com.company.app.handler.log.chat.ChatWebSocketServlet$ChatMessageInbound.onOpen(Lorg/apache/catalina/websocket/WsOutbound;)V+46\nj  org.apache.catalina.websocket.StreamInbound.onUpgradeComplete()V+22\nj  org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(Lorg/apache/tomcat/util/net/SocketWrapper;Lorg/apache/tomcat/util/net/SocketStatus;)Lorg/apache/tomcat/util/net/AbstractEndpoint$Handler$SocketState;+224\nj  org.apache.tomcat.util.net.AprEndpoint$SocketWithOptionsProcessor.run()V+167\nj  java.util.concurrent.ThreadPoolExecutor.runWorker(Ljava/util/concurrent/ThreadPoolExecutor$Worker;)V+95\nj  java.util.concurrent.ThreadPoolExecutor$Worker.run()V+5\nj  java.lang.Thread.run()V+11\nv  ~StubRoutines::call_stub"}, {"count": 1, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "text": "Possible dupe of bug #51813\n\nCan you re-try with tcnative 1.1.28? (I mis-typed in your other bug that 1.1.27 is latest... it's 1.1.28 though it does not appear to be on the download page for some reason). Try looking here:\nhttp://archive.apache.org/dist/tomcat/tomcat-connectors/native/1.1.28/", "id": 170308, "time": "2013-09-27T14:54:31Z", "bug_id": 55602, "creation_time": "2013-09-27T14:54:31Z", "is_private": false}, {"count": 2, "tags": [], "creator": "st.mailinglists@gmail.com", "attachment_id": null, "text": "(The other bug #55588 is not created by me, I just subscribed as the jre crash looked similar. But it does not seem to have to do with websockets. Our tomcat is very stable when not using websockets.)", "id": 170311, "time": "2013-09-27T15:05:27Z", "bug_id": 55602, "creation_time": "2013-09-27T15:05:27Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "kpreisser@apache.org", "text": "Hi,\n\nI remember that I got crashes when using a WebSocket application on Tomcat 7.0.27 with TC Native 1.1.23 and Java 1.7.0_03 on Windows Server 2008 x86 - see [1].\n\nI do not know if it is related, but the Stack traces look similar.\n\nHowever, since then, I never have done additional testing with Tomcat 7, Websockets and APR connector.\n\n\n[1] http://markmail.org/message/5m5qmtu3g67zgia3", "count": 3, "id": 170312, "time": "2013-09-27T15:14:41Z", "bug_id": 55602, "creation_time": "2013-09-27T15:14:41Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 55602, "is_private": false, "text": "This has been fixed in 8.0.x and 7.0.x and will be included in 8.0.0-RC4 onwards and 7.0.46 onwards.", "id": 170362, "time": "2013-09-30T19:40:17Z", "creator": "markt@apache.org", "creation_time": "2013-09-30T19:40:17Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 55602, "attachment_id": null, "id": 170403, "time": "2013-10-03T13:56:33Z", "creator": "st.mailinglists@gmail.com", "creation_time": "2013-10-03T13:56:33Z", "is_private": false, "text": "(In reply to Mark Thomas from comment #4)\n> This has been fixed in 8.0.x and 7.0.x and will be included in 8.0.0-RC4\n> onwards and 7.0.46 onwards.\nDo you mean 7.0.46, or rather 7.0.43? Current stable release is 7.0.42, and 7.0.42 is also the release where I observed this bug."}, {"attachment_id": null, "tags": [], "bug_id": 55602, "is_private": false, "count": 6, "id": 170404, "time": "2013-10-03T14:01:15Z", "creator": "chuck.caldarale@unisys.com", "creation_time": "2013-10-03T14:01:15Z", "text": "(In reply to st.mailinglists from comment #5)\n> Do you mean 7.0.46, or rather 7.0.43? Current stable release is 7.0.42, and\n> 7.0.42 is also the release where I observed this bug.\n\n7.0.46, since the attempted releases for 7.0.43 through 7.0.45 were canceled."}, {"count": 7, "tags": [], "bug_id": 55602, "text": "(In reply to Chuck Caldarale from comment #6)\n> (In reply to st.mailinglists from comment #5)\n> > Do you mean 7.0.46, or rather 7.0.43? Current stable release is 7.0.42, and\n> > 7.0.42 is also the release where I observed this bug.\n> \n> 7.0.46, since the attempted releases for 7.0.43 through 7.0.45 were canceled.\nGreat, thanks for the clarification!", "id": 170405, "time": "2013-10-03T14:05:55Z", "creator": "st.mailinglists@gmail.com", "creation_time": "2013-10-03T14:05:55Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "cn@cn-consult.dk", "attachment_id": null, "id": 64276, "time": "2004-09-27T16:38:00Z", "bug_id": 31439, "creation_time": "2004-09-27T16:38:00Z", "is_private": false, "text": "I have messed up one of my webapps and used the ant task\norg.apache.catalina.ant.DeployTask to deploy it. Despite the new bugs I've\nintroduced that went fine, but ofcourse I cannot start it, and now I can't\nundeploy it either.\n\nWhen i try to undeply from the Tomcat Manager app I get this message:\nFAIL - Encountered exception LifecycleException:  Container\norg.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/xxxxx] has not\nbeen started\n\nWhen I try to undeploy it using the ant task org.apache.catalina.ant.UndeployTask \nnothing really happens - just got this entry in the stdout log:\n2004-09-27 18:33:06 org.apache.catalina.core.ApplicationContext log\nINFO: Manager: undeploy: Undeploying web application at '/xxxxx'"}, {"count": 1, "tags": [], "creator": "cn@cn-consult.dk", "attachment_id": null, "id": 64941, "time": "2004-10-11T17:18:35Z", "bug_id": 31439, "creation_time": "2004-10-11T17:18:35Z", "is_private": false, "text": "I marked this bug INVALID because I thought my original description was\nmisleading to say the least.\n\nHowever, others seem to have similar problems, so I am reopening it, and will\ntry to provide a better description.\n\nFirst of all, it has nothing to do with the webapp not working. Tomcat 5.5\nsimply will not delete/overwrite expanded webapplications.\n\nOn http://jakarta.apache.org/tomcat/tomcat-5.5-doc/deployer-howto.html\n\nIt is stated:\n---------\nRedeployment of a web application which has been deployed from a WAR when the\nWAR is updated: the expanded web application is removed, and the WAR is expanded\nagain. This will not happen if the host is configured so that WARs are not\nexpanded, in which case the webapp will be simply redeployed.\n---------\n\nThe part about removing the expanded webapp never happens.\n\nAs a workaround, I've configured Tomcat to not expand wabapps, so now (after\ndeleting the expanded webapp manually) undeployment and redeployment works.\n\nFirst I tried to change this using the Admin webapp. That change was lost when\nthe server was restarted. Now I've added this line in \"Tomcat 5.5/conf/server.xml\":\n  <Host appBase=\"webapps\" name=\"localhost\" unpackWARs=\"false\" /> \nThat solves the problem - if you can live with the webapps not being expanded.\n\nThe complete server.xml now looks loke this:\n<Server>\n  <Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\" /> \n  <Listener\n     className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /> \n  <GlobalNamingResources>\n    <Environment name=\"simpleValue\" type=\"java.lang.Integer\" value=\"30\" /> \n    <Resource auth=\"Container\"\n              description=\"User database that can be updated and saved\"\n              name=\"UserDatabase\" type=\"org.apache.catalina.UserDatabase\"\n              pathname=\"conf/tomcat-users.xml\"\n              factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" /> \n  </GlobalNamingResources>\n  <Service name=\"Catalina\">\n    <Connector port=\"8080\" redirectPort=\"8443\"\n               maxSpareThreads=\"75\" maxThreads=\"150\" minSpareThreads=\"25\" /> \n    <Connector port=\"8009\" protocol=\"AJP/1.3\"\n               protocolHandlerClassName=\"org.apache.jk.server.JkCoyoteHandler\"\n               redirectPort=\"8443\" /> \n    <Engine defaultHost=\"localhost\" name=\"Catalina\">\n      <Host appBase=\"webapps\" name=\"localhost\" unpackWARs=\"false\" /> \n      <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" /> \n    </Engine>\n  </Service>\n</Server>\n"}, {"count": 2, "tags": [], "text": "First, use 5.5.3, which is a quality build.\nIf using Windows, you obviously have to use one of the anti file locking\nfeatures (one which prevents locking of JARs after stopping - you then need to\nuse the manager webapp to undeploy -, and one which prevents locking of\neverything all the time but has a few gotchas - with this one, you can delete\nyour webapp docBase to undeploy it). Otherwise, you cannot expect a hot deployer\nto work (since Java on Windows locks JARs all the time).\n\nPlease do not reopen this report.", "attachment_id": null, "id": 64943, "creator": "remm@apache.org", "time": "2004-10-11T17:26:08Z", "bug_id": 31439, "creation_time": "2004-10-11T17:26:08Z", "is_private": false}, {"count": 3, "tags": [], "creator": "cn@cn-consult.dk", "attachment_id": null, "id": 64992, "time": "2004-10-12T15:53:16Z", "bug_id": 31439, "creation_time": "2004-10-12T15:53:16Z", "is_private": false, "text": "Using 5.5.3 makes no difference.\n"}, {"count": 4, "tags": [], "text": "It was not so obvious to me, but with help from Yoav Shapira I finally found out\nwhat was meant by \"you obviously have to use one of the anti file locking\nfeatures\"...\nIt's all right here:\nhttp://jakarta.apache.org/tomcat/tomcat-5.5-doc/config/context.html.\n", "attachment_id": null, "id": 64996, "creator": "cn@cn-consult.dk", "time": "2004-10-12T17:11:01Z", "bug_id": 31439, "creation_time": "2004-10-12T17:11:01Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 31439, "text": "And it works with that ?\n\nIf it doesn't, please restate the scenario which doesn't work.\n\nNote: the JAR file locking prevention code is optional in 5.5 (it was always\nenabled in 5.0) because I figured Linux users shouldn't have to suffer because\nof Windows specific issues. The other more general file locking option is new in\n5.5 (it copies everything away like JBoss which is cool for pure hot deployment,\nbut not that great for development usage).", "id": 64997, "attachment_id": null, "creator": "remm@apache.org", "creation_time": "2004-10-12T17:21:07Z", "time": "2004-10-12T17:21:07Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 31439, "text": "Now that I have tested it - no, actually it does not...\n\nIf I add antiJARLocking=\"true\" in context.xml I can deploy and undeploy my\napplication, provided that I don't actually use it in between :*|\n\nIf I deploy the application, access it and then tries to undeploy it, Tomcat\nManager will claim that it undeployed the application, but it will leave parts\nof the expanded application (jars under WEB-INF/lib), and I have to stop Tomcat\nto delete the remaining files.\n\nWith antiResourceLocking it's the same - except it never works. Dosn't matter if\nI access the application or not.\n\nI'm not entirely sure that I am doing this right, but I changed the context.xml\nfile in Tomcats conf directory to look like this: \n<Context antiJARLocking=\"true\">\n\t<WatchedResource>WEB-INF/web.xml</WatchedResource>\n\t<WatchedResource>META-INF/context.xml</WatchedResource>\n</Context>\n\nBtw, I tried to attach the .war file to this bug report, but that dosn't seem to\nwork either - maby it was too big (1.7MB), or I wasn't patient enough. Anyway,\nif anyone wants it, let me know.\n", "id": 65011, "attachment_id": null, "creator": "cn@cn-consult.dk", "creation_time": "2004-10-12T21:44:39Z", "time": "2004-10-12T21:44:39Z", "is_private": false}]
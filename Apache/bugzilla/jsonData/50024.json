[{"count": 0, "tags": [], "bug_id": 50024, "text": "When using mod_cache/mod_mem_cache and the latest mod_security (2.5.12), a strange bug appears, that can be linked to the following entry in the error:\n\n[Wed Sep 29 13:22:19 2010] [error] (103)Software caused connection abort: cache: error returned while trying to return mem cached data\n\nThis error message can be triggered as follows:\n$> curl  --max-time 1 --limit-rate 100 http://127.0.0.1:8000/1MB\n\nIn standard use, the bug appears in about once in 1000 requests and results in a blank http response that leads to a blank page in the browser.\n\nReproducing the bug and triggering via curl:\n============================================\n\n$> ./configure --prefix=/data/folinic/apache/apache-2.2.16 \\\n --enable-mods-shared=all --enable-cache --enable-mem-cache \\\n --with-included-apr\n\n$> httpd -V\nServer version: Apache/2.2.16 (Unix)\nServer built:   Sep 29 2010 14:00:03\nServer's Module Magic Number: 20051115:24\nServer loaded:  APR 1.4.2, APR-Util 1.3.9\nCompiled using: APR 1.4.2, APR-Util 1.3.9\nArchitecture:   64-bit\nServer MPM:     Prefork\n  threaded:     no\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/data/folinic/apache/apache-2.2.16\"\n -D SUEXEC_BIN=\"/data/folinic/apache/apache-2.2.16/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"logs/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n$> httpd -l\nCompiled in modules:\n  core.c\n  prefork.c\n  http_core.c\n  mod_so.c\n\n$> uname -a\nLinux xxxxxx 2.6.26-2-amd64 #1 SMP Sun Jun 20 20:16:30 UTC 2010 x86_64 GNU/Linu\n\n\nModSecurity:\n./configure --with-apxs=/data/folinic/apache/apache-2.2.16/bin/apxs \\\n  --with-apu=/data/folinic/apache/apache-2.2.16/bin/apu-1-confi\n\nMinimal Apache config:\n\n ServerName              www.example.com\n ServerRoot              /data/folinic/apache/apache-2.2.15\n\n PidFile                 /tmp/httpd.pid\n Listen                  127.0.0.1:8000\n\n LoadModule              log_config_module       modules/mod_log_config.so\n LoadModule              security2_module        modules/mod_security2.so\n LoadModule              cache_module            modules/mod_cache.so\n LoadModule              mem_cache_module        modules/mod_mem_cache.so\n LoadModule              unique_id_module        modules/mod_unique_id.so\n\n ErrorLog                /tmp/error.log\n\n DocumentRoot            \"/tmp\"\n\n SecRuleEngine           On\n\n MCacheSize              10000000\n MCacheMinObjectSize     1\n MCacheMaxObjectSize     2000000\n\n CacheEnable             mem \n\n\nStart the server:\n$> /data/folinic/apache/apache-2.2.16/bin/httpd -X -k start \\\n   -f /data/folinic/apache/apache-2.2.16/conf/httpd-minimal.conf\n\nGenerate the test file:\n$> dd if=/dev/zero of=/tmp/1MB bs=1024 count=1000\n\nTrigger the error log entry:\n$> curl  --max-time 1 --limit-rate 100 http://127.0.0.1:8000/1MB\n\nNOTE that the error does only appear starting with the 2nd curl call.", "id": 140295, "time": "2010-09-29T08:26:46Z", "creator": "christian.folini@netnea.com", "creation_time": "2010-09-29T08:26:46Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 50024, "text": "I'm having a similar error a number of times a day on Apache/2.2.16 (Win32) when processing 500-1000 requests per minute, 500-1000 KB per minute, as a reverse proxy-cache-mem_cache.  Maybe this is related to https://issues.apache.org/bugzilla/show_bug.cgi?id=45868 \n\n[Thu Oct 07 09:16:34 2010] [error] (620018)APR does not understand this error code: cache: error returned while trying to return mem cached data\n[Thu Oct 07 09:51:23 2010] [error] (620018)APR does not understand this error code: cache: error returned while trying to return mem cached data\n[Thu Oct 07 10:17:46 2010] [error] (620018)APR does not understand this error code: cache: error returned while trying to return mem cached data\n[Thu Oct 07 11:26:11 2010] [error] (620018)APR does not understand this error code: cache: error returned while trying to return mem cached data\n[Thu Oct 07 11:26:29 2010] [error] (620018)APR does not understand this error code: cache: error returned while trying to return mem cached data\n[Thu Oct 07 11:39:20 2010] [error] (620018)APR does not understand this error code: cache: error returned while trying to return mem cached data", "id": 140608, "time": "2010-10-08T19:47:44Z", "creator": "kmashint@yahoo.com", "creation_time": "2010-10-08T19:47:44Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 50024, "attachment_id": null, "is_private": false, "id": 140609, "time": "2010-10-08T19:50:47Z", "creator": "kmashint@yahoo.com", "creation_time": "2010-10-08T19:50:47Z", "text": "I my Apache/2.2.16 (Win32) configuration, however, I'm not using mod_security.  I'm using Apache mod_proxy as an HTTP proxy/cache to a Tomcat 5.5.30 server."}, {"count": 3, "tags": [], "bug_id": 50024, "text": "We are using Apache/2.2.12 (Win32) at several client sites. We also do not use mod-security. Our clients are experiencing blank replies or replies associated with a different request when we enable mod-cache. Mod-cache is now turned off and we will not be able to enable it until there is a resolution. \nI'm using Apache mod_proxy as an HTTP reverse proxy/cache to a Zope 2.12 set of server nodes. We are also using SSL off-load in our configuration.", "id": 157966, "time": "2012-04-11T22:42:23Z", "creator": "wchipman@zeomega.com", "creation_time": "2012-04-11T22:42:23Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 50024, "text": "We're also experiencing many hundreds of occurrences of this error a month.  We're using mod_proxy to reverse proxy onto 2 Zope origin servers via Haproxy and cache the response using mod_cache.\n\nEach \"Software caused connection abort\" error in the error logs corresponds to a line in the access log with a status code of 103.\n\nCross referencing the apache access logs with the haproxy ones it looks like the error usually, if not exclusively occurs when the request is being served from the cache.", "id": 160091, "time": "2012-06-19T07:11:04Z", "creator": "anthonygerrard+apache.org@gmail.com", "creation_time": "2012-06-19T07:11:04Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 50024, "text": "Also, for every line we see the cache error message there is also /var/log/messages, I see the following:\n\n   Jul 26 14:01:54 lnxvmdmzwebp05 kernel: mod_cache.so[1041]: segfault at 0000000000000001 rip 0000000000000001 rsp 00007fffee881848 error 14", "id": 161174, "time": "2012-08-08T19:44:01Z", "creator": "patrick.gasior@mercy.net", "creation_time": "2012-08-08T19:44:01Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "trawick@apache.org", "text": "Anyone with httpd child process crashes should try to get backtraces.  Here's some doc for Unix:\nhttp://httpd.apache.org/dev/debugging.html#crashes", "id": 161175, "time": "2012-08-08T19:51:11Z", "bug_id": 50024, "creation_time": "2012-08-08T19:51:11Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 50024, "attachment_id": null, "is_private": false, "id": 195099, "time": "2016-11-21T05:09:17Z", "creator": "lawrence.huang@ericsson.com", "creation_time": "2016-11-21T05:09:17Z", "text": "does anybody has this 103 error code even only Mod_cache is enable ? I have seen a lot of error log in below within error_log\n[Sun Nov 20 22:51:36 2016] [error] (103)Software caused connection abort: cache: error returned while trying to return disk cached data\n\n\n\nlet me know whether the new verision fixed this or not?"}, {"count": 8, "tags": [], "bug_id": 50024, "is_private": false, "id": 195152, "creation_time": "2016-11-22T20:25:40Z", "time": "2016-11-22T20:25:40Z", "creator": "jim@apache.org", "text": "It would be good to know what the interaction w/ mod_security is and if the bug exists actually in the httpd codebase or not.", "attachment_id": null}, {"count": 9, "tags": [], "creator": "christian.folini@netnea.com", "attachment_id": null, "text": "Thanks for picking this up Jim. I have not seen the bug in years. Apache went from 2.2 to 2.4 and ModSec from 2.5 to 2.9. I can not really tell if it is still around.", "id": 195158, "time": "2016-11-23T05:15:18Z", "bug_id": 50024, "creation_time": "2016-11-23T05:15:18Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 50024, "attachment_id": 34470, "id": 195165, "creation_time": "2016-11-23T15:39:26Z", "time": "2016-11-23T15:39:26Z", "creator": "lawrence.huang@ericsson.com", "text": "Created attachment 34470\nApache configuration\n\nwhen using the cache enable configuration, the 103 error code come very often", "is_private": false}, {"count": 11, "tags": [], "creator": "lawrence.huang@ericsson.com", "attachment_id": 34471, "text": "Created attachment 34471\na lot of 103 coming in the error-log\n\nplease share it is relative to the client side issues or server side as well ?", "id": 195166, "time": "2016-11-23T15:40:54Z", "bug_id": 50024, "creation_time": "2016-11-23T15:40:54Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 50024, "attachment_id": null, "text": "both error log and configuration are uploaded now. please help to check", "id": 195167, "time": "2016-11-23T15:41:29Z", "creator": "lawrence.huang@ericsson.com", "creation_time": "2016-11-23T15:41:29Z", "is_private": false}]
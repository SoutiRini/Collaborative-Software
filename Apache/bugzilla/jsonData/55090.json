[{"attachment_id": null, "tags": [], "creator": "vitus@wagner.pp.ru", "is_private": false, "count": 0, "id": 167777, "time": "2013-06-11T15:24:14Z", "bug_id": 55090, "creation_time": "2013-06-11T15:24:14Z", "text": "When build apr-1.4.6 using command\nrpmbuild -tb --target i386-redhat-linux-gnu apr-1.4.6.tar.bz2 on 64-bit RHEL5 machine following step fails:\n\n%check \n # Run non-interactive tests\n pushd test\n make %{?_smp_mflags} all CFLAGS=-fno-strict-aliasing\n make check || exit 1\n popd\n\nbecause test executables are compiled into 64-bit object files and cannot be linked with correctly build 32-bit shared library.\n\nInvestigation shows that it is due to overriding of CFLAGS environment variable, which removes -m32 switch placed into CFLAGS by configure script.\n\nChanging this line to \n\nmake %{?_smp_mflags} all EXTRA_CFLAGS=\"-pthread  -fno-strict-aliasing\"\n\nfixes this problem and allows to build both 32-bit and 64-bit RPMs on same machine. \"-phread\" is copied from the original value of EXTRA_CFLAGS in the build/apr_rules.mk\n\nP.S. Same problem with same fix exists in the apr-util-1.5.2"}, {"count": 1, "tags": [], "creator": "minfrin@sharp.fm", "attachment_id": null, "is_private": false, "id": 167855, "time": "2013-06-16T13:02:33Z", "bug_id": 55090, "creation_time": "2013-06-16T13:02:33Z", "text": "I doubt this is the correct fix - when you're cross compiling (which is what you've be doing if attempting to build code for a 32 bit machine on a 64 bit machine), you can't really run the test suite, because the test suite, which runs locally, doesn't have a local 64 bit library to bind to.\n\nI think cross compiling should cause the test suite to be suppressed."}]
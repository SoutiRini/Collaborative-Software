[{"count": 0, "tags": [], "text": "Created attachment 32715\nSample code demonstrating slow performance\n\nThe attached Java compares the time taken to loop over sheet.getMergedRegion(i) for all i, versus the same operation by direct access to the deprecated CTMergeCells.getMergeCellArray().\n\nThe sample input I will attach, many-merges.xlsx, has 50k merged regions and I get 8000ms vs 80ms. The real-world input I found this with has 250k merged regions and takes ~300 seconds vs ~300ms.\n\nThe reason seems to be:\n\nXSSFSheet.getMergedRegion(int)\n-> CTMergeCells.getMergeCellArray(int)\n-> Xobj.find_element_user(QName, int)\n\nwhich does:\n\n    for ( Xobj x = _firstChild ; x != null ; x = x._nextSibling )\n      if (x.isElem() && x._name.equals( name ) && --i < 0)\n        return x.getUser();\n\nSo for each mergeCell you access you must compare the element name of every previous mergeCell, whereas the deprecated CTMergeCells.getMergeCellArray() uses find_all_element_users(), avoiding O(n^2).\n\nWould you be interested in a patch? The only thing is, it seems the change should be in CTMergeCells in ooxml-schemas, which seems to be generated(?) and I'm not sure what generates it, or why getMergeCellArray() (the only fast method) is deprecated. getMergeCellList() exists but only hands out a wrapper around the slow getMergeCellArray(int).", "is_private": false, "id": 182846, "creator": "cmb-apache@corefiling.co.uk", "time": "2015-05-05T16:23:34Z", "bug_id": 57893, "creation_time": "2015-05-05T16:23:34Z", "attachment_id": 32715}, {"count": 1, "tags": [], "bug_id": 57893, "attachment_id": 32716, "is_private": false, "id": 182847, "time": "2015-05-05T16:24:03Z", "creator": "cmb-apache@corefiling.co.uk", "creation_time": "2015-05-05T16:24:03Z", "text": "Created attachment 32716\nSample input with 50000 merged regions"}, {"count": 2, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "We tried asking the XMLBeans project about the deprecation of the Array getter, but never really got an answer... In other places where speed matters, we've used the array getter with an @ignore for the deprecation. If that would help here, we'd love a patch for it!", "id": 182848, "time": "2015-05-05T16:29:20Z", "bug_id": 57893, "creation_time": "2015-05-05T16:29:20Z", "is_private": false}, {"count": 3, "attachment_id": 32723, "bug_id": 57893, "is_private": false, "id": 182888, "time": "2015-05-08T09:51:30Z", "creator": "cmb-apache@corefiling.co.uk", "creation_time": "2015-05-08T09:51:30Z", "tags": [], "text": "Created attachment 32723\nSample input with 50000 merged regions\n\nPrevious sample input was smaller than stated (999 merges); here's one with the intended size (50000 merges)."}, {"count": 4, "tags": [], "bug_id": 57893, "attachment_id": 32724, "id": 182889, "time": "2015-05-08T10:09:07Z", "creator": "cmb-apache@corefiling.co.uk", "creation_time": "2015-05-08T10:09:07Z", "is_private": false, "text": "Created attachment 32724\nPatch\n\nHere's a patch adding Sheet.getMergedRegions(), implemented with the deprecated array getter as discussed."}, {"count": 5, "tags": [], "text": "(This is a git patch, including 1 binary file for the test.)", "is_private": false, "bug_id": 57893, "id": 182890, "time": "2015-05-08T10:10:07Z", "creator": "cmb-apache@corefiling.co.uk", "creation_time": "2015-05-08T10:10:07Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "dtn-asfbugs@corefiling.co.uk", "is_private": false, "id": 184012, "time": "2015-07-13T13:00:43Z", "bug_id": 57893, "creation_time": "2015-07-13T13:00:43Z", "tags": [], "text": "Patch applied. Fixed in r1690661"}, {"count": 7, "tags": [], "bug_id": 57893, "is_private": false, "text": "If there are no merged regions on a sheet, HSSF returns an empty List while XSSF raises an IllegalStateException. I would assume that both would behave the same: return an empty list and let the calling code check for empty list. No merged regions doesn't seem exceptional, and asking a user to check if numMergedRegions before all getMergedRegions seems unnecessary. My 2 cents.", "id": 184531, "time": "2015-08-13T03:50:53Z", "creator": "onealj@apache.org", "creation_time": "2015-08-13T03:50:53Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 57893, "attachment_id": null, "text": "Note: comment 7 was fixed under bug 58350", "id": 185629, "time": "2015-10-05T10:38:15Z", "creator": "dtn-asfbugs@corefiling.co.uk", "creation_time": "2015-10-05T10:38:15Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Using 2.2.3 on SUN/solaris and PC/suse-linux in a forward proxy configuration.\nWithout other http connections the ftp functionality is fine. With other http\nconnections the ftp starts to fail increasingly under http request load until it\nno longer functions. This is easily reproduced using one http connection/sec\nthrough the forward proxy. Although proxy_util.c(2141) says the connection is\ncomplete there are no connection attempts from the proxy to the destination\nserver. This was checked with snoop/tcpdump. In the example below note the\nhostname as www.gatesec.net for the ftp.suse.org address (195.135.221.132).\n\nSuccessful connections show this:\nSep  5 23:34:48 hereford fproxy1: [Tue Sep 05 23:34:48 2006] [debug]\nmod_proxy_ftp.c(894): proxy: FTP: connecting ftp://ftp.suse.com/ to ftp.suse.com:21\nSep  5 23:34:48 hereford fproxy1: [Tue Sep 05 23:34:48 2006] [debug]\nproxy_util.c(2141): proxy: FTP: connection complete to 195.135.221.132:21 ((null))\n\nUnsuccessful connections show this when using one connection/sec to\nhttp://www.gatesec.net:\nSep  5 23:45:19 hereford fproxy1: [Tue Sep 05 23:45:19 2006] [debug]\nmod_proxy_ftp.c(894): proxy: FTP: connecting ftp://ftp.suse.com/ to ftp.suse.com:21\nSep  5 23:45:19 hereford fproxy1: [Tue Sep 05 23:45:19 2006] [debug]\nproxy_util.c(2141): proxy: FTP: connection complete to 195.135.221.132:21\n(www.gatesec.net)\nSep  5 23:45:19 hereford fproxy1: [Tue Sep 05 23:45:19 2006] [debug]\nmod_proxy_ftp.c(981): proxy: FTP: control connection complete\nSep  5 23:45:21 hereford fproxy1: [Tue Sep 05 23:45:21 2006] [debug]\nmod_proxy_ftp.c(626): proxy:<FTP: 4294967295 <unable to read result>\nSep  5 23:45:21 hereford fproxy1: [Tue Sep 05 23:45:21 2006] [debug]\nproxy_util.c(1816): proxy: FTP: has released connection for (*)\nSep  5 23:45:21 hereford fproxy1: [Tue Sep 05 23:45:21 2006] [error] [client\n127.0.0.1] proxy: Error reading from remote server returned by ftp://ftp.suse.com/\nSep  5 23:45:21 hereford fproxy1: 127.0.0.1 - - [05/Sep/2006:23:45:19 +1000]\n\"GET ftp://ftp.suse.com/ HTTP/1.1\" 502 67 \"-\" \"Mozilla/5.0 (X11; U; Linux i686;\nen-US; rv:1.8.0.5) Gecko/20060719 Firefox/1.5.0.5\"\n\n/opt/chroot/fproxy-2.2.3/bin/httpd -l\nCompiled in modules:\n  core.c\n  mod_authn_file.c\n  mod_authn_default.c\n  mod_authz_host.c\n  mod_authz_groupfile.c\n  mod_authz_user.c\n  mod_authz_default.c\n  mod_auth_basic.c\n  mod_include.c\n  mod_filter.c\n  mod_log_config.c\n  mod_logio.c\n  mod_env.c\n  mod_headers.c\n  mod_proxy.c\n  mod_proxy_connect.c\n  mod_proxy_ftp.c\n  mod_proxy_http.c\n  mod_proxy_ajp.c\n  mod_proxy_balancer.c\n  worker.c\n  http_core.c\n  mod_status.c\n  mod_cgid.c\n  mod_dir.c\n\n/opt/chroot/fproxy-2.2.3/bin/httpd -V\nServer version: Apache/2.2.3\nServer built:   Sep  5 2006 22:33:20\nServer's Module Magic Number: 20051115:3\nServer loaded:  APR 1.2.7, APR-Util 1.2.7\nCompiled using: APR 1.2.7, APR-Util 1.2.7\nArchitecture:   32-bit\nServer MPM:     Worker\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/fproxy-2.2.3\"\n -D SUEXEC_BIN=\"/fproxy-2.2.3/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"", "attachment_id": null, "id": 93050, "creator": "jsnow27@gatesec.net", "time": "2006-09-05T14:41:39Z", "bug_id": 40416, "creation_time": "2006-09-05T14:41:39Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 40416, "attachment_id": null, "id": 106413, "time": "2007-08-06T16:02:42Z", "creator": "mpauley@apple.com", "creation_time": "2007-08-06T16:02:42Z", "is_private": false, "text": "I see this with 2.2.4 on Mac OS X 10.4.10 (ppc) compiled with \n\n ./configure --enable-mods=all --enable-mods-shared=all --enable-ssl -enable-deflate --enable-\nheaders --enable-proxy --enable-dav --prefix=/usr/local/apache2.2\n\nI can reproduce this fairly easily with a threaded ftp get via an ftp proxy."}, {"count": 2, "tags": [], "bug_id": 40416, "attachment_id": null, "id": 114313, "time": "2008-03-05T16:47:35Z", "creator": "jeffwu75@gmail.com", "creation_time": "2008-03-05T16:47:35Z", "is_private": false, "text": "maybe it's the same as #44543\nsomething wrong in the worker re-using stuff.\n\t\n\n"}]
[{"attachment_id": null, "tags": [], "creator": "m_pashka@mail.ru", "is_private": false, "count": 0, "id": 111901, "time": "2007-12-19T03:32:07Z", "bug_id": 44103, "creation_time": "2007-12-19T03:32:07Z", "text": "Start ANT using org.apache.tools.ant.Main class, specify something in the ANT\nclassloader.\nTry to get resource from your custom classpath as stream - it is ok.\nTry to get resource URL from your custom class path - it returns null.\nTry to load class from your custom class path - it fails.\n\n\nSeverity is major because it breaks using XML (JAXP) in standard way through\nDocumentBuilderFactory in case of specifying xerces.jar in ANT classpath.\nFactory can find properties file, defined in xerces.jar, but fails to load\nimplementation class from it.\n\n\nANT start script:\n%JAVA_HOME%\\bin\\java.exe -Xmx650M -cp\n%GLOBAL_BUILD_DIR%\\3rdparty\\xerces\\xercesImpl.jar org.apache.tools.ant.Main\n-listener org.apache.tools.ant.listener.Log4jListener\n\n\n\nANT task\n        <java classname=\"AntClassLoaderTest\" failonerror=\"true\" fork=\"false\" />\n\n\n\nAntClassLoaderTest code\n        ClassLoader cl = AntClassLoaderTest.class.getClassLoader();\n        URL url =\ncl.getResource(\"org/apache/xerces/jaxp/DocumentBuilderFactoryImpl.class\");\n        System.out.println(\"URL = \" + url);\n\n        InputStream in =\ncl.getResourceAsStream(\"org/apache/xerces/jaxp/DocumentBuilderFactoryImpl.class\");\n        System.out.println(\"in = \" + in);\n\n        byte[] buf = new byte[16];\n        in.read(buf);\n        boolean equals = Arrays.equals(buf, new byte[]{(byte) 0xCA, (byte) 0xFE,\n(byte) 0xBA, (byte) 0xBE, 0x00, 0x03, 0x00, 0x2D, 0x00, (byte) 0x8B, 0x0A, 0x00,\n0x29, 0x00, 0x47, 0x09});\n        in.close();\n        System.out.println(\"Equals = \" + equals);\n        System.out.println(\"Class loader = \" + cl);\n        try {\n            cl.loadClass(\"org.apache.xerces.jaxp.DocumentBuilderFactoryImpl\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n\n\n\nResult:\nURL is not found\nInputStream is found and equals to defined\nClass Loading failed\n\n\n     [java] URL = null\n     [java] in = sun.net.www.protocol.jar.JarURLConnection$JarURLInputStream@1ea8dbd\n     [java] Equals = true\n     [java] Class loader =\nAntClassLoader[C:\\Projects\\jnetx\\4.0\\jnetx\\slee\\slee-implementation\\build\\lib\\slee-implementation.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\dom4j\\dom4j-core.jar;C:\\Projects\\jnetx\\4.\n0\\build\\3rdparty\\dom4j\\dom4j-full.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\dom4j\\dom4j.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\excalibur-naming\\excalibur-naming-1.0.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\\njain-slee-specification\\jain-slee-specification.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\jarv\\isorelax.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\jaxen\\jaxen.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\jaxen\\saxp\nath.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\jta\\jta-1.0.1.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\log4j\\log4j.jar;C:\\Projects\\jnetx\\4.0\\build\\3rdparty\\xerces-jarv\\XercesJARV.jar;C:\\Projects\\jnetx\\4.0\\build\n\\comp\\configuration-core\\configuration-core.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\container\\lib\\container-test.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\container\\lib\\container.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\n\\container\\lib\\util-test.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\dsm-api\\lib\\dsm-api.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\dsm-api\\lib\\test-dsm-api.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\gms-api\\lib\\gms-api.jar;C:\n\\Projects\\jnetx\\4.0\\build\\comp\\gms-api\\lib\\test-gms-api.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\slee-lib\\jnetx-types.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\slee-lib\\lib\\slee-lib.jar;C:\\Projects\\jnetx\\4.0\\build\\co\nmp\\slee-lib\\slee-core.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\slee-lib\\standard-types.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\util\\lib\\util-test.jar;C:\\Projects\\jnetx\\4.0\\build\\comp\\util\\lib\\util.jar]\n     [java] java.lang.ClassNotFoundException:\norg.apache.xerces.jaxp.DocumentBuilderFactoryImpl\n     [java]     at\norg.apache.tools.ant.AntClassLoader.findClassInComponents(AntClassLoader.java:1383)\n     [java]     at\norg.apache.tools.ant.AntClassLoader.findClass(AntClassLoader.java:1324)\n     [java]     at\norg.apache.tools.ant.AntClassLoader.loadClass(AntClassLoader.java:1078)\n     [java]     at java.lang.ClassLoader.loadClass(ClassLoader.java:251)\n     [java]     at\ncom.jnetx.slee.standalone.deployment.DeploymentUnitPrecompiler.main(DeploymentUnitPrecompiler.java:73)\n     [java]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n     [java]     at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n     [java]     at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n     [java]     at java.lang.reflect.Method.invoke(Method.java:597)\n     [java]     at\norg.apache.tools.ant.taskdefs.ExecuteJava.run(ExecuteJava.java:217)\n     [java]     at\norg.apache.tools.ant.taskdefs.ExecuteJava.execute(ExecuteJava.java:152)\n     [java]     at org.apache.tools.ant.taskdefs.Java.run(Java.java:747)\n     [java]     at org.apache.tools.ant.taskdefs.Java.executeJava(Java.java:201)\n     [java]     at org.apache.tools.ant.taskdefs.Java.execute(Java.java:104)\n     [java]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n     [java]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n     [java]     at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n     [java]     at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n     [java]     at java.lang.reflect.Method.invoke(Method.java:597)\n     [java]     at\norg.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)\n     [java]     at org.apache.tools.ant.Task.perform(Task.java:348)\n     [java]     at org.apache.tools.ant.Target.execute(Target.java:357)\n     [java]     at org.apache.tools.ant.Target.performTasks(Target.java:385)\n     [java]     at\norg.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)\n     [java]     at org.apache.tools.ant.Project.executeTarget(Project.java:1298)\n     [java]     at\norg.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n     [java]     at org.apache.tools.ant.Project.executeTargets(Project.java:1181)\n     [java]     at org.apache.tools.ant.Main.runBuild(Main.java:698)\n     [java]     at org.apache.tools.ant.Main.startAnt(Main.java:199)\n     [java]     at org.apache.tools.ant.Main.start(Main.java:161)\n     [java]     at org.apache.tools.ant.Main.main(Main.java:250)"}, {"count": 1, "tags": [], "bug_id": 44103, "is_private": false, "text": "Created attachment 21292\nFull logs attached", "id": 111902, "time": "2007-12-19T03:34:41Z", "creator": "m_pashka@mail.ru", "creation_time": "2007-12-19T03:34:41Z", "attachment_id": 21292}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "count": 2, "id": 129355, "time": "2009-07-31T09:04:52Z", "bug_id": 44103, "creation_time": "2009-07-31T09:04:52Z", "text": "fixed in svn revision 799650"}]
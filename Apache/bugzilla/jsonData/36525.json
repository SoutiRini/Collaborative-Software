[{"count": 0, "tags": [], "bug_id": 36525, "attachment_id": null, "id": 79464, "time": "2005-09-06T20:26:22Z", "creator": "drees76@gmail.com", "creation_time": "2005-09-06T20:26:22Z", "is_private": false, "text": "On SGI IRIX mod_jk 1.2.14.1 crashes on every request in jk_lb_worker.c line 605.\n Going back to 1.2.11 works fine.  Stack trace below:\n\n>  0 service(e = 0x1035afe8, s = 0x7fff2b28, l = 0x10281f68, is_error =\n0x7fff1af4)\n[\"/tmp/jakarta-tomcat-connectors-1.2.14.1-src/jk/native/common/jk_lb_worker.c\":605,\n0x4315080]\n  1 jk_handler(r = 0x103719a0)\n[\"/tmp/jakarta-tomcat-connectors-1.2.14.1-src/jk/native/apache-2.0/mod_jk.c\":1889,\n0x4305648]\n  2 ap_run_handler(r = 0x103719a0)\n[\"/tmp/httpd-2.0.54/server/config.c\":152, 0x1008b624]\n  3 ap_invoke_handler(r = 0x103719a0)\n[\"/tmp/httpd-2.0.54/server/config.c\":364, 0x1008c390]\n  4 ap_process_request(r = 0x103719a0)\n[\"/tmp/httpd-2.0.54/modules/http/http_request.c\":249, 0x10071990]\n  5 ap_process_http_connection(c = 0x10365460)\n[\"/tmp/httpd-2.0.54/modules/http/http_core.c\":251, 0x10070f78]\n  6 ap_run_process_connection(c = 0x10365460)\n[\"/tmp/httpd-2.0.54/server/connection.c\":43, 0x100a3e94]\n  7 ap_process_connection(c = 0x10365460, csd = 0x10365378)\n[\"/tmp/httpd-2.0.54/server/connection.c\":176, 0x100a4568]\n  8 child_main(child_num_arg = 0)\n[\"/tmp/httpd-2.0.54/server/mpm/prefork/prefork.c\":610, 0x1007c444]\n  9 make_child(s = 0x102941c0, slot = 0)\n[\"/tmp/httpd-2.0.54/server/mpm/prefork/prefork.c\":704, 0x1007c6ac]\n  10 startup_children(number_to_start = 5)\n[\"/tmp/httpd-2.0.54/server/mpm/prefork/prefork.c\":722, 0x1007c75c]\n  11 ap_mpm_run(_pconf = 0x1025aac0, plog = 0x1028cb88, s =\n0x102941c0) [\"/tmp/httpd-2.0.54/server/mpm/prefork/prefork.c\":941,\n0x1007cda0]\n  12 main(argc = 3, argv = 0x7fff2f44)\n[\"/tmp/httpd-2.0.54/server/main.c\":618, 0x100b1c48]\n  13 __start()\n[\"/xlv55/kudzu-apr12/work/irix/lib/libc/libc_n32_M3/csu/crt1text.s\":177,\n0x1004b9e8]"}, {"count": 1, "tags": [], "bug_id": 36525, "text": "First email sent to tomcat-dev:\nhttp://marc.theaimsgroup.com/?l=tomcat-dev&m=112501659012202&w=2\n\nAnother user has reported what appears to be the exact same crash on Solaris.  I\nam guessing that this is either some sort of 64-bit or big endian bug that does\nnot show up on i386 (where mod_jk 1.2.14.1 works fine for me)\n\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=112569118927613&w=2", "id": 79465, "time": "2005-09-06T20:28:27Z", "creator": "drees76@gmail.com", "creation_time": "2005-09-06T20:28:27Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "text": "Hi,\n\nCan you comment lines 605 and 606 in jk_lb_worker.c and see if\nit still core dumps.\nAlso, did you try to stop the previous version and delete .shm file?\nNou sure, but even reboot might be required if OS catched the shared memory.\nThe shared memory slot was enlarged with 1.2.14 version so the stuctures\nare different, and if old one are catched then the new one will core dump.", "id": 79486, "time": "2005-09-07T07:44:18Z", "bug_id": 36525, "creation_time": "2005-09-07T07:44:18Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 36525, "text": "I can confirm that I fully shut down Apache before installing the new mod_jk and\nstarting Apache back up.\n\nRemoving the mod_jk.shm after shutting down, installing the new module and\nstarting back up doesn't make a difference.\n\nUsing ipcs to view shared memory after Apache shutdown shows that Apache has\ncorrectly released the shared memory that was in use.\n\nHope to try commenting out the lines in the next day or 2.", "id": 79501, "time": "2005-09-07T11:25:27Z", "creator": "drees76@gmail.com", "creation_time": "2005-09-07T11:25:27Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 36525, "text": "Fixed in the CVS.\nThis was really strange. Seems that shared memory gets corrupted\nif 64 bit access is desired.\nCan you try the current HEAD?", "id": 79797, "time": "2005-09-12T15:03:44Z", "creator": "mturk@apache.org", "creation_time": "2005-09-12T15:03:44Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 36525, "attachment_id": null, "id": 79842, "time": "2005-09-13T00:38:56Z", "creator": "drees76@gmail.com", "creation_time": "2005-09-13T00:38:56Z", "is_private": false, "text": "Checked out from CVS today, and can confirm that the new build appears to work\nproperly.\n\nThanks!"}, {"count": 6, "tags": [], "bug_id": 36525, "text": "Created attachment 16424\nCorrect misalignment\n\nThere is an alignment problem in the shared memory. The bug only shows up, when\ngcc is used with \"-O\" or \"-O2\".", "id": 80023, "time": "2005-09-16T01:03:51Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2005-09-16T01:03:51Z", "is_private": false, "attachment_id": 16424}, {"count": 7, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "I reopen the bug, because:\n\n- I think the above patch will resolve the problem and still allow to use 64 Bit\ncounters\n- I think that without the patch there might result further cores when the\nmembers of the structs in the shared memory are changed in the future (even\nwithout 64 Bit members)\n", "id": 80024, "time": "2005-09-16T01:05:34Z", "bug_id": 36525, "creation_time": "2005-09-16T01:05:34Z", "is_private": false}, {"count": 8, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "Mladen Turk applied the patch. Thanks!", "id": 80028, "time": "2005-09-16T08:55:09Z", "bug_id": 36525, "creation_time": "2005-09-16T08:55:09Z", "is_private": false}, {"id": 80068, "tags": [], "creator": "drees76@gmail.com", "attachment_id": null, "count": 9, "text": "I just tried compiling on IRIX using latest CVS, but the modified jk_shm.c does\nnot compile using the SGI CC compiler:\n\n\"jk_shm.c\", line 50: warning(1040): expected an identifier\n\nApparently the compiler doesn't like the union inside of the struct.  Removing\nthe union makes it compile and seems to function OK as well (sorry, even though\nmy C is a bit rusty my change sure looks like a hack!):\n\ndiff -u -r1.20 jk_shm.c\n--- common/jk_shm.c     16 Sep 2005 05:52:26 -0000      1.20\n+++ common/jk_shm.c     17 Sep 2005 09:43:10 -0000\n@@ -43,10 +43,8 @@\n /** jk shm header record structure */\n struct jk_shm_header\n {\n-    union {\n-        jk_shm_header_data_t data;\n-        char alignbuf[JK_SHM_ALIGN(sizeof(jk_shm_header_data_t))];\n-    };\n+    jk_shm_header_data_t data;\n+    char alignbuf[JK_SHM_ALIGN(sizeof(jk_shm_header_data_t))];\n     char   buf[1];\n };\n\n", "time": "2005-09-17T11:50:06Z", "bug_id": 36525, "creation_time": "2005-09-17T11:50:06Z", "is_private": false}, {"count": 10, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "text": "The compiler probably does not like un named unions rather then\nunions itself.\n\nCan you try something like:\n\nunion {\n  ...\n  ...\n} h;\n\nOf course you will need to change the jk_shm.c code\nfor each 'hdr->data.XXX' to the 'hdr->h.data.XXX'\n \nTell me if that helps.\n", "id": 80069, "time": "2005-09-17T12:00:48Z", "bug_id": 36525, "creation_time": "2005-09-17T12:00:48Z", "is_private": false}, {"attachment_id": 16437, "tags": [], "creator": "drees76@gmail.com", "text": "Created attachment 16437\nunnamed-union.patch\n\nYes, that appears to compile and run OK.  Here is the attached diff I used\nagainst jk_shm.c.", "count": 11, "id": 80070, "time": "2005-09-17T12:32:53Z", "bug_id": 36525, "creation_time": "2005-09-17T12:32:53Z", "is_private": false}, {"count": 12, "tags": [], "text": "Hi,\n\nI have commited the patch. Can you double check with the current HEAD\nand close the issue if all is working.\n\nThanks.", "attachment_id": null, "id": 80071, "creator": "mturk@apache.org", "time": "2005-09-17T13:21:38Z", "bug_id": 36525, "creation_time": "2005-09-17T13:21:38Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "drees76@gmail.com", "text": "CVS head from earlier today works for me on SGI IRIX and Fedora Core 4.  Thanks!", "count": 13, "id": 80250, "time": "2005-09-21T07:19:06Z", "bug_id": 36525, "creation_time": "2005-09-21T07:19:06Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 36525, "text": "The user in\n\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=112569118927613&w=2\n\nreported, that CVS fixes the bug for him too.", "id": 80279, "time": "2005-09-21T21:04:37Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2005-09-21T21:04:37Z", "is_private": false, "attachment_id": null}]
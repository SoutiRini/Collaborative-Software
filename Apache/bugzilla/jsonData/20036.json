[{"count": 0, "tags": [], "creator": "corquinn@us.ibm.com", "is_private": false, "text": "On Windows Apache is stipping off trailing dots from the PATH_INFO Environment \nVariable.  Our CGI-Application is expecting a complete path and is getting only \na partial path as it is missing the last dot.  The URL works on our Host \nsystems without problem.  We have not tested this on AIX or Linux to see if the \nproblem exists there as well.  I have copied the URL and subsequent Environment \nVariables below for reference for both our Windows and MVS systems.  \nUnfortunately both URLs are behind a firewall so may not be accessible to you.  \nFeel free to query me for any additional information needed.\n\nThanks, \nCorey Quinn\nSoftware Engineer \nBookmanager Products  -  IBM\n\n\nWindows URL (windows NT 4.0 running Apache 2.0.45, problem also exists on \nWindows 2000 running Apache 2.0.40):  \n\nhttp://klinecor.raleigh.ibm.com/cgi-bin/bookmgr/bookmgr.exe/BOOKS/TEMPLWP2/1.2.?\nDT=20030515114849\n\nEnvironment Variable Dump:\n\n******************************************************\nDebug log for CGI invocation: Mon May 19 09:58:20 2003\nargv[0]=C:\\Program Files\\Apache Group\\Apache2\\cgi-bin\\bookmgr\\bookmgr.exe, \ncw0=C:\\Program Files\\Apache Group\\Apache2\\cgi-bin\\bookmgr\\, cwd=C:\\PROGRA~1\n\\APACHE~1\\Apache2\\cgi-bin\\bookmgr\\\n******************************************************\n\n*********************\nEnvironment variables\n*********************\nSERVER_SOFTWARE=Apache/2.0.45 (Win32)\nSERVER_NAME=klinecor.raleigh.ibm.com\nGATEWAY_INTERFACE=CGI/1.1\nSERVER_PROTOCOL=HTTP/1.1\nSERVER_PORT=80\nREQUEST_METHOD=GET\nHTTP_ACCEPT=image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, \napplication/vnd.ms-powerpoint, application/vnd.ms-excel, application/msword, \napplication/x-quickviewplus, */*\nHTTP_HOST=klinecor.raleigh.ibm.com\nHTTP_USER_AGENT=Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 4.0)\nHTTPS=\nPATH_INFO=/BOOKS/TEMPLWP2/1.2\nPATH_TRANSLATED=C:\\Program Files\\Apache Group\\Apache2\\htdocs\\BOOKS\\TEMPLWP2\\1.2\nSCRIPT_NAME=/cgi-bin/bookmgr/bookmgr.exe/BOOKS/TEMPLWP2/1.2.\nQUERY_STRING=DT=20030515114849\nREMOTE_HOST=\nREMOTE_ADDR=9.27.13.19\nREMOTE_USER=\nAUTH_TYPE=\nCONTENT_TYPE=\nCONTENT_LENGTH=\n\n\nMVS URL (Host z/OS V1R2 system running IBM HTTP Server):\n\nhttp://ctfmvs14.raleigh.ibm.com:3080/bookmgr-cgi/EPHBOOKT/BOOKS/TEMPLWP2/1.2.?\nDT=20030515114849\n\nEnvironment Variable dump for Host System:\n\n******************************************************\nDebug log for CGI invocation: Mon May 19 10:00:59 2003\nargv[0]=/u/booksrv/dev/cgi-bin/EPHBOOKT, cw0=/u/booksrv/dev/cgi-bin/, \ncwd=/u/booksrv/dev/cgi-bin/\n******************************************************\n\n*********************\nEnvironment variables\n*********************\nSERVER_SOFTWARE=IBM HTTP Server/V5R3M0\nSERVER_NAME=CTFMVS14.raleigh.ibm.com\nGATEWAY_INTERFACE=CGI/1.1\nSERVER_PROTOCOL=HTTP/1.1\nSERVER_PORT=3080\nREQUEST_METHOD=GET\nHTTP_ACCEPT=image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, \napplication/vnd.ms-powerpoint, application/vnd.ms-excel, application/msword, \napplication/x-quickviewplus, */*\nHTTP_HOST=ctfmvs14.raleigh.ibm.com\nHTTP_USER_AGENT=Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 4.0)\nHTTPS=OFF\nPATH_INFO=/BOOKS/TEMPLWP2/1.2.\nPATH_TRANSLATED=/usr/lpp/internet/server_root/pub/BOOKS/TEMPLWP2/1.2.\nSCRIPT_NAME=/bookmgr-cgi/EPHBOOKT\nQUERY_STRING=DT=20030515114849\nREMOTE_HOST=\nREMOTE_ADDR=9.27.13.19\nREMOTE_USER=\nAUTH_TYPE=\nCONTENT_TYPE=\nCONTENT_LENGTH=", "id": 37432, "time": "2003-05-19T14:37:20Z", "bug_id": 20036, "creation_time": "2003-05-19T14:37:20Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 20036, "is_private": false, "count": 1, "id": 64744, "time": "2004-10-07T12:11:57Z", "creator": "kerry@lothrop.de", "creation_time": "2004-10-07T12:11:57Z", "text": "The problem also strips off trailing dots from any path element:\n\nFor example, if I call\n\nhttp://localhost/cgi-bin/test.exe/test./test./\n\nPATH_INFO is only set to\n\n/test/test/\n\nThe same applies to PATH_TRANSLATED. In the source, I found the following in\nfunction apr_filepath_merge (filepath.c:626):\n\n/* Truncate all trailing spaces and all but the first two dots */\nsegend = seglen;\nwhile (seglen && (addpath[seglen - 1] == ' ' \n               || addpath[seglen - 1] == '.')) {\n    if (seglen > 2 || addpath[seglen - 1] != '.' || addpath[0] != '.')\n        --seglen;\n    else\n        break;\n}\n\nSo the stipping of trailing dots seems to be intentional for some reason, yet it\nwas surely written for real file names, not additional information provided for\nthe PATH_INFO variable.\n\nAs a workaround, I am now using REQUEST_URI and stripping/decoding it\nappropriately, yet I still think this is a bug in Apache.\n\nThe problem is still around in Apache 2.0.52, only on Win32, Netware and OS/2.\n\n\nKerry W. Lothrop"}, {"attachment_id": null, "tags": [], "bug_id": 20036, "text": "I believe that this behaviour is by design because Windows cannot differentiate\nbetween filenames like \"foo.\" and \"foo\"; marking WONTFIX unless some Win32er can\nprovide enlightenment.", "count": 2, "id": 73265, "time": "2005-04-04T17:23:46Z", "creator": "jorton@redhat.com", "creation_time": "2005-04-04T17:23:46Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 20036, "text": "I still believe this to be a bug. I just stumbled across it again while trying \nto get my CGI application running under IIS. My workaround (using REQUEST_URI) \ndoesn't work there since REQUEST_URI is not provided (it doesn't appear in the \nCGI specs either). However, PATH_INFO is set correctly there, even if a path \nelement ends with a dot.\n\nI believe Apache should not strip the dots off PATH_INFO or PATH_TRANSLATED \nsince the CGI application expecting the variables has no other way to figure \nout the actual request.", "count": 3, "id": 76128, "time": "2005-06-07T15:10:54Z", "creator": "kerry@lothrop.de", "creation_time": "2005-06-07T15:10:54Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 20036, "is_private": false, "count": 4, "id": 104263, "time": "2007-06-09T07:17:10Z", "creator": "davi@apache.org", "creation_time": "2007-06-09T07:17:10Z", "text": "The reporter might have a point here, because according to CGI 1.1 specification\nPATH_INFO is the \"extra path information, _as given by the client_\" (emphasis\nmine). Since in Windows \"foo\" and \"foo.\" are roughly the same file, apache should\nhave preserved the path information as given by the client.\n\nAs for PATH_TRANSLATED, apache don't need to preserve the path information\nbecause it's a server provided translation (virtual-to-physical mapping) of PATH_INFO."}, {"count": 5, "tags": [], "creator": "wrowe@apache.org", "is_private": false, "text": "100% agreed with Davi's suggestion, PATH_TRANSLATED should clean up the\ninformation into canonical form, however PATH_INFO should not.  I concur\nwith the reporter that the PATH_INFO behavior is a bug.", "id": 104275, "time": "2007-06-10T05:28:34Z", "bug_id": 20036, "creation_time": "2007-06-10T05:28:34Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 20036, "is_private": false, "count": 6, "id": 104492, "time": "2007-06-18T03:50:22Z", "creator": "davi@apache.org", "creation_time": "2007-06-18T03:50:22Z", "text": "*** Bug 42686 has been marked as a duplicate of this bug. ***"}]
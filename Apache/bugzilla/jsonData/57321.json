[{"attachment_id": null, "tags": [], "creator": "bhatt.chaitanya@gmail.com", "text": "BackendListener reports metrics from only 1 slave, it fails to aggregate results across multiple slave instance.\n\nI had 4 slave instance which generates about 1000 TPS (aggregate), with each instance contributing 250TPS (responses/sec). However, with InfluxDB as the backend client and Jmeter BackendListener as the data source, I see only 250 TPS as the aggregate TPS instead of 1000 TPS.\n\nHere is the influxdb query i used: \"select value from  jmeter.cumulated.total where time > now() -5m\"\n\nInfluxDB output:\ntime\tsequence_number\tvalue\n1417900538000\t1\t250\n1417900537000\t1\t250\n....\n\n\nThreatGroup\n|\n|\nTransactionController\n---|\n   |\n   HTTPTestSample\n|\n|\nBackendListener\n\n\n\n\n\n\nBackendListener Config is as below:\n\n\n\n     <BackendListener guiclass=\"BackendListenerGui\" testclass=\"BackendListener\" testname=\"Backend Listener\" enabled=\"true\">\n          <elementProp name=\"arguments\" elementType=\"Arguments\" guiclass=\"ArgumentsPanel\" testclass=\"Arguments\" enabled=\"true\">\n            <collectionProp name=\"Arguments.arguments\">\n              <elementProp name=\"graphiteMetricsSender\" elementType=\"Argument\">\n                <stringProp name=\"Argument.name\">graphiteMetricsSender</stringProp>\n                <stringProp name=\"Argument.value\">org.apache.jmeter.visualizers.backend.graphite.TextGraphiteMetricsSender</stringProp>\n                <stringProp name=\"Argument.metadata\">=</stringProp>\n              </elementProp>\n              <elementProp name=\"graphiteHost\" elementType=\"Argument\">\n                <stringProp name=\"Argument.name\">graphiteHost</stringProp>\n                <stringProp name=\"Argument.value\">jmeterInfluxDBHost.ie.bigcorp.net</stringProp>\n                <stringProp name=\"Argument.metadata\">=</stringProp>\n              </elementProp>\n              <elementProp name=\"graphitePort\" elementType=\"Argument\">\n                <stringProp name=\"Argument.name\">graphitePort</stringProp>\n                <stringProp name=\"Argument.value\">2003</stringProp>\n                <stringProp name=\"Argument.metadata\">=</stringProp>\n              </elementProp>\n              <elementProp name=\"rootMetricsPrefix\" elementType=\"Argument\">\n                <stringProp name=\"Argument.name\">rootMetricsPrefix</stringProp>\n                <stringProp name=\"Argument.value\">jmeter.</stringProp>\n                <stringProp name=\"Argument.metadata\">=</stringProp>\n              </elementProp>\n              <elementProp name=\"summaryOnly\" elementType=\"Argument\">\n                <stringProp name=\"Argument.name\">summaryOnly</stringProp>\n                <stringProp name=\"Argument.value\">false</stringProp>\n                <stringProp name=\"Argument.metadata\">=</stringProp>\n              </elementProp>\n              <elementProp name=\"samplersList\" elementType=\"Argument\">\n                <stringProp name=\"Argument.name\">samplersList</stringProp>\n                <stringProp>HTTPTestSample</stringProp>\n              </elementProp>\n              <elementProp name=\"percentiles\" elementType=\"Argument\">\n                <stringProp name=\"Argument.name\">percentiles</stringProp>\n                <stringProp name=\"Argument.value\">90;95;99</stringProp>\n                <stringProp name=\"Argument.metadata\">=</stringProp>\n              </elementProp>\n            </collectionProp>\n          </elementProp>\n          <stringProp name=\"classname\">org.apache.jmeter.visualizers.backend.graphite.GraphiteBackendListenerClient</stringProp>\n        </BackendListener>", "count": 0, "id": 179589, "time": "2014-12-06T21:27:03Z", "bug_id": 57321, "creation_time": "2014-12-06T21:27:03Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57321, "attachment_id": null, "text": "Hi,\nAre you using distributed mode or running 4 independant jmeter instances ?\n\nThanks", "id": 179590, "time": "2014-12-06T22:15:31Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-12-06T22:15:31Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "bhatt.chaitanya@gmail.com", "text": "(In reply to Philippe Mouawad from comment #1)\n> Hi,\n> Are you using distributed mode or running 4 independant jmeter instances ?\n> \n> Thanks\n\nI am running the test in distributed mode. \n\nPlease note that, I confirmed the actual response/second(Throughput) is equal to 1000 using server side monitoring tool(new relic). \n\nFeel free to let me know any more tests/artifacts you may require to resolve this issue.\n\nRegards,\nChaitanya  M Bhatt", "count": 2, "id": 179591, "time": "2014-12-06T23:10:56Z", "bug_id": 57321, "creation_time": "2014-12-06T23:10:56Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Date: Sun Dec  7 20:38:33 2014\nNew Revision: 1643716\n\nURL: http://svn.apache.org/r1643716\nLog:\nBug 57321 - BackendListener reports wrong number of Active Users in master-slave configuration (nightly build r1642603)\nBugzilla Id: 57321\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/visualizers/backend/UserMetric.java\n    jmeter/trunk/src/components/org/apache/jmeter/visualizers/backend/graphite/GraphiteBackendListenerClient.java\n    jmeter/trunk/xdocs/changes.xml", "count": 3, "id": 179602, "time": "2014-12-07T20:38:59Z", "bug_id": 57321, "creation_time": "2014-12-07T20:38:59Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 57321, "is_private": false, "text": "@Chaitanya Bhatt, \ncould you give us feedback on the new nightly build ?\nThanks\nRegards", "id": 179667, "time": "2014-12-09T20:56:13Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-12-09T20:56:13Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 57321, "attachment_id": null, "id": 179676, "time": "2014-12-09T22:52:05Z", "creator": "bhatt.chaitanya@gmail.com", "creation_time": "2014-12-09T22:52:05Z", "is_private": false, "text": "(In reply to Philippe Mouawad from comment #4)\n> @Chaitanya Bhatt, \n> could you give us feedback on the new nightly build ?\n> Thanks\n> Regards\n\n\nPhilippe,\n\nYou have done a mind blowing job! I verified that the cumulated  metrics for response time and users are working fine. However, I am still not sure about the \"success\" and \"total\" columns. I see a huge discrepancy in the \"total success / second\" reported by BackendListener and the perf wrapper which I use to aggregate results form slave instances.  \n\nI am doing a lot of R&D on this, I will promptly let you know the results.\n\nOnce more, this feature is such a big leap for Jmeter; I just cannot enumerate the number of benefits this feature offers the user community.\n\nBrilliant work!!!\n\nChaitanya M Bhatt"}, {"attachment_id": 32285, "tags": [], "bug_id": 57321, "is_private": false, "count": 6, "id": 179723, "time": "2014-12-11T22:48:50Z", "creator": "bhatt.chaitanya@gmail.com", "creation_time": "2014-12-11T22:48:50Z", "text": "Created attachment 32285\nGrafana output\n\nNotice that there is no effect on the Total transactions reported to InfluxDB by the BackendListener even after bumping up the thread."}, {"count": 7, "tags": [], "bug_id": 57321, "attachment_id": null, "is_private": false, "id": 179724, "time": "2014-12-11T22:57:30Z", "creator": "bhatt.chaitanya@gmail.com", "creation_time": "2014-12-11T22:57:30Z", "text": "(In reply to Chaitanya Bhatt from comment #6)\n> Created attachment 32285 [details]\n> Grafana output\n> \n> Notice that there is no effect on the Total transactions reported to\n> InfluxDB by the BackendListener even after bumping up the thread.\n\nPhilippe,\n\nTo add more info on this issue: \nThe cumulated total,success an failure value does not seem to show values from more than 1 jmeter agent when executed in distributed mode. \nI confirmed this by running a query against InfluxDb:\nselect sum(value) from jmeter.cumulated.total where time > now() - 10m\nimmediately after finishing the test and saw that the query returned only half as much many of transaction executed.\n\nFor comparison purpose I had the summary report listener turned ON, which reported accurate metrics and this helped me prove that there is indeed a discrepancy in BackendListener. \n\nHowever, the fix in r1643716 seems to have fixed the cumulated thread count issue. It does reflect total thread accurately when run in distributed mode.\n\nI also suspect individual success and failure metrics are also not accurate. However, I am"}, {"attachment_id": null, "tags": [], "bug_id": 57321, "is_private": false, "count": 8, "id": 179744, "time": "2014-12-12T22:30:53Z", "creator": "support@ubikloadpack.com", "creation_time": "2014-12-12T22:30:53Z", "text": "Hi Chaitanya,\nI found issue, I will be implementing the fix in upcoming days.\n\nThanks for your tests"}, {"count": 9, "tags": [], "bug_id": 57321, "is_private": false, "text": "Philippe,\n\nFrom a feature design point of view, do you think it would make sense for the slave instances in distributed mode to directly write \"individual sampler results\" to graphite and for cumulated metrics each child instance should cumulate its results and directly send it graphite as well, leaving Jmeter master server instance completely free from doing any of these tasks. This design would be great from a scalability point of view. \n\nIf it is too late to make such changes, then we should at least consider to make this as an option in the BackendListener, where user could choose to select Jmeter master to do all the sampler result collection,aggregation and sending of data to graphite OR could choose an option where all the slave instances could directly send data to graphite. \n\nIn my opinion, the key to successful adoption of BackendListener is if it enables Jmeter to overcome its biggest limitation, which is, the ability to provide a way for the user to collect result metrics without taking a hit on the performance of Jmeter server itself.\n\nKindly let me know your opinion. If this is not the right place to carry on such discussion, please let me know the right forum where I can bring up this discussion.\n\n\nThanks\nChaitanya M Bhatt", "id": 179746, "time": "2014-12-13T07:23:55Z", "creator": "bhatt.chaitanya@gmail.com", "creation_time": "2014-12-13T07:23:55Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Hi Chaitanya,\nFirst thanks for your early tests, they really help a lot.\nRegarding your proposal, can you raise a discussion on dev mailing list mentionning this Bugzilla.\nHaving each backendlistener its data is possible I think but it is an important change.\nMaybe the next step once this feature is fully operational (not a lot work as is seems)\n\nRegards\nPhilippe", "count": 10, "id": 179747, "time": "2014-12-13T08:01:30Z", "bug_id": 57321, "creation_time": "2014-12-13T08:01:30Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 57321, "is_private": false, "text": "Date: Sun Dec 14 21:57:17 2014\nNew Revision: 1645532\n\nURL: http://svn.apache.org/r1645532\nLog:\nBug 57321 - BackendListener reports partial results in master-slave configuration (nightly build r1642603)\nBugzilla Id: 57321\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/visualizers/backend/BackendListener.java\n    jmeter/trunk/src/components/org/apache/jmeter/visualizers/backend/SamplerMetric.java\n    jmeter/trunk/src/components/org/apache/jmeter/visualizers/backend/graphite/GraphiteBackendListenerClient.java\n    jmeter/trunk/xdocs/changes.xml", "id": 179759, "time": "2014-12-14T21:58:33Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-12-14T21:58:33Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "bhatt.chaitanya@gmail.com", "attachment_id": null, "is_private": false, "id": 179761, "time": "2014-12-15T00:52:58Z", "bug_id": 57321, "creation_time": "2014-12-15T00:52:58Z", "text": "Woohooo!!! Issue Fixed! Result looks beautiful! Awesome! Awesome! Awesome!\n\nGreat work!\n\nRegards,\nChaitanya M Bhatt"}, {"count": 13, "tags": [], "bug_id": 57321, "is_private": false, "text": "Created attachment 32289\nFinal graphana result screenshot confirming proportional increase in throughput after adding more slave instances", "id": 179762, "time": "2014-12-15T00:55:43Z", "creator": "bhatt.chaitanya@gmail.com", "creation_time": "2014-12-15T00:55:43Z", "attachment_id": 32289}, {"count": 14, "tags": [], "bug_id": 57321, "attachment_id": null, "id": 184026, "time": "2015-07-14T20:29:16Z", "creator": "nimish.vora@thomsonreuters.com", "creation_time": "2015-07-14T20:29:16Z", "is_private": false, "text": "I am using JMeter in client-server mode and using generic Backend Listener component for Graphite. When script is executed in standard mode, data is being sent back to Graphite DB. But, when script executed in client-server mode, Backend Listener does not send data to Graphite. Test is running fine as we are generating report and all data from all the server machines are successfully being aggregated by client machine after test.\n\nCan you guys help me if I need to setup anything additional to have Backend Listener work in client-server mode for JMeter version 2.13?"}, {"count": 15, "tags": [], "bug_id": 57321, "attachment_id": null, "text": "Hi Nimish V,\n\nIt seems to be an issue that we cannot use any variables or properties in Backend listener context. It works when I used static values.\n\nExample,\nWe cannot use: graphiteHost = ${graphiteHost}\nIt works when: graphiteHost = 192.168.99.100", "id": 194008, "time": "2016-09-27T06:16:29Z", "creator": "sombat.wongsrisupphakul@gmail.com", "creation_time": "2016-09-27T06:16:29Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "sombat.wongsrisupphakul@gmail.com", "text": "(In reply to sombat.wongsrisupphakul from comment #15)\n> Hi Nimish V,\n> \n> It seems to be an issue that we cannot use any variables or properties in\n> Backend listener context. It works when I used static values.\n> \n> Example,\n> We cannot use: graphiteHost = ${graphiteHost}\n> It works when: graphiteHost = 192.168.99.100\n\nThis issue happen on distributed mode (Master-Slave) only.", "count": 16, "id": 194009, "time": "2016-09-27T06:19:02Z", "bug_id": 57321, "creation_time": "2016-09-27T06:19:02Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 57321, "is_private": false, "text": "(In reply to sombat.wongsrisupphakul from comment #16)\n> (In reply to sombat.wongsrisupphakul from comment #15)\n> > Hi Nimish V,\n> > \n> > It seems to be an issue that we cannot use any variables or properties in\n> > Backend listener context. It works when I used static values.\n> > \n> > Example,\n> > We cannot use: graphiteHost = ${graphiteHost}\n> > It works when: graphiteHost = 192.168.99.100\n> \n> This issue happen on distributed mode (Master-Slave) only.\n\nPlease use user mailing list for such questions.\nThis bug is already fixed and has no relation with your problem.\nThank you", "id": 194010, "time": "2016-09-27T06:36:47Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-09-27T06:36:47Z", "attachment_id": null}]
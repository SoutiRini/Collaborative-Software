[{"count": 0, "tags": [], "text": "I'm running Tomcat 7.0.52 (7.0.52-1ubuntu0.1) with jdbc-pool and I see this exception in catalina.out somewhat frequently:\n\nMar 30, 2015 11:44:44 PM org.apache.tomcat.jdbc.pool.interceptor.AbstractQueryReport createStatement\nWARNING: Unable to create statement proxy for slow query report.\njava.lang.NullPointerException\n        at org.apache.tomcat.jdbc.pool.interceptor.SlowQueryReport.prepareStatement(SlowQueryReport.java:122)\n\nAs far as I can tell, it appears unrelated to #51582. In this case, some condition causes getQueryStats() to return null:\n\n    public void prepareStatement(String sql, long time) {\n        QueryStats qs = getQueryStats(sql);\n        qs.prepare(time); // <--- LINE 122\n    }\n\nPlease let me know if you need any more info.", "attachment_id": null, "id": 182204, "creator": "mazurek@gmail.com", "time": "2015-03-31T19:33:19Z", "bug_id": 57783, "creation_time": "2015-03-31T19:33:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57783, "attachment_id": null, "id": 183705, "time": "2015-06-23T07:27:41Z", "creator": "kfujino@apache.org", "creation_time": "2015-06-23T07:27:41Z", "is_private": false, "text": "Thanks for the report.\n\nI examined the code of SlowQueryReport.\nThere were two problems that cause NPE.\n\nThe first is\nBecause SlowQueryReport#removeOldest has not been implemented correctly,\nIf multiple threads invoke the same query at the same time,\nIt is possible to return null.\n\nThe second is\nIf this Interceptor has executed a connection that had been closed by the removeAbandoned,\nIt is possible to return null.\n\nThe former issue has been fixed in r1686791 and r1686792, the latter issue has been fixed in r1686975 and r1686976.\nThese revisions are scheduled to be included in the release of Tomcat8.0.24, Tomcat 7.0.63 or later."}]
[{"count": 0, "tags": [], "bug_id": 40820, "attachment_id": null, "text": "With the latest TC6 code, I'm seeing a problem that did not exist on earlier TC6\ndrivers.  Sorry that I can't put a finger on when this problem arose.  I looked\ninto relevant source files (like JspRuntimeContext) but haven't found the source\nof the problem. \n\nHere's the issue (a testcase will be attached). \n\nThe app is very simple: it installs ServletContextListener for the purpose of\nadding a custom ELResolver.  It accomplishes this via: \n\n    public void contextInitialized(ServletContextEvent evt) { \n        ServletContext context = evt.getServletContext(); \n        JspApplicationContext jspContext =\nJspFactory.getDefaultFactory().getJspApplicationContext(context); \n        jspContext.addELResolver(new ChipsELResolver()); \n    } \n\n\nThe problem is that JspFactory.getDefaultFactory() is returning null; see below.\n\nOct 4, 2006 5:32:18 PM org.apache.catalina.core.AprLifecycleListener lifecycleEv \nent \nINFO: The Apache Tomcat Native library which allows optimal performance in produ \nction environments was not found on the java.library.path: C:\\javaFor6.0BuildJDK \n15\\java\\jre\\bin;.;C:\\javaFor6.0BuildJDK15\\java\\bin;c:\\mantis2.1\\mantis\\bin;C:\\se \ntupIBASE;C:\\Perl\\bin\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;c: \n\\Python22;C:\\Program Files\\PC-Doctor for Windows\\services;c:\\cvsnt-2.0.4;c:\\ecli \npse;w:\\;w:\\bin;C:\\Program Files\\QuickTime\\QTSystem\\;C:\\Diskeeper\\;C:\\CMVC\\exe;C: \n\\CMVC\\exe\\bin;;C:\\CMVCDC50;C:\\CMVCDC50;C:\\CMVCDC50; \nOct 4, 2006 5:32:18 PM org.apache.coyote.http11.Http11Protocol init \nINFO: Initializing Coyote HTTP/1.1 on http-8080 \nOct 4, 2006 5:32:19 PM org.apache.catalina.startup.Catalina load \nINFO: Initialization processed in 1234 ms \nOct 4, 2006 5:32:19 PM org.apache.catalina.core.StandardService start \nINFO: Starting service Catalina \nOct 4, 2006 5:32:19 PM org.apache.catalina.core.StandardEngine start \nINFO: Starting Servlet Engine: Apache Tomcat/6.0.0-dev \nOct 4, 2006 5:32:19 PM org.apache.catalina.core.StandardHost start \nINFO: XML validation disabled \nOct 4, 2006 5:32:19 PM org.apache.catalina.startup.HostConfig deployWAR \nINFO: Deploying web application archive ELResolverTest.war \nChipsListener.contextInitialized  evt= javax.servlet.ServletContextEvent[source= \norg.apache.catalina.core.ApplicationContextFacade@3fbe3fbe] \nChipsListener.contextInitialized  context= org.apache.catalina.core.ApplicationC \nontextFacade@3fbe3fbe \nChipsListener.contextInitialized  JspFactory.getDefaultFactory()= null \nOct 4, 2006 5:32:20 PM org.apache.catalina.core.StandardContext start \nSEVERE: Error listenerStart \nOct 4, 2006 5:32:20 PM org.apache.catalina.core.StandardContext start \nSEVERE: Context [/ELResolverTest] startup failed due to previous errors \nOct 4, 2006 5:32:21 PM org.apache.coyote.http11.Http11Protocol start \nINFO: Starting Coyote HTTP/1.1 on http-8080 \nOct 4, 2006 5:32:21 PM org.apache.jk.common.ChannelSocket init \nINFO: JK: ajp13 listening on /0.0.0.0:8009 \nOct 4, 2006 5:32:21 PM org.apache.jk.server.JkMain start \nINFO: Jk running ID=0 time=0/63  config=null \nOct 4, 2006 5:32:21 PM org.apache.catalina.startup.Catalina start \nINFO: Server startup in 2657 ms \n\n\nThis is easily reproducible when you deploy the ELResolverTest.war *before* the\nserver has started (I assume JspFactory.setDefaultFactory() hasn't been invoked\nat the time the listeners are being installed).  If you deploy the WAR *after*\nthe server starts, the problem does not manifest and the app works --- until you\nstop and restart the server.", "id": 95118, "time": "2006-10-26T07:52:03Z", "creator": "scottjoh@us.ibm.com", "creation_time": "2006-10-26T07:52:03Z", "is_private": false}, {"count": 1, "tags": [], "creator": "scottjoh@us.ibm.com", "attachment_id": 19042, "is_private": false, "id": 95119, "time": "2006-10-26T07:54:16Z", "bug_id": 40820, "creation_time": "2006-10-26T07:54:16Z", "text": "Created attachment 19042\nThis zip file contains the WAR in the ELResolverTest\\dist directory; and the source and build scripts are provided as well.\n\nThis zip file contains the WAR in the ELResolverTest\\dist directory; and the\nsource and build scripts are provided as well."}, {"count": 2, "tags": [], "creator": "Ryan.Lubke@Sun.COM", "attachment_id": null, "id": 96250, "time": "2006-11-27T16:25:08Z", "bug_id": 40820, "creation_time": "2006-11-27T16:25:08Z", "is_private": false, "text": "This issue is impacting the JSF 1.2 RI as well.  We use the JspFactory when\ninitializing the runtime.  The first application that uses Faces will hit this\nissue, all other subsequent applications initialize fine."}, {"count": 3, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "is_private": false, "id": 97530, "time": "2007-01-02T07:34:12Z", "bug_id": 40820, "creation_time": "2007-01-02T07:34:12Z", "text": "Is this issue still valid? \n\nI cannot reproduce with the war file. I am guessing this was fixed w/out the bug\nbeing updated."}, {"count": 4, "tags": [], "creator": "scottjoh@us.ibm.com", "attachment_id": null, "id": 97534, "time": "2007-01-02T08:21:45Z", "bug_id": 40820, "creation_time": "2007-01-02T08:21:45Z", "is_private": false, "text": "Tim, this does still appear to be a problem with the latest TC 6 code.  Let's\nmake sure we're on the same page:\n(1) Tomcat has to be stopped\n(2) Drop ELResolverTest.war into the webapps directory\n(3) Start Tomcat\n(4) In the localhost log you will see:\nJan 2, 2007 11:13:15 AM org.apache.catalina.core.StandardContext listenerStart\nSEVERE: Exception sending context initialized event to listener instance of\nclass eltest.ChipsListener\njava.lang.NullPointerException\n\tat eltest.ChipsListener.contextInitialized(ChipsListener.java:18)\n\tat\norg.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3827)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:4336)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:760)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:740)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:825)\n\tat org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:714)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:490)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:1138)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:120)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1022)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:719)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1014)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:451)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:710)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:552)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)\nJan 2, 2007 11:13:17 AM org.apache.catalina.core.ApplicationContext log\nINFO: ContextListener: contextInitialized()\nJan 2, 2007 11:13:17 AM org.apache.catalina.core.ApplicationContext log\nINFO: SessionListener: contextInitialized()\n\n\n(5) in the command window you'll see:\nE:\\eclipseWorkspace\\TC6\\tomcat6\\output\\build\\bin>catalina run\nUsing CATALINA_BASE:   E:\\eclipseWorkspace\\TC6\\tomcat6\\output\\build\nUsing CATALINA_HOME:   E:\\eclipseWorkspace\\TC6\\tomcat6\\output\\build\nUsing CATALINA_TMPDIR: E:\\eclipseWorkspace\\TC6\\tomcat6\\output\\build\\temp\nUsing JRE_HOME:        C:\\jdk1.5.0_06\\jre\nJan 2, 2007 11:13:08 AM org.apache.catalina.core.AprLifecycleListener init\nINFO: The Apache Tomcat Native library which allows optimal performance in\nproduction environments was not found on the java.library.path:\nC:\\jdk1.5.0_06\\jre\\bin;.;C:\\WINNT\\system32;C:\\WINNT;C:\\jdk1.5.0_06\\bin;E:\\temp\\apache-ant-1.6.5\\bin\nJan 2, 2007 11:13:11 AM org.apache.coyote.http11.Http11Protocol init\nINFO: Initializing Coyote HTTP/1.1 on http-8080\nJan 2, 2007 11:13:11 AM org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 5625 ms\nJan 2, 2007 11:13:11 AM org.apache.catalina.core.StandardService start\nINFO: Starting service Catalina\nJan 2, 2007 11:13:11 AM org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/6.0.0-dev\nJan 2, 2007 11:13:11 AM org.apache.catalina.core.StandardHost start\nINFO: XML validation disabled\nJan 2, 2007 11:13:11 AM org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive ELResolverTest.war\nChipsListener.contextInitialized  evt=\njavax.servlet.ServletContextEvent[source=org.apache.catalina.core.ApplicationContextFacade@872380]\nChipsListener.contextInitialized  context=\norg.apache.catalina.core.ApplicationContextFacade@872380\nChipsListener.contextInitialized  JspFactory.getDefaultFactory()= null\nJan 2, 2007 11:13:15 AM org.apache.catalina.core.StandardContext start\nSEVERE: Error listenerStart\nJan 2, 2007 11:13:15 AM org.apache.catalina.core.StandardContext start\nSEVERE: Context [/ELResolverTest] startup failed due to previous errors\nJan 2, 2007 11:13:19 AM org.apache.coyote.http11.Http11Protocol start\nINFO: Starting Coyote HTTP/1.1 on http-8080\nJan 2, 2007 11:13:19 AM org.apache.jk.common.ChannelSocket init\nINFO: JK: ajp13 listening on /0.0.0.0:8009\nJan 2, 2007 11:13:19 AM org.apache.jk.server.JkMain start\nINFO: Jk running ID=0 time=0/328  config=null\nJan 2, 2007 11:13:19 AM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 8485 ms\n\n\n(6) The cause is what I described earlier.\n\n\n\n\n\n\n\n\n\n"}, {"count": 5, "tags": [], "text": "I was able to reproduce. To reproduce, I did the following:\n1) Use the WAR previously attached.\n2) Edit conf/web.xml and comment OUT any reference to\norg.apache.jasper.servlet.JspServlet\n\nLeaving jasper's JspServlet intact in the out of the box tomcat config allowed\nthe example to work fine. \n\nAt this point - I don't know if this should remain closed or open given the\nsimple solution and the need for the jsp servlet to exist for pages which use jsp. \n\n", "attachment_id": null, "bug_id": 40820, "id": 97535, "time": "2007-01-02T09:33:15Z", "creator": "funkman@joedog.org", "creation_time": "2007-01-02T09:33:15Z", "is_private": false}, {"count": 6, "text": "Created attachment 19341\nconf and logs directories zipped up", "bug_id": 40820, "is_private": false, "id": 97536, "time": "2007-01-02T09:57:37Z", "creator": "scottjoh@us.ibm.com", "creation_time": "2007-01-02T09:57:37Z", "tags": [], "attachment_id": 19341}, {"count": 7, "tags": [], "creator": "scottjoh@us.ibm.com", "attachment_id": null, "is_private": false, "id": 97537, "time": "2007-01-02T09:58:39Z", "bug_id": 40820, "creation_time": "2007-01-02T09:58:39Z", "text": "Hmmm... I'm using an out of the box tomcat config.  I've attached my logs and\nconf directories. Please take a peek."}, {"count": 8, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "id": 97540, "time": "2007-01-02T11:11:45Z", "bug_id": 40820, "creation_time": "2007-01-02T11:11:45Z", "is_private": false, "text": "FWIW: Unable to reproduce with Windows XP pro  & jdk1.5.0_07\n\nBut I'm in luck - I was able to reproduce with Fedora Core release 5 - 1.5.0_10-\nb0\n\n"}, {"count": 9, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "is_private": false, "id": 97548, "time": "2007-01-02T16:38:41Z", "bug_id": 40820, "creation_time": "2007-01-02T16:38:41Z", "text": "Fixed with Committed revision 491990.\n\nThe file in error was java/org/apache/catalina/core/JasperListener.java"}, {"count": 10, "tags": [], "bug_id": 40820, "attachment_id": null, "text": "Tim, This fixes my testcase.  Thanks!", "id": 97552, "time": "2007-01-02T18:15:51Z", "creator": "scottjoh@us.ibm.com", "creation_time": "2007-01-02T18:15:51Z", "is_private": false}, {"count": 11, "text": "I try to use the Sun implementation of JSF 1.2 with Tomcat 6.0.8.\n\nI still get a NullPointerException:\nServlet.service() for servlet jsp threw exception\njava.lang.NullPointerException\n\tat org.apache.jsp.VDVRequest_jsp._jspInit(VDVRequest_jsp.java:25)\n\tat org.apache.jasper.runtime.HttpJspBase.init(HttpJspBase.java:80)\n\tat\norg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:157)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:320)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:320)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:266)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:228)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:212)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:634)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:445)\n\tat java.lang.Thread.run(Unknown Source)\n\n\nin VDVRequest_jsp.java:\n  public void _jspInit() {\n    _005fjspx_005ftagPool_005ff_005fview =\norg.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());\n    _005fjspx_005ftagPool_005fh_005foutputText_005fvalue_005fnobody =\norg.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());\n[here is line no. 37]\n    _el_expressionfactory =\nJspFactory.getDefaultFactory().getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();\n    _jsp_annotationprocessor = (org.apache.AnnotationProcessor)\ngetServletConfig().getServletContext().getAttribute(org.apache.AnnotationProcessor.class.getName());\n  }\n\nI suppose JspFactory.getDefaultFactory() is null.\n\nIs there any workaround to initialize it?", "bug_id": 40820, "is_private": false, "id": 98257, "time": "2007-01-19T04:48:18Z", "creator": "r.s.t@gmx.net", "creation_time": "2007-01-19T04:48:18Z", "tags": [], "attachment_id": null}, {"count": 12, "tags": [], "text": "-> users@tomcat list", "is_private": false, "bug_id": 40820, "id": 98258, "time": "2007-01-19T05:18:05Z", "creator": "remm@apache.org", "creation_time": "2007-01-19T05:18:05Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Earlier I was exporting xls with Apache POI 2.5.1 to export `.xls` file using `HSSFWorkbook`.\nWith updated Apache POI to 3.13 I am exporting `.xlsx` file using `SXSSFWorkbook` but its exporting corrupted file. \n\nMS Excel failed to open file with **File format or extension not valid** error.\n\nNote that this issue I am facing only on `WebLogic` server, it works fine with `JBoss`.\n\nAnybody can help what I am doing wrong here or it is POI bug?\n\nCode:\n\n    \tList<JRField> fields = ds.getFields();\n        SXSSFWorkbook wb = new SXSSFWorkbook();\n        SXSSFSheet sheet = wb.createSheet(\"Sheet1\");\n\n        try {\n            CellStyle cellStyle         = wb.createCellStyle();\n            CellStyle cellStyleColName  = wb.createCellStyle();\n            CellStyle cellStyleTitle    = wb.createCellStyle();\n\n            Font boldFont = wb.createFont();\n            boldFont.setFontHeightInPoints((short)16);\n            boldFont.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);\n\n            // Cell Style for body\n            cellStyle.setDataFormat(HSSFDataFormat.getBuiltinFormat(\"($#,##0_);[Red]($#,##0)\"));\n            cellStyle.setWrapText(true);\n\n            // Cell Style for Column Names\n            cellStyleColName.setDataFormat(HSSFDataFormat.getBuiltinFormat(\"($#,##0_);[Red]($#,##0)\"));\n            cellStyleColName.setAlignment(HSSFCellStyle.ALIGN_CENTER);\n            cellStyleColName.setBorderTop(HSSFCellStyle.BORDER_MEDIUM); // single line border\n            cellStyleColName.setBorderBottom(HSSFCellStyle.BORDER_MEDIUM); // single line border\n\n            // Cell Style for Title\n            cellStyleTitle.setDataFormat(HSSFDataFormat.getBuiltinFormat(\"($#,##0_);[Red]($#,##0)\"));\n            cellStyleTitle.setAlignment(HSSFCellStyle.ALIGN_CENTER);\n            cellStyleTitle.setFont(boldFont);\n\n            // Creating Title Row\n            Row row1 = sheet.createRow((short) 0);\n\n            // Creating the Title line\n            Cell cell1 = row1.createCell((short) 0);\n            cell1.setCellValue(\"Demo Title\");\n            cell1.setCellStyle(cellStyleTitle);\n\n            // Title Region\n            CellRangeAddress regionTitle = new CellRangeAddress(  (short) 0,       // From Row\n                    (short) 0,                                    // From Col\n                    (short) 0,                                    // To Row\n                    (short) (this.displayCols.size()-1)           // To Col\n\n            );\n            sheet.addMergedRegion(regionTitle);\n\n            // Column Name Row\n            int j =0;\n            Row row2 = sheet.createRow((short) 1);\n            for (ReportColumn col : this.displayCols)\n            {\n                Cell cell2 = row2.createCell((short) j++);\n                cell2.setCellValue(col.getDisplayName());\n                cell2.setCellStyle(cellStyleColName);\n            }\n\n            int i =2;\n            while (ds.next()) {\n                Row rows = sheet.createRow((short) 0 + i);\n                int k = 0;\n                for (JRField field : fields) {\n                    String fieldAsString = (ds.getFieldValue(field) != null ? ds.getFieldValue(field).toString():null);\n                    Cell cell = rows.createCell((short) k++);\n                    cell.setCellStyle(cellStyle);\n                    cell.setCellValue(fieldAsString);\n                }\n                i++;\n                if (i > RECORD_LIMIT_FROM_POI){\n                    log.info(\"Row limit from poi reached #1048576 and exported data is truncated.\");\n                    break;\n                }\n            }\n\t\t\t\n            wb.write(os);\n        }\n        catch (Exception e) {\n            log.error(\"error in createXlsFile method\", e);\n        }\n\n\n**Failed attempts:**\n 1. Updated mime type in response header from `application/vnd.ms-excel`\n    to `vnd.openxmlformats-officedocument.spreadsheetml.sheet`\n 2. Added `xlsx=vnd.openxmlformats-officedocument.spreadsheetml.sheet` in custom mime mapping file for WebLogic\n\nNotes:\nWebLogic running on Linux SuSe\nWebLogic version 10.3.5.0", "is_private": false, "id": 190821, "creator": "kishan089.ce@gmail.com", "time": "2016-05-11T12:07:47Z", "bug_id": 59458, "creation_time": "2016-05-11T12:07:47Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 59458, "attachment_id": null, "id": 190823, "time": "2016-05-11T15:02:04Z", "creator": "onealj@apache.org", "creation_time": "2016-05-11T15:02:04Z", "is_private": false, "text": "Your example is missing a few critical lines, such as what os is. FileOutputStream(\"/tmp/Workbook.xlsx\") I hope.\nYour example probably contains more lines than are relevant. Can any of the lines in the body be deleted and still recreate your problem? The more you cut out irrelevant parts of your code, the easier it is to provide suggestions.\n\nHave you tried using XSSFWorkbook yet?\n\nSO post\nhttp://stackoverflow.com/q/37159328/2683399\nLooks like you're using poi-3.13, poi-ooxml-3.13, and poi-ooxml-schemas-3.13, so at least you're not mixing POI versions. Make sure you don't have any other versions of POI on your class path.\n\nIt's probably better to ask usage questions on one of the POI mailing lists. http://poi.apache.org/mailinglists.html\n\nClosing this bug unless someone can demonstrate a bug in POI rather than an environment configuration problem."}, {"attachment_id": null, "tags": [], "bug_id": 59458, "is_private": false, "count": 2, "id": 190888, "time": "2016-05-12T05:38:59Z", "creator": "kishan089.ce@gmail.com", "creation_time": "2016-05-12T05:38:59Z", "text": "Responses are given inline.\n\nYour example is missing a few critical lines, such as what os is. \n- WebLogic running on Linux Suse\n\nYour example probably contains more lines than are relevant. Can any of the lines in the body be deleted and still recreate your problem? The more you cut out irrelevant parts of your code, the easier it is to provide suggestions.\n- I have tried removing CellRangeAddress and all CellStyle, still facing the issue.\n\nHave you tried using XSSFWorkbook yet?\n- Yes tried using XSSFWorkbook as well, still facing the issue.\n\nSO post\nhttp://stackoverflow.com/q/37159328/2683399\nLooks like you're using poi-3.13, poi-ooxml-3.13, and poi-ooxml-schemas-3.13, so at least you're not mixing POI versions. Make sure you don't have any other versions of POI on your class path.\n- Confirmed, no conflicts.\n\nClosing this bug unless someone can demonstrate a bug in POI rather than an environment configuration problem.\n- Seems like issue is on this specific version of WebLogic, I have tested on higher versions and its working fine (Please refer: http://stackoverflow.com/q/37159328/2683399)"}, {"count": 3, "tags": [], "creator": "kishan089.ce@gmail.com", "attachment_id": null, "text": "Tested with,\n\nFileOutputStream stream = new FileOutputStream(\"/tmp/testfile.xlsx\");\nwb.write(stream);\nstream.flush();\nstream.close();\n\nStill not working, facing the same issue.\n\nReopening.", "id": 190889, "time": "2016-05-12T06:38:46Z", "bug_id": 59458, "creation_time": "2016-05-12T06:38:46Z", "is_private": false}, {"count": 4, "tags": [], "text": "Minimal code which is not working on WebLogic 10.3.5\n\n        SXSSFWorkbook wb = new SXSSFWorkbook();\n        SXSSFSheet sheet = wb.createSheet(\"Sheet1\");\n\n        String[] displayCols = new String[] {\"FirstColumn\", \"SecondColumn\", \"ThirdColumn\"};\n        String[][] values = new String[][] {\n                {\"Value1\", \"Value2\", \"Value3\"},\n                {\"Value4\", \"Value5\", \"Value6\"},\n                {\"Value7\", \"Value8\", \"Value9\"}\n        };\n\n        // Creating Title Row\n        Row row1 = sheet.createRow(0);\n\n        // Creating the Title line\n        Cell cell1 = row1.createCell(0);\n        cell1.setCellValue(\"This is test report\");\n\n        // Column Name Row\n        int j =0;\n        Row row2 = sheet.createRow(1);\n        for (String col : displayCols)\n        {\n            Cell cell2 = row2.createCell(j++);\n            cell2.setCellValue(col);\n        }\n\n        int i = 2;\n        for( String[] strs: values) {\n            Row rows = sheet.createRow(i);\n            int k = 0;\n            for ( String value: strs) {\n                Cell cell = rows.createCell(k++);\n                cell.setCellValue(value);\n            }\n            i++;\n        }\n\n        try {\n            wb.write(os); // os is ServletOutputStream of HTTPServletResponse\n        } catch (IOException e) {\n            e.printStackTrace();\n        }", "attachment_id": null, "bug_id": 59458, "id": 190895, "time": "2016-05-12T08:58:18Z", "creator": "kishan089.ce@gmail.com", "creation_time": "2016-05-12T08:58:18Z", "is_private": false}, {"count": 5, "tags": [], "text": "As this is working on other platforms, I'd suggest you'd be best off speaking to Weblogic support", "is_private": false, "id": 190910, "creator": "apache@gagravarr.org", "time": "2016-05-12T18:42:48Z", "bug_id": 59458, "creation_time": "2016-05-12T18:42:48Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Want to confirm whether Apache POI 3.13 supports all WebLogic version ?\nCould someone please confirm here that exporting .xlsx using SXSSFWorkbook supported on WebLogic 10.3.5.0 ?", "attachment_id": null, "bug_id": 59458, "id": 190980, "time": "2016-05-16T05:16:28Z", "creator": "kishan089.ce@gmail.com", "creation_time": "2016-05-16T05:16:28Z", "is_private": false}, {"count": 7, "tags": [], "text": "Apache POI supports all standards-compliant Java Virtual Machines (JVMs), and is routinely tested with most of the main freely available ones. For compatibility with paid-for java platforms, you'll be best off asking the support team of the product you're paying money for - they're much more likely to know than volunteers giving up their spare time to support software they've given to you for free...", "attachment_id": null, "id": 190981, "creator": "apache@gagravarr.org", "time": "2016-05-16T05:48:25Z", "bug_id": 59458, "creation_time": "2016-05-16T05:48:25Z", "is_private": false}, {"count": 8, "tags": [], "creator": "kishan089.ce@gmail.com", "attachment_id": null, "is_private": false, "id": 190983, "time": "2016-05-16T14:06:03Z", "bug_id": 59458, "creation_time": "2016-05-16T14:06:03Z", "text": "Thanks Nick :)"}, {"count": 9, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "Resolving this one again here as we do not see anything being done incorrectly in POI at the moment.", "id": 191013, "time": "2016-05-17T08:55:45Z", "bug_id": 59458, "creation_time": "2016-05-17T08:55:45Z", "is_private": false}]
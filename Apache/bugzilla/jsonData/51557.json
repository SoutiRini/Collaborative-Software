[{"count": 0, "tags": [], "bug_id": 51557, "attachment_id": 27314, "id": 148157, "time": "2011-07-26T06:12:43Z", "creator": "hyandell@amazon.com", "creation_time": "2011-07-26T06:12:43Z", "is_private": false, "text": "Created attachment 27314\nPatch to stop CR & LF in the header.\n\nInternalInputBuffer allows newlines in http header field names. As an example:\n\nFoo: Val1\nBar: Val2\nMISS\nHup: Val3\n\nThis will lead to a field name of 'MISSHup' and not 'Hup'.\n\nDigging into the specs, I think this goes back to RFC 822 which states:\n\n     field-name  =  1*<any CHAR, excluding CTLs, SPACE, and \":\">\n\nand\n\n     CTL         =  <any ASCII control           ; (  0- 37,  0.- 31.)\n                     character and DEL>          ; (    177,     127.)\n\nI think this is saying that field-name should not contain CR or LF.\n\nI've attached a patch that stops CR & LF. Two improvements I could see, if there's agreement with this as a bug, are adding a unit test to TestInternalInputBuffer and changing the code so it disallows space and any other ctrl character in the field name."}, {"count": 1, "attachment_id": null, "bug_id": 51557, "is_private": false, "id": 148185, "time": "2011-07-26T16:55:56Z", "creator": "markt@apache.org", "creation_time": "2011-07-26T16:55:56Z", "tags": [], "text": "The exact quote from RFC 2616 is that HTTP headers \"follow the same generic format as that given in Section 3.1 of RFC 822\". RFC 2616 goes further in defining exactly what is permitted so RFC 2616 remains the relevant specification in this case.\n\nAs per RFC 2616, HTTP header names are tokens which mean no CTLs and no separators which requires further restrictions than no CTLs and no space.\n\nThe patch only addresses the HTTP BIO connector. The issue also needs to be addressed for the HTTP NIO and HTTP APR/native connectors.\n\nI have an untested patch enforces the RFC 2616 requirements and drops the header line if an invalid header name is presented (that seemed a better option than returning a 400 response).\n\nI'm currently running the test suite for all three connectors and will commit the patch assuming the tests pass."}, {"count": 2, "tags": [], "bug_id": 51557, "attachment_id": null, "is_private": false, "id": 148203, "time": "2011-07-27T09:10:43Z", "creator": "markt@apache.org", "creation_time": "2011-07-27T09:10:43Z", "text": "This has been fixed in 7.0.x and will be included in 7.0.20 onwards."}, {"count": 3, "tags": [], "text": "Mark, can you give a revision reference?\n\nI'm interested in whether you or not you think response-splitting protection is worthwhile in other cases (i.e. header values).", "is_private": false, "id": 148316, "creator": "chris@christopherschultz.net", "time": "2011-08-01T15:01:12Z", "bug_id": 51557, "creation_time": "2011-08-01T15:01:12Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 51557, "is_private": false, "id": 148319, "time": "2011-08-01T16:41:49Z", "creator": "hyandell@amazon.com", "creation_time": "2011-08-01T16:41:49Z", "tags": [], "text": "r1151394"}]
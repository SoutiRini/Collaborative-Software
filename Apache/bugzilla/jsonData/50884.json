[{"count": 0, "tags": [], "bug_id": 50884, "attachment_id": 26739, "text": "Created attachment 26739\nOutput file with messed up display\n\nI'm having a trouble making a freeze pane with the same code that worked great in HSSF.\n\nHere's my scenario: I write the data and call and call\n\nsheet.createFreezePane(4, 1);\n\nSheet display looks weird. If I open the file in excel, scroll left right and re-save it seems to be fine.\nAttached is the result.\n\nThanks,\nBane", "id": 144800, "time": "2011-03-07T08:09:04Z", "creator": "stormbringer@mail.com", "creation_time": "2011-03-07T08:09:04Z", "is_private": false}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 145120, "time": "2011-03-21T07:55:21Z", "bug_id": 50884, "creation_time": "2011-03-21T07:55:21Z", "is_private": false, "text": "Can you try creating a simple file with the same freeze pane settings in Excel? Then, unzip both the POI and Excel version (.xlsx is a zip of xml files), and try to spot what was done differently for the freeze panes, page settings etc for them?"}, {"count": 2, "tags": [], "bug_id": 50884, "attachment_id": null, "text": "(In reply to comment #1)\n> Can you try creating a simple file with the same freeze pane settings in Excel?\n> Then, unzip both the POI and Excel version (.xlsx is a zip of xml files), and\n> try to spot what was done differently for the freeze panes, page settings etc\n> for them?\n\nI have down what you havesuggested and I think I ahve found the problem.\n\nExcel-generated file:\n\n<pane xSplit=\"2\" ySplit=\"1\" state=\"frozen\" topLeftCell=\"C2\" activePane=\"bottomRight\"/>\n\nPOI-generated file:\n\n<pane xSplit=\"2.0\" ySplit=\"1.0\" state=\"frozen\" topLeftCell=\"B3\" activePane=\"bottomRight\"/>\n\nThe top left cell is wrong. I have substituted 'B3' with 'C2' and zipped the files again creating a new xlsx file and it works.", "id": 145123, "time": "2011-03-21T09:56:41Z", "creator": "mcroci@gmail.com", "creation_time": "2011-03-21T09:56:41Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 50884, "attachment_id": null, "text": "I have looked at the source code. The problem is in the method createFreezePane of the XSSFSheet class.\n\nWhen a new CellReference is created, row and column are inverted in the constructor.\n\n\n    public void createFreezePane(int colSplit, int rowSplit, int leftmostColumn, int topRow) {\n        CTPane pane = getPane();\n        if (colSplit > 0) pane.setXSplit(colSplit);\n        if (rowSplit > 0) pane.setYSplit(rowSplit);\n        pane.setState(STPaneState.FROZEN);\n        if (rowSplit == 0) {\n            pane.setTopLeftCell(new CellReference(0, topRow).formatAsString());\n            pane.setActivePane(STPane.TOP_RIGHT);\n        } else if (colSplit == 0) {\n            pane.setTopLeftCell(new CellReference(rowSplit, 0).formatAsString());\n            pane.setActivePane(STPane.BOTTOM_LEFT);\n        } else {\n            pane.setTopLeftCell(new CellReference(leftmostColumn, topRow).formatAsString());\n            pane.setActivePane(STPane.BOTTOM_RIGHT);\n        }\n\n        CTSheetView ctView = getDefaultSheetView();\n        ctView.setSelectionArray(null);\n        CTSelection sel = ctView.addNewSelection();\n        sel.setPane(pane.getActivePane());\n    }", "id": 145125, "time": "2011-03-21T10:28:00Z", "creator": "mcroci@gmail.com", "creation_time": "2011-03-21T10:28:00Z", "is_private": false}, {"count": 4, "tags": [], "text": "Ah, I think I fixed that a few days ago as part of bug #49381\n\nCan you try with a nightly build / svn checkout from over the weekend and see if that fixes it for you?", "is_private": false, "id": 145133, "creation_time": "2011-03-21T10:36:35Z", "time": "2011-03-21T10:36:35Z", "creator": "apache@gagravarr.org", "bug_id": 50884, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 50884, "is_private": false, "id": 145173, "creation_time": "2011-03-21T11:20:55Z", "time": "2011-03-21T11:20:55Z", "creator": "mcroci@gmail.com", "text": "(In reply to comment #4)\n> Ah, I think I fixed that a few days ago as part of bug #49381\n> \n> Can you try with a nightly build / svn checkout from over the weekend and see\n> if that fixes it for you?\n\nOk, it seems to be fixed in the last nightly build.\n\nBut I think there is a Problem in this code snapshot:\n\nif (rowSplit == 0) {\n            pane.setTopLeftCell(new CellReference(0, topRow).formatAsString());\n\n(from XSSFSheet.createFreezePane)\nIf there is only  a column split the file is not correct (topRow is used and this is wrong)", "attachment_id": null}, {"count": 6, "tags": [], "text": "(In reply to comment #5)\n> But I think there is a Problem in this code snapshot:\n> \n> if (rowSplit == 0) {\n>             pane.setTopLeftCell(new CellReference(0, topRow).formatAsString());\n> \n> (from XSSFSheet.createFreezePane)\n> If there is only  a column split the file is not correct (topRow is used and\n> this is wrong)\n\nWhat do you think it should be?\n\n(We'll probably want to work up another unit test that checks that HSSF and XSSF agree, but it'd be worth ensuring that we end up with the correct same answer!)", "is_private": false, "id": 145258, "creation_time": "2011-03-25T11:22:36Z", "time": "2011-03-25T11:22:36Z", "creator": "apache@gagravarr.org", "bug_id": 50884, "attachment_id": null}, {"count": 7, "tags": [], "creator": "mcroci@gmail.com", "attachment_id": null, "is_private": false, "id": 145454, "time": "2011-04-01T07:07:31Z", "bug_id": 50884, "creation_time": "2011-04-01T07:07:31Z", "text": "(In reply to comment #6)\n> (In reply to comment #5)\n> > But I think there is a Problem in this code snapshot:\n> > \n> > if (rowSplit == 0) {\n> >             pane.setTopLeftCell(new CellReference(0, topRow).formatAsString());\n> > \n> > (from XSSFSheet.createFreezePane)\n> > If there is only  a column split the file is not correct (topRow is used and\n> > this is wrong)\n> \n> What do you think it should be?\n> \n> (We'll probably want to work up another unit test that checks that HSSF and\n> XSSF agree, but it'd be worth ensuring that we end up with the correct same\n> answer!)\n\nI think it should be \n\n      if (rowSplit == 0) {\n          pane.setTopLeftCell(new CellReference(0, colSplit).formatAsString());"}, {"count": 8, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "is_private": false, "id": 145650, "time": "2011-04-08T11:41:51Z", "bug_id": 50884, "creation_time": "2011-04-08T11:41:51Z", "text": "As of r1090301, I think this is now correct, and XSSF + HSSF seem to agree\n\nPlease shout if there's anything still wrong"}]
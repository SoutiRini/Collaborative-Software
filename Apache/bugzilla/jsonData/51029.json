[{"count": 0, "tags": [], "bug_id": 51029, "attachment_id": null, "id": 145576, "time": "2011-04-06T06:36:40Z", "creator": "carlo.bramix@libero.it", "creation_time": "2011-04-06T06:36:40Z", "is_private": false, "text": "The \"make test\" on MinGW+MSys generates a failure in testpipe.\nThe failure happens in wait_pipe() because apr_file_pipe_timeout_set() returns an error when trying to set the timeout.\nBy checking the code in APR, actually the timeout can be set only if the pipe has been open as overlapped object and when running at least on an NT platform.\nReplacing:\n\nrv = apr_file_pipe_create(&readp, &writep, p);\n\nwith:\n\nrv = apr_file_pipe_create_ex(&readp, &writep, APR_FULL_NONBLOCK, p);\n\nallowed to set the timeout correctly.\nUnfortunately, the test still fails later because the next apr_file_pipe_wait() seems to return APR_ENOTIMPL."}, {"text": "Ugh, are we building a Win9x flavor of APR out of mingw/msys?\n\nI ask because that code was never maintained the best, and is definitely\nsuboptimal due to API restrictions!", "tags": [], "bug_id": 51029, "attachment_id": null, "count": 1, "id": 145596, "time": "2011-04-06T13:09:40Z", "creator": "wrowe@apache.org", "creation_time": "2011-04-06T13:09:40Z", "is_private": false}, {"count": 2, "tags": [], "text": "the issue just seems to be the way that apr_file_pipe_create/_ex are written\n\nthere's no overlapped structure created unless apr_file_pipe_create_ex() was called, and told that at least one handle was non-blocking\n\nwithout that happening, apr_file_pipe_timeout_set() refuses to support a non-zero timeout\n\nCarlo's debug step to call \n\nrv = apr_file_pipe_create_ex(&readp, &writep, APR_FULL_NONBLOCK, p);\n\nwas proof that we aren't in the Win9x abyss", "is_private": false, "bug_id": 51029, "id": 145600, "time": "2011-04-06T14:20:07Z", "creator": "trawick@apache.org", "creation_time": "2011-04-06T14:20:07Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 51029, "attachment_id": null, "is_private": false, "id": 145602, "time": "2011-04-06T14:34:21Z", "creator": "wrowe@apache.org", "creation_time": "2011-04-06T14:34:21Z", "text": "That's right, now I'm remembering, this behavior is 'as expected', it wasn't\npossible on win9x at all.  Thus the introduction of _ex(), so this 'behavior\nis by design'.\n\nIn dropping support for win9x, it sure seems possible to normalize all of this\nfor rev 2.0 apr."}, {"count": 4, "tags": [], "bug_id": 51029, "attachment_id": null, "id": 145615, "time": "2011-04-07T05:30:28Z", "creator": "carlo.bramix@libero.it", "creation_time": "2011-04-07T05:30:28Z", "is_private": false, "text": "If I remember well... on Win9x and ME there are no problems to do asynchronous operations with communications devices (like serial ports), named pipes and mailslots, when they are opened with the FILE_FLAG_OVERLAPPED flag.\nCompared to its successors, Windows 95 had also more restrictions than Windows 98 and ME because missing ReadFileEx/WriteFileEx functions, but it seems they are not used here.\nI'm sure that these operating systems cannot do asynchronous disk accesses (with the only exception of ASPI), but I believe that the other resources should work fine."}]
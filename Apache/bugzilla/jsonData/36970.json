[{"count": 0, "attachment_id": null, "bug_id": 36970, "text": "I am using a bat program to invoke ant after setting some environment variables;\nthen the following code to run and check the return code:\ncall ant\nif errorlevel 1 (\n\tset /A failed += 1\n\tif \"%ignore%\" == \"\" goto bad\n)\n\nEven though the results of the ant build say \"BUILD SUCCESSFUL\" the errorlevel\nreturned is 1 and not 0.  If I use the -v parameter to ant (\"call ant -v\") it\nreturns the correct return code (0 on success, 1 on failure).", "id": 80913, "time": "2005-10-07T19:38:56Z", "creator": "ahengle@blackbirdtech.com", "creation_time": "2005-10-07T19:38:56Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 36970, "attachment_id": null, "text": "Its not that Ant's return code is invalid, it is that Ant doesnt set one\nindicating whether it succeeded or failed.\n\nThat has been a policy decision in the past, mainly for Win9x compatilbity. If\nyou can come with a patch for ant.bat that works on both the WinXP and Win9x\nplatforms, then we can fix it. \n\nTip: the perl and python entry points do set the return value properly.", "id": 80946, "time": "2005-10-10T11:48:28Z", "creator": "stevel@apache.org", "creation_time": "2005-10-10T11:48:28Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 36970, "attachment_id": null, "text": "Steve, the same way we broke BC with Java 1.1, could we consider breaking BC \nfor Win9x in ant.bat? I would think having a specific ant9x.bat script would be \nenough, no? I'd be +1 to have ant.bat properly propagate the 'correct' return \ncode. --DD", "id": 80952, "time": "2005-10-10T15:47:51Z", "creator": "ddevienne@lgc.com", "creation_time": "2005-10-10T15:47:51Z", "is_private": false}, {"count": 3, "tags": [], "creator": "j_a_fernandez@yahoo.com", "text": "If we want to write a script specific for WinNT, we could just call it ant.cmd \nwhich will work for NT (or is it XP) but not for 9x.\n\nThat will preserve BC and solve the issue. No?\n", "id": 80954, "attachment_id": null, "bug_id": 36970, "creation_time": "2005-10-10T16:12:00Z", "time": "2005-10-10T16:12:00Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 36970, "attachment_id": null, "id": 80956, "time": "2005-10-10T16:34:45Z", "creator": "mbenson@apache.org", "creation_time": "2005-10-10T16:34:45Z", "is_private": false, "text": "(For example,) when I look at my XP config (on a new machine), %PATHEXT% is \nset to pick up .BAT -before- .CMD, so just placing an NT-specific ant.cmd file \nin $ANT_HOME/bin wouldn't (I predict) solve the issue.  I think one of my kids \nmight still have a 9x version of one sort or another; if so I could try to do \nthis... but after having had a look at the batch file I can say it won't be \npretty.\n\n-Matt"}, {"count": 5, "tags": [], "bug_id": 36970, "attachment_id": null, "text": "hmm... secondly, I imagine that the final solution need not work identically \non both platforms; i.e.: the 9x result might not have all the behavior of the \nNT version, as long as the final batch file runs on both platforms... ;)", "id": 80957, "time": "2005-10-10T16:49:31Z", "creator": "mbenson@apache.org", "creation_time": "2005-10-10T16:49:31Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 36970, "text": "If it were up to me, I'd abandon win9x support altogether. But I know the\neclipse and netbeans team try and support it, which is why the fact that\n<property env> is broken still niggles me.\n\nMaybe we could have the batch file do something different with error codes on\nthe two platforms. I have a win9x vmware image for testing...", "id": 80981, "time": "2005-10-11T11:23:29Z", "creator": "stevel@apache.org", "creation_time": "2005-10-11T11:23:29Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 36970, "attachment_id": null, "text": "All I know to do at this point is modify the batch file to do the right thing \non NT, and dodge those commands on Win9x.  There are additional complications \nrelated to the structure of the batch file, but they are nothing major; pretty \nmuch the only detrimental effect will be ugliness.  The batch will still be \ncrippled but functional on Win9x.", "id": 81001, "time": "2005-10-11T16:46:46Z", "creator": "mbenson@apache.org", "creation_time": "2005-10-11T16:46:46Z", "is_private": false}, {"count": 8, "tags": [], "creator": "antoine@apache.org", "text": "I agree with Matt. -:)\nSo we would document that ant.bat returns a significant return code on Windows\nplatforms other than Win9x.", "id": 81044, "time": "2005-10-12T16:06:12Z", "bug_id": 36970, "creation_time": "2005-10-12T16:06:12Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "bodewig@apache.org", "text": "\n\n*** This bug has been marked as a duplicate of 13655 ***", "id": 85158, "attachment_id": null, "bug_id": 36970, "creation_time": "2006-01-28T16:10:52Z", "time": "2006-01-28T16:10:52Z", "is_private": false}]
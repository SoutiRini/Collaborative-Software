[{"count": 0, "tags": [], "bug_id": 59363, "attachment_id": null, "is_private": false, "id": 190420, "time": "2016-04-21T09:14:10Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T09:14:10Z", "text": "I tried to use the jdbc request sample for an oracle db and get the error ORA-00923.\n\nI tried the statement before with sql developer and JMeter 2.13 and it works fine.\n\nI used the jdbc oracle driver version 7 and Java JDK 1.8 u 77.\n\nI used the nightly build versions  1739623 (3.0 RC 2), 1740080 and 1740231 (21.04.2016)."}, {"count": 1, "tags": [], "creator": "support@ubikloadpack.com", "attachment_id": null, "text": "(In reply to Andreas Hoppe from comment #0)\n> I tried to use the jdbc request sample for an oracle db and get the error\n> ORA-00923.\n> \n> I tried the statement before with sql developer and JMeter 2.13 and it works\n> fine.\n> \n> I used the jdbc oracle driver version 7 and Java JDK 1.8 u 77.\n> \n> I used the nightly build versions  1739623 (3.0 RC 2), 1740080 and 1740231\n> (21.04.2016).\n\nHello,\nThanks for testing nightly build.\nCould you provide:\n- Sample failing test plan\n- JMeter.log file\n- content of jmeter/lib (does it contain the driver ? which version ?)\nThanks", "id": 190421, "time": "2016-04-21T09:16:14Z", "bug_id": 59363, "creation_time": "2016-04-21T09:16:14Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 59363, "attachment_id": null, "is_private": false, "id": 190422, "time": "2016-04-21T09:39:00Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T09:39:00Z", "text": "- Driver in lib tree: ojdbc7.jar\n\n- Sample SQL-Statement:\nselect count(*)\nfrom an\nwhere filenumber = '${fn}'\nand extractvalue (xml,'//an:fastMD/text()', 'xmlns:an=\"http://www.mm.de/MFA/v2/AN') = '${fn}'\n\n- Response for jdbc request: Response message: java.sql.SQLException: Cannot create PoolableConnectionFactory (ORA-00923: Schl\u00fcsselwort FROM nicht an erwarteter Stelle gefunden)\n\n- Test plan and log file cannot be provided. Log file doesn't contain error massages"}, {"count": 3, "tags": [], "bug_id": 59363, "attachment_id": null, "id": 190423, "time": "2016-04-21T09:41:52Z", "creator": "support@ubikloadpack.com", "creation_time": "2016-04-21T09:41:52Z", "is_private": false, "text": "(In reply to Andreas Hoppe from comment #2)\n> - Driver in lib tree: ojdbc7.jar\n> \n> - Sample SQL-Statement:\n> select count(*)\n> from an\n> where filenumber = '${fn}'\n> and extractvalue (xml,'//an:fastMD/text()',\n> 'xmlns:an=\"http://www.mm.de/MFA/v2/AN') = '${fn}'\n\nAre you sure ${fn} was replaced ? What is the exact SQL query that hits the db ?\u00a0\n> \n> - Response for jdbc request: Response message: java.sql.SQLException: Cannot\n> create PoolableConnectionFactory (ORA-00923: Schl\u00fcsselwort FROM nicht an\n> erwarteter Stelle gefunden)\n> \n> - Test plan and log file cannot be provided. Log file doesn't contain error\n> massages\n\n\nDid you check with JMeter 2.13 under exactly the same conditions ?\n- Same JDK\n- Same Driver ?\n- Same  SQL query \n\nCan you try by playing with the query to see what part of the SQL is failing ?\nThanks"}, {"count": 4, "tags": [], "bug_id": 59363, "attachment_id": null, "id": 190424, "time": "2016-04-21T09:44:51Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T09:44:51Z", "is_private": false, "text": "I check with JMeter 2.13 under same condition on same machine. Equal what I am doing with the query, I got the same error. The SQL statement is correct."}, {"count": 5, "tags": [], "bug_id": 59363, "attachment_id": null, "is_private": false, "id": 190425, "time": "2016-04-21T09:49:47Z", "creator": "support@ubikloadpack.com", "creation_time": "2016-04-21T09:49:47Z", "text": "(In reply to Andreas Hoppe from comment #4)\n> I check with JMeter 2.13 under same condition on same machine. Equal what I\n> am doing with the query, I got the same error. The SQL statement is correct.\n\nI understand you get an error with 2.13 right ? Do I misunderstand ?\nBecause you initially wrote:\n\"I tried the statement before with sql developer and JMeter 2.13 and it works fine.\"\n\nThanks"}, {"count": 6, "tags": [], "bug_id": 59363, "attachment_id": null, "id": 190426, "time": "2016-04-21T09:52:36Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T09:52:36Z", "is_private": false, "text": "I get an error with the nightly builds 1739623 (3.0 RC 2), 1740080 and 1740231.\n\nJMeter 2.13 works fine. Additionaly I tried SQL developer to check that the statement is correct."}, {"count": 7, "tags": [], "bug_id": 59363, "attachment_id": null, "is_private": false, "id": 190427, "time": "2016-04-21T09:54:55Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T09:54:55Z", "text": "Sorry, was misunderstandable. The bud is in 1739623 (3.0 RC 2), 1740080 and 1740231 (21.04.2016) and NOT in 2.13."}, {"count": 8, "tags": [], "bug_id": 59363, "attachment_id": null, "is_private": false, "id": 190428, "time": "2016-04-21T09:57:41Z", "creator": "support@ubikloadpack.com", "creation_time": "2016-04-21T09:57:41Z", "text": "Ok,\nUnless you provide those informations, it will be very hard if not impossible to see the problem:\n- Exact query hitting the database (on oracle side) with JMeter 2.13 vs 3.0 RC2\n- JMeter.log file removing all confidential information\n- Sample failing test plan with only failing query\n\nThanks"}, {"attachment_id": null, "tags": [], "bug_id": 59363, "is_private": false, "count": 9, "id": 190429, "time": "2016-04-21T10:06:44Z", "creator": "sebb@apache.org", "creation_time": "2016-04-21T10:06:44Z", "text": "Also, have you tried any other (simpler) queries on the nightly build?\n\ne.g.\n\nSELECT COUNT(*) FROM DUAL"}, {"count": 10, "tags": [], "bug_id": 59363, "attachment_id": 33785, "id": 190433, "time": "2016-04-21T11:37:31Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T11:37:31Z", "is_private": false, "text": "Created attachment 33785\nTest plan\n\nTestplan with not working simple query"}, {"count": 11, "tags": [], "text": "Created attachment 33786\nJMeter log file\n\nJMeter log file", "is_private": false, "bug_id": 59363, "id": 190434, "time": "2016-04-21T11:38:04Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T11:38:04Z", "attachment_id": 33786}, {"count": 12, "tags": [], "creator": "andreas.hoppe@bdr.de", "attachment_id": null, "text": "I tried also simple queries, but the cause the same error.", "id": 190435, "time": "2016-04-21T11:38:58Z", "bug_id": 59363, "creation_time": "2016-04-21T11:38:58Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 59363, "attachment_id": null, "id": 190436, "time": "2016-04-21T11:42:31Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T11:42:31Z", "is_private": false, "text": "In case of the ora error the Statement didn't reach the database. This error comes from  from the jdbc driver."}, {"count": 14, "tags": [], "text": "Does the same test plan work for you on 2.13?\n\nThe Validation query looks as though it may be wrong for Oracle.", "is_private": false, "bug_id": 59363, "id": 190438, "time": "2016-04-21T12:26:34Z", "creator": "sebb@apache.org", "creation_time": "2016-04-21T12:26:34Z", "attachment_id": null}, {"count": 15, "tags": [], "text": "Yes it works with JMeter 2.13 (see screenshot).", "is_private": false, "bug_id": 59363, "id": 190439, "time": "2016-04-21T12:59:57Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T12:59:57Z", "attachment_id": null}, {"attachment_id": 33787, "tags": [], "bug_id": 59363, "is_private": false, "count": 16, "id": 190441, "time": "2016-04-21T13:08:02Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T13:08:02Z", "text": "Created attachment 33787\nScreenshot of result for 2.13\n\nScreenshot of query result with JMeter 2.13."}, {"count": 17, "tags": [], "creator": "sebb@apache.org", "attachment_id": 33787, "text": "Comment on attachment 33787\nScreenshot of result for 2.13\n\nScreenshot does not show the JDBC Config.\n\nTry changing the validation query so it is valid for Oracle.\n\nIt should be 'SELECT 1 FROM DUAL' or similar.", "id": 190442, "time": "2016-04-21T13:10:18Z", "bug_id": 59363, "creation_time": "2016-04-21T13:10:18Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 59363, "is_private": false, "count": 18, "id": 190445, "time": "2016-04-21T13:30:23Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T13:30:23Z", "text": "I used the SAME test plan!!!!\n\nIt has the SAME JDBC configuration!!!\n\nI also tried this simple statement and the SAME error appears!!!\n\n\nTo summarise:\n-------------\n\n1. The SQL statement is in ALL cases correct.\n2. JDBC driver and Oracle connection configuration are correct.\n3. With JMeter 2.13 the JDBC request sampler works correct.\n4. With JMeter 3.0 RC2 or all other higher nightly build versions the JDBC request sampler causes ALWAYS the same bug.\n\n\nMy assumption:\n--------------\n\n1. The new JDBC request sampler generates an incorrect statement. This shows the error ORA-00923."}, {"count": 19, "tags": [], "bug_id": 59363, "attachment_id": null, "id": 190446, "time": "2016-04-21T13:42:38Z", "creator": "sebb@apache.org", "creation_time": "2016-04-21T13:42:38Z", "is_private": false, "text": "As I wrote:\n\nHave you tried correcting the validation query?\n\n\nThere were some changes to the way JDBC works; it's possible that the query is now being used at a different point in the process."}, {"count": 20, "tags": [], "bug_id": 59363, "attachment_id": null, "id": 190447, "time": "2016-04-21T13:52:57Z", "creator": "andreas.hoppe@bdr.de", "creation_time": "2016-04-21T13:52:57Z", "is_private": false, "text": "You are talking about the configuration of the jdbc Connection where you configurae the Validation query. No this i haven't changed. Now I used another query and it works.\n\nIs it possible to leave this field empty?"}, {"count": 21, "tags": [], "creator": "support@ubikloadpack.com", "attachment_id": null, "text": "(In reply to Andreas Hoppe from comment #20)\n> You are talking about the configuration of the jdbc Connection where you\n> configurae the Validation query. No this i haven't changed. Now I used\n> another query and it works.\n> \n> Is it possible to leave this field empty?\nSet Test While Idle to false.", "id": 190448, "time": "2016-04-21T14:00:59Z", "bug_id": 59363, "creation_time": "2016-04-21T14:00:59Z", "is_private": false}, {"count": 22, "tags": [], "text": "Not a problem.\n\nThe original validation query was invalid; however this did not cause a problem as it was not being used previously. So the incorrect setting went unnoticed.", "is_private": false, "bug_id": 59363, "id": 190453, "time": "2016-04-21T14:32:36Z", "creator": "sebb@apache.org", "creation_time": "2016-04-21T14:32:36Z", "attachment_id": null}, {"count": 23, "tags": [], "text": "(In reply to Sebb from comment #22)\n> Not a problem.\n> \n> The original validation query was invalid; however this did not cause a\n> problem as it was not being used previously. So the incorrect setting went\n> unnoticed.\n\nHi Sebb,\nMaybe changes should mention to take care about this as it seems Validation Query was not used by old pool even when keep alive.\nNote there is something strange here, DBCP pool is created with:\ndataSource.setTestOnBorrow(false);\n        dataSource.setTestOnReturn(false);\n        dataSource.setTestOnCreate(false);\n        dataSource.setTestWhileIdle(false);\n\nIn this case only testWhileIdle is true:\n            dataSource.setTestWhileIdle(true);\n\nIn my understanding, the validation query would have been executed while connection is idle after 1 minute while it appears test is done before execution.\n\nMaybe there is an issue.\nRegards", "is_private": false, "bug_id": 59363, "id": 190456, "time": "2016-04-21T15:03:39Z", "creator": "support@ubikloadpack.com", "creation_time": "2016-04-21T15:03:39Z", "attachment_id": null}, {"count": 24, "tags": [], "bug_id": 59363, "attachment_id": 33790, "is_private": false, "id": 190464, "time": "2016-04-21T17:37:47Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-04-21T17:37:47Z", "text": "Created attachment 33790\nUse jdbc isValid method, when no query is given\n\nAs asked by the reporter, with this patch it is possible to leave the validation query blank. In that case dbcp pool will use the isValid method of the jdbc driver (when testWhileIdle is selected).\n\nI wonder, whether we should include this patch (with documentation) in 3.0 (rc3), or leave it open until 3.1 (probably a bit safer)."}, {"count": 25, "tags": [], "text": "Author: pmouawad\nDate: Thu Apr 21 21:00:29 2016\nNew Revision: 1740410\n\nURL: http://svn.apache.org/viewvc?rev=1740410&view=rev\nLog:\nBug 59363 - Bug in JDBC Request Sampler for Nightly Build (21.04.2016)\nDocument behaviour\nBugzilla Id: 59363\n\nModified:\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "is_private": false, "bug_id": 59363, "id": 190471, "time": "2016-04-21T21:01:38Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-21T21:01:38Z", "attachment_id": null}, {"count": 26, "tags": [], "text": "(In reply to Felix Schumacher from comment #24)\n> Created attachment 33790 [details]\n> Use jdbc isValid method, when no query is given\n> \n> As asked by the reporter, with this patch it is possible to leave the\n> validation query blank. In that case dbcp pool will use the isValid method\n> of the jdbc driver (when testWhileIdle is selected).\n> \n> I wonder, whether we should include this patch (with documentation) in 3.0\n> (rc3), or leave it open until 3.1 (probably a bit safer).\n\n+1\nBut I think you should create a new Bugzilla in Improvement as this one is not a bug and does not need a fix.", "is_private": false, "bug_id": 59363, "id": 190472, "time": "2016-04-21T21:05:26Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-21T21:05:26Z", "attachment_id": null}, {"count": 27, "tags": [], "text": "For reference:\nThe dbcp2 pool uses the validationQuery to validate the pool on its creation:\nhttps://github.com/apache/commons-dbcp/blob/trunk/src/main/java/org/apache/commons/dbcp2/BasicDataSource.java#L2301\n\nThen:\nhttps://github.com/apache/commons-dbcp/blob/trunk/src/main/java/org/apache/commons/dbcp2/PoolableConnection.java#L289", "is_private": false, "bug_id": 59363, "id": 190473, "time": "2016-04-21T21:07:16Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-21T21:07:16Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 59363, "is_private": false, "count": 28, "id": 192148, "time": "2016-07-05T19:16:32Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-07-05T19:16:32Z", "text": "*** Bug 59792 has been marked as a duplicate of this bug. ***"}, {"count": 29, "tags": [], "bug_id": 59363, "attachment_id": null, "is_private": false, "id": 192151, "time": "2016-07-05T19:47:43Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-07-05T19:47:43Z", "text": "(In reply to Philippe Mouawad from comment #26)\n> (In reply to Felix Schumacher from comment #24)\n> > Created attachment 33790 [details]\n> > Use jdbc isValid method, when no query is given\n> > \n> > As asked by the reporter, with this patch it is possible to leave the\n> > validation query blank. In that case dbcp pool will use the isValid method\n> > of the jdbc driver (when testWhileIdle is selected).\n> > \n> > I wonder, whether we should include this patch (with documentation) in 3.0\n> > (rc3), or leave it open until 3.1 (probably a bit safer).\n> \n> +1\n> But I think you should create a new Bugzilla in Improvement as this one is\n> not a bug and does not need a fix.\n\nDone with Bug 59803."}]
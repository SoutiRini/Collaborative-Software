[{"count": 0, "tags": [], "bug_id": 32811, "attachment_id": null, "text": "The J2EE spec indicates that a response is considered committed after\nsendRedirect().  But, Tomcat will return a different response code if an\nexception is thrown after a call to sendRedirect.\n\nThis means that the following jsp:\n<%\nresponse.sendRedirect(\"/index.jsp\");\nthrow new javax.servlet.ServletException(\"redirected\");\n%> \nshould redirect the browser according to the spec.  Instead, a 500 error is\nreturned.  WebSphere, WebLogic and Jetty all return the redirect.\n\nWithout critiquing the strategy (its not mine), this is used by some to allow\napps to short cut jsp content after a redirect.  The theory is that the\nexception will be logged but the user will never know.", "id": 68863, "time": "2004-12-22T22:14:29Z", "creator": "wpoziombka@budweiser.com", "creation_time": "2004-12-22T22:14:29Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bsouther@fwdco.com", "attachment_id": null, "id": 68940, "time": "2004-12-23T17:51:37Z", "bug_id": 32811, "creation_time": "2004-12-23T17:51:37Z", "is_private": false, "text": "I'm surprised that page compiles in Jetty.\nDoesn't it use the Jasper compiler as well?\n\nAFAIK, sendRedirect and throw statements always need to be \ncontained in a branch if there is any code after them.\n\nI would, however, expect this page to return a redirect instead of \na server error.  I tested with 5.0.30 and it compiled but returned a server 500\nerror.\n\n<%                                                                             \n                \nif(request.getParameter(\"test\") == null){\n    response.sendRedirect(\"/index.jsp\");\n}                                                                              \n               \nif(request.getParameter(\"test\") == null){\n    throw new Exception(\"Can't Redirect\");\n}                                                                              \n             \n%>\n"}, {"count": 2, "tags": [], "bug_id": 32811, "text": "If the issue exists, it will be related to the way exceptions are handled, and\nonly this particular case will be a problem.", "id": 68941, "time": "2004-12-23T18:48:42Z", "creator": "remm@apache.org", "creation_time": "2004-12-23T18:48:42Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "wpoziombka@budweiser.com", "text": "(In reply to comment #1)\n> I'm surprised that page compiles in Jetty.\n> Doesn't it use the Jasper compiler as well?\n> \n> AFAIK, sendRedirect and throw statements always need to be \n> contained in a branch if there is any code after them.\n> \n> I would, however, expect this page to return a redirect instead of \n> a server error.  I tested with 5.0.30 and it compiled but returned a server 500\n> error.\n> \n> <%                                                                             \n>                 \n> if(request.getParameter(\"test\") == null){\n>     response.sendRedirect(\"/index.jsp\");\n> }                                                                              \n>                \n> if(request.getParameter(\"test\") == null){\n>     throw new Exception(\"Can't Redirect\");\n> }                                                                              \n>              \n> %>\n> \n\nI paraphrased the page for clarity.  Most concise would look something like:\n<%\nresponse.sendRedirect(\"/index.jsp\"):\nif (true) throw new javax.servlet.ServletException(\"redirected\");\n%>\n", "id": 69016, "time": "2004-12-27T18:40:29Z", "bug_id": 32811, "creation_time": "2004-12-27T18:40:29Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 32811, "attachment_id": null, "text": "sendRedirect does set the appropriate flags such that calling\nresponse.isCommitted() does return true. For example:\n\n<%\nresponse.sendRedirect(\"cowbell.jsp\");\nif (!response.isCommitted()) {\n   System.out.println(\"Why am I not committed?\");\n}\n%>\n\nBut even though the response is \"committed\", an error being thrown can result in\nthe redirect not being sent to the client - but instead - an error is sent to\nthe client. Whether this is a \"bug\" or not - I am indifferent.", "id": 69061, "time": "2004-12-29T18:54:31Z", "creator": "funkman@joedog.org", "creation_time": "2004-12-29T18:54:31Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 32811, "text": "(In reply to comment #4)\n\nThe spec states: \"The isCommitted method returns a boolean value indicating\nwhether any response bytes have been returned to the client.\" (SRV 5.1)  Clearly\nthis is not the case with Tomcat.  If it were true, the client would receive the\nredirect not the error. ", "id": 69155, "time": "2005-01-03T16:53:37Z", "creator": "wpoziombka@budweiser.com", "creation_time": "2005-01-03T16:53:37Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 32811, "attachment_id": null, "text": "No, the client may have received other bytes prior to the redirect, e.g. the \ncontent length or other headers.   This area is covered well in the \nServlet/JSP TCKs, which Tomcat passes.", "id": 69178, "time": "2005-01-03T19:24:03Z", "creator": "yoavs@computer.org", "creation_time": "2005-01-03T19:24:03Z", "is_private": false}, {"count": 7, "tags": [], "creator": "wpoziombka@budweiser.com", "text": "(In reply to comment #6)\n> No, the client may have received other bytes prior to the redirect, e.g. the \n> content length or other headers.   \n\nThe first line of a response is the status line.  So, a redirect (302 -\nSC_FOUND) cannot be sent after any other byte.  If the client has received bytes\nthe response should be considered committed and subsiquent calls to sendRedirect\nshould throw an exception.  However, that is not even the issue here.  \n\nThe issue is that the sendRedirect does not commit the response (as the spec\ndefines in its description of isCommitted).  The sendRedirect does not send the\n302 status line to the client prior to an exception.  When an exception occurs\nthe buffer is reset and a 500 is sent instead.  It seems that the client should\nstill receive a 302 (SC_FOUND).  It appears that this is how other servlet\ncontainers have interpreted the specification.", "id": 69221, "time": "2005-01-05T02:38:50Z", "bug_id": 32811, "creation_time": "2005-01-05T02:38:50Z", "is_private": false, "attachment_id": null}]
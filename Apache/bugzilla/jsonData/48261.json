[{"count": 0, "attachment_id": 24586, "bug_id": 48261, "is_private": false, "id": 132237, "time": "2009-11-23T03:40:24Z", "creator": "pgervaise@free.fr", "creation_time": "2009-11-23T03:40:24Z", "tags": [], "text": "Created attachment 24586\nThe excel file that cannot be opened with POI\n\nWith that code :\n\nFileInputStream in = new FileInputStream(\"not_work.xls\");\nHSSFWorkbook w = new HSSFWorkbook(in);\n\nIt generate an exception :\n\nWarning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0)\nWarning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0)\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: 0\n\tat org.apache.poi.poifs.storage.DocumentBlock.getDataInputBlock(DocumentBlock.java:162)\n\tat org.apache.poi.poifs.filesystem.POIFSDocument.getDataInputBlock(POIFSDocument.java:253)\n\tat org.apache.poi.poifs.filesystem.DocumentInputStream.getDataInputBlock(DocumentInputStream.java:117)\n\tat org.apache.poi.poifs.filesystem.DocumentInputStream.<init>(DocumentInputStream.java:75)\n\tat org.apache.poi.poifs.filesystem.DirectoryNode.createDocumentInputStream(DirectoryNode.java:131)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:273)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:200)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:316)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:297)\n\tat Main.main(Main.java:10)\n\n\nFor Excel 97 (and Excel 2007) I can open the file and with all data.\n\nNote : I tested with POI 2.0, POI 3.0-RC4, POI 3.1 and POI 3.2 and the result is :\n\nException in thread \"main\" java.io.IOException: block[ 0 ] already removed\n\tat org.apache.poi.poifs.storage.BlockListImpl.remove(BlockListImpl.java:97)\n\tat org.apache.poi.poifs.storage.BlockAllocationTableReader.fetchBlocks(BlockAllocationTableReader.java:190)\n\tat org.apache.poi.poifs.storage.BlockListImpl.fetchBlocks(BlockListImpl.java:130)\n\tat org.apache.poi.poifs.storage.SmallBlockTableReader.getSmallDocumentBlocks(SmallBlockTableReader.java:61)\n\tat org.apache.poi.poifs.filesystem.POIFSFileSystem.<init>(POIFSFileSystem.java:176)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:312)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:293)\n\tat Main.main(Main.java:12)"}, {"count": 1, "tags": [], "text": "Doesn't know how the file is generated. It came for a partner by email.\n\nIt seems that the bug is similar for bug n\u00b032076.", "attachment_id": null, "id": 132238, "creator": "pgervaise@free.fr", "time": "2009-11-23T03:44:48Z", "bug_id": 48261, "creation_time": "2009-11-23T03:44:48Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 48261, "is_private": false, "id": 132636, "time": "2009-12-07T00:22:27Z", "creator": "baris.ulucinar@gmail.com", "creation_time": "2009-12-07T00:22:27Z", "tags": [], "text": "I Have the same error, with the same version of Apache POI: 3.5-FINAL, it's a patch available ? \n\nmy error log: \n\njava.lang.ArrayIndexOutOfBoundsException: 0\n\tat org.apache.poi.poifs.storage.DocumentBlock.getDataInputBlock(DocumentBlock.java:163)\n\tat org.apache.poi.poifs.filesystem.POIFSDocument.getDataInputBlock(POIFSDocument.java:253)\n\tat org.apache.poi.poifs.filesystem.DocumentInputStream.getDataInputBlock(DocumentInputStream.java:117)\n\tat org.apache.poi.poifs.filesystem.DocumentInputStream.<init>(DocumentInputStream.java:75)\n\tat org.apache.poi.poifs.filesystem.DirectoryNode.createDocumentInputStream(DirectoryNode.java:131)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:273)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:200)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:316)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:297)\n\tat org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:60)"}, {"count": 3, "tags": [], "bug_id": 48261, "attachment_id": null, "is_private": false, "id": 132637, "time": "2009-12-07T00:22:27Z", "creator": "baris.ulucinar@gmail.com", "creation_time": "2009-12-07T00:22:27Z", "text": "I Have the same error, with the same version of Apache POI: 3.5-FINAL, it's a patch available ? \n\nmy error log: \n\njava.lang.ArrayIndexOutOfBoundsException: 0\n\tat org.apache.poi.poifs.storage.DocumentBlock.getDataInputBlock(DocumentBlock.java:163)\n\tat org.apache.poi.poifs.filesystem.POIFSDocument.getDataInputBlock(POIFSDocument.java:253)\n\tat org.apache.poi.poifs.filesystem.DocumentInputStream.getDataInputBlock(DocumentInputStream.java:117)\n\tat org.apache.poi.poifs.filesystem.DocumentInputStream.<init>(DocumentInputStream.java:75)\n\tat org.apache.poi.poifs.filesystem.DirectoryNode.createDocumentInputStream(DirectoryNode.java:131)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:273)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:200)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:316)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:297)\n\tat org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:60)"}, {"count": 4, "tags": [], "bug_id": 48261, "attachment_id": null, "id": 137326, "time": "2010-06-03T12:50:47Z", "creator": "apache@gagravarr.org", "creation_time": "2010-06-03T12:50:47Z", "is_private": false, "text": "As best as I can tell, the file is at least partly corrupted. The POIFS block listing is wrong for starters (hence the warnings)\n\nI strongly suspect that the file was generated by something other than Excel, and the program in question doesn't properly follow the spec\n\nI'd suggest you either re-save the files using Excel to fix them, or speak to whoever writes the software that generates them and ask them to re-read the spec and fix their output"}, {"count": 5, "tags": [], "bug_id": 48261, "attachment_id": null, "id": 146561, "time": "2011-05-23T19:43:18Z", "creator": "apache@gagravarr.org", "creation_time": "2011-05-23T19:43:18Z", "is_private": false, "text": "In case anyone comes across this, with 3.8 the new NPOIFS is more tolerant of this class of faulty file, and can open the attached sample excel file. POIFS can also open more files in this class that it couldn't in 3.6, but the real fix does appear to be with the program that produces the file."}]
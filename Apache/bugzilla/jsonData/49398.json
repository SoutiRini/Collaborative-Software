[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 137409, "time": "2010-06-07T11:21:58Z", "bug_id": 49398, "creation_time": "2010-06-07T11:21:58Z", "is_private": false, "text": "There is a bug in implementation of the following method\norg.apache.tomcat.util.buf.ByteChunk.indexOf(String src, int srcOff, int srcLen, int myOff) in 6.0.26 and 5.5.29.\n\nThe problem is that the method can not find a string which consists of one character, as the only successful exit from the method is from inside the loop that checks the second and subsequent characters.\n\nE.g., to reproduce:\nbyte[] bytes = \"Hello\\u00a0world\".getBytes(\"ISO-8859-1\");\nfinal int len = bytes.length;\nByteChunk bc = new ByteChunk();\nbc.setBytes(bytes, 0, len);\nbc.indexOf(\"o\", 0, 1, 5); // returns -1, instead of 7.\n\nA testcase for this was added in r945230 and it was fixed in trunk in r945231\n\nThis is not observable without a testcase, because all calls to this method in the current Tomcat 6.0.26 and 5.5.29 code pass a string of several characters."}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Fixed in 5.5 and 6.0, will be in 5.5.30, 6.0.27.", "id": 137410, "time": "2010-06-07T11:42:15Z", "bug_id": 49398, "creation_time": "2010-06-07T11:42:15Z", "is_private": false, "attachment_id": null}]
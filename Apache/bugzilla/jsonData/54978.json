[{"count": 0, "tags": [], "bug_id": 54978, "text": "If testOnBorrow is set true, testOnConnect is false, and validationQuery is an illegal query, the current implementation will hide the fact that validationQuery never succeeds.\n\nThe offending code is in org.apache.tomcat.jdbc.pool.ConnectionPool line 797.\n\n790            //if we reached here, that means the connection\n791\t            //is either has another principal, is discarded or validation failed.\n792\t            //we will make one more attempt\n793\t            //in order to guarantee that the thread that just acquired\n794\t            //the connection shouldn't have to poll again.\n795\t            try {\n796\t                con.reconnect();\n797\t                if (con.validate(PooledConnection.VALIDATE_INIT)) {\n\nInstead, con.validate(PooledConnection.VALIDATE_BORROW) should be called.", "id": 167226, "time": "2013-05-15T19:30:25Z", "creator": "tim.poole@fmr.com", "creation_time": "2013-05-15T19:30:25Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 54978, "text": "Or better, something akin to con.validate(PooledConnection.VALIDATE_INIT | PooledConnection.VALIDATE_BORROW).", "id": 167244, "time": "2013-05-16T13:23:20Z", "creator": "tim.poole@fmr.com", "creation_time": "2013-05-16T13:23:20Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 54978, "attachment_id": null, "id": 177000, "time": "2014-08-07T23:16:34Z", "creator": "fhanik@apache.org", "creation_time": "2014-08-07T23:16:34Z", "is_private": false, "text": "Thank you for the report, tricky indeed.\n\nFixed in r1616625"}]
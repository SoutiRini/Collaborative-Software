[{"text": "Hi\n\nmy platform\nIIS7.5 on W2008R2 sp1 (thre are 2 setup in a NLB config)\n1.2.32 64 connector\n\nConnecting to 6.2Final Jboss \n\nWe have a client programme that opens a connection and uses keep alive to keep the connection open.  We typically have 200-300 connections open at one time.\nOur application pool on IIS was setup in a web garden mode, so for use that mean there was 4 process ids for the virtual web site the plugin was connected to.\n\nSo when we had a manual recycle happen all hell broke lose, the client were getting 500's back from the server. for any page that was related to the virtual web site... it would fail at the filter entry point. looks like the connector had become corrupt and was failing everything.\n\nSo from some investigating we fix it by moving to pessimistic locking .... and changing to non overlapping recycles.\n\nwe fixed opp locking is really for single processes + multi threading not multi processes and multithreads!\n\nI am not 100% sure why the over lapping recycle failed and I believe corrupted the shm memory but i believe it has something to do with IIS restarting the application pool and I presume with the shared memory block.\n\nWe saw that the error became exasperated when there were more clients attempting to connect.  if there was only 20-40 clients, no problem it worked... but 200 and it went haywire.\n\none interesting test we did was to reboot one node of the NLB cluster, and when it restared it went straight into 500 mode, because 200 client were trying to connect.\n\n\nCan you some how make the option for the connection to default to pessimistic mode instead of op.. This i think might be the problem with the over lapping recycle\n\nAlex", "tags": [], "bug_id": 52659, "is_private": false, "count": 0, "id": 153758, "time": "2012-02-14T01:37:29Z", "creator": "alex.samad@yieldbroker.com", "creation_time": "2012-02-14T01:37:29Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "alex.samad@yieldbroker.com", "attachment_id": null, "id": 154527, "time": "2012-03-05T05:27:12Z", "bug_id": 52659, "creation_time": "2012-03-05T05:27:12Z", "is_private": false, "text": "I have changed OS platform. and changed to critical...\n\nDone more testing.\n\nsetup \n\n1 client -> 1 IIS 7.5 + nod_jk -> jboss server\n\nIIS7 app pool is setup for 4 process (web garden) and overlapping recycle\n\nwe have the client making 300 - 500 connections to the IIS7.5\n\nwhilst this is going on we recycle the application pool. \n\nmodjk becomes confused and i believe corrupts the shm area all requests get 500 error.\n\nWhilst leaving the application on, we restart IIS7.5 so there are 500 connection attempted to be made and when IIS restarts we go straight back into 500 errors.\n\nwe have to block in the inbound connections and then start IIS and wait a few seconds and then let the connections in (allow them through the firewall)\n\nso sign i see of this.\n\nthe ajp logs has errors for uri's not being allocation.. and then stopping (presumably after the config file has been read).\n\nI believe we should change locking for the windows platform to pessi\n\nalso why is the extension taking request when it hasn't read the config file yet !!!"}, {"count": 2, "tags": [], "bug_id": 52659, "attachment_id": null, "text": "this is an email i sent to the ML (has some extra info, maybe a better description)\n\n\nHi\n\nThis is my prod setup\n\nClient -> Internet -> IIS7.5/NLB (2 node cluster) with the 1.2.32 tomcat connector -> 2 node tomcat cluster.\n\nWe had done a fair bit of testing on this setup enough to move into production.  But we ran into a problem ... when IIS recycle its application pool. Luckily we had set this to manually happen after hours\n\nSo I setup a test rig to see if I could simulate the problem.  The test rig is\n\nClient -> 1 node of IIS7.5  + 1.2.32 tomcat connector -> 2 node of development tomcat :)\n\nThe client works by creating a connection and keeping it open and making lots of requests.  \n\nWe have jerry rigged a client to make multiple of these as the error occurs when the system is under load.\n\nSo the test scenario is \nstart client\nlogin >>> this creates 1 connection \nstrat stress test >>> this creates 500 connection and does a little bit of polling\n\nMy initial setup is \n4 process worker threads for the application pool\nAllow overlapping recycle >>>> my understanding is this means the 4 threads are not all terminated at once, but one at a time as a new thread is restarted\n\nI use isapi_redirect.properties file\n============================\nextension_uri=/jakarta/isapi_redirect.dll\nlog_file=C:\\ThisNow\\Local\\dev.ThisNow.com\\Logs\\ajpconfisapi_redirect.log\nlog_level=warn\nlog_filesize=20M\nworker_file=C:\\ThisNow\\Shared\\dev.ThisNow.com\\ajpconfig\\workers.properties\nworker_mount_file=C:\\ThisNow\\Shared\\dev.ThisNow.com\\ajpconfig\\uriworkermap.properties\nrewrite_rule_file=C:\\ThisNow\\Shared\\dev.ThisNow.com\\ajpconfig\\\\rewrite.properties\n\n\nC:\\ThisNow\\Shared\\dev.ThisNow.com\\ajpconfig\\workers.properties\n====================================================\nworker.maintain=60\nworker.list=jbclb\nworker.jbclb.type=lb\nworker.jbclb.balance_workers=worker1, worker2\nworker.jbclb.sticky_session=true\nworker.jbclb.method=Request\nworker.jbclb.lock=pessimistic\n\n# Template for all worker threads\nworker.template.type=ajp13\nworker.template.port=8009\nworker.template.ping_mode=A\nworker.template.ping_timeout=30000\nworker.template.connection_pool_size=1000\nworker.template.connection_pool_minsize=100\nworker.template.socket_keepalive=true\nworker.template.lock=pessimistic\nworker.template.max_packet_size=65536\n\n# worker 1\nworker.worker1.host=10.172.204.30\nworker.worker1.route=node1\nworker.worker1.reference=worker.template\n\n# worker 1\nworker.worker2.route=node2\nworker.worker2.host=10.172.204.31\nworker.worker2.reference=worker.template\n\nworker.list=jkstatus\n# Define a 'jkstatus' worker using status\nworker.jkstatus.type=status\n\n\n\nC:\\ThisNow\\Shared\\dev.ThisNow.com\\ajpconfig\\uriworkermap.properties\n========================================================= \n/dev.ThisNow.com/ThisNowLive|/*=jbclb\n/dev.ThisNow.com/wls|/*=jbclb\n/dev.ThisNow.com/jkmanager|/*=jkstatus\n/10.172.204.33/jkmanager|/*=jkstatus\n/ThisNowodevrp01/jkmanager|/*=jkstatus\n\n\n\n\nC:\\ThisNow\\Shared\\dev.ThisNow.com\\ajpconfig\\rewrite.properties\n=================================================== \n# rewrite rules\n# Convert single node \n~/jb./(.*)=/$1\n/web-debts-1.0.0-nossl/=/web-debts-1.0.0/\n\n\nI can see there are 500 connection to IIS and ~500 connection through to tomcat. Check with perfmon, netstat...\n\nWhen I recycle the application pool. IIS starts to send 500's back to the server.... it complain about the tomcat connector returning an error errorcode 2147942401, internal server error Incorrect Function 0c80070001\n\nWhat I can see from the network side of things. Is the client is trying to recreate all 500 connections at once.\n\nWhat I can see in my tomcat connector logs... some times there is 4 for each process and sometimes 2 or 3, if its crashed into this 500 error loop\n\n\nExamples of what I see (2 log files)\nAjp file 1\n===\n[Tue Mar 06 14:46:46.572 2012] [5872:5028] [error] ajp_worker_factory::jk_ajp_common.c (2997): allocating ajp worker record from shared memory \n[Tue Mar 06 14:46:46.572 2012] [5872:5028] [error] wc_create_worker::jk_worker.c (151): factory for ajp13 failed for worker2 \nm shared memory \n[Tue Mar 06 14:46:46.572 2012] [5872:5028] [error] validate::jk_lb_worker.c (1615): Failed creating worker worker2 \nworker2 \n[Tue Mar 06 14:46:46.587 2012] [2888:5708] [error] ajp_worker_factory::jk_ajp_common.c (2997): allocating ajp worker record from shared memory \n[Tue Mar 06 14:46:46.603 2012] [5872:5028] [error] validate::jk_lb_worker.c (1663): NULL parameters \n[Tue Mar 06 14:46:46.603 2012] [5872:5028] [error] wc_create_worker::jk_worker.c (163): validate failed for jbclb \n worker2 \n[Tue Mar 06 14:46:46.619 2012] [5872:5028] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \n[Tue Mar 06 14:46:46.619 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.619 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.634 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.634 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.634 2012] [1536:1332] [error] validate::jk_lb_worker.c (1663): NULL parameters \nd not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.634 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.634 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.634 2012] [1536:1332] [error] wc_create_worker::jk_worker.c (163): validate failed for jbclb \n[Tue Mar 06 14:46:46.634 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.634 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.650 2012] [5872:5028] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.650 2012] [1536:1332] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.650 2012] [1536:1332] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [1536:1332] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [1536:1332] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [1536:1332] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [2888:5708] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \nwith name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [1536:1332] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.697 2012] [2888:5708] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing.  \n\nAjp log file 2\n============== \n[Tue Mar 06 14:46:46.650 2012] [5872:3624] [warn] init_jk::jk_isapi_plugin.c (2738): The optimal shared memory size can now be determined automatically. \n[Tue Mar 06 14:46:46.650 2012] [5872:3624] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] wc_create_worker::jk_worker.c (151): factory for lb failed for jbclb \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.665 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.681 2012] [5872:3624] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.697 2012] [5872:2836] [warn] init_jk::jk_isapi_plugin.c (2738): The optimal shared memory size can now be determined automatically. \n[Tue Mar 06 14:46:46.697 2012] [2888:4792] [warn] init_jk::jk_isapi_plugin.c (2738): The optimal shared memory size can now be determined automatically. \n[Tue Mar 06 14:46:46.697 2012] [5872:2836] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.712 2012] [2888:4792] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.712 2012] [2888:4792] [error] wc_create_worker::jk_worker.c (151): factory for lb failed for jbclb \nw be determined automatically. \n[Tue Mar 06 14:46:46.728 2012] [2888:4792] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \nte if you want to use the optimal size. \n[Tue Mar 06 14:46:46.728 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.728 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.728 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.728 2012] [1536:1492] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \n[Tue Mar 06 14:46:46.728 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.728 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.744 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [2888:4792] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.759 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n \n[Tue Mar 06 14:46:46.759 2012] [5872:2836] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.775 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.775 2012] [1536:1492] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.775 2012] [5872:3380] [warn] init_jk::jk_isapi_plugin.c (2738): The optimal shared memory size can now be determined automatically. \n[Tue Mar 06 14:46:46.790 2012] [5872:3380] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.790 2012] [1536:1272] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.790 2012] [2888:1548] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.790 2012] [1536:1272] [error] wc_create_worker::jk_worker.c (151): factory for lb failed for jbclb \n[Tue Mar 06 14:46:46.790 2012] [2888:1548] [error] wc_create_worker::jk_worker.c (151): factory for lb failed for jbclb \n[Tue Mar 06 14:46:46.806 2012] [1536:1272] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \nwith name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.806 2012] [2888:1548] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \n[Tue Mar 06 14:46:46.806 2012] [5872:3380] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.806 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.806 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.806 2012] [5872:3380] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.806 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.806 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.822 2012] [5872:3380] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.822 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.822 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n \n[Tue Mar 06 14:46:46.822 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.822 2012] [5872:3380] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.822 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.837 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.837 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.837 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.837 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.837 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.837 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n \n[Tue Mar 06 14:46:46.853 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.853 2012] [5872:3380] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.853 2012] [1536:1272] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.853 2012] [2888:1548] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.869 2012] [2888:3536] [warn] init_jk::jk_isapi_plugin.c (2738): The optimal shared memory size can now be determined automatically. \n[Tue Mar 06 14:46:46.869 2012] [2888:3536] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.869 2012] [1536:5072] [warn] init_jk::jk_isapi_plugin.c (2738): The optimal shared memory size can now be determined automatically. \n[Tue Mar 06 14:46:46.884 2012] [1536:5072] [warn] init_jk::jk_isapi_plugin.c (2740): You can remove the shm_size attribute if you want to use the optimal size. \n[Tue Mar 06 14:46:46.884 2012] [2888:3536] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \n[Tue Mar 06 14:46:46.884 2012] [1536:5072] [error] wc_create_worker::jk_worker.c (151): factory for lb failed for jbclb \n[Tue Mar 06 14:46:46.884 2012] [1536:5072] [error] build_worker_map::jk_worker.c (262): failed to create worker jbclb \nwith name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.884 2012] [1536:5072] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.884 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.884 2012] [1536:5072] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.900 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.900 2012] [1536:5072] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.900 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.900 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.900 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.915 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.915 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jbclb' in uri map post processing. \n[Tue Mar 06 14:46:46.915 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.915 2012] [1536:5072] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing. \n[Tue Mar 06 14:46:46.915 2012] [2888:3536] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'jkstatus' in uri map post processing.  \n\n\n\nDuring normal startup I don't see anything logged at all.\n\nMy initial testing was to move from overlapping recycle to non-overlapping recycle. This seems to have solved it for 99% of the time. But if I get enough connection trying to hit the server at 1 time, in my case > ~450 it will cause this corruption some of the times :)\n\nMy best solution is to go to single process thread and non over lapping (although I would have thought non overlapping shouldn't have an effect, but maybe that is how IIS decides to kill first or afterwards!)\n\n\nSo my conclusion / presumption is there is an issue with the shared memory locking and also what seems to be the initialisation code sequencing.\n\nUnder load, IIS will first start 1 process and then if enough request another and another depending on load.  So what I see is 4 process starting at about the same time and the shared memory is getting corrupted and from there it turns to poo.\n\nI can presume it get corrupted for 2 reasons.  Firstly the connector logs faults unable to map a URI and then stop warning about that, I can presume that, the process in question hasn't reads its config and then eventual does !\n\nIf it hasn't read its config and it processing uri's and presumable touching the SHM, it is doing so under an optimistic locking method... That in windows land using in process locking methods, which don't work across processes ! (this is different to linux/unix world). \n\nSo I am thinking 2 changes need to be made. The connector needs to default to pessimistic locking (maybe the default for windows).... It also depends on how to fix the init code.  If you can guarantee that the config file will be processed before the Shared memory is touched, then maybe its okay to leave the default to optimistic.\n\nThe second bug, the connector needs to be fully initialised before it starts to process any URI's... This is not good ... but I think it a problem with Web Gardens (this is the name given by MS for more than 1 process in the application pool)\nWhen it was architected I can guess this wouldn't have been the setup.  I could presume (haven\u2019t looked at the init stuff yet), but if it find the SHM memory already created, it thinks it's ready to go !\n\n\nI don't mind digging around the code and supplying patches, but I am more used to the linux world and well , I have tried to build the connector in VS 2010 and .....\n\nDoes somebody have a tar  ball of a tree what I can just point to and compile :) (or maybe some instruction on how to get it to build from the svn tree in VS2010)", "id": 154557, "time": "2012-03-06T05:35:40Z", "creator": "alex.samad@yieldbroker.com", "creation_time": "2012-03-06T05:35:40Z", "is_private": false}, {"text": "Fixed with the 1.2.34 by ensuring that ...\n1. We have a process mutex for serializing initialization\n2. Parameters are updated from shared memory if shared memory is explicitly updated\n\nNote however that recycle and isapi_redirector are conceptually wrong.\nisapi_redirector is a proxy, has its own connection pool and connection pool management. You should disable IIS worker recycle in production to have optimal performance, because the entire recycle concept is meant to handle wrongly written .NET applications having memory leaks. This is not the case with isapi_redirect.\n\nNext you should also limit the number if isapi_redirect instances per physical IIS instance and preferably have just one. You can use uriworkerap.properties to handle mapping for multiple vhosts.", "tags": [], "bug_id": 52659, "is_private": false, "count": 3, "id": 155082, "time": "2012-03-20T04:55:20Z", "creator": "mturk@apache.org", "creation_time": "2012-03-20T04:55:20Z", "attachment_id": null}]
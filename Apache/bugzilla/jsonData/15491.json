[{"count": 0, "tags": [], "creator": "dmitri@netilla.com", "text": "I was plating with mod_ext_filter in 2.0.43, when I noticed that a shell command\nwith a period in its name produces an error.  After playing with it some more, I\ncame up with a test case that I can reproduce without fail.\n\nScript:\n-------\n#!/bin/sh\n\ncat | tr a-z A-Z\n-------\n\nWorking Config:\n-------------------\n# caser, caser.x, and caser.sh are all copies of the same file.\nExtFilterDefine caser intype=text/html mode=output cmd=/usr/local/bin/caser\nExtFilterDefine caserx intype=text/html mode=output cmd=/usr/local/bin/caser.x\nExtFilterDefine caserq intype=text/html mode=output cmd=\"/usr/local/bin/caser.sh\n\"\nExtFilterDefine casersh intype=text/html mode=output cmd=/usr/local/bin/caser.sh\n<Directory />\n    Options FollowSymLinks\n    AllowOverride None\n    SetOutputFilter casersh\n    ExtFilterOptions DebugLevel=1\n</Directory>\n-------------------\n\nError-producing config:\n-----------------------\n# caser, caser.x, and caser.sh are all copies of the same file.\nExtFilterDefine caser intype=text/html mode=output cmd=/usr/local/bin/caser\nExtFilterDefine caserx intype=text/html mode=output cmd=/usr/local/bin/caser.x\n#ExtFilterDefine caserq intype=text/html mode=output cmd=\"/usr/local/bin/caser.s\nh\"\nExtFilterDefine casersh intype=text/html mode=output cmd=/usr/local/bin/caser.sh\n<Directory />\n    Options FollowSymLinks\n    AllowOverride None\n    SetOutputFilter casersh\n    ExtFilterOptions DebugLevel=1\n</Directory>\n--------------------------\n\n\nNote that the only change is that caserq definition is commented out.  Here's\nthe error:\n\n[Wed Dec 18 12:27:45 2002] [debug] mod_ext_filter.c(611): [client 192.168.1.105]\nfiltering `/manual/mod/mod_ext_filter.html.en' of type `text/html' through\n`/usr/local/bin/caser.sh', cfg ExtFilterOptions DebugLevel=1 NoLogStderr\n!PreserveContentLength ExtFilterInType text/html ExtFilterOuttype (unchanged),\nreferer: http://socrates.netilla.com/manual/filter.html\n[Wed Dec 18 12:27:45 2002] [error] [client 192.168.1.105] (32)Broken pipe:\napr_file_write(child input), len 0, referer:\nhttp://socrates.netilla.com/manual/filter.html", "id": 28018, "time": "2002-12-18T17:29:23Z", "bug_id": 15491, "creation_time": "2002-12-18T17:29:23Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 15491, "attachment_id": null, "text": "looks like exec*() is returning EFAULT in the failure case...  mod_ext_filter\nwasn't properly building the argument array in the simple case where there are\nno quotation marks...  sometimes it worked, sometimes exec*() hit bad storage...\n\nHere is the fix:\n\nIndex: modules/filters/mod_ext_filter.c\n===================================================================\nRCS file: /home/cvs/httpd-2.0/modules/filters/mod_ext_filter.c,v\nretrieving revision 1.1\ndiff -u -r1.1 mod_ext_filter.c\n--- modules/filters/mod_ext_filter.c    14 Nov 2002 20:22:50 -0000      1.1\n+++ modules/filters/mod_ext_filter.c    13 Jan 2003 19:31:11 -0000\n@@ -222,9 +222,10 @@\n     else\n     {\n         /* simple path */\n-        /* Allocate space for one argv pointer and parse the args. */\n-        filter->args = (char **)apr_palloc(p, sizeof(char *));\n+        /* Allocate space for two argv pointers and parse the args. */\n+        filter->args = (char **)apr_palloc(p, 2 * sizeof(char *));\n         filter->args[0] = ap_getword_white(p, args);\n+        filter->args[1] = NULL; /* end of args */\n     }\n     if (!filter->args[0]) {\n         return \"Invalid cmd= parameter\";\n\nIt is now in CVS for Apache 2.1.  I can't make any promises on whether or \nnot it will be in 2.0.44, but it should be in one of the next couple of\n2.0 releases.\n\nThanks for your report, and thanks for using Apache!", "id": 29293, "time": "2003-01-13T19:38:27Z", "creator": "trawick@apache.org", "creation_time": "2003-01-13T19:38:27Z", "is_private": false}]
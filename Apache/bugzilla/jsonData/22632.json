[{"count": 0, "tags": [], "bug_id": 22632, "text": "I know this was reported before (#1550 and #13353), but I got bit by this today \nand I'm not sure whether anyone plans on fixing this. #13353 has a status \nof \"RESOLVED WONTFIX\", but I can't imagine that this can be considered \nresolved. Basically, the fact that this bug exists I can no longer use \"<delete \ndir=...>\", because I cannot be sure that someone did not go into a directory \nand establish a symbolic link to another directory. The default behavior \nfor \"<delete dir=...>\" should be to not follow symbolic links.", "id": 43127, "time": "2003-08-21T19:29:52Z", "creator": "brian.compton@wmg.com", "creation_time": "2003-08-21T19:29:52Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 22632, "text": "<delete>\n  <fileset dir=\"...\" followsymlinks=\"false\"/>\n</delete>\n\nshould be as good.\n\nThe dir attribute (together with the includes and excludes related attributes) of\n<delete> have only been retained for backwards compatibility when the support\nfor nested filesets were added in Ant 1.2.  If we added all new features of\nfilesets (like symlink handling which was added way after 1.2) to <delete> that\nwould be cumbersome.\n\nSimply don't use dir, use a nested fileset and gain complete control.", "id": 43168, "time": "2003-08-22T14:23:01Z", "creator": "bodewig@apache.org", "creation_time": "2003-08-22T14:23:01Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 22632, "attachment_id": null, "id": 43173, "time": "2003-08-22T16:25:23Z", "creator": "brian.compton@wmg.com", "creation_time": "2003-08-22T16:25:23Z", "is_private": false, "text": "I have already tried your suggested solution, and many others, but have not \ncome up with any solution which does what I want. \nUsing 'followsymlinks=\"false\"' as an attribute of delete or as an attribute of \na nested fileset does prevent the files in the symbollically linked directory \nfrom being deleted, however the symbolic link itself is not deleted and hence \nthe directory does not get deleted.\n\nI was expecting and need functionality similar to \"rm -rf DIRNAME\" which does \nnot follow symbolic links, but does delete them. I have not been able to figure \nout any way to do this with the built-in tasks.\n\nI also wanted to mention that it does seem like followsymlinks='false' should \nbe the default for the delete task. I work with several other developers who \nhave been using ANT for a while, and not one knew about this. If the default \ncannot be changed, then a huge warning should be placed in the doc for the \ndelete task."}, {"count": 3, "tags": [], "creator": "antoine@apache.org", "attachment_id": null, "text": "this works for me :\n<project name=\"delete\">\n  <mkdir dir=\"alpha/beta\"/>\n  <symlink link=\"alpha/epsilon\" resource=\"beta\"/>\n  <touch file=\"alpha/epsilon/epsilon.xml\"/>\n  <touch file=\"alpha/alpha.xml\"/>\n  <delete>\n    <fileset dir=\"alpha\" followsymlinks=\"false\">\n      <include name=\"epsilon/**\"/>\n    </fileset>\n  </delete>\n</project>\n\nls -ltrR alpha\nalpha:\ntotal 4\nlrwxrwxrwx   1 antoine  antoine        4 Aug 22 10:06 epsilon -> beta\ndrwxrwxr-x   2 antoine  antoine      512 Aug 22 10:06 beta\n-rw-rw-r--   1 antoine  antoine        0 Aug 22 10:06 alpha.xml\n\nalpha/beta:\ntotal 0\n-rw-rw-r--   1 antoine  antoine        0 Aug 22 10:06 epsilon.xml\nI am closing this again as WORKSFORME. ", "id": 43178, "time": "2003-08-22T17:10:55Z", "bug_id": 22632, "creation_time": "2003-08-22T17:10:55Z", "is_private": false}, {"count": 4, "tags": [], "creator": "brian.compton@wmg.com", "attachment_id": null, "text": "Sorry to have to reopen this again, but your solution does not work if what you \nare trying to do is delete a directory. Yes, the directory pointed to by the \nsymbolic link was not touched which is great. But, the symbolic link was not \ndeleted either. So, if I had wanted to delete the \"alpha\" directory completely, \nI cannot. \n\nHere is a script I have been testing with along with the output:\n\n<project name=\"deltest\" default=\"delete\">\n  <target name=\"delete\">\n    <exec executable='ls' os='UNIX:Linux:SunOS'>\n      <arg value=\"-alR\"/>\n    </exec>\n    <mkdir dir=\"xx/yy\"/>\n    <touch file=\"xx/yy/f1\"/>\n    <touch file=\"xx/yy/f2\"/>\n    <mkdir dir=\"aa\"/>\n    <touch file=\"aa/f3\"/>\n    <touch file=\"aa/f4\"/>\n    <exec executable='ln' os='UNIX:Linux:SunOS'>\n      <arg value='-s'/>\n      <arg path='aa'/>\n      <arg path='xx/yy/zz'/>\n    </exec>\n    <exec executable='ls' os='UNIX:Linux:SunOS'>\n      <arg value=\"-alR\"/>\n    </exec>\n    <delete verbose=\"true\" includeEmptyDirs=\"true\">\n      <fileset dir=\"xx\" followsymlinks=\"false\">\n        <include name=\"yy/**\"/>\n      </fileset>\n    </delete>\n    <exec executable='ls' os='UNIX:Linux:SunOS'>\n      <arg value=\"-alR\"/>\n    </exec>\n  </target>\n</project>\n\n===================================================================\n\nBuildfile: build.xml\n\ndelete:\n     [exec] .:\n     [exec] total 6\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:33 .\n     [exec] drwxr-xr-x   6 dynamo6  dynamo6      512 Aug 22 11:25 ..\n     [exec] -rw-r--r--   1 dynamo6  dynamo6      811 Aug 22 11:34 build.xml\n    [mkdir] Created dir: /export/home/dynamo6/tmp/test2/xx/yy\n    [touch] Creating /export/home/dynamo6/tmp/test2/xx/yy/f1\n    [touch] Creating /export/home/dynamo6/tmp/test2/xx/yy/f2\n    [mkdir] Created dir: /export/home/dynamo6/tmp/test2/aa\n    [touch] Creating /export/home/dynamo6/tmp/test2/aa/f3\n    [touch] Creating /export/home/dynamo6/tmp/test2/aa/f4\n     [exec] .:\n     [exec] total 10\n     [exec] drwxr-xr-x   4 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   6 dynamo6  dynamo6      512 Aug 22 11:25 ..\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 aa\n     [exec] -rw-r--r--   1 dynamo6  dynamo6      811 Aug 22 11:34 build.xml\n     [exec] drwxr-xr-x   3 dynamo6  dynamo6      512 Aug 22 11:34 xx\n\n     [exec] ./aa:\n     [exec] total 4\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   4 dynamo6  dynamo6      512 Aug 22 11:34 ..\n     [exec] -rw-r--r--   1 dynamo6  dynamo6        0 Aug 22 11:34 f3\n     [exec] -rw-r--r--   1 dynamo6  dynamo6        0 Aug 22 11:34 f4\n\n     [exec] ./xx:\n     [exec] total 6\n     [exec] drwxr-xr-x   3 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   4 dynamo6  dynamo6      512 Aug 22 11:34 ..\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 yy\n\n     [exec] ./xx/yy:\n     [exec] total 6\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   3 dynamo6  dynamo6      512 Aug 22 11:34 ..\n     [exec] -rw-r--r--   1 dynamo6  dynamo6        0 Aug 22 11:34 f1\n     [exec] -rw-r--r--   1 dynamo6  dynamo6        0 Aug 22 11:34 f2\n     [exec] lrwxrwxrwx   1 dynamo6  dynamo6       33 Aug 22 11:34 zz -\n> /export/home/dynamo6/tmp/test2/aa\n   [delete] Deleting 2 files from /export/home/dynamo6/tmp/test2/xx\n   [delete] Deleting /export/home/dynamo6/tmp/test2/xx/yy/f1\n   [delete] Deleting /export/home/dynamo6/tmp/test2/xx/yy/f2\n     [exec] .:\n     [exec] total 10\n     [exec] drwxr-xr-x   4 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   6 dynamo6  dynamo6      512 Aug 22 11:25 ..\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 aa\n     [exec] -rw-r--r--   1 dynamo6  dynamo6      811 Aug 22 11:34 build.xml\n     [exec] drwxr-xr-x   3 dynamo6  dynamo6      512 Aug 22 11:34 xx\n\n     [exec] ./aa:\n     [exec] total 4\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   4 dynamo6  dynamo6      512 Aug 22 11:34 ..\n     [exec] -rw-r--r--   1 dynamo6  dynamo6        0 Aug 22 11:34 f3\n     [exec] -rw-r--r--   1 dynamo6  dynamo6        0 Aug 22 11:34 f4\n\n     [exec] ./xx:\n     [exec] total 6\n     [exec] drwxr-xr-x   3 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   4 dynamo6  dynamo6      512 Aug 22 11:34 ..\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 yy\n\n     [exec] ./xx/yy:\n     [exec] total 6\n     [exec] drwxr-xr-x   2 dynamo6  dynamo6      512 Aug 22 11:34 .\n     [exec] drwxr-xr-x   3 dynamo6  dynamo6      512 Aug 22 11:34 ..\n     [exec] lrwxrwxrwx   1 dynamo6  dynamo6       33 Aug 22 11:34 zz -\n> /export/home/dynamo6/tmp/test2/aa\n\nBUILD SUCCESSFUL\nTotal time: 3 seconds\n", "id": 43186, "time": "2003-08-22T18:39:38Z", "bug_id": 22632, "creation_time": "2003-08-22T18:39:38Z", "is_private": false}, {"count": 5, "tags": [], "text": "Just to make sure I get this right.  You want a setting that somehow deletes\nthe symlink itself without following it, right?\n\nThere doesn't seem to be a way to do that right now.  It's debatable whether\nit is a bug or a missing feature given the very limited support for symbolic\nlinks (or file operations in general) in the Java runtime.  Please let me\nmark this as an enhancement request, even if a valid and important one.", "attachment_id": null, "bug_id": 22632, "id": 43235, "time": "2003-08-25T13:35:34Z", "creator": "bodewig@apache.org", "creation_time": "2003-08-25T13:35:34Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "brian.compton@wmg.com", "text": "Yes, but I would go a step further. It seems to me that the safest option \nshould be the default, so in a unix/linux environment where symlinks are \nsupported, <delete dir=\"xxx\"> should act exactly like \"rm -rf xxx\" which would \nreliably remove the directory including any symlinks, but does not delete \nanything pointed to by the symlink. \n\nIf for some reason, someone DOES NOT want to delete symlinks if the exist or \nthey want to follow symlinks and delete files, they should have to choose that \noption. It should not be the default.\n\nThanks!", "count": 6, "id": 43237, "time": "2003-08-25T13:50:38Z", "bug_id": 22632, "creation_time": "2003-08-25T13:50:38Z", "is_private": false}, {"count": 7, "tags": [], "text": "Changing past behavior breaks back compatability. It is entirely possible that\nthere is some segment of the ant user comunity that is relying on the link\nfollowing behavior. There is a strong bias against breaking builds that used to\nwork. \n\nAs for deleting a symlink, yes that is possible IF the user has the ability to\nrename the *target* of the link. The trick is to rename the target (causing a\nbroken link) which will then be deleted. After the link is deleted, the target's\nname  is restored. This round about approach is a limitation of the \"Java knows\nnothing about symlinks\" problem. It is unclear why broken links can be deleted,\nbut that is how it seems to work. \n\nI have implemented a <symlink action=\"delete\"> wich will be available in 1.6\n(and is currently available in nightly builds), so I suspect it would be\nfeaseable to write a selector that selected symlinks (noone has done this yet,\nbut it shouldn't be too hard using the\norg.apache.tools.ant.util.FileUtils.isSymbolicLink(File parent, String name)\nmethod, and then feed the results of the selector that to symlink delete before\ndoing your delete of the directory. But if the user running the build doesn't\nhave enough access to the *target* of the link it will still fail because\n<symlink> uses the technique mentioned above. \n\nPerhaps with the advent of the Tiger 1.5 java release, which is supposed to have\nbetter support for dealing with native filesystems, this can be improved (for\nthose who run ant using Tiger... The same old reflect or fallback pattern that\nwe used for all the 1.1 compatability stuff will apply).", "attachment_id": null, "bug_id": 22632, "id": 43239, "time": "2003-08-25T15:08:17Z", "creator": "gus.heck@olin.edu", "creation_time": "2003-08-25T15:08:17Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "brianna@hambo.com", "text": "I just got bit - hard - by this issue.\n\nI'm running OS X 10.5.2.\nI have Ant 1.7.0.\n\n I had the following in my build.xml:\n\n<mkdir dir=\"${dist}/temp\"/>\n<symlink action=\"single\" link=\"${dist}/temp/Applications\" resource=\"/Applications\" />\n...\n<delete dir=\"${dist}/temp\" />\n\nIn other words, I created a temporary directory, stuck in a symbolic link to /Applications, did some stuff, and deleted the temporary directory.\n\nAnt proceeded to delete 7,800 some files out of /Applications. Fortunately, I run Time Machine and was able to recover completely within 20 minutes or so. But, it was pretty unnerving.\n\nConsidering that a recursive delete from the shell deletes the symbolic link rather than following it and deleting at the target, it never occurred to me that the ant delete task would behave this way.\n\nUnfortunately, as I just reported in another bug report, <symlink action=\"delete\" ...>\" doesn't work for me, so I can't clean up my temp directory.", "count": 8, "id": 114865, "time": "2008-03-22T10:45:24Z", "bug_id": 22632, "creation_time": "2008-03-22T10:45:24Z", "is_private": false}, {"count": 9, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "even though bug 36658 I mark them this way around since the later contains a (not yet evaluated) patch.\n\n*** This bug has been marked as a duplicate of bug 36658 ***", "id": 120354, "time": "2008-09-04T06:31:57Z", "bug_id": 22632, "creation_time": "2008-09-04T06:31:57Z", "is_private": false}]
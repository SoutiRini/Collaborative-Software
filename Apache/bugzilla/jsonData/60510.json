[{"count": 0, "tags": [], "bug_id": 60510, "attachment_id": null, "text": "Hi,\nafter Apache update from 2.4.23 to 2.4.25 we suddenly got apache segfaults.\n\nSteps to reproduce:\n1. start httpd\n2. GET some pages using HTTP2\n3. reload apache (kill -USR1)\n4. goto 2\n\nAfter one iteration I got:\n[Thu Dec 22 12:02:29.022628 2016] [core:notice] [pid 20447:tid 140060432906112] AH00052: child pid 21963 exit signal Segmentation fault (11)\n\nBacktrace:\nCore was generated by `/apache/bin/httpd'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x00000000005890c7 in h2_beam_bucket ()\n(gdb) bt\n#0  0x00000000005890c7 in h2_beam_bucket ()\n#1  0x000000000058b008 in h2_beam_receive ()\n#2  0x000000000057cbf0 in fill_buffer ()\n#3  0x000000000057d103 in h2_stream_out_prepare ()\n#4  0x000000000057576b in on_stream_resume ()\n#5  0x0000000000566c7b in h2_mplx_dispatch_master_events ()\n#6  0x0000000000578e43 in h2_session_process ()\n#7  0x000000000055af91 in h2_conn_run ()\n#8  0x000000000055f9cd in h2_h2_process_conn ()\n#9  0x00000000004764d9 in ap_run_process_connection ()\n#10 0x0000000000476b73 in ap_process_connection ()\n#11 0x00000000005c9808 in process_socket ()\n#12 0x00000000005ca632 in worker_thread ()\n#13 0x00007f07fb9338de in ?? ()\n#14 0x0000000000000000 in ?? ()\n\n\nAfter two iterations I got:\n[Thu Dec 22 12:03:10.191242 2016] [mpm_worker:notice] [pid 20447:tid 140060432906112] AH00297: SIGUSR1 received.  Doing graceful restart\n[Thu Dec 22 12:03:10.192828 2016] [core:notice] [pid 20447] AH00060: seg fault or similar nasty error detected in the parent process\n\nBacktrace:\nCore was generated by `/apache/bin/httpd'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x0000000000589079 in h2_register_bucket_beamer ()\n(gdb) bt\n#0  0x0000000000589079 in h2_register_bucket_beamer ()\n#1  0x000000000055ea67 in h2_h2_register_hooks ()\n#2  0x000000000055896a in h2_hooks ()\n#3  0x0000000000468b08 in ap_register_hooks ()\n#4  0x00000000004373ac in main ()\n\nOther SW: debian oldstable, nghttp2-1.17.0\n\nDoes anybody has same problem?", "id": 195608, "time": "2016-12-22T12:13:53Z", "creator": "pavel@verotel.cz", "creation_time": "2016-12-22T12:13:53Z", "is_private": false}, {"count": 1, "attachment_id": 34549, "bug_id": 60510, "is_private": false, "id": 195612, "time": "2016-12-22T14:20:24Z", "creator": "pavel@verotel.cz", "creation_time": "2016-12-22T14:20:24Z", "tags": [], "text": "Created attachment 34549\npatch to fix segfault in mod_http2\n\nI think the problem is caused by static variable \"beamers\".\nI tried to add cleanup function which seems to fix the problem for me.\n\nCan anybody confirm I'm on the right track please?\n\nPavel"}, {"count": 2, "tags": [], "bug_id": 60510, "attachment_id": null, "text": "Pavel,\n\nthat looks like a good fix. If that solves the problem in your setup, I'll adopt that change into trunk+2.4.x.", "id": 195632, "time": "2016-12-23T09:39:17Z", "creator": "stefan@eissing.org", "creation_time": "2016-12-23T09:39:17Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60510, "is_private": false, "text": "Fixed by r1775833 in trunk. Currently backporting to 2.4.x.", "id": 195634, "time": "2016-12-23T12:44:28Z", "creator": "stefan@eissing.org", "creation_time": "2016-12-23T12:44:28Z", "attachment_id": null}]
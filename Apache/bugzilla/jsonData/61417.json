[{"count": 0, "tags": [], "bug_id": 61417, "text": "_____________________________________________\n\nchecking for APR... yes\n  setting CPP to \"gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -E\"\n_____________________________________________\n\nwhile wondring why my rpmbuild \u00bdoptflags extended with \"-march=native -mtune=native\" for optimized builds in some outputs just ignore the flags it looks like apr-util at buildtime sets them above to the same as used for building apr\n\nthis is plain wrong and dangerous when all your spec files like below are supposed to build native tuned binaries as well as -mtune=sandybridge because when you have on the buildmachine -mtune=native apr installed your apr-util also get built with -mtune=native which is NOT the intention when build without \"--with production\"\n\nplease stop mangle around with build flags unasked\n_____________________________________________\n\n# command 'rpmbuild -bb apr-util.spec --with production' will tune for current hardware while default stays 'sandybridge'\n\n%if %{?_with_production:1}%{!?_with_production:0}\n %global rpmsuffix native\n %global build_native_release 1\n %global optflags %{optflags} -march=native -mtune=native\n%else\n %global rpmsuffix sandybridge\n %global build_native_release 0\n%endif", "id": 200308, "attachment_id": null, "creator": "h.reindl@thelounge.net", "creation_time": "2017-08-15T11:46:06Z", "time": "2017-08-15T11:46:06Z", "is_private": false}, {"count": 1, "tags": [], "creator": "h.reindl@thelounge.net", "text": "voila - the apr package on the buildmachine is built with -mtune=native, the apr-util build was started WITHOUT that flag and that happens - this apr-util package would NOT run on the target machine\n\nchecking for APR... yes\n  setting CPP to \"gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -march=native -mtune=native -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -E\"\n  setting CPPFLAGS to \" -DLINUX -D_REENTRANT -D_GNU_SOURCE\"", "id": 200309, "time": "2017-08-15T11:51:10Z", "bug_id": 61417, "creation_time": "2017-08-15T11:51:10Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 61417, "attachment_id": null, "text": "I don't understand what you're trying to do and what doesn't work.  Are you saying apr-util build is ignoring a --with-apr and using an installed version?", "id": 200316, "time": "2017-08-15T20:13:39Z", "creator": "nick@webthing.com", "creation_time": "2017-08-15T20:13:39Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 61417, "attachment_id": null, "text": "it should use the installed version but NOT read out the buildflags from that binary - NOBODY did specify \"-march=native -mtune=native\" for this build, but \"apr\" itself was built with that flags and httpd has the same behavior (https://bz.apache.org/bugzilla/show_bug.cgi?id=61418)\n\n\n\n[builduser@testserver:/rpmbuild/SPECS]$ rpmbuild -bb apr-util.spec \nAusf\u00fchrung(%prep): /bin/sh -e /var/tmp/rpm-tmp.sSbgQz\n+ umask 022\n+ cd /home/builduser/rpmbuild/BUILD\n+ cd /home/builduser/rpmbuild/BUILD\n+ rm -rf apr-util-1.6.0\n+ /usr/bin/bzip2 -dc /home/builduser/rpmbuild/SOURCES/apr-util-1.6.0.tar.bz2\n+ /usr/bin/tar -xof -\n+ STATUS=0\n+ '[' 0 -ne 0 ']'\n+ cd apr-util-1.6.0\n+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .\n+ echo 'Patch #1 (apr-util-1.2.7-pkgconf.patch):'\nPatch #1 (apr-util-1.2.7-pkgconf.patch):\n+ /usr/bin/patch --no-backup-if-mismatch -p1 -b --suffix .pkgconf --fuzz=0\npatching file Makefile.in\nHunk #1 succeeded at 73 (offset 22 lines).\npatching file apu-config.in\n+ echo 'Patch #2 (apr-util-1.4.1-private.patch):'\nPatch #2 (apr-util-1.4.1-private.patch):\n+ /usr/bin/patch --no-backup-if-mismatch -p1 -b --suffix .private --fuzz=0\npatching file apr-util.pc.in\n+ exit 0\nAusf\u00fchrung(%build): /bin/sh -e /var/tmp/rpm-tmp.UQzHa7\n+ umask 022\n+ cd /home/builduser/rpmbuild/BUILD\n+ cd apr-util-1.6.0\n+ autoheader\n+ autoconf\n+ export 'CFLAGS=-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'\n+ CFLAGS='-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'\n+ export 'CXXFLAGS=-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'                                                                                 \n+ CXXFLAGS='-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'                                                                                        \n+ export 'CC=gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'                                                                                   \n+ CC='gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'                                                                                          \n+ export 'SH_LDFLAGS=-Wl,--as-needed -Wl,-z,now -Wl,-z,relro -Wl,-z,noexecstack -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'\n+ SH_LDFLAGS='-Wl,--as-needed -Wl,-z,now -Wl,-z,relro -Wl,-z,noexecstack -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'\n+ export 'LDFLAGS=-Wl,--as-needed -Wl,-z,now -Wl,-z,relro -Wl,-z,noexecstack -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -pie -fPIE'\n+ LDFLAGS='-Wl,--as-needed -Wl,-z,now -Wl,-z,relro -Wl,-z,noexecstack -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -pie -fPIE'\n+ CFLAGS='-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'\n+ export CFLAGS\n+ CXXFLAGS='-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin'\n+ export CXXFLAGS\n+ FFLAGS='-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -I/usr/lib64/gfortran/modules'\n+ export FFLAGS\n+ FCFLAGS='-m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -I/usr/lib64/gfortran/modules'\n+ export FCFLAGS\n+ LDFLAGS='-Wl,--as-needed -Wl,-z,now -Wl,-z,relro -Wl,-z,noexecstack -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -pie -fPIE'\n+ export LDFLAGS\n+ ./configure --host=x86_64-redhat-linux --build=x86_64-redhat-linux --target=x86_64-redhat-linux --program-prefix= --disable-dependency-tracking --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --includedir=/usr/include --libdir=/usr/lib64 --libexecdir=/usr/libexec --localstatedir=/var --sharedstatedir=/var/lib --mandir=/usr/share/man --infodir=/usr/share/info --with-apr=/usr --includedir=/usr/include/apr-1 --enable-nonportable-atomics --without-ldap --disable-ldap --without-gdbm --without-sqlite3 --without-pgsql --with-mysql --without-odbc --without-freetds --without-berkeley-db --without-sqlite2 --with-crypto --with-openssl --with-nss\nconfigure: WARNING: unrecognized options: --disable-dependency-tracking, --enable-nonportable-atomics, --disable-ldap, --without-freetds\nchecking build system type... x86_64-redhat-linux-gnu\nchecking host system type... x86_64-redhat-linux-gnu\nchecking target system type... x86_64-redhat-linux-gnu\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking for working mkdir -p... yes\nAPR-util Version: 1.6.0\nchecking for chosen layout... apr-util\nchecking for x86_64-redhat-linux-gcc... gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables... \nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin accepts -g... yes\nchecking for gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin option to accept ISO C89... none needed\nApplying apr-util hints file rules for x86_64-redhat-linux-gnu\nchecking for APR... yes\n  setting CPP to \"gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -march=native -mtune=native -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -E\"\n  setting CPPFLAGS to \" -DLINUX -D_REENTRANT -D_GNU_SOURCE\"\nchecking how to run the C preprocessor... gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -march=native -mtune=native -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -E\nchecking for grep that handles long lines and -e... /usr/bin/grep\nchecking for egrep... /usr/bin/grep -E\nchecking for ANSI C header files... yes\nchecking for sys/types.h... yes\nchecking for sys/stat.h... yes\nchecking for stdlib.h... yes\nchecking for string.h... yes\nchecking for memory.h... yes\nchecking for strings.h... yes\nchecking for inttypes.h... yes\nchecking for stdint.h... yes\nchecking for unistd.h... yes\nchecking openssl/x509.h usability... yes\nchecking openssl/x509.h presence... yes\nchecking for openssl/x509.h... yes\nchecking for EVP_CIPHER_CTX_new in -lcrypto... yes\nchecking for SSL_accept in -lssl... yes\n  setting LDADD_crypto_openssl to \" -lssl -lcrypto\"\nchecking for const input buffers in OpenSSL... yes\nchecking for x86_64-redhat-linux-pkg-config... no\nchecking for pkg-config... /usr/bin/pkg-config\n  adding \"-I/usr/include/nss3\" to CPPFLAGS\n  adding \"-I/usr/include/nspr4\" to CPPFLAGS\n  adding \"-lssl3\" to LDFLAGS\n  adding \"-lsmime3\" to LDFLAGS\n  adding \"-lnss3\" to LDFLAGS\n  adding \"-lnssutil3\" to LDFLAGS\n  adding \"-lplds4\" to LDFLAGS\n  adding \"-lplc4\" to LDFLAGS\n  adding \"-lnspr4\" to LDFLAGS\n  adding \"-lpthread\" to LDFLAGS\n  adding \"-ldl\" to LDFLAGS\nchecking prerror.h usability... yes\nchecking prerror.h presence... yes\nchecking for prerror.h... yes\nchecking nss/nss.h usability... no\nchecking nss/nss.h presence... no\nchecking for nss/nss.h... no\nchecking nss.h usability... yes\nchecking nss.h presence... yes\nchecking for nss.h... yes\nchecking nss/pk11pub.h usability... no\nchecking nss/pk11pub.h presence... no\nchecking for nss/pk11pub.h... no\nchecking pk11pub.h usability... yes\nchecking pk11pub.h presence... yes\nchecking for pk11pub.h... yes\nchecking for PR_Initialize in -lnspr4... yes\nchecking for PK11_CreatePBEV2AlgorithmID in -lnss3... yes\n  adding \"-I/usr/include/nss3\" to APRUTIL_PRIV_INCLUDES\n  adding \"-I/usr/include/nspr4\" to APRUTIL_PRIV_INCLUDES\n  setting LDADD_crypto_nss to \"-lssl3 -lsmime3 -lnss3 -lnssutil3 -lplds4 -lplc4 -lnspr4 -lpthread -ldl -lnspr4 -lnss3\"\nchecking for ldap support...\nchecking for default DBM... sdbm (default)\nchecking for mysql_config... /usr/bin/mysql_config\n  adding \"-I/usr/include/mysql\" to CPPFLAGS\n  setting LIBS to \"-L/usr/lib64/mysql  -lmariadb -lz -lpthread -ldl -lm -lssl -lcrypto\"\nchecking for mysql.h... yes\nchecking for mysql_init in -lmysqlclient... yes\nchecking for my_global.h... yes\nchecking for mysql_init in -lmysqlclient... (cached) yes\nchecking for my_sys.h... yes\nchecking for mysql_init in -lmysqlclient... (cached) yes\n  adding \"-I/usr/include/mysql\" to APRUTIL_PRIV_INCLUDES\n  setting LDADD_dbd_mysql to \"-L/usr/lib64/mysql         -lmysqlclient -L/usr/lib64/mysql  -lmariadb -lz -lpthread -ldl -lm -lssl -lcrypto\"\nchecking Expat 1.95.x... yes\n  setting APRUTIL_EXPORT_LIBS to \"-lexpat\"\n  setting APRUTIL_LIBS to \"-lexpat\"\nchecking iconv.h usability... yes\nchecking iconv.h presence... yes\nchecking for iconv.h... yes\nchecking for type of inbuf parameter to iconv... char **\nchecking for iconv.h... (cached) yes\nchecking langinfo.h usability... yes\nchecking langinfo.h presence... yes\nchecking for langinfo.h... yes\nchecking for nl_langinfo... yes\nchecking for CODESET in langinfo.h... yes\nchecking whether APR has DSO support... yes\nchecking for library containing crypt... -lcrypt\nchecking if system crypt() function is threadsafe... no\nchecking for crypt_r... yes\nchecking style of crypt_r... struct_crypt_data\nchecking whether the compiler handles weak symbols... yes\nchecking for memset_s support... no\nchecking for explicit_bzero support... no\n  adding \"/usr/lib64/libapr-1.la\" to APRUTIL_LIBS\n  adding \"-lpthread\" to APRUTIL_LIBS\n  adding \"-ldl\" to APRUTIL_LIBS\nconfigure: creating ./config.status\nconfig.status: creating Makefile\nconfig.status: creating export_vars.sh\nconfig.status: creating build/pkg/pkginfo\nconfig.status: creating apr-util.pc\nconfig.status: creating apu-1-config\nconfig.status: creating include/private/apu_select_dbm.h\nconfig.status: creating include/apr_ldap.h\nconfig.status: creating include/apu.h\nconfig.status: creating include/apu_want.h\nconfig.status: creating test/Makefile\nconfig.status: creating include/private/apu_config.h\nconfig.status: executing default commands\nconfigure: WARNING: unrecognized options: --disable-dependency-tracking, --enable-nonportable-atomics, --disable-ldap, --without-freetds\n+ make -j8\nmake[1]: Entering directory '/home/builduser/rpmbuild/BUILD/apr-util-1.6.0'\ngawk -f /usr/lib64/apr-1/build/make_exports.awk /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_anylock.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_base64.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_buckets.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_crypto.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_date.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_dbd.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_dbm.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_hooks.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_init.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_option.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_rebind.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_url.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_md4.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_md5.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_memcache.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_optional.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_optional_hooks.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_queue.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_redis.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_reslist.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_rmm.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_sdbm.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_sha1.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_siphash.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_strmatch.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_thread_pool.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_uri.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_uuid.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_xlate.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_xml.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apu_errno.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apu_version.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_crypto_internal.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_dbd_internal.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_dbd_odbc_v2.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_dbm_private.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apu_internal.h > exports.c\ngawk -f /usr/lib64/apr-1/build/make_var_export.awk /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_anylock.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_base64.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_buckets.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_crypto.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_date.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_dbd.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_dbm.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_hooks.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_init.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_option.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_rebind.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_ldap_url.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_md4.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_md5.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_memcache.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_optional.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_optional_hooks.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_queue.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_redis.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_reslist.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_rmm.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_sdbm.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_sha1.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_siphash.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_strmatch.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_thread_pool.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_uri.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_uuid.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_xlate.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apr_xml.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apu_errno.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/apu_version.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_crypto_internal.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_dbd_internal.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_dbd_odbc_v2.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apr_dbm_private.h /home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private/apu_internal.h > export_vars.c\nsed 's,^\\(location=\\).*$,\\1installed,;s,^\\(APR_.*_DIR\\)=.*,\\1=\"${libdir}/build\",' < apu-1-config > apu-config.out\n/bin/sh /usr/lib64/apr-1/build/libtool --silent --mode=compile gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -march=native -mtune=native -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin   -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -march=native -mtune=native -O3 -fno-strict-aliasing -fno-gcse-after-reload -fno-inline-functions -fno-ipa-cp -fno-ipa-cp-clone -fno-peel-loops -fno-predictive-commoning -fno-tree-loop-distribute-patterns -fno-unswitch-loops -fPIC -flto -ffat-lto-objects -fuse-ld=gold -fuse-linker-plugin -DHAVE_CONFIG_H  -DLINUX -D_REENTRANT -D_GNU_SOURCE   -I/home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include -I/home/builduser/rpmbuild/BUILD/apr-util-1.6.0/include/private -I/usr/include/nss3 -I/usr/include/nspr4 -I/usr/include/mysql  -I/usr/include/apr-1    -o crypto/apr_crypto_openssl.lo -c crypto/apr_crypto_openssl.c && touch crypto/apr_crypto_openssl.lo", "id": 200317, "time": "2017-08-15T20:19:49Z", "creator": "h.reindl@thelounge.net", "creation_time": "2017-08-15T20:19:49Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 61417, "attachment_id": null, "text": "to make it clear: in the previous comment you see cleary the CFLAGS only with \"-march=sandybridge -mtune=sandybridge\" but because \"apr\" was built with \"-march=native -mtune=native\" now you build unasked apr-util/httpd also with \"native\"\n\nthat behavior makes it hard to impossible maintain apr/apr-util/httpd with build for the production cluster as well as older machines (move the resulting rpm-packages to the correct repo is easy by the arch-suffix in the release-tag) because if you have installed the native \"apr\" package \"apr-util\" and \"httpd\" inherit the buildflages from the installed apr/apr-devel at build time\n\n/bin/sh /usr/lib64/apr-1/build/libtool --silent --mode=compile gcc -m64 -O2 -g0 -mfpmath=sse -mavx -msse2avx -march=sandybridge -mtune=sandybridge -fopenmp -pipe -fno-strict-aliasing -fomit-frame-pointer -fexceptions -fstack-protector-strong --param=ssp-buffer-size=6 -D_FORTIFY_SOURCE=2 -Wstack-protector -Wformat -Werror=format-security -march=native -mtune=native", "id": 200318, "time": "2017-08-15T20:31:27Z", "creator": "h.reindl@thelounge.net", "creation_time": "2017-08-15T20:31:27Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 61417, "attachment_id": null, "text": "(In reply to Reindl Harald from comment #4)\n\n> that behavior makes it hard to impossible maintain apr/apr-util/httpd with\n> build for the production cluster as well as older machines (move the\n> resulting rpm-packages to the correct repo is easy by the arch-suffix in the\n> release-tag) because if you have installed the native \"apr\" package\n> \"apr-util\" and \"httpd\" inherit the buildflages from the installed\n> apr/apr-devel at build time\n\nearlier: \n\n> --with-apr=/usr\n\nWhy would you use the installed APR to build apr-util but not expect them to be compiled the same? More cross-compile like patches are welcome, but you'll have to keep these bug reports civil and concise if you want people to keep reading them.", "id": 201765, "time": "2017-10-29T14:45:59Z", "creator": "covener@gmail.com", "creation_time": "2017-10-29T14:45:59Z", "is_private": false}, {"count": 6, "tags": [], "creator": "h.reindl@thelounge.net", "text": "because with the current chain apr-util inherit from apr und httpd interhit from apr/apr-util i can not build a simple -mtune=sandybridge binary without first replace the bianry -mtune=native apr package\n\nthe same for https://bz.apache.org/bugzilla/show_bug.cgi?id=61418\nthis has nothing to do with cross-compilation at all\n\nuntil there is a update for apr itself by just link against the binary you can build apr-util for -mtnue=native and -mtune=sandybridge and place the resulting rpm packages in different repos\n\nin the current shape you need to build first apr with the desired -mtune, install the devel-package, build apr-util the same way, install it and then you can build httpd - terrible - for s simle httpd update which you want to build for prudoction severs as well as older developmetn machines you can't just fire up rpmbuild twice because you need take care about apr/apr-util all the time\n\n__________________________________\n\n\n\"Working as designed. If you want more control, build httpd w/ an included apr as the manual already describes\" - than that is broken by design \n\n<sarcasm>why do we have CCFLAGS/LDFLAGS at all when we can in herit from glibc or the lowest package in the chain we find</sarcasm>", "id": 201766, "time": "2017-10-29T14:55:47Z", "bug_id": 61417, "creation_time": "2017-10-29T14:55:47Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "text": "because with the current chain apr-util inherit from apr und httpd interhit from apr/apr-util i can not build a simple -mtune=sandybridge binary without first replace the bianry -mtune=native apr package\n\nthe same for https://bz.apache.org/bugzilla/show_bug.cgi?id=61418\nthis has nothing to do with cross-compilation at all\n\nuntil there is a update for apr itself by just link against the binary you can build apr-util for -mtnue=native and -mtune=sandybridge and place the resulting rpm packages in different repos\n\nin the current shape you need to build first apr with the desired -mtune, install the devel-package, build apr-util the same way, install it and then you can build httpd - terrible - for s simle httpd update which you want to build for prudoction severs as well as older developmetn machines you can't just fire up rpmbuild twice because you need take care about apr/apr-util all the time\n\n__________________________________\n\n\n\"Working as designed. If you want more control, build httpd w/ an included apr as the manual already describes\" - than that is broken by design \n\n<sarcasm>why do we have CCFLAGS/LDFLAGS at all when we can in herit from glibc or the lowest package in the chain we find</sarcasm>", "attachment_id": null, "bug_id": 61417, "id": 201767, "time": "2017-10-29T14:56:30Z", "creator": "h.reindl@thelounge.net", "creation_time": "2017-10-29T14:56:30Z", "is_private": false}, {"count": 8, "tags": [], "creator": "h.reindl@thelounge.net", "attachment_id": null, "id": 201768, "time": "2017-10-29T15:13:32Z", "bug_id": 61417, "creation_time": "2017-10-29T15:13:32Z", "is_private": false, "text": "maybe the script below makes it more understandable, it build all that packages with -mtune=native and these are always installed on the buildmachine\n\ni want to build httpd for older machines without replace apr/apr-util every time and i have seen no other case where GCC flags are inhertied from whatever library especially when CFLAGS and LDFLAGS are explicit set\n\n[builduser@testserver:/rpmbuild/SPECS]$ cat build-native.sh\n#!/usr/bin/bash\n\nakt_user=`whoami`\nif test $akt_user == \"root\"\nthen\n echo \"NOT AS ROOT\"\n exit 1\nfi\n\ncd /rpmbuild/SPECS/\n\nbasearch=`uname -i`\nreleasever=`rpm -q --qf \"%{version}\\n\" generic-release`\n\nfunction rh_update_built_packages\n{\n sudo yum-deprecated --nogpgcheck -y update /rpmbuild/RPMS/$basearch/*.rpm\n sudo yum-deprecated --nogpgcheck -y update /rpmbuild/RPMS/noarch/*.rpm\n}\n\n> /rpmbuild/build-native.log\n\nrpmbuild -bb apr.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrh_update_built_packages\nrpmbuild -bb apr-util.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrh_update_built_packages\nrpmbuild -bb httpd.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrh_update_built_packages\nrpmbuild -bb mariadb.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrpmbuild -bb mod_security.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrpmbuild -bb php.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrpmbuild -bb php-pecl*.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrpmbuild -bb trafficserver.spec --with production 2>&1 | tee -a /rpmbuild/build-native.log\nrh_update_built_packages"}]
[{"count": 0, "tags": [], "bug_id": 37822, "is_private": false, "id": 83381, "attachment_id": null, "creator": "kyrill@technolog.ca", "creation_time": "2005-12-07T20:30:50Z", "time": "2005-12-07T20:30:50Z", "text": "This issue has been stumbled upon when I was trying to get Tomcat to cleanly\nundeploy or hot-restart my web application. What I mean by this is that the\nWebappClassLoader that loaded the app has to be cleanly garbage collected after\nhot-redeploy or undeploy. \n\nI am running Tomcat 5.5.12 on the latest J2SE 1.6 Mustang build 62. The problem\nis present on 1.5 as well, it is just Mustang has far better support for JVMTI,\nso my YourKit profiler is capable of presenting a clear picture of what is going\non (see below).\n\nDESCRIPTION:\n\nMy application contains commons-logging.jar (v. 1.0.4) in its WEB-INF/lib\ndirectory. \n\nThe attached pdf file (generated by YourKit profiler, which Tomcat developers\nare eligible to use as stated on YourKit's website, by the way) shows a GC root\nof a WebappClassLoader of an undeployed (!) application. This is a residual\nmemory leak. The file also clearly shows that the reason that this classloader\nis still around is because it is a classloader of\norg.apache.commons.logging.imp.Log4Jlogger class (which is fine) and that this\nclass instantiated a variable \"log\" in\norg.apache.catalina.cor.ApplicationFilterConfig core catalina class (which is\ndisturbing). \n\nThe above \"ensures\" that the WebappClassLoader will not be garbage collected.\n\nNOTE: The problem can be easily worked around by moving commons-logging.jar and\nits corresponding log4j.jar into shared/lib directory from the application's\nWEB-INF/lib. If this is done, then the WebappClassLoader is collected on\nhot-restarts and undeploys just fine.\n\nI believe what I've described indicates a serious bug in classloading delegation\ninside Tomcat. The bug that prevents any kind of clean hot-deploy or undeploy of\nall web applications containing commons-logging.jar in their local WEB-INF/lib\nclasspath.\n\nPlease address this issue as just about any modern application will require\ncommons-logging.jar, simply because it is a required dependency of almost all\nopen source frameworks."}, {"count": 1, "attachment_id": 17169, "bug_id": 37822, "is_private": false, "id": 83382, "time": "2005-12-07T20:31:49Z", "creator": "kyrill@technolog.ca", "creation_time": "2005-12-07T20:31:49Z", "tags": [], "text": "Created attachment 17169\nYourKit profiler's description of the problem"}, {"count": 2, "tags": [], "creator": "kyrill@technolog.ca", "attachment_id": null, "id": 83485, "time": "2005-12-09T18:25:29Z", "bug_id": 37822, "creation_time": "2005-12-09T18:25:29Z", "is_private": false, "text": "Why was the bug closed as fixed? Would you be so kind to explain?\n\nThanks.\n\nKyrill"}, {"count": 3, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Remy fixed it:\n\nhttp://svn.apache.org/viewcvs?rev=355530&view=rev\n\nresp.\n\nhttp://marc.theaimsgroup.com/?l=tomcat-dev&m=113414657832526&w=2", "id": 83486, "time": "2005-12-09T18:46:27Z", "bug_id": 37822, "creation_time": "2005-12-09T18:46:27Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "kyrill@technolog.ca", "attachment_id": null, "id": 83487, "time": "2005-12-09T18:53:37Z", "bug_id": 37822, "creation_time": "2005-12-09T18:53:37Z", "is_private": false, "text": "Thanks Remy, and I appreciate your sense of humor."}, {"count": 5, "tags": [], "creator": "kyrill@technolog.ca", "text": "Created attachment 17503\nYourKit Profiler graph that confirms the bug", "id": 85005, "time": "2006-01-25T21:11:49Z", "bug_id": 37822, "creation_time": "2006-01-25T21:11:49Z", "is_private": false, "attachment_id": 17503}, {"count": 6, "attachment_id": null, "bug_id": 37822, "is_private": false, "id": 85006, "time": "2006-01-25T21:12:00Z", "creator": "kyrill@technolog.ca", "creation_time": "2006-01-25T21:12:00Z", "tags": [], "text": "First, thanks for releasing 5.5.15. \n\nIt appears that a similair problem is still in the source.\n\norg.apache.tomcat.util.digester.Digester maintains references to commons-logging\nlog that gets loaded by WebappClassloader. See attached.\n\nRemoving the log variable should be a fairly simple thing to do as it is barely\nused. \n\nThanks beforehand,\n\nKyrill Alyoshin\n\n"}, {"count": 7, "tags": [], "creator": "taras.tielkes@gmail.com", "text": "Here's another one: http://issues.apache.org/bugzilla/show_bug.cgi?id=39975\n(through jasper.runtime.PageContextImpl)", "id": 92583, "time": "2006-08-27T13:03:28Z", "bug_id": 37822, "creation_time": "2006-08-27T13:03:28Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 37822, "is_private": false, "id": 116865, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2008-05-20T16:29:08Z", "time": "2008-05-20T16:29:08Z", "text": "As far as I can tell, all of these issues are fixed in the current source.\n\nIf you find a new source of a memory leak, please open a new bug rather than adding to this one."}]
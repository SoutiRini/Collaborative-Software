[{"count": 0, "tags": [], "creator": "kannarkk@yahoo.com", "is_private": false, "text": "Custom ErrorDocument 400 is not working when the Host header is missing in the request. Default ErrorDocument 400 is sent as a response when Host header is missing, even though custom ErrorDocument 400 is defined.", "id": 132688, "time": "2009-12-09T03:15:26Z", "bug_id": 48357, "creation_time": "2009-12-09T03:15:26Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "text": "What's the context of your ErrorDocument directive that's being ignored?\n(e.g. top-level, <virtualhost>,  ???)", "id": 132990, "time": "2009-12-20T17:15:43Z", "bug_id": 48357, "creation_time": "2009-12-20T17:15:43Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "andyharris7010@yahoo.co.uk", "is_private": false, "text": "Using telnet hostname 80, if you type:\n\nGET HTTP/1.0 HTTP/1.0\n\nyou get the custom ErrorDocument 400 as defined in apache2.conf.\n\nIf you type:\n\nGET HTTP/1.1 HTTP/1.1\nHost: hostname\n\nyou get the custom ErrorDocument 400 as defined in apache2.conf\n\nIf you type:\n\nGET HTTP/1.1 HTTP/1.1\n\nwithout the Host Header you get the Apache default 400 error text and not\nthe custom ErrorDocument.\n\nI believe that this is the bug that has been reported. In all cases you should be getting the custom ErrorDocument 400 if one has been defined. Me thinks.", "id": 137657, "time": "2010-06-15T08:34:47Z", "bug_id": 48357, "creation_time": "2010-06-15T08:34:47Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "nick@webthing.com", "text": "Works for me with ErrorDocument at top level.\n\nI suspect you have your ErrorDocument in a wrong context.  If you want to reopen, please reply to Comment 1.", "id": 145287, "time": "2011-03-26T11:07:38Z", "bug_id": 48357, "creation_time": "2011-03-26T11:07:38Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 48357, "is_private": false, "count": 4, "id": 159294, "time": "2012-05-24T15:35:19Z", "creator": "petr.sumbera@oracle.com", "creation_time": "2012-05-24T15:35:19Z", "text": "This is still issue. Though not sure what to do about it.\n\nWhen host is not specified:\n===========================\n\nThen ap_process_http_connection() calls ap_read_request() \n\nwhere it logs following error:\n\n\"client sent HTTP/1.1 request without hostname (see RFC2616 section 14.23): %s\"\n\nand sets r->status to HTTP_BAD_REQUEST\n\nso that later ap_send_error_response() is called which won't do any redirection\n(instead it will send default error text).\n\nWhen host is specified:\n=======================\n\nThen ap_process_http_connection() calls ap_process_request() because so far status was OK. But then status is evaluated not be ok and ap_die() is called.\nWhere ap_die() will do custom redirection."}, {"count": 5, "attachment_id": 29147, "bug_id": 48357, "text": "Created attachment 29147\npossible patch\n\nPatch attached.\n\nExample:\n\nApache configuration:\n=====================\n\nAdd following into global section of Apache configuration file:\n\nErrorDocument 400 /400.html\n\nCreate 400.html file:\n\necho \"<html><body><h1>My error 400.....</h1></body></html>\" > /var/apache2/2.2/htdocs/400.html\n\nBehavior without patch:\n=======================\n\nroot@S11:~# telnet localhost 80\nTrying ::1...\nConnected to S11.1_15.\nEscape character is '^]'.\nGET . HTTP/1.1\n\nHTTP/1.1 400 Bad Request\nDate: Wed, 01 Aug 2012 11:21:38 GMT\nServer: Apache/2.2.22 (Unix) mod_ssl/2.2.22 OpenSSL/1.0.0j DAV/2 PHP/5.2.17\nContent-Length: 226\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>400 Bad Request</title>\n</head><body>\n<h1>Bad Request</h1>\n<p>Your browser sent a request that this server could not understand.<br />\n</p>\n</body></html>\n\nBehavior with applied patch:\n============================\n\nroot@S11:~# telnet localhost 80\nTrying ::1...\nConnected to S11.1_15.\nEscape character is '^]'.\nGET . HTTP/1.1\n\nHTTP/1.1 400 Bad Request\nDate: Wed, 01 Aug 2012 11:24:34 GMT\nServer: Apache/2.2.22 (Unix) mod_ssl/2.2.22 OpenSSL/1.0.0j DAV/2 PHP/5.2.17\nLast-Modified: Wed, 01 Aug 2012 11:20:45 GMT\nETag: \"52f1-35-4c6327c6f4b5b\"\nAccept-Ranges: bytes\nContent-Length: 53\nConnection: close\nContent-Type: text/html\n\n<html><body><h1>My error 400.....</h1></body></html>", "id": 161042, "time": "2012-08-01T11:42:34Z", "creator": "petr.sumbera@oracle.com", "creation_time": "2012-08-01T11:42:34Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 48357, "is_private": false, "count": 6, "id": 162425, "time": "2012-09-26T17:19:17Z", "creator": "trawick@apache.org", "creation_time": "2012-09-26T17:19:17Z", "text": "Why is this a practical problem?  (Which clients are sending HTTP/1.1 requests without a host header, how will a custom error document help?)\n\nI'm attaching an alternate fix which uses ap_die() instead of ap_send_error_response."}, {"count": 7, "tags": [], "creator": "trawick@apache.org", "is_private": false, "text": "Created attachment 29423\nhttpd trunk patch for bug 48357\n\nChange ap_read_request() to use ap_die() for this error.", "id": 162426, "time": "2012-09-26T17:20:24Z", "bug_id": 48357, "creation_time": "2012-09-26T17:20:24Z", "attachment_id": 29423}, {"count": 8, "attachment_id": null, "bug_id": 48357, "text": "I can confirm that patch from comment #7 works as expected.\n\nI'm not aware about any clients which sends HTTP/1.1 requests without a host header. But one of of our customers is demanding on fixing this problem. \n\nMaybe it's question of consistency. Or maybe it's related to localization (e.g. to avoid English errors).", "id": 162491, "time": "2012-10-01T13:29:48Z", "creator": "petr.sumbera@oracle.com", "creation_time": "2012-10-01T13:29:48Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "text": "Committed to trunk as r1392347.  I'll propose for backport to 2.4.x; the cases where this change helps are surely few in number, but maybe the review process will lead to somebody finding a problem.", "is_private": false, "id": 162492, "creation_time": "2012-10-01T14:24:04Z", "time": "2012-10-01T14:24:04Z", "creator": "trawick@apache.org", "bug_id": 48357, "attachment_id": null}]
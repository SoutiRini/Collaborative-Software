[{"attachment_id": null, "tags": [], "bug_id": 41397, "is_private": false, "count": 0, "id": 98210, "time": "2007-01-17T23:11:24Z", "creator": "varming@acm.org", "creation_time": "2007-01-17T23:11:24Z", "text": "apr_table_vdo uses the value of va_arg(vp,char *) to determine if there are more\narguments.\nOffending code:\n\n    argp = va_arg(vp, char *);\n    do {\n        if (argp) ....\n\n        ...\n\n        else ...\n    } while (argp && ((argp = va_arg(vp, char *)) != NULL));\n\nThis code generates a segmentation fault and voilates the semantics for va_arg.\nFrom man 3 va_arg\n\nAbout va_arg(va_list ap,type)\n\n       If  there is no next argument, or if type is not compatible with the type\nof the actual next argument (as promoted according to the default argument\npromotions), random errors will occur.\n\nThis function is experincing random errors.\n\nFrom the current prototype there is no way this procedure can know the number of\nargument, since it has not been told. The definition of va_arg seems flawed but\nfixing it requires and change in the standard, thus Apache must change.\n\nHow about we change the prototype into apr_table_vdo(apr_table_do_callback_fn_t\n*comp, void *rec, const apr_table_t *t, char **match)\nand require that match is terminates by a NULL."}, {"count": 1, "tags": [], "bug_id": 41397, "attachment_id": null, "is_private": false, "id": 98677, "time": "2007-01-29T05:10:53Z", "creator": "jorton@redhat.com", "creation_time": "2007-01-29T05:10:53Z", "text": "The only problem here is the documentation in the header: the vararg array\npassed to _vdo must be terminated by a NULL pointer but that is not made clear.\n The implementation is fine; it terminates at a NULL pointer and will not try to\nexamine subsequent arguments."}, {"count": 2, "tags": [], "bug_id": 41397, "attachment_id": null, "id": 102542, "time": "2007-04-27T02:59:54Z", "creator": "jorton@redhat.com", "creation_time": "2007-04-27T02:59:54Z", "is_private": false, "text": "Docs should now be clear about this:\n\nhttp://svn.apache.org/viewvc?view=rev&revision=533043\n\nthanks for the report."}]
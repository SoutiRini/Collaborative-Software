[{"count": 0, "tags": [], "bug_id": 10166, "attachment_id": null, "is_private": false, "id": 18443, "time": "2002-06-24T04:11:26Z", "creator": "gozer@cpan.org", "creation_time": "2002-06-24T04:11:26Z", "text": "Starting from 1.3.24, mod_proxy's behavious has been changed to make HTTP/1.1\nproxy requests.  This even in the case where the browser made a 1.0 request\noriginally. This results in old browsers (IE5.0) with broken 1.1 implementation\nto recieve chunked-encoding HTTP data and breaks rendering of certain pages.\n\n\n\nThe following patch fixes this issue by making mod_proxy issue a request of the\nsame version the original client sent.\n\nIndex: proxy_ftp.c\n===================================================================\nRCS file:\n/home/gozer/mirror/cvs.apache.org/apache-1.3-cvs/src/modules/proxy/proxy_ftp.c,v\nretrieving revision 1.98\ndiff -b -B -u -I'$Id' -I'$Revision' -r1.98 proxy_ftp.c\n--- proxy_ftp.c\t7 Apr 2002 18:57:36 -0000\t1.98\n+++ proxy_ftp.c\t24 Jun 2002 04:07:25 -0000\n@@ -1333,7 +1333,7 @@\n \n     /* send response */\n     /* write status line and headers to the cache file */\n-    ap_proxy_write_headers(c, ap_pstrcat(p, \"HTTP/1.1 \", r->status_line, NULL),\nresp_hdrs);\n+    ap_proxy_write_headers(c, ap_pstrcat(p, r->protocol, \" \", r->status_line,\nNULL), resp_hdrs);\n \n     /* Setup the headers for our client from upstreams response-headers */\n     ap_overlap_tables(r->headers_out, resp_hdrs, AP_OVERLAP_TABLES_SET);\nIndex: proxy_http.c\n===================================================================\nRCS file:\n/home/gozer/mirror/cvs.apache.org/apache-1.3-cvs/src/modules/proxy/proxy_http.c,v\nretrieving revision 1.99\ndiff -b -B -u -I'$Id' -I'$Revision' -r1.99 proxy_http.c\n--- proxy_http.c\t30 May 2002 10:19:49 -0000\t1.99\n+++ proxy_http.c\t24 Jun 2002 04:07:25 -0000\n@@ -309,7 +309,7 @@\n     ap_bpushfd(f, sock, sock);\n \n     ap_hard_timeout(\"proxy send\", r);\n-    ap_bvputs(f, r->method, \" \", proxyhost ? url : urlptr, \" HTTP/1.1\" CRLF,\n+    ap_bvputs(f, r->method, \" \", proxyhost ? url : urlptr, \" \", r->protocol, CRLF,\n               NULL);\n     /* Send Host: now, adding it to req_hdrs wouldn't be much better */\n     if (destportstr != NULL && destport != DEFAULT_HTTP_PORT)\n@@ -579,7 +579,7 @@\n         }\n \n         /* write status line and headers to the cache file */\n-        ap_proxy_write_headers(c, ap_pstrcat(p, \"HTTP/1.1 \", r->status_line,\nNULL), resp_hdrs);\n+        ap_proxy_write_headers(c, ap_pstrcat(p, r->protocol, \" \",\nr->status_line, NULL), resp_hdrs);\n     }\n \n     /* Setup the headers for our client from upstreams response-headers */"}, {"count": 1, "tags": [], "text": "Created attachment 2161\nProposed patch", "is_private": false, "id": 18444, "creator": "gozer@cpan.org", "time": "2002-06-24T04:13:19Z", "bug_id": 10166, "creation_time": "2002-06-24T04:13:19Z", "attachment_id": 2161}, {"count": 2, "tags": [], "creator": "wrowe@apache.org", "text": "\n  There is no reason to forward as an HTTP/1.0 request.  mod_proxy should\n  simply cache the chunked response and then send the HTTP/1.0 response\n  from the HTTP/1.1 server.  Another alterative is to turn off keepalives\n  before sending the response headers, and sending the raw results without\n  chunking [disconnect completion.]\n\n  This may depend on bug 10186... did the original client send an HTTP/1.0\n  or http/1.0 request?\n\n", "id": 18491, "time": "2002-06-24T17:40:31Z", "bug_id": 10166, "creation_time": "2002-06-24T17:40:31Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "It was IE5.0 and it made an : HTTP/1.0 request", "is_private": false, "id": 18526, "creator": "gozer@cpan.org", "time": "2002-06-25T05:36:02Z", "bug_id": 10166, "creation_time": "2002-06-25T05:36:02Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 10166, "text": "\n  Apache 2.0's proxy entirely interjects itself between the origin and\n  destination server.  The fact that it chooses to speak http/1.1 to the\n  destination server should have no impact on the results sent to the\n  client.  Closing this as INVALID.  If you have a specific scenario that\n  causes problems, feel free to create a detailed report of what problems\n  exactly the conversation with the destination server cause.\n", "count": 4, "id": 24517, "time": "2002-10-15T03:26:03Z", "creator": "wrowe@apache.org", "creation_time": "2002-10-15T03:26:03Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 10166, "text": "Our server uses Apache Lenya as CMS, Apache Tomcat as servlet container and\nApache 1.3.33 to map urls. We use mod_proxy to rewrite requests from /[some_url]\nto /lenya/live/[someurl] (Lenya can't do it itself).\n\n<VirtualHost **.**.**.**:80>\n        ServerName www.[servername].net\n        DocumentRoot /usr/local/apache/htdocs2\n        ProxyPass               /                \nhttp://jk.[servername].net/lenya/live/\n\t\tProxyPassReverse        /                 http://jk.[servername].net/lenya/live/\n        CacheRoot               /usr/local/apache/var/cache\n        CacheSize               10\n        CacheGcInterval         1\n        CacheMaxExpire          4\n        CacheDirLevels          4\n        CacheForceCompletion    80\n        CacheDirLength          2\n        NoCache                 *\n</VirtualHost>\n\nIf I configure my browser to use HTTP/1.1, sometimes blank pages appear:\naccess_log:\n**.**.**.** - - [15/Mar/2006:06:49:02 -0500] \"GET /lenya/live/testimonials.html\nHTTP/1.1\" 200 8753\n**.**.**.** - - [15/Mar/2006:06:49:02 -0500] \"GET /testimonials.html HTTP/1.0\"\n200 8733\n**.**.**.** - - [15/Mar/2006:06:49:03 -0500] \"GET /lenya/live/contacts.html\nHTTP/1.1\" 200 7138\n**.**.**.** - - [15/Mar/2006:06:49:03 -0500] \"GET /contacts.html HTTP/1.0\" 200 0\n\n\nI've recompiled mod_proxy with applying above diff and all works for now:\n**.**.**.** - - [15/Mar/2006:07:19:04 -0500] \"GET /lenya/live/css/page.css\nHTTP/1.0\" 200 7176\n**.**.**.** - - [15/Mar/2006:07:19:04 -0500] \"GET /css/page.css HTTP/1.0\" 200 7176\n\n\nApache was installed from RPM, mod_proxy was compiled later, from Apache 1.3.33\nsource. I've seen Apache 1.3.34 Changes file and seems this bug isn't fixed there. \n\nroot@ [/usr/local/apache/bin]# ./httpd -V\nServer version: Apache/1.3.33 (Unix)\nServer built:   Oct 19 2005 13:15:02\nServer's Module Magic Number: 19990320:16\nServer compiled with....\n -D EAPI\n -D HAVE_MMAP\n -D HAVE_SHMGET\n -D USE_SHMGET_SCOREBOARD\n -D USE_MMAP_FILES\n -D HAVE_FCNTL_SERIALIZED_ACCEPT\n -D HAVE_SYSVSEM_SERIALIZED_ACCEPT\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D DYNAMIC_MODULE_LIMIT=64\n -D HARD_SERVER_LIMIT=2048\n -D HTTPD_ROOT=\"/usr/local/apache\"\n -D SUEXEC_BIN=\"/usr/local/apache/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/httpd.scoreboard\"\n -D DEFAULT_LOCKFILE=\"logs/httpd.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n -D ACCESS_CONFIG_FILE=\"conf/access.conf\"\n -D RESOURCE_CONFIG_FILE=\"conf/srm.conf\"", "count": 5, "id": 86856, "time": "2006-03-15T13:29:43Z", "creator": "taras.yura@softsky.com.ua", "creation_time": "2006-03-15T13:29:43Z", "is_private": false}]
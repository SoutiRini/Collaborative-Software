[{"count": 0, "tags": [], "bug_id": 56898, "attachment_id": null, "text": "I've raised this against mod_cache because it affects both disk based caches and in memory caches, though the actual problems occurs in the backends as it is in shared code.\n\nI originally encountered this with passenger but it happens with CGI as well, or anything which puts headers in err_headers_out rather than headers_out.\n\nYou can reproduce it by configuring a cache as follows:\n\n  CacheRoot /path/to/cache-dir\n  CacheEnable disk /cgi-bin\n\nand then adding a simple CGI script like this:\n\n  #!/bin/sh\n  \n  echo \"Content-Type: text/plain\"\n  echo \"Last-Modified: Thu, 28 Aug 2014 02:59:59 GMT\"\n  echo \"X-Test: yes\"\n  echo \"\"\n  echo \"Woo!\"\n\nIf that script is requested with an empty cache then the X-Test header will not be returned. It will however be added to the cache entry, so that a second request (which returns it from cache) will return it.\n\nThe problem is that cache_merge_headers_out() in cache_util.c calls apr_table_clear(r->err_headers_out) after it has created the merged headers for the cached,and that discards the headers in err_headers_out so that they are never returned.", "id": 177431, "time": "2014-08-28T20:07:09Z", "creator": "tom@compton.nu", "creation_time": "2014-08-28T20:07:09Z", "is_private": false}, {"count": 1, "tags": [], "creator": "neil@tembosocial.com", "attachment_id": null, "id": 185319, "time": "2015-09-17T19:01:45Z", "bug_id": 56898, "creation_time": "2015-09-17T19:01:45Z", "is_private": false, "text": "I ran into this myself and posted a more in depth report on the mailing list:\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-users/201509.mbox/<2450291.iEmJ1OdeDr@skrypuch>\n\nI reworked the second patch from Edward Lu in the above mailing list thread so it applies to the httpd 2.4.6 shipped with CentOS 7. After testing the CentOS 7 httpd with the reworked patch applied, I can confirm that it solves the issue for me."}, {"count": 2, "tags": [], "creator": "neil@tembosocial.com", "text": "Created attachment 33113\nReworked patch for httpd 2.4.6", "id": 185321, "time": "2015-09-17T19:06:30Z", "bug_id": 56898, "creation_time": "2015-09-17T19:06:30Z", "is_private": false, "attachment_id": 33113}, {"count": 3, "tags": [], "creator": "Chaosed0@gmail.com", "attachment_id": null, "id": 185392, "time": "2015-09-21T19:29:11Z", "bug_id": 56898, "creation_time": "2015-09-21T19:29:11Z", "is_private": false, "text": "Fixed in trunk in r1704392 and r1704395, proposed for backport to 2.4.x. Thanks for the report and for testing."}, {"count": 4, "tags": [], "bug_id": 56898, "attachment_id": null, "text": "*** Bug 55147 has been marked as a duplicate of this bug. ***", "id": 185394, "time": "2015-09-21T19:31:04Z", "creator": "Chaosed0@gmail.com", "creation_time": "2015-09-21T19:31:04Z", "is_private": false}, {"count": 5, "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "id": 185594, "time": "2015-10-03T19:36:08Z", "bug_id": 56898, "creation_time": "2015-10-03T19:36:08Z", "is_private": false, "text": "Backported to 2.4.17 (r1705528)."}]
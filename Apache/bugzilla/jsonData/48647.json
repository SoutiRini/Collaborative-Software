[{"count": 0, "tags": [], "creator": "cyrille.leclerc@pobox.com", "text": "Created attachment 24913\nTomcat 7 patch with updated docs\n\nWhen X-Forwarded-Proto=\"http\", the incoming request attributes secure, scheme and serverPort are not overridden as they are with \"https\". \n\nIf a request came as unsecured/http but the communication between apache and tomcat is ssl, then request.isSecure(), request.getScheme() and request.getServerPort() are wrong. \n\nProposed patch :\n\n* introduce a httpServerPort configuration parameter\n* modify logic for request.isSecure(), request.getScheme() , and request.getServerPort() :\n** if header \"x-forwarded-proto\" is null then keep incoming values\n** else if header \"x-forwarded-proto\" is equal to \"https\" then override values to true, https and 443\n** else override values to false, http and 80\n\n\nNote :\n\n* \"x-forwarded-proto\", 80, 443 and \"https\" (as the ssl value for x-forwarded-proto header) are configurable ; I use sample values in the bug description to make it easier to understand. \n\n* I will soon provide the same fix for RemoteIpValve.", "id": 134086, "time": "2010-01-31T16:28:21Z", "bug_id": 48647, "creation_time": "2010-01-31T16:28:21Z", "is_private": false, "attachment_id": 24913}, {"attachment_id": null, "tags": [], "bug_id": 48647, "text": "The patch has been applied to trunk. Many thanks.", "count": 1, "id": 134135, "time": "2010-02-02T05:26:08Z", "creator": "markt@apache.org", "creation_time": "2010-02-02T05:26:08Z", "is_private": false}]
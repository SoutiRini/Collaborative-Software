[{"count": 0, "tags": [], "bug_id": 55787, "attachment_id": null, "id": 171260, "time": "2013-11-16T17:03:49Z", "creator": "gravatar@selvans.net", "creation_time": "2013-11-16T17:03:49Z", "is_private": false, "text": "I have set my chroot directory as shown below. \n\nChrootDir /var/www\n\nWhen started with the above chroot setting, apache2 exits with the following error\n\n[Sat Nov 16 10:20:54.241556 2013] [unixd:alert] [pid 12802] (2)No such file or directory: AH02158: Cannot chroot when not started as root\n\nNOTE: apache2 is started as 'root' user. It looks like the call to check geteuid() is made after apache2 lowers its privilege to APACHE_RUN_USER?\n\nI am not sure this is a bug or configuration issue. This directory (/var/www) mentioned above was setup with everything needed for chroot'ed environment with libapache2-mod-chroot and was working fine for many years running under apache 2.2. Recently, I upgraded to 2.4.6 and wanted to switch to apache2's native Chroot since mod_chroot is no longer maintained and I am now stuck with the above error."}, {"count": 1, "tags": [], "bug_id": 55787, "text": "Dropping userid happens later in the same function.   Also, works for me.\n\nCan you demonstrate with a minimal configuration and include it w/ an strace -f of startup?", "id": 171261, "time": "2013-11-16T19:38:28Z", "creator": "covener@gmail.com", "creation_time": "2013-11-16T19:38:28Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Created attachment 31048\nstrace output\n\nHere you go...\n\nroot@gorilla:/etc/apache2# rm /var/log/apache2/error.log\nroot@gorilla:/etc/apache2# apachectl start >/tmp/apache2_strace.log 2>&1\n\nI am attaching apache.conf and apache2.strace.log", "attachment_id": 31048, "bug_id": 55787, "id": 171262, "time": "2013-11-16T19:57:49Z", "creator": "gravatar@selvans.net", "creation_time": "2013-11-16T19:57:49Z", "is_private": false}, {"count": 3, "attachment_id": 31049, "creator": "gravatar@selvans.net", "text": "Created attachment 31049\nerror log", "id": 171263, "time": "2013-11-16T19:58:05Z", "bug_id": 55787, "creation_time": "2013-11-16T19:58:05Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 55787, "text": "Created attachment 31050\nminimal apache.conf", "id": 171264, "time": "2013-11-16T19:58:25Z", "creator": "gravatar@selvans.net", "creation_time": "2013-11-16T19:58:25Z", "is_private": false, "attachment_id": 31050}, {"count": 5, "attachment_id": null, "creator": "covener@gmail.com", "text": "Pretty weird, the trace shows geteuid(), chdir(), chroot() which are all after the message you say was issued (assuming it hasn't changed recently) but those all follow the error.\n\nIt's almost like you have a 2nd copy of the mod_unixd code loaded.\n\ncan you add apachectl -l and -M output w/ the same conf from the strace?", "id": 171265, "time": "2013-11-16T20:21:09Z", "bug_id": 55787, "creation_time": "2013-11-16T20:21:09Z", "tags": [], "is_private": false}, {"count": 6, "attachment_id": null, "creator": "gravatar@selvans.net", "text": "Very interesting.... I do see it loaded twice!, how do I get rid of one?\n\nroot@gorilla:/etc/apache2# apachectl -l -M \nCompiled in modules:\n  core.c\n  mod_so.c\n  mod_watchdog.c\n  http_core.c\n  mod_log_config.c\n  mod_logio.c\n  mod_version.c\n  mod_unixd.c\n  mod_unixd.c\nroot@gorilla:/etc/apache2#", "id": 171266, "time": "2013-11-16T20:27:34Z", "bug_id": 55787, "creation_time": "2013-11-16T20:27:34Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 55787, "attachment_id": null, "text": "(In reply to Arul from comment #6)\n> Very interesting.... I do see it loaded twice!, how do I get rid of one?\n> \n> root@gorilla:/etc/apache2# apachectl -l -M \n>   mod_unixd.c\n>   mod_unixd.c\n> root@gorilla:/etc/apache2#\n\nThat is an impressive bug.  Can you open a bug against ubuntu/debian/wherever the build comes from?", "id": 171267, "time": "2013-11-16T20:59:39Z", "creator": "covener@gmail.com", "creation_time": "2013-11-16T20:59:39Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 55787, "attachment_id": null, "text": "Trunk fix: r1542615 .\n\nThis will fixed in Debian in the next upload. If you use an already released version of Ubuntu that includes 2.4, you need to file a bug report with Ubuntu.", "id": 171272, "time": "2013-11-16T23:53:11Z", "creator": "sf@sfritsch.de", "creation_time": "2013-11-16T23:53:11Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 55787, "attachment_id": null, "id": 171273, "time": "2013-11-17T00:57:52Z", "creator": "gravatar@selvans.net", "creation_time": "2013-11-17T00:57:52Z", "is_private": false, "text": "Yes, I am using the latest Ubuntu 13.10 that includes the 2.4.6 version. \n\nroot@gorilla:~# apache2ctl -v\nServer version: Apache/2.4.6 (Ubuntu)\nServer built:   Aug  9 2013 14:31:04\nroot@gorilla:~# cat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=13.10\nDISTRIB_CODENAME=saucy\nDISTRIB_DESCRIPTION=\"Ubuntu 13.10\"\n\nI will file a bug report w/ Ubuntu referencing this. \n\nThank you for your help."}, {"count": 10, "tags": [], "bug_id": 55787, "attachment_id": null, "text": "(In reply to Arul Selvan from comment #9)\n> Yes, I am using the latest Ubuntu 13.10 that includes the 2.4.6 version. \n> \n> root@gorilla:~# apache2ctl -v\n> Server version: Apache/2.4.6 (Ubuntu)\n> Server built:   Aug  9 2013 14:31:04\n> root@gorilla:~# cat /etc/lsb-release \n> DISTRIB_ID=Ubuntu\n> DISTRIB_RELEASE=13.10\n> DISTRIB_CODENAME=saucy\n> DISTRIB_DESCRIPTION=\"Ubuntu 13.10\"\n> \n> I will file a bug report w/ Ubuntu referencing this. \n> \n> Thank you for your help.\n\nBug report filed in Ubuntu: \nhttps://bugs.launchpad.net/ubuntu/+source/apache2/+bug/1251939", "id": 171276, "time": "2013-11-17T13:52:50Z", "creator": "gravatar@selvans.net", "creation_time": "2013-11-17T13:52:50Z", "is_private": false}]
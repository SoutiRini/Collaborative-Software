[{"count": 0, "text": "When using the HTTPRequest sampler with the \"Retrieve all embedded resources\nfrom HTML files\" enabled, JMeter will visit escaped URL's without unescaping\nthem first.  The XHTML spec requires that the \"&\" character be converted to\n\"&amp;\".  So when a stylesheet reference like the following is created, it loads\nthe page without first unescaping the \"&amp;\" sequence to \"&\".\n\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/Styles.css?one=1&amp;two=2\" />\n\nIn a dynamic application this can lead to errors and bad report metrics.", "bug_id": 40589, "is_private": false, "id": 94030, "time": "2006-09-22T21:24:52Z", "creator": "jmorace@jons.net", "creation_time": "2006-09-22T21:24:52Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40589, "text": "Created attachment 19643\nPatch for using & instead of &amp; in URL\n\nAttached is a patch against\nsvn.apache.org/repos/asf/jakarta/jmeter/branches/rel-2-2 as of today.\n\nIt replaces all &amp; in the URL for an embedded resource with &.\nThis is needed to be able to test valid xhtml pages, because xhtml will use\n&amp; in the href attribute of the a tag. But when the browser or in this case\nJmeter uses that URL, it must use & and not &amp;", "id": 99841, "attachment_id": 19643, "creator": "alf@i100.no", "creation_time": "2007-02-27T02:27:17Z", "time": "2007-02-27T02:27:17Z", "is_private": false}, {"count": 2, "tags": [], "creator": "alf@i100.no", "attachment_id": null, "id": 100117, "time": "2007-03-07T01:39:27Z", "bug_id": 40589, "creation_time": "2007-03-07T01:39:27Z", "is_private": false, "text": "I think it is important to fix this, since more and more sites are using proper\nxhtml. The suggested patch seems unproblematic to me."}, {"count": 3, "tags": [], "bug_id": 40589, "text": "Do you think the suggested patch is wrong, or are you afraid of any side effects ?\n\nAny input on the patch, or suggestions on how to solve this are welcomed.", "id": 100521, "attachment_id": null, "creator": "alf@i100.no", "creation_time": "2007-03-17T12:50:42Z", "time": "2007-03-17T12:50:42Z", "is_private": false}, {"count": 4, "tags": [], "creator": "sebb@apache.org", "is_private": false, "text": "It does not seem like it will have side effects, as it only applies to \ndownloadable resources.\n\nHowever, I'm not sure  that this is the correct place to fix the problem - it \nseems odd to be encoding spaces yet decoding ampersands.\n\nI think it should probably be fixed where the URLs are extracted.", "id": 100523, "time": "2007-03-17T13:35:12Z", "bug_id": 40589, "creation_time": "2007-03-17T13:35:12Z", "attachment_id": null}, {"count": 5, "text": "If you try the following HTML in your browser :\n<html>\n<head>\n<title>test</title>\n</head>\n<body>\n<p>A test <a href=\"http://www.google.com/test?somekey=some\nvalue&amp;someotherkey=some%20value%20indeed\">link</a></p>\n</body>\n</html>\n\nand click the link, you will see that the browser then tries to fetch this url :\nhttp://www.google.com/test?somekey=some%20value&someotherkey=some%20value%20indeed\nThis is the URL you will see in the \"Address\" field in the browser.\n\nIf you want to fix this where the URLs are extracted, do you then mean in the\nHTMLParser class ?\nI.e. to perhaps add a protected method in HTMLParser  \"protected String\ngetExecutableUrl(String anUrl)\", which all of the sub classes of HTMLParser\nshould call before putting an URL into the URLCollection they are building ?\n\nThe \"getExecutableUrl\", I wish I had a better name, method would then take care\nof encoding spaces and decoding \"&amp;\" HTML entities.\nI guess the encoding of spaces is done just to support incorrect HTML written by\na lot of people. The decoding of \"&amp;\" HTML entities is something which is\ncorrect to do, in my opinion.\n\nOr do you want to change URLCollection or URLString ?\n\nAdvices are welcomed\n\n", "bug_id": 40589, "is_private": false, "id": 100540, "time": "2007-03-18T05:12:34Z", "creator": "alf@i100.no", "creation_time": "2007-03-18T05:12:34Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 100547, "time": "2007-03-18T09:50:08Z", "bug_id": 40589, "creation_time": "2007-03-18T09:50:08Z", "is_private": false, "text": "Since the embedded URL list is actually returned as URLs, rather than strings, \nit seems to me that the decoding from the href (etc) attributes needs to be \ndone before the URL is created.\n\nSo yes, I think it needs to be done at the parsing stage. This would also \npotentially allow for different decoding depending on the document type (html, \nxhtml).\n\nI'll patch this shortly."}, {"count": 7, "tags": [], "bug_id": 40589, "attachment_id": null, "id": 100554, "time": "2007-03-18T14:05:46Z", "creator": "sebb@apache.org", "creation_time": "2007-03-18T14:05:46Z", "is_private": false, "text": "Fixed in SVN.\n\nWill be in nightly builds after r519694"}]
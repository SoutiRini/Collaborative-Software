[{"count": 0, "tags": [], "text": "Sun 450 with 4 CPU's running Solaris 7, Apache 2.0.51, worker MPM\n\nWithin 20 hours of upgrading to version 2.0.51 apache had to be restarted\nsix times (two different instances) when it stopped accepting new connections.\n\nI used gcore to grab a few core files but the ones I dumped didn't tell\nme much. I had to downgrade apache to 2.0.50. I couldn't get much information\ndue to the emergency nature of this.", "attachment_id": null, "bug_id": 31430, "id": 64238, "time": "2004-09-27T02:06:50Z", "creator": "glenn@apache.org", "creation_time": "2004-09-27T02:06:50Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 31430, "attachment_id": null, "id": 64253, "time": "2004-09-27T08:35:57Z", "creator": "trawick@apache.org", "creation_time": "2004-09-27T08:35:57Z", "is_private": false, "text": "if you still have the core files or pstack output, can you attach the pstack\noutput?  knowing where the threads are at the time of the symptom is critical"}, {"count": 2, "tags": [], "text": "In the heat of the moment trying to get apache working on a production\nsystem I didn't have much time to gather data.\n\nI noticed there were quite a few httpd processes, a number of them defunct.\nI used gcore to generate four core files to gather data before restarting\napache.\n\nHere is the thread and backtrace data for the main apache process:\n\nt@3 (l@3) terminated by signal 0 (UNKNOWN SIGNAL)\n(/opt/SUNWspro/bin/dbx) where                                                \ncurrent thread: t@3\n=>[1] __lwp_sema_wait(0xfdf0de78, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfef18080\n  [2] _park(0xfdf0ddc0, 0xfdf0de78, 0x0, 0x1, 0xfef8d7e0, 0x0), at 0xfef6b2f8\n  [3] _swtch(0x5, 0xfef8ca54, 0xfdf0de54, 0xfdf0de50, 0xfdf0de4c, 0xfdf0de48),\nat 0xfef6afc0\n  [4] _reap_wait(0xfef91428, 0x1e484, 0x0, 0x0, 0x0, 0x0), at 0xfef6e884\n  [5] _reaper(0xfef8ca54, 0xfef91428, 0xfef8d870, 0xfef997bc, 0x0, 0xfe400000),\nat 0xfef6e600\n(/opt/SUNWspro/bin/dbx) threads\n      t@1  a l@1  ?()   running                 in __fork1()\n      t@2  b l@2  ?()   running                 in _signotifywait()\n >    t@3  a l@3  ?()   sleep on (unknown)      in __lwp_sema_wait()\n\nThe other three core files were for child httpd processes for the worker MPM.\nHere is an example of one of them.  Notice that this looks like a process\nwaiting to be terminated but a thread is still waiting on something from Tomcat\nvia mod_jk 1.2.5.  The earlier problems with apache caused a failure with one\nof our load balanced tomcat's which probably explains the below backtrace.\n\n\nt@0 (l@18) terminated by signal 0 (UNKNOWN SIGNAL)\n(/opt/SUNWspro/bin/dbx) where                                                \ncurrent thread: t@0\n=>[1] ___lwp_cond_wait(0xfef93fc8, 0xfef93fd8, 0xfea63cf0, 0x0, 0x0,\n0xfea63ce8), at 0xfef18034\n  [2] __lwp_cond_timedwait(0xfef93fc8, 0xfef93fd8, 0x0, 0x41576b15, 0x0, 0x0),\nat 0xfef0fb68\n  [3] _age(0xfef8ca54, 0xfef8d7d4, 0x1, 0x0, 0x0, 0xfe401000), at 0xfef6a94c\n(/opt/SUNWspro/bin/dbx) threads\n      t@1  a l@5  ?()   sleep on 0xfef8d878     in __lwp_sema_wait()\n      t@2  b l@2  ?()   running                 in _signotifywait()\n      t@3  a l@1  ?()   sleep on 0xfef91428     in __lwp_sema_wait()\n     t@11  a l@16 apr_thread_create()   running                 in _so_recv()\n(/opt/SUNWspro/bin/dbx) thread t@11\nCurrent function is jk_tcp_socket_recvfull\n  313                                0);    \nt@11 (l@16) stopped in _so_recv at 0xfef14ee4\n0xfef14ee4: _so_recv+0x0008:    ta      0x8\n(/opt/SUNWspro/bin/dbx) where     \ncurrent thread: t@11\n  [1] _so_recv(0x19, 0xfd30c650, 0x4, 0x0, 0xfe3b636c, 0x400), at 0xfef14ee4\n=>[2] jk_tcp_socket_recvfull(sd = 25, b = 0xfd30c650 \"\", len = 4), line 313 in\n\"jk_connect.c\"\n  [3] ajp_connection_tcp_get_message(ae = 0x4400a0, msg = 0x4400d8, l =\n0x158648), line 735 in \"jk_ajp_common.c\"\n  [4] ajp_get_reply(e = 0x4420cc, s = 0xfd30d86c, l = 0x158648, p = 0x4400a0, op\n= 0xfd30c738), line 1136 in \"jk_ajp_common.c\"\n  [5] ajp_service(e = 0x4420cc, s = 0xfd30d86c, l = 0x158648,\nis_recoverable_error = 0xfd30c7c4), line 1271 in \"jk_ajp_common.c\"\n  [6] service(e = 0x1a1ba0, s = 0xfd30d86c, l = 0x158648, is_recoverable_error =\n0xfd30c860), line 338 in \"jk_lb_worker.c\"\n  [7] jk_handler(r = 0x36d988), line 1792 in \"mod_jk.c\"\n  [8] ap_run_handler(0x36d988, 0x0, 0x36d988, 0x226530, 0x0, 0x0), at 0x70218\n  [9] ap_invoke_handler(r = 0x36d988), line 363 in \"config.c\"\n  [10] ap_process_request(r = 0x36d988), line 246 in \"http_request.c\"\n  [11] ap_process_http_connection(c = 0x226530), line 250 in \"http_core.c\"\n  [12] ap_run_process_connection(0x226530, 0x226460, 0x226460, 0x206, 0x226528,\n0x228430), at 0x86cc0\n  [13] ap_process_connection(c = 0x226530, csd = 0x226460), line 175 in\n\"connection.c\"\n  [14] process_socket(p = 0x226428, sock = 0x226460, my_child_num = 8,\nmy_thread_num = 6, bucket_alloc = 0x228430), line 520 in \"worker.c\"\n  [15] worker_thread(thd = 0x15e7b8, dummy = 0x1b0a68), line 834 in \"worker.c\"\n  [16] apr_thread_create(new = 0x15e7b8, attr = (nil), func = (nil), data =\n(nil), pool = (nil)), line 103 in \"thread.c\"\n\nNote that I did have the same core problem with another instance of apache\nwhich does not use mod_jk but I didn't get any core files for it.\n\nSorry I don't have any more information. The customer was complaining and\nI had to get apache running again.", "attachment_id": null, "bug_id": 31430, "id": 64258, "time": "2004-09-27T11:45:20Z", "creator": "glenn@apache.org", "creation_time": "2004-09-27T11:45:20Z", "is_private": false}, {"count": 3, "tags": [], "text": "I am setting up a dual CPU Sun E250 to see if I can reproduce the problem.\nIt is running Solaris 8 rather than Solaris 7, but that should be close \nenough for some initial tests. I will be stress testing it tonight and will\ncheck tomorrow morning to see if it is failing.", "is_private": false, "id": 64283, "creator": "glenn@apache.org", "time": "2004-09-27T19:28:30Z", "bug_id": 31430, "creation_time": "2004-09-27T19:28:30Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 31430, "attachment_id": null, "is_private": false, "id": 65149, "time": "2004-10-14T18:21:01Z", "creator": "glenn@apache.org", "creation_time": "2004-10-14T18:21:01Z", "text": "I tried to reproduce the problem on a spare Sun 250 but could not.\n\nLast weekend we had apache 2 fail in a similar manner, this is after we\nhad downgraded apache to version 2.0.50.\n\nThere may not be a new bug introduced in apache 2.0.51 now that we have\nseen a similar failure with 2.0.50 on the same server.  We now suspect\nthat this may be due to some problem on the server itself which was triggered\nby an unplanned power outage which occurred hours after we did the apache 2.0.51\nupgrade.\n\nWe have rebooted the problem server in the hopes that a reboot will fix\nwhatever problem was caused by the unplanned power outage.\n\nI am going to mark this bug as invalid."}]
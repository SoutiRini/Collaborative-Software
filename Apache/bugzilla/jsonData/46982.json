[{"count": 0, "tags": [], "text": "This is a problem with AccessLogValve for tc5.5 as well as tc6.0 on all platforms.\n\nWith the system clock on my linux machine (Ubuntu in my case) to just before the US time change on March 8, I started Tomcat 5.5 and see the following messages in my Tomcat access log after accessing Tomcat JSP example pages at the time of DST transition:\n\n-: - [08/Mar/2009:01:56:20 -0700] GET /jsp-examples/jsp2/simpletag/book.jsp HTTP/1.1 200 1738 1 - {http-8080-Processor24}\n-: - [08/Mar/2009:03:01:22 -0700] GET /jsp-examples/jsp2/tagfiles/hello.jsp HTTP/1.1 200 2213 68 - {http-8080-Processor25}\n\nNote the offset of \"-0700\" both before and after DST transition.  Following a Tomcat restart the offset is correct:\n\n-: - [08/Mar/2009:03:19:42 -0600] GET /jsp-examples/jsp2/jspx/basic.jspx HTTP/1.1 200 1919 780 - {http-8080-Processor25}\n-: - [08/Mar/2009:03:19:59 -0600] GET /jsp-examples/jsp2/jspx/svgexample.html HTTP/1.1 200 2239 4 - {http-8080-Processor25}\n-: - [08/Mar/2009:03:19:59 -0600] GET /jsp-examples/jsp2/jspx/textRotate.jpg HTTP/1.1 200 26729 3 - {http-8080-Processor25}\n\n\nBTW, I ran the tzupdater before my tests:\n\nlinwin01-512> java -jar tzupdater.jar -V\ntzupdater version 1.3.12-b01\nJRE time zone data version: tzdata2009a\nEmbedded time zone data version: tzdata2009a\n\n\n\nThe problem is in the org.apache.catalina.valves.AccessLogValve which contains the following in its start method:\n\n\n// Initialize the timeZone, Date formatters, and currentDate\ntimezone = TimeZone.getDefault();\ntimeZoneNoDST = calculateTimeZoneOffset(timezone.getRawOffset());\nCalendar calendar = Calendar.getInstance(timezone);\nint offset = calendar.get(Calendar.DST_OFFSET);\ntimeZoneDST = calculateTimeZoneOffset(timezone.getRawOffset()+offset);\n\n\nBased on what I\u2019ve seen, \u201cint offset = calendar.get(Calendar.DST_OFFSET);\u201d returns 0 when the current time is not in Daylight savings time and (for my timezone) 3600000 (60 * 60 * 1000) when the current time is in Daylight Savings.  It looks like the code assumes this is always the offset for Daylight Savings for the current timezone.  I have no idea if there are some locations/timezones where Daylight Savings Time does not have a 1 hour offset.\n\nBecause of this, if in a non-DST time period, timeZoneDST and timeZoneNoDST are set to the same value.  If in a DST time period, I believe they are set correctly so that the transition in Autumn works correctly.  I think the only problem is when moving ahead in Springtime (unless the software has been running for 6 months or so which caused the offset to be set correctly).", "attachment_id": null, "bug_id": 46982, "id": 126040, "time": "2009-04-07T07:32:55Z", "creator": "phil.pickett@springsource.com", "creation_time": "2009-04-07T07:32:55Z", "is_private": false}, {"count": 1, "tags": [], "text": "Thanks for the report. This has been fixed in trunk and proposed for 5.5.x and 6.0.x", "attachment_id": null, "bug_id": 46982, "id": 126074, "time": "2009-04-08T03:21:00Z", "creator": "markt@apache.org", "creation_time": "2009-04-08T03:21:00Z", "is_private": false}, {"count": 2, "tags": [], "text": "This has been fixed in 6.0.x and will be included in 6.0.20 onwards.", "is_private": false, "id": 126581, "creator": "markt@apache.org", "time": "2009-04-28T04:54:24Z", "bug_id": 46982, "creation_time": "2009-04-28T04:54:24Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "is_private": false, "id": 126582, "attachment_id": null, "bug_id": 46982, "creation_time": "2009-04-28T04:55:15Z", "time": "2009-04-28T04:55:15Z", "text": "Opps. Still open for 5.5.x"}, {"count": 4, "tags": [], "bug_id": 46982, "attachment_id": null, "is_private": false, "id": 127637, "time": "2009-06-04T07:34:00Z", "creator": "markt@apache.org", "creation_time": "2009-06-04T07:34:00Z", "text": "This has been fixed for 5.5.x and will be included in 5.5.28 onwards."}]
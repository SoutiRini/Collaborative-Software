[{"count": 0, "tags": [], "creator": "rutski89@gmail.com", "text": "I installed apache 2.2 with mod_ssl today on a local computer for development\npurposes and decided to have a peek at the logs just for fun. When I saw\n\"Seeding PRNG with 0 bytes of entropy\" I was amused and at the same time\nsomewhat frightened.\n\nBelow is a copy of my config file and what follows after that are the relevant\nlog entries for a single fetch of \"http://localhost/\" via Safari.\n\n===============================================================\n===============\nServerRoot \"/opt/apache2\"\n\nListen 80\nListen 443\n\nUser  opt-www\nGroup opt-www\n\nLoadModule perl_module  modules/mod_perl.so\nLoadModule logio_module modules/mod_logio.so\n\n<Directory />\n    Options None\n    AllowOverride None\n</Directory>\n\n<FilesMatch \"^\\.ht\">\n    Order allow,deny\n    Deny from all\n    Satisfy All\n</FilesMatch>\n\nSSLRandomSeed           startup file:/dev/random  512\nSSLRandomSeed           connect file:/dev/random  512\nSSLSessionCache         shmcb:/opt/apache2/ssl/ssl_scache(512000)\nSSLSessionCacheTimeout  300\nSSLMutex                file:/opt/apache2/ssl/ssl_mutex\n\nLogLevel  info\nLogFormat \"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \\\"%r\\\" %b\" ssl_log_format\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\"\n\nNameVirtualHost *:80\n\n<VirtualHost *:80>\n    ServerAdmin  rutski89@gmail.com\n    DocumentRoot /opt/var/www/localhost/htdocs\n    ServerName   localhost\n    ServerAlias  mini\n\n    Loglevel     debug\n    ErrorLog     /opt/var/www/localhost/logs/error_log\n    TransferLog  /opt/var/www/localhost/logs/access_log\n\n    ScriptAlias /cgi-bin/ \"/opt/var/www/localhost/cgi-bin/\"\n</VirtualHost>\n\n<VirtualHost *:443>\n    SSLEngine             on\n    SSLCertificateFile    /opt/var/www/localhost-ssl/ssl/server.crt\n    SSLCertificateKeyFile /opt/var/www/localhost-ssl/ssl/server.key\n\n    ServerAdmin  rutski89@gmail.com\n    DocumentRoot /opt/var/www/localhost-ssl/htdocs\n    ServerName   localhost\n    ServerAlias  mini\n\n    Loglevel     info\n    ErrorLog     /opt/var/www/localhost-ssl/logs/error_log\n    TransferLog  /opt/var/www/localhost-ssl/logs/access_log\n    CustomLog    /opt/var/www/localhost-ssl/logs/ssl_log ssl_log_format\n    \n    <Directory /opt/var/www/localhost-ssl/htdocs>\n        Options Indexes\n    </Directory>\n\n    BrowserMatch \".*MSIE.*\" \\\n        nokeepalive ssl-unclean-shutdown \\\n        downgrade-1.0 force-response-1.0\n</VirtualHost>\n===============================================================\n===============\n\nThere's no imminent danger since this is just a local dev box but I  \nwould like to get to the bottom of this 0 PRNG seed weirdness anyway;  \njust blame human curiosity.\n\n(Note: The offending log entry is on the 2nd line of error_log)\n\n===============================================================\n===============\n==access_log==\n\n::1 - - [14/Sep/2006:12:52:11 -0400] \"GET / HTTP/1.1\" 200 209 \"-\"  \n\"Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/418.8  \n(KHTML, like Gecko) Safari/419.3\" 569 1359\n::1 - - [14/Sep/2006:12:52:11 -0400] \"GET /favicon.ico HTTP/1.1\" 200  \n- \"-\" \"Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/418.8  \n(KHTML, like Gecko) Safari/419.3\" 320 362\n\n==error_log==\n\n[Thu Sep 14 12:52:11 2006] [info] [client ::1] Connection to child 5  \nestablished (server localhost:443)\n[Thu Sep 14 12:52:11 2006] [info] Seeding PRNG with 0 bytes of entropy\n[Thu Sep 14 12:52:11 2006] [info] Client requested a 'session-resume'  \nbut we have no such session.\n[Thu Sep 14 12:52:11 2006] [info] Initial (No.1) HTTPS request  \nreceived for child 5 (server localhost:443)\n[Thu Sep 14 12:52:11 2006] [info] Subsequent (No.2) HTTPS request  \nreceived for child 5 (server localhost:443)\n[Thu Sep 14 12:52:16 2006] [info] [client ::1] (70007)The timeout  \nspecified has expired: SSL input filter read failed.\n[Thu Sep 14 12:52:16 2006] [info] [client ::1] Connection closed to  \nchild 5 with standard shutdown (server localhost:443)\n\n==ssl_log==\n\n[14/Sep/2006:12:52:11 -0400] ::1 TLSv1 RC4-SHA \"GET / HTTP/1.1\" 209\n[14/Sep/2006:12:52:11 -0400] ::1 TLSv1 RC4-SHA \"GET /favicon.ico HTTP/1.1\" -\n===============================================================\n===============", "id": 93603, "time": "2006-09-14T20:45:44Z", "bug_id": 40513, "creation_time": "2006-09-14T20:45:44Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Can you get a truss output from the child process doing this?  It should only\nhappen AFAICT if a read() from /dev/random fails.", "is_private": false, "bug_id": 40513, "id": 94694, "time": "2006-10-10T11:59:01Z", "creator": "jorton@redhat.com", "creation_time": "2006-10-10T11:59:01Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "sf@sfritsch.de", "text": "This PR has been in state NEEDINFO for > 4 years. Closing.", "id": 148858, "time": "2011-08-27T19:05:34Z", "bug_id": 40513, "creation_time": "2011-08-27T19:05:34Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "arekm@maven.pl", "text": "I have the same message on Linux x86_64 platform, httpd 2.2.24:\n\nstrace for single child process:\n\n# grep random log\n22:22:12 open(\"/dev/urandom\", O_RDONLY) = 14 <0.002871>\n22:22:12 open(\"/dev/urandom\", O_RDONLY) = 14 <0.000039>\n22:22:12 open(\"/dev/urandom\", O_RDONLY) = 14 <0.000028>\n22:22:12 open(\"/dev/urandom\", O_RDONLY) = 14 <0.000035>\n22:22:12 open(\"/dev/urandom\", O_RDONLY) = 14 <0.000030>\n22:22:12 open(\"/dev/urandom\", O_RDONLY) = 14 <0.000030>\n\nso it opens /dev/urandom fine and later:\n\n22:22:42 write(2, \"[Tue Apr 09 22:22:42 2013] [debug] mod_headers.c(756): headers: ap_headers_output_filter()\\n\", 91) = 91 <0.000035>\n22:22:42 setsockopt(13, SOL_TCP, TCP_CORK, [1], 4) = 0 <0.000018>\n22:22:42 writev(13, [{\"HTTP/1.1 200 OK\\r\\nDate: Tue, 09 Apr 2013 20:22:42 GMT\\r\\nServer: Apache\\r\\nLast-Modified: Wed, 27 Mar 2013 10:32:25 GMT\\r\\nETag: \\\"92d1bb54-13252-4d8e58dcfc4d5\\\"\\r\\nAccept-Ranges: bytes\\r\\nContent-Length: 78418\\r\\nK\"..., 284}], 1) = 284 <0.000021>\n22:22:42 sendfile(13, 14, [0], 78418)   = 23076 <0.000045>\n22:22:42 setsockopt(13, SOL_TCP, TCP_CORK, [0], 4) = 0 <0.000015>\n22:22:42 poll([{fd=13, events=POLLOUT}], 1, 300000) = 1 ([{fd=13, revents=POLLOUT}]) <0.010243>\n22:22:42 sendfile(13, 14, [23076], 55342) = 30660 <0.000036>\n22:22:42 poll([{fd=13, events=POLLOUT}], 1, 300000) = 1 ([{fd=13, revents=POLLOUT}]) <0.029560>\n22:22:42 sendfile(13, 14, [53736], 24682) = 24682 <0.000026>\n22:22:42 read(13, 0x8838ef8, 8000)      = -1 EAGAIN (Resource temporarily unavailable) <0.000017>\n22:22:42 write(9, \"some.host xx.xx.170.48 - - [09/Apr/2013:22:22:42 +0200] \\\"GET /pages_low/51_low.jpg HTTP/1.1\\\" 200 78702 \\\"http://some.host/?utm_source=glowna&utm_medium=middle&utm_campaign=abc\"..., 297) = 297 <0.000027>\n22:22:42 write(11, \"some.host xx.xx.170.48 - - [09/Apr/2013:22:22:42 +0200] \\\"GET /pages_low/51_low.jpg HTTP/1.1\\\" 200 78702 \\\"http://some.host/?utm_source=glowna&utm_medium=middle&utm_campaign=abc\"..., 280) = 280 <0.000020>\n22:22:42 gettid()                       = 29778 <0.000023>\n22:22:42 open(\"/proc/29778/attr/current\", O_WRONLY) = 15 <0.000027>\n22:22:42 write(15, \"changehat 000000001f74f58e^\", 27) = 27 <0.000021>\n22:22:42 close(15)                      = 0 <0.000017>\n22:22:42 gettid()                       = 29778 <0.000014>\n22:22:42 open(\"/proc/29778/attr/current\", O_WRONLY) = 15 <0.000020>\n22:22:42 write(15, \"changehat 000000001f74f58e^HANDLING_UNTRUSTED_INPUT\", 51) = 51 <0.000052>\n22:22:42 close(15)                      = 0 <0.000015>\n\n(change hat due to apache-mod_apparmor usage)\n\n22:22:42 times({tms_utime=156, tms_stime=41, tms_cutime=0, tms_cstime=0}) = 1444949832 <0.000015>\n22:22:42 close(14)                      = 0 <0.000017>\n22:22:42 poll([{fd=13, events=POLLIN}], 1, 2000) = 0 (Timeout) <2.007569>\n22:22:44 times({tms_utime=156, tms_stime=41, tms_cutime=0, tms_cstime=0}) = 1444950033 <0.000016>\n22:22:44 shutdown(13, SHUT_WR)          = 0 <0.000039>\n22:22:44 poll([{fd=13, events=POLLIN}], 1, 2000) = 1 ([{fd=13, revents=POLLIN|POLLHUP}]) <0.023552>\n22:22:44 read(13, \"\", 512)              = 0 <0.000029>\n22:22:44 close(13)                      = 0 <0.000033>\n22:22:44 read(7, 0x7fff40e8c897, 1)     = -1 EAGAIN (Resource temporarily unavailable) <0.000021>\n22:22:44 semop(5931027, {{0, -1, SEM_UNDO}}, 1) = 0 <1.202430>\n22:22:46 epoll_wait(10, {?} 0x881c4a8, 4, 10000) = 1 <0.058998>\n22:22:46 accept(6, {sa_family=AF_INET, sin_port=htons(39947), sin_addr=inet_addr(\"89.69.21.174\")}, [16]) = 13 <0.000023>\n22:22:46 fcntl(13, F_GETFD)             = 0 <0.000018>\n22:22:46 fcntl(13, F_SETFD, FD_CLOEXEC) = 0 <0.000018>\n22:22:46 semop(5931027, {{0, 1, SEM_UNDO}}, 1) = 0 <0.000031>\n22:22:46 write(2, \"[Tue Apr 09 22:22:46 2013] [info] [client 89.69.21.174] Connection to child 54 established (server localhost:443)\\n\", 114) = 114 <0.000039>\n22:22:46 write(2, \"[Tue Apr 09 22:22:46 2013] [info] Seeding PRNG with 0 bytes of entropy\\n\", 71) = 71 <0.000032>\n22:22:46 fcntl(13, F_GETFL)             = 0x2 (flags O_RDWR) <0.000023>\n22:22:46 fcntl(13, F_SETFL, O_RDWR|O_NONBLOCK) = 0 <0.000016>\n22:22:46 write(2, \"[Tue Apr 09 22:22:46 2013] [debug] ssl_engine_kernel.c(1872): OpenSSL: Handshake: start\\n\", 88) = 88 <0.000023>\n22:22:46 write(2, \"[Tue Apr 09 22:22:46 2013] [debug] ssl_engine_kernel.c(1880): OpenSSL: Loop: before/accept initialization\\n\", 106) = 106 <0.000022>\n\n\n# grep \"Seeding PRNG with 0 bytes of entropy\" /var/log/httpd/error_log  | wc -l\n4395\n# grep \"Seeding PRNG\" /var/log/httpd/error_log | grep -v \"Seeding PRNG with 0 bytes of entropy\"\n#\n\nso every message had 0 bytes in it.\n\n\nUpdated bug fields to match this case since original reporter is not responding.", "id": 166493, "time": "2013-04-09T20:35:12Z", "bug_id": 40513, "creation_time": "2013-04-09T20:35:12Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "arekm@maven.pl", "attachment_id": null, "text": "In ssl_rand_seed apRandSeed->nelts is 0 so it does nothing.\n\nTurns out that I was missing some configuration like\n\nSSLRandomSeed startup file:/dev/urandom  256\nSSLRandomSeed connect builtin\n\nbut on the other hand I would expect defaults to be sane and using entropy source without requiring manual configuration.", "id": 166507, "time": "2013-04-10T07:43:04Z", "bug_id": 40513, "creation_time": "2013-04-10T07:43:04Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 40513, "attachment_id": null, "text": "I think this is not a problem on common platforms. According to the openssl RAND_seed man page, 'On systems that provide \"/dev/urandom\", the randomness device is used to seed the PRNG transparently'. So, SSLRandomSeed is really only needed on platforms that do not have /dev/urandom.\n\nBut this should be updated in the docs, and maybe we want to reduce the loglevel of the message to debug if SSLRandomSeed is not set.", "id": 166523, "time": "2013-04-10T20:26:19Z", "creator": "sf@sfritsch.de", "creation_time": "2013-04-10T20:26:19Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 40513, "attachment_id": null, "text": "I can confirm this issue on a clean SLES 11SP2 64-bit, with apache2-2.2.12-1.28.1.\n\nWithout the lines:\n\nSSLRandomSeed startup file:/dev/urandom  256\nSSLRandomSeed connect builtin\n\nin the apache config, the error log reports the following: \n[info] Init: Seeding PRNG with 0 bytes of entropy\n\nSystem info: \nuname -a:\nLinux test-host-name 3.0.13-0.27-default #1 SMP Wed Feb 15 13:33:49 UTC 2012 (d73692b) x86_64 x86_64 x86_64 GNU/Linux\n\ncat /etc/SuSE-release:\nSUSE Linux Enterprise Server 11 (x86_64)\nVERSION = 11\nPATCHLEVEL = 2\n\nmodssl-version from Apache error_log:\nmod_ssl/2.2.12 compiled against Server: Apache/2.2.12, Library: OpenSSL/0.9.8h\n\n/dev/urandom is present on this host:\ncrw-rw-rw- 1 root root 1, 9 Apr 10 11:44 /dev/urandom\n\n(When the two lines first mentioned are present in the config, PRNG is behaving as one should expect, with entropy =! 0)\n\nRegards,\nVegard Fremstad", "id": 166766, "time": "2013-04-22T20:08:33Z", "creator": "vegard.nospam@gmail.com", "creation_time": "2013-04-22T20:08:33Z", "is_private": false}]
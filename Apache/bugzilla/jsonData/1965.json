[{"count": 0, "tags": [], "creator": "roytman@smart.net", "attachment_id": null, "id": 2719, "time": "2001-06-01T21:14:24Z", "bug_id": 1965, "creation_time": "2001-06-01T21:14:24Z", "is_private": false, "text": "Hello,\n\nI am having problems with Xerces 1.4 which was not present in 1.3.x\nIf I remember correctly there was similar problem in earlier versions under \nheavy multithreaded stress which I reported and it has been fixed.\n\nTo reproduce the problem you need to parse XML with DTD and set validating to \ntrue\n\n- when validation is off (even if dtd is present) everything works fine. \n- when validation is on everything works fine from a single thread \n- When parsing in multiple threads with validation on parser randomly report \nvarious validation errors.\n\nBelow is my test program source\n\npackage com.peacetech.debug;\n\nimport javax.xml.parsers.*;\nimport org.xml.sax.XMLReader;\nimport org.xml.sax.SAXException;\n\npublic class XmlTest extends Thread {\n  private boolean stop = false;\n  private String uri;\n  private static SAXParserFactory parserFactory = SAXParserFactory.newInstance\n();\n\n  static {\n    parserFactory.setNamespaceAware(true);\n    parserFactory.setValidating(true);\n  }\n\n  public XmlTest(String uri) {\n    this.uri = uri;\n  }\n\n  public void run() {\n    int i = 0;\n    while (!stop) {\n      try {\n        SAXParser parser = parserFactory.newSAXParser();\n        XMLReader reader = parser.getXMLReader();\n        reader.parse(uri);\n      } catch (Exception ex) {\n        ex.printStackTrace();\n        break;\n      }\n    }\n  }\n\n  public static void main(String[] args) throws Exception {\n    int threadCount = 10;\n    XmlTest threads[] = new XmlTest[threadCount];\n    for (int i = 0; i < threads.length; i++) {\n      threads[i] = new XmlTest(\"file:Z:/Projects/java/peacetech/xmap/samples/ms-\nnwind/nwind-schema.xml\");\n      threads[i].start();\n    }\n    Thread.currentThread().sleep(10000);\n    for (int i = 0; i < threads.length; i++) {\n      threads[i].stop = true;\n    }\n    for (int i = 0; i < threads.length; i++) {\n      threads[i].join();\n    }\n  }\n}"}]
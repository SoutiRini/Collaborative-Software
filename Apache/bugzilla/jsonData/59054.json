[{"count": 0, "tags": [], "bug_id": 59054, "is_private": false, "text": "During first request to the application when user agent matches crawler pattern the execution reaches the point where it tries to store itself in sessionAttribute (s1.setAttribute(this.getClass().getName(), this)). Since CrawlerSessionManagerValve does not implement Serializable it throws exception:\n\njava.lang.IllegalArgumentException: setAttribute: Non-serializable attribute org.apache.catalina.valves.CrawlerSessionManagerValve\n\tat org.apache.catalina.session.StandardSession.setAttribute(StandardSession.java:1465)\n\tat org.apache.catalina.session.StandardSession.setAttribute(StandardSession.java:1426)\n\tat org.apache.catalina.session.StandardSessionFacade.setAttribute(StandardSessionFacade.java:154)\n\tat org.apache.catalina.valves.CrawlerSessionManagerValve.invoke(CrawlerSessionManagerValve.java:190)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:423)\n\tat org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:190)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:625)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:316)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)\n\n\n\nI was able to fix this bug by modyfing source code to implement Serializable interface.", "id": 188714, "time": "2016-02-23T14:48:28Z", "creator": "kubas121@o2.pl", "creation_time": "2016-02-23T14:48:28Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "You should only see this error in a distributed environment.\n\nThe CrawlerSessionManagementValve isn't intended to be distributed so I have added to the list of attributes that are excluded from this process. This fix has been applied to 9.0.x (for 9.0.0.M4 onwards), 8.0.x (for 8.0.33 onwards) and 7.0.x for 7.0.69 onwards.", "is_private": false, "id": 188716, "creator": "markt@apache.org", "time": "2016-02-23T15:14:41Z", "bug_id": 59054, "creation_time": "2016-02-23T15:14:41Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "kubas121@o2.pl", "text": "Thanks for reply. Can you explain how  distributed enviroment can influence this behaviour.\nThe class is not serializable so any StandardSession.setAttribute() call with it as a parameter will end up throwing exception, won't it? Apart from that I am not using distributed enviroment.", "id": 188793, "time": "2016-02-25T08:12:08Z", "bug_id": 59054, "creation_time": "2016-02-25T08:12:08Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 59054, "text": "If you have further questions, please use the user list, bugzilla is not a support forum. Thanks.", "id": 188794, "time": "2016-02-25T08:15:52Z", "creator": "remm@apache.org", "creation_time": "2016-02-25T08:15:52Z", "is_private": false, "attachment_id": null}]
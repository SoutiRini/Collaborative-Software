[{"count": 0, "tags": [], "text": "We have a web application that we recently started deploying as WAR file \n(before it used to get deployed in exploded format). Our web application makes \na RMI call to another RMI server. It seems the RMI calls works fine as long as \nCATALINA_HOME does not have any spaces in its installation path.\n\nFor example: The RMI call throws Socket Exception, Connection reset by peer if \nthe Tomcat installatin directory is \"C:\\Tomcat 41\". Just renaming the directory \nto \"C:\\Tomcat41\" makes the application work OK. The WAR file path \nis \"C:\\XX.WAR\".\n\nNote that RMI call works OK if we deploy the application in exploded format \n(\"C:\\XX\\WEB-INF\\*\") regardless of whether there are any spaces in Tomcat \ninstallation path or not.", "is_private": false, "bug_id": 13983, "id": 25207, "time": "2002-10-25T22:07:30Z", "creator": "kuchhal@yahoo.com", "creation_time": "2002-10-25T22:07:30Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 13983, "text": "See Sun's bug 4273532 \n(http://developer.java.sun.com/developer/bugParade/bugs/4273532.html).\n\nApparently, the WebappClassLoader is doing nothing wrong when in the getURL \nmethod it calls realFile.toURL().  Sun's File.toURL is to blame.  Sun's \nsuggested workaround fixes the problem:\n\n  return realFile.toURI().toURL();\n\n", "id": 26264, "time": "2002-11-14T12:44:32Z", "creator": "kelly@apache.org", "creation_time": "2002-11-14T12:44:32Z", "is_private": false, "attachment_id": null}, {"count": 2, "text": "*** Bug 10871 has been marked as a duplicate of this bug. ***", "creator": "kelly@apache.org", "is_private": false, "id": 26266, "time": "2002-11-14T12:46:35Z", "bug_id": 13983, "creation_time": "2002-11-14T12:46:35Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 13983, "is_private": false, "id": 26267, "attachment_id": null, "creator": "remm@apache.org", "creation_time": "2002-11-14T12:56:50Z", "time": "2002-11-14T12:56:50Z", "text": "Thanks for the additional details. I had added realFile.toURI().toURL() already\nin the Tomcat 5 dev code, but it has the following problems:\n- works only with JDK 1.4 :-(\n- causes problems with codebase definitions used by the security manager (which\nare not URL encoded); for that reason, the encoded URLs are only returned for\ngetResource calls.\n\nI think this change will be reverted (we need to work with JDK 1.3), and another\nfix will be needed."}, {"count": 4, "tags": [], "bug_id": 13983, "attachment_id": null, "id": 45312, "time": "2003-10-09T18:45:04Z", "creator": "medthomas@ntlworld.com", "creation_time": "2003-10-09T18:45:04Z", "is_private": false, "text": "*** Bug 23112 has been marked as a duplicate of this bug. ***"}, {"count": 5, "tags": [], "bug_id": 13983, "attachment_id": null, "is_private": false, "id": 45313, "time": "2003-10-09T18:55:41Z", "creator": "jessh@ptc.com", "creation_time": "2003-10-09T18:55:41Z", "text": "See bug 23112 for a description of a fix that works in Java 1.3 and 1.4."}, {"attachment_id": null, "tags": [], "bug_id": 13983, "is_private": false, "count": 6, "id": 52154, "time": "2004-02-11T18:19:56Z", "creator": "sajid.merchant@ca.com", "creation_time": "2004-02-11T18:19:56Z", "text": "I was able to fix this problem by changing the getURL method in the \nWebappclassloader. Also, i've only tested this with 4.1.29 so, even though i \nthink this will work with other versions, its not been tested with those.\n\nHere is the new getURL method\n    \n    protected URL getURL(File file)\n        throws MalformedURLException {\n\n        File realFile = file;\n        try {\n            realFile = realFile.getCanonicalFile();\n        } catch (IOException e) {\n            // Ignore\n        }\n\n        String fileStr = \"file:\" + realFile.getPath();\n  \t\tStringBuffer sb = new StringBuffer(fileStr.length());\n  \t\tfor(int i=0; i< fileStr.length();i++)\n  \t\t{\n  \t\t\tchar c = fileStr.charAt(i);\n  \t\t\tif(c != ' ')\n  \t\t\t{\n  \t\t\t\tsb.append(c);\n  \t\t\t}\n  \t\t\telse\n  \t\t\t{\n  \t\t\t\tsb.append(\"%20\");\n  \t\t\t}\n \t\t}\n        return new URL(sb.toString());\n    }"}, {"count": 7, "tags": [], "bug_id": 13983, "attachment_id": null, "is_private": false, "id": 60877, "time": "2004-07-20T17:29:09Z", "creator": "jessh@ptc.com", "creation_time": "2004-07-20T17:29:09Z", "text": "Just a note:\n\nEven though Tomcat 5.0.x's WebappClassLoader has a nice getURI() method, it does\nnot use it to from its getURLs() method.  This means the bug still exists in\nTomcat 5.0.x.\n\nThe Tomcat team seems loathe to rock the boat to address this, which is\n*somewhat* understandable.\n\nAt this point I only care about use case this working in Java 2 v1.4 and higher\nand about not destroying any other functionality under Java 2 v1.3.x via a fix\n(e.g. by using a 1.4-specific class directly).\n\nFor these constraints the fix in Tomcat 5.0.27 can be as simple as:\n\n  protected URL getURL(File file)\n    throws MalformedURLException\n  {\n    return jdkCompat.getURI(file);  // same implementation as getURI()\n  }\n\nor one could just call getURI(), but I chose to limit calls to getURI() to those\nexplicitly looking for a URI rather than a well-formed URL."}, {"count": 8, "tags": [], "bug_id": 13983, "attachment_id": null, "id": 61192, "time": "2004-07-27T17:36:16Z", "creator": "jessh@ptc.com", "creation_time": "2004-07-27T17:36:16Z", "is_private": false, "text": "My proposed fix caused other issues -- at least in Tomcat 5.0.27, namely bug\n30349 (which I closed as invalid once I realized it was not reproducible with an\nunpatched Tomcat).  Essentially my \"fix\" made it impossible to compile JSP pages\nfrom directories containing spaces, which otherwise worked fine.  [I do not\nbelieve this issue occured in Tomcat 4.1.24 with my proposed fix.]\n\nThose who distrusted this fix were thus justified, as it broke page compilation\nfor paths including space where the prior situation was that only RMI was broken\n(and only due to issues with Sun's silly RMI implementation involving a\nspace-delimited URL list).\n\nI tried several other tacks to the fix, but the issues appears to be that Tomcat\n5's JSP compiler requires that spaces be *unescaped* and RMI requires that they\nbe *escaped* -- and they're both apparently using the same API, getURLs().\n\nBack to the drawing board..."}, {"count": 9, "tags": [], "bug_id": 13983, "text": "This seems like a pretty big issue to me.  As far as I can tell, it is currently\nimpossible to write a webapp using RMI & a 1.4.2 VM (haven't tied 1.5.0, but\nthat isn't currently an option).  Why hasn't this received more attention?", "id": 70930, "time": "2005-02-14T15:18:33Z", "creator": "jbisotti@gmail.com", "creation_time": "2005-02-14T15:18:33Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 13983, "is_private": false, "text": "Well, my \"fix\" is to disallow installation of Tomcat into a directory path\ncontaining spaces -- for our distribution of Tomcat.\n\nRMI is pretty silly in this regard -- to the point that we've taken using the\nRMIClassLoaderSpi to get it not to send all these URLs on every call, as we\ndon't allow any server loading of client classes anyway.  I've not checked but\nthis RMIClassLoaderSpi change may well fix this issue -- as I believe that's\nwhat caused the issue.\n\nAt this point, though, I'm leaving well enough alone -- spaces in paths are bad\nnews and are best disallowed.  One could never get away with this in a client\ninstallation, but even on Windows server administrators should understand this much!", "id": 70931, "time": "2005-02-14T15:24:52Z", "creator": "jessh@ptc.com", "creation_time": "2005-02-14T15:24:52Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 13983, "attachment_id": null, "id": 78893, "time": "2005-08-23T22:54:27Z", "creator": "markt@apache.org", "creation_time": "2005-08-23T22:54:27Z", "is_private": false, "text": "*** Bug 36316 has been marked as a duplicate of this bug. ***"}, {"count": 12, "tags": [], "bug_id": 13983, "attachment_id": null, "id": 78895, "time": "2005-08-23T23:24:28Z", "creator": "jbisotti@gmail.com", "creation_time": "2005-08-23T23:24:28Z", "is_private": false, "text": "(In reply to comment #10)\n> Well, my \"fix\" is to disallow installation of Tomcat into a directory path\n> containing spaces -- for our distribution of Tomcat.\n> \n> RMI is pretty silly in this regard -- to the point that we've taken using the\n> RMIClassLoaderSpi to get it not to send all these URLs on every call, as we\n> don't allow any server loading of client classes anyway.  I've not checked but\n> this RMIClassLoaderSpi change may well fix this issue -- as I believe that's\n> what caused the issue.\n> \n> At this point, though, I'm leaving well enough alone -- spaces in paths are bad\n> news and are best disallowed.  One could never get away with this in a client\n> installation, but even on Windows server administrators should understand this\nmuch!\n\nUnfortunately, I'm dealing with a user installation scenario and they can\ninstall where ever they like.  Tomcat's own Windows installer puts it in\n\"C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\" by default.  So, my\nproblem still stands, as does my wonderment that this has not been addressed."}, {"count": 13, "tags": [], "bug_id": 13983, "is_private": false, "id": 78948, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2005-08-24T22:47:12Z", "time": "2005-08-24T22:47:12Z", "text": "If you can see a way that fixes this issue (or better yet have a patch) without\nbreaking anything else please let us know what is."}, {"count": 14, "tags": [], "text": "Hi Team\n\nI would like to know if tomcat can make available a patch for this issue on jdk \n1.4.x and above\n\nRegard's\nBeena", "is_private": false, "bug_id": 13983, "id": 85380, "time": "2006-02-03T07:12:24Z", "creator": "beena_patil@bmc.com", "creation_time": "2006-02-03T07:12:24Z", "attachment_id": null}, {"count": 15, "tags": [], "text": "The bug is marked as open - therefore no patch is available at this time. This\nissue is on my list of things to look at for 4.1.32.\n\nThere are no timescales set for a 4.1.32 release at this time.", "is_private": false, "bug_id": 13983, "id": 85381, "time": "2006-02-03T07:51:46Z", "creator": "markt@apache.org", "creation_time": "2006-02-03T07:51:46Z", "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 13983, "attachment_id": null, "is_private": false, "id": 85447, "time": "2006-02-05T22:36:26Z", "creator": "markt@apache.org", "creation_time": "2006-02-05T22:36:26Z", "text": "I have just tested this with that latest source from SVN and I cannot reproduce\nthe bug.\n\nLooking at comment #6, the change made to fix bug10469 is likely to have fixed\nthis issue. If this is the case, the fix is included in 4.1.31.\n\nIf you can reproduce this issue in 4.1.31, please re-open and provide the\nsimplest possible test caset hat exhibits this issue so I can investgate further."}, {"count": 17, "tags": [], "text": "Hello , \n\nI tried this stuff with Tomcat 5.0.28 , I am still facign the same problem , \nplease let me know when can this be fixed.\n\n-Sanjay \n\n(In reply to comment #16)\n> I have just tested this with that latest source from SVN and I cannot \nreproduce\n> the bug.\n> Looking at comment #6, the change made to fix bug10469 is likely to have fixed\n> this issue. If this is the case, the fix is included in 4.1.31.\n> If you can reproduce this issue in 4.1.31, please re-open and provide the\n> simplest possible test caset hat exhibits this issue so I can investgate \nfurther.\n\n", "is_private": false, "bug_id": 13983, "id": 85464, "time": "2006-02-06T15:07:07Z", "creator": "callme_sanjay@yahoo.com", "creation_time": "2006-02-06T15:07:07Z", "attachment_id": null}, {"count": 18, "text": "As I recall this was still an issue in Tomcat 5.0.30 as well...", "creator": "jessh@ptc.com", "is_private": false, "id": 85465, "time": "2006-02-06T15:35:20Z", "bug_id": 13983, "creation_time": "2006-02-06T15:35:20Z", "tags": [], "attachment_id": null}, {"count": 19, "tags": [], "text": "Jess, Mark, \n\nWhat is the plan of this issue getting fixed in 5.0.X code branch? \n\nWe are having a critical project getting stalled due to this issue. \n\nOR \n\nYou can outline the fix for tomcat and we will implement it ourselves. We \nobserved, that ToURI method is not available in 5.0.X. We need to fix it at \nsome different location. Please advise. \n\nAny guidance will be highly appreciated. \n\nRegards,\nShirish Kulkarni (Product Development Manager) \n\n(In reply to comment #18)\n> As I recall this was still an issue in Tomcat 5.0.30 as well...\n\n(In reply to comment #18)\n> As I recall this was still an issue in Tomcat 5.0.30 as well...\n\n", "is_private": false, "id": 85466, "creator": "shirish_kul@yahoo.com", "time": "2006-02-06T15:42:24Z", "bug_id": 13983, "creation_time": "2006-02-06T15:42:24Z", "attachment_id": null}, {"count": 20, "tags": [], "creator": "jessh@ptc.com", "text": "As per previous notes, my \"fix\" in the end was to disallow installation of\nTomcat into any directory containing spaces from our installer.  I thought I had\ndetermined appropriate fixes, but as per previous comments these attempts\nintroduced other issues.  I never dug in deeper as we can disallow installation\nin directories containing spaces in our case -- and it just saves a lot of\nstupid headaches.", "id": 85467, "time": "2006-02-06T15:46:37Z", "bug_id": 13983, "creation_time": "2006-02-06T15:46:37Z", "is_private": false, "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 13983, "text": "Thanks for an immediate response Jesse.\n\nOur customers were working with our products with spaces in the install \ndirectories and hence it has become a \"compulsory\" requirement for us to \nsupport spaces in the install path. \n\nThus, it's not possible to advise them to install again without spaces in the \ninstall path. \n\nWe need the \"code\" fix - please guide us. \n\nRegards,\nShirish", "id": 85468, "time": "2006-02-06T15:57:37Z", "creator": "shirish_kul@yahoo.com", "creation_time": "2006-02-06T15:57:37Z", "is_private": false, "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 13983, "attachment_id": null, "id": 85469, "time": "2006-02-06T16:07:39Z", "creator": "jessh@ptc.com", "creation_time": "2006-02-06T16:07:39Z", "is_private": false, "text": "Sorry, Shirish, I'm just another Tomcat user and *sometime* patcher who bundles\nTomcat.  Fortunately, we have sufficient control to disallow the problematic use\ncase.\n\nI can tell you that the RMIClassLoader design is the underlying problem.  This\nunfortunate class defines a space delimited list as the means of specifying an\nRMI classpath -- rather than using path separator or such.\n\nUnfortunately, this mess is what it is -- it's documented clearly in the\nJavadoc.  The other side of the story is that Tomcat does not seem happy when\nyou %20 encode the spaces in the filename URLs as this seems to throw off JSP\ncompilation, etc.\n\nMy guess is the real fix is to do the %20 bit I already did once upon a time and\nfind all code which assumes such escaping is not done and fix it.  I don't know\nwhat would all be effected, though, which is why I didn't chase the first issue\nwhen I ran into it -- I guessed there could be more that I simply would not find\nbefore the customer did."}, {"count": 23, "tags": [], "bug_id": 13983, "attachment_id": null, "id": 85475, "time": "2006-02-06T18:38:06Z", "creator": "markt@apache.org", "creation_time": "2006-02-06T18:38:06Z", "is_private": false, "text": "This bug was reported against the 4.1.x branch and it is this branch that I have\ntested. Please re-open this report if, and only if, you still see the problem\nwith 4.1.31.\n\nFor those of you using 5.0.x, please open a new bug against 5.0.x. Feel free to\nreference this bug to save on re-typing. You should also be aware that the 5.0.x\nbranch has been pretty much dormant since 5.5.x was considered stable and I am\nnot aware of any developers working on it nor am i aware of any plans for\nanother 5.0.x release."}, {"count": 24, "tags": [], "bug_id": 13983, "attachment_id": null, "is_private": false, "id": 85476, "time": "2006-02-06T18:42:11Z", "creator": "jessh@ptc.com", "creation_time": "2006-02-06T18:42:11Z", "text": "I actually care very, very little if this gets addressed in Tomcat 4.1 or 5.0. \nAll I care is whether it is still an issue in 5.5.15, which admittedly I've not\ntested since we simply work around the issue.\n\nPerhaps one of these days I'll get around to testing this..."}]
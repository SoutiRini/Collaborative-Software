[{"count": 0, "tags": [], "text": "In apr/file_io/unix/filestat.c you find the comment \"needs to be revisited\" in\nthe fill_out_finfo()-function, and all code dealing with csize is commented out.\n\nI really need csize, so I had to uncomment that code in order to get things in a\nworking state.\n\nI suspect that it's commented due to the fact that st_blocks is a non-standard\nextension to the stat struct. However it feels like a no-brainer to support it\nwhere present, either by a configure test or by hardcoding in known good\narchitectures which support it.\n\nTo begin such a list, I can state that the following architectures support\nst_blocks in units of 512-byte-blocks:\nLinux (verified on Ubuntu Dapper amongst others)\nAIX (verified on AIX 5.1 and 5.3)\nSolaris (verified on Solaris 10)", "attachment_id": null, "bug_id": 41678, "id": 99675, "time": "2007-02-22T04:33:28Z", "creator": "nikke@acc.umu.se", "creation_time": "2007-02-22T04:33:28Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 41678, "text": "The assertion is interesting, but can we determine that csize is a constant 512\nfrom additional macro/fs calls provided by clib/stat API, or alternately, do\nwe have any example of where cstat member is NOT in 512 byte units?  And what\nabout 64 bit extended stat implementations?\n", "id": 99695, "time": "2007-02-22T11:29:40Z", "creator": "wrowe@apache.org", "creation_time": "2007-02-22T11:29:40Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "nikke@acc.umu.se", "text": "(In reply to comment #1)\n> do we have any example of where cstat member is NOT in 512 byte units?  And what\n> about 64 bit extended stat implementations?\n\nI peeked into GNU coreutils (src/system.h), and it only has kludges for:\nHPUX: (1024-byte units instead of 512)\nAIX on PS/2 (4096-byte units), but this is an obsolete platform\n\nSo, given the fact that GNU du (which is included in coreutils) has been ported\nand used on most systems that exists I would say that it's rather safe to assume\nthat when present, st_blocks is in 512-byte units with the exception of HPUX.\n\nAdditionally I got hold of an IRIX-guy, and I can now say for sure that IRIX\nalso has st_blocks in 512-byte units.", "id": 99699, "time": "2007-02-22T13:14:20Z", "bug_id": 41678, "creation_time": "2007-02-22T13:14:20Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Nicklas - on HPUX: (1024-byte) AIX on PS/2 (4096-byte) can you -describe- the\nappropriate exception clause?  Please don't pollute the discussion by quoting\ncode, thank you.\n\nAre these somehow available from a system constant?\n", "attachment_id": null, "bug_id": 41678, "id": 101686, "time": "2007-04-13T14:16:39Z", "creator": "wrowe@apache.org", "creation_time": "2007-04-13T14:16:39Z", "is_private": false}, {"count": 4, "text": "Ok, IIUC on HPUX, it's st_blksize * st_blocks - correct?\n\nIf this is the case, we can conditionally include the math if\nst_blksize is also present, and trust st_blksize == 512 if not.\n\nMake sense?", "bug_id": 41678, "attachment_id": null, "id": 101689, "time": "2007-04-13T14:48:18Z", "creator": "wrowe@apache.org", "creation_time": "2007-04-13T14:48:18Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "nikke@acc.umu.se", "attachment_id": null, "text": "(In reply to comment #3)\n> Nicklas - on HPUX: (1024-byte) AIX on PS/2 (4096-byte) can you -describe- the\n> appropriate exception clause?  Please don't pollute the discussion by quoting\n> code, thank you.\n\nAIX PS/2 (I386) is scarily obsolete by now, but if you want to detect it\nyou can check that both _AIX and _I386 are defined. I honestly don't think that\nAIX PS/2 is used anywhere.\n\n> Are these somehow available from a system constant?\n\nFrom what I can gather, DEV_BSIZE is the relevant system constant.\n\nNote that you should NOT confuse DEV_BSIZE with st_blksize! st_blksize is\nthe preferred (min)size when doing IO, which is a completely different\nbeast!\n\nIt seems that for most systems including HPUX DEV_BSIZE is defined\nin sys/param.h, except of course on AIX where it's defined in\nsys/dir.h ... I would this suggest the following logic:\n\nInclude sys/param.h. When _AIX is defined, include sys/dir.h too.\nIf DEV_BSIZE is defined, use it. Otherwise, assume DEV_BSIZE is 512 bytes.\n\n", "id": 101712, "time": "2007-04-14T04:56:28Z", "bug_id": 41678, "creation_time": "2007-04-14T04:56:28Z", "is_private": false}, {"count": 6, "tags": [], "creator": "wrowe@apache.org", "text": "Committed in 585343.  I didn't go much further than to try to include\nall of the usual fstat-ish headers plus sys/params.h where it is available.\n\nTook it one step further (can't resist solve entire issues at once) and now\npick up nsec time resolutions and convert those to msec for apr_time_t values\nof atime/ctime/mtime.\n\nThanks for helping work through the appropriate places to find this information!", "id": 109410, "time": "2007-10-16T20:18:13Z", "bug_id": 41678, "creation_time": "2007-10-16T20:18:13Z", "is_private": false, "attachment_id": null}]
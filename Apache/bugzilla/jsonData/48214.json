[{"count": 0, "tags": [], "bug_id": 48214, "is_private": false, "text": "Created attachment 24550\nWeb Application that shows this behavior\n\nThis occurs with 6.0 Trunk, built from SVN yesterday (2009-11-16):\n\nI have a Servlet that's loaded on \nstartup and does following in its init() method:\n\ntry\n{\n        Class.forName( driver );\n}\ncatch( ClassNotFoundException x )\n{\n        log( x.toString(), x );\n}\nConnection con = null;\ntry\n{\n        con = DriverManager.getConnection( url, user, pass );\n        log( \"connection established: \" + con.toString() );\n}\ncatch( SQLException x )\n{\n        log( x.toString(), x );\n        throw new ServletException( x.toString(), x );\n}\n\nAfter starting Tomcat, I get the following expected output:\n\nNov 16, 2009 1:56:11 PM org.apache.catalina.core.ApplicationContext log\nINFO: DBTestServlet: connection established: \norg.postgresql.jdbc4.Jdbc4Connection@17ec9f7\nNov 16, 2009 1:56:12 PM org.apache.catalina.core.ApplicationContext log\nINFO: ContextListener: contextInitialized()\n\nBut when reloading the context, I get the following \nexception:\n\nNov 16, 2009 1:56:32 PM org.apache.catalina.core.ApplicationContext log\nSEVERE: DBTestServlet: java.sql.SQLException: No suitable driver found for \njdbc:postgresql://127.0.0.1/inxmail\njava.sql.SQLException: No suitable driver found for \njdbc:postgresql://127.0.0.1/inxmail\n        at java.sql.DriverManager.getConnection(DriverManager.java:602)\n        at java.sql.DriverManager.getConnection(DriverManager.java:185)\n        at com.inxmail.test.DBTestServlet.init(DBTestServlet.java:49)\n        at javax.servlet.GenericServlet.init(GenericServlet.java:212)\n\nI tested with Java 6 (1.6.0_17) and JDBC 3 and 4 Drivers for Oracle \n(ojdbc1.4.jar from Oracle 10, ojdbc6 from Oracle 11) as well as PostgreSQL.\n\nAttached is a minimal webapp that exhibits this behavior. DB connection\nconfiguration is in /META-INF/context.xml. Also attached is the full source of\nthe servlet.\n\nThis webapp works in 6.0.20.", "id": 132039, "time": "2009-11-17T07:22:55Z", "creator": "rainer.frey+tomcat@inxmail.de", "creation_time": "2009-11-17T07:22:55Z", "attachment_id": 24550}, {"count": 1, "tags": [], "bug_id": 48214, "attachment_id": 24551, "id": 132040, "time": "2009-11-17T07:24:28Z", "creator": "rainer.frey+tomcat@inxmail.de", "creation_time": "2009-11-17T07:24:28Z", "is_private": false, "text": "Created attachment 24551\nServlet Source of Test Case"}, {"count": 2, "attachment_id": null, "creator": "markt@apache.org", "text": "The problem you are seeing is a result of where you have placed the driver class, how DriverManager works internally and what Tomcat now does to prevent memory leaks.\n\nYour driver class is in CATALINA_HOME/lib so will be loaded by Tomcat's common class loader. The sequence of events is:\n\n- Tomcat starts\n- Your app starts\n- Your servlet is loaded and init() runs\n- The driver class is loaded due to the Class.forName() call\n- The common class loader loads the class\n- The class is registered with DriverManager but as DriverManager uses the context class loader, it is registered against your web application\n- The app runs for a while\n- The app is reloaded\n- Tomcat spots that DriverManager has registered the JDBC driver against the webapp class loader\n- Tomcat unregisters the JDBC driver to prevent a memory leak\n- Your app restarts\n- Your servlet is loaded and init() runs\n- The driver class is not loaded since it was loaded by the common class loader and is, therefore, still available\n- No class is loaded, so no driver is registered with DriverManager\n- init() fails when DriverManager can't find the driver\n\nThere are many ways to fix this. The simplest are:\n- use a context listener to explicitly call DriverManager.register and deregister()\n- move the JDBC driver to WEB-INF/lib\n\nTomcat 7 logs a message when unregistering the JDBC driver that provides a useful clue as to what is going on. Tomcat 6 doesn't do that. I'll propose the necessary changes for inclusion in Tomcat 6.", "id": 133019, "time": "2009-12-21T06:13:16Z", "bug_id": 48214, "creation_time": "2009-12-21T06:13:16Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 48214, "attachment_id": null, "id": 133031, "time": "2009-12-21T09:16:22Z", "creator": "markt@apache.org", "creation_time": "2009-12-21T09:16:22Z", "is_private": false, "text": "There was a bug here. It has been fixed in trunk and proposed for 6.0.x"}, {"count": 4, "tags": [], "bug_id": 48214, "is_private": false, "text": "This has been fixed in 6.0.x and will be in 6.0.21 onwards.", "id": 133036, "time": "2009-12-21T11:13:57Z", "creator": "markt@apache.org", "creation_time": "2009-12-21T11:13:57Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "aketov+apache@gmail.com", "is_private": false, "text": "Tomcat has this bug for version 64-bit Itanium Windows. I guess you didn't commit fix for this version.", "id": 138503, "time": "2010-07-18T16:16:09Z", "bug_id": 48214, "creation_time": "2010-07-18T16:16:09Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "aketov+apache@gmail.com", "attachment_id": null, "text": "This bug displayed after start a context. I tried get connection to external mssql database in my web application and java had an exception \"No suitable driver\":\n\norg.apache.commons.dbcp.SQLNestedException: Cannot create JDBC driver of class '' for connect URL 'jdbc:inetdae7a:serverName?database=dbName&amp;charset=Cp1251'", "id": 138504, "time": "2010-07-18T17:15:32Z", "bug_id": 48214, "creation_time": "2010-07-18T17:15:32Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 48214, "is_private": false, "text": "re comment #5 - The fix was platform neutral.\n\nre comment #6 That isn't a bug, that is user error. Please use the users list for assistance.\n\nRestoring the status of this bug to resolved.", "id": 138516, "time": "2010-07-19T13:11:59Z", "creator": "markt@apache.org", "creation_time": "2010-07-19T13:11:59Z", "attachment_id": null}]